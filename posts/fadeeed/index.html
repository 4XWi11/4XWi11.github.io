<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width">
<meta name="theme-color" content="#222">
<meta name="generator" content="Hexo 5.4.0">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png">
  <link rel="icon" type="image/png" sizes="32x32" href="/images/avatar.png">
  <link rel="icon" type="image/png" sizes="16x16" href="/images/title.png">
  <link rel="mask-icon" href="/images/logo.svg" color="#222">

<link rel="stylesheet" href="/css/main.css">



<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5.15.4/css/all.min.css" integrity="sha256-mUZM63G8m73Mcidfrv5E+Y61y7a12O5mW4ezU3bxqW4=" crossorigin="anonymous">

<script class="next-config" data-name="main" type="application/json">{"hostname":"4xwi11.github.io","root":"/","images":"/images","scheme":"Gemini","darkmode":false,"version":"8.8.0","exturl":false,"sidebar":{"position":"right","width":320,"display":"post","padding":18,"offset":12},"copycode":true,"bookmark":{"enable":true,"color":"#222","save":"auto"},"mediumzoom":true,"lazyload":true,"pangu":false,"comments":{"style":"tabs","active":"utterances","storage":true,"lazyload":false,"nav":null,"activeClass":"utterances"},"stickytabs":false,"motion":{"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"fadeInDown","post_body":"fadeInDown","coll_header":"fadeInLeft","sidebar":"fadeInUp"}},"prism":false,"i18n":{"placeholder":"搜索...","empty":"没有找到任何搜索结果：${query}","hits_time":"找到 ${hits} 个搜索结果（用时 ${time} 毫秒）","hits":"找到 ${hits} 个搜索结果"},"path":"/search.xml","localsearch":{"enable":true,"trigger":"auto","top_n_per_article":-1,"unescape":true,"preload":false}}</script><script src="/js/config.js"></script>
<meta name="description" content="前两周去北方支教，回来了又去了红帽杯，哈哈跑了半个中国，收获还挺大的。但红帽杯零贡献，再次让我知道了学pwn的必要。回归开始集训，可以安分点了 七月的尾巴赛题，没有当场做出来的看师傅博客复现了 长文废话警告">
<meta property="og:type" content="article">
<meta property="og:title" content="20210731 DAS 极客巅峰 UIUCTF2021 cryptoctfCrypto方向部分WP">
<meta property="og:url" content="https://4xwi11.github.io/posts/fadeeed/index.html">
<meta property="og:site_name" content="4XWi11的博客">
<meta property="og:description" content="前两周去北方支教，回来了又去了红帽杯，哈哈跑了半个中国，收获还挺大的。但红帽杯零贡献，再次让我知道了学pwn的必要。回归开始集训，可以安分点了 七月的尾巴赛题，没有当场做出来的看师傅博客复现了 长文废话警告">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/des.svg">
<meta property="og:image" content="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210820190413902.png">
<meta property="og:image" content="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210820204757956.png">
<meta property="og:image" content="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210805191752700.png">
<meta property="og:image" content="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210805192547584.png">
<meta property="og:image" content="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210731121038121.png">
<meta property="og:image" content="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210805183255028.png">
<meta property="og:image" content="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210812224123276.png">
<meta property="og:image" content="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210812224334985.png">
<meta property="article:published_time" content="2021-10-08T02:30:20.000Z">
<meta property="article:modified_time" content="2021-10-08T04:23:49.655Z">
<meta property="article:author" content="4XWi11">
<meta name="twitter:card" content="summary">
<meta name="twitter:image" content="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/des.svg">


<link rel="canonical" href="https://4xwi11.github.io/posts/fadeeed/">



<script class="next-config" data-name="page" type="application/json">{"sidebar":"","isHome":false,"isPost":true,"lang":"zh-CN","comments":true,"permalink":"https://4xwi11.github.io/posts/fadeeed/","path":"posts/fadeeed/","title":"20210731 DAS 极客巅峰 UIUCTF2021 cryptoctfCrypto方向部分WP"}</script>

<script class="next-config" data-name="calendar" type="application/json">""</script>
<title>20210731 DAS 极客巅峰 UIUCTF2021 cryptoctfCrypto方向部分WP | 4XWi11的博客</title>
  




  <noscript>
    <link rel="stylesheet" href="/css/noscript.css">
  </noscript>
</head>

<body itemscope itemtype="http://schema.org/WebPage">
  <div class="headband"></div>

  <main class="main">
    <header class="header" itemscope itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-container">
  <div class="site-nav-toggle">
    <div class="toggle" aria-label="切换导航栏" role="button">
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
        <span class="toggle-line"></span>
    </div>
  </div>

  <div class="site-meta">

    <a href="/" class="brand" rel="start">
      <i class="logo-line"></i>
      <h1 class="site-title">4XWi11的博客</h1>
      <i class="logo-line"></i>
    </a>
  </div>

  <div class="site-nav-right">
    <div class="toggle popup-trigger">
        <i class="fa fa-search fa-fw fa-lg"></i>
    </div>
  </div>
</div>



<nav class="site-nav">
  <ul class="main-menu menu">
        <li class="menu-item menu-item-home"><a href="/" rel="section"><i class="fa fa-home fa-fw"></i>首页</a></li>
        <li class="menu-item menu-item-about"><a href="/about/" rel="section"><i class="fas fa-pray fa-fw"></i>关于</a></li>
        <li class="menu-item menu-item-tags"><a href="/tags/" rel="section"><i class="fa fa-tags fa-fw"></i>标签</a></li>
        <li class="menu-item menu-item-categories"><a href="/categories/" rel="section"><i class="fa fa-th fa-fw"></i>分类</a></li>
        <li class="menu-item menu-item-archives"><a href="/archives/" rel="section"><i class="fa fa-archive fa-fw"></i>归档</a></li>
      <li class="menu-item menu-item-search">
        <a role="button" class="popup-trigger"><i class="fa fa-search fa-fw"></i>搜索
        </a>
      </li>
  </ul>
</nav>



  <div class="search-pop-overlay">
    <div class="popup search-popup"><div class="search-header">
  <span class="search-icon">
    <i class="fa fa-search"></i>
  </span>
  <div class="search-input-container">
    <input autocomplete="off" autocapitalize="off" maxlength="80"
           placeholder="搜索..." spellcheck="false"
           type="search" class="search-input">
  </div>
  <span class="popup-btn-close" role="button">
    <i class="fa fa-times-circle"></i>
  </span>
</div>
<div class="search-result-container no-result">
  <div class="search-result-icon">
    <i class="fa fa-spinner fa-pulse fa-5x"></i>
  </div>
</div>

    </div>
  </div>

</div>
        
  
  <div class="toggle sidebar-toggle" role="button">
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
    <span class="toggle-line"></span>
  </div>

  <aside class="sidebar">

    <div class="sidebar-inner sidebar-nav-active sidebar-toc-active">
      <ul class="sidebar-nav">
        <li class="sidebar-nav-toc">
          文章目录
        </li>
        <li class="sidebar-nav-overview">
          站点概览
        </li>
      </ul>

      <div class="sidebar-panel-container">
        <!--noindex-->
        <div class="post-toc-wrap sidebar-panel">
            <div class="post-toc animated"><ol class="nav"><li class="nav-item nav-level-2"><a class="nav-link" href="#2021DASCTF%E5%AE%9E%E6%88%98%E7%B2%BE%E8%8B%B1%E5%A4%8F%E4%BB%A4%E8%90%A5%E6%9A%A8DASCTF-July-X-CBCTF-4th"><span class="nav-number">1.</span> <span class="nav-text">2021DASCTF实战精英夏令营暨DASCTF July X CBCTF 4th</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Crypto-Yusa%E7%9A%84%E5%AF%86%E7%A0%81%E5%AD%A6%E7%AD%BE%E5%88%B0%E2%80%94%E2%80%94BlockTrick"><span class="nav-number">1.1.</span> <span class="nav-text">Crypto-Yusa的密码学签到——BlockTrick</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Crypto-Yusa%E7%9A%84%E5%AF%86%E7%A0%81%E5%AD%A6%E8%AF%BE%E5%A0%82%E2%80%94%E2%80%94SEDSED%EF%BC%88recuring%EF%BC%89"><span class="nav-number">1.2.</span> <span class="nav-text">Crypto-Yusa的密码学课堂——SEDSED（recuring）</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Misc-red-vs-blue"><span class="nav-number">1.3.</span> <span class="nav-text">Misc-red_vs_blue</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#%E6%9E%81%E5%AE%A2%E5%B7%85%E5%B3%B0"><span class="nav-number">2.</span> <span class="nav-text">极客巅峰</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Crypto-crtrsa"><span class="nav-number">2.1.</span> <span class="nav-text">Crypto-crtrsa</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Crypto-MedicalImage%EF%BC%88recuring%EF%BC%89"><span class="nav-number">2.2.</span> <span class="nav-text">Crypto-MedicalImage（recuring）</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#UIUCTF-2021"><span class="nav-number">3.</span> <span class="nav-text">UIUCTF 2021</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#Re-hvhpgs-synt"><span class="nav-number">3.1.</span> <span class="nav-text">Re-hvhpgs{synt}</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Crypto-dhke-intro"><span class="nav-number">3.2.</span> <span class="nav-text">Crypto-dhke_intro</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Crypto-back-to-basics"><span class="nav-number">3.3.</span> <span class="nav-text">Crypto-back_to_basics</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#Crypto-dhke-adventure"><span class="nav-number">3.4.</span> <span class="nav-text">Crypto-dhke_adventure</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Crypto-CTF"><span class="nav-number">4.</span> <span class="nav-text">Crypto CTF</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#easy"><span class="nav-number">4.1.</span> <span class="nav-text">easy</span></a><ol class="nav-child"><li class="nav-item nav-level-4"><a class="nav-link" href="#Farm"><span class="nav-number">4.1.1.</span> <span class="nav-text">Farm</span></a></li><li class="nav-item nav-level-4"><a class="nav-link" href="#KeyBase%EF%BC%88unsolved%EF%BC%89"><span class="nav-number">4.1.2.</span> <span class="nav-text">KeyBase（unsolved）</span></a></li></ol></li></ol></li></ol></div>
        </div>
        <!--/noindex-->

        <div class="site-overview-wrap sidebar-panel">
          <div class="site-author site-overview-item animated" itemprop="author" itemscope itemtype="http://schema.org/Person">
    <img class="site-author-image" itemprop="image" alt="4XWi11"
      src="/images/avatar.png">
  <p class="site-author-name" itemprop="name">4XWi11</p>
  <div class="site-description" itemprop="description">CTF菜鸡自进阶</div>
</div>
<div class="site-state-wrap site-overview-item animated">
  <nav class="site-state">
      <div class="site-state-item site-state-posts">
        <a href="/archives/">
          <span class="site-state-item-count">64</span>
          <span class="site-state-item-name">日志</span>
        </a>
      </div>
      <div class="site-state-item site-state-categories">
          <a href="/categories/">
        <span class="site-state-item-count">8</span>
        <span class="site-state-item-name">分类</span></a>
      </div>
      <div class="site-state-item site-state-tags">
          <a href="/tags/">
        <span class="site-state-item-count">43</span>
        <span class="site-state-item-name">标签</span></a>
      </div>
  </nav>
</div>
  <div class="links-of-author site-overview-item animated">
      <span class="links-of-author-item">
        <a href="https://github.com/4XWi11" title="GitHub → https:&#x2F;&#x2F;github.com&#x2F;4XWi11" rel="noopener" target="_blank"><i class="fab fa-github fa-fw"></i>GitHub</a>
      </span>
      <span class="links-of-author-item">
        <a href="https://blog.csdn.net/m0_49109277?spm=1000.2115.3001.5343" title="CSDN → https:&#x2F;&#x2F;blog.csdn.net&#x2F;m0_49109277?spm&#x3D;1000.2115.3001.5343" rel="noopener" target="_blank"><i class="fab fa-cuttlefish fa-fw"></i>CSDN</a>
      </span>
  </div>
  <div class="cc-license site-overview-item animated" itemprop="license">
    <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" class="cc-opacity" rel="noopener" target="_blank"><img src="https://cdn.jsdelivr.net/npm/@creativecommons/vocabulary@2020.11.3/assets/license_badges/small/by_nc_sa.svg" alt="Creative Commons"></a>
  </div>


  <div class="links-of-blogroll site-overview-item animated">
    <div class="links-of-blogroll-title"><i class="fa fa-globe fa-fw"></i>
      Links
    </div>
    <ul class="links-of-blogroll-list">
        <li class="links-of-blogroll-item">
          <a href="https://github.com/JinYiTong" title="https:&#x2F;&#x2F;github.com&#x2F;JinYiTong" rel="noopener" target="_blank">j1ang（姜少 Web大师傅）</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://scr1pt-kid.github.io/" title="https:&#x2F;&#x2F;scr1pt-kid.github.io&#x2F;" rel="noopener" target="_blank">Scr1pt（V&N Misc师傅）</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.cnblogs.com/yunqian2017/" title="https:&#x2F;&#x2F;www.cnblogs.com&#x2F;yunqian2017&#x2F;" rel="noopener" target="_blank">Openg（彭总 Misc之神）</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://blog.csdn.net/qq_53283643?spm=1001.2014.3001.5509" title="https:&#x2F;&#x2F;blog.csdn.net&#x2F;qq_53283643?spm&#x3D;1001.2014.3001.5509" rel="noopener" target="_blank">mxx307（尚师傅 Crypto担当）</a>
        </li>
        <li class="links-of-blogroll-item">
          <a href="https://www.yuque.com/benjieming-huvhr" title="https:&#x2F;&#x2F;www.yuque.com&#x2F;benjieming-huvhr" rel="noopener" target="_blank">Anza（谢师傅 Pwn大师傅）</a>
        </li>
    </ul>
  </div>

        </div>
      </div>
        <div class="back-to-top animated" role="button" aria-label="返回顶部">
          <i class="fa fa-arrow-up"></i>
          <span>0%</span>
        </div>
    </div>
  </aside>
  <div class="sidebar-dimmer"></div>


    </header>

    
  <div class="reading-progress-bar"></div>
  <a role="button" class="book-mark-link book-mark-link-fixed"></a>

  <a href="https://github.com/4XWi11" class="github-corner" title="Follow me on GitHub" aria-label="Follow me on GitHub" rel="noopener" target="_blank"><svg width="80" height="80" viewBox="0 0 250 250" aria-hidden="true"><path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"></path><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"></path><path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"></path></svg></a>

<noscript>
  <div class="noscript-warning">Theme NexT works best with JavaScript enabled</div>
</noscript>


    <div class="main-inner post posts-expand">


  


<div class="post-block">
  
  

  <article itemscope itemtype="http://schema.org/Article" class="post-content" lang="zh-CN">
    <link itemprop="mainEntityOfPage" href="https://4xwi11.github.io/posts/fadeeed/">

    <span hidden itemprop="author" itemscope itemtype="http://schema.org/Person">
      <meta itemprop="image" content="/images/avatar.png">
      <meta itemprop="name" content="4XWi11">
      <meta itemprop="description" content="CTF菜鸡自进阶">
    </span>

    <span hidden itemprop="publisher" itemscope itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="4XWi11的博客">
    </span>
      <header class="post-header">
        <h1 class="post-title" itemprop="name headline">
          20210731 DAS 极客巅峰 UIUCTF2021 cryptoctfCrypto方向部分WP
        </h1>

        <div class="post-meta-container">
          <div class="post-meta">
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-calendar"></i>
      </span>
      <span class="post-meta-item-text">发表于</span>
      

      <time title="创建时间：2021-10-08 10:30:20 / 修改时间：12:23:49" itemprop="dateCreated datePublished" datetime="2021-10-08T10:30:20+08:00">2021-10-08</time>
    </span>
    <span class="post-meta-item">
      <span class="post-meta-item-icon">
        <i class="far fa-folder"></i>
      </span>
      <span class="post-meta-item-text">分类于</span>
        <span itemprop="about" itemscope itemtype="http://schema.org/Thing">
          <a href="/categories/%E6%A0%91%E5%93%A5%E8%AE%A9%E6%88%91%E5%A4%A9%E5%A4%A9%E5%86%99%E4%B9%8BCrypto/" itemprop="url" rel="index"><span itemprop="name">树哥让我天天写之Crypto</span></a>
        </span>
    </span>

  
    <span class="post-meta-item" title="阅读次数" id="busuanzi_container_page_pv">
      <span class="post-meta-item-icon">
        <i class="far fa-eye"></i>
      </span>
      <span class="post-meta-item-text">阅读次数：</span>
      <span id="busuanzi_value_page_pv"></span>
    </span>
    <span class="post-meta-break"></span>
    <span class="post-meta-item" title="本文字数">
      <span class="post-meta-item-icon">
        <i class="far fa-file-word"></i>
      </span>
      <span class="post-meta-item-text">本文字数：</span>
      <span>40k</span>
    </span>
    <span class="post-meta-item" title="阅读时长">
      <span class="post-meta-item-icon">
        <i class="far fa-clock"></i>
      </span>
      <span class="post-meta-item-text">阅读时长 &asymp;</span>
      <span>36 分钟</span>
    </span>
</div>

        </div>
      </header>

    
    
    
    <div class="post-body" itemprop="articleBody">
        <p>前两周去北方支教，回来了又去了红帽杯，哈哈跑了半个中国，收获还挺大的。但红帽杯零贡献，再次让我知道了学pwn的必要。回归开始集训，可以安分点了</p>
<p>七月的尾巴赛题，没有当场做出来的看师傅博客复现了</p>
<p>长文废话警告</p>
<span id="more"></span>

<h2 id="2021DASCTF实战精英夏令营暨DASCTF-July-X-CBCTF-4th"><a href="#2021DASCTF实战精英夏令营暨DASCTF-July-X-CBCTF-4th" class="headerlink" title="2021DASCTF实战精英夏令营暨DASCTF July X CBCTF 4th"></a>2021DASCTF实战精英夏令营暨DASCTF July X CBCTF 4th</h2><h3 id="Crypto-Yusa的密码学签到——BlockTrick"><a href="#Crypto-Yusa的密码学签到——BlockTrick" class="headerlink" title="Crypto-Yusa的密码学签到——BlockTrick"></a>Crypto-Yusa的密码学签到——BlockTrick</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span>(<span class="params">a</span>):</span></span><br><span class="line">	size = (<span class="number">16</span>-<span class="built_in">len</span>(a)%<span class="number">16</span>)%<span class="number">16</span></span><br><span class="line">	a += <span class="built_in">chr</span>(size)*size</span><br><span class="line">	<span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line">iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">key = os.urandom(<span class="number">16</span>)</span><br><span class="line">enc = AES.new(key,AES.MODE_CBC,iv)</span><br><span class="line"><span class="built_in">print</span>(iv.encode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		trick = raw_input(<span class="string">&quot;&quot;</span>)</span><br><span class="line">		trick = pad(trick.decode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line">		cipher = enc.encrypt(trick)</span><br><span class="line">		<span class="keyword">if</span> trick == cipher <span class="keyword">and</span> trick != <span class="string">&quot;&quot;</span>:</span><br><span class="line">			<span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">				<span class="built_in">print</span>(f.read())</span><br><span class="line">				exit()</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="built_in">print</span>(cipher.encode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&quot;Try again&quot;</span>)</span><br><span class="line">	<span class="keyword">except</span>:</span><br><span class="line">		exit()</span><br></pre></td></tr></table></figure>

<p>尚师傅给的思路，两轮AES_CBC，用已知IV去异或，具体的过程还是对着CBC的流程看去吧，小难想，但想透了就酱</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">sh = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">25321</span>)</span><br><span class="line">iv = sh.recv()</span><br><span class="line"></span><br><span class="line"><span class="comment"># first time</span></span><br><span class="line">sh.send(iv)</span><br><span class="line">cipher = sh.recvline()</span><br><span class="line">sh.recv()</span><br><span class="line"></span><br><span class="line"><span class="comment"># second time</span></span><br><span class="line">sh.send(cipher)</span><br><span class="line">sh.recv()</span><br></pre></td></tr></table></figure>

<h3 id="Crypto-Yusa的密码学课堂——SEDSED（recuring）"><a href="#Crypto-Yusa的密码学课堂——SEDSED（recuring）" class="headerlink" title="Crypto-Yusa的密码学课堂——SEDSED（recuring）"></a>Crypto-Yusa的密码学课堂——SEDSED（recuring）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> My_box <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_key</span>(<span class="params">key</span>):</span></span><br><span class="line">    key_64 = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        key_64 += <span class="string">&#x27;&#123;0:04b&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>(key[i], <span class="number">16</span>))</span><br><span class="line">    key_56 = gen_56bit(key_64)</span><br><span class="line">    left_key, right_key = key_56[:<span class="number">28</span>], key_56[<span class="number">28</span>:]</span><br><span class="line">    round_keys = <span class="built_in">list</span>()</span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">        L = circular_shift(left_key, round_shifts[index])</span><br><span class="line">        R = circular_shift(right_key, round_shifts[index])</span><br><span class="line">        round_key = gen_48bit(L + R)</span><br><span class="line">        round_keys.append(round_key)</span><br><span class="line">        left_key = L</span><br><span class="line">        right_key = R</span><br><span class="line">    <span class="keyword">return</span> round_keys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">circular_shift</span>(<span class="params">key, n</span>):</span></span><br><span class="line">    temp = <span class="string">&quot;&quot;</span></span><br><span class="line">    temp = key[n:] + key[:n]</span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_56bit</span>(<span class="params">key</span>):</span></span><br><span class="line">    key_56 = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> KEY_P1:</span><br><span class="line">        key_56 += key[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> key_56</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_48bit</span>(<span class="params">key</span>):</span></span><br><span class="line">    key_48 = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> KEY_P2:</span><br><span class="line">        key_48 += key[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> key_48</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">plain_text, sub_keys</span>):</span></span><br><span class="line">    plain_textb = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        plain_textb += <span class="string">&#x27;&#123;0:04b&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>(plain_text[i], <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line">    plain_textp = permutation(plain_textb)</span><br><span class="line">    left, right = plain_textp[:<span class="number">32</span>], plain_textp[<span class="number">32</span>:]</span><br><span class="line">    out = func(right, sub_keys[<span class="number">0</span>])</span><br><span class="line">    temp = <span class="built_in">int</span>(out, <span class="number">2</span>) ^ <span class="built_in">int</span>(left, <span class="number">2</span>)</span><br><span class="line">    left, right = right, <span class="string">&#x27;&#123;0:032b&#125;&#x27;</span>.<span class="built_in">format</span>(temp)</span><br><span class="line">    out = func(right, sub_keys[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    temp = <span class="built_in">int</span>(out, <span class="number">2</span>) ^ <span class="built_in">int</span>(left, <span class="number">2</span>)</span><br><span class="line">    left = <span class="string">&#x27;&#123;0:032b&#125;&#x27;</span>.<span class="built_in">format</span>(temp)</span><br><span class="line">    final = inv_permutation(left + right)</span><br><span class="line">    cipher = <span class="built_in">hex</span>(<span class="built_in">int</span>(final, <span class="number">2</span>))[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">permutation</span>(<span class="params">plain_text</span>):</span></span><br><span class="line">    p = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> IP:</span><br><span class="line">        p += plain_text[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">text, key</span>):</span></span><br><span class="line">    exp = expand(text)</span><br><span class="line">    s_input = <span class="string">&#x27;&#123;0:048b&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>(exp, <span class="number">2</span>) ^ <span class="built_in">int</span>(key, <span class="number">2</span>))</span><br><span class="line">    s_out = sbox(s_input)</span><br><span class="line">    f_final = per_func(s_out)</span><br><span class="line">    <span class="keyword">return</span> f_final</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">expand</span>(<span class="params">text</span>):</span></span><br><span class="line">    temp = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> E:</span><br><span class="line">        temp += text[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_permutation</span>(<span class="params">text</span>):</span></span><br><span class="line">    final = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> Inv_IP:</span><br><span class="line">        final += text[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> final</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">per_func</span>(<span class="params">s_output</span>):</span></span><br><span class="line">    s_final = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> P:</span><br><span class="line">        s_final += s_output[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> s_final</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sbox</span>(<span class="params">s_input, index=<span class="literal">None</span></span>):</span></span><br><span class="line">    s_out = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> index != <span class="literal">None</span>:</span><br><span class="line">        i = index</span><br><span class="line">        row = <span class="built_in">int</span>(s_input[<span class="number">0</span>] + s_input[<span class="number">5</span>], <span class="number">2</span>)</span><br><span class="line">        column = <span class="built_in">int</span>(s_input[<span class="number">1</span>:<span class="number">5</span>], <span class="number">2</span>)</span><br><span class="line">        s_out += <span class="string">&#x27;&#123;0:04b&#125;&#x27;</span>.<span class="built_in">format</span>(S[i][row][column])</span><br><span class="line">        <span class="keyword">return</span> s_out</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            row = <span class="built_in">int</span>(s_input[<span class="number">6</span> * i] + s_input[<span class="number">6</span> * i + <span class="number">5</span>], <span class="number">2</span>)</span><br><span class="line">            column = <span class="built_in">int</span>(s_input[<span class="number">6</span> * i + <span class="number">1</span>:<span class="number">6</span> * i + <span class="number">5</span>], <span class="number">2</span>)</span><br><span class="line">            s_out += <span class="string">&#x27;&#123;0:04b&#125;&#x27;</span>.<span class="built_in">format</span>(S[i][row][column])</span><br><span class="line">        <span class="keyword">return</span> s_out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc</span>(<span class="params">plain_text</span>):</span></span><br><span class="line">    sub_keys = gen_key(key_64)</span><br><span class="line">    cipher_text = encrypt(plain_text, sub_keys)</span><br><span class="line">    <span class="keyword">return</span> cipher_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span>(<span class="params">plain_text</span>):</span></span><br><span class="line">    size = (<span class="number">16</span> - (<span class="built_in">len</span>(plain_text) % <span class="number">16</span>)) % <span class="number">16</span></span><br><span class="line">    plain_text += size * <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> plain_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myenc</span>(<span class="params">plain_text</span>):</span></span><br><span class="line">    plain_text = pad(plain_text)</span><br><span class="line">    cipher_text = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(plain_text), <span class="number">16</span>):</span><br><span class="line">        block = plain_text[i:i + <span class="number">16</span>]</span><br><span class="line">        block_enc = enc(block).rjust(<span class="number">16</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">        cipher_text += block_enc</span><br><span class="line">    <span class="keyword">return</span> cipher_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc2</span>(<span class="params">plain_text, key</span>):</span></span><br><span class="line">    sub_keys = gen_key(key)</span><br><span class="line">    cipher_text = encrypt(plain_text, sub_keys)</span><br><span class="line">    <span class="keyword">return</span> cipher_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key_64 = os.urandom(<span class="number">8</span>).<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line">teststring = <span class="string">&quot;testtest&quot;</span></span><br><span class="line"><span class="built_in">print</span>(enc2(teststring.encode().<span class="built_in">hex</span>(), key_64))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag: &quot;</span>, myenc(flag.encode().<span class="built_in">hex</span>()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 77a35598c47aeea6</span></span><br><span class="line"><span class="comment"># flag:  86721c7c1ebe2d0af8aa8e073073931b4a5ae6dcf03c784e3c70b5f8ce71cf9eb87f9b836eea0118</span></span><br></pre></td></tr></table></figure>

<p>My_box</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 64-&gt;56</span></span><br><span class="line">KEY_P1 = [<span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>,</span><br><span class="line">          <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">7</span>, <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>]</span><br><span class="line">round_shifts = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line"><span class="comment"># 56-&gt;48</span></span><br><span class="line">KEY_P2 = [<span class="number">14</span>, <span class="number">17</span>, <span class="number">11</span>, <span class="number">24</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">28</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">21</span>, <span class="number">10</span>, <span class="number">23</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">26</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">7</span>, <span class="number">27</span>, <span class="number">20</span>, <span class="number">13</span>, <span class="number">2</span>, <span class="number">41</span>, <span class="number">52</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">47</span>,</span><br><span class="line">          <span class="number">55</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">51</span>, <span class="number">45</span>, <span class="number">33</span>, <span class="number">48</span>, <span class="number">44</span>, <span class="number">49</span>, <span class="number">39</span>, <span class="number">56</span>, <span class="number">34</span>, <span class="number">53</span>, <span class="number">46</span>, <span class="number">42</span>, <span class="number">50</span>, <span class="number">36</span>, <span class="number">29</span>, <span class="number">32</span>]</span><br><span class="line"></span><br><span class="line">IP = [<span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">64</span>, <span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>,</span><br><span class="line">      <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>, <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>,</span><br><span class="line">      <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">7</span>]</span><br><span class="line">E = [<span class="number">32</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">20</span>, <span class="number">21</span>,</span><br><span class="line">     <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">S = [</span><br><span class="line">    <span class="comment"># Box-1</span></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">14</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">7</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">15</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">8</span>],</span><br><span class="line">        [<span class="number">4</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">0</span>],</span><br><span class="line">        [<span class="number">15</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">13</span>]</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># Box-2</span></span><br><span class="line"></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">15</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">10</span>],</span><br><span class="line">        [<span class="number">3</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">5</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">15</span>],</span><br><span class="line">        [<span class="number">13</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">9</span>]</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Box-3</span></span><br><span class="line"></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">10</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">8</span>],</span><br><span class="line">        [<span class="number">13</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">13</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">7</span>],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">12</span>]</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Box-4</span></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">7</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">15</span>],</span><br><span class="line">        [<span class="number">13</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">9</span>],</span><br><span class="line">        [<span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>],</span><br><span class="line">        [<span class="number">3</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">14</span>]</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Box-5</span></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">9</span>],</span><br><span class="line">        [<span class="number">14</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>],</span><br><span class="line">        [<span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">14</span>],</span><br><span class="line">        [<span class="number">11</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">3</span>]</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># Box-6</span></span><br><span class="line"></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">12</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>],</span><br><span class="line">        [<span class="number">10</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">8</span>],</span><br><span class="line">        [<span class="number">9</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">6</span>],</span><br><span class="line">        [<span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span>]</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># Box-7</span></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">4</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">13</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">6</span>],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">2</span>],</span><br><span class="line">        [<span class="number">6</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">12</span>]</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># Box-8</span></span><br><span class="line"></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">13</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">7</span>],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">9</span>, <span class="number">2</span>],</span><br><span class="line">        [<span class="number">7</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>],</span><br><span class="line">        [<span class="number">2</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>]</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line">P = [<span class="number">16</span>, <span class="number">7</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">29</span>, <span class="number">12</span>, <span class="number">28</span>, <span class="number">17</span>, <span class="number">1</span>, <span class="number">15</span>, <span class="number">23</span>, <span class="number">26</span>, <span class="number">5</span>, <span class="number">18</span>, <span class="number">31</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">24</span>, <span class="number">14</span>, <span class="number">32</span>, <span class="number">27</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">19</span>, <span class="number">13</span>, <span class="number">30</span>, <span class="number">6</span>, <span class="number">22</span>, <span class="number">11</span>, <span class="number">4</span>,</span><br><span class="line">     <span class="number">25</span>]</span><br><span class="line">Inv_P = [<span class="number">9</span>, <span class="number">17</span>, <span class="number">23</span>, <span class="number">31</span>, <span class="number">13</span>, <span class="number">28</span>, <span class="number">2</span>, <span class="number">18</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">30</span>, <span class="number">6</span>, <span class="number">26</span>, <span class="number">20</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">25</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">29</span>, <span class="number">11</span>, <span class="number">19</span>, <span class="number">32</span>, <span class="number">12</span>, <span class="number">22</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">27</span>,</span><br><span class="line">         <span class="number">15</span>, <span class="number">21</span>]</span><br><span class="line"></span><br><span class="line">Inv_IP = [<span class="number">40</span>, <span class="number">8</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">56</span>, <span class="number">24</span>, <span class="number">64</span>, <span class="number">32</span>, <span class="number">39</span>, <span class="number">7</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">55</span>, <span class="number">23</span>, <span class="number">63</span>, <span class="number">31</span>, <span class="number">38</span>, <span class="number">6</span>, <span class="number">46</span>, <span class="number">14</span>, <span class="number">54</span>, <span class="number">22</span>, <span class="number">62</span>, <span class="number">30</span>, <span class="number">37</span>, <span class="number">5</span>, <span class="number">45</span>, <span class="number">13</span>,</span><br><span class="line">          <span class="number">53</span>, <span class="number">21</span>, <span class="number">61</span>, <span class="number">29</span>, <span class="number">36</span>, <span class="number">4</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">52</span>, <span class="number">20</span>, <span class="number">60</span>, <span class="number">28</span>, <span class="number">35</span>, <span class="number">3</span>, <span class="number">43</span>, <span class="number">11</span>, <span class="number">51</span>, <span class="number">19</span>, <span class="number">59</span>, <span class="number">27</span>, <span class="number">34</span>, <span class="number">2</span>, <span class="number">42</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">18</span>, <span class="number">58</span>, <span class="number">26</span>,</span><br><span class="line">          <span class="number">33</span>, <span class="number">1</span>, <span class="number">41</span>, <span class="number">9</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">25</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inverse_table</span>(<span class="params">table</span>):</span></span><br><span class="line">    new = <span class="built_in">list</span>()</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(table)):</span><br><span class="line">        <span class="keyword">if</span> (x + <span class="number">1</span>) <span class="keyword">in</span> table:</span><br><span class="line">            num = table.index(x + <span class="number">1</span>) + <span class="number">1</span></span><br><span class="line">            new.append(num)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            new.append(x)</span><br><span class="line">    <span class="keyword">return</span> new</span><br></pre></td></tr></table></figure>

<p>听V神讲了一遍还是不懂，但看到尚师傅做出来了，燃起来了，复现的斗志</p>
<p>缩起来惭愧，虽然赛后稍微研究下了feistel和DES，但还是被<code>key_64 += &#39;&#123;0:04b&#125;&#39;.format(int(key[i], 16))</code>这句话劝退了，因为看不懂<code>&#123;0:04b&#125;</code>，觉得好复杂；还是很不应该，实在不懂，你比赛时输出来看下啊</p>
<p>后面查了下是用4位的二进制表示，1位16进制的用4位二进制表示也够了</p>
<p>所以痛定思痛，既然不懂，我尝试复现整个des流程，红色表示已知和可以直接倒推的部分，绿色表示需要爆破的地方，这下就清晰了吧</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/des.svg" alt="des"></p>
<p><em>我放的是矢量图，有兴趣指导指导的师傅可以浏览器打开链接下载下来看看（最后我发现其实没有必要画的这么详细，知道一个func就差不多了；但毕竟之前不懂吧，绕远路才是我最短的捷径）</em></p>
<p>整道题的思路就是用一组随机的key去加密了已知的<code>testtest</code>得到结果<code>77a35598c47aeea6</code>，并用相同的key去加密我们的flag；那么解题的思路也很明了了，通过已知的明密文设法得到key，然后写解密函数，最终返回到</p>
<p>先搞key1（图中的key1我随便写的），只需要关注上面那个feistel结构</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210820190413902.png" alt="image-20210820190413902"></p>
<p>有些是可以直接逆回去的部分，形如<code>inv_permutation</code>和<code>per_func</code>这两个函数，就可以这样逆回来，写的有点臭屁</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_permutation</span>(<span class="params">text</span>):</span></span><br><span class="line">    final = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> Inv_IP:</span><br><span class="line">        final += text[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> final</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">per_func</span>(<span class="params">s_output</span>):</span></span><br><span class="line">    s_final = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> P:</span><br><span class="line">        s_final += s_output[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> s_final</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">null = [<span class="string">&#x27;&#x27;</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">permutation</span>(<span class="params">plain_text</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(plain_text) == <span class="built_in">len</span>(Inv_IP)</span><br><span class="line">    final = null</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(Inv_IP)):</span><br><span class="line">        final[Inv_IP[x]-<span class="number">1</span>] = plain_text[x]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(final)</span><br></pre></td></tr></table></figure>

<p>然后本题最为关键的就是爆破这个sbox；关于sbox的工作原理，简单来说就是将48位转成32位，中间是每6位转8位，就如wiki百科上以sbox5为例，<code>011011</code>首尾是<code>01</code>，中间是<code>1101</code>，也就是对应坐标<code>1,13</code>，对应到沙盒（这个是可以查表的）就是<code>1001</code>。这样一顿操作下来，就把原来总长48位的，拆分成8个小组，每组6位变成4位，从而最后的总长度为32。显然这个过程是不可逆的</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210820204757956.png" alt="image-20210820204757956"></p>
<p>仔细观察沙盒发现一行中是<code>0~15</code>这16个数字打乱顺序，所以一个沙盒要爆破4种情况</p>
<p>写了下脚本，但感觉自己代码能力确实太差了啊，命名很成问题，最后有错误也检查不出来，后续再补</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> My_box <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">teststring = <span class="string">&quot;testtest&quot;</span></span><br><span class="line">cipher = <span class="number">0x77a35598c47aeea6</span></span><br><span class="line">final = <span class="built_in">bin</span>(cipher)[<span class="number">2</span>:].rjust(<span class="number">64</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">c = <span class="string">&#x27;86721c7c1ebe2d0af8aa8e073073931b4a5ae6dcf03c784e3c70b5f8ce71cf9eb87f9b836eea0118&#x27;</span></span><br><span class="line"></span><br><span class="line">null64 = [<span class="string">&#x27;&#x27;</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)]</span><br><span class="line">null32 = [<span class="string">&#x27;&#x27;</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_permutation</span>(<span class="params">plain_text</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(plain_text) == <span class="built_in">len</span>(Inv_IP)</span><br><span class="line">    per_final = null64</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(Inv_IP)):</span><br><span class="line">        per_final[Inv_IP[x]-<span class="number">1</span>] = plain_text[x]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(per_final)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">expand</span>(<span class="params">text</span>):</span></span><br><span class="line">    temp = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> E:</span><br><span class="line">        temp += text[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_per_func</span>(<span class="params">s_final</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(s_final) == <span class="built_in">len</span>(P)</span><br><span class="line">    s_output = null32</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(P)):</span><br><span class="line">        s_output[P[x] - <span class="number">1</span>] = s_final[x]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(s_output)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">text</span>):</span></span><br><span class="line">    exp = expand(text)</span><br><span class="line">    <span class="keyword">return</span> exp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_column</span>(<span class="params">num, index, row</span>):</span></span><br><span class="line">    <span class="keyword">for</span> find_j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        <span class="keyword">if</span> S[index][row][find_j] == num:</span><br><span class="line">            <span class="keyword">return</span> find_j</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">permutation</span>(<span class="params">plain_text</span>):</span></span><br><span class="line">    p = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> IP:</span><br><span class="line">        p += plain_text[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">plain_text</span>):</span></span><br><span class="line">    plain_textb = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> en_i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        plain_textb += <span class="string">&#x27;&#123;0:04b&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>(plain_text[en_i], <span class="number">16</span>))</span><br><span class="line">    plain_textp = permutation(plain_textb)</span><br><span class="line">    en_left, en_right = plain_textp[:<span class="number">32</span>], plain_textp[<span class="number">32</span>:]</span><br><span class="line">    out = func(en_right)</span><br><span class="line">    <span class="keyword">return</span> en_left, en_right, out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sbox</span>(<span class="params">s_input</span>):</span></span><br><span class="line">    s_out = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> sbox_i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        s_row = <span class="built_in">int</span>(s_input[<span class="number">6</span> * sbox_i] + s_input[<span class="number">6</span> * sbox_i + <span class="number">5</span>], <span class="number">2</span>)</span><br><span class="line">        s_column = <span class="built_in">int</span>(s_input[<span class="number">6</span> * sbox_i + <span class="number">1</span>:<span class="number">6</span> * sbox_i + <span class="number">5</span>], <span class="number">2</span>)</span><br><span class="line">        s_out += <span class="string">&#x27;&#123;0:04b&#125;&#x27;</span>.<span class="built_in">format</span>(S[sbox_i][s_row][s_column])</span><br><span class="line">    <span class="keyword">return</span> s_out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">per_func</span>(<span class="params">s_output</span>):</span></span><br><span class="line">    s_final = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> P:</span><br><span class="line">        s_final += s_output[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> s_final</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_permutation</span>(<span class="params">cipher_text</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(cipher_text) == <span class="built_in">len</span>(IP)</span><br><span class="line">    p = null64</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(IP)):</span><br><span class="line">        p[IP[x] - <span class="number">1</span>] = cipher_text[x]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">cipher_text, d_sub_keys</span>):</span></span><br><span class="line">    d_final = <span class="built_in">bin</span>(<span class="built_in">int</span>(cipher_text, <span class="number">16</span>))[<span class="number">2</span>:].rjust(<span class="number">64</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    d_final = my_permutation(d_final)</span><br><span class="line">    d_left, d_right = d_final[:<span class="number">32</span>], d_final[<span class="number">32</span>:]</span><br><span class="line">    <span class="comment"># RIGHT</span></span><br><span class="line">    d_EXP = func(d_left)</span><br><span class="line">    <span class="comment"># inv_func</span></span><br><span class="line">    d_s_input = <span class="string">&#x27;&#123;0:048b&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>(d_EXP, <span class="number">2</span>) ^ <span class="built_in">int</span>(d_sub_keys[<span class="number">1</span>], <span class="number">2</span>))</span><br><span class="line">    d_s_out = sbox(d_s_input)</span><br><span class="line">    out = per_func(d_s_out)</span><br><span class="line"></span><br><span class="line">    d_RIGHT = <span class="built_in">bin</span>(<span class="built_in">int</span>(out, <span class="number">2</span>) ^ <span class="built_in">int</span>(d_right, <span class="number">2</span>))[<span class="number">2</span>:].rjust(<span class="number">32</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># LEFT</span></span><br><span class="line">    d_EXP = func(d_RIGHT)</span><br><span class="line">    d_s_input = <span class="string">&#x27;&#123;0:048b&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>(d_EXP, <span class="number">2</span>) ^ <span class="built_in">int</span>(d_sub_keys[<span class="number">0</span>], <span class="number">2</span>))</span><br><span class="line">    d_s_out = sbox(d_s_input)</span><br><span class="line">    out = per_func(d_s_out)</span><br><span class="line"></span><br><span class="line">    d_LEFT = <span class="built_in">bin</span>(<span class="built_in">int</span>(out, <span class="number">2</span>) ^ <span class="built_in">int</span>(d_left, <span class="number">2</span>))[<span class="number">2</span>:].rjust(<span class="number">32</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    plaintext = d_LEFT + d_RIGHT</span><br><span class="line">    plaintext = inv_permutation(plaintext)</span><br><span class="line">    plaintext = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">hex</span>(<span class="built_in">int</span>(plaintext[_:_+<span class="number">4</span>], <span class="number">2</span>))[<span class="number">2</span>:] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(plaintext), <span class="number">4</span>))</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_rjust</span>(<span class="params">cipher_text</span>):</span></span><br><span class="line">    <span class="keyword">for</span> rjust_i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher_text)):</span><br><span class="line">        <span class="keyword">if</span> cipher_text[rjust_i] != <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> cipher_text[rjust_i:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_pad</span>(<span class="params">cipher_text</span>):</span></span><br><span class="line">    <span class="keyword">for</span> pad_i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher_text)-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> cipher_text[pad_i] != <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> cipher_text[:pad_i]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mydec</span>(<span class="params">ciphertext, d_sub_keys</span>):</span></span><br><span class="line">    plaintext = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> de_i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(ciphertext), <span class="number">16</span>):</span><br><span class="line">        block_enc = inv_rjust(ciphertext[de_i:de_i + <span class="number">16</span>])</span><br><span class="line">        block = decrypt(block_enc, d_sub_keys)</span><br><span class="line">        plaintext += block</span><br><span class="line">    plaintext = inv_pad(plaintext)</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">LEFT, RIGHT, EXP1 = encrypt(teststring.encode().<span class="built_in">hex</span>())</span><br><span class="line">final = my_permutation(final)</span><br><span class="line">left, right = final[:<span class="number">32</span>], final[<span class="number">32</span>:]</span><br><span class="line">EXP2 = func(left)</span><br><span class="line"></span><br><span class="line"><span class="comment"># key1</span></span><br><span class="line">f_final1 = <span class="built_in">bin</span>(<span class="built_in">int</span>(left, <span class="number">2</span>) ^ <span class="built_in">int</span>(LEFT, <span class="number">2</span>))[<span class="number">2</span>:].rjust(<span class="number">32</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"><span class="comment"># inv_func</span></span><br><span class="line">s_out1 = inv_per_func(f_final1)</span><br><span class="line"><span class="comment"># inv_sbox</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65536</span>):</span><br><span class="line">    bin_i = <span class="built_in">bin</span>(i)[<span class="number">2</span>:].rjust(<span class="number">16</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    a1 = [<span class="built_in">int</span>(bin_i[_]+bin_i[_+<span class="number">1</span>], <span class="number">2</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(bin_i), <span class="number">2</span>)]</span><br><span class="line">    <span class="comment"># j&#x27;s sbox</span></span><br><span class="line">    j1 = <span class="number">0</span></span><br><span class="line">    <span class="comment"># i&#x27;s row</span></span><br><span class="line">    s_input1 = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i1 <span class="keyword">in</span> a1:</span><br><span class="line">        t1 = <span class="built_in">int</span>(s_out1[i1 * <span class="number">4</span>:i1 * <span class="number">4</span> + <span class="number">4</span>], <span class="number">2</span>)</span><br><span class="line">        column1 = find_column(t1, j1, i1)</span><br><span class="line">        j1 += <span class="number">1</span></span><br><span class="line">        s_input1 += <span class="built_in">bin</span>(i1)[<span class="number">2</span>:].rjust(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>)[<span class="number">0</span>] + <span class="built_in">bin</span>(column1)[<span class="number">2</span>:].rjust(<span class="number">4</span>, <span class="string">&#x27;0&#x27;</span>) + <span class="built_in">bin</span>(i1)[<span class="number">2</span>:].rjust(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">    key1 = <span class="built_in">bin</span>(<span class="built_in">int</span>(s_input1, <span class="number">2</span>) ^ <span class="built_in">int</span>(EXP1, <span class="number">2</span>))[<span class="number">2</span>:].rjust(<span class="number">48</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    <span class="comment"># key2</span></span><br><span class="line">    f_final2 = <span class="built_in">bin</span>(<span class="built_in">int</span>(right, <span class="number">2</span>) ^ <span class="built_in">int</span>(RIGHT, <span class="number">2</span>))[<span class="number">2</span>:].rjust(<span class="number">32</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    s_out2 = inv_per_func(f_final2)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65536</span>):</span><br><span class="line">        bin_j = <span class="built_in">bin</span>(j)[<span class="number">2</span>:].rjust(<span class="number">16</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">        a2 = [<span class="built_in">int</span>(bin_j[_] + bin_j[_ + <span class="number">1</span>], <span class="number">2</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(bin_j), <span class="number">2</span>)]</span><br><span class="line">        j2 = <span class="number">0</span></span><br><span class="line">        s_input2 = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i2 <span class="keyword">in</span> a2:</span><br><span class="line">            t2 = <span class="built_in">int</span>(s_out2[j2 * <span class="number">4</span>:j2 * <span class="number">4</span> + <span class="number">4</span>], <span class="number">2</span>)</span><br><span class="line">            column2 = find_column(t2, j2, i2)</span><br><span class="line">            j2 += <span class="number">1</span></span><br><span class="line">            s_input2 += <span class="built_in">bin</span>(i2)[<span class="number">2</span>:].rjust(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>)[<span class="number">0</span>] + <span class="built_in">bin</span>(column2)[<span class="number">2</span>:].rjust(<span class="number">4</span>, <span class="string">&#x27;0&#x27;</span>) + <span class="built_in">bin</span>(i2)[<span class="number">2</span>:].rjust(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">        key2 = <span class="built_in">bin</span>(<span class="built_in">int</span>(s_input2, <span class="number">2</span>) ^ <span class="built_in">int</span>(EXP2, <span class="number">2</span>))[<span class="number">2</span>:].rjust(<span class="number">48</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">        sub_keys = [key1, key2]</span><br><span class="line">        flag = long_to_bytes(<span class="built_in">int</span>(mydec(c, sub_keys), <span class="number">16</span>))</span><br><span class="line">        <span class="built_in">print</span>(i, i*j)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            sys.exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Misc-red-vs-blue"><a href="#Misc-red-vs-blue" class="headerlink" title="Misc-red_vs_blue"></a>Misc-red_vs_blue</h3><p>经典红蓝对决，Misc的签到题，但是说实话，我有点麻</p>
<p>给了一个nc，连上玩一下就知道是两种情况让你猜，连续猜对66次得flag，每次连nc输赢的结果不同</p>
<p>这是当时我的脚本，我自以为没什么问题的吧，但是交互的情况让我几度咯血，各种IO错乱</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rest</span>():</span></span><br><span class="line">    <span class="comment"># not so fast</span></span><br><span class="line">    time.sleep(<span class="number">.05</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">res = []</span><br><span class="line">r = <span class="string">b&#x27;r&#x27;</span></span><br><span class="line">b = <span class="string">b&#x27;b&#x27;</span></span><br><span class="line">sh = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">28719</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># begin info</span></span><br><span class="line">sh.recv()</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="comment"># classical try red one</span></span><br><span class="line">    rest()</span><br><span class="line">    bug = sh.sendline(r)</span><br><span class="line">    feedback = sh.recv()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;Sorry&#x27;</span> <span class="keyword">in</span> feedback:</span><br><span class="line">        res.append(b)</span><br><span class="line">        sh.sendline(<span class="string">b&#x27;y&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res.append(r)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    sh.recv()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">        rest()</span><br><span class="line">        sh.sendline(i)</span><br><span class="line">        flag = sh.recv()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            sh.close()</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">len</span>(res))</span><br></pre></td></tr></table></figure>

<p>然后问了pwn爷，怎样能达到好的交互效果；最后彭总给了一个脚本，学到了，写得好规整，吾辈楷模，贴下来日后遇到再学习</p>
<p><strong>主要就是一些格式上的转换，然后还有一句话一句话接收吧</strong></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># connection</span></span><br><span class="line">p = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">28719</span>)</span><br><span class="line"><span class="comment"># receive intro text</span></span><br><span class="line">p.recvline()  <span class="comment"># Here are 66 AWD Games will begin!</span></span><br><span class="line">p.recvline()  <span class="comment"># The winner is between Red Team and Blue Team</span></span><br><span class="line">p.recvline()  <span class="comment"># To get the flag if you predict the results of all games successfully!</span></span><br><span class="line">p.recvline()  <span class="comment"># Game 1</span></span><br><span class="line">p.recvline()  <span class="comment"># choose one [r] Red Team,[b] Blue Team:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># record the results</span></span><br><span class="line">s = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">    p.sendline(<span class="built_in">bytes</span>(<span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;r&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(p.recvline().decode(), end=<span class="string">&quot;&quot;</span>)  <span class="comment"># Your choice xxx Team</span></span><br><span class="line">    <span class="built_in">print</span>(p.recvline().decode(), end=<span class="string">&quot;&quot;</span>)  <span class="comment"># The result xxx Team</span></span><br><span class="line">    <span class="comment"># win: The number of successful predictions xx</span></span><br><span class="line">    <span class="comment"># lose: Sorry!You are wrong!</span></span><br><span class="line">    result = p.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="comment"># print(result.find(&quot;successful&quot;))</span></span><br><span class="line">    <span class="keyword">if</span> result.find(<span class="string">&quot;successful&quot;</span>) != -<span class="number">1</span>:</span><br><span class="line">        <span class="comment"># print(&quot;continue..&quot;)</span></span><br><span class="line">        s += <span class="string">&quot;r&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(p.recvline().decode(), end=<span class="string">&quot;&quot;</span>)  <span class="comment"># Game x</span></span><br><span class="line">        p.recvline()  <span class="comment"># choose one [r] Red Team,[b] Blue Team:</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> result.find(<span class="string">&quot;wrong&quot;</span>) != -<span class="number">1</span>:</span><br><span class="line">        <span class="comment"># print(&quot;retry..&quot;)</span></span><br><span class="line">        s += <span class="string">&quot;b&quot;</span></span><br><span class="line">        p.sendline(<span class="built_in">bytes</span>(<span class="string">&quot;y&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">        <span class="built_in">print</span>(p.recvline().decode(), end=<span class="string">&quot;&quot;</span>)  <span class="comment"># Play again? (y/n):Game 1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;y&quot;</span>)</span><br><span class="line">        <span class="comment"># repeat</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">            <span class="comment"># print(p.recvline().decode(),end=&quot;&quot;)# Game x</span></span><br><span class="line">            p.recvline()</span><br><span class="line">            <span class="comment"># print(p.recvline().decode(),end=&quot;&quot;)# choose one [r] Red Team,[b] Blue Team:</span></span><br><span class="line">            p.sendline(<span class="built_in">bytes</span>(s[i], encoding=<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">            <span class="built_in">print</span>(s[i])</span><br><span class="line">            p.recvline()  <span class="comment"># Your choice xxx Team</span></span><br><span class="line">            p.recvline()  <span class="comment"># The result xxx Team</span></span><br><span class="line">            p.recvline()  <span class="comment"># win: The number of successful predictions xx</span></span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(p.recvline().decode(), end=<span class="string">&quot;&quot;</span>)  <span class="comment"># Game x</span></span><br><span class="line">        <span class="built_in">print</span>(p.recvline().decode(), end=<span class="string">&quot;&quot;</span>)  <span class="comment"># choose one [r] Red Team,[b] Blue Team:</span></span><br></pre></td></tr></table></figure>

<h2 id="极客巅峰"><a href="#极客巅峰" class="headerlink" title="极客巅峰"></a>极客巅峰</h2><h3 id="Crypto-crtrsa"><a href="#Crypto-crtrsa" class="headerlink" title="Crypto-crtrsa"></a>Crypto-crtrsa</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flagn,p,q</span><br><span class="line"><span class="comment">#p and q are two primes generated by getPrime</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">key_gen</span>():</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		dp = random.randint(<span class="number">1</span>,<span class="number">1</span>&lt;&lt;<span class="number">20</span>)</span><br><span class="line">		dq = random.randint(<span class="number">1</span>,q-<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">if</span> gcd(dp, p - <span class="number">1</span>) == <span class="number">1</span> <span class="keyword">and</span> gcd(dq, q - <span class="number">1</span>) == <span class="number">1</span>:</span><br><span class="line">			d = crt([dp,dq],[p-<span class="number">1</span>,q-<span class="number">1</span>])</span><br><span class="line">			phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">			R = Integers(phi)</span><br><span class="line">			e = R(d)^-<span class="number">1</span></span><br><span class="line">			<span class="keyword">return</span> p*q,e</span><br><span class="line">n,e = key_gen()</span><br><span class="line"><span class="built_in">print</span>(e)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(flagn,<span class="built_in">int</span>(e),n))</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">e = 2953544268002866703872076551930953722572317122777861299293407053391808199220655289235983088986372630141821049118015752017412642148934113723174855236142887</span><br><span class="line">N = 6006128121276172470274143101473619963750725942458450119252491144009018469845917986523007748831362674341219814935241703026024431390531323127620970750816983</span><br><span class="line">flag = 4082777468662493175049853412968913980472986215497247773911290709560282223053863513029985115855416847643274608394467813391117463817805000754191093158289399</span><br></pre></td></tr></table></figure>

<p>e很大，但是显然d也很大，所以那俩家伙都不行；从已知看，像dp泄漏，但e太大，枚举不了；最后看到<a target="_blank" rel="noopener" href="https://0xdktb.top/2020/02/28/Summary-of-Crypto-in-CTF-RSA/">一位师傅博客</a>上记录着RSA - Small CRT Private Exponents，可惜师傅没有给exp；然后也找到相关的论文，满大街都是，可惜看不懂；然后还是在github上找到了实现，就是来自密码狗狗手一个的RsaCtfTool中的一个工具small_crt_exp，贴下链接<a target="_blank" rel="noopener" href="https://github.com/Ganapati/RsaCtfTool">https://github.com/Ganapati/RsaCtfTool</a>，但是没太弄懂怎么使用命令行，直接拿源码了，拼凑下，完整的exp是</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br><span class="line">238</span><br><span class="line">239</span><br><span class="line">240</span><br><span class="line">241</span><br><span class="line">242</span><br><span class="line">243</span><br><span class="line">244</span><br><span class="line">245</span><br><span class="line">246</span><br><span class="line">247</span><br><span class="line">248</span><br><span class="line">249</span><br><span class="line">250</span><br><span class="line">251</span><br><span class="line">252</span><br><span class="line">253</span><br><span class="line">254</span><br><span class="line">255</span><br><span class="line">256</span><br><span class="line">257</span><br><span class="line">258</span><br><span class="line">259</span><br><span class="line">260</span><br><span class="line">261</span><br><span class="line">262</span><br><span class="line">263</span><br><span class="line">264</span><br><span class="line">265</span><br><span class="line">266</span><br><span class="line">267</span><br><span class="line">268</span><br><span class="line">269</span><br><span class="line">270</span><br><span class="line">271</span><br><span class="line">272</span><br><span class="line">273</span><br><span class="line">274</span><br><span class="line">275</span><br><span class="line">276</span><br><span class="line">277</span><br><span class="line">278</span><br><span class="line">279</span><br><span class="line">280</span><br><span class="line">281</span><br><span class="line">282</span><br><span class="line">283</span><br><span class="line">284</span><br><span class="line">285</span><br><span class="line">286</span><br><span class="line">287</span><br><span class="line">288</span><br><span class="line">289</span><br><span class="line">290</span><br><span class="line">291</span><br><span class="line">292</span><br><span class="line">293</span><br><span class="line">294</span><br><span class="line">295</span><br><span class="line">296</span><br><span class="line">297</span><br><span class="line">298</span><br><span class="line">299</span><br><span class="line">300</span><br><span class="line">301</span><br><span class="line">302</span><br><span class="line">303</span><br><span class="line">304</span><br><span class="line">305</span><br><span class="line">306</span><br><span class="line">307</span><br><span class="line">308</span><br><span class="line">309</span><br><span class="line">310</span><br><span class="line">311</span><br><span class="line">312</span><br><span class="line">313</span><br><span class="line">314</span><br><span class="line">315</span><br><span class="line">316</span><br><span class="line">317</span><br><span class="line">318</span><br><span class="line">319</span><br><span class="line">320</span><br><span class="line">321</span><br><span class="line">322</span><br><span class="line">323</span><br><span class="line">324</span><br><span class="line">325</span><br><span class="line">326</span><br><span class="line">327</span><br><span class="line">328</span><br><span class="line">329</span><br><span class="line">330</span><br><span class="line">331</span><br><span class="line">332</span><br><span class="line">333</span><br><span class="line">334</span><br><span class="line">335</span><br><span class="line">336</span><br><span class="line">337</span><br><span class="line">338</span><br><span class="line">339</span><br><span class="line">340</span><br><span class="line">341</span><br><span class="line">342</span><br><span class="line">343</span><br><span class="line">344</span><br><span class="line">345</span><br><span class="line">346</span><br><span class="line">347</span><br><span class="line">348</span><br><span class="line">349</span><br><span class="line">350</span><br><span class="line">351</span><br><span class="line">352</span><br><span class="line">353</span><br><span class="line">354</span><br><span class="line">355</span><br><span class="line">356</span><br><span class="line">357</span><br><span class="line">358</span><br><span class="line">359</span><br><span class="line">360</span><br><span class="line">361</span><br><span class="line">362</span><br><span class="line">363</span><br><span class="line">364</span><br><span class="line">365</span><br><span class="line">366</span><br><span class="line">367</span><br><span class="line">368</span><br><span class="line">369</span><br><span class="line">370</span><br><span class="line">371</span><br><span class="line">372</span><br><span class="line">373</span><br><span class="line">374</span><br><span class="line">375</span><br><span class="line">376</span><br><span class="line">377</span><br><span class="line">378</span><br><span class="line">379</span><br><span class="line">380</span><br><span class="line">381</span><br><span class="line">382</span><br><span class="line">383</span><br><span class="line">384</span><br><span class="line">385</span><br><span class="line">386</span><br><span class="line">387</span><br><span class="line">388</span><br><span class="line">389</span><br><span class="line">390</span><br><span class="line">391</span><br><span class="line">392</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> sage.libs.ntl.ntl_ZZ_pX <span class="keyword">import</span> ntl_ZZ_pContext, ntl_ZZ_pX</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(<span class="string">&quot;global_logger&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gmpy</span><br><span class="line"></span><br><span class="line">    gmpy_version = <span class="number">2</span></span><br><span class="line">    mpz = gmpy.mpz</span><br><span class="line">    logger.info(<span class="string">&quot;[+] Using gmpy version 2 for math.&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">import</span> gmpy</span><br><span class="line"></span><br><span class="line">        gmpy_version = <span class="number">1</span></span><br><span class="line">        mpz = gmpy.mpz</span><br><span class="line">        logger.info(<span class="string">&quot;[+] Using gmpy version 1 for math.&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> ImportError:</span><br><span class="line">        gmpy_version = <span class="number">0</span></span><br><span class="line">        mpz = <span class="built_in">int</span></span><br><span class="line">        gmpy = <span class="literal">None</span></span><br><span class="line">        logger.info(<span class="string">&quot;[+] Using python native functions for math.&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getpubkeysz</span>(<span class="params">n</span>):</span></span><br><span class="line">    size = <span class="built_in">int</span>(math.log2(n))</span><br><span class="line">    <span class="keyword">if</span> size &amp; <span class="number">1</span> != <span class="number">0</span>:</span><br><span class="line">        size += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> size</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_gcdext</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> [b, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        d = b // a</span><br><span class="line">        r = b - (d * a)</span><br><span class="line">        g, y, x = _gcdext(r, a)</span><br><span class="line">        <span class="keyword">return</span> [g, x - d * y, y]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_isqrt</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    x, y = n, (n + <span class="number">1</span>) &gt;&gt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> y &lt; x:</span><br><span class="line">        x, y = y, (y + n // y) &gt;&gt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_gcd</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        a, b = b, a % b</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">abs</span>(a)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_introot</span>(<span class="params">n, r=<span class="number">2</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span> <span class="keyword">if</span> r &amp; <span class="number">1</span> == <span class="number">0</span> <span class="keyword">else</span> -_introot(-n, r)</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    <span class="keyword">if</span> r == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> _isqrt(n)</span><br><span class="line">    lower, upper = <span class="number">0</span>, n</span><br><span class="line">    <span class="keyword">while</span> lower != upper - <span class="number">1</span>:</span><br><span class="line">        mid = (lower + upper) &gt;&gt; <span class="number">1</span></span><br><span class="line">        m = <span class="built_in">pow</span>(mid, r)</span><br><span class="line">        <span class="keyword">if</span> m == n:</span><br><span class="line">            <span class="keyword">return</span> mid</span><br><span class="line">        <span class="keyword">elif</span> m &lt; n:</span><br><span class="line">            lower = mid</span><br><span class="line">        <span class="keyword">elif</span> m &gt; n:</span><br><span class="line">            upper = mid</span><br><span class="line">    <span class="keyword">return</span> lower</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_introot_gmpy</span>(<span class="params">n, r=<span class="number">2</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span> <span class="keyword">if</span> r &amp; <span class="number">1</span> == <span class="number">0</span> <span class="keyword">else</span> -_introot_gmpy(-n, r)</span><br><span class="line">    <span class="keyword">return</span> gmpy.root(n, r)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_introot_gmpy2</span>(<span class="params">n, r=<span class="number">2</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span> <span class="keyword">if</span> r &amp; <span class="number">1</span> == <span class="number">0</span> <span class="keyword">else</span> -_introot_gmpy2(-n, r)</span><br><span class="line">    <span class="keyword">return</span> gmpy.iroot(n, r)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_invmod</span>(<span class="params">a, m</span>):</span></span><br><span class="line">    a, x, u = a % m, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> a:</span><br><span class="line">        x, u, m, a = u, x - (m // a) * u, a, m % a</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_is_square</span>(<span class="params">n</span>):</span></span><br><span class="line">    i = _isqrt(n)</span><br><span class="line">    <span class="keyword">return</span> i ** <span class="number">2</span> == n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">miller_rabin</span>(<span class="params">n, k=<span class="number">40</span></span>):</span></span><br><span class="line">    <span class="comment"># Taken from https://gist.github.com/Ayrx/5884790</span></span><br><span class="line">    <span class="comment"># Implementation uses the Miller-Rabin Primality Test</span></span><br><span class="line">    <span class="comment"># The optimal number of rounds for this test is 40</span></span><br><span class="line">    <span class="comment"># See http://stackoverflow.com/questions/6325576/how-many-iterations-of-rabin-miller-should-i-use-for-cryptographic-safe-primes</span></span><br><span class="line">    <span class="comment"># for justification</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># If number is even, it&#x27;s a composite number</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> n &amp; <span class="number">1</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    r, s = <span class="number">0</span>, n - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> s &amp; <span class="number">1</span> == <span class="number">0</span>:</span><br><span class="line">        r += <span class="number">1</span></span><br><span class="line">        s &gt;&gt;= <span class="number">1</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, k):</span><br><span class="line">        a = random.randrange(<span class="number">2</span>, n - <span class="number">1</span>)</span><br><span class="line">        x = <span class="built_in">pow</span>(a, s, n)</span><br><span class="line">        <span class="keyword">if</span> x == <span class="number">1</span> <span class="keyword">or</span> x == n - <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> j &lt;= r - <span class="number">1</span>:</span><br><span class="line">            x = <span class="built_in">pow</span>(x, <span class="number">2</span>, n)</span><br><span class="line">            <span class="keyword">if</span> x == n - <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_fermat_prime_criterion</span>(<span class="params">n, b=<span class="number">2</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Fermat&#x27;s prime criterion</span></span><br><span class="line"><span class="string">    Returns False if n is definitely composite, True if posible prime.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(b, n - <span class="number">1</span>, n) == <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_is_prime</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    If fermats prime criterion is false by short circuit we dont need to keep testing bases, so we return false for a guaranteed composite.</span></span><br><span class="line"><span class="string">    Otherwise we keep trying with primes 3 and 5 as base. The sweet spot is primes 2,3,5, it doesn&#x27;t improvee the runing time adding more primes to test as base.</span></span><br><span class="line"><span class="string">    If all the previus tests pass then we try with rabin miller.</span></span><br><span class="line"><span class="string">    All the tests are probabilistic.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        _fermat_prime_criterion(n)</span><br><span class="line">        <span class="keyword">and</span> _fermat_prime_criterion(n, b=<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">and</span> _fermat_prime_criterion(n, b=<span class="number">5</span>)</span><br><span class="line">    ):</span><br><span class="line">        <span class="keyword">return</span> miller_rabin(n)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_next_prime</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> _is_prime(n):</span><br><span class="line">            <span class="keyword">return</span> n</span><br><span class="line">        n += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">erathostenes_sieve</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Returns  a list of primes &lt; n &quot;&quot;&quot;</span></span><br><span class="line">    sieve = [<span class="literal">True</span>] * n</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, isqrt(n) + <span class="number">1</span>, <span class="number">2</span>):</span><br><span class="line">        <span class="keyword">if</span> sieve[i]:</span><br><span class="line">            sieve[<span class="built_in">pow</span>(i, <span class="number">2</span>) :: (i &lt;&lt; <span class="number">1</span>)] = [<span class="literal">False</span>] * (</span><br><span class="line">                (n - <span class="built_in">pow</span>(i, <span class="number">2</span>) - <span class="number">1</span>) // (i &lt;&lt; <span class="number">1</span>) + <span class="number">1</span></span><br><span class="line">            )</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">2</span>] + [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, n, <span class="number">2</span>) <span class="keyword">if</span> sieve[i]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_primes = erathostenes_sieve</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_primes_yield</span>(<span class="params">n</span>):</span></span><br><span class="line">    p = i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> i &lt;= n:</span><br><span class="line">        p = next_prime(p)</span><br><span class="line">        <span class="keyword">yield</span> p</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_primes_yield_gmpy</span>(<span class="params">n</span>):</span></span><br><span class="line">    p = i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> i &lt;= n:</span><br><span class="line">        p = gmpy.next_prime(p)</span><br><span class="line">        <span class="keyword">yield</span> p</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_primes_gmpy</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(_primes_yield_gmpy(n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_fib</span>(<span class="params">n</span>):</span></span><br><span class="line">    a, b = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt;= n:</span><br><span class="line">        a, b = b, a + b</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_invert</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(a, b - <span class="number">2</span>, b)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_lcm</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (x * y) // _gcd(x, y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_ilog2_gmpy</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(gmpy.log2(n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_ilog_gmpy</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(gmpy.log(n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_ilog2_math</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(math.log2(n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_ilog_math</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(math.log(n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_ilog10_math</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(math.log10(n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_ilog10_gmpy</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(gmpy.log10(n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_mod</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a % b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> gmpy_version &gt; <span class="number">0</span>:</span><br><span class="line">    gcd = gmpy.gcd</span><br><span class="line">    invmod = gmpy.invert</span><br><span class="line">    gcdext = gmpy.gcdext</span><br><span class="line">    is_square = gmpy.is_square</span><br><span class="line">    next_prime = gmpy.next_prime</span><br><span class="line">    is_prime = gmpy.is_prime</span><br><span class="line">    fib = gmpy.fib</span><br><span class="line">    primes = _primes_gmpy</span><br><span class="line">    lcm = gmpy.lcm</span><br><span class="line">    invert = gmpy.invert</span><br><span class="line">    powmod = gmpy.powmod</span><br><span class="line">    ilog = _ilog_gmpy</span><br><span class="line">    ilog2 = _ilog2_gmpy</span><br><span class="line">    mod = gmpy.f_mod</span><br><span class="line">    log = gmpy.log</span><br><span class="line">    log2 = gmpy.log2</span><br><span class="line">    log10 = gmpy.log10</span><br><span class="line">    ilog10 = _ilog10_gmpy</span><br><span class="line">    <span class="keyword">if</span> gmpy_version == <span class="number">2</span>:</span><br><span class="line">        isqrt = gmpy.isqrt</span><br><span class="line">        introot = _introot_gmpy2</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        isqrt = gmpy.sqrt</span><br><span class="line">        introot = _introot_gmpy</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    gcd = _gcd</span><br><span class="line">    isqrt = _isqrt</span><br><span class="line">    introot = _introot</span><br><span class="line">    invmod = _invmod</span><br><span class="line">    gcdext = _gcdext</span><br><span class="line">    is_square = _is_square</span><br><span class="line">    next_prime = _next_prime</span><br><span class="line">    fib = _fib</span><br><span class="line">    primes = erathostenes_sieve</span><br><span class="line">    is_prime = _is_prime</span><br><span class="line">    fib = _fib</span><br><span class="line">    primes = _primes</span><br><span class="line">    lcm = _lcm</span><br><span class="line">    invert = _invmod</span><br><span class="line">    powmod = <span class="built_in">pow</span></span><br><span class="line">    ilog = _ilog_math</span><br><span class="line">    ilog2 = _ilog2_math</span><br><span class="line">    mod = _mod</span><br><span class="line">    log = math.log</span><br><span class="line">    log2 = math.log2</span><br><span class="line">    log10 = math.log10</span><br><span class="line">    ilog10 = _ilog10_math</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trivial_factorization_with_n_phi</span>(<span class="params">N, phi</span>):</span></span><br><span class="line">    m = N - phi + <span class="number">1</span></span><br><span class="line">    i = isqrt(<span class="built_in">pow</span>(m, <span class="number">2</span>) - (N &lt;&lt; <span class="number">2</span>))  <span class="comment"># same as isqrt((m**2) - (4*n))</span></span><br><span class="line">    roots = <span class="built_in">int</span>((m - i) &gt;&gt; <span class="number">1</span>), <span class="built_in">int</span>((m + i) &gt;&gt; <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> roots[<span class="number">0</span>] * roots[<span class="number">1</span>] == N:</span><br><span class="line">        <span class="keyword">return</span> roots</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">__all__ = [</span><br><span class="line">    getpubkeysz,</span><br><span class="line">    gcd,</span><br><span class="line">    isqrt,</span><br><span class="line">    introot,</span><br><span class="line">    invmod,</span><br><span class="line">    gcdext,</span><br><span class="line">    is_square,</span><br><span class="line">    next_prime,</span><br><span class="line">    is_prime,</span><br><span class="line">    fib,</span><br><span class="line">    primes,</span><br><span class="line">    lcm,</span><br><span class="line">    invert,</span><br><span class="line">    powmod,</span><br><span class="line">    ilog2,</span><br><span class="line">    ilog,</span><br><span class="line">    ilog10,</span><br><span class="line">    mod,</span><br><span class="line">    log,</span><br><span class="line">    log2,</span><br><span class="line">    log10,</span><br><span class="line">    trivial_factorization_with_n_phi,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">poly_fast_ntl</span>(<span class="params">ctx, f, xs</span>):</span></span><br><span class="line">    <span class="comment"># Fast multipoint evaulation from Modern Computer Algebra 3rd edition 10.1</span></span><br><span class="line">    n = <span class="built_in">len</span>(xs)</span><br><span class="line">    rems = [<span class="number">0</span>] * (<span class="number">4</span> * n)  <span class="comment"># segment tree max size</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_tree</span>(<span class="params">i, l, r</span>):</span></span><br><span class="line">        <span class="keyword">if</span> l + <span class="number">1</span> == r:</span><br><span class="line">            x = xs[l] <span class="keyword">if</span> l &lt; <span class="built_in">len</span>(xs) <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">            rems[i] = ntl_ZZ_pX([-x, <span class="number">1</span>], ctx)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        mid = (l + r) &gt;&gt; <span class="number">1</span></span><br><span class="line">        build_tree(i * <span class="number">2</span>, l, mid)</span><br><span class="line">        build_tree(i * <span class="number">2</span> + <span class="number">1</span>, mid, r)</span><br><span class="line">        rems[i] = rems[i * <span class="number">2</span>] * rems[i * <span class="number">2</span> + <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    build_tree(<span class="number">1</span>, <span class="number">0</span>, n)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">compute</span>(<span class="params">f, i, l, r</span>):</span></span><br><span class="line">        <span class="keyword">if</span> l + <span class="number">1</span> == r:</span><br><span class="line">            <span class="keyword">yield</span> f % rems[i]</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        mid = (l + r) &gt;&gt; <span class="number">1</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">from</span> compute(f % rems[<span class="number">2</span> * i], <span class="number">2</span> * i, l, mid)</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">from</span> compute(f % rems[<span class="number">2</span> * i + <span class="number">1</span>], <span class="number">2</span> * i + <span class="number">1</span>, mid, r)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">map</span>(<span class="keyword">lambda</span> r: Integer(r.<span class="built_in">list</span>()[<span class="number">0</span>]), compute(f, <span class="number">1</span>, <span class="number">0</span>, n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factor</span>(<span class="params">n, e, bound</span>):</span></span><br><span class="line">    <span class="comment"># https://mathoverflow.net/questions/120160/attack-on-crt-rsa</span></span><br><span class="line">    D = ceil(sqrt(bound))</span><br><span class="line">    ctx = ntl_ZZ_pContext(n)  <span class="comment"># NTL&#x27;s polynomial multiplication is much faster</span></span><br><span class="line">    x = randint(<span class="number">1</span>, n - <span class="number">1</span>)</span><br><span class="line">    xe = <span class="built_in">int</span>(powmod(x, e, n))</span><br><span class="line">    poly_factors = []</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, D):</span><br><span class="line">        poly_factors.append(ntl_ZZ_pX([-x, power_mod(xe, a, n)], ctx))</span><br><span class="line">    poly = product(poly_factors)</span><br><span class="line">    xed = <span class="built_in">int</span>(powmod(xe, D, n))</span><br><span class="line">    ys = [<span class="built_in">int</span>(powmod(xed, b, n)) <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, D)]</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> poly_fast_ntl(ctx, poly, ys):</span><br><span class="line">        p = gcd(t, n)</span><br><span class="line">        <span class="keyword">if</span> p &gt; <span class="number">1</span> <span class="keyword">and</span> p &lt; n:</span><br><span class="line">            <span class="keyword">return</span> p, n // p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    n = <span class="number">6006128121276172470274143101473619963750725942458450119252491144009018469845917986523007748831362674341219814935241703026024431390531323127620970750816983</span></span><br><span class="line">    e = <span class="number">2953544268002866703872076551930953722572317122777861299293407053391808199220655289235983088986372630141821049118015752017412642148934113723174855236142887</span></span><br><span class="line">    bound = <span class="number">2</span>**<span class="number">20</span>  <span class="comment"># upper bound of min(d_p, d_q)</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):  <span class="comment"># Retrying</span></span><br><span class="line">        r = factor(n, e, bound)</span><br><span class="line">        <span class="keyword">if</span> r <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            p, q = r</span><br><span class="line">            <span class="built_in">print</span>(p)</span><br><span class="line">            exit()</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">0</span>)  <span class="comment"># Prints 0 if failed</span></span><br></pre></td></tr></table></figure>

<p>用这个可以分解出p，后面的就不再赘述；做密码题的套路就是能知晓，能找源码</p>
<p>来自天命团队的密码师傅直接推导出来，从dp这个可以爆破点入手，求出了p，强。贴下<a target="_blank" rel="noopener" href="https://mp.weixin.qq.com/s?__biz=Mzk0NzI0NTI2OA==&mid=2247485067&idx=1&sn=23d4b9fadcdec4db76ef46d07a684cad&chksm=c3789f30f40f1626f924f2a49ed00665bc9c5edc5bdbaa4baa6eefecb97c2a745e20c8469e8a&mpshare=1&scene=23&srcid=0801l9lK8AdmMIgwadJXiRw7&sharer_sharetime=1627828345543&sharer_shareid=18ef5175242004180f2ee4dd9c244e8a#rd">天命团队</a>链接</p>
<h3 id="Crypto-MedicalImage（recuring）"><a href="#Crypto-MedicalImage（recuring）" class="headerlink" title="Crypto-MedicalImage（recuring）"></a>Crypto-MedicalImage（recuring）</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">getcontext().prec = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># It is based on logistic map in chaotic systems</span></span><br><span class="line">    <span class="comment"># The parameter r takes the largest legal value</span></span><br><span class="line">    <span class="keyword">assert</span>(x&gt;=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">assert</span>(x&lt;=<span class="number">1</span>)</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># same as f1</span></span><br><span class="line">    ...</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># same as f1</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encryptImage</span>(<span class="params">path</span>):</span></span><br><span class="line">    im = Image.<span class="built_in">open</span>(path)</span><br><span class="line">    size = im.size</span><br><span class="line">    pic  = np.array(im) </span><br><span class="line">    im.close()</span><br><span class="line">    r1 = Decimal(<span class="string">&#x27;0.478706063089473894123&#x27;</span>)</span><br><span class="line">    r2 = Decimal(<span class="string">&#x27;0.613494245341234672318&#x27;</span>)</span><br><span class="line">    r3 = Decimal(<span class="string">&#x27;0.946365754637812381837&#x27;</span>)</span><br><span class="line">    w,h = size</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">        r1 = f1(r1)</span><br><span class="line">        r2 = f2(r2)</span><br><span class="line">        r3 = f3(r3)</span><br><span class="line">    const = <span class="number">10</span>**<span class="number">14</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h):</span><br><span class="line">            x1 = <span class="built_in">int</span>(<span class="built_in">round</span>(const*r1))%w</span><br><span class="line">            y1 = <span class="built_in">int</span>(<span class="built_in">round</span>(const*r2))%h</span><br><span class="line">            r1 = f1(r1)</span><br><span class="line">            r2 = f2(r2)</span><br><span class="line">            tmp = pic[y,x]</span><br><span class="line">            pic[y,x] = pic[y1,x1]</span><br><span class="line">            pic[y1,x1] = tmp</span><br><span class="line">    p0 = random.randint(<span class="number">100</span>,<span class="number">104</span>)</span><br><span class="line">    c0 = random.randint(<span class="number">200</span>,<span class="number">204</span>)</span><br><span class="line">    config = (p0,c0)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h):</span><br><span class="line">            k = <span class="built_in">int</span>(<span class="built_in">round</span>(const*r3))%<span class="number">256</span></span><br><span class="line">            k = <span class="built_in">bin</span>(k)[<span class="number">2</span>:].ljust(<span class="number">8</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            k = <span class="built_in">int</span>(k[p0%<span class="number">8</span>:]+k[:p0%<span class="number">8</span>],<span class="number">2</span>)</span><br><span class="line">            r3 = f3(r3)</span><br><span class="line">            p0 = pic[y,x]</span><br><span class="line">            c0 = k^((k+p0)%<span class="number">256</span>)^c0</span><br><span class="line">            pic[y,x] = c0</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pic,size,config</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outputImage</span>(<span class="params">path,pic,size</span>):</span></span><br><span class="line">    im = Image.new(<span class="string">&#x27;P&#x27;</span>, size,<span class="string">&#x27;white&#x27;</span>)</span><br><span class="line">    pixels = im.load()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(im.size[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(im.size[<span class="number">1</span>]):</span><br><span class="line">            pixels[i,j] = (<span class="built_in">int</span>(pic[j][i]))</span><br><span class="line"></span><br><span class="line">    im.save(path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryptImage</span>(<span class="params">pic,size,config</span>):</span></span><br><span class="line">    .....</span><br><span class="line">    </span><br><span class="line">enc_img = <span class="string">&#x27;flag.bmp&#x27;</span></span><br><span class="line">out_im = <span class="string">&#x27;flag_enc.bmp&#x27;</span></span><br><span class="line"></span><br><span class="line">pic,size,_ = encryptImage(enc_img)</span><br><span class="line">outputImage(out_im,pic,size)</span><br></pre></td></tr></table></figure>

<p>不知道为什么没有出来，找到混淆函数，然后加密和解密很类似，最后跑了6400张图片，没有解出来，等WP；所用的脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">getcontext().prec = <span class="number">20</span></span><br><span class="line">enc_img = <span class="string">&#x27;flag.bmp&#x27;</span></span><br><span class="line">out_im = <span class="string">&#x27;flag_enc.bmp&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># It is based on logistic map in chaotic systems</span></span><br><span class="line">    <span class="comment"># The parameter r takes the largest legal value</span></span><br><span class="line">    x = <span class="number">4</span> * x * (<span class="number">1</span>-x)</span><br><span class="line">    <span class="keyword">assert</span>(x &gt;= <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">assert</span>(x &lt;= <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outputImage</span>(<span class="params">path, pic, size</span>):</span></span><br><span class="line">    im = Image.new(<span class="string">&#x27;P&#x27;</span>, size, <span class="string">&#x27;white&#x27;</span>)</span><br><span class="line">    pixels = im.load()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(im.size[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(im.size[<span class="number">1</span>]):</span><br><span class="line">            pixels[i, j] = (<span class="built_in">int</span>(pic[j][i]))</span><br><span class="line"></span><br><span class="line">    im.save(path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryptImage</span>(<span class="params">p1, config, p0x</span>):</span></span><br><span class="line">    im = Image.<span class="built_in">open</span>(out_im)</span><br><span class="line">    size = im.size</span><br><span class="line">    pic = np.array(im)</span><br><span class="line">    im.close()</span><br><span class="line">    r1 = Decimal(<span class="string">&#x27;0.478706063089473894123&#x27;</span>)</span><br><span class="line">    r2 = Decimal(<span class="string">&#x27;0.613494245341234672318&#x27;</span>)</span><br><span class="line">    r3 = Decimal(<span class="string">&#x27;0.946365754637812381837&#x27;</span>)</span><br><span class="line">    w, h = size</span><br><span class="line">    rx1 = []</span><br><span class="line">    rx2 = []</span><br><span class="line">    rx3 = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">        r1 = f1(r1)</span><br><span class="line">        r2 = f1(r2)</span><br><span class="line">        r3 = f1(r3)</span><br><span class="line">        rx1.append(r1)</span><br><span class="line">        rx2.append(r2)</span><br><span class="line">        rx3.append(r3)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            r1 = f1(r1)</span><br><span class="line">            r2 = f1(r2)</span><br><span class="line">            r3 = f1(r3)</span><br><span class="line">            rx1.append(r1)</span><br><span class="line">            rx2.append(r2)</span><br><span class="line">            rx3.append(r3)</span><br><span class="line">    const = <span class="number">10</span> ** <span class="number">14</span></span><br><span class="line">    p0, c0 = config</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            k = <span class="built_in">int</span>(<span class="built_in">round</span>(const * r3)) % <span class="number">256</span></span><br><span class="line">            k = <span class="built_in">bin</span>(k)[<span class="number">2</span>:].ljust(<span class="number">8</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            k = <span class="built_in">int</span>(k[p0 % <span class="number">8</span>:] + k[:p0 % <span class="number">8</span>], <span class="number">2</span>)</span><br><span class="line">            rx3.pop()</span><br><span class="line">            r3 = rx3[-<span class="number">1</span>]</span><br><span class="line">            p0 = p0x</span><br><span class="line">            c0 = k^((k+p0)%<span class="number">256</span>)^c0</span><br><span class="line">            pic[y, x] = c0</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            x1 = <span class="built_in">int</span>(<span class="built_in">round</span>(const * r1)) % w</span><br><span class="line">            y1 = <span class="built_in">int</span>(<span class="built_in">round</span>(const * r2)) % h</span><br><span class="line">            rx1.pop()</span><br><span class="line">            rx2.pop()</span><br><span class="line">            r1 = rx1[-<span class="number">1</span>]</span><br><span class="line">            r2 = rx2[-<span class="number">1</span>]</span><br><span class="line">            tmp = pic[y, x]</span><br><span class="line">            pic[y, x] = pic[y1, x1]</span><br><span class="line">            pic[y1, x1] = tmp</span><br><span class="line">    outputImage(p1, pic, size)</span><br><span class="line"></span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> p0 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>, <span class="number">105</span>):</span><br><span class="line">    <span class="keyword">for</span> c0 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>, <span class="number">205</span>):</span><br><span class="line">        <span class="keyword">for</span> p0xx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">256</span>):</span><br><span class="line">            decryptImage(<span class="built_in">str</span>(i)+<span class="string">&#x27;.bmp&#x27;</span>, (p0, c0), p0xx)</span><br><span class="line">            i += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>看了来自天命团队的WP，还是逆算法的问题，想太简单了，以为加密即解密，稍微改一下就行</p>
<p>摆出re的态度，先cp下源码，自己重新写下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">getcontext().prec = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> (x &gt;= <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">assert</span> (x &lt;= <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span> * x * (<span class="number">1</span> - x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> (x &gt;= <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">assert</span> (x &lt;= <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span> * x * (<span class="number">1</span> - x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> (x &gt;= <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">assert</span> (x &lt;= <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span> * x * (<span class="number">1</span> - x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">im = Image.<span class="built_in">open</span>(<span class="string">&#x27;flag_enc.bmp&#x27;</span>)</span><br><span class="line">size = im.size</span><br><span class="line">pic = np.array(im)</span><br><span class="line">im.close()</span><br><span class="line">r1 = Decimal(<span class="string">&#x27;0.478706063089473894123&#x27;</span>)</span><br><span class="line">r2 = Decimal(<span class="string">&#x27;0.613494245341234672318&#x27;</span>)</span><br><span class="line">r3 = Decimal(<span class="string">&#x27;0.946365754637812381837&#x27;</span>)</span><br><span class="line">w, h = size</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">    r1 = f1(r1)</span><br><span class="line">    r2 = f2(r2)</span><br><span class="line">    r3 = f3(r3)</span><br><span class="line">const = <span class="number">10</span> ** <span class="number">14</span></span><br><span class="line">p = [<span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>, <span class="number">103</span>]</span><br><span class="line">c = [<span class="number">200</span>, <span class="number">201</span>, <span class="number">202</span>, <span class="number">203</span>]</span><br><span class="line">R1, R2, R3 = r1, r2, r3</span><br><span class="line">l1 = []</span><br><span class="line">l2 = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(w * h):</span><br><span class="line">    l1.append(r1)</span><br><span class="line">    l2.append(r2)</span><br><span class="line">    r1 = f1(r1)</span><br><span class="line">    r2 = f2(r2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">p0, c0, r1=R1, r2=R2, r3=R3</span>):</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h):</span><br><span class="line">            k = <span class="built_in">int</span>(<span class="built_in">round</span>(const * r3)) % <span class="number">256</span></span><br><span class="line">            k = <span class="built_in">bin</span>(k)[<span class="number">2</span>:].ljust(<span class="number">8</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            k = <span class="built_in">int</span>(k[p0 % <span class="number">8</span>:] + k[:p0 % <span class="number">8</span>], <span class="number">2</span>)</span><br><span class="line">            r3 = f3(r3)</span><br><span class="line">            pic[y, x] = ((pic[y, x] ^ c0 ^ k) - k) % <span class="number">256</span></span><br><span class="line">            p0 = pic[y, x]</span><br><span class="line">            c0 = k ^ ((k + p0) % <span class="number">256</span>) ^ c0</span><br><span class="line">    t = w * h - <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w - <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h - <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            x1 = <span class="built_in">int</span>(<span class="built_in">round</span>(const * l1[t])) % w</span><br><span class="line">            y1 = <span class="built_in">int</span>(<span class="built_in">round</span>(const * l2[t])) % h</span><br><span class="line">            tmp = pic[y, x]</span><br><span class="line">            pic[y, x] = pic[y1, x1]</span><br><span class="line">            pic[y1, x1] = tmp</span><br><span class="line">            t -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> pic, size</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">enc_img = <span class="string">&#x27;flag.bmp&#x27;</span></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> p0 <span class="keyword">in</span> p:</span><br><span class="line">    <span class="keyword">for</span> c0 <span class="keyword">in</span> c:</span><br><span class="line">        pic, size = decrypt(p0, c0)</span><br><span class="line">        im = Image.new(<span class="string">&#x27;P&#x27;</span>, size, <span class="string">&#x27;white&#x27;</span>)</span><br><span class="line">        pixels = im.load()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(im.size[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(im.size[<span class="number">1</span>]):</span><br><span class="line">                pixels[i, j] = (<span class="built_in">int</span>(pic[j][i]))</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        im.save(<span class="built_in">str</span>(count) + enc_img)</span><br></pre></td></tr></table></figure>

<p>好了，我开始复现惹。比赛中确实是草率了，很多点没有get到</p>
<p>好吧，我是废物，感觉都逆完了呀，但就是出不来；就瞄一眼师傅的，就一眼。emmmmm，卧槽！我怎么也想不到会死在这里</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210805191752700.png" alt="image-20210805191752700"></p>
<p>运算优先级，异或没有加括号，惹你了温，建议抄一百遍优先级表，<strong>位运算的优先级比加减要低</strong></p>
<p>顺带发现师傅只爆破了16种情况</p>
<p>然后卧法先万泉煤油宝破德碧瑶，因为我出来是25张flag</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210805192547584.png" alt="image-20210805192547584"></p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">getcontext().prec = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># It is based on logistic map in chaotic systems</span></span><br><span class="line">    <span class="comment"># The parameter r takes the largest legal value</span></span><br><span class="line">    <span class="keyword">assert</span> (x &gt;= <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">assert</span> (x &lt;= <span class="number">1</span>)</span><br><span class="line">    x = <span class="number">4</span> * x * (<span class="number">1</span> - x)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># same as f1</span></span><br><span class="line">    <span class="keyword">return</span> f1(x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># same as f1</span></span><br><span class="line">    <span class="keyword">return</span> f1(x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outputImage</span>(<span class="params">path, pic, size</span>):</span></span><br><span class="line">    im = Image.new(<span class="string">&#x27;P&#x27;</span>, size,<span class="string">&#x27;white&#x27;</span>)</span><br><span class="line">    pixels = im.load()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(im.size[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(im.size[<span class="number">1</span>]):</span><br><span class="line">            pixels[i, j] = (<span class="built_in">int</span>(pic[j][i]))</span><br><span class="line">    im.save(path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryptImage</span>(<span class="params">path, p0c0</span>):</span></span><br><span class="line">    im = Image.<span class="built_in">open</span>(in_img)</span><br><span class="line">    size = im.size</span><br><span class="line">    pic = np.array(im)</span><br><span class="line">    im.close()</span><br><span class="line">    r1 = Decimal(<span class="string">&#x27;0.478706063089473894123&#x27;</span>)</span><br><span class="line">    r2 = Decimal(<span class="string">&#x27;0.613494245341234672318&#x27;</span>)</span><br><span class="line">    r3 = Decimal(<span class="string">&#x27;0.946365754637812381837&#x27;</span>)</span><br><span class="line">    w, h = size</span><br><span class="line">    const = <span class="number">10</span> ** <span class="number">14</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">        r1 = f1(r1)</span><br><span class="line">        r2 = f2(r2)</span><br><span class="line">        r3 = f3(r3)</span><br><span class="line">    r1_list, r2_list = [], []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(w * h):</span><br><span class="line">        r1_list.append(r1)</span><br><span class="line">        r2_list.append(r2)</span><br><span class="line">        r1 = f1(r1)</span><br><span class="line">        r2 = f2(r2)</span><br><span class="line">    p0 = p0c0[<span class="number">0</span>]</span><br><span class="line">    c0 = p0c0[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h):</span><br><span class="line">            k = <span class="built_in">int</span>(<span class="built_in">round</span>(const * r3)) % <span class="number">256</span></span><br><span class="line">            k = <span class="built_in">bin</span>(k)[<span class="number">2</span>:].ljust(<span class="number">8</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            k = <span class="built_in">int</span>(k[p0 % <span class="number">8</span>:] + k[:p0 % <span class="number">8</span>], <span class="number">2</span>)</span><br><span class="line">            r3 = f3(r3)</span><br><span class="line">            pic[y, x] = ((pic[y, x] ^ c0 ^ k) - k) % <span class="number">256</span></span><br><span class="line">            c0 = k ^ ((k + pic[y, x]) % <span class="number">256</span>) ^ c0</span><br><span class="line">            p0 = pic[y, x]</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            x1 = <span class="built_in">int</span>(<span class="built_in">round</span>(const*r1_list.pop())) % w</span><br><span class="line">            y1 = <span class="built_in">int</span>(<span class="built_in">round</span>(const*r2_list.pop())) % h</span><br><span class="line">            pic[y, x], pic[y1, x1] = pic[y1, x1], pic[y, x]</span><br><span class="line">    outputImage(path, pic, size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">in_img = <span class="string">&#x27;flag_enc.bmp&#x27;</span></span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>, <span class="number">105</span>):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>, <span class="number">205</span>):</span><br><span class="line">        decryptImage(<span class="built_in">str</span>(i)+<span class="string">&#x27;.bmp&#x27;</span>, (p, c))</span><br><span class="line">        i += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="UIUCTF-2021"><a href="#UIUCTF-2021" class="headerlink" title="UIUCTF 2021"></a>UIUCTF 2021</h2><h3 id="Re-hvhpgs-synt"><a href="#Re-hvhpgs-synt" class="headerlink" title="Re-hvhpgs{synt}"></a>Re-hvhpgs{synt}</h3><p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210731121038121.png" alt="image-20210731121038121"></p>
<p>首先看到最显眼的两串字符，词频一下可以出来有含义的字符，然后发现是rot和位移，直接手撕了，输入<code>i_propose_to_consider_the_question_can_machines_think</code>就可以得到flag</p>
<h3 id="Crypto-dhke-intro"><a href="#Crypto-dhke-intro" class="headerlink" title="Crypto-dhke_intro"></a>Crypto-dhke_intro</h3><p>题目提示</p>
<blockquote>
<p>Small numbers are bad in cryptography. This is why.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="comment"># generate key</span></span><br><span class="line">gpList = [ [<span class="number">13</span>, <span class="number">19</span>], [<span class="number">7</span>, <span class="number">17</span>], [<span class="number">3</span>, <span class="number">31</span>], [<span class="number">13</span>, <span class="number">19</span>], [<span class="number">17</span>, <span class="number">23</span>], [<span class="number">2</span>, <span class="number">29</span>] ]</span><br><span class="line">g, p = random.choice(gpList)</span><br><span class="line">a = random.randint(<span class="number">1</span>, p)</span><br><span class="line">b = random.randint(<span class="number">1</span>, p)</span><br><span class="line">k = <span class="built_in">pow</span>(g, a * b, p)</span><br><span class="line">k = <span class="built_in">str</span>(k)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(&quot;Diffie-Hellman key exchange outputs&quot;)</span></span><br><span class="line"><span class="comment"># print(&quot;Public key: &quot;, g, p)</span></span><br><span class="line"><span class="comment"># print(&quot;Jotaro sends: &quot;, aNum)</span></span><br><span class="line"><span class="comment"># print(&quot;Dio sends: &quot;, bNum)</span></span><br><span class="line"><span class="comment"># print()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pad key to 16 bytes (128bit)</span></span><br><span class="line">key = <span class="string">&quot;&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">padding = <span class="string">&quot;uiuctf2021uiuctf2021&quot;</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">16</span> - <span class="built_in">len</span>(key) != <span class="built_in">len</span>(k)):</span><br><span class="line">    key = key + padding[i]</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">key = key + k</span><br><span class="line">key = <span class="built_in">bytes</span>(key, encoding=<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read()</span><br><span class="line"></span><br><span class="line">iv = <span class="built_in">bytes</span>(<span class="string">&quot;kono DIO daaaaaa&quot;</span>, encoding = <span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line">cipher = AES.new(key, AES.MODE_CFB, iv)</span><br><span class="line">ciphertext = cipher.encrypt(flag)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(ciphertext.<span class="built_in">hex</span>())</span><br></pre></td></tr></table></figure>

<p>看提示是要Diffie–Hellman密钥交换，但都可以爆破，注意下hex编码。抓住一名jo厨师傅</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> unhexlify</span><br><span class="line"></span><br><span class="line">ciphertext = <span class="string">&#x27;b31699d587f7daf8f6b23b30cfee0edca5d6a3594cd53e1646b9e72de6fc44fe7ad40f0ea6&#x27;</span></span><br><span class="line">gpList = [[<span class="number">13</span>, <span class="number">19</span>], [<span class="number">7</span>, <span class="number">17</span>], [<span class="number">3</span>, <span class="number">31</span>], [<span class="number">13</span>, <span class="number">19</span>], [<span class="number">17</span>, <span class="number">23</span>], [<span class="number">2</span>, <span class="number">29</span>]]</span><br><span class="line">iv = <span class="built_in">bytes</span>(<span class="string">&quot;kono DIO daaaaaa&quot;</span>, encoding=<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> g, p <span class="keyword">in</span> gpList:</span><br><span class="line">	<span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, p+<span class="number">1</span>):</span><br><span class="line">		<span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, p+<span class="number">1</span>):</span><br><span class="line">			k = <span class="built_in">str</span>(<span class="built_in">pow</span>(g, a * b, p))</span><br><span class="line">			key = <span class="string">&#x27;&#x27;</span></span><br><span class="line">			i = <span class="number">0</span></span><br><span class="line">			padding = <span class="string">&#x27;uiuctf2021uiuctf2021&#x27;</span></span><br><span class="line">			<span class="keyword">while</span> <span class="number">16</span> - <span class="built_in">len</span>(key) != <span class="built_in">len</span>(k):</span><br><span class="line">				key = key + padding[i]</span><br><span class="line">				i += <span class="number">1</span></span><br><span class="line">			key = key + k</span><br><span class="line">			key = <span class="built_in">bytes</span>(key, encoding=<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line">			cipher = AES.new(key, AES.MODE_CFB, iv)</span><br><span class="line">			flag = cipher.decrypt(unhexlify(ciphertext))</span><br><span class="line">			<span class="keyword">if</span> flag.startswith(<span class="string">b&#x27;uiuctf&#x27;</span>):</span><br><span class="line">				<span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h3 id="Crypto-back-to-basics"><a href="#Crypto-back-to-basics" class="headerlink" title="Crypto-back_to_basics"></a>Crypto-back_to_basics</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> mpz, to_binary</span><br><span class="line"><span class="comment">#from secret import flag, key</span></span><br><span class="line"></span><br><span class="line">ALPHABET = <span class="built_in">bytearray</span>(<span class="string">b&quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ#&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">base_n_encode</span>(<span class="params">bytes_in, base</span>):</span></span><br><span class="line">	<span class="keyword">return</span> mpz(bytes_to_long(bytes_in)).digits(base).upper().encode()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">base_n_decode</span>(<span class="params">bytes_in, base</span>):</span></span><br><span class="line">	bytes_out = to_binary(mpz(bytes_in, base=base))[:<span class="number">1</span>:-<span class="number">1</span>]</span><br><span class="line">	<span class="keyword">return</span> bytes_out</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">bytes_in, key</span>):</span></span><br><span class="line">	out = bytes_in</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> key:</span><br><span class="line">		<span class="built_in">print</span>(i)</span><br><span class="line">		out = base_n_encode(out, ALPHABET.index(i))</span><br><span class="line">	<span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">bytes_in, key</span>):</span></span><br><span class="line">	out = bytes_in</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> key:</span><br><span class="line">		out = base_n_decode(out, ALPHABET.index(i))</span><br><span class="line">	<span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">flag_enc = encrypt(flag, key)</span></span><br><span class="line"><span class="string">f = open(&quot;flag_enc&quot;, &quot;wb&quot;)</span></span><br><span class="line"><span class="string">f.write(flag_enc)</span></span><br><span class="line"><span class="string">f.close()</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>当然还有一个flag_enc文件，word太大了，你要忍一下~</p>
<p>挺有意思的题目，还是尚师傅点醒我的，就是2~36进制的转换，关键函数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">base_n_decode</span>(<span class="params">bytes_in, base</span>):</span></span><br><span class="line">	bytes_out = long_to_bytes(<span class="built_in">int</span>(bytes_in, base=base))</span><br><span class="line">	<span class="keyword">return</span> bytes_out</span><br></pre></td></tr></table></figure>

<p>不得不说，python的int还是挺完善的</p>
<p>然后没有写一次性脚本了，手撕的，因为有些比如key的最后一位是W进制，但是U和V也没在密文里出现，脚本不够完善吧</p>
<h3 id="Crypto-dhke-adventure"><a href="#Crypto-dhke-adventure" class="headerlink" title="Crypto-dhke_adventure"></a>Crypto-dhke_adventure</h3><p>又是jo厨师傅出的题，很明显的离散对数系统的密码题，因为hint有smoother，可以想到是解离散对数的光滑数问题</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;I&#x27;m too lazy to find parameters for my DHKE, choose for me.&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Enter prime at least 1024 at most 2048 bits: &quot;</span>)</span><br><span class="line"><span class="comment"># get user&#x27;s choice of p</span></span><br><span class="line">p = <span class="built_in">input</span>()</span><br><span class="line">p = <span class="built_in">int</span>(p)</span><br><span class="line"><span class="comment"># check prime valid</span></span><br><span class="line"><span class="keyword">if</span> p.bit_length() &lt; <span class="number">1024</span> <span class="keyword">or</span> p.bit_length() &gt; <span class="number">2048</span> <span class="keyword">or</span> <span class="keyword">not</span> isPrime(p):</span><br><span class="line">    exit(<span class="string">&quot;Invalid input.&quot;</span>)</span><br><span class="line"><span class="comment"># prepare for key exchange</span></span><br><span class="line">g = <span class="number">2</span></span><br><span class="line">a = randint(<span class="number">2</span>,p-<span class="number">1</span>)</span><br><span class="line">b = randint(<span class="number">2</span>,p-<span class="number">1</span>)</span><br><span class="line"><span class="comment"># generate key</span></span><br><span class="line">dio = <span class="built_in">pow</span>(g,a,p)</span><br><span class="line">jotaro = <span class="built_in">pow</span>(g,b,p)</span><br><span class="line">key = <span class="built_in">pow</span>(dio,b,p)</span><br><span class="line">key = sha256(<span class="built_in">str</span>(key).encode()).digest()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read()</span><br><span class="line"></span><br><span class="line">iv = <span class="string">b&#x27;uiuctf2021uiuctf&#x27;</span></span><br><span class="line">cipher = AES.new(key, AES.MODE_CFB, iv)</span><br><span class="line">ciphertext = cipher.encrypt(flag)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Dio sends: &quot;</span>, dio)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Jotaro sends: &quot;</span>, jotaro)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Ciphertext: &quot;</span>, ciphertext.<span class="built_in">hex</span>())</span><br></pre></td></tr></table></figure>

<p>已知</p>
<p>$dio=g^a\ mod\ p$</p>
<p>$jotaro=g^b\ mod\ p$</p>
<p>$key=dio^b\ mod\ p$</p>
<p>解题的关键是p可以由攻击者提供的，那直接提供一个光滑数+1好了，这样这个DLP离散对数求解的难题就变得可计算了，具体的推导参考pohlig-hellman攻击原理，有能力可以复现</p>
<p>一些小的点，这里直接上脚本了，首先生成一个光滑数</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">item = <span class="number">2</span></span><br><span class="line">p = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    p *= item</span><br><span class="line">    item = next_prime(item)</span><br><span class="line">    <span class="keyword">if</span> <span class="number">1024</span> &lt; p.bit_length() &lt; <span class="number">2048</span> <span class="keyword">and</span> isPrime(p + <span class="number">1</span>):</span><br><span class="line">        <span class="built_in">print</span>(p+<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>懒狗了，直接手动接收，然后在sgae里求a和b；这个之前网鼎杯青龙组的you raise me up演示过，最终的脚本如下</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> unhexlify</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line">p = <span class="number">20404068993016374194542464172774607695659797117423121913227131032339026169175929902244453757410468728842929862271605567818821685490676661985389839958622802465986881376139404138376153096103140834665563646740160279755212317501356863003638612390661668406235422311783742390510526587257026500302696834793248526734305801634165948702506367176701233298064616663553716975429048751575597150417381063934255689124486029492908966644747931</span></span><br><span class="line">a = <span class="number">1706514538409217609380184471483970486111601581179909732547081795755601848099714892783660477820125268651686071436129197042742970850298506167342840465201954449860957095450958345421698689291401652404764413822088773220645950460091121901749681603487210460064157239812734204314334694247020508700704643391774792654182943517813353983667531492481271292815208332729128642069655591289999915464139472699283049217926350224615448461688066</span></span><br><span class="line">b = <span class="number">14466632275269913037069509287532932279884213206515600538938395240468925268146374104530207395909468350257778074856758057525057561502009116834555962090895520108072724285442706303410135968614985268443945781896987070215220814783356743958044861941110284092061774699164461968593879814604175818707171934938878476262296832165434644133455246857171139473183371584687955863862012348287764247314297996868855594079156695942227229848338865</span></span><br><span class="line">dio = <span class="number">16167922424137241666246302388507094614219683075656937696624976269971219170930381539629329712953190516880647147637220034502113432117052541565403357952291692484827614380683288824529855182911429985823152492290185107775580207164746921109360997835543504066225649925051809637197356760554700827177215351020335554912004088973554778245562345835228507025035376705826984822212122075068467338353809039042992813485576139824709322511611135</span></span><br><span class="line"><span class="keyword">assert</span> dio == <span class="built_in">pow</span>(g, a, p)</span><br><span class="line"><span class="keyword">assert</span> jotaro == <span class="built_in">pow</span>(g, b, p)</span><br><span class="line">key = <span class="built_in">pow</span>(dio, b, p)</span><br><span class="line">key = sha256(<span class="built_in">str</span>(key).encode()).digest()</span><br><span class="line">jo = <span class="number">8478318935358501390014596426908185869306605857407596116840606911586830527583698320042764633027826654399751539088096707226001027141331485792640154020208368663060333097725346477808040686885134694513306486060638308544451042554707764114958622916238232491752753035945375341164707378481832386716731243612254449779955395389475168461403985894687650228947467124029857674022920610930987210652487673276585269753595356252512713370074208</span></span><br><span class="line">ciphertext = <span class="string">&#x27;f21c554f4e520e3122eb9708bd88de356b7d0d8d9728536b39d22b706afcdaecd7bed753666a763f8c0d&#x27;</span></span><br><span class="line">iv = <span class="string">b&#x27;uiuctf2021uiuctf&#x27;</span></span><br><span class="line">cipher = AES.new(key, AES.MODE_CFB, iv)</span><br><span class="line">flag = cipher.decrypt(unhexlify(ciphertext))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>新配置的windows terminal真好看，还不会乱码，秀一下</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210805183255028.png" alt="image-20210805183255028"></p>
<h2 id="Crypto-CTF"><a href="#Crypto-CTF" class="headerlink" title="Crypto CTF"></a>Crypto CTF</h2><p>当时没来得及打就结束了，所以做出来的都会贴一下flag。谢谢主办方不关nc</p>
<p>签到就不说了</p>
<h3 id="easy"><a href="#easy" class="headerlink" title="easy"></a>easy</h3><h4 id="Farm"><a href="#Farm" class="headerlink" title="Farm"></a>Farm</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string, base64, math</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">ALPHABET = string.printable[:<span class="number">62</span>] + <span class="string">&#x27;\\=&#x27;</span></span><br><span class="line"></span><br><span class="line">F = <span class="built_in">list</span>(GF(<span class="number">64</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keygen</span>(<span class="params">l</span>):</span></span><br><span class="line">	key = [F[randint(<span class="number">1</span>, <span class="number">63</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(l)] </span><br><span class="line">	key = math.prod(key) <span class="comment"># Optimization the key length :D</span></span><br><span class="line">	<span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">maptofarm</span>(<span class="params">c</span>):</span></span><br><span class="line">	<span class="keyword">assert</span> c <span class="keyword">in</span> ALPHABET</span><br><span class="line">	<span class="keyword">return</span> F[ALPHABET.index(c)]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">msg, key</span>):</span></span><br><span class="line">	m64 = base64.b64encode(msg)</span><br><span class="line">	enc, pkey = <span class="string">&#x27;&#x27;</span>, key**<span class="number">5</span> + key**<span class="number">3</span> + key**<span class="number">2</span> + <span class="number">1</span></span><br><span class="line">	<span class="keyword">for</span> m <span class="keyword">in</span> m64:</span><br><span class="line">		enc += ALPHABET[F.index(pkey * maptofarm(<span class="built_in">chr</span>(m)))]</span><br><span class="line">	<span class="keyword">return</span> enc</span><br><span class="line"></span><br><span class="line"><span class="comment"># KEEP IT SECRET </span></span><br><span class="line">key = keygen(<span class="number">14</span>) <span class="comment"># I think 64**14 &gt; 2**64 is not brute-forcible :P</span></span><br><span class="line"></span><br><span class="line">enc = encrypt(flag, key)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;enc = <span class="subst">&#123;enc&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>本来看到是放弃的，套了好几层啊，还有GF不是有限域吗？怎么会出来多项式？？？</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210812224123276.png" alt="image-20210812224123276"></p>
<p>但现在要复现，硬着头皮做了下，没想到第一次就出来了，就是类似字典key和value的关系，关键的key爆破下就好了。本来想画下流程图的，但也就是字母表到F，F到字母表等的一些位置和值的替换，不是很好体现，鉴于是简单题，就不画了。贴下脚本</p>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">enc = <span class="string">&#x27;805c9GMYuD5RefTmabUNfS9N9YrkwbAbdZE0df91uCEytcoy9FDSbZ8Ay8jj&#x27;</span></span><br><span class="line">ALPHABET = string.printable[:<span class="number">62</span>] + <span class="string">&#x27;\\=&#x27;</span></span><br><span class="line"></span><br><span class="line">F = <span class="built_in">list</span>(GF(<span class="number">64</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> pkey <span class="keyword">in</span> F:</span><br><span class="line">    c = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> enc:</span><br><span class="line">        p1 = ALPHABET.index(i)</span><br><span class="line">        p2 = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> pkey!= <span class="number">0</span>:</span><br><span class="line">            p2 = F.index(F[p1] / pkey)</span><br><span class="line">        c += ALPHABET[p2]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(base64.b64decode(c))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>然后在64个结果中找flag</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210812224334985.png" alt="image-20210812224334985"></p>
<figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">CCTF&#123;EnCrYp7I0n_4nD_5u8STitUtIn9_iN_Fi3Ld!&#125;</span><br></pre></td></tr></table></figure>

<h4 id="KeyBase（unsolved）"><a href="#KeyBase（unsolved）" class="headerlink" title="KeyBase（unsolved）"></a>KeyBase（unsolved）</h4><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> number</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> os, sys, random</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keygen</span>():</span></span><br><span class="line">	iv, key = [os.urandom(<span class="number">16</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&#x27;01&#x27;</span>]</span><br><span class="line">	<span class="keyword">return</span> iv, key</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">msg, iv, key</span>):</span></span><br><span class="line">	aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">	<span class="keyword">return</span> aes.encrypt(msg)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">enc, iv, key</span>):</span></span><br><span class="line">	aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">	<span class="keyword">return</span> aes.decrypt(enc)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">die</span>(<span class="params">*args</span>):</span></span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pr</span>(<span class="params">*args</span>):</span></span><br><span class="line">	s = <span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sc</span>():</span></span><br><span class="line">	<span class="keyword">return</span> sys.stdin.readline().strip()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">	border = <span class="string">&quot;+&quot;</span></span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line">	pr(border, <span class="string">&quot; hi all, welcome to the simple KEYBASE cryptography task, try to    &quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot; decrypt the encrypted message and get the flag as a nice prize!    &quot;</span>, border)</span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line"></span><br><span class="line">	iv, key = keygen()</span><br><span class="line">	flag_enc = encrypt(flag, iv, key).<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		pr(<span class="string">&quot;| Options: \n|\t[G]et the encrypted flag \n|\t[T]est the encryption \n|\t[Q]uit&quot;</span>)</span><br><span class="line">		ans = sc().lower()</span><br><span class="line">		<span class="keyword">if</span> ans == <span class="string">&#x27;g&#x27;</span>:</span><br><span class="line">			pr(<span class="string">&quot;| encrypt(flag) =&quot;</span>, flag_enc)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">&#x27;t&#x27;</span>:</span><br><span class="line">			pr(<span class="string">&quot;| Please send your 32 bytes message to encrypt: &quot;</span>)</span><br><span class="line">			msg_inp = sc()</span><br><span class="line">			<span class="keyword">if</span> <span class="built_in">len</span>(msg_inp) == <span class="number">32</span>:</span><br><span class="line">				enc = encrypt(msg_inp, iv, key).<span class="built_in">hex</span>()</span><br><span class="line">				r = random.randint(<span class="number">0</span>, <span class="number">4</span>)</span><br><span class="line">				s = <span class="number">4</span> - r</span><br><span class="line">				mask_key = key[:-<span class="number">2</span>].<span class="built_in">hex</span>() + <span class="string">&#x27;*&#x27;</span> * <span class="number">4</span></span><br><span class="line">				mask_enc = enc[:r] + <span class="string">&#x27;*&#x27;</span> * <span class="number">28</span> + enc[<span class="number">32</span>-s:]</span><br><span class="line">				pr(<span class="string">&quot;| enc =&quot;</span>, mask_enc)</span><br><span class="line">				pr(<span class="string">&quot;| key =&quot;</span>, mask_key)</span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				die(<span class="string">&quot;| SEND 32 BYTES MESSAGE :X&quot;</span>)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">&#x27;q&#x27;</span>:</span><br><span class="line">			die(<span class="string">&quot;Quitting ...&quot;</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			die(<span class="string">&quot;Bye ...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>暂时还没看</p>

    </div>

    
    
    

    <footer class="post-footer">
          

<div class="post-copyright">
<ul>
  <li class="post-copyright-author">
      <strong>本文作者： </strong>4XWi11
  </li>
  <li class="post-copyright-link">
      <strong>本文链接：</strong>
      <a href="https://4xwi11.github.io/posts/fadeeed/" title="20210731 DAS 极客巅峰 UIUCTF2021 cryptoctfCrypto方向部分WP">https://4xwi11.github.io/posts/fadeeed/</a>
  </li>
  <li class="post-copyright-license">
    <strong>版权声明： </strong>本博客所有文章除特别声明外，均采用 <a href="https://creativecommons.org/licenses/by-nc-sa/4.0/zh-CN" rel="noopener" target="_blank"><i class="fab fa-fw fa-creative-commons"></i>BY-NC-SA</a> 许可协议。转载请注明出处！
  </li>
</ul>
</div>


        

          <div class="post-nav">
            <div class="post-nav-item">
                <a href="/posts/e1a0b897/" rel="prev" title="20210713 redpwnCrypto方向部分WP">
                  <i class="fa fa-chevron-left"></i> 20210713 redpwnCrypto方向部分WP
                </a>
            </div>
            <div class="post-nav-item">
                <a href="/posts/80918a4f/" rel="next" title="20210807 rar BSidesNoidaCrypto方向部分WP">
                  20210807 rar BSidesNoidaCrypto方向部分WP <i class="fa fa-chevron-right"></i>
                </a>
            </div>
          </div>
    </footer>
  </article>
</div>






    <div class="comments utterances-container"></div>
</div>
  </main>

  <footer class="footer">
    <div class="footer-inner">


<div class="copyright">
  &copy; 
  <span itemprop="copyrightYear">2021</span>
  <span class="with-love">
    <i class="fas fa-user-secret"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">4XWi11</span>
  <span id="timeDate">载入天数...</span><span id="times">载入时分秒...</span>
  <script>
      var now = new Date(); 
      function createtime() { 
          var grt= new Date("10/6/2021 14:38:00");//此处修改你的建站时间或者网站上线时间 
          now.setTime(now.getTime()+250); 
          days = (now - grt ) / 1000 / 60 / 60 / 24; dnum = Math.floor(days); 
          hours = (now - grt ) / 1000 / 60 / 60 - (24 * dnum); hnum = Math.floor(hours); 
          if(String(hnum).length ==1 ){hnum = "0" + hnum;} minutes = (now - grt ) / 1000 /60 - (24 * 60 * dnum) - (60 * hnum); 
          mnum = Math.floor(minutes); if(String(mnum).length ==1 ){mnum = "0" + mnum;} 
          seconds = (now - grt ) / 1000 - (24 * 60 * 60 * dnum) - (60 * 60 * hnum) - (60 * mnum); 
          snum = Math.round(seconds); if(String(snum).length ==1 ){snum = "0" + snum;} 
          document.getElementById("timeDate").innerHTML = "博主已经爬了 "+dnum+" 天 "; 
          document.getElementById("times").innerHTML = hnum + " 小时 " + mnum + " 分 " + snum + " 秒"; 
      } 
  setInterval("createtime()",250);
  </script>
</div>
<div class="wordcount">
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-chart-line"></i>
    </span>
    <span title="站点总字数">951k</span>
  </span>
  <span class="post-meta-item">
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    <span title="站点阅读时长">14:25</span>
  </span>
</div>
<div class="busuanzi-count">
    <span class="post-meta-item" id="busuanzi_container_site_uv">
      <span class="post-meta-item-icon">
        <i class="fa fa-user"></i>
      </span>
      <span class="site-uv" title="总访客量">
        <span id="busuanzi_value_site_uv"></span>
      </span>
    </span>
    <span class="post-meta-item" id="busuanzi_container_site_pv">
      <span class="post-meta-item-icon">
        <i class="fa fa-eye"></i>
      </span>
      <span class="site-pv" title="总访问量">
        <span id="busuanzi_value_site_pv"></span>
      </span>
    </span>
</div>

    </div>
  </footer>

  
  <script src="https://cdn.jsdelivr.net/npm/animejs@3.2.1/lib/anime.min.js" integrity="sha256-XL2inqUJaslATFnHdJOi9GfQ60on8Wx1C2H8DYiN1xY=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/medium-zoom@1.0.6/dist/medium-zoom.min.js" integrity="sha256-EdPgYcPk/IIrw7FYeuJQexva49pVRZNmt3LculEr7zM=" crossorigin="anonymous"></script>
  <script src="https://cdn.jsdelivr.net/npm/lozad@1.16.0/dist/lozad.min.js" integrity="sha256-mOFREFhqmHeQbXpK2lp4nA3qooVgACfh88fpJftLBbc=" crossorigin="anonymous"></script>
<script src="/js/comments.js"></script><script src="/js/utils.js"></script><script src="/js/next-boot.js"></script><script src="/js/bookmark.js"></script>

  
<script src="https://cdn.jsdelivr.net/npm/hexo-generator-searchdb@1.4.0/dist/search.js" integrity="sha256-vXZMYLEqsROAXkEw93GGIvaB2ab+QW6w3+1ahD9nXXA=" crossorigin="anonymous"></script>
<script src="/js/third-party/search/local-search.js"></script>





  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>




  

  <script class="next-config" data-name="enableMath" type="application/json">true</script><script class="next-config" data-name="mathjax" type="application/json">{"enable":true,"tags":"all","js":{"url":"https://cdn.jsdelivr.net/npm/mathjax@3.2.0/es5/tex-mml-chtml.js","integrity":"sha256-r+3itOMtGGjap0x+10hu6jW/gZCzxHsoKrOd7gyRSGY="}}</script>
<script src="/js/third-party/math/mathjax.js"></script>


<script class="next-config" data-name="utterances" type="application/json">{"enable":true,"repo":"4XWi11/comments","issue_term":"pathname","theme":"github-light","cdn":"https://utteranc.es/client.js"}</script>
<script src="/js/third-party/comments/utterances.js"></script>

</body>
</html>
